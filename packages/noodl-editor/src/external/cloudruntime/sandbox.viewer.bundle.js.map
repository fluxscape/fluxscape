{"version":3,"file":"sandbox.viewer.bundle.js","mappings":"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","sources":["webpack://@noodl/cloud-runtime/../../node_modules/lodash.difference/index.js","webpack://@noodl/cloud-runtime/./src/index.ts","webpack://@noodl/cloud-runtime/./src/nodes/cloud/request.ts","webpack://@noodl/cloud-runtime/./src/nodes/cloud/response.ts","webpack://@noodl/cloud-runtime/./src/nodes/index.ts","webpack://@noodl/cloud-runtime/../noodl-runtime/noodl-runtime.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/api/cloudfile.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/api/cloudstore.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/api/configservice.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/api/queryutils.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/api/records.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/async-pool.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/collection.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/edgetriggeredinput.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/editorconnection.activewarnings.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/editorconnection.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/editormodeleventshandler.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/events.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/eventsender.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/guid.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/javascriptnodeparser.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/model.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/models/componentmodel.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/models/graphmodel.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/models/nodemodel.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/node.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodecontext.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodedefinition.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodelibraryexport.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/noderegister.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/componentinputs.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/componentinstance.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/componentoutputs.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/and.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/booleantostring.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/condition.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/counter.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/cloudfilenode.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/dbcollectionnode2.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/dbconfig.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/dbmodelcrudbase.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/dbmodelnode-addrelation.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/dbmodelnode-removerelation.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/dbmodelnode2.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/deletedbmodelpropertiesnode.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/filterdbmodelsnode.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/modelcrudbase.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/modelnode2.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/newdbmodelpropertiesnode.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/newmodelnode.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/restnode.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/setdbmodelpropertiesnode.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/data/setmodelpropertiesnode.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/datetostring.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/expression.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/inverter.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/or.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/runtasks.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/simplejavascript.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/stringformat.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/stringmapper.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/substring.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/uniqueid.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/user/setuserproperties.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/user/user.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/variables/boolean.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/variables/number.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/variables/string.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodes/std-library/variables/variablebase.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/nodescope.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/outputproperty.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/projectsettings.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/services/services.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/timerscheduler.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/utils.js","webpack://@noodl/cloud-runtime/../noodl-runtime/src/variants.js","webpack://@noodl/cloud-runtime/./src/api/files.js","webpack://@noodl/cloud-runtime/./src/api/users.js","webpack://@noodl/cloud-runtime/./src/nodes/data/aggregatenode.js","webpack://@noodl/cloud-runtime/./src/noodl-js-api.js","webpack://@noodl/cloud-runtime/./src/services/userservice.js","webpack://@noodl/cloud-runtime/webpack/bootstrap","webpack://@noodl/cloud-runtime/webpack/runtime/compat get default export","webpack://@noodl/cloud-runtime/webpack/runtime/define property getters","webpack://@noodl/cloud-runtime/webpack/runtime/global","webpack://@noodl/cloud-runtime/webpack/runtime/hasOwnProperty shorthand","webpack://@noodl/cloud-runtime/./src/sandbox.viewer.js"],"sourcesContent":["/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/**\n * A faster alternative to `Function#apply`, this function invokes `func`\n * with the `this` binding of `thisArg` and the arguments of `args`.\n *\n * @private\n * @param {Function} func The function to invoke.\n * @param {*} thisArg The `this` binding of `func`.\n * @param {Array} args The arguments to invoke `func` with.\n * @returns {*} Returns the result of `func`.\n */\nfunction apply(func, thisArg, args) {\n  switch (args.length) {\n    case 0: return func.call(thisArg);\n    case 1: return func.call(thisArg, args[0]);\n    case 2: return func.call(thisArg, args[0], args[1]);\n    case 3: return func.call(thisArg, args[0], args[1], args[2]);\n  }\n  return func.apply(thisArg, args);\n}\n\n/**\n * A specialized version of `_.includes` for arrays without support for\n * specifying an index to search from.\n *\n * @private\n * @param {Array} [array] The array to inspect.\n * @param {*} target The value to search for.\n * @returns {boolean} Returns `true` if `target` is found, else `false`.\n */\nfunction arrayIncludes(array, value) {\n  var length = array ? array.length : 0;\n  return !!length && baseIndexOf(array, value, 0) > -1;\n}\n\n/**\n * This function is like `arrayIncludes` except that it accepts a comparator.\n *\n * @private\n * @param {Array} [array] The array to inspect.\n * @param {*} target The value to search for.\n * @param {Function} comparator The comparator invoked per element.\n * @returns {boolean} Returns `true` if `target` is found, else `false`.\n */\nfunction arrayIncludesWith(array, value, comparator) {\n  var index = -1,\n      length = array ? array.length : 0;\n\n  while (++index < length) {\n    if (comparator(value, array[index])) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * A specialized version of `_.map` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the new mapped array.\n */\nfunction arrayMap(array, iteratee) {\n  var index = -1,\n      length = array ? array.length : 0,\n      result = Array(length);\n\n  while (++index < length) {\n    result[index] = iteratee(array[index], index, array);\n  }\n  return result;\n}\n\n/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\n/**\n * The base implementation of `_.findIndex` and `_.findLastIndex` without\n * support for iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Function} predicate The function invoked per iteration.\n * @param {number} fromIndex The index to search from.\n * @param {boolean} [fromRight] Specify iterating from right to left.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseFindIndex(array, predicate, fromIndex, fromRight) {\n  var length = array.length,\n      index = fromIndex + (fromRight ? 1 : -1);\n\n  while ((fromRight ? index-- : ++index < length)) {\n    if (predicate(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.indexOf` without `fromIndex` bounds checks.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} value The value to search for.\n * @param {number} fromIndex The index to search from.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseIndexOf(array, value, fromIndex) {\n  if (value !== value) {\n    return baseFindIndex(array, baseIsNaN, fromIndex);\n  }\n  var index = fromIndex - 1,\n      length = array.length;\n\n  while (++index < length) {\n    if (array[index] === value) {\n      return index;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.isNaN` without support for number objects.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is `NaN`, else `false`.\n */\nfunction baseIsNaN(value) {\n  return value !== value;\n}\n\n/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\n/**\n * Checks if a cache value for `key` exists.\n *\n * @private\n * @param {Object} cache The cache to query.\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction cacheHas(cache, key) {\n  return cache.has(key);\n}\n\n/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype,\n    funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/** Built-in value references. */\nvar Symbol = root.Symbol,\n    propertyIsEnumerable = objectProto.propertyIsEnumerable,\n    splice = arrayProto.splice,\n    spreadableSymbol = Symbol ? Symbol.isConcatSpreadable : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max;\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map'),\n    nativeCreate = getNative(Object, 'create');\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n}\n\n/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  return this.has(key) && delete this.__data__[key];\n}\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);\n}\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n}\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  return true;\n}\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  return getMapData(this, key)['delete'](key);\n}\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  getMapData(this, key).set(key, value);\n  return this;\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\n/**\n *\n * Creates an array cache object to store unique values.\n *\n * @private\n * @constructor\n * @param {Array} [values] The values to cache.\n */\nfunction SetCache(values) {\n  var index = -1,\n      length = values ? values.length : 0;\n\n  this.__data__ = new MapCache;\n  while (++index < length) {\n    this.add(values[index]);\n  }\n}\n\n/**\n * Adds `value` to the array cache.\n *\n * @private\n * @name add\n * @memberOf SetCache\n * @alias push\n * @param {*} value The value to cache.\n * @returns {Object} Returns the cache instance.\n */\nfunction setCacheAdd(value) {\n  this.__data__.set(value, HASH_UNDEFINED);\n  return this;\n}\n\n/**\n * Checks if `value` is in the array cache.\n *\n * @private\n * @name has\n * @memberOf SetCache\n * @param {*} value The value to search for.\n * @returns {number} Returns `true` if `value` is found, else `false`.\n */\nfunction setCacheHas(value) {\n  return this.__data__.has(value);\n}\n\n// Add methods to `SetCache`.\nSetCache.prototype.add = SetCache.prototype.push = setCacheAdd;\nSetCache.prototype.has = setCacheHas;\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of methods like `_.difference` without support\n * for excluding multiple arrays or iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Array} values The values to exclude.\n * @param {Function} [iteratee] The iteratee invoked per element.\n * @param {Function} [comparator] The comparator invoked per element.\n * @returns {Array} Returns the new array of filtered values.\n */\nfunction baseDifference(array, values, iteratee, comparator) {\n  var index = -1,\n      includes = arrayIncludes,\n      isCommon = true,\n      length = array.length,\n      result = [],\n      valuesLength = values.length;\n\n  if (!length) {\n    return result;\n  }\n  if (iteratee) {\n    values = arrayMap(values, baseUnary(iteratee));\n  }\n  if (comparator) {\n    includes = arrayIncludesWith;\n    isCommon = false;\n  }\n  else if (values.length >= LARGE_ARRAY_SIZE) {\n    includes = cacheHas;\n    isCommon = false;\n    values = new SetCache(values);\n  }\n  outer:\n  while (++index < length) {\n    var value = array[index],\n        computed = iteratee ? iteratee(value) : value;\n\n    value = (comparator || value !== 0) ? value : 0;\n    if (isCommon && computed === computed) {\n      var valuesIndex = valuesLength;\n      while (valuesIndex--) {\n        if (values[valuesIndex] === computed) {\n          continue outer;\n        }\n      }\n      result.push(value);\n    }\n    else if (!includes(values, computed, comparator)) {\n      result.push(value);\n    }\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.flatten` with support for restricting flattening.\n *\n * @private\n * @param {Array} array The array to flatten.\n * @param {number} depth The maximum recursion depth.\n * @param {boolean} [predicate=isFlattenable] The function invoked per iteration.\n * @param {boolean} [isStrict] Restrict to values that pass `predicate` checks.\n * @param {Array} [result=[]] The initial result value.\n * @returns {Array} Returns the new flattened array.\n */\nfunction baseFlatten(array, depth, predicate, isStrict, result) {\n  var index = -1,\n      length = array.length;\n\n  predicate || (predicate = isFlattenable);\n  result || (result = []);\n\n  while (++index < length) {\n    var value = array[index];\n    if (depth > 0 && predicate(value)) {\n      if (depth > 1) {\n        // Recursively flatten arrays (susceptible to call stack limits).\n        baseFlatten(value, depth - 1, predicate, isStrict, result);\n      } else {\n        arrayPush(result, value);\n      }\n    } else if (!isStrict) {\n      result[result.length] = value;\n    }\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\n/**\n * The base implementation of `_.rest` which doesn't validate or coerce arguments.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @returns {Function} Returns the new function.\n */\nfunction baseRest(func, start) {\n  start = nativeMax(start === undefined ? (func.length - 1) : start, 0);\n  return function() {\n    var args = arguments,\n        index = -1,\n        length = nativeMax(args.length - start, 0),\n        array = Array(length);\n\n    while (++index < length) {\n      array[index] = args[start + index];\n    }\n    index = -1;\n    var otherArgs = Array(start + 1);\n    while (++index < start) {\n      otherArgs[index] = args[index];\n    }\n    otherArgs[start] = array;\n    return apply(func, this, otherArgs);\n  };\n}\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\n/**\n * Checks if `value` is a flattenable `arguments` object or array.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is flattenable, else `false`.\n */\nfunction isFlattenable(value) {\n  return isArray(value) || isArguments(value) ||\n    !!(spreadableSymbol && value && value[spreadableSymbol]);\n}\n\n/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to process.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\n/**\n * Creates an array of `array` values not included in the other given arrays\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons. The order of result values is determined by the\n * order they occur in the first array.\n *\n * **Note:** Unlike `_.pullAll`, this method returns a new array.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to inspect.\n * @param {...Array} [values] The values to exclude.\n * @returns {Array} Returns the new array of filtered values.\n * @see _.without, _.xor\n * @example\n *\n * _.difference([2, 1], [2, 3]);\n * // => [1]\n */\nvar difference = baseRest(function(array, values) {\n  return isArrayLikeObject(array)\n    ? baseDifference(array, baseFlatten(values, 1, isArrayLikeObject, true))\n    : [];\n});\n\n/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nfunction isArguments(value) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&\n    (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);\n}\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\n/**\n * This method is like `_.isArrayLike` except that it also checks if `value`\n * is an object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array-like object,\n *  else `false`.\n * @example\n *\n * _.isArrayLikeObject([1, 2, 3]);\n * // => true\n *\n * _.isArrayLikeObject(document.body.children);\n * // => true\n *\n * _.isArrayLikeObject('abc');\n * // => false\n *\n * _.isArrayLikeObject(_.noop);\n * // => false\n */\nfunction isArrayLikeObject(value) {\n  return isObjectLike(value) && isArrayLike(value);\n}\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\nmodule.exports = difference;\n","// We need to import this so it's available in NoodlRuntime.Services\r\n\r\n//import WebSocket from 'ws';\r\nimport { NoodlRequest, NoodlResponse } from './bridge';\r\nimport { registerNodes } from './nodes';\r\nimport NoodlRuntime from '@noodl/runtime';\r\nimport Model from '@noodl/runtime/src/model';\r\nimport NodeScope from '@noodl/runtime/src/nodescope';\r\nimport './noodl-js-api';\r\n\r\nrequire('./services/userservice');\r\n\r\nexport class CloudRunner {\r\n  private runtime: NoodlRuntime;\r\n\r\n  constructor(options: {\r\n    webSocketClass?: any;\r\n    enableDebugInspectors?: boolean;\r\n    connectToEditor?: boolean;\r\n    editorAddress?: string;\r\n  }) {\r\n    this.runtime = new NoodlRuntime({\r\n      type: 'cloud',\r\n      platform: {\r\n        requestUpdate: (f: any) => setImmediate(f),\r\n        getCurrentTime: () => new Date().getTime(),\r\n        objectToString: (o: any) => JSON.stringify(o, null, 2),\r\n        webSocketClass: options.webSocketClass,\r\n        isRunningLocally: () => options.connectToEditor\r\n      },\r\n      componentFilter: (c) => c.name.startsWith('/#__cloud__/'),\r\n      dontCreateRootComponent: true\r\n    });\r\n\r\n    registerNodes(this.runtime);\r\n\r\n    this.runtime.setDebugInspectorsEnabled(options.enableDebugInspectors);\r\n\r\n    if (options.connectToEditor && options.editorAddress) {\r\n      this.runtime.connectToEditor(options.editorAddress);\r\n    }\r\n  }\r\n\r\n  public async load(exportData: any, projectSettings?: any) {\r\n    await this.runtime.setData(exportData);\r\n\r\n    if (projectSettings) this.runtime.setProjectSettings(projectSettings);\r\n  }\r\n\r\n  public async run(functionName: string, request: NoodlRequest): Promise<NoodlResponse> {\r\n    return new Promise<NoodlResponse>((resolve, reject) => {\r\n      const requestId = Math.random().toString(26).slice(2);\r\n\r\n      const requestScope = new NodeScope(this.runtime.context);\r\n      requestScope.modelScope = new Model.Scope();\r\n\r\n      this.runtime.context\r\n        .createComponentInstanceNode('/#__cloud__/' + functionName, requestId + '-' + functionName, requestScope)\r\n        .then((functionComponent) => {\r\n          // Look for the first request node (should only be one)\r\n          const requestNode = functionComponent.nodeScope.getNodesWithType('noodl.cloud.request')[0];\r\n          if (requestNode) {\r\n            // Look for all response nodes\r\n            let hasResponded = false;\r\n            const responseNodes = functionComponent.nodeScope.getNodesWithTypeRecursive('noodl.cloud.response');\r\n            responseNodes.forEach((resp) => {\r\n              resp._internal._sendResponseCallback = (resp) => {\r\n                if (hasResponded) return;\r\n                hasResponded = true;\r\n\r\n                //the functionComponent is \"manually\" created outside of a scope, so call the delete function directly\r\n                functionComponent._onNodeDeleted();\r\n                requestScope.reset(); //this deletes any remaining nodes, although there shouldn't be any at this point\r\n\r\n                //clean upp all models\r\n                requestScope.modelScope.reset();\r\n\r\n                resolve(resp);\r\n              };\r\n            });\r\n\r\n            setImmediate(() => {\r\n              try {\r\n                requestNode.sendRequest(request).catch(reject);\r\n              } catch (e) {\r\n                reject(e);\r\n              }\r\n            });\r\n          } else {\r\n            reject(Error('Could not find request node for function'));\r\n          }\r\n        })\r\n        .catch((e) => {\r\n          // Failed creating component\r\n          reject(e);\r\n        });\r\n    });\r\n  }\r\n}\r\n","//import CloudStore from '@noodl/runtime/src/api/cloudstore'\r\nimport Model from '@noodl/runtime/src/model';\r\nimport NoodlRuntime from '@noodl/runtime';\r\nimport ConfigService from '@noodl/runtime/src/api/configservice'\r\n\r\nexport const node = {\r\n  name: 'noodl.cloud.request',\r\n  displayNodeName: 'Request',\r\n  category: 'Cloud',\r\n  docs: 'https://docs.noodl.net/nodes/cloud-functions/request',\r\n  useVariants: false,\r\n  mountedInput: false,\r\n  allowAsExportRoot: false,\r\n  singleton: true,\r\n  color: 'data',\r\n  connectionPanel: {\r\n    groupPriority: ['General', 'Mounted']\r\n  },\r\n  outputs: {\r\n    receive: {\r\n      displayName: 'Received',\r\n      type: 'signal',\r\n      group: 'General'\r\n    },\r\n    auth: {\r\n      displayName: 'Authenticated',\r\n      type: 'boolean',\r\n      group: 'Request',\r\n      getter: function () {\r\n        return !!this._internal.authenticated;\r\n      }\r\n    },\r\n    userId: {\r\n      displayName: 'User Id',\r\n      type: 'boolean',\r\n      group: 'Request',\r\n      getter: function () {\r\n        return this._internal.authUserId;\r\n      }\r\n    }\r\n  },\r\n  inputs: {\r\n    allowNoAuth: {\r\n      group: 'General',\r\n      type: 'boolean',\r\n      displayName: 'Allow Unauthenticated',\r\n      default: false,\r\n      set: function (value) {\r\n        this._internal.allowNoAuth = value;\r\n      }\r\n    },\r\n    params: {\r\n      group: 'Parameters',\r\n      type: { name: 'stringlist', allowEditOnly: true },\r\n      set: function (value) {\r\n        this._internal.params = value;\r\n      }\r\n    }\r\n  },\r\n  initialize: function () {\r\n    this._internal.allowNoAuth = false;\r\n    this._internal.requestParameters = {};\r\n    this._internal.userProperties = {\r\n      Authenticated: false\r\n    };\r\n  },\r\n  methods: {\r\n    getRequestParameter: function (name) {\r\n      return this._internal.requestParameters[name];\r\n    },\r\n    setRequestParameter: function (name, value) {\r\n      this._internal.requestParameters[name] = value;\r\n      if (this.hasOutput('pm-' + name)) this.flagOutputDirty('pm-' + name);\r\n    },\r\n    fetchCurrentUser: async function (sessionToken) {\r\n      return new Promise((resolve, reject) => {\r\n        const userService = NoodlRuntime.Services.UserService.forScope(this.nodeScope.modelScope);\r\n        userService.fetchCurrentUser({\r\n          sessionToken,\r\n          success: resolve,\r\n          error: reject\r\n        });\r\n      });\r\n    },\r\n    sendRequest: async function (req) {\r\n      const sessionToken = req.headers['x-parse-session-token'];\r\n      let params = {};\r\n      try {\r\n        params = JSON.parse(req.body);\r\n      } catch (e) {}\r\n\r\n      if (sessionToken) {\r\n        // There is a user token, fetch user\r\n        try {\r\n          await this.fetchCurrentUser(sessionToken);\r\n\r\n          const userService = NoodlRuntime.Services.UserService.forScope(this.nodeScope.modelScope);\r\n          const userModel = userService.current;\r\n\r\n          this._internal.authenticated = true;\r\n          this._internal.authUserId = userModel.getId();\r\n          this.flagOutputDirty('userId');\r\n        } catch (e) {\r\n          // User could not be fetched\r\n          if (!this._internal.allowNoAuth) throw Error('Unauthenticated requests not accepted.');\r\n        }\r\n      } else if (!this._internal.allowNoAuth) throw Error('Unauthenticated requests not accepted.');\r\n\r\n      // Make sure config is cached before processing request\r\n      await ConfigService.instance.getConfig()\r\n\r\n      // Create request object\r\n      const requestModel = (this.nodeScope.modelScope || Model).get('Request');\r\n      requestModel.set('Authenticated', !!this._internal.authenticated);\r\n      requestModel.set('UserId', this._internal.authUserId);\r\n      requestModel.set('Parameters', params);\r\n      requestModel.set('Headers', req.headers);\r\n\r\n      this.flagOutputDirty('auth');\r\n\r\n      for (let key in params) {\r\n        this.setRequestParameter(key, params[key]);\r\n      }\r\n      this.sendSignalOnOutput('receive');\r\n    },\r\n    registerOutputIfNeeded: function (name) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('pm-'))\r\n        this.registerOutput(name, {\r\n          getter: this.getRequestParameter.bind(this, name.substring('pm-'.length))\r\n        });\r\n    }\r\n  }\r\n};\r\n\r\nexport function setup(context, graphModel) {\r\n  if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node) {\r\n    function _updatePorts() {\r\n      var ports = [];\r\n\r\n      // Add params outputs\r\n      var params = node.parameters.params;\r\n      if (params !== undefined) {\r\n        params = params.split(',');\r\n        for (var i in params) {\r\n          var p = params[i];\r\n\r\n          ports.push({\r\n            type: '*',\r\n            plug: 'output',\r\n            group: 'Parameters',\r\n            name: 'pm-' + p,\r\n            displayName: p\r\n          });\r\n        }\r\n      }\r\n\r\n      context.editorConnection.sendDynamicPorts(node.id, ports);\r\n    }\r\n\r\n    _updatePorts();\r\n    node.on('parameterUpdated', function (event) {\r\n      if (event.name === 'params') {\r\n        _updatePorts();\r\n      }\r\n    });\r\n  }\r\n\r\n  graphModel.on('editorImportComplete', () => {\r\n    graphModel.on('nodeAdded.noodl.cloud.request', function (node) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType('noodl.cloud.request')) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","export const node = {\r\n  name: 'noodl.cloud.response',\r\n  displayNodeName: 'Response',\r\n  category: 'Cloud',\r\n  docs: 'https://docs.noodl.net/nodes/cloud-functions/response',\r\n  useVariants: false,\r\n  mountedInput: false,\r\n  allowAsExportRoot: false,\r\n  color: \"data\",\r\n  connectionPanel: {\r\n    groupPriority: ['General', 'Mounted']\r\n  },\r\n  dynamicports:[\r\n    {\r\n        name:'conditionalports/extended',\r\n        condition:\"status = success OR status NOT SET\",\r\n        inputs:['params']\r\n    },\r\n    {\r\n      name:'conditionalports/extended',\r\n      condition:\"status = failure\",\r\n      inputs:['errorMessage']\r\n    }\r\n  ],\r\n  initialize:function() {\r\n    this._internal.responseParameters = {}\r\n  },\r\n  inputs: {\r\n    params: {\r\n      group: 'Parameters',\r\n      type:{name:'stringlist',allowEditOnly:true},\r\n      set: function (value) {\r\n        this._internal.params = value;\r\n      }\r\n    },\r\n    errorMessage: {\r\n      group: 'General',\r\n      type: 'string',\r\n      displayName:'Error Message',\r\n      set: function (value) {\r\n        this._internal.errorMessage = value;\r\n      }\r\n    },\r\n    send: {\r\n      displayName: 'Send',\r\n      type: 'signal',\r\n      group: 'General',\r\n      valueChangedToTrue: function () {\r\n        if(this._internal.status === undefined || this._internal.status === 'success') {\r\n          this._internal._sendResponseCallback({\r\n            statusCode: 200,\r\n            body: JSON.stringify({result:this._internal.responseParameters})\r\n          })\r\n        }\r\n        else {\r\n          this._internal._sendResponseCallback({\r\n            statusCode: 400,\r\n            body: JSON.stringify({error:this._internal.errorMessage})\r\n          })\r\n        }\r\n      }\r\n    },\r\n    status: {\r\n      group: 'General',\r\n      displayName:'Status',\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          {\r\n            label: 'Success',\r\n            value: 'success'\r\n          },\r\n          {\r\n            label: 'Failure',\r\n            value: 'failure'\r\n          }\r\n        ]\r\n      },\r\n      default:'success',\r\n      set: function(value) {\r\n        this._internal.status = value;\r\n      }\r\n    }\r\n  },\r\n  methods:{\r\n    setResponseParameter:function(name,value) {\r\n      this._internal.responseParameters[name] = value\r\n    },\r\n    registerInputIfNeeded: function(name) {\r\n      if(this.hasInput(name)) {\r\n          return;\r\n      }\r\n\r\n      if(name.startsWith('pm-')) this.registerInput(name, {\r\n          set: this.setResponseParameter.bind(this, name.substring('pm-'.length))\r\n      })\r\n    },\r\n  }\r\n};\r\n\r\nexport function setup(context, graphModel) {\r\n  if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node) {\r\n    function _updatePorts() {\r\n      var ports = []\r\n\r\n      // Add params outputs\r\n      if(node.parameters.status === 'success' || node.parameters.status === undefined) {\r\n        var params = node.parameters.params;\r\n        if (params !== undefined) {\r\n          params = params.split(',');\r\n          for (var i in params) {\r\n            var p = params[i];\r\n\r\n            ports.push({\r\n              type: '*',\r\n              plug: 'input',\r\n              group: 'Parameters',\r\n              name: 'pm-' + p,\r\n              displayName: p\r\n            })\r\n          }\r\n        }\r\n      }\r\n\r\n      context.editorConnection.sendDynamicPorts(node.id, ports);\r\n    }\r\n\r\n    _updatePorts();\r\n    node.on(\"parameterUpdated\", function (event) {\r\n      if (event.name === 'params') {\r\n        _updatePorts();\r\n      }\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.noodl.cloud.response\", function (node) {\r\n      _managePortsForNode(node)\r\n    })\r\n\r\n    for (const node of graphModel.getNodesWithType('noodl.cloud.response')) {\r\n      _managePortsForNode(node)\r\n    }\r\n  })\r\n}\r\n","import NoodlRuntime from '@noodl/runtime';\r\n\r\nexport function registerNodes(runtime: NoodlRuntime) {\r\n  [require('./cloud/request'), \r\n  require('./cloud/response'),\r\n  require('./data/aggregatenode')]\r\n  .forEach(function (nodeDefinition) {\r\n    runtime.registerNode(nodeDefinition);\r\n  });\r\n}\r\n","'use strict';\r\n\r\nconst NodeContext = require('./src/nodecontext');\r\nconst EditorConnection = require('./src/editorconnection');\r\nconst generateNodeLibrary = require('./src/nodelibraryexport');\r\nconst ProjectSettings = require('./src/projectsettings');\r\nconst GraphModel = require('./src/models/graphmodel');\r\nconst NodeDefinition = require('./src/nodedefinition');\r\nconst Node = require('./src/node');\r\nconst EditorModelEventsHandler = require('./src/editormodeleventshandler');\r\nconst Services = require('./src/services/services');\r\nconst EdgeTriggeredInput = require('./src/edgetriggeredinput');\r\n\r\nconst EventEmitter = require('./src/events');\r\nconst asyncPool = require('./src/async-pool');\r\n\r\nfunction registerNodes(noodlRuntime) {\r\n  [\r\n    require('./src/nodes/componentinputs'),\r\n    require('./src/nodes/componentoutputs'),\r\n\r\n    require('./src/nodes/std-library/runtasks'),\r\n\r\n    // Data\r\n    require('./src/nodes/std-library/data/restnode'),\r\n\r\n    // Custom code\r\n    require('./src/nodes/std-library/expression'),\r\n    require('./src/nodes/std-library/simplejavascript'),\r\n\r\n    // Records\r\n    require('./src/nodes/std-library/data/dbcollectionnode2'),\r\n    require('./src/nodes/std-library/data/dbmodelnode2'),\r\n    require('./src/nodes/std-library/data/setdbmodelpropertiesnode'),\r\n    require('./src/nodes/std-library/data/deletedbmodelpropertiesnode'),\r\n    require('./src/nodes/std-library/data/newdbmodelpropertiesnode'),\r\n    require('./src/nodes/std-library/data/dbmodelnode-addrelation'),\r\n    require('./src/nodes/std-library/data/dbmodelnode-removerelation'),\r\n    require('./src/nodes/std-library/data/filterdbmodelsnode'),\r\n\r\n    // Object\r\n    require('./src/nodes/std-library/data/modelnode2'),\r\n    require('./src/nodes/std-library/data/setmodelpropertiesnode'),\r\n    require('./src/nodes/std-library/data/newmodelnode'),\r\n\r\n    // Cloud\r\n    require('./src/nodes/std-library/data/cloudfilenode'),\r\n    require('./src/nodes/std-library/data/dbconfig'),\r\n\r\n    // Variables\r\n    require('./src/nodes/std-library/variables/number'),\r\n    require('./src/nodes/std-library/variables/string'),\r\n    require('./src/nodes/std-library/variables/boolean'),\r\n\r\n    // Utils\r\n    require('./src/nodes/std-library/condition'),\r\n    require('./src/nodes/std-library/and'),\r\n    require('./src/nodes/std-library/or'),\r\n    require('./src/nodes/std-library/booleantostring'),\r\n    require('./src/nodes/std-library/datetostring'),\r\n    require('./src/nodes/std-library/stringmapper'),\r\n    require('./src/nodes/std-library/inverter'),\r\n    require('./src/nodes/std-library/substring'),\r\n    require('./src/nodes/std-library/stringformat'),\r\n    require('./src/nodes/std-library/counter'),\r\n    require('./src/nodes/std-library/uniqueid'),\r\n\r\n    // User\r\n    require('./src/nodes/std-library/user/setuserproperties'),\r\n    require('./src/nodes/std-library/user/user')\r\n  ].forEach((node) => noodlRuntime.registerNode(node));\r\n}\r\n\r\nfunction NoodlRuntime(args) {\r\n  args = args || {};\r\n  args.platform = args.platform || {};\r\n  NoodlRuntime.instance = this;\r\n\r\n  this.type = args.type || 'browser';\r\n  this.noodlModules = [];\r\n  this.eventEmitter = new EventEmitter();\r\n  this.updateScheduled = false;\r\n  this.rootComponent = null;\r\n  this._currentLoadedData = null;\r\n  this.isWaitingForExport = true;\r\n  this.graphModel = new GraphModel();\r\n  this.errorHandlers = [];\r\n  this.frameNumber = 0;\r\n  this.dontCreateRootComponent = !!args.dontCreateRootComponent;\r\n  this.componentFilter = args.componentFilter;\r\n\r\n  this.runningInEditor = args.runDeployed ? false : true;\r\n\r\n  this.platform = {\r\n    requestUpdate: args.platform.requestUpdate,\r\n    getCurrentTime: args.platform.getCurrentTime,\r\n    webSocketOptions: args.platform.webSocketOptions,\r\n    objectToString: args.platform.objectToString\r\n  };\r\n\r\n  if (!args.platform.requestUpdate) {\r\n    throw new Error('platform.requestUpdate must be set');\r\n  }\r\n\r\n  if (!args.platform.getCurrentTime) {\r\n    throw new Error('platform.getCurrentTime must be set');\r\n  }\r\n\r\n  //Create an editor connection even if we're running deployed.\r\n  //If won't connect and act as a \"noop\" in deployed mode,\r\n  // and reduce the need for lots of if(editorConnection)\r\n  this.editorConnection = new EditorConnection({\r\n    platform: args.platform,\r\n    runtimeType: this.type\r\n  });\r\n\r\n  this.context = new NodeContext({\r\n    runningInEditor: args.runDeployed ? false : true,\r\n    editorConnection: this.editorConnection,\r\n    platform: this.platform,\r\n    graphModel: this.graphModel\r\n  });\r\n\r\n  this.context.eventEmitter.on('scheduleUpdate', this.scheduleUpdate.bind(this));\r\n\r\n  if (!args.runDeployed) {\r\n    this._setupEditorCommunication(args);\r\n  }\r\n\r\n  this.registerGraphModelListeners();\r\n\r\n  registerNodes(this);\r\n}\r\n\r\nNoodlRuntime.prototype.prefetchBundles = async function (bundleNames, numParallelFetches) {\r\n  await asyncPool(numParallelFetches, bundleNames, async (name) => {\r\n    await this.context.fetchComponentBundle(name);\r\n  });\r\n};\r\n\r\nNoodlRuntime.prototype._setupEditorCommunication = function (args) {\r\n  function objectEquals(x, y) {\r\n    if (x === null || x === undefined || y === null || y === undefined) {\r\n      return x === y;\r\n    }\r\n    if (x === y) {\r\n      return true;\r\n    }\r\n    if (Array.isArray(x) && x.length !== y.length) {\r\n      return false;\r\n    }\r\n\r\n    // if they are strictly equal, they both need to be object at least\r\n    if (!(x instanceof Object)) {\r\n      return false;\r\n    }\r\n    if (!(y instanceof Object)) {\r\n      return false;\r\n    }\r\n\r\n    // recursive object equality check\r\n    var p = Object.keys(x);\r\n    return (\r\n      Object.keys(y).every(function (i) {\r\n        return p.indexOf(i) !== -1;\r\n      }) &&\r\n      p.every(function (i) {\r\n        return objectEquals(x[i], y[i]);\r\n      })\r\n    );\r\n  }\r\n\r\n  this.editorConnection.on('exportDataFull', async (exportData) => {\r\n    if (this.graphModel.isEmpty() === false) {\r\n      this.reload();\r\n      return;\r\n    }\r\n\r\n    this.isWaitingForExport = false;\r\n    if (objectEquals(this._currentLoadedData, exportData) === false) {\r\n      if (this.componentFilter) {\r\n        exportData.components = exportData.components.filter((c) => this.componentFilter(c));\r\n      }\r\n\r\n      await this.setData(exportData);\r\n\r\n      //get the rest of the components\r\n      //important to get all the dynamic ports evaluated\r\n      if (exportData.componentIndex) {\r\n        const allBundles = Object.keys(exportData.componentIndex);\r\n        await this.prefetchBundles(allBundles, 2);\r\n      }\r\n\r\n      this.graphModel.emit('editorImportComplete');\r\n    }\r\n  });\r\n\r\n  this.editorConnection.on('reload', this.reload.bind(this));\r\n  this.editorConnection.on('modelUpdate', this.onModelUpdateReceived.bind(this));\r\n  this.editorConnection.on('metadataUpdate', this.onMetaDataUpdateReceived.bind(this));\r\n\r\n  this.editorConnection.on('connected', () => {\r\n    this.sendNodeLibrary();\r\n  });\r\n};\r\n\r\nNoodlRuntime.prototype.setDebugInspectorsEnabled = function (enabled) {\r\n  this.context.setDebugInspectorsEnabled(enabled);\r\n};\r\n\r\nNoodlRuntime.prototype.registerModule = function (module) {\r\n  if (module.nodes) {\r\n    for (let nodeDefinition of module.nodes) {\r\n      if (!nodeDefinition.node) nodeDefinition = { node: nodeDefinition };\r\n      nodeDefinition.node.module = module.name || 'Unknown Module';\r\n      this.registerNode(nodeDefinition);\r\n    }\r\n  }\r\n\r\n  this.noodlModules.push(module);\r\n};\r\n\r\nNoodlRuntime.prototype.registerGraphModelListeners = function () {\r\n  var self = this;\r\n\r\n  this.graphModel.on(\r\n    'componentAdded',\r\n    function (component) {\r\n      self.context.registerComponentModel(component);\r\n    },\r\n    this\r\n  );\r\n\r\n  this.graphModel.on(\r\n    'componentRemoved',\r\n    function (component) {\r\n      self.context.deregisterComponentModel(component);\r\n    },\r\n    this\r\n  );\r\n};\r\n\r\nNoodlRuntime.prototype.reload = function () {\r\n  location.reload();\r\n};\r\n\r\nNoodlRuntime.prototype.registerNode = function (nodeDefinition) {\r\n  if (nodeDefinition.node) {\r\n    const definedNode = NodeDefinition.defineNode(nodeDefinition.node);\r\n    this.context.nodeRegister.register(definedNode);\r\n\r\n    definedNode.setupNumberedInputDynamicPorts &&\r\n      definedNode.setupNumberedInputDynamicPorts(this.context, this.graphModel);\r\n  } else {\r\n    this.context.nodeRegister.register(nodeDefinition);\r\n  }\r\n\r\n  nodeDefinition.setup && nodeDefinition.setup(this.context, this.graphModel);\r\n};\r\n\r\nNoodlRuntime.prototype._setRootComponent = async function (rootComponentName) {\r\n  if (this.rootComponent && this.rootComponent.name === rootComponentName) return;\r\n\r\n  if (this.rootComponent) {\r\n    this.rootComponent.model && this.rootComponent.model.removeListenersWithRef(this);\r\n    this.rootComponent = undefined;\r\n  }\r\n\r\n  if (rootComponentName) {\r\n    this.rootComponent = await this.context.createComponentInstanceNode(rootComponentName, 'rootComponent');\r\n\r\n    this.rootComponent.componentModel.on('rootAdded', () => this.eventEmitter.emit('rootComponentUpdated'), this);\r\n    this.rootComponent.componentModel.on('rootRemoved', () => this.eventEmitter.emit('rootComponentUpdated'), this);\r\n\r\n    this.context.setRootComponent(this.rootComponent);\r\n  }\r\n\r\n  this.eventEmitter.emit('rootComponentUpdated');\r\n};\r\n\r\nNoodlRuntime.prototype.setData = async function (graphData) {\r\n  // Added for SSR Support\r\n  // In SSR, we re-load the graphData and when we render the componet it will\r\n  // invoke this method again, which will cause a duplicate node exception.\r\n  // To avoid this, we flag the runtime to not load again.\r\n  if (this._disableLoad) return;\r\n\r\n  this._currentLoadedData = graphData;\r\n  await this.graphModel.importEditorData(graphData);\r\n\r\n  // Run setup on all modules\r\n  for (const module of this.noodlModules) {\r\n    typeof module.setup === 'function' && module.setup.apply(module);\r\n  }\r\n\r\n  if (this.dontCreateRootComponent !== true) {\r\n    await this._setRootComponent(this.graphModel.rootComponent);\r\n\r\n    //listen to delta updates on the root component\r\n    this.graphModel.on('rootComponentNameUpdated', (name) => {\r\n      this._setRootComponent(name);\r\n    });\r\n\r\n    //check if the root component was deleted\r\n    this.graphModel.on('componentRemoved', (componentModel) => {\r\n      if (this.rootComponent && this.rootComponent.name === componentModel.name) {\r\n        this._setRootComponent(null);\r\n      }\r\n    });\r\n\r\n    //check if the root component was added when it previously didn't exist (e.g. when user deletes it and then hits undo)\r\n    this.graphModel.on('componentAdded', (componentModel) => {\r\n      setTimeout(() => {\r\n        if (!this.rootComponent && this.graphModel.rootComponent === componentModel.name) {\r\n          this._setRootComponent(componentModel.name);\r\n        }\r\n      }, 1);\r\n    });\r\n  }\r\n\r\n  this.scheduleUpdate();\r\n};\r\n\r\nNoodlRuntime.prototype.scheduleUpdate = function () {\r\n  if (this.updateScheduled) {\r\n    return;\r\n  }\r\n\r\n  this.updateScheduled = true;\r\n  this.platform.requestUpdate(NoodlRuntime.prototype._doUpdate.bind(this));\r\n};\r\n\r\nNoodlRuntime.prototype._doUpdate = function () {\r\n  this.updateScheduled = false;\r\n\r\n  this.context.currentFrameTime = this.platform.getCurrentTime();\r\n\r\n  this.context.eventEmitter.emit('frameStart');\r\n\r\n  this.context.update();\r\n\r\n  this.context.eventEmitter.emit('frameEnd');\r\n\r\n  this.frameNumber++;\r\n};\r\n\r\nNoodlRuntime.prototype.setProjectSettings = function (settings) {\r\n  this.projectSettings = settings;\r\n};\r\n\r\nNoodlRuntime.prototype.getNodeLibrary = function () {\r\n  var projectSettings = ProjectSettings.generateProjectSettings(this.graphModel.getSettings(), this.noodlModules);\r\n\r\n  if (this.projectSettings) {\r\n    this.projectSettings.ports && (projectSettings.ports = projectSettings.ports.concat(this.projectSettings.ports));\r\n    this.projectSettings.dynamicports &&\r\n      (projectSettings.dynamicports = projectSettings.ports.concat(this.projectSettings.dynamicports));\r\n  }\r\n\r\n  var nodeLibrary = generateNodeLibrary(this.context.nodeRegister);\r\n  nodeLibrary.projectsettings = projectSettings;\r\n  return JSON.stringify(nodeLibrary, null, 3);\r\n};\r\n\r\nNoodlRuntime.prototype.sendNodeLibrary = function () {\r\n  const nodeLibrary = this.getNodeLibrary();\r\n  if (this.lastSentNodeLibrary !== nodeLibrary) {\r\n    this.lastSentNodeLibrary = nodeLibrary;\r\n    this.editorConnection.sendNodeLibrary(nodeLibrary);\r\n  }\r\n};\r\n\r\nNoodlRuntime.prototype.connectToEditor = function (address) {\r\n  this.editorConnection.connect(address);\r\n};\r\n\r\nNoodlRuntime.prototype.onMetaDataUpdateReceived = function (event) {\r\n  if (!this.graphModel.isEmpty()) {\r\n    EditorMetaDataEventsHandler.handleEvent(this.context, this.graphModel, event);\r\n  }\r\n};\r\n\r\nNoodlRuntime.prototype.onModelUpdateReceived = async function (event) {\r\n  if (this.isWaitingForExport) {\r\n    return;\r\n  }\r\n\r\n  if (event.type === 'projectInstanceChanged') {\r\n    this.reload();\r\n  }\r\n  //wait for data to load before applying model changes\r\n  else if (this.graphModel.isEmpty() === false) {\r\n    await EditorModelEventsHandler.handleEvent(this.context, this.graphModel, event);\r\n  }\r\n};\r\n\r\nNoodlRuntime.prototype.addErrorHandler = function (callback) {\r\n  this.errorHandlers.push(callback);\r\n};\r\n\r\nNoodlRuntime.prototype.reportError = function (message) {\r\n  this.errorHandlers.forEach(function (eh) {\r\n    eh(message);\r\n  });\r\n};\r\n\r\nNoodlRuntime.prototype.getProjectSettings = function () {\r\n  return this.graphModel.getSettings();\r\n};\r\n\r\nNoodlRuntime.prototype.getMetaData = function (key) {\r\n  return this.graphModel.getMetaData(key);\r\n};\r\n\r\nNoodlRuntime.Services = Services;\r\nNoodlRuntime.Node = Node;\r\nNoodlRuntime.NodeDefinition = NodeDefinition;\r\nNoodlRuntime.EdgeTriggeredInput = EdgeTriggeredInput;\r\n\r\nmodule.exports = NoodlRuntime;\r\n","class CloudFile {\r\n  constructor({ name, url }) {\r\n    this.name = name;\r\n    this.url = url;\r\n  }\r\n\r\n  getUrl() {\r\n    return this.url;\r\n  }\r\n\r\n  getName() {\r\n    return this.name;\r\n  }\r\n\r\n  toString() {\r\n    return this.url;\r\n  }\r\n}\r\n\r\nmodule.exports = CloudFile;\r\n","const NoodlRuntime = require('../../noodl-runtime');\r\nconst Model = require('../model');\r\nconst Collection = require('../collection');\r\nconst CloudFile = require('./cloudfile');\r\nconst EventEmitter = require('../events');\r\n\r\nconst _protectedFields = {\r\n  _common: ['_createdAt', '_updatedAt', 'objectId'],\r\n  _User: ['_email_verify_token']\r\n};\r\n\r\nfunction _removeProtectedFields(data, className) {\r\n  const _data = Object.assign({}, data);\r\n  _protectedFields._common.forEach((f) => delete _data[f]);\r\n  if (className && _protectedFields[className]) _protectedFields[className].forEach((f) => delete _data[f]);\r\n\r\n  return _data;\r\n}\r\n\r\nclass CloudStore {\r\n  constructor(modelScope) {\r\n    this._initCloudServices();\r\n\r\n    this.events = new EventEmitter();\r\n    this.events.setMaxListeners(10000);\r\n    this.modelScope = modelScope;\r\n\r\n    this._fromJSON = (item, collectionName) => CloudStore._fromJSON(item, collectionName, modelScope);\r\n    this._deserializeJSON = (data, type) => CloudStore._deserializeJSON(data, type, modelScope);\r\n    this._serializeObject = (data, collectionName) => CloudStore._serializeObject(data, collectionName, modelScope);\r\n  }\r\n\r\n  _initCloudServices() {\r\n    _collections = undefined; // clear collection cache, so it's refetched\r\n\r\n    const cloudServices = NoodlRuntime.instance.getMetaData('cloudservices');\r\n    if (cloudServices) {\r\n      this.appId = cloudServices.appId;\r\n      this.endpoint = cloudServices.endpoint;\r\n    }\r\n\r\n    const dbVersionMajor = NoodlRuntime.instance.getMetaData('dbVersionMajor');\r\n    this.dbVersionMajor = dbVersionMajor;\r\n  }\r\n\r\n  on() {\r\n    this.events.on.apply(this.events, arguments);\r\n  }\r\n\r\n  off() {\r\n    this.events.off.apply(this.events, arguments);\r\n  }\r\n\r\n  _makeRequest(path, options) {\r\n    if (typeof _noodl_cloud_runtime_version === 'undefined') {\r\n      // Running in browser\r\n      var xhr = new XMLHttpRequest();\r\n\r\n      xhr.onreadystatechange = function () {\r\n        if (xhr.readyState === 4) {\r\n          var json;\r\n          try {\r\n            // In SSR, we dont have xhr.response\r\n            json = JSON.parse(xhr.response || xhr.responseText);\r\n          } catch (e) {}\r\n\r\n          if (xhr.status === 200 || xhr.status === 201) {\r\n            options.success(json);\r\n          } else options.error(json || { error: xhr.responseText, status: xhr.status });\r\n        }\r\n      };\r\n\r\n      xhr.open(options.method || 'GET', this.endpoint + path, true);\r\n\r\n      xhr.setRequestHeader('X-Parse-Application-Id', this.appId);\r\n      if (typeof _noodl_cloudservices !== 'undefined') {\r\n        xhr.setRequestHeader('X-Parse-Master-Key', _noodl_cloudservices.masterKey);\r\n      }\r\n\r\n      // Check for current users\r\n      var _cu = localStorage['Parse/' + this.appId + '/currentUser'];\r\n      if (_cu !== undefined) {\r\n        try {\r\n          const currentUser = JSON.parse(_cu);\r\n          xhr.setRequestHeader('X-Parse-Session-Token', currentUser.sessionToken);\r\n        } catch (e) {\r\n          // Failed to extract session token\r\n        }\r\n      }\r\n\r\n      if (options.onUploadProgress) {\r\n        xhr.upload.onprogress = (pe) => options.onUploadProgress(pe);\r\n      }\r\n\r\n      if (options.content instanceof File) {\r\n        xhr.send(options.content);\r\n      } else {\r\n        xhr.setRequestHeader('Content-Type', 'application/json');\r\n        xhr.send(JSON.stringify(options.content));\r\n      }\r\n    } else {\r\n      // Running in cloud runtime\r\n      const endpoint = typeof _noodl_cloudservices !== 'undefined' ? _noodl_cloudservices.endpoint : this.endpoint;\r\n      const appId = typeof _noodl_cloudservices !== 'undefined' ? _noodl_cloudservices.appId : this.appId;\r\n      const masterKey = typeof _noodl_cloudservices !== 'undefined' ? _noodl_cloudservices.masterKey : undefined;\r\n\r\n      fetch(endpoint + path, {\r\n        method: options.method || 'GET',\r\n        headers: {\r\n          'X-Parse-Application-Id': appId,\r\n          'X-Parse-Master-Key': masterKey,\r\n          'Content-Type': 'application/json'\r\n        },\r\n        body: JSON.stringify(options.content)\r\n      })\r\n        .then((r) => {\r\n          if (r.status === 200 || r.status === 201) {\r\n            if (options.method === 'DELETE') {\r\n              options.success(undefined);\r\n            } else {\r\n              r.json()\r\n                .then((json) => options.success(json))\r\n                .catch((e) =>\r\n                  options.error({\r\n                    error: 'CloudStore: Failed to get json result.'\r\n                  })\r\n                );\r\n            }\r\n          } else {\r\n            if (options.method === 'DELETE') {\r\n              options.error({ error: 'Failed to delete.' });\r\n            } else {\r\n              r.json()\r\n                .then((json) => options.error(json))\r\n                .catch((e) => options.error({ error: 'Failed to fetch.' }));\r\n            }\r\n          }\r\n        })\r\n        .catch((e) => {\r\n          options.error({ error: e.message });\r\n        });\r\n    }\r\n  }\r\n\r\n  query(options) {\r\n    this._makeRequest('/classes/' + options.collection, {\r\n      method: 'POST',\r\n      content: {\r\n        _method: 'GET',\r\n        where: options.where,\r\n        limit: options.limit,\r\n        skip: options.skip,\r\n        include: Array.isArray(options.include) ? options.include.join(',') : options.include,\r\n        keys: Array.isArray(options.select) ? options.select.join(',') : options.select,\r\n        order: Array.isArray(options.sort) ? options.sort.join(',') : options.sort,\r\n        count: options.count\r\n      },\r\n      success: function (response) {\r\n        options.success(response.results, response.count);\r\n      },\r\n      error: function () {\r\n        options.error();\r\n      }\r\n    });\r\n  }\r\n\r\n  aggregate(options) {\r\n    const args = [];\r\n\r\n    if (!options.group) {\r\n      options.error('You need to provide group option.');\r\n      return;\r\n    }\r\n\r\n    if (options.limit) args.push('limit=' + options.limit);\r\n    if (options.skip) args.push('skip=' + options.skip);\r\n\r\n    const grouping = {};\r\n\r\n    Object.keys(options.group).forEach((k) => {\r\n      const _g = {};\r\n      const group = options.group[k];\r\n      if (group['avg'] !== undefined) _g['$avg'] = '$' + group['avg'];\r\n      else if (group['sum'] !== undefined) _g['$sum'] = '$' + group['sum'];\r\n      else if (group['max'] !== undefined) _g['$max'] = '$' + group['max'];\r\n      else if (group['min'] !== undefined) _g['$min'] = '$' + group['min'];\r\n      else if (group['distinct'] !== undefined) _g['$addToSet'] = '$' + group['distinct'];\r\n\r\n      grouping[k] = _g;\r\n    });\r\n\r\n    // I don't know which version the API was changed, lets just say above 4 for now.\r\n    if (this.dbVersionMajor && this.dbVersionMajor > 4) {\r\n      grouping._id = null;\r\n\r\n      if (options.where) args.push('$match=' + encodeURIComponent(JSON.stringify(options.where)));\r\n\r\n      args.push('$group=' + JSON.stringify(grouping));\r\n    } else {\r\n      grouping.objectId = null;\r\n\r\n      if (options.where) args.push('match=' + encodeURIComponent(JSON.stringify(options.where)));\r\n\r\n      args.push('group=' + JSON.stringify(grouping));\r\n    }\r\n\r\n    this._makeRequest('/aggregate/' + options.collection + (args.length > 0 ? '?' + args.join('&') : ''), {\r\n      success: function (response) {\r\n        const res = {};\r\n\r\n        if (!response.results || response.results.length !== 1) {\r\n          options.success({}); // No result\r\n          return;\r\n        }\r\n\r\n        Object.keys(options.group).forEach((k) => {\r\n          res[k] = response.results[0][k];\r\n        });\r\n\r\n        options.success(res);\r\n      },\r\n      error: function () {\r\n        options.error();\r\n      }\r\n    });\r\n  }\r\n\r\n  count(options) {\r\n    const args = [];\r\n\r\n    if (options.where) args.push('where=' + encodeURIComponent(JSON.stringify(options.where)));\r\n    args.push('limit=0');\r\n    args.push('count=1');\r\n\r\n    this._makeRequest('/classes/' + options.collection + (args.length > 0 ? '?' + args.join('&') : ''), {\r\n      success: function (response) {\r\n        options.success(response.count);\r\n      },\r\n      error: function () {\r\n        options.error();\r\n      }\r\n    });\r\n  }\r\n\r\n  distinct(options) {\r\n    const args = [];\r\n\r\n    if (options.where) args.push('where=' + encodeURIComponent(JSON.stringify(options.where)));\r\n    args.push('distinct=' + options.property);\r\n\r\n    this._makeRequest('/aggregate/' + options.collection + (args.length > 0 ? '?' + args.join('&') : ''), {\r\n      success: function (response) {\r\n        options.success(response.results);\r\n      },\r\n      error: function () {\r\n        options.error();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param {{\r\n   *    objectId: string;\r\n   *    collection: string;\r\n   *    keys?: string[] | string;\r\n   *    include?: string[] | string;\r\n   *    excludeKeys?: string[] | string;\r\n   *    success: (data: unknown) => void;\r\n   *    error: (error: unknown) => void;\r\n   * }} options\r\n   */\r\n  fetch(options) {\r\n    const args = [];\r\n\r\n    if (options.include) {\r\n      args.push('include=' + (Array.isArray(options.include) ? options.include.join(',') : options.include));\r\n    }\r\n\r\n    if (options.keys) {\r\n      args.push('keys=' + (Array.isArray(options.keys) ? options.keys.join(',') : options.keys));\r\n    }\r\n\r\n    if (options.excludeKeys) {\r\n      args.push(\r\n        'excludeKeys=' + (Array.isArray(options.excludeKeys) ? options.excludeKeys.join(',') : options.excludeKeys)\r\n      );\r\n    }\r\n\r\n    this._makeRequest(\r\n      '/classes/' + options.collection + '/' + options.objectId + (args.length > 0 ? '?' + args.join('&') : ''),\r\n      {\r\n        method: 'GET',\r\n        success: (response) => {\r\n          options.success(response);\r\n          this.events.emit('fetch', {\r\n            type: 'fetch',\r\n            objectId: options.objectId,\r\n            object: response,\r\n            collection: options.collection\r\n          });\r\n        },\r\n        error: function (res) {\r\n          options.error(res.error);\r\n        }\r\n      }\r\n    );\r\n  }\r\n\r\n  create(options) {\r\n    this._makeRequest('/classes/' + options.collection, {\r\n      method: 'POST',\r\n      content: Object.assign(\r\n        _removeProtectedFields(_serializeObject(options.data, options.collection), options.collection),\r\n        { ACL: options.acl }\r\n      ),\r\n      success: (response) => {\r\n        const _obj = Object.assign({}, options.data, response);\r\n        options.success(_obj);\r\n        this.events.emit('create', {\r\n          type: 'create',\r\n          objectId: options.objectId,\r\n          object: _obj,\r\n          collection: options.collection\r\n        });\r\n      },\r\n      error: function (res) {\r\n        options.error(res.error);\r\n      }\r\n    });\r\n  }\r\n\r\n  increment(options) {\r\n    const data = {};\r\n\r\n    for (let key in options.properties) {\r\n      data[key] = { __op: 'Increment', amount: options.properties[key] };\r\n    }\r\n\r\n    this._makeRequest('/classes/' + options.collection + '/' + options.objectId, {\r\n      method: 'PUT',\r\n      content: data,\r\n      success: (response) => {\r\n        options.success(response);\r\n      },\r\n      error: function (res) {\r\n        options.error(res.error);\r\n      }\r\n    });\r\n  }\r\n\r\n  save(options) {\r\n    const _data = Object.assign({}, options.data);\r\n    delete _data.createdAt;\r\n    delete _data.updatedAt;\r\n\r\n    this._makeRequest('/classes/' + options.collection + '/' + options.objectId, {\r\n      method: 'PUT',\r\n      content: Object.assign(_removeProtectedFields(_serializeObject(_data, options.collection), options.collection), {\r\n        ACL: options.acl\r\n      }),\r\n      success: (response) => {\r\n        options.success(response);\r\n        this.events.emit('save', {\r\n          type: 'save',\r\n          objectId: options.objectId,\r\n          object: Object.assign({}, options.data, response),\r\n          collection: options.collection\r\n        });\r\n      },\r\n      error: function (res) {\r\n        options.error(res.error);\r\n      }\r\n    });\r\n  }\r\n\r\n  delete(options) {\r\n    this._makeRequest('/classes/' + options.collection + '/' + options.objectId, {\r\n      method: 'DELETE',\r\n      success: () => {\r\n        options.success();\r\n        this.events.emit('delete', {\r\n          type: 'delete',\r\n          objectId: options.objectId,\r\n          collection: options.collection\r\n        });\r\n      },\r\n      error: function (res) {\r\n        options.error(res.error);\r\n      }\r\n    });\r\n  }\r\n\r\n  addRelation(options) {\r\n    const _content = {};\r\n    _content[options.key] = {\r\n      __op: 'AddRelation',\r\n      objects: [\r\n        {\r\n          __type: 'Pointer',\r\n          objectId: options.targetObjectId,\r\n          className: options.targetClass\r\n        }\r\n      ]\r\n    };\r\n    this._makeRequest('/classes/' + options.collection + '/' + options.objectId, {\r\n      method: 'PUT',\r\n      content: _content,\r\n      success: function (response) {\r\n        options.success(response);\r\n      },\r\n      error: function (res) {\r\n        options.error(res.error);\r\n      }\r\n    });\r\n  }\r\n\r\n  removeRelation(options) {\r\n    const _content = {};\r\n    _content[options.key] = {\r\n      __op: 'RemoveRelation',\r\n      objects: [\r\n        {\r\n          __type: 'Pointer',\r\n          objectId: options.targetObjectId,\r\n          className: options.targetClass\r\n        }\r\n      ]\r\n    };\r\n    this._makeRequest('/classes/' + options.collection + '/' + options.objectId, {\r\n      method: 'PUT',\r\n      content: _content,\r\n      success: function (response) {\r\n        options.success(response);\r\n      },\r\n      error: function (res) {\r\n        options.error(res.error);\r\n      }\r\n    });\r\n  }\r\n\r\n  uploadFile(options) {\r\n    this._makeRequest('/files/' + options.file.name, {\r\n      method: 'POST',\r\n      content: options.file,\r\n      contentType: options.file.type,\r\n      success: (response) => options.success(Object.assign({}, options.data, response)),\r\n      error: (err) => options.error(err),\r\n      onUploadProgress: options.onUploadProgress\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Users holding the master key are allowed to delete files\r\n   *\r\n   * @param {{\r\n   *    file: {\r\n   *      name: string;\r\n   *    }\r\n   *    success: (data: unknown) => void;\r\n   *    error: (error: unknown) => void;\r\n   * }} options\r\n   */\r\n  deleteFile(options) {\r\n    this._makeRequest('/files/' + options.file.name, {\r\n      method: 'DELETE',\r\n      success: (response) => options.success(Object.assign({}, options.data, response)),\r\n      error: (err) => options.error(err)\r\n    });\r\n  }\r\n}\r\n\r\nfunction _isArrayOfObjects(a) {\r\n  if (!Array.isArray(a)) return false;\r\n  for (var i = 0; i < a.length; i++) if (typeof a[i] !== 'object' || a[i] === null) return false;\r\n\r\n  return true;\r\n}\r\n\r\nfunction _toJSON(obj) {\r\n  if (obj instanceof Model) {\r\n    var res = {};\r\n    for (var key in obj.data) {\r\n      res[key] = _toJSON(obj.data[key]);\r\n    }\r\n    return res;\r\n  } else if (obj instanceof Collection) {\r\n    var res = [];\r\n    obj.items.forEach((m) => {\r\n      res.push(_toJSON(m));\r\n    });\r\n    return res;\r\n  }\r\n  return obj;\r\n}\r\n\r\nfunction _serializeObject(data, collectionName, modelScope) {\r\n  if (CloudStore._collections[collectionName]) var schema = CloudStore._collections[collectionName].schema;\r\n\r\n  for (var key in data) {\r\n    var _type = schema && schema.properties && schema.properties[key] ? schema.properties[key].type : undefined;\r\n\r\n    if (data[key] === undefined || data[key] === null) {\r\n      // Keep null and undefined as is\r\n    } else if (_type === 'Pointer' && typeof data[key] === 'string') {\r\n      // This is a string pointer to an object\r\n      data[key] = {\r\n        __type: 'Pointer',\r\n        className: schema.properties[key].targetClass,\r\n        objectId: data[key]\r\n      };\r\n    } else if (_type === 'Pointer' && typeof data[key] === 'object' && (modelScope || Model).instanceOf(data[key])) {\r\n      // This is an embedded object that should be stored as pointer\r\n      data[key] = {\r\n        __type: 'Pointer',\r\n        className: schema.properties[key].targetClass,\r\n        objectId: data[key].getId()\r\n      };\r\n    } else if (_type === 'Date' && (typeof data[key] === 'string' || data[key] instanceof Date)) {\r\n      data[key] = {\r\n        __type: 'Date',\r\n        iso: data[key] instanceof Date ? data[key].toISOString() : data[key]\r\n      };\r\n    } else if (_type === 'File' && data[key] instanceof CloudFile) {\r\n      const cloudFile = data[key];\r\n      data[key] = {\r\n        __type: 'File',\r\n        url: cloudFile.getUrl(),\r\n        name: cloudFile.getName()\r\n      };\r\n    } else if (_type === 'Array' && typeof data[key] === 'string' && Collection.exists(data[key])) {\r\n      data[key] = _toJSON(Collection.get(data[key]));\r\n    } else if (_type === 'Object' && typeof data[key] === 'string' && (modelScope || Model).exists(data[key])) {\r\n      data[key] = _toJSON((modelScope || Model).get(data[key]));\r\n    } else if (_type === 'GeoPoint' && typeof data[key] === 'object') {\r\n      data[key] = {\r\n        __type: 'GeoPoint',\r\n        latitude: Number(data[key].latitude),\r\n        longitude: Number(data[key].longitude)\r\n      };\r\n    } else data[key] = _toJSON(data[key]);\r\n  }\r\n\r\n  return data;\r\n}\r\n\r\nfunction _deserializeJSON(data, type, modelScope) {\r\n  if (data === undefined) return;\r\n  if (data === null) return null;\r\n\r\n  if (type === 'Relation' && data.__type === 'Relation') {\r\n    return undefined; // Ignore relation fields\r\n  } else if (type === 'Pointer' && data.__type === 'Pointer') {\r\n    // This is a pointer type, resolve into id\r\n    return data.objectId;\r\n  } else if (type === 'Date' && data.__type === 'Date') {\r\n    return new Date(data.iso);\r\n  } else if (type === 'Date' && typeof data === 'string') {\r\n    return new Date(data);\r\n  } else if (type === 'File' && data.__type === 'File') {\r\n    return new CloudFile(data);\r\n  } else if (type === 'GeoPoint' && data.__type === 'GeoPoint') {\r\n    return {\r\n      latitude: data.latitude,\r\n      longitude: data.longitude\r\n    };\r\n  } else if (_isArrayOfObjects(data)) {\r\n    var a = [];\r\n    for (var i = 0; i < data.length; i++) {\r\n      a.push(_deserializeJSON(data[i], undefined, modelScope));\r\n    }\r\n    var c = Collection.get();\r\n    c.set(a);\r\n    return c;\r\n  } else if (Array.isArray(data)) return data;\r\n  // This is an array with mixed data, just return it\r\n  else if (data && data.__type === 'Object' && data.className !== undefined && data.objectId !== undefined) {\r\n    const _data = Object.assign({}, data);\r\n    delete _data.className;\r\n    delete _data.__type;\r\n    return _fromJSON(_data, data.className, modelScope);\r\n  } else if (typeof data === 'object' && data !== null) {\r\n    var m = (modelScope || Model).get();\r\n    for (var key in data) {\r\n      m.set(key, _deserializeJSON(data[key], undefined, modelScope));\r\n    }\r\n    return m;\r\n  } else return data;\r\n}\r\n\r\nfunction _fromJSON(item, collectionName, modelScope) {\r\n  const modelStore = modelScope || Model;\r\n\r\n  const model = modelStore.get(item.objectId);\r\n  model._class = collectionName;\r\n\r\n  let schema = undefined;\r\n  if (collectionName !== undefined && CloudStore._collections[collectionName] !== undefined) {\r\n    schema = CloudStore._collections[collectionName].schema;\r\n  }\r\n\r\n  for (const key in item) {\r\n    if (key === 'objectId' || key === 'ACL') {\r\n      continue;\r\n    }\r\n\r\n    const _type = schema && schema.properties && schema.properties[key] ? schema.properties[key].type : undefined;\r\n    model.set(key, _deserializeJSON(item[key], _type, modelScope));\r\n  }\r\n\r\n  return model;\r\n}\r\n\r\nCloudStore._fromJSON = _fromJSON;\r\nCloudStore._deserializeJSON = _deserializeJSON;\r\nCloudStore._serializeObject = _serializeObject;\r\n\r\nCloudStore.forScope = (modelScope) => {\r\n  if (modelScope === undefined) return CloudStore.instance;\r\n  if (modelScope._cloudStore) return modelScope._cloudStore;\r\n\r\n  modelScope._cloudStore = new CloudStore(modelScope);\r\n  return modelScope._cloudStore;\r\n};\r\n\r\nvar _instance;\r\nObject.defineProperty(CloudStore, 'instance', {\r\n  get: function () {\r\n    if (_instance === undefined) _instance = new CloudStore();\r\n    return _instance;\r\n  }\r\n});\r\n\r\nvar _collections;\r\nObject.defineProperty(CloudStore, '_collections', {\r\n  get: function () {\r\n    if (_collections === undefined) {\r\n      _collections = {};\r\n      const dbCollections = NoodlRuntime.instance.getMetaData('dbCollections') || [];\r\n      dbCollections.forEach((c) => {\r\n        _collections[c.name] = c;\r\n      });\r\n\r\n      const systemCollections = NoodlRuntime.instance.getMetaData('systemCollections') || [];\r\n      systemCollections.forEach((c) => {\r\n        _collections[c.name] = c;\r\n      });\r\n    }\r\n    return _collections;\r\n  }\r\n});\r\n\r\nCloudStore.invalidateCollections = () => {\r\n  _collections = undefined;\r\n};\r\n\r\nmodule.exports = CloudStore;\r\n","const NoodlRuntime = require('../../../noodl-runtime');\r\n\r\nclass ConfigService {\r\n  constructor() {\r\n    this.cacheDuration = 15 * 60 * 1000; // 15 min cache\r\n  }\r\n\r\n  _makeRequest(path, options) {\r\n    if (typeof _noodl_cloud_runtime_version === 'undefined') {\r\n      // Running in browser\r\n      var xhr = new XMLHttpRequest();\r\n\r\n      xhr.onreadystatechange = function () {\r\n        if (xhr.readyState === 4) {\r\n          var json;\r\n          try {\r\n            json = JSON.parse(xhr.response);\r\n          } catch (e) {}\r\n\r\n          if (xhr.status === 200 || xhr.status === 201) {\r\n            options.success(json);\r\n          } else options.error(json || { error: xhr.responseText, status: xhr.status });\r\n        }\r\n      };\r\n\r\n      const cloudServices = NoodlRuntime.instance.getMetaData('cloudservices');\r\n      const appId = cloudServices.appId;\r\n      const endpoint = cloudServices.endpoint;\r\n      xhr.open('GET', endpoint + path, true);\r\n\r\n      xhr.setRequestHeader('X-Parse-Application-Id', appId);\r\n\r\n      xhr.send();\r\n    } else {\r\n      // Running in cloud runtime\r\n      const endpoint = typeof _noodl_cloudservices !== 'undefined' ? _noodl_cloudservices.endpoint : this.endpoint;\r\n      const appId = typeof _noodl_cloudservices !== 'undefined' ? _noodl_cloudservices.appId : this.appId;\r\n      const masterKey = typeof _noodl_cloudservices !== 'undefined' ? _noodl_cloudservices.masterKey : undefined;\r\n\r\n      fetch(endpoint + path, {\r\n        method: 'GET',\r\n        headers: {\r\n          'X-Parse-Application-Id': appId,\r\n          'X-Parse-Master-Key': masterKey\r\n        }\r\n      })\r\n        .then((r) => {\r\n          if (r.status === 200 || r.status === 201) {\r\n            r.json()\r\n              .then((json) => options.success(json))\r\n              .catch((e) =>\r\n                options.error({\r\n                  error: 'Config: Failed to get json result.'\r\n                })\r\n              );\r\n          } else {\r\n            r.json()\r\n              .then((json) => options.error(json))\r\n              .catch((e) => options.error({ error: 'Failed to fetch.' }));\r\n          }\r\n        })\r\n        .catch((e) => {\r\n          options.error({ error: e.message });\r\n        });\r\n    }\r\n  }\r\n\r\n  _getConfig() {\r\n    return new Promise((resolve, reject) => {\r\n      this._makeRequest('/config', {\r\n        success: (config) => {\r\n          resolve(config.params || {});\r\n        },\r\n        error: (err) => {\r\n          reject(err);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  async getConfig() {\r\n    if (this.configCachePending) return this.configCachePending;\r\n\r\n    if (!this.configCache) {\r\n      this.configCachePending = this._getConfig();\r\n\r\n      this.configCache = await this.configCachePending;\r\n      delete this.configCachePending;\r\n      this.ttl = Date.now() + this.cacheDuration;\r\n      return this.configCache;\r\n    } else {\r\n      // Update cache if ttl has passed\r\n      if (Date.now() > this.ttl) {\r\n        this._getConfig().then((config) => {\r\n          this.configCache = config;\r\n          this.ttl = Date.now() + this.cacheDuration;\r\n        });\r\n      }\r\n\r\n      // But return currently cached\r\n      return this.configCache;\r\n    }\r\n  }\r\n\r\n  clearCache() {\r\n    delete this.configCache;\r\n  }\r\n}\r\n\r\nConfigService.instance = new ConfigService();\r\n\r\nmodule.exports = ConfigService;\r\n","const CloudStore = require('./cloudstore');\r\nconst Model = require('../model');\r\n\r\nfunction convertVisualFilter(query, options) {\r\n  var inputs = options.queryParameters;\r\n\r\n  if (query.combinator !== undefined && query.rules !== undefined) {\r\n    if (query.rules.length === 0) return;\r\n    else if (query.rules.length === 1) return convertVisualFilter(query.rules[0], options);\r\n    else {\r\n      const _res = {};\r\n      const _op = '$' + query.combinator;\r\n      _res[_op] = [];\r\n      query.rules.forEach((r) => {\r\n        var cond = convertVisualFilter(r, options);\r\n        if (cond !== undefined) _res[_op].push(cond);\r\n      });\r\n\r\n      return _res;\r\n    }\r\n  } else if (query.operator === 'related to') {\r\n    var value = query.input !== undefined ? inputs[query.input] : undefined;\r\n    if (value === undefined) return;\r\n\r\n    return {\r\n      $relatedTo: {\r\n        object: {\r\n          __type: 'Pointer',\r\n          objectId: value,\r\n          className: query.relatedTo\r\n        },\r\n        key: query.relationProperty\r\n      }\r\n    };\r\n  } else {\r\n    const _res = {};\r\n    var cond;\r\n    var value = query.input !== undefined ? inputs[query.input] : query.value;\r\n\r\n    if (query.operator === 'exist') {\r\n      _res[query.property] = { $exists: true };\r\n      return _res;\r\n    } else if (query.operator === 'not exist') {\r\n      _res[query.property] = { $exists: false };\r\n      return _res;\r\n    }\r\n\r\n    if (value === undefined) return;\r\n\r\n    if (CloudStore._collections[options.collectionName])\r\n      var schema = CloudStore._collections[options.collectionName].schema;\r\n\r\n    var propertyType =\r\n      schema && schema.properties && schema.properties[query.property]\r\n        ? schema.properties[query.property].type\r\n        : undefined;\r\n\r\n    if (propertyType === 'Date') {\r\n      if (!(value instanceof Date)) value = new Date(value.toString());\r\n      value = { __type: 'Date', iso: value.toISOString() };\r\n    }\r\n\r\n    if (query.operator === 'greater than') cond = { $gt: value };\r\n    else if (query.operator === 'greater than or equal to') cond = { $gte: value };\r\n    else if (query.operator === 'less than') cond = { $lt: value };\r\n    else if (query.operator === 'less than or equal to') cond = { $lte: value };\r\n    else if (query.operator === 'equal to') cond = { $eq: value };\r\n    else if (query.operator === 'not equal to') cond = { $ne: value };\r\n    else if (query.operator === 'points to') {\r\n      var targetClass =\r\n        schema && schema.properties && schema.properties[query.property]\r\n          ? schema.properties[query.property].targetClass\r\n          : undefined;\r\n\r\n      cond = {\r\n        $eq: { __type: 'Pointer', objectId: value, className: targetClass }\r\n      };\r\n    } else if (query.operator === 'contain') {\r\n      cond = { $regex: value, $options: 'i' };\r\n    }\r\n\r\n    _res[query.property] = cond;\r\n\r\n    return _res;\r\n  }\r\n}\r\n\r\nfunction matchesQuery(model, query) {\r\n  var match = true;\r\n\r\n  if (query === undefined) return true;\r\n\r\n  if (query['$and'] !== undefined) {\r\n    query['$and'].forEach((q) => {\r\n      match &= matchesQuery(model, q);\r\n    });\r\n  } else if (query['$or'] !== undefined) {\r\n    match = false;\r\n    query['$or'].forEach((q) => {\r\n      match |= matchesQuery(model, q);\r\n    });\r\n  } else {\r\n    var keys = Object.keys(query);\r\n    keys.forEach((k) => {\r\n      if (k === 'objectId') {\r\n        if (query[k]['$eq'] !== undefined) match &= model.getId() === query[k]['$eq'];\r\n        else if (query[k]['$in'] !== undefined) match &= query[k]['$in'].indexOf(model.getId()) !== -1;\r\n      } else if (k === '$relatedTo') {\r\n        match = false; // cannot resolve relation queries locally\r\n      } else {\r\n        var value = model.get(k);\r\n        if (query[k]['$eq'] !== undefined && query[k]['$eq'].__type === 'Pointer')\r\n          match &= value === query[k]['$eq'].objectId;\r\n        else if (query[k]['$eq'] !== undefined) match &= value == query[k]['$eq'];\r\n        else if (query[k]['$ne'] !== undefined) match &= value != query[k]['$ne'];\r\n        else if (query[k]['$lt'] !== undefined) match &= value < query[k]['$lt'];\r\n        else if (query[k]['$lte'] !== undefined) match &= value <= query[k]['$lt'];\r\n        else if (query[k]['$gt'] !== undefined) match &= value > query[k]['$gt'];\r\n        else if (query[k]['$gte'] !== undefined) match &= value >= query[k]['$gte'];\r\n        else if (query[k]['$exists'] !== undefined) match &= value !== undefined;\r\n        else if (query[k]['$in'] !== undefined) match &= query[k]['$in'].indexOf(value) !== -1;\r\n        else if (query[k]['$nin'] !== undefined) match &= query[k]['$in'].indexOf(value) === -1;\r\n        else if (query[k]['$regex'] !== undefined)\r\n          match &= new RegExp(query[k]['$regex'], query[k]['$options']).test(value);\r\n      }\r\n    });\r\n  }\r\n  return match;\r\n}\r\n\r\nfunction compareObjects(sort, a, b) {\r\n  for (var i = 0; i < sort.length; i++) {\r\n    let _s = sort[i];\r\n    if (_s[0] === '-') {\r\n      // Descending\r\n      let prop = _s.substring(1);\r\n      if (a.get(prop) > b.get(prop)) return -1;\r\n      else if (a.get(prop) < b.get(prop)) return 1;\r\n    } else {\r\n      // Ascending\r\n      if (a.get(_s) > b.get(_s)) return 1;\r\n      else if (a.get(_s) < b.get(_s)) return -1;\r\n    }\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction convertVisualSorting(sorting) {\r\n  return sorting.map((s) => {\r\n    return (s.order === 'descending' ? '-' : '') + s.property;\r\n  });\r\n}\r\n\r\nfunction _value(v) {\r\n  if (v instanceof Date && typeof v.toISOString === 'function') {\r\n    return {\r\n      __type: 'Date',\r\n      iso: v.toISOString()\r\n    };\r\n  }\r\n  return v;\r\n}\r\n\r\n/**\r\n *\r\n * @param {Record<string, unknown>} filter\r\n * @param {{\r\n *   collectionName?: string;\r\n *   modelScope?: unknown;\r\n *   error: (error: string) => void;\r\n * }} options\r\n * @returns\r\n */\r\nfunction convertFilterOp(filter, options) {\r\n  const keys = Object.keys(filter);\r\n  if (keys.length === 0) return {};\r\n  if (keys.length !== 1) {\r\n    return options.error('Filter must only have one key found ' + keys.join(','));\r\n  }\r\n\r\n  const res = {};\r\n  const key = keys[0];\r\n  if (filter['and'] !== undefined && Array.isArray(filter['and'])) {\r\n    res['$and'] = filter['and'].map((f) => convertFilterOp(f, options));\r\n  } else if (filter['or'] !== undefined && Array.isArray(filter['or'])) {\r\n    res['$or'] = filter['or'].map((f) => convertFilterOp(f, options));\r\n  } else if (filter['idEqualTo'] !== undefined) {\r\n    res['objectId'] = { $eq: filter['idEqualTo'] };\r\n  } else if (filter['idContainedIn'] !== undefined) {\r\n    res['objectId'] = { $in: filter['idContainedIn'] };\r\n  } else if (filter['relatedTo'] !== undefined) {\r\n    const modelId = filter['relatedTo']['id'];\r\n    if (modelId === undefined) {\r\n      return options.error('Must provide id in relatedTo filter');\r\n    }\r\n\r\n    const relationKey = filter['relatedTo']['key'];\r\n    if (relationKey === undefined) {\r\n      return options.error('Must provide key in relatedTo filter');\r\n    }\r\n\r\n    const className = filter['relatedTo']['className'] || (options.modelScope || Model).get(modelId)?._class;\r\n    if (typeof className === 'undefined') {\r\n      // Either the pointer is loaded as an object or we allow passing in the className.\r\n      return options.error('Must preload the Pointer or include className');\r\n    }\r\n\r\n    res['$relatedTo'] = {\r\n      object: {\r\n        __type: 'Pointer',\r\n        objectId: modelId,\r\n        className\r\n      },\r\n      key: relationKey\r\n    };\r\n  } else if (typeof filter[key] === 'object') {\r\n    const opAndValue = filter[key];\r\n    if (opAndValue['equalTo'] !== undefined) res[key] = { $eq: _value(opAndValue['equalTo']) };\r\n    else if (opAndValue['notEqualTo'] !== undefined) res[key] = { $ne: _value(opAndValue['notEqualTo']) };\r\n    else if (opAndValue['lessThan'] !== undefined) res[key] = { $lt: _value(opAndValue['lessThan']) };\r\n    else if (opAndValue['greaterThan'] !== undefined) res[key] = { $gt: _value(opAndValue['greaterThan']) };\r\n    else if (opAndValue['lessThanOrEqualTo'] !== undefined)\r\n      res[key] = { $lte: _value(opAndValue['lessThanOrEqualTo']) };\r\n    else if (opAndValue['greaterThanOrEqualTo'] !== undefined)\r\n      res[key] = { $gte: _value(opAndValue['greaterThanOrEqualTo']) };\r\n    else if (opAndValue['exists'] !== undefined) res[key] = { $exists: opAndValue['exists'] };\r\n    else if (opAndValue['containedIn'] !== undefined) res[key] = { $in: opAndValue['containedIn'] };\r\n    else if (opAndValue['notContainedIn'] !== undefined) res[key] = { $nin: opAndValue['notContainedIn'] };\r\n    else if (opAndValue['pointsTo'] !== undefined) {\r\n      let schema = null;\r\n      if (CloudStore._collections[options.collectionName]) {\r\n        schema = CloudStore._collections[options.collectionName].schema;\r\n      }\r\n\r\n      const targetClass =\r\n        schema && schema.properties && schema.properties[key] ? schema.properties[key].targetClass : undefined;\r\n      const type = schema && schema.properties && schema.properties[key] ? schema.properties[key].type : undefined;\r\n\r\n      if (type === 'Relation') {\r\n        res[key] = {\r\n          __type: 'Pointer',\r\n          objectId: opAndValue['pointsTo'],\r\n          className: targetClass\r\n        };\r\n      } else {\r\n        if (Array.isArray(opAndValue['pointsTo'])) {\r\n          res[key] = {\r\n            $in: opAndValue['pointsTo'].map((v) => {\r\n              return { __type: 'Pointer', objectId: v, className: targetClass };\r\n            })\r\n          };\r\n        } else {\r\n          res[key] = {\r\n            $eq: {\r\n              __type: 'Pointer',\r\n              objectId: opAndValue['pointsTo'],\r\n              className: targetClass\r\n            }\r\n          };\r\n        }\r\n      }\r\n    } else if (opAndValue['matchesRegex'] !== undefined) {\r\n      res[key] = {\r\n        $regex: opAndValue['matchesRegex'],\r\n        $options: opAndValue['options']\r\n      };\r\n    } else if (opAndValue['text'] !== undefined && opAndValue['text']['search'] !== undefined) {\r\n      var _v = opAndValue['text']['search'];\r\n      if (typeof _v === 'string') res[key] = { $text: { $search: { $term: _v, $caseSensitive: false } } };\r\n      else\r\n        res[key] = {\r\n          $text: {\r\n            $search: {\r\n              $term: _v.term,\r\n              $language: _v.language,\r\n              $caseSensitive: _v.caseSensitive,\r\n              $diacriticSensitive: _v.diacriticSensitive\r\n            }\r\n          }\r\n        };\r\n      // Geo points\r\n    } else if (opAndValue['nearSphere'] !== undefined) {\r\n      var _v = opAndValue['nearSphere'];\r\n      res[key] = {\r\n        $nearSphere: {\r\n          __type: 'GeoPoint',\r\n          latitude: _v.latitude,\r\n          longitude: _v.longitude\r\n        },\r\n        $maxDistanceInMiles: _v.$maxDistanceInMiles,\r\n        $maxDistanceInKilometers: _v.maxDistanceInKilometers,\r\n        $maxDistanceInRadians: _v.maxDistanceInRadians\r\n      };\r\n    } else if (opAndValue['withinBox'] !== undefined) {\r\n      var _v = opAndValue['withinBox'];\r\n      res[key] = {\r\n        $within: {\r\n          $box: _v.map((gp) => ({\r\n            __type: 'GeoPoint',\r\n            latitude: gp.latitude,\r\n            longitude: gp.longitude\r\n          }))\r\n        }\r\n      };\r\n    } else if (opAndValue['withinPolygon'] !== undefined) {\r\n      var _v = opAndValue['withinPolygon'];\r\n      res[key] = {\r\n        $geoWithin: {\r\n          $polygon: _v.map((gp) => ({\r\n            __type: 'GeoPoint',\r\n            latitude: gp.latitude,\r\n            longitude: gp.longitude\r\n          }))\r\n        }\r\n      };\r\n    }\r\n  } else {\r\n    options.error('Unrecognized filter keys ' + keys.join(','));\r\n  }\r\n\r\n  return res;\r\n}\r\n\r\nmodule.exports = {\r\n  convertVisualFilter,\r\n  compareObjects,\r\n  matchesQuery,\r\n  convertVisualSorting,\r\n  convertFilterOp\r\n};\r\n","const CloudStore = require('./cloudstore');\r\nconst QueryUtils = require('./queryutils');\r\nconst Model = require('../model');\r\n\r\nfunction createRecordsAPI(modelScope) {\r\n  let _cloudstore;\r\n  const cloudstore = () => {\r\n    // We must create the cloud store just in time so all meta data is loaded\r\n    if (!_cloudstore) _cloudstore = new CloudStore(modelScope);\r\n    return _cloudstore;\r\n  };\r\n\r\n  return {\r\n    async query(className, query, options) {\r\n      if (typeof className === 'undefined') throw new Error(\"'className' is undefined\");\r\n      return new Promise((resolve, reject) => {\r\n        cloudstore().query({\r\n          collection: className,\r\n          where: QueryUtils.convertFilterOp(query || {}, {\r\n            collectionName: className,\r\n            error: (e) => reject(e),\r\n            modelScope\r\n          }),\r\n          limit: options ? options.limit : undefined,\r\n          sort: options ? options.sort : undefined,\r\n          skip: options ? options.skip : undefined,\r\n          include: options ? options.include : undefined,\r\n          select: options ? options.select : undefined,\r\n          count: options ? options.count : undefined,\r\n          success: (results, count) => {\r\n            const _results = results.map((r) => cloudstore()._fromJSON(r, className));\r\n            if (count !== undefined) resolve({ results: _results, count });\r\n            else resolve(_results);\r\n          },\r\n          error: (err) => {\r\n            reject(Error(err || 'Failed to query.'));\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n    async count(className, query) {\r\n      if (typeof className === 'undefined') throw new Error(\"'className' is undefined\");\r\n      return new Promise((resolve, reject) => {\r\n        cloudstore().count({\r\n          collection: className,\r\n          where: query\r\n            ? QueryUtils.convertFilterOp(query || {}, {\r\n                collectionName: className,\r\n                error: (e) => reject(e),\r\n                modelScope\r\n              })\r\n            : undefined,\r\n          success: (count) => {\r\n            resolve(count);\r\n          },\r\n          error: (err) => {\r\n            reject(Error(err || 'Failed to query.'));\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n    async distinct(className, property, query) {\r\n      if (typeof className === 'undefined') throw new Error(\"'className' is undefined\");\r\n      return new Promise((resolve, reject) => {\r\n        cloudstore().distinct({\r\n          collection: className,\r\n          property,\r\n          where: query\r\n            ? QueryUtils.convertFilterOp(query || {}, {\r\n                collectionName: className,\r\n                error: (e) => reject(e),\r\n                modelScope\r\n              })\r\n            : undefined,\r\n          success: (results) => {\r\n            resolve(results);\r\n          },\r\n          error: (err) => {\r\n            reject(Error(err || 'Failed to query.'));\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n    async aggregate(className, group, query) {\r\n      if (typeof className === 'undefined') throw new Error(\"'className' is undefined\");\r\n      return new Promise((resolve, reject) => {\r\n        cloudstore().aggregate({\r\n          collection: className,\r\n          group,\r\n          where: query\r\n            ? QueryUtils.convertFilterOp(query || {}, {\r\n                collectionName: className,\r\n                error: (e) => reject(e),\r\n                modelScope\r\n              })\r\n            : undefined,\r\n          success: (results) => {\r\n            resolve(results);\r\n          },\r\n          error: (err) => {\r\n            reject(Error(err || 'Failed to aggregate.'));\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param {string | { getId(): string; }} objectOrId\r\n     * @param {{\r\n     *    className: string;\r\n     *    keys?: string[] | string;\r\n     *    include?: string[] | string;\r\n     *    excludeKeys?: string[] | string;\r\n     * }} options\r\n     * @returns {Promise<unknown>}\r\n     */\r\n    async fetch(objectOrId, options) {\r\n      if (typeof objectOrId === 'undefined') return Promise.reject(new Error(\"'objectOrId' is undefined.\"));\r\n      if (typeof objectOrId !== 'string') objectOrId = objectOrId.getId();\r\n      const className = (options ? options.className : undefined) || (modelScope || Model).get(objectOrId)._class;\r\n\r\n      return new Promise((resolve, reject) => {\r\n        if (!className) {\r\n          return reject('No class name specified');\r\n        }\r\n\r\n        cloudstore().fetch({\r\n          collection: className,\r\n          objectId: objectOrId,\r\n          keys: options?.keys,\r\n          include: options?.include,\r\n          excludeKeys: options?.excludeKeys,\r\n          success: function (response) {\r\n            const record = cloudstore()._fromJSON(response, className);\r\n            resolve(record);\r\n          },\r\n          error: function (err) {\r\n            reject(Error(err || 'Failed to fetch.'));\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n    async increment(objectOrId, properties, options) {\r\n      if (typeof objectOrId === 'undefined') return Promise.reject(new Error(\"'objectOrId' is undefined.\"));\r\n      if (typeof objectOrId !== 'string') objectOrId = objectOrId.getId();\r\n      const className = (options ? options.className : undefined) || (modelScope || Model).get(objectOrId)._class;\r\n\r\n      return new Promise((resolve, reject) => {\r\n        if (!className) return reject('No class name specified');\r\n\r\n        cloudstore().increment({\r\n          collection: className,\r\n          objectId: objectOrId,\r\n          properties,\r\n          success: (response) => {\r\n            cloudstore()._fromJSON(Object.assign({ objectId: objectOrId }, response), className); // Update values\r\n\r\n            resolve();\r\n          },\r\n          error: (err) => {\r\n            reject(Error(err || 'Failed to increment.'));\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n    async save(objectOrId, properties, options) {\r\n      if (typeof objectOrId === 'undefined') return Promise.reject(new Error(\"'objectOrId' is undefined.\"));\r\n      if (typeof objectOrId !== 'string') objectOrId = objectOrId.getId();\r\n      const className = (options ? options.className : undefined) || (modelScope || Model).get(objectOrId)._class;\r\n\r\n      const model = (modelScope || Model).get(objectOrId);\r\n      if (properties) {\r\n        Object.keys(properties).forEach((p) => {\r\n          model.set(p, properties[p]);\r\n        });\r\n      }\r\n\r\n      return new Promise((resolve, reject) => {\r\n        if (!className) return reject('No class name specified');\r\n\r\n        cloudstore().save({\r\n          collection: className,\r\n          objectId: objectOrId,\r\n          data: properties || model.data,\r\n          acl: options ? options.acl : undefined,\r\n          success: (response) => {\r\n            cloudstore()._fromJSON(Object.assign({ objectId: objectOrId }, response), className); // Assign updated at\r\n            resolve();\r\n          },\r\n          error: (err) => {\r\n            reject(Error(err || 'Failed to save.'));\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n    async create(className, properties, options) {\r\n      if (typeof className === 'undefined') throw new Error(\"'className' is undefined\");\r\n      return new Promise((resolve, reject) => {\r\n        cloudstore().create({\r\n          collection: className,\r\n          data: properties,\r\n          acl: options ? options.acl : undefined,\r\n          success: (data) => {\r\n            // Successfully created\r\n            const m = cloudstore()._fromJSON(data, className);\r\n            resolve(m);\r\n          },\r\n          error: (err) => {\r\n            reject(Error(err || 'Failed to insert.'));\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n    async delete(objectOrId, options) {\r\n      if (typeof objectOrId === 'undefined') return Promise.reject(new Error(\"'objectOrId' is undefined.\"));\r\n      if (typeof objectOrId !== 'string') objectOrId = objectOrId.getId();\r\n      const className = (options ? options.className : undefined) || (modelScope || Model).get(objectOrId)._class;\r\n\r\n      return new Promise((resolve, reject) => {\r\n        if (!className) return reject('No class name specified');\r\n\r\n        cloudstore().delete({\r\n          collection: className,\r\n          objectId: objectOrId,\r\n          success: () => {\r\n            (modelScope || Model).get(objectOrId).notify('delete');\r\n            resolve();\r\n          },\r\n          error: (err) => {\r\n            reject(Error(err || 'Failed to delete.'));\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n    async addRelation(options) {\r\n      const recordId = options.recordId || options.record.getId();\r\n      const className = options.className || (modelScope || Model).get(recordId)._class;\r\n\r\n      const targetRecordId = options.targetRecordId || options.targetRecord.getId();\r\n      const targetClassName = options.targetClassName || (modelScope || Model).get(targetRecordId)._class;\r\n\r\n      return new Promise((resolve, reject) => {\r\n        if (!className) return reject('No class name specified');\r\n        if (!targetClassName) return reject('No target class name specified');\r\n\r\n        cloudstore().addRelation({\r\n          collection: className,\r\n          objectId: recordId,\r\n          key: options.key,\r\n          targetObjectId: targetRecordId,\r\n          targetClass: targetClassName,\r\n          success: (response) => {\r\n            resolve();\r\n          },\r\n          error: (err) => {\r\n            reject(Error(err || 'Failed to add relation.'));\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n    async removeRelation(options) {\r\n      const recordId = options.recordId || options.record.getId();\r\n      const className = options.className || (modelScope || Model).get(recordId)._class;\r\n\r\n      const targetRecordId = options.targetRecordId || options.targetRecord.getId();\r\n      const targetClassName = options.targetClassName || (modelScope || Model).get(targetRecordId)._class;\r\n\r\n      return new Promise((resolve, reject) => {\r\n        if (!className) return reject('No class name specified');\r\n        if (!targetClassName) return reject('No target class name specified');\r\n\r\n        cloudstore().removeRelation({\r\n          collection: className,\r\n          objectId: recordId,\r\n          key: options.key,\r\n          targetObjectId: targetRecordId,\r\n          targetClass: targetClassName,\r\n          success: (response) => {\r\n            resolve();\r\n          },\r\n          error: (err) => {\r\n            reject(Error(err || 'Failed to add relation.'));\r\n          }\r\n        });\r\n      });\r\n    }\r\n  };\r\n}\r\n\r\nmodule.exports = createRecordsAPI;\r\n","async function asyncPool(poolLimit, values, iteratorFn) {\r\n    const ret = [];\r\n    const executing = [];\r\n    for (const item of values) {\r\n      const p = Promise.resolve().then(() => iteratorFn(item, values));\r\n      ret.push(p);\r\n  \r\n      if (poolLimit <= values.length) {\r\n        const e = p.then(() => executing.splice(executing.indexOf(e), 1));\r\n        executing.push(e);\r\n        if (executing.length >= poolLimit) {\r\n          await Promise.race(executing);\r\n        }\r\n      }\r\n    }\r\n    \r\n    return Promise.all(ret);\r\n  }\r\n  \r\n  module.exports = asyncPool;","'use strict';\r\n\r\nvar Model = require('./model');\r\n\r\n// Get and set proxy\r\n/*const proxies = {}\r\nconst _collectionProxyHandler = {\r\n  get: function(target,prop,receiver) {\r\n    if(typeof target[prop] === 'function')\r\n      return target[prop].bind(target);\r\n    else if(prop === 'length')\r\n      return target.size()\r\n    else if(target.items[prop] !== undefined)\r\n      return target.get(prop)\r\n    else\r\n      return Reflect.get(target,prop,receiver)\r\n  },\r\n  set: function(obj,prop,value) {\r\n    if(prop === 'id') {\r\n      console.log(`Noodl.Object warning: id is readonly (Id is ${obj.id}, trying to set to ${value})`);\r\n      return true; //if a proxy doesn't return true an exception will be thrown\r\n    }\r\n    else\r\n      return Reflect.set(target,prop,receiver)\r\n  }\r\n}\r\n\r\nfunction Collection(id) {\r\n  this.id = id;\r\n  this.items = [];\r\n}\r\n\r\nvar collections = Collection._collections = {};\r\n\r\nCollection.create = function(items) {\r\n  const name = Model.guid();\r\n  collections[name] = new Collection(name);\r\n  if(items) {\r\n    collections[name].set(items);\r\n  }\r\n  return collections[name];\r\n}\r\n\r\nCollection.get = function(name) {\r\n  if(name === undefined) name = Model.guid();\r\n  if(!collections[name]) {\r\n    collections[name] = new Collection(name);\r\n    proxies[name] = new Proxy(collections[name],_collectionProxyHandler);\r\n  }\r\n  return proxies[name];\r\n}\r\n\r\nCollection.instanceOf = function(collection) {\r\n  return collection && (collection instanceof Collection || collection.target instanceof Collection);\r\n}\r\n\r\nCollection.exists = function(name) {\r\n  return collections[name] !== undefined;\r\n}\r\n\r\nCollection.prototype.getId = function() {\r\n  return this.id;\r\n}\r\n\r\nCollection.prototype.on = function(event,listener) {\r\n  if(!this.listeners) this.listeners = {};\r\n  if(!this.listeners[event]) this.listeners[event] = [];\r\n  this.listeners[event].push(listener);\r\n}\r\n\r\nCollection.prototype.off = function(event,listener) {\r\n  if(!this.listeners) return;\r\n  if(!this.listeners[event]) return;\r\n  var idx = this.listeners[event].indexOf(listener);\r\n  if(idx!==-1) this.listeners[event].splice(idx,1);\r\n}\r\n\r\nCollection.prototype.notify = async function(event,args) {\r\n  if(!this.listeners) return;\r\n  if(!this.listeners[event]) return;\r\n  \r\n  var l = this.listeners[event].slice(); //clone in case listeners array is modified in the callbacks\r\n  for(var i = 0; i < l.length; i++) {\r\n    await l[i](args);\r\n  }  \r\n}\r\n\r\nCollection.prototype.set = function(src) {\r\n  var length,i;\r\n  \r\n  if(src === this) return;\r\n  \r\n  function keyIndex(a) {\r\n    var keys = {};\r\n    var length = a.length;\r\n    for(var i = 0; i < length; i++) {   \r\n      var item = a[i];  \r\n      keys[item.getId()] = item;\r\n    }\r\n    return keys;\r\n  }\r\n  \r\n  // Src can be a collection, or an array\r\n  var src = Collection.instanceOf(src)?src.items:src;\r\n  var bItems = [];\r\n  length = src.length;\r\n  for(i = 0; i < length; i++) {\r\n    var item = src[i];\r\n    if(Model.instanceOf(item))\r\n      bItems.push(item);\r\n    else\r\n      bItems.push(Model.create(item));\r\n  }\r\n  \r\n  var aItems = this.items;  \r\n  var aKeys = keyIndex(aItems);\r\n  var bKeys = keyIndex(bItems);\r\n  \r\n  // First remove all items not in the new collection\r\n  length = aItems.length;\r\n  for(i = 0; i < length; i++) {\r\n    if(!bKeys.hasOwnProperty(aItems[i].getId())) {\r\n      // This item is not present in new collection, remove it\r\n      this.removeAtIndex(i);\r\n      i--;\r\n      length--;\r\n    }\r\n  }\r\n  \r\n  // Reorder items\r\n  for(i = 0; i < Math.min(aItems.length,bItems.length); i++) {\r\n    if(aItems[i] !== bItems[i]) {\r\n      if(aKeys.hasOwnProperty(bItems[i].getId())) { \r\n        // The bItem exist in the collection but is in the wrong place\r\n        this.remove(bItems[i]);\r\n      }\r\n\r\n      // This is a new item, add it at correct index\r\n      this.addAtIndex(bItems[i],i);\r\n    }  \r\n  }\r\n  \r\n  // Add remaining items\r\n  for(i = aItems.length; i < bItems.length; i++) {\r\n    this.add(bItems[i]);\r\n  }\r\n      \r\n}\r\n\r\nCollection.prototype.contains = function(item) {\r\n  return this.items.indexOf(item)!==-1;\r\n}\r\n\r\nCollection.prototype.add = async function(item) {\r\n  if(this.contains(item)) return; // Already contains item\r\n  \r\n  this.items.push(item);\r\n  await this.notify('add',{item:item,index:this.items.length-1});\r\n  await this.notify('change');\r\n  await item.notify('add',{collection:this});\r\n}\r\n\r\nCollection.prototype.addAtIndex = async function(item,index) {\r\n  if(this.contains(item)) return; // Already contains item\r\n\r\n  this.items.splice(index,0,item);\r\n  await this.notify('add',{item:item,index:index});\r\n  await this.notify('change');\r\n  await item.notify('add',{collection:this,index:index});\r\n}\r\n\r\nCollection.prototype.removeAtIndex = async function(idx) {\r\n  var item = this.items[idx];\r\n  this.items.splice(idx,1);\r\n  await this.notify('remove',{item:item,index:idx});\r\n  await this.notify('change');\r\n  await item.notify('remove',{collection:this});  \r\n}\r\n\r\nCollection.prototype.remove = function(item) {\r\n  var idx = this.items.indexOf(item);\r\n  if(idx !== -1) this.removeAtIndex(idx);\r\n}\r\n\r\nCollection.prototype.size = function() {\r\n  return this.items.length;\r\n}\r\n\r\nCollection.prototype.get = function(index) {\r\n  return this.items[index];\r\n}\r\n\r\nCollection.prototype.each = function(callback) {\r\n  for(var i = 0; i < this.items.length; i++) {\r\n    callback(this.items[i],i);\r\n  }\r\n}\r\n\r\nCollection.prototype.forEach = Collection.prototype.each;\r\n\r\nCollection.prototype.map = function(fn) {\r\n  return this.items.map(fn);\r\n}\r\n\r\nCollection.prototype.filter = function(fn) {\r\n  return this.items.filter(fn);\r\n}\r\n\r\nCollection.prototype.find = function(predicate, thisArg) {\r\n  return this.items.find(predicate, thisArg);\r\n}\r\n\r\nCollection.prototype.findIndex = function(predicate, thisArg) {\r\n  return this.items.findIndex(predicate, thisArg);\r\n}   \r\n\r\nCollection.prototype.toJSON = function() {\r\n  return this.map(function(m) {\r\n      return m.toJSON()\r\n  })\r\n}*/\r\n\r\n// ----\r\nObject.defineProperty(Array.prototype, 'items', {\r\n  enumerable: false,\r\n  get() {\r\n    return this;\r\n  },\r\n  set(data) {\r\n    this.set(data);\r\n  }\r\n});\r\nObject.defineProperty(Array.prototype, 'each', {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: Array.prototype.forEach\r\n});\r\nObject.defineProperty(Array.prototype, 'size', {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: function () {\r\n    return this.length;\r\n  }\r\n});\r\nObject.defineProperty(Array.prototype, 'get', {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: function (index) {\r\n    return this[index];\r\n  }\r\n});\r\nObject.defineProperty(Array.prototype, 'getId', {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: function () {\r\n    return this._id;\r\n  }\r\n});\r\nObject.defineProperty(Array.prototype, 'id', {\r\n  enumerable: false,\r\n  get() {\r\n    return this.getId();\r\n  }\r\n});\r\nObject.defineProperty(Array.prototype, 'set', {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: function (src) {\r\n    var length, i;\r\n\r\n    if (src === this) return;\r\n\r\n    src = src || []; //handle if src is undefined\r\n\r\n    function keyIndex(a) {\r\n      var keys = {};\r\n      var length = a.length;\r\n      for (var i = 0; i < length; i++) {\r\n        var item = a[i];\r\n        keys[item.getId()] = item;\r\n      }\r\n      return keys;\r\n    }\r\n\r\n    // Src can be a collection, or an array\r\n    var bItems = [];\r\n    length = src.length;\r\n    for (i = 0; i < length; i++) {\r\n      var item = src[i];\r\n      if (Model.instanceOf(item)) bItems.push(item);\r\n      else bItems.push(Model.create(item));\r\n    }\r\n\r\n    var aItems = this.items;\r\n    var aKeys = keyIndex(aItems);\r\n    var bKeys = keyIndex(bItems);\r\n\r\n    // First remove all items not in the new collection\r\n    length = aItems.length;\r\n    for (i = 0; i < length; i++) {\r\n      if (!bKeys.hasOwnProperty(aItems[i].getId())) {\r\n        // This item is not present in new collection, remove it\r\n        this.removeAtIndex(i);\r\n        i--;\r\n        length--;\r\n      }\r\n    }\r\n\r\n    // Reorder items\r\n    for (i = 0; i < Math.min(aItems.length, bItems.length); i++) {\r\n      if (aItems[i] !== bItems[i]) {\r\n        if (aKeys.hasOwnProperty(bItems[i].getId())) {\r\n          // The bItem exist in the collection but is in the wrong place\r\n          this.remove(bItems[i]);\r\n        }\r\n\r\n        // This is a new item, add it at correct index\r\n        this.addAtIndex(bItems[i], i);\r\n      }\r\n    }\r\n\r\n    // Add remaining items\r\n    for (i = aItems.length; i < bItems.length; i++) {\r\n      this.add(bItems[i]);\r\n    }\r\n  }\r\n});\r\n\r\nObject.defineProperty(Array.prototype, 'notify', {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: async function (event, args) {\r\n    if (!this._listeners) return;\r\n    if (!this._listeners[event]) return;\r\n\r\n    var l = this._listeners[event].slice(); //clone in case listeners array is modified in the callbacks\r\n    for (var i = 0; i < l.length; i++) {\r\n      await l[i](args);\r\n    }\r\n  }\r\n});\r\n\r\nObject.defineProperty(Array.prototype, 'contains', {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: function (item) {\r\n    return this.indexOf(item) !== -1;\r\n  }\r\n});\r\n\r\nObject.defineProperty(Array.prototype, 'add', {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: async function (item) {\r\n    if (this.contains(item)) return; // Already contains item\r\n\r\n    this.items.push(item);\r\n    await this.notify('add', { item: item, index: this.items.length - 1 });\r\n    await this.notify('change');\r\n    await item.notify('add', { collection: this });\r\n  }\r\n});\r\n\r\nObject.defineProperty(Array.prototype, 'remove', {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: function (item) {\r\n    var idx = this.items.indexOf(item);\r\n    if (idx !== -1) this.removeAtIndex(idx);\r\n  }\r\n});\r\n\r\nObject.defineProperty(Array.prototype, 'addAtIndex', {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: async function (item, index) {\r\n    if (this.contains(item)) return; // Already contains item\r\n\r\n    this.items.splice(index, 0, item);\r\n    await this.notify('add', { item: item, index: index });\r\n    await this.notify('change');\r\n    await item.notify('add', { collection: this, index: index });\r\n  }\r\n});\r\n\r\nObject.defineProperty(Array.prototype, 'removeAtIndex', {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: async function (idx) {\r\n    var item = this.items[idx];\r\n    this.items.splice(idx, 1);\r\n    await this.notify('remove', { item: item, index: idx });\r\n    await this.notify('change');\r\n    await item.notify('remove', { collection: this });\r\n  }\r\n});\r\n\r\nObject.defineProperty(Array.prototype, 'on', {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: function (event, listener) {\r\n    if (!this._listeners)\r\n      Object.defineProperty(this, '_listeners', {\r\n        enumerable: false,\r\n        writable: false,\r\n        value: {}\r\n      });\r\n    if (!this._listeners[event]) this._listeners[event] = [];\r\n    this._listeners[event].push(listener);\r\n  }\r\n});\r\n\r\nObject.defineProperty(Array.prototype, 'off', {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: function (event, listener) {\r\n    if (!this._listeners) return;\r\n    if (!this._listeners[event]) return;\r\n    var idx = this._listeners[event].indexOf(listener);\r\n    if (idx !== -1) this._listeners[event].splice(idx, 1);\r\n  }\r\n});\r\n\r\nclass Collection extends Array {}\r\n\r\nconst collections = (Collection._collections = {});\r\n\r\nCollection.create = function (items) {\r\n  const name = Model.guid();\r\n  collections[name] = new Collection();\r\n  Object.defineProperty(collections[name], '_id', {\r\n    enumerable: false,\r\n    writable: false,\r\n    value: name\r\n  });\r\n  if (items) {\r\n    collections[name].set(items);\r\n  }\r\n  return collections[name];\r\n};\r\n\r\n/**\r\n * @param {string} name\r\n * @returns {Collection}\r\n */\r\nCollection.get = function (name) {\r\n  if (name === undefined) name = Model.guid();\r\n  if (!collections[name]) {\r\n    collections[name] = new Collection();\r\n    Object.defineProperty(collections[name], '_id', {\r\n      enumerable: false,\r\n      writable: false,\r\n      value: name\r\n    });\r\n  }\r\n\r\n  return collections[name];\r\n};\r\n\r\nCollection.instanceOf = function (collection) {\r\n  return collection instanceof Collection;\r\n};\r\n\r\nCollection.exists = function (name) {\r\n  return collections[name] !== undefined;\r\n};\r\n\r\nmodule.exports = Collection;\r\n","\"use strict\";\r\n\r\nfunction createSetter(args) {\r\n\r\n    var currentValue = false;\r\n\r\n    return function(value) {\r\n        value = value ? true : false;\r\n        //value changed from false to true\r\n        if(value && currentValue === false) {\r\n            args.valueChangedToTrue.call(this);\r\n        }\r\n        currentValue = value;\r\n    };\r\n}\r\n\r\nmodule.exports = {\r\n    createSetter: createSetter\r\n};","//used to optimize warnings so we're not sending unneccessary warnings.\r\n//Improves editor performance, especially in larger projects\r\n\r\nclass ActiveWarnings {\r\n  constructor() {\r\n    this.currentWarnings = new Map();\r\n  }\r\n\r\n  setWarning(nodeId, key, warning) {\r\n    //Check if we've already sent this warning\r\n    if (this.currentWarnings.has(nodeId)) {\r\n      //we have sent warnings to this node before, check if we've sent this particular one before\r\n      const warningKeys = this.currentWarnings.get(nodeId);\r\n      if (warningKeys[key] === warning) {\r\n        //we've already sent this warning, no need to send it again\r\n        return false;\r\n      }\r\n\r\n      //new warning, remember that we sent it\r\n      warningKeys[key] = warning;\r\n      return true;\r\n    } else {\r\n      //new warning, we havent sent any warnings to this node before\r\n      //Remember that we sent it\r\n      this.currentWarnings.set(nodeId, { [key]: warning });\r\n      return true;\r\n    }\r\n  }\r\n\r\n  clearWarning(nodeId, key) {\r\n    const warningKeys = this.currentWarnings.get(nodeId);\r\n\r\n    if (!warningKeys || !warningKeys[key]) {\r\n      //There are no warnings that we've sent on this node.\r\n      //Save some performance by not sending an uneccesary message to the editor\r\n      return false;\r\n    }\r\n\r\n    delete warningKeys[key];\r\n    if (Object.keys(warningKeys).length === 0) {\r\n      delete this.currentWarnings.delete(nodeId);\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  clearWarnings(nodeId) {\r\n    if (this.currentWarnings.has(nodeId) === false) {\r\n      //no warnings on this node, save some performance by not sending a message to the editor\r\n      return false;\r\n    }\r\n\r\n    //no warnings for this node anymore\r\n    this.currentWarnings.delete(nodeId);\r\n    return true;\r\n  }\r\n}\r\n\r\nmodule.exports = ActiveWarnings;\r\n","'use strict';\r\n\r\nvar EventSender = require('./eventsender'),\r\n  Services = require('./services/services'),\r\n  guid = require('./guid');\r\n\r\nconst ActiveWarnings = require('./editorconnection.activewarnings');\r\nfunction EditorConnection(opts) {\r\n  var _opts = opts || {};\r\n\r\n  EventSender.call(this);\r\n\r\n  this.runtimeType = _opts.runtimeType;\r\n  this.platform = _opts.platform;\r\n  this.ws =\r\n    (_opts.platform && _opts.platform.webSocketClass) || (typeof WebSocket !== 'undefined' ? WebSocket : undefined);\r\n  this.wsOptions = (_opts.platform && _opts.platform.webSocketOptions) || undefined;\r\n  this.reconnectOnClose = true;\r\n  this.enableDebugger = false;\r\n\r\n  this.lastSendTimestamp = 0;\r\n  this.sendQueue = [];\r\n  this.sendTimer = undefined;\r\n\r\n  //used to optimize warnings so we're not sending unneccessary warnings.\r\n  //Clan slow down the editor in large projects\r\n  this.activeWarnings = new ActiveWarnings();\r\n}\r\n\r\nEditorConnection.prototype = Object.create(EventSender.prototype);\r\nEditorConnection.prototype.constructor = EditorConnection;\r\n\r\nEditorConnection.prototype.isRunningLocally = function () {\r\n  var runningLocallyInBrowser =\r\n    (this.platform.isRunningLocally && this.platform.isRunningLocally()) ||\r\n    (typeof document !== 'undefined' &&\r\n      (document.location.hostname === 'localhost' || document.location.hostname === '127.0.0.1'));\r\n  return runningLocallyInBrowser;\r\n};\r\n\r\nEditorConnection.prototype.connect = function (address) {\r\n  this.socket = this.wsOptions ? new this.ws(address, this.wsOptions) : new this.ws(address);\r\n\r\n  var self = this;\r\n\r\n  this.socket.addEventListener('open', function () {\r\n    self.clientId = guid();\r\n    self.socket.send(\r\n      JSON.stringify({\r\n        cmd: 'register',\r\n        type: 'viewer',\r\n        clientId: self.clientId\r\n      })\r\n    );\r\n    self.emit('connected');\r\n  });\r\n\r\n  this.socket.addEventListener('close', function (event) {\r\n    if (self.reconnectOnClose) {\r\n      self.reconnect(address);\r\n    }\r\n    console.log('Editor connection closed', event.code, event.reason);\r\n    self.emit('connectionClosed');\r\n  });\r\n\r\n  this.socket.addEventListener('error', function (evt) {\r\n    console.log('Editor connection error, trying to reconnect');\r\n  });\r\n\r\n  this.socket.addEventListener('message', async (e) => {\r\n    // NOTE: When the data is too big it seems to change from string to a blob\r\n    const text = typeof e.data === 'string' ? e.data : await e.data.text();\r\n    const message = JSON.parse(text);\r\n\r\n    let content;\r\n\r\n    if (message.cmd === 'registered') {\r\n      //ignore\r\n    } else if (message.cmd === 'export') {\r\n      content = JSON.parse(message.content);\r\n      if (message.type === 'full' && message.target === this.clientId) {\r\n        self.emit('exportDataFull', content);\r\n      }\r\n    } else if (message.cmd === 'hoverStart') {\r\n      self.emit('hoverStart', message.content.id);\r\n    } else if (message.cmd === 'hoverEnd') {\r\n      self.emit('hoverEnd', message.content.id);\r\n    } else if (message.cmd === 'refresh') {\r\n      self.emit('reload');\r\n    } else if (message.cmd === 'debugInspectors') {\r\n      if (this.debugInspectorsEnabled) {\r\n        content = JSON.parse(message.content);\r\n        self.emit('debugInspectorsUpdated', content.inspectors);\r\n      }\r\n    } else if (message.cmd === 'debuggingEnabled') {\r\n      if (self.isRunningLocally()) {\r\n        content = JSON.parse(message.content);\r\n        self.emit('debuggingEnabledChanged', content.enabled);\r\n      }\r\n    } else if (message.cmd === 'getConnectionValue') {\r\n      if (self.isRunningLocally()) {\r\n        content = JSON.parse(message.content);\r\n        await self.emit('getConnectionValue', { clientId: content.clientId, connectionId: content.connectionId });\r\n      }\r\n    } else if (message.cmd === 'modelUpdate') {\r\n      await self.emit('modelUpdate', message.content);\r\n    } else if (message.cmd === 'publish') {\r\n      Services.pubsub.routeMessage(message); // Publish a message from the pubsub service\r\n    } else if (message.cmd === 'noodlModules') {\r\n      self.emit('noodlModules', JSON.parse(message.content));\r\n    } else if (message.cmd === 'mqttUpdate') {\r\n      self.emit('mqttUpdate', message.content);\r\n    } else if (message.cmd === 'activeComponentChanged') {\r\n      self.emit('activeComponentChanged', message.component);\r\n    } else {\r\n      console.log('Command not implemented', message);\r\n    }\r\n  });\r\n};\r\n\r\nEditorConnection.prototype.reconnect = function (address) {\r\n  var self = this;\r\n\r\n  setTimeout(function () {\r\n    self.connect(address);\r\n  }, 2000);\r\n};\r\n\r\nEditorConnection.prototype.isConnected = function () {\r\n  return this.socket !== undefined && this.socket.readyState === this.ws.OPEN;\r\n};\r\n\r\n//JSON replacer to make cyclic objects non-cyclic.\r\n//Using this example: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Errors/Cyclic_object_value#examples\r\nconst getCircularReplacer = () => {\r\n  const seen = new WeakSet();\r\n  return (key, value) => {\r\n    if (typeof value === 'object' && value !== null) {\r\n      if (seen.has(value)) {\r\n        return '[Circular]';\r\n      }\r\n      seen.add(value);\r\n    }\r\n    return value;\r\n  };\r\n};\r\n\r\nEditorConnection.prototype.send = function (data) {\r\n  const now = this.platform.getCurrentTime();\r\n  const dt = now - this.lastSendTimestamp;\r\n\r\n  //Send objects as json and capture exceptions\r\n  const trySend = (msg) => {\r\n    try {\r\n      this.socket.send(JSON.stringify(msg));\r\n    } catch (e) {\r\n      if (e.message && e.message.startsWith('Converting circular')) {\r\n        //the object is circular, try to address it\r\n        try {\r\n          this.socket.send(JSON.stringify(msg, getCircularReplacer()));\r\n        } catch (e) {\r\n          //still failed, give up\r\n          console.log('failed to send message to editor', msg, e);\r\n        }\r\n      } else {\r\n        //message couldn't be serialized to json\r\n        console.log('failed to send message to editor', msg, e);\r\n      }\r\n    }\r\n  };\r\n\r\n  //batch messages so they're only sent at most every 200ms\r\n  //note that the first message will always be sent immediately, and the ones for 200ms after\r\n  //that one will be queued. So initial message response time is as low as possible (for hover etc)\r\n  if (dt < 200 || this.sendTimer || !this.isConnected()) {\r\n    this.sendQueue.push(data);\r\n    if (!this.sendTimer) {\r\n      this.sendTimer = setTimeout(() => {\r\n        if (this.isConnected() === false) {\r\n          return;\r\n        }\r\n\r\n        //send messages in chunks. If we send too many at once the editor UI can freeze for a while\r\n        //since it's handling these in the renderer process\r\n        const chunkSize = 50;\r\n        for (let i = 0; i < this.sendQueue.length; i += chunkSize) {\r\n          const chunk = this.sendQueue.slice(i, i + chunkSize);\r\n          trySend(chunk);\r\n        }\r\n\r\n        this.sendQueue = [];\r\n        this.sendTimer = undefined;\r\n        this.lastSendTimestamp = this.platform.getCurrentTime();\r\n      }, 100);\r\n    }\r\n  } else {\r\n    this.lastSendTimestamp = now;\r\n    trySend(data);\r\n  }\r\n};\r\n\r\nEditorConnection.prototype.sendInspectId = function (id) {\r\n  this.send({\r\n    cmd: 'select',\r\n    type: 'viewer',\r\n    content: JSON.stringify({ id: id })\r\n  });\r\n};\r\n\r\nEditorConnection.prototype.sendSelectComponent = function (componentName) {\r\n  this.send({\r\n    cmd: 'select',\r\n    type: 'viewer',\r\n    content: JSON.stringify({ componentName })\r\n  });\r\n};\r\n\r\nEditorConnection.prototype.sendPulsingConnections = function (connectionMap) {\r\n  var connectionsToPulse = [];\r\n  Object.keys(connectionMap).forEach(function (c) {\r\n    var connection = connectionMap[c];\r\n    connectionsToPulse = connectionsToPulse.concat(connection.connections);\r\n  });\r\n\r\n  this.send({\r\n    cmd: 'connectiondebugpulse',\r\n    type: 'viewer',\r\n    content: JSON.stringify({\r\n      connectionsToPulse: connectionsToPulse\r\n    })\r\n  });\r\n};\r\n\r\nEditorConnection.prototype.sendDebugInspectorValues = function (inspectors) {\r\n  this.send({\r\n    cmd: 'debuginspectorvalues',\r\n    type: 'viewer',\r\n    content: { inspectors }\r\n  });\r\n};\r\n\r\nEditorConnection.prototype.sendConnectionValue = function (connectionId, value) {\r\n  this.send({\r\n    cmd: 'connectionValue',\r\n    type: 'viewer',\r\n    content: { connectionId, value }\r\n  });\r\n};\r\n\r\nconst dynamicPortsHash = {};\r\n\r\nfunction _detectRename(before, after) {\r\n  if (!before || !after) return;\r\n\r\n  if (before.length !== after.length) return; // Must be of same length\r\n\r\n  var res = {};\r\n  for (var i = 0; i < before.length; i++) {\r\n    if (after.indexOf(before[i]) === -1) {\r\n      if (res.before) return; // Can only be one from before that is missing\r\n      res.before = before[i];\r\n    }\r\n\r\n    if (before.indexOf(after[i]) === -1) {\r\n      if (res.after) return; // Only one can be missing,otherwise we cannot match\r\n      res.after = after[i];\r\n    }\r\n  }\r\n\r\n  return res.before && res.after ? res : undefined;\r\n}\r\n\r\nEditorConnection.prototype.sendDynamicPorts = function (id, ports, options) {\r\n  var hash = JSON.stringify(ports);\r\n  if (dynamicPortsHash[id] === hash) {\r\n    // Make sure we don't resend the same port data\r\n    return;\r\n  }\r\n\r\n  if (dynamicPortsHash[id] && ports && options && options.detectRenamed) {\r\n    var detectRenamed = Array.isArray(options.detectRenamed) ? options.detectRenamed : [options.detectRenamed];\r\n\r\n    var renamed = [];\r\n    detectRenamed.forEach((d) => {\r\n      var before = JSON.parse(dynamicPortsHash[id]),\r\n        after = [].concat(ports);\r\n\r\n      // Filter ports with correct prefix and plug\r\n      if (d.prefix) {\r\n        before = before.filter((p) => p.name.startsWith(d.prefix));\r\n        after = after.filter((p) => p.name.startsWith(d.prefix));\r\n      }\r\n\r\n      if (d.plug) {\r\n        before = before.filter((p) => p.plug === d.plug);\r\n        after = after.filter((p) => p.plug === d.plug);\r\n      }\r\n\r\n      // Remove the prefix\r\n      after = after.map((p) => p.name.substring((d.prefix || '').length));\r\n      before = before.map((p) => p.name.substring((d.prefix || '').length));\r\n\r\n      // Find the one that is renamed (if any)\r\n      var res = _detectRename(before, after);\r\n      if (res) {\r\n        renamed.push({\r\n          plug: d.plug,\r\n          patterns: [(d.prefix || '') + '{{*}}'],\r\n          before: res.before,\r\n          after: res.after\r\n        });\r\n      }\r\n    });\r\n    if (renamed.length > 0) options.renamed = renamed;\r\n\r\n    delete options.detectRenamed;\r\n  }\r\n\r\n  dynamicPortsHash[id] = hash;\r\n\r\n  this.send({\r\n    cmd: 'instanceports',\r\n    type: 'viewer',\r\n    content: JSON.stringify({\r\n      nodeid: id,\r\n      ports: ports,\r\n      options: options\r\n    })\r\n  });\r\n};\r\n\r\nEditorConnection.prototype.sendWarning = function (componentName, nodeId, key, warning) {\r\n  const isNewWarning = this.activeWarnings.setWarning(nodeId, key, warning);\r\n\r\n  if (isNewWarning) {\r\n    this.send({\r\n      cmd: 'showwarning',\r\n      type: 'viewer',\r\n      content: JSON.stringify({\r\n        componentName: componentName,\r\n        nodeId: nodeId,\r\n        key: key,\r\n        warning: warning\r\n      })\r\n    });\r\n  }\r\n};\r\n\r\nEditorConnection.prototype.clearWarning = function (componentName, nodeId, key) {\r\n  const hasWarning = this.activeWarnings.clearWarning(nodeId, key);\r\n\r\n  if (hasWarning) {\r\n    this.send({\r\n      cmd: 'showwarning',\r\n      type: 'viewer',\r\n      content: JSON.stringify({\r\n        componentName: componentName,\r\n        nodeId: nodeId,\r\n        key: key,\r\n        warning: undefined\r\n      })\r\n    });\r\n  }\r\n};\r\n\r\nEditorConnection.prototype.clearWarnings = function (componentName, nodeId) {\r\n  const hasWarnings = this.activeWarnings.clearWarnings(nodeId);\r\n\r\n  if (hasWarnings) {\r\n    this.send({\r\n      cmd: 'clearwarnings',\r\n      type: 'viewer',\r\n      content: JSON.stringify({\r\n        componentName: componentName,\r\n        nodeId: nodeId\r\n      })\r\n    });\r\n  }\r\n};\r\n\r\nEditorConnection.prototype.sendPatches = function (patches) {\r\n  this.send({\r\n    cmd: 'patchproject',\r\n    type: 'viewer',\r\n    content: JSON.stringify(patches)\r\n  });\r\n};\r\n\r\nEditorConnection.prototype.requestFullExport = function () {\r\n  this.send({\r\n    cmd: 'register',\r\n    type: 'viewer'\r\n  });\r\n};\r\n\r\nEditorConnection.prototype.requestNoodlModules = function () {\r\n  this.send({\r\n    cmd: 'getNoodlModules',\r\n    type: 'viewer'\r\n  });\r\n};\r\n\r\nvar serviceRequests = {};\r\nEditorConnection.prototype.sendServiceRequest = function (request, callback) {\r\n  request.token = guid();\r\n  request.clientId = this.clientId;\r\n  serviceRequests[request.token] = callback;\r\n  this.send(request);\r\n};\r\n\r\nEditorConnection.prototype.close = function () {\r\n  this.reconnectOnClose = false;\r\n\r\n  if (this.isConnected() === false) {\r\n    return;\r\n  }\r\n\r\n  this.socket.close();\r\n};\r\n\r\nEditorConnection.prototype.sendNodeLibrary = function (nodelibrary) {\r\n  this.send({\r\n    cmd: 'nodelibrary',\r\n    type: 'viewer',\r\n    runtimeType: this.runtimeType,\r\n    content: nodelibrary,\r\n    clientId: this.clientId\r\n  });\r\n};\r\n\r\nEditorConnection.prototype.sendComponentMetadata = function (componentName, key, data) {\r\n  this.send({\r\n    cmd: 'componentMetadata',\r\n    type: 'viewer',\r\n    content: JSON.stringify({\r\n      componentName,\r\n      key,\r\n      data\r\n    })\r\n  });\r\n};\r\n\r\nEditorConnection.prototype.sendProjectMetadata = function (key, data) {\r\n  this.send({\r\n    cmd: 'projectMetadata',\r\n    type: 'viewer',\r\n    content: JSON.stringify({\r\n      key,\r\n      data\r\n    })\r\n  });\r\n};\r\n\r\nmodule.exports = EditorConnection;\r\n","\"use strict\";\r\n\r\nfunction difference(array1, array2) {\r\n    const valueSet = new Set(array2);\r\n    return array1.filter(e => !valueSet.has(e));\r\n}\r\n\r\nasync function handleEvent(context, graphModel, event) {\r\n\r\n    function applyPortDelta(nodeModel, newPorts) {\r\n        var inputPorts = {};\r\n        var outputPorts = {};\r\n\r\n        newPorts.forEach(function(port) {\r\n            //some ports are incorrectly named outputs instead of output, patch it here so\r\n            //the rest of the code doesn't need to care\r\n            if(port && port.plug === \"outputs\") {\r\n              port.plug = \"output\";\r\n            }\r\n\r\n            if(port.plug === 'input' || port.plug === 'input/output') {\r\n                inputPorts[port.name] = port;\r\n            }\r\n            if(port.plug === 'output' || port.plug === 'input/output') {\r\n                outputPorts[port.name] = port;\r\n            }\r\n        });\r\n\r\n        var existingInputs = Object.keys(nodeModel.getInputPorts());\r\n\r\n        var inputPortsToRemove = difference(existingInputs, Object.keys(inputPorts));\r\n        var inputPortsToAdd = difference(Object.keys(inputPorts), existingInputs);\r\n        \r\n        // Update port types if it has changed\r\n        nodeModel.updateInputPortTypes(inputPorts);\r\n\r\n        // Remove and add input ports\r\n        inputPortsToRemove.forEach(nodeModel.removeInputPortWithName.bind(nodeModel));\r\n        inputPortsToAdd.forEach(function(portName) {\r\n            nodeModel.addInputPort(inputPorts[portName]);\r\n            if(nodeModel.parameters && nodeModel.parameters.hasOwnProperty(portName)) {\r\n                setInputValueOnNodeInstancesWithModel(context.rootComponent.nodeScope, nodeModel, portName, nodeModel.parameters[portName]);\r\n            }\r\n        });\r\n\r\n        // Update port types if it has changed\r\n        nodeModel.updateOutputPortTypes(outputPorts);\r\n\r\n        // Remove and add output ports\r\n        var existingOutputs = Object.keys(nodeModel.getOutputPorts());\r\n\r\n        var outputPortsToRemove = difference(existingOutputs, Object.keys(outputPorts));\r\n        var outputPortsToAdd = difference(Object.keys(outputPorts), existingOutputs);\r\n\r\n        outputPortsToRemove.forEach(nodeModel.removeOutputPortWithName.bind(nodeModel));\r\n        outputPortsToAdd.forEach(function(portName) {\r\n            nodeModel.addOutputPort(outputPorts[portName]);\r\n        });\r\n    }\r\n\r\n    function setInputValueOnNodeInstancesWithModel(nodeScope, nodeModel, port, value) {\r\n        var nodes = nodeScope.getNodesWithIdRecursive(nodeModel.id);\r\n        nodes.forEach(function(node) {\r\n            node.queueInput(port, value);\r\n        });\r\n    }\r\n\r\n    var componentModel;\r\n    if(event.componentName) {\r\n        componentModel = graphModel.getComponentWithName(event.componentName);\r\n        if(!componentModel) {\r\n            //if we haven't received this component yet, just ignore the delta update\r\n            return;\r\n        }\r\n    }\r\n\r\n    //some ports are incorrectly named outputs instead of output, patch it here so\r\n    //the rest of the code doesn't need to care\r\n    if(event.port && event.port.plug === \"outputs\") {\r\n        event.port.plug = \"output\";\r\n    }\r\n\r\n    var eventHandlers = {\r\n        nodeAdded: function(event) {\r\n            componentModel.importEditorNodeData(event.model, event.parentId, event.childIndex);\r\n        },\r\n        nodeRemoved: async function(event) {\r\n            if(componentModel.hasNodeWithId(event.model.id)) {\r\n                await componentModel.removeNodeWithId(event.model.id);\r\n            }\r\n        },\r\n        connectionAdded: function(event) {\r\n            componentModel.addConnection(event.model);\r\n        },\r\n        connectionRemoved: function(event) {\r\n            componentModel.removeConnection(event.model);\r\n\r\n            //revert to default value or parameter if this was the last connection to that port\r\n            var targetNodeModel = componentModel.getNodeWithId(event.model.targetId);\r\n            if(componentModel.getConnectionsToPort(targetNodeModel.id, event.model.targetId).length === 0) {\r\n                var value = targetNodeModel.parameters[event.model.targetPort];\r\n                if(value === undefined) {\r\n                    value = context.getDefaultValueForInput(targetNodeModel.type, event.model.targetPort);\r\n                }\r\n\r\n                setInputValueOnNodeInstancesWithModel(context.rootComponent.nodeScope, targetNodeModel, event.model.targetPort, value);\r\n            }\r\n\r\n        },\r\n        parameterChanged: function(event) {\r\n\r\n            const nodeModel = componentModel.getNodeWithId(event.nodeId);\r\n            if(nodeModel === undefined) {\r\n                console.log(\"parameterChanged: Unknown node id\",event);\r\n                return;\r\n            }\r\n\r\n            //did we get a bunch of parameters at once?\r\n            if(event.parameters) {\r\n                //note: some props might be deleted, then they only exist in oldParameters\r\n                const allParams = new Set(Object.keys(event.parameters).concat(Object.keys(event.oldParameters)));\r\n                for(const param of allParams) {\r\n                    nodeModel.setParameter(param, event.parameters[param]);\r\n                }\r\n            }\r\n            \r\n            //did we get a single parameters?\r\n            if(event.parameterName) {\r\n                nodeModel.setParameter(event.parameterName, event.parameterValue, event.state);\r\n            }\r\n        },\r\n        nodeAttached: function(event) {\r\n            componentModel.setNodeParent(componentModel.getNodeWithId(event.nodeId), componentModel.getNodeWithId(event.parentId), event.childIndex);\r\n        },\r\n        nodeDetached: function(event) {\r\n            componentModel.setNodeParent(componentModel.getNodeWithId(event.nodeId), null);\r\n            componentModel.addRootId(event.nodeId);\r\n        },\r\n        componentAdded: function(event) {\r\n            graphModel.importComponentFromEditorData(event.model);\r\n        },\r\n        componentRemoved: async function(event) {\r\n            await graphModel.removeComponentWithName(event.componentName);\r\n        },\r\n        rootAdded: function(event) {\r\n            componentModel.addRootId(event.nodeId);\r\n        },\r\n        portAdded: function(event) {\r\n            var nodeModel = componentModel.getNodeWithId(event.nodeId);\r\n            if(event.port.plug === \"input\" || event.port.plug === \"input/output\") {\r\n                nodeModel.addInputPort(event.port);\r\n\r\n                //if node already has an old value for this port, set that value on all instances of the node\r\n                //example: expression a+b, a=1, b=2. User removes b and then adds it again, the value 2 should be restored since it's still in the model\r\n                if(nodeModel.parameters.hasOwnProperty(event.port)) {\r\n                    setInputValueOnNodeInstancesWithModel(context.rootComponent.nodeScope, nodeModel, event.port, nodeModel.parameters[event.port]);\r\n                }\r\n            }\r\n            if(event.port.plug === \"output\" || event.port.plug === \"input/output\") {\r\n                nodeModel.addOutputPort(event.port);\r\n            }\r\n        },\r\n        portRemoved: function(event) {\r\n            var nodeModel = componentModel.getNodeWithId(event.nodeId);\r\n            if(event.port.plug === \"input\" || event.port.plug === \"input/output\") {\r\n                nodeModel.removeInputPortWithName(event.port.name);\r\n            }\r\n            if(event.port.plug === \"output\" || event.port.plug === \"input/output\") {\r\n                nodeModel.removeOutputPortWithName(event.port.name);\r\n            }\r\n        },\r\n        nodePortRenamed: function(event) {\r\n            if(event.port.plug === \"input\" || event.port.plug === \"input/output\") {\r\n                componentModel.renameInputPortOnNodeWithId(event.nodeId, event.oldName, event.port.name);\r\n            }\r\n            if(event.port.plug === \"output\" || event.port.plug === \"input/output\") {\r\n                componentModel.renameOutputPortOnNodeWithId(event.nodeId, event.oldName, event.port.name);\r\n            }\r\n            var node = componentModel.getNodeWithId(event.nodeId);\r\n            if(node.type === \"Component Inputs\") {\r\n                componentModel.addInputPort(event.port);\r\n                graphModel.getNodesWithType(componentModel.name).forEach(function(componentInstance) {\r\n                    componentInstance.component.renameInputPortOnNodeWithId(componentInstance.id, event.oldName, event.port.name);\r\n                });\r\n                componentModel.removeInputPortWithName(event.oldName);\r\n            }\r\n            else if(node.type === \"Component Outputs\") {\r\n                componentModel.addOutputPort(event.port);\r\n                graphModel.getNodesWithType(componentModel.name).forEach(function(componentInstance) {\r\n                    componentInstance.component.renameOutputPortOnNodeWithId(componentInstance.id, event.oldName, event.port.name);\r\n                });\r\n                componentModel.removeOutputPortWithName(event.oldName);\r\n            }\r\n        },\r\n        componentPortsUpdated: function(event) {\r\n            applyPortDelta(componentModel, event.ports);\r\n        },\r\n        instancePortsChanged: function(event) {\r\n            if(!componentModel.hasNodeWithId(event.nodeId)) return;\r\n            var nodeModel = componentModel.getNodeWithId(event.nodeId);\r\n            applyPortDelta(nodeModel, event.ports);\r\n        },\r\n        componentRenamed: function(event) {\r\n            graphModel.renameComponent(event.oldName, event.newName);\r\n        },\r\n        settingsChanged: function(event) {\r\n            graphModel.setSettings(event.settings);\r\n        },\r\n        metadataChanged: function(event) {\r\n            graphModel.setMetaData(event.key,event.data);\r\n        },\r\n        componentMetadataChanged: function(event) {\r\n            const c = graphModel.getComponentWithName(event.componentName);\r\n            if(!c) return;\r\n            c.setMetadata(event.key, event.data);\r\n        },\r\n        variantParametersChanged: function(event) {\r\n            if(event.variant) {\r\n                //we got the whole variant\r\n                graphModel.updateVariant(event.variant);\r\n            }\r\n            else {\r\n                //we got a specific value to update\r\n                graphModel.updateVariantParameter(event.variantName, event.variantTypeName, event.parameterName, event.parameterValue, event.state);\r\n\r\n                //check if value has been deleted from the variant\r\n                if(event.parameterValue === undefined) {\r\n                    //all active nodes with this variant will have to revert back to the default value, if they don't have local overrides\r\n                    const variant = graphModel.getVariant(event.variantTypeName, event.variantName);\r\n                    const nodes = context.rootComponent.nodeScope.getAllNodesWithVariantRecursive(variant);\r\n                    nodes.forEach(node => {\r\n                        node.queueInput(event.parameterName, node.getParameter(event.parameterName));\r\n                    });\r\n                }\r\n            }\r\n        },\r\n        variantDeleted: function(event) {\r\n            graphModel.deleteVariant(event.variantTypeName, event.variantName);\r\n        },\r\n        variantChanged: function(event) {\r\n            const nodeModel = componentModel.getNodeWithId(event.nodeId);\r\n            const variant = graphModel.getVariant(nodeModel.type, event.variantName);\r\n\r\n            nodeModel.setVariant(variant);\r\n        },\r\n        variantRenamed: function(event) {\r\n            const variant = graphModel.getVariant(event.variantTypeName, event.oldVariantName);\r\n            if(variant) {\r\n                variant.name = variant.variantName;\r\n            }\r\n        },\r\n        defaultStateTransitionChanged: function(event) {\r\n            const nodeModel = componentModel.getNodeWithId(event.nodeId);\r\n            nodeModel.setDefaultStateTransition(event.curve, event.state);\r\n        },\r\n        stateTransitionsChanged: function(event) {\r\n            const nodeModel = componentModel.getNodeWithId(event.nodeId);\r\n            if(event.parameterName) {\r\n                nodeModel.setStateTransitionParamter(event.parameterName, event.curve, event.state);\r\n            }            \r\n        },\r\n        variantDefaultStateTransitionChanged: function(event) {\r\n            graphModel.updateVariantDefaultStateTransition(event.variantName, event.variantTypeName, event.curve, event.state);\r\n        },\r\n        variantStateTransitionsChanged: function(event) {\r\n            graphModel.updateVariantStateTransition(event);\r\n        },\r\n        routerIndexChanged: function(event) {\r\n            graphModel.routerIndex = event.data;\r\n        }\r\n    };\r\n\r\n    if(eventHandlers.hasOwnProperty(event.type)) {\r\n        await eventHandlers[event.type](event);\r\n        context.scheduleUpdate();\r\n    }\r\n    else {\r\n        console.log('Unknown event', event);\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    handleEvent: handleEvent\r\n};\r\n","// Copyright Joyent, Inc. and other Node contributors.\r\n//\r\n// Permission is hereby granted, free of charge, to any person obtaining a\r\n// copy of this software and associated documentation files (the\r\n// \"Software\"), to deal in the Software without restriction, including\r\n// without limitation the rights to use, copy, modify, merge, publish,\r\n// distribute, sublicense, and/or sell copies of the Software, and to permit\r\n// persons to whom the Software is furnished to do so, subject to the\r\n// following conditions:\r\n//\r\n// The above copyright notice and this permission notice shall be included\r\n// in all copies or substantial portions of the Software.\r\n//\r\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\r\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\r\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\r\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\r\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\r\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\r\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\r\n\r\n'use strict';\r\n\r\nvar R = typeof Reflect === 'object' ? Reflect : null\r\nvar ReflectApply = R && typeof R.apply === 'function'\r\n  ? R.apply\r\n  : function ReflectApply(target, receiver, args) {\r\n    return Function.prototype.apply.call(target, receiver, args);\r\n  }\r\n\r\nvar ReflectOwnKeys\r\nif (R && typeof R.ownKeys === 'function') {\r\n  ReflectOwnKeys = R.ownKeys\r\n} else if (Object.getOwnPropertySymbols) {\r\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\r\n    return Object.getOwnPropertyNames(target)\r\n      .concat(Object.getOwnPropertySymbols(target));\r\n  };\r\n} else {\r\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\r\n    return Object.getOwnPropertyNames(target);\r\n  };\r\n}\r\n\r\nfunction ProcessEmitWarning(warning) {\r\n  if (console && console.warn) console.warn(warning);\r\n}\r\n\r\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\r\n  return value !== value;\r\n}\r\n\r\nfunction EventEmitter() {\r\n  EventEmitter.init.call(this);\r\n}\r\nmodule.exports = EventEmitter;\r\nmodule.exports.once = once;\r\n\r\n// Backwards-compat with node 0.10.x\r\nEventEmitter.EventEmitter = EventEmitter;\r\n\r\nEventEmitter.prototype._events = undefined;\r\nEventEmitter.prototype._eventsCount = 0;\r\nEventEmitter.prototype._maxListeners = undefined;\r\n\r\n// By default EventEmitters will print a warning if more than 10 listeners are\r\n// added to it. This is a useful default which helps finding memory leaks.\r\nvar defaultMaxListeners = 10;\r\n\r\nfunction checkListener(listener) {\r\n  if (typeof listener !== 'function') {\r\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\r\n  }\r\n}\r\n\r\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\r\n  enumerable: true,\r\n  get: function() {\r\n    return defaultMaxListeners;\r\n  },\r\n  set: function(arg) {\r\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\r\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\r\n    }\r\n    defaultMaxListeners = arg;\r\n  }\r\n});\r\n\r\nEventEmitter.init = function() {\r\n\r\n  if (this._events === undefined ||\r\n      this._events === Object.getPrototypeOf(this)._events) {\r\n    this._events = Object.create(null);\r\n    this._eventsCount = 0;\r\n  }\r\n\r\n  this._maxListeners = this._maxListeners || undefined;\r\n};\r\n\r\n// Obviously not all Emitters should be limited to 10. This function allows\r\n// that to be increased. Set to zero for unlimited.\r\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\r\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\r\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\r\n  }\r\n  this._maxListeners = n;\r\n  return this;\r\n};\r\n\r\nfunction _getMaxListeners(that) {\r\n  if (that._maxListeners === undefined)\r\n    return EventEmitter.defaultMaxListeners;\r\n  return that._maxListeners;\r\n}\r\n\r\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\r\n  return _getMaxListeners(this);\r\n};\r\n\r\nEventEmitter.prototype.emit = function emit(type) {\r\n  var args = [];\r\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\r\n  var doError = (type === 'error');\r\n\r\n  var events = this._events;\r\n  if (events !== undefined)\r\n    doError = (doError && events.error === undefined);\r\n  else if (!doError)\r\n    return false;\r\n\r\n  // If there is no 'error' event listener then throw.\r\n  if (doError) {\r\n    var er;\r\n    if (args.length > 0)\r\n      er = args[0];\r\n    if (er instanceof Error) {\r\n      // Note: The comments on the `throw` lines are intentional, they show\r\n      // up in Node's output if this results in an unhandled exception.\r\n      throw er; // Unhandled 'error' event\r\n    }\r\n    // At least give some kind of context to the user\r\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\r\n    err.context = er;\r\n    throw err; // Unhandled 'error' event\r\n  }\r\n\r\n  var handler = events[type];\r\n\r\n  if (handler === undefined)\r\n    return false;\r\n\r\n  if (typeof handler === 'function') {\r\n    ReflectApply(handler, this, args);\r\n  } else {\r\n    var len = handler.length;\r\n    var listeners = arrayClone(handler, len);\r\n    for (var i = 0; i < len; ++i)\r\n      ReflectApply(listeners[i], this, args);\r\n  }\r\n\r\n  return true;\r\n};\r\n\r\nfunction _addListener(target, type, listener, prepend) {\r\n  var m;\r\n  var events;\r\n  var existing;\r\n\r\n  checkListener(listener);\r\n\r\n  events = target._events;\r\n  if (events === undefined) {\r\n    events = target._events = Object.create(null);\r\n    target._eventsCount = 0;\r\n  } else {\r\n    // To avoid recursion in the case that type === \"newListener\"! Before\r\n    // adding it to the listeners, first emit \"newListener\".\r\n    if (events.newListener !== undefined) {\r\n      target.emit('newListener', type,\r\n                  listener.listener ? listener.listener : listener);\r\n\r\n      // Re-assign `events` because a newListener handler could have caused the\r\n      // this._events to be assigned to a new object\r\n      events = target._events;\r\n    }\r\n    existing = events[type];\r\n  }\r\n\r\n  if (existing === undefined) {\r\n    // Optimize the case of one listener. Don't need the extra array object.\r\n    existing = events[type] = listener;\r\n    ++target._eventsCount;\r\n  } else {\r\n    if (typeof existing === 'function') {\r\n      // Adding the second element, need to change to array.\r\n      existing = events[type] =\r\n        prepend ? [listener, existing] : [existing, listener];\r\n      // If we've already got an array, just append.\r\n    } else if (prepend) {\r\n      existing.unshift(listener);\r\n    } else {\r\n      existing.push(listener);\r\n    }\r\n\r\n    // Check for listener leak\r\n    m = _getMaxListeners(target);\r\n    if (m > 0 && existing.length > m && !existing.warned) {\r\n      existing.warned = true;\r\n      // No error code for this since it is a Warning\r\n      // eslint-disable-next-line no-restricted-syntax\r\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\r\n                          existing.length + ' ' + String(type) + ' listeners ' +\r\n                          'added. Use emitter.setMaxListeners() to ' +\r\n                          'increase limit');\r\n      w.name = 'MaxListenersExceededWarning';\r\n      w.emitter = target;\r\n      w.type = type;\r\n      w.count = existing.length;\r\n      ProcessEmitWarning(w);\r\n    }\r\n  }\r\n\r\n  return target;\r\n}\r\n\r\nEventEmitter.prototype.addListener = function addListener(type, listener) {\r\n  return _addListener(this, type, listener, false);\r\n};\r\n\r\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\r\n\r\nEventEmitter.prototype.prependListener =\r\n    function prependListener(type, listener) {\r\n      return _addListener(this, type, listener, true);\r\n    };\r\n\r\nfunction onceWrapper() {\r\n  if (!this.fired) {\r\n    this.target.removeListener(this.type, this.wrapFn);\r\n    this.fired = true;\r\n    if (arguments.length === 0)\r\n      return this.listener.call(this.target);\r\n    return this.listener.apply(this.target, arguments);\r\n  }\r\n}\r\n\r\nfunction _onceWrap(target, type, listener) {\r\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\r\n  var wrapped = onceWrapper.bind(state);\r\n  wrapped.listener = listener;\r\n  state.wrapFn = wrapped;\r\n  return wrapped;\r\n}\r\n\r\nEventEmitter.prototype.once = function once(type, listener) {\r\n  checkListener(listener);\r\n  this.on(type, _onceWrap(this, type, listener));\r\n  return this;\r\n};\r\n\r\nEventEmitter.prototype.prependOnceListener =\r\n    function prependOnceListener(type, listener) {\r\n      checkListener(listener);\r\n      this.prependListener(type, _onceWrap(this, type, listener));\r\n      return this;\r\n    };\r\n\r\n// Emits a 'removeListener' event if and only if the listener was removed.\r\nEventEmitter.prototype.removeListener =\r\n    function removeListener(type, listener) {\r\n      var list, events, position, i, originalListener;\r\n\r\n      checkListener(listener);\r\n\r\n      events = this._events;\r\n      if (events === undefined)\r\n        return this;\r\n\r\n      list = events[type];\r\n      if (list === undefined)\r\n        return this;\r\n\r\n      if (list === listener || list.listener === listener) {\r\n        if (--this._eventsCount === 0)\r\n          this._events = Object.create(null);\r\n        else {\r\n          delete events[type];\r\n          if (events.removeListener)\r\n            this.emit('removeListener', type, list.listener || listener);\r\n        }\r\n      } else if (typeof list !== 'function') {\r\n        position = -1;\r\n\r\n        for (i = list.length - 1; i >= 0; i--) {\r\n          if (list[i] === listener || list[i].listener === listener) {\r\n            originalListener = list[i].listener;\r\n            position = i;\r\n            break;\r\n          }\r\n        }\r\n\r\n        if (position < 0)\r\n          return this;\r\n\r\n        if (position === 0)\r\n          list.shift();\r\n        else {\r\n          spliceOne(list, position);\r\n        }\r\n\r\n        if (list.length === 1)\r\n          events[type] = list[0];\r\n\r\n        if (events.removeListener !== undefined)\r\n          this.emit('removeListener', type, originalListener || listener);\r\n      }\r\n\r\n      return this;\r\n    };\r\n\r\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\r\n\r\nEventEmitter.prototype.removeAllListeners =\r\n    function removeAllListeners(type) {\r\n      var listeners, events, i;\r\n\r\n      events = this._events;\r\n      if (events === undefined)\r\n        return this;\r\n\r\n      // not listening for removeListener, no need to emit\r\n      if (events.removeListener === undefined) {\r\n        if (arguments.length === 0) {\r\n          this._events = Object.create(null);\r\n          this._eventsCount = 0;\r\n        } else if (events[type] !== undefined) {\r\n          if (--this._eventsCount === 0)\r\n            this._events = Object.create(null);\r\n          else\r\n            delete events[type];\r\n        }\r\n        return this;\r\n      }\r\n\r\n      // emit removeListener for all listeners on all events\r\n      if (arguments.length === 0) {\r\n        var keys = Object.keys(events);\r\n        var key;\r\n        for (i = 0; i < keys.length; ++i) {\r\n          key = keys[i];\r\n          if (key === 'removeListener') continue;\r\n          this.removeAllListeners(key);\r\n        }\r\n        this.removeAllListeners('removeListener');\r\n        this._events = Object.create(null);\r\n        this._eventsCount = 0;\r\n        return this;\r\n      }\r\n\r\n      listeners = events[type];\r\n\r\n      if (typeof listeners === 'function') {\r\n        this.removeListener(type, listeners);\r\n      } else if (listeners !== undefined) {\r\n        // LIFO order\r\n        for (i = listeners.length - 1; i >= 0; i--) {\r\n          this.removeListener(type, listeners[i]);\r\n        }\r\n      }\r\n\r\n      return this;\r\n    };\r\n\r\nfunction _listeners(target, type, unwrap) {\r\n  var events = target._events;\r\n\r\n  if (events === undefined)\r\n    return [];\r\n\r\n  var evlistener = events[type];\r\n  if (evlistener === undefined)\r\n    return [];\r\n\r\n  if (typeof evlistener === 'function')\r\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\r\n\r\n  return unwrap ?\r\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\r\n}\r\n\r\nEventEmitter.prototype.listeners = function listeners(type) {\r\n  return _listeners(this, type, true);\r\n};\r\n\r\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\r\n  return _listeners(this, type, false);\r\n};\r\n\r\nEventEmitter.listenerCount = function(emitter, type) {\r\n  if (typeof emitter.listenerCount === 'function') {\r\n    return emitter.listenerCount(type);\r\n  } else {\r\n    return listenerCount.call(emitter, type);\r\n  }\r\n};\r\n\r\nEventEmitter.prototype.listenerCount = listenerCount;\r\nfunction listenerCount(type) {\r\n  var events = this._events;\r\n\r\n  if (events !== undefined) {\r\n    var evlistener = events[type];\r\n\r\n    if (typeof evlistener === 'function') {\r\n      return 1;\r\n    } else if (evlistener !== undefined) {\r\n      return evlistener.length;\r\n    }\r\n  }\r\n\r\n  return 0;\r\n}\r\n\r\nEventEmitter.prototype.eventNames = function eventNames() {\r\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\r\n};\r\n\r\nfunction arrayClone(arr, n) {\r\n  var copy = new Array(n);\r\n  for (var i = 0; i < n; ++i)\r\n    copy[i] = arr[i];\r\n  return copy;\r\n}\r\n\r\nfunction spliceOne(list, index) {\r\n  for (; index + 1 < list.length; index++)\r\n    list[index] = list[index + 1];\r\n  list.pop();\r\n}\r\n\r\nfunction unwrapListeners(arr) {\r\n  var ret = new Array(arr.length);\r\n  for (var i = 0; i < ret.length; ++i) {\r\n    ret[i] = arr[i].listener || arr[i];\r\n  }\r\n  return ret;\r\n}\r\n\r\nfunction once(emitter, name) {\r\n  return new Promise(function (resolve, reject) {\r\n    function errorListener(err) {\r\n      emitter.removeListener(name, resolver);\r\n      reject(err);\r\n    }\r\n\r\n    function resolver() {\r\n      if (typeof emitter.removeListener === 'function') {\r\n        emitter.removeListener('error', errorListener);\r\n      }\r\n      resolve([].slice.call(arguments));\r\n    };\r\n\r\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\r\n    if (name !== 'error') {\r\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\r\n    }\r\n  });\r\n}\r\n\r\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\r\n  if (typeof emitter.on === 'function') {\r\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\r\n  }\r\n}\r\n\r\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\r\n  if (typeof emitter.on === 'function') {\r\n    if (flags.once) {\r\n      emitter.once(name, listener);\r\n    } else {\r\n      emitter.on(name, listener);\r\n    }\r\n  } else if (typeof emitter.addEventListener === 'function') {\r\n    // EventTarget does not have `error` event semantics like Node\r\n    // EventEmitters, we do not listen for `error` events here.\r\n    emitter.addEventListener(name, function wrapListener(arg) {\r\n      // IE does not have builtin `{ once: true }` support so we\r\n      // have to do it manually.\r\n      if (flags.once) {\r\n        emitter.removeEventListener(name, wrapListener);\r\n      }\r\n      listener(arg);\r\n    });\r\n  } else {\r\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\r\n  }\r\n}","'use strict';\r\n\r\nfunction EventSender() {\r\n  this.listeners = {};\r\n  this.listenersWithRefs = {};\r\n}\r\n\r\nEventSender.prototype.on = function (eventName, callback, ref) {\r\n  if (ref) {\r\n    if (!this.listenersWithRefs.hasOwnProperty(eventName)) {\r\n      this.listenersWithRefs[eventName] = new Map();\r\n    }\r\n\r\n    if (!this.listenersWithRefs[eventName].get(ref)) {\r\n      this.listenersWithRefs[eventName].set(ref, []);\r\n    }\r\n\r\n    this.listenersWithRefs[eventName].get(ref).push(callback);\r\n  } else {\r\n    if (!this.listeners.hasOwnProperty(eventName)) {\r\n      this.listeners[eventName] = [];\r\n    }\r\n\r\n    this.listeners[eventName].push(callback);\r\n  }\r\n};\r\n\r\nEventSender.prototype.removeListenersWithRef = function (ref) {\r\n  Object.keys(this.listenersWithRefs).forEach((eventName) => {\r\n    const listeners = this.listenersWithRefs[eventName];\r\n    if (listeners.has(ref)) {\r\n      listeners.delete(ref);\r\n    }\r\n  });\r\n};\r\n\r\nEventSender.prototype.removeAllListeners = function (eventName) {\r\n  if (eventName) {\r\n    delete this.listeners[eventName];\r\n    delete this.listenersWithRefs[eventName];\r\n  } else {\r\n    this.listeners = {};\r\n    this.listenersWithRefs = {};\r\n  }\r\n};\r\n\r\nEventSender.prototype.emit = async function (eventName, data) {\r\n  const array = this.listeners[eventName];\r\n\r\n  if (array) {\r\n    for (let i = 0; i < array.length; i++) {\r\n      const callback = array[i];\r\n      await Promise.resolve(callback.call(null, data));\r\n    }\r\n  }\r\n\r\n  const map = this.listenersWithRefs[eventName];\r\n\r\n  if (map) {\r\n    for (const [ref, callbacks] of map) {\r\n      for (const callback of callbacks) {\r\n        await Promise.resolve(callback.call(ref, data));\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = EventSender;\r\n","//adapted from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\r\nfunction guid() {\r\n    function s4() {\r\n        return Math.floor((1 + Math.random()) * 0x10000) .toString(16) .substring(1);\r\n    }\r\n    return s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\r\n}\r\n\r\nmodule.exports = guid;\r\n","'use strict';\r\n\r\nconst Model = require('./model');\r\nconst { getAbsoluteUrl } = require('./utils');\r\n\r\nvar userFunctionsCache = {};\r\n\r\nfunction JavascriptNodeParser(code, options) {\r\n  this.inputs = {};\r\n  this.outputs = {};\r\n  this.error = undefined;\r\n  this.code = code;\r\n\r\n  const node = options ? options.node : undefined;\r\n  this._initializeAPIs();\r\n\r\n  var userCode = userFunctionsCache[code];\r\n  if (!userCode) {\r\n    try {\r\n      userCode = new Function(['define', 'script', 'Node', 'Component'], JavascriptNodeParser.getCodePrefix() + code);\r\n      userFunctionsCache[code] = userCode;\r\n    } catch (e) {\r\n      this.error = e.message;\r\n      console.error(e);\r\n    }\r\n  }\r\n  if (userCode) {\r\n    try {\r\n      userCode(\r\n        this.define.bind(this),\r\n        this.script.bind(this),\r\n        this.apis.Node,\r\n        node ? JavascriptNodeParser.getComponentScopeForNode(node) : {}\r\n      ); //noodlJavascriptAPI);\r\n\r\n      this._afterSourced();\r\n    } catch (e) {\r\n      this.error = e.message;\r\n      console.error(e);\r\n    }\r\n  }\r\n}\r\n\r\n// First generation API\r\nJavascriptNodeParser.prototype.define = function (userObject) {\r\n  this.inputs = userObject.inputs || {};\r\n  this.outputs = userObject.outputs || {};\r\n  this.setup = userObject.setup;\r\n  this.change = userObject.run || userObject.change;\r\n  this.destroy = userObject.destroy;\r\n\r\n  this.definedObject = userObject;\r\n};\r\n\r\n// Second generation API\r\nfunction _scriptExtend(_this) {\r\n  var _extended = {\r\n    inputs: _this.inputs || {},\r\n    outputs: _this.outputs || {},\r\n\r\n    setup: function (inputs, outputs) {\r\n      this.inputs = inputs;\r\n      this.outputs = outputs;\r\n\r\n      this.setOutputs = function (states) {\r\n        for (var key in states) {\r\n          this.outputs[key] = states[key];\r\n          this.flagOutputDirty(key);\r\n        }\r\n      };\r\n\r\n      if (_this.methods) {\r\n        for (var key in _this.methods) {\r\n          this[key] = _this.methods[key];\r\n        }\r\n      }\r\n\r\n      _this.setup && _this.setup.apply(this);\r\n    },\r\n\r\n    destroy: function (inputs, outputs) {\r\n      this.inputs = inputs;\r\n      this.outputs = outputs;\r\n\r\n      _this.destroy && _this.destroy.apply(this);\r\n    },\r\n\r\n    change: function (inputs, outputs) {\r\n      this.inputs = inputs;\r\n      this.outputs = outputs;\r\n\r\n      // Detect property changed\r\n      var old = this._oldInputs || {};\r\n\r\n      if (_this.changed) {\r\n        for (var key in inputs) {\r\n          if (inputs[key] !== old[key]) {\r\n            var changedFunction = _this.changed[key];\r\n            if (typeof changedFunction === 'function') changedFunction.apply(this, [inputs[key], old[key]]);\r\n          }\r\n        }\r\n      }\r\n\r\n      this._oldInputs = Object.assign({}, inputs);\r\n    }\r\n  };\r\n\r\n  if (_this.signals) {\r\n    for (var key in _this.signals) {\r\n      _extended[key] = _this.signals[key];\r\n\r\n      _extended.inputs[key] = 'signal';\r\n    }\r\n  }\r\n\r\n  return _extended;\r\n}\r\n\r\nJavascriptNodeParser.prototype.script = function (userObject) {\r\n  var _userObjectExtended = _scriptExtend(userObject);\r\n  this.inputs = _userObjectExtended.inputs || {};\r\n  this.outputs = _userObjectExtended.outputs || {};\r\n  this.setup = _userObjectExtended.setup;\r\n  this.change = _userObjectExtended.run || _userObjectExtended.change;\r\n  this.destroy = _userObjectExtended.destroy;\r\n\r\n  this.definedObject = _userObjectExtended;\r\n};\r\n\r\n// Third generation API\r\n\r\n// Node.Setters.Hej = function(value) {...}\r\n// Node.OnInputsChanged = function() {...}\r\n// Node.Signals.Hej = function(value) {...}\r\n// Node.OnInit = function() {...}\r\n// Node.OnDestroy = function() {...}\r\n// Node.Inputs.A\r\n// Node.Outputs.A = 10;\r\n// Node.Outputs.Done()\r\n// Node.setOutputs({...})\r\n// Component.Object, Component.ParentObject\r\nJavascriptNodeParser.prototype._initializeAPIs = function () {\r\n  this.apis = {};\r\n\r\n  this.apis.Node = {\r\n    Inputs: {},\r\n    Outputs: {},\r\n    Signals: {},\r\n    Setters: {}\r\n  };\r\n};\r\n\r\nJavascriptNodeParser.prototype._afterSourced = function () {\r\n  if (this.definedObject !== undefined) return; // a legacy API have been used\r\n\r\n  var _Node = this.apis.Node;\r\n\r\n  // Merge inputs and outputs from node extension\r\n  this.inputs = Object.assign({}, _Node.Inputs || {});\r\n  this.outputs = Object.assign({}, _Node.Outputs || {});\r\n\r\n  this.setup = function (inputs, outputs) {\r\n    const _this = this;\r\n\r\n    _Node.setOutputs = function (_outputs) {\r\n      for (var key in _outputs) {\r\n        outputs[key] = _outputs[key];\r\n        _this.flagOutputDirty(key);\r\n      }\r\n    };\r\n\r\n    _Node.OnInit && _Node.OnInit.apply(this);\r\n  };\r\n\r\n  this.destroy = _Node.OnDestroy || this.destory;\r\n  this.change = (inputs, outputs, changedInputs) => {\r\n    for (var key in changedInputs) {\r\n      if (typeof _Node.Setters[key] === 'function') {\r\n        _Node.Setters[key](inputs[key]);\r\n      }\r\n    }\r\n\r\n    if (typeof _Node.OnInputsChanged === 'function') {\r\n      _Node.OnInputsChanged();\r\n    }\r\n  };\r\n\r\n  this.definedObject = {\r\n    inputs: this.inputs,\r\n    outputs: this.outputs,\r\n    setup: this.setup,\r\n    destroy: this.destroy,\r\n    change: this.change\r\n  };\r\n\r\n  // Set all signals as signal inputs\r\n  if (_Node.Signals !== undefined) {\r\n    for (var key in _Node.Signals) {\r\n      if (typeof _Node.Signals[key] === 'function') {\r\n        this.inputs[key] = 'signal';\r\n\r\n        this.definedObject[key] = _Node.Signals[key];\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nJavascriptNodeParser.createFromCode = function (code, options) {\r\n  return new JavascriptNodeParser(code, options);\r\n};\r\n\r\nJavascriptNodeParser.createFromURL = function (url, callback, options) {\r\n  url = getAbsoluteUrl(url);\r\n\r\n  var xhr = new window.XMLHttpRequest();\r\n  xhr.open('GET', url, true);\r\n  xhr.onreadystatechange = function () {\r\n    // XMLHttpRequest.DONE = 4, but torped runtime doesn't support enum\r\n    if (this.readyState === 4 || this.readyState === XMLHttpRequest.DONE) {\r\n      callback(new JavascriptNodeParser(this.response));\r\n    }\r\n  };\r\n  xhr.onerror = function () {\r\n    console.log('Failed to request', url);\r\n  };\r\n  xhr.send();\r\n};\r\n\r\nJavascriptNodeParser.parseAndAddPortsFromScript = function (script, ports, options) {\r\n  // Extract inputs and outputs\r\n  function _exists(port) {\r\n    if (typeof port === 'string') return ports.find((p) => p.name === port) !== undefined;\r\n    else return ports.find((p) => p.name === port.name && p.plug === port.plug) !== undefined;\r\n  }\r\n\r\n  function _addPortsFromMatch(match, options) {\r\n    if (match === undefined || match === null) return;\r\n\r\n    const unique = {};\r\n    for (const _s of match) {\r\n      let name = _s[1];\r\n      if (name === undefined) continue;\r\n\r\n      unique[name] = true;\r\n    }\r\n\r\n    Object.keys(unique).forEach((p) => {\r\n      if (\r\n        _exists({\r\n          name: options.prefix + p,\r\n          plug: options.plug\r\n        })\r\n      )\r\n        return;\r\n\r\n      ports.push({\r\n        name: options.prefix + p,\r\n        displayName: p,\r\n        plug: options.plug,\r\n        type: options.type,\r\n        group: options.group\r\n      });\r\n    });\r\n  }\r\n\r\n  // const scriptWithoutComments = script.replace(/\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/g,''); // Remove comments\r\n\r\n  // Regular Inputs. notation\r\n  if (!options.skipInputs) {\r\n    _addPortsFromMatch(script.matchAll(/Inputs\\.([A-Za-z0-9_]+)/g), {\r\n      type: options.inputType || '*',\r\n      plug: 'input',\r\n      group: options.inputGroup || 'Inputs',\r\n      prefix: options.inputPrefix || ''\r\n    });\r\n\r\n    // Inputs with Inputs[\"A\"] notation\r\n    _addPortsFromMatch(script.matchAll(/Inputs\\s*\\[\\s*(?:'|\")(.*)(?:'|\")\\s*\\]/g), {\r\n      type: options.inputType || '*',\r\n      plug: 'inputs',\r\n      group: options.inputGroup || 'Inputs',\r\n      prefix: options.inputPrefix || ''\r\n    });\r\n  }\r\n\r\n  if (!options.skipOutputs) {\r\n    if (!options.skipOutputSignals) {\r\n      // Output signals, Output.Done()\r\n      _addPortsFromMatch(script.matchAll(/Outputs\\.([A-Za-z0-9]+)\\s*\\(\\s*\\)/g), {\r\n        type: 'signal',\r\n        plug: 'output',\r\n        group: 'Outputs',\r\n        prefix: options.outputPrefix || ''\r\n      });\r\n\r\n      // Output signals, Outputs[\"Done\"]()\r\n      _addPortsFromMatch(script.matchAll(/Outputs\\s*\\[\\s*(?:'|\")(.*)(?:'|\")\\s*\\]\\(\\s*\\)/g), {\r\n        type: 'signal',\r\n        plug: 'output',\r\n        group: 'Outputs',\r\n        prefix: options.outputPrefix || ''\r\n      });\r\n    }\r\n\r\n    if (!options.skipRegularOutputs) {\r\n      // Regular output Outputs. notation\r\n      _addPortsFromMatch(script.matchAll(/Outputs\\.([A-Za-z0-9_]+)/g), {\r\n        type: '*',\r\n        plug: 'output',\r\n        group: 'Outputs',\r\n        prefix: options.outputPrefix || ''\r\n      });\r\n\r\n      // Outputs with Outputs[\"A\"] notation\r\n      _addPortsFromMatch(script.matchAll(/Outputs\\s*\\[\\s*\\\"([^\\\"]*)\\\"\\s*\\]/g), {\r\n        type: '*',\r\n        plug: 'output',\r\n        group: 'Outputs',\r\n        prefix: options.outputPrefix || ''\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\nJavascriptNodeParser.prototype.getPorts = function () {\r\n  var ports = [];\r\n\r\n  var self = this;\r\n\r\n  Object.keys(this.inputs).forEach(function (name) {\r\n    var inputPort = self.inputs[name];\r\n\r\n    var port = {\r\n      name: name,\r\n      plug: 'input'\r\n    };\r\n    if (typeof inputPort === 'string') {\r\n      port.type = {\r\n        name: inputPort\r\n      };\r\n      port.group = 'Inputs';\r\n    } else {\r\n      for (var p in inputPort) {\r\n        port[p] = inputPort[p];\r\n      }\r\n    }\r\n\r\n    ports.push(port);\r\n  });\r\n\r\n  Object.keys(this.outputs).forEach(function (name) {\r\n    ports.push({\r\n      name: name,\r\n      type: {\r\n        name: self.outputs[name]\r\n      },\r\n      plug: 'output',\r\n      group: 'Outputs'\r\n    });\r\n  });\r\n\r\n  JavascriptNodeParser.parseAndAddPortsFromScript(this.code, ports, {});\r\n\r\n  return ports;\r\n};\r\n\r\nconst _componentScopes = {};\r\n\r\nfunction _findParentComponentStateModelId(node) {\r\n  function getParentComponent(component) {\r\n    let parent;\r\n    if (component.getRoots().length > 0) {\r\n      //visual\r\n      const root = component.getRoots()[0];\r\n\r\n      if (root.getVisualParentNode) {\r\n        //regular visual node\r\n        if (root.getVisualParentNode()) {\r\n          parent = root.getVisualParentNode().nodeScope.componentOwner;\r\n        }\r\n      } else if (root.parentNodeScope) {\r\n        //component instance node\r\n        parent = component.parentNodeScope.componentOwner;\r\n      }\r\n    } else if (component.parentNodeScope) {\r\n      parent = component.parentNodeScope.componentOwner;\r\n    }\r\n\r\n    //check that a parent exists and that the component is different\r\n    if (parent && parent.nodeScope && parent.nodeScope.componentOwner !== component) {\r\n      //check if parent has a Component State node\r\n      if (parent.nodeScope.getNodesWithType('net.noodl.ComponentObject').length > 0) {\r\n        return parent;\r\n      }\r\n\r\n      if (parent.nodeScope.getNodesWithType('Component State').length > 0) {\r\n        return parent;\r\n      }\r\n\r\n      //if not, continue searching up the tree\r\n      return getParentComponent(parent);\r\n    }\r\n  }\r\n\r\n  const parent = getParentComponent(node.nodeScope.componentOwner);\r\n  if (!parent) return;\r\n\r\n  //this._internal.parentComponentName = parent.name;\r\n\r\n  return 'componentState' + parent.getInstanceId();\r\n}\r\n\r\nfunction _findForEachModel(node) {\r\n  var component = node.nodeScope.componentOwner;\r\n  while (component !== undefined && component._forEachModel === undefined && component.parentNodeScope) {\r\n    component = component.parentNodeScope.componentOwner;\r\n  }\r\n  return component !== undefined ? component._forEachModel : undefined;\r\n}\r\n\r\nJavascriptNodeParser.getComponentScopeForNode = function (node) {\r\n  const componentId = node.nodeScope.componentOwner.getInstanceId();\r\n\r\n  if (_componentScopes[componentId] === undefined) {\r\n    _componentScopes[componentId] = {};\r\n\r\n    const componentObject = (node.nodeScope.modelScope || Model).get('componentState' + componentId);\r\n\r\n    _componentScopes[componentId].Object = componentObject;\r\n  }\r\n\r\n  // This should be done each time, since the component can be moved\r\n  const parentComponentObjectId = _findParentComponentStateModelId(node);\r\n  const parentComponentObject =\r\n    parentComponentObjectId !== undefined\r\n      ? (node.nodeScope.modelScope || Model).get(parentComponentObjectId)\r\n      : undefined;\r\n\r\n  _componentScopes[componentId].ParentObject = parentComponentObject;\r\n\r\n  // Set the for each model\r\n  _componentScopes[componentId].RepeaterObject = _findForEachModel(node);\r\n\r\n  return _componentScopes[componentId];\r\n};\r\n\r\nJavascriptNodeParser.getCodePrefix = function () {\r\n  // API\r\n  return \"const Script = (typeof Node !== 'undefined')?Node:undefined;\\n\";\r\n};\r\n\r\nJavascriptNodeParser.createNoodlAPI = function () {\r\n  // If we are running in browser mode and there is a global Noodl API object, use it. If not\r\n  // create a new one for this scope.\r\n  return typeof window !== 'undefined' && window.Noodl !== undefined ? window.Noodl : {};\r\n};\r\n\r\nmodule.exports = JavascriptNodeParser;\r\n","// ------------------------------------------------------------------------------\r\n// Model\r\n// ------------------------------------------------------------------------------\r\nfunction Model(id, data) {\r\n  this.id = id;\r\n  this.data = data;\r\n}\r\n\r\nconst models = (Model._models = {});\r\nconst proxies = {};\r\n\r\n// Get and set proxy\r\nconst _modelProxyHandler = {\r\n  get: function (target, prop, receiver) {\r\n    if (typeof target[prop] === 'function') return target[prop].bind(target);\r\n    else if (prop in target) return Reflect.get(target, prop, receiver);\r\n    else return target.get(prop);\r\n  },\r\n  set: function (obj, prop, value) {\r\n    if (prop === '_class') {\r\n      obj._class = value;\r\n    } else if (prop === 'id') {\r\n      console.log(`Noodl.Object warning: id is readonly (Id is ${obj.id}, trying to set to ${value})`);\r\n      return true; //if a proxy doesn't return true an exception will be thrown\r\n    } else {\r\n      obj.set(prop, value);\r\n    }\r\n    return true;\r\n  },\r\n  ownKeys(target) {\r\n    return Reflect.ownKeys(target.data);\r\n  },\r\n  getOwnPropertyDescriptor(target, prop) {\r\n    return Object.getOwnPropertyDescriptor(target.data, prop);\r\n  }\r\n};\r\n\r\n/**\r\n *\r\n * @param {*} id\r\n * @returns {Model}\r\n */\r\nModel.get = function (id) {\r\n  if (id === undefined) id = Model.guid();\r\n  if (!models[id]) {\r\n    models[id] = new Model(id, {});\r\n    proxies[id] = new Proxy(models[id], _modelProxyHandler);\r\n  }\r\n  return proxies[id];\r\n};\r\n\r\nModel.create = function (data) {\r\n  var modelData = data ? data : {};\r\n  var m = Model.get(modelData.id);\r\n  for (var key in modelData) {\r\n    if (key === 'id') continue;\r\n    m.set(key, modelData[key]);\r\n  }\r\n\r\n  return m;\r\n};\r\n\r\nModel.exists = function (id) {\r\n  return models[id] !== undefined;\r\n};\r\n\r\nModel.instanceOf = function (collection) {\r\n  return collection instanceof Model || collection.target instanceof Model;\r\n};\r\n\r\nfunction _randomString(size) {\r\n  if (size === 0) {\r\n    throw new Error('Zero-length randomString is useless.');\r\n  }\r\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' + 'abcdefghijklmnopqrstuvwxyz' + '0123456789';\r\n  let objectId = '';\r\n  for (let i = 0; i < size; ++i) {\r\n    objectId += chars[Math.floor((1 + Math.random()) * 0x10000) % chars.length];\r\n  }\r\n  return objectId;\r\n}\r\n\r\nModel.guid = function guid() {\r\n  return _randomString(10);\r\n};\r\n\r\nModel.prototype.on = function (event, listener) {\r\n  if (!this.listeners) this.listeners = {};\r\n  if (!this.listeners[event]) this.listeners[event] = [];\r\n  this.listeners[event].push(listener);\r\n};\r\n\r\nModel.prototype.off = function (event, listener) {\r\n  if (!this.listeners) return;\r\n  if (!this.listeners[event]) return;\r\n  var idx = this.listeners[event].indexOf(listener);\r\n  if (idx !== -1) this.listeners[event].splice(idx, 1);\r\n};\r\n\r\nModel.prototype.notify = function (event, args) {\r\n  if (!this.listeners) return;\r\n  if (!this.listeners[event]) return;\r\n\r\n  var l = this.listeners[event].slice(); //clone in case listeners array is modified in the callbacks\r\n  for (var i = 0; i < l.length; i++) {\r\n    l[i](args);\r\n  }\r\n};\r\n\r\nModel.prototype.setAll = function (obj) {\r\n  for (var i in obj) {\r\n    if (i === 'id') continue; // Skip id\r\n    if (this.data[i] !== obj[i]) {\r\n      var old = this.data[i];\r\n      this.data[i] = obj[i];\r\n      this.notify('change', { name: i, value: obj[i], old: old });\r\n    }\r\n  }\r\n};\r\n\r\nModel.prototype.fill = function (value = null) {\r\n  for (const key in this.data) {\r\n    if (key === 'id') continue; // Skip id\r\n    const temp = this.data[key];\r\n    this.data[key] = value;\r\n    this.notify('change', { name: key, value: this.data[key], old: temp });\r\n  }\r\n};\r\n\r\n/**\r\n * @param {string} name\r\n * @param {unknown} value\r\n * @param {{\r\n *  resolve?: boolean;\r\n *  forceChange?: boolean;\r\n *  silent?: boolean;\r\n * }} args\r\n */\r\nModel.prototype.set = function (name, value, args) {\r\n  if (args && args.resolve && name.indexOf('.') !== -1) {\r\n    // We should resolve path references\r\n    const path = name.split('.');\r\n    let model = this;\r\n    for (let i = 0; i < path.length - 1; i++) {\r\n      const v = model.get(path[i]);\r\n      if (Model.instanceOf(v)) model = v;\r\n      else return; // Path resolve failed\r\n    }\r\n    model.set(path[path.length - 1], value);\r\n    return;\r\n  }\r\n\r\n  const forceChange = args && args.forceChange;\r\n\r\n  const oldValue = this.data[name];\r\n  this.data[name] = value;\r\n\r\n  if ((forceChange || oldValue !== value) && (!args || !args.silent)) {\r\n    this.notify('change', { name: name, value: value, old: oldValue });\r\n  }\r\n};\r\n\r\n/**\r\n * @returns {string}\r\n */\r\nModel.prototype.getId = function () {\r\n  return this.id;\r\n};\r\n\r\n/**\r\n * @param {string} name\r\n * @param {{\r\n *  resolve?: boolean;\r\n * }} args\r\n * @returns {unknown}\r\n */\r\nModel.prototype.get = function (name, args) {\r\n  if (args && args.resolve && name.indexOf('.') !== -1) {\r\n    // We should resolve path references\r\n    const path = name.split('.');\r\n    let model = this;\r\n    for (let i = 0; i < path.length - 1; i++) {\r\n      const v = model.get(path[i]);\r\n      if (Model.instanceOf(v)) model = v;\r\n      else return; // Path resolve failed\r\n    }\r\n    return model.get(path[path.length - 1]);\r\n  }\r\n\r\n  return this.data[name];\r\n};\r\n\r\nModel.prototype.toJSON = function () {\r\n  return Object.assign({}, this.data, { id: this.id });\r\n};\r\n\r\nModel.Scope = function () {\r\n  this.models = {};\r\n  this.proxies = {};\r\n};\r\n\r\nModel.Scope.prototype.get = function (id) {\r\n  if (id === undefined) id = Model.guid();\r\n  if (!this.models[id]) {\r\n    this.models[id] = new Model(id, {});\r\n    this.proxies[id] = new Proxy(this.models[id], _modelProxyHandler);\r\n  }\r\n  return this.proxies[id];\r\n};\r\n\r\nModel.Scope.prototype.create = function (data) {\r\n  var modelData = data ? data : {};\r\n  var m = this.get(modelData.id);\r\n  for (var key in modelData) {\r\n    if (key === 'id') continue;\r\n    m.set(key, modelData[key]);\r\n  }\r\n\r\n  return m;\r\n};\r\n\r\nModel.Scope.prototype.exists = function (id) {\r\n  return this.models[id] !== undefined;\r\n};\r\n\r\nModel.Scope.prototype.instanceOf = function (collection) {\r\n  return collection instanceof Model || collection.target instanceof Model;\r\n};\r\n\r\nModel.Scope.prototype.guid = function guid() {\r\n  return _randomString(10);\r\n};\r\n\r\nModel.Scope.prototype.reset = function () {\r\n  this.models = {};\r\n  this.proxies = {};\r\n  delete this._cloudStore;\r\n};\r\n\r\nmodule.exports = Model;\r\n","\"use strict\";\r\n\r\nvar NodeModel = require('./nodemodel');\r\nvar EventSender = require('../eventsender');\r\n\r\nfunction ComponentModel(name) {\r\n    EventSender.call(this);\r\n\r\n    this.name = name;\r\n    this.nodes = [];\r\n    this.connections = [];\r\n    this.roots = [];\r\n    this.inputPorts = {};\r\n    this.outputPorts = {};\r\n    this.metadata = {};\r\n}\r\n\r\nComponentModel.prototype = Object.create(EventSender.prototype);\r\n\r\nComponentModel.prototype.addNode = async function(node) {\r\n    node.component = this;\r\n    this.nodes[node.id] = node;\r\n    await this.emit(\"nodeAdded\", node);\r\n};\r\n\r\nComponentModel.prototype.hasNodeWithId = function(id) {\r\n    return this.getNodeWithId(id) !== undefined;\r\n};\r\n\r\nComponentModel.prototype.getNodeWithId = function(id) {\r\n    return this.nodes[id];\r\n};\r\n\r\nComponentModel.prototype.getAllNodes = function() {\r\n    return Object.values(this.nodes);\r\n};\r\n\r\nComponentModel.prototype.getNodesWithType = function(type) {\r\n    var nodes = [];\r\n    var self = this;\r\n    Object.keys(this.nodes).forEach(function(id) {\r\n        var node = self.nodes[id];\r\n        if(node.type === type) {\r\n            nodes.push(node);\r\n        }\r\n    });\r\n\r\n    return nodes;\r\n};\r\n\r\nComponentModel.prototype.addConnection = function(connection) {\r\n    this.connections.push(connection);\r\n    this.emit(\"connectionAdded\", connection);\r\n    \r\n    //emit an event on the target node model\r\n    //used by numbered inputs\r\n    if(connection.targetId) {\r\n        const node = this.getNodeWithId(connection.targetId);\r\n        if(node) {\r\n            node.emit(\"inputConnectionAdded\", connection);\r\n        }\r\n    }\r\n};\r\n\r\nComponentModel.prototype.removeConnection = function(connection) {\r\n    const index = this.connections.findIndex(con => {\r\n        return con.sourceId === connection.sourceId &&\r\n               con.sourcePort === connection.sourcePort &&\r\n               con.targetId === connection.targetId &&\r\n               con.targetPort === connection.targetPort;\r\n    });\r\n\r\n    if(index === -1) {\r\n       console.log(\"Connection doesn't exist\", connection);\r\n       return;\r\n    }\r\n\r\n    this.connections.splice(index, 1);\r\n    this.emit(\"connectionRemoved\", connection);\r\n\r\n    //emit an event on the target node model\r\n    //used by numbered inputs\r\n    if(connection.targetId) {\r\n        const node = this.getNodeWithId(connection.targetId);\r\n        if(node) {\r\n            node.emit(\"inputConnectionRemoved\", connection);\r\n        }\r\n    }\r\n};\r\n\r\nComponentModel.prototype.getConnectionsFromPort = function(nodeId, sourcePortName) {\r\n    return this.connections.filter(function(connection) {\r\n        return connection.sourceId === nodeId && connection.sourcePort === sourcePortName;\r\n    })\r\n};\r\n\r\nComponentModel.prototype.getConnectionsToPort = function(nodeId, targetPortName) {\r\n    return this.connections.filter(function(connection) {\r\n        return connection.targetId === nodeId && connection.targetPort === targetPortName;\r\n    })\r\n};\r\n\r\nComponentModel.prototype.getConnectionsFrom = function(nodeId) {\r\n    return this.connections.filter(function(connection) {\r\n        return connection.sourceId === nodeId;\r\n    })\r\n};\r\n\r\nComponentModel.prototype.getConnectionsTo = function(nodeId) {\r\n    return this.connections.filter(function(connection) {\r\n        return connection.targetId === nodeId;\r\n    })\r\n};\r\n\r\nComponentModel.prototype.addRootId = function(rootId) {\r\n    if(this.roots.indexOf(rootId) !== -1) {\r\n        return;\r\n    }\r\n    this.roots.push(rootId);\r\n    this.emit(\"rootAdded\", rootId);\r\n};\r\n\r\nComponentModel.prototype.removeRootId = function(rootId) {\r\n    const index = this.roots.indexOf(rootId);\r\n    if(index !== -1) {\r\n        this.roots.splice(index, 1);\r\n        this.emit(\"rootRemoved\", rootId);\r\n    }\r\n};\r\n\r\nComponentModel.prototype.getRoots = function() {\r\n    return this.roots;\r\n}\r\n\r\nComponentModel.prototype.removeNodeWithId = async function(id) {\r\n    const node = this.getNodeWithId(id);\r\n\r\n    if (!node) {\r\n        console.warn(\"ERROR: Attempted to remove non-existing node with ID:\", id);\r\n        return false;\r\n    }\r\n\r\n    //remove children first\r\n    while(node.children.length > 0) {\r\n        const child = node.children[0];\r\n        const childRemoved = await this.removeNodeWithId(child.id);\r\n        if (!childRemoved) {\r\n            // Workaround for corrupt node trees, should never happen, a remove should always be successful\r\n            node.children.shift();\r\n        }\r\n    }\r\n\r\n    const connections = this.getConnectionsTo(id).concat(this.getConnectionsFrom(id));\r\n\r\n    for(let i=0; i<connections.length; i++) {\r\n        this.removeConnection(connections[i]);\r\n    }\r\n\r\n    this.setNodeParent(node, null);\r\n\r\n    if(this.roots.indexOf(node.id) !== -1) {\r\n        this.removeRootId(node.id);\r\n    }\r\n\r\n    await this.emit(\"nodeRemoved\", node);\r\n\r\n    node.removeAllListeners();\r\n    delete this.nodes[id];\r\n\r\n    await this.emit(\"nodeWasRemoved\", node);\r\n    return true;\r\n};\r\n\r\nComponentModel.prototype.getAllConnections = function() {\r\n    return this.connections;\r\n};\r\n\r\nComponentModel.prototype.getInputPorts = function() {\r\n    return this.inputPorts;\r\n};\r\n\r\nComponentModel.prototype.getOutputPorts = function() {\r\n    return this.outputPorts;\r\n};\r\n\r\nComponentModel.prototype.addInputPort = function(port) {\r\n    this.inputPorts[port.name] = port;\r\n    this.emit(\"inputPortAdded\", port);\r\n};\r\n\r\nComponentModel.prototype.addOutputPort = function(port) {\r\n    this.outputPorts[port.name] = port;\r\n    this.emit(\"outputPortAdded\", port);\r\n};\r\n\r\nComponentModel.prototype.removeOutputPortWithName = function(portName) {\r\n    if(this.outputPorts.hasOwnProperty(portName)) {\r\n        var port = this.outputPorts[portName];\r\n        delete this.outputPorts[portName];\r\n        this.emit(\"outputPortRemoved\", port);\r\n    }\r\n};\r\n\r\nComponentModel.prototype.removeInputPortWithName = function(portName) {\r\n    if(this.inputPorts.hasOwnProperty(portName)) {\r\n        var port = this.inputPorts[portName];\r\n        delete this.inputPorts[portName];\r\n        this.emit(\"inputPortRemoved\", port);\r\n    }\r\n};\r\n\r\nComponentModel.prototype.updateInputPortTypes = function(ports) {\r\n    var changed = false;\r\n    for(var key in ports) {\r\n        if(this.inputPorts[key] !== undefined) {\r\n            this.inputPorts[key].type = ports[key].type;\r\n            changed = true;\r\n        }\r\n    }\r\n    changed && this.emit(\"inputPortTypesUpdated\");\r\n}\r\n\r\nComponentModel.prototype.updateOutputPortTypes = function(ports) {\r\n    var changed = false;\r\n    for(var key in ports) {\r\n        if(this.outputPorts[key] !== undefined) {\r\n            this.outputPorts[key].type = ports[key].type;\r\n            changed = true;\r\n        }\r\n    }\r\n    changed && this.emit(\"outputPortTypesUpdated\");\r\n}\r\n\r\nComponentModel.prototype.renameInputPortOnNodeWithId = function(id, oldName, newName) {\r\n\r\n    //remove connections\r\n    var connections = this.getConnectionsToPort(id, oldName);\r\n    connections.forEach(this.removeConnection.bind(this));\r\n\r\n    //get port before deleting it\r\n    var nodeModel = this.getNodeWithId(id);\r\n    var port = {...nodeModel.getInputPort(oldName)};\r\n\r\n    //remove old port\r\n    if(port) {\r\n        nodeModel.removeInputPortWithName(oldName);\r\n\r\n        //rename and add new port\r\n        port.name = newName;\r\n        nodeModel.addInputPort(port);\r\n    }\r\n\r\n    //add new connection\r\n    connections.forEach(function(connection) {\r\n        connection.targetPort = newName;\r\n    });\r\n\r\n    connections.forEach(this.addConnection.bind(this));\r\n};\r\n\r\nComponentModel.prototype.renameOutputPortOnNodeWithId = function(id, oldName, newName) {\r\n\r\n    //remove connections\r\n    var connections = this.getConnectionsFromPort(id, oldName);\r\n    connections.forEach(this.removeConnection.bind(this));\r\n\r\n    //get port before deleting it\r\n    var nodeModel = this.getNodeWithId(id);\r\n    var port = {...nodeModel.getOutputPort(oldName)};\r\n\r\n    //remove old port\r\n    nodeModel.removeOutputPortWithName(oldName);\r\n\r\n    //rename and add new port\r\n    port.name = newName;\r\n    nodeModel.addOutputPort(port);\r\n\r\n    //add new connection\r\n    connections.forEach(function(connection) {\r\n        connection.sourcePort = newName;\r\n    });\r\n\r\n    connections.forEach(this.addConnection.bind(this));\r\n};\r\n\r\nComponentModel.prototype.setNodeParent = function(childModel, newParentModel, index) {\r\n\r\n    if(this.roots.indexOf(childModel.id) !== -1) {\r\n        this.removeRootId(childModel.id)\r\n    }\r\n\r\n    if(childModel.parent) {\r\n        this.emit(\"nodeParentWillBeRemoved\", childModel);\r\n        childModel.parent.removeChild(childModel);\r\n    }\r\n    childModel.emit(\"parentUpdated\", newParentModel);\r\n    if(newParentModel) {\r\n        newParentModel.addChild(childModel, index);\r\n        this.emit(\"nodeParentUpdated\", childModel);\r\n    }\r\n};\r\n\r\nComponentModel.prototype.importEditorNodeData = async function(nodeData, parentId, childIndex) {\r\n    var nodeModel = NodeModel.createFromExportData(nodeData);\r\n    await this.addNode(nodeModel);\r\n\r\n    if(parentId) {\r\n        this.setNodeParent(nodeModel, this.getNodeWithId(parentId), childIndex);\r\n    }\r\n\r\n    if(nodeData.children) {\r\n        for(let i=0; i<nodeData.children.length; i++) {\r\n            const child = nodeData.children[i];\r\n            await this.importEditorNodeData(child, nodeModel.id, i);\r\n        }\r\n    }\r\n};\r\n\r\nComponentModel.prototype.reset = async function() {\r\n    while(this.roots.length) {\r\n        await this.removeNodeWithId(this.roots[0]);\r\n    }\r\n\r\n    for(const id of this.nodes) {\r\n        //note: with an incomplete library there will be no roots\r\n        //so some of the nodes will have children, which will be recursively removed by\r\n        //removeNodeWithId(), so some IDs from the Object.keys(this.nodes) that runs this loop\r\n        //will already have been removed, so check if they exist before removing\r\n        if(this.hasNodeWithId(id)) {\r\n            await this.removeNodeWithId(id);\r\n        }\r\n    }\r\n\r\n    if(this.nodes.length > 0) {\r\n        throw new Error(\"Not all nodes were removed during a reset\");\r\n    }\r\n\r\n    if(this.connections.length > 0) {\r\n        throw new Error(\"Not all connections were removed during a reset\");\r\n    }\r\n};\r\n\r\nComponentModel.prototype.rename = function(newName) {\r\n    var oldName = this.name;\r\n    this.name = newName;\r\n    this.emit(\"renamed\", {oldName: oldName, newName: newName});\r\n};\r\n\r\nComponentModel.prototype.setMetadata = function(key, data) {\r\n    this.metadata[key] = data;\r\n};\r\n\r\nComponentModel.prototype.getMetadata = function(key) {\r\n    if(!key) return this.metadata;\r\n    return this.metadata[key];\r\n};\r\n\r\nComponentModel.createFromExportData = async function(componentData) {\r\n\r\n    var componentModel = new ComponentModel(componentData.name);\r\n\r\n    if(componentData.metadata) {\r\n        for(const key in componentData.metadata) {\r\n            componentModel.setMetadata(key, componentData.metadata[key]);\r\n        }\r\n    }\r\n\r\n    componentData.ports && componentData.ports.forEach(function(port) {\r\n        if(port.plug === \"input\" || port.plug === \"input/output\") {\r\n            componentModel.addInputPort(port);\r\n        }\r\n        if(port.plug === \"output\" || port.plug === \"input/output\") {\r\n            componentModel.addOutputPort(port);\r\n        }\r\n    });\r\n\r\n    if(componentData.nodes) {\r\n        for(const node of componentData.nodes) {\r\n            await componentModel.importEditorNodeData(node);\r\n        }\r\n    }\r\n\r\n    componentData.connections && componentData.connections.forEach(connection => componentModel.addConnection(connection));\r\n    componentData.roots && componentData.roots.forEach(root => componentModel.addRootId(root));\r\n\r\n    return componentModel;\r\n};\r\n\r\nmodule.exports = ComponentModel;\r\n","'use strict';\r\n\r\nvar ComponentModel = require('./componentmodel');\r\nvar EventSender = require('../eventsender');\r\n\r\nfunction GraphModel() {\r\n  EventSender.call(this);\r\n  this.components = {};\r\n\r\n  this.settings = {};\r\n\r\n  this.metadata = {};\r\n}\r\n\r\nGraphModel.prototype = Object.create(EventSender.prototype);\r\n\r\nGraphModel.prototype.importComponentFromEditorData = async function (componentData) {\r\n  var componentModel = await ComponentModel.createFromExportData(componentData);\r\n  this.addComponent(componentModel);\r\n};\r\n\r\nGraphModel.prototype.getBundleContainingComponent = function (name) {\r\n  return this.componentToBundleMap.get(name);\r\n};\r\n\r\nGraphModel.prototype.getBundlesContainingSheet = function (sheetName) {\r\n  const bundles = new Set();\r\n  for (const name of this.componentToBundleMap.keys()) {\r\n    const isOnDefaultSheet = name.indexOf('/#') !== 0;\r\n\r\n    const isMatch =\r\n      (isOnDefaultSheet && sheetName === 'Default') || (!isOnDefaultSheet && name.indexOf('/#' + sheetName) === 0);\r\n\r\n    if (isMatch) {\r\n      bundles.add(this.componentToBundleMap.get(name));\r\n    }\r\n  }\r\n  return Array.from(bundles);\r\n};\r\n\r\nGraphModel.prototype.getBundleDependencies = function (bundleName) {\r\n  const result = new Set();\r\n\r\n  const recurse = (name) => {\r\n    const bundle = this.componentIndex[name];\r\n    for (const dep of bundle.dependencies) {\r\n      if (!result.has(dep)) {\r\n        result.add(dep);\r\n        recurse(dep);\r\n      }\r\n    }\r\n  };\r\n\r\n  recurse(bundleName);\r\n\r\n  return Array.from(result);\r\n};\r\n\r\nGraphModel.prototype.importEditorData = async function (exportData) {\r\n  this.componentIndex = exportData.componentIndex;\r\n  this.routerIndex = exportData.routerIndex;\r\n\r\n  this.componentToBundleMap = new Map();\r\n\r\n  for (const bundleName in exportData.componentIndex) {\r\n    const bundle = exportData.componentIndex[bundleName];\r\n\r\n    for (const componentName of bundle.components) {\r\n      this.componentToBundleMap.set(componentName, bundleName);\r\n    }\r\n  }\r\n\r\n  this.variants = exportData.variants || [];\r\n\r\n  exportData.settings && this.setSettings(exportData.settings);\r\n\r\n  exportData.metadata && this.setAllMetaData(exportData.metadata);\r\n\r\n  for (const component of exportData.components) {\r\n    await this.importComponentFromEditorData(component);\r\n  }\r\n\r\n  this.setRootComponentName(exportData.rootComponent);\r\n};\r\n\r\nGraphModel.prototype.setRootComponentName = function (componentName) {\r\n  this.rootComponent = componentName;\r\n  this.emit('rootComponentNameUpdated', componentName);\r\n};\r\n\r\nGraphModel.prototype.getNodesWithType = function (type) {\r\n  var nodes = [];\r\n\r\n  var componentNames = Object.keys(this.components);\r\n  for (var i = 0; i < componentNames.length; i++) {\r\n    var component = this.components[componentNames[i]];\r\n    nodes = nodes.concat(component.getNodesWithType(type));\r\n  }\r\n  return nodes;\r\n};\r\n\r\nGraphModel.prototype.getComponentWithName = function (type) {\r\n  return this.components[type];\r\n};\r\n\r\nGraphModel.prototype.hasComponentWithName = function (type) {\r\n  return this.components[type] ? true : false;\r\n};\r\n\r\nGraphModel.prototype.getAllComponents = function () {\r\n  return Object.keys(this.components).map((name) => {\r\n    return this.components[name];\r\n  });\r\n};\r\n\r\nGraphModel.prototype.getAllNodes = function () {\r\n  var nodes = [];\r\n\r\n  var componentNames = Object.keys(this.components);\r\n  for (var i = 0; i < componentNames.length; i++) {\r\n    var component = this.components[componentNames[i]];\r\n    nodes = nodes.concat(component.getAllNodes());\r\n  }\r\n\r\n  return nodes;\r\n};\r\n\r\nGraphModel.prototype.addComponent = function (component) {\r\n  this.components[component.name] = component;\r\n\r\n  //nodes that are already added are missing component input/output ports if the component is registered after the nodes\r\n  //now when we have the component info, add them to the node instance models\r\n  this.getNodesWithType(component.name).forEach(this._addComponentPorts.bind(this));\r\n\r\n  //emit the \"nodeAdded\" event for every node already in the component\r\n  component.getAllNodes().forEach(this._onNodeAdded.bind(this));\r\n\r\n  //emit the same event for future nodes that will be added\r\n  component.on('nodeAdded', this._onNodeAdded.bind(this), this);\r\n\r\n  //and for nodes that are removed\r\n  component.on('nodeRemoved', this._onNodeRemoved.bind(this), this);\r\n  component.on('nodeWasRemoved', this._onNodeWasRemoved.bind(this), this);\r\n\r\n  this.emit('componentAdded', component);\r\n};\r\n\r\nGraphModel.prototype.removeComponentWithName = async function (componentName) {\r\n  if (this.components.hasOwnProperty(componentName) === false) {\r\n    console.error('GraphModel: Component with name ' + componentName + ' not in graph');\r\n    return;\r\n  }\r\n\r\n  var component = this.components[componentName];\r\n  await component.reset();\r\n\r\n  component.removeAllListeners();\r\n  delete this.components[component.name];\r\n\r\n  this.emit('componentRemoved', component);\r\n};\r\n\r\nGraphModel.prototype.renameComponent = function (componentName, newName) {\r\n  if (this.components.hasOwnProperty(componentName) === false) {\r\n    console.error('GraphModel: Component with name ' + componentName + ' not in graph');\r\n    return;\r\n  }\r\n\r\n  this.getNodesWithType(componentName).forEach(function (nodeModel) {\r\n    nodeModel.type = newName;\r\n  });\r\n\r\n  var component = this.components[componentName];\r\n  component.rename(newName);\r\n\r\n  delete this.components[componentName];\r\n  this.components[newName] = component;\r\n\r\n  this.emit('componentRenamed', component);\r\n};\r\n\r\nGraphModel.prototype._addComponentPorts = function (node) {\r\n  //check if this node is a known component and add port to the model\r\n  if (this.components.hasOwnProperty(node.type)) {\r\n    //a component was created, add component ports to model\r\n    var component = this.components[node.type];\r\n\r\n    const inputPorts = component.getInputPorts();\r\n    const outputPorts = component.getOutputPorts();\r\n\r\n    Object.keys(inputPorts).forEach((portName) => {\r\n      node.addInputPort(inputPorts[portName]);\r\n    });\r\n\r\n    Object.keys(outputPorts).forEach((portName) => {\r\n      node.addOutputPort(outputPorts[portName]);\r\n    });\r\n  }\r\n};\r\n\r\nGraphModel.prototype._onNodeAdded = function (node) {\r\n  this._addComponentPorts(node);\r\n\r\n  this.emit('nodeAdded', node);\r\n  this.emit('nodeAdded.' + node.type, node);\r\n};\r\n\r\nGraphModel.prototype._onNodeRemoved = function (node) {\r\n  this.emit('nodeRemoved', node);\r\n  this.emit('nodeRemoved.' + node.type, node);\r\n};\r\n\r\nGraphModel.prototype._onNodeWasRemoved = function (node) {\r\n  this.emit('nodeWasRemoved', node);\r\n  this.emit('nodeWasRemoved.' + node.type, node);\r\n};\r\n\r\nGraphModel.prototype.reset = async function () {\r\n  for (const componentName of Object.keys(this.components)) {\r\n    await this.removeComponentWithName(componentName);\r\n  }\r\n  this.setSettings({});\r\n};\r\n\r\nGraphModel.prototype.isEmpty = function () {\r\n  return Object.keys(this.components).length === 0;\r\n};\r\n\r\nGraphModel.prototype.setSettings = function (settings) {\r\n  this.settings = settings;\r\n  this.emit('projectSettingsChanged', settings);\r\n};\r\n\r\nGraphModel.prototype.getSettings = function () {\r\n  return this.settings;\r\n};\r\n\r\nGraphModel.prototype.setAllMetaData = function (metadata) {\r\n  for (const p in metadata) {\r\n    this.setMetaData(p, metadata[p]);\r\n  }\r\n};\r\n\r\nGraphModel.prototype.setMetaData = function (key, data) {\r\n  //metadata changes can trigger lots of ports to evaluate (e.g. when a database model has been changed)\r\n  //check if the data actually has been updated before since the editor can send the same data multiple times\r\n  if (this.metadata[key] && JSON.stringify(this.metadata[key]) === JSON.stringify(data)) {\r\n    return;\r\n  }\r\n\r\n  this.metadata[key] = data;\r\n  this.emit('metadataChanged', { key, data });\r\n  this.emit('metadataChanged.' + key, data);\r\n};\r\n\r\nGraphModel.prototype.getMetaData = function (key) {\r\n  if (key) return this.metadata[key];\r\n  return this.metadata;\r\n};\r\n\r\nGraphModel.prototype.getVariants = function () {\r\n  return this.variants || [];\r\n};\r\n\r\nGraphModel.prototype.getVariant = function (typename, name) {\r\n  return this.variants.find((v) => v.name === name && v.typename === typename);\r\n};\r\n\r\nGraphModel.prototype.updateVariant = function (variant) {\r\n  const i = this.variants.findIndex((v) => v.name === variant.name && v.typename === variant.typename);\r\n  if (i !== -1) this.variants.splice(i, 1);\r\n  this.variants.push(variant);\r\n\r\n  this.emit('variantUpdated', variant);\r\n};\r\n\r\nGraphModel.prototype.updateVariantParameter = function (\r\n  variantName,\r\n  variantTypeName,\r\n  parameterName,\r\n  parameterValue,\r\n  state\r\n) {\r\n  const variant = this.getVariant(variantTypeName, variantName);\r\n  if (!variant) {\r\n    console.log(\"updateVariantParameter: can't find variant\", variantName, variantTypeName);\r\n    return;\r\n  }\r\n\r\n  if (!state) {\r\n    if (parameterValue === undefined) {\r\n      delete variant.parameters[parameterName];\r\n    } else {\r\n      variant.parameters[parameterName] = parameterValue;\r\n    }\r\n  } else {\r\n    if (!variant.stateParameters.hasOwnProperty(state)) {\r\n      variant.stateParameters[state] = {};\r\n    }\r\n\r\n    if (parameterValue === undefined) {\r\n      delete variant.stateParameters[state][parameterName];\r\n    } else {\r\n      variant.stateParameters[state][parameterName] = parameterValue;\r\n    }\r\n  }\r\n\r\n  this.emit('variantUpdated', variant);\r\n};\r\n\r\nGraphModel.prototype.updateVariantDefaultStateTransition = function (variantName, variantTypeName, transition, state) {\r\n  const variant = this.getVariant(variantTypeName, variantName);\r\n  if (!variant) return;\r\n\r\n  variant.defaultStateTransitions[state] = transition;\r\n  this.emit('variantUpdated', variant);\r\n};\r\n\r\nGraphModel.prototype.updateVariantStateTransition = function (args) {\r\n  const { variantTypeName, variantName, state, parameterName, curve } = args;\r\n\r\n  const variant = this.getVariant(variantTypeName, variantName);\r\n  if (!variant) return;\r\n\r\n  if (!variant.stateTransitions[state]) {\r\n    variant.stateTransitions[state] = {};\r\n  }\r\n\r\n  variant.stateTransitions[state][parameterName] = curve;\r\n};\r\n\r\nGraphModel.prototype.deleteVariant = function (typename, name) {\r\n  const i = this.variants.findIndex((v) => v.name === name && v.typename === typename);\r\n  if (i !== -1) this.variants.splice(i, 1);\r\n};\r\n\r\nmodule.exports = GraphModel;\r\n","\"use strict\";\r\n\r\nvar EventSender = require('../eventsender');\r\n\r\nfunction NodeModel(id, type) {\r\n    EventSender.call(this);\r\n\r\n    this.id = id;\r\n    this.type = type;\r\n\r\n    this.inputs = [];\r\n    this.outputs = [];\r\n    this.children = [];\r\n    this.parameters = {};\r\n    this.inputPorts = {};\r\n    this.outputPorts = {};\r\n}\r\n\r\nNodeModel.prototype = Object.create(EventSender.prototype);\r\n\r\nNodeModel.prototype.setParameter = function(name, value, state) {\r\n    if(state) {\r\n        if(!this.stateParameters) this.stateParameters = {};\r\n        if(!this.stateParameters[state]) this.stateParameters[state] = {};\r\n\r\n        if(value === undefined) {\r\n            delete this.stateParameters[state][name];\r\n        }\r\n        else {\r\n            this.stateParameters[state][name] = value;\r\n        }\r\n    }\r\n    else {\r\n        if(value === undefined) {\r\n            delete this.parameters[name];\r\n        }\r\n        else {\r\n            this.parameters[name] = value;\r\n        }\r\n    }\r\n\r\n    this.emit(\"parameterUpdated\", {name, value, state});\r\n};\r\n\r\nNodeModel.prototype.setParameters = function(parameters) {\r\n    Object.keys(parameters).forEach(name => {\r\n        this.setParameter(name, parameters[name]);\r\n    });\r\n};\r\n\r\nNodeModel.prototype.setStateParameters = function(parameters) {\r\n   this.stateParameters = parameters;\r\n};\r\n\r\nNodeModel.prototype.setStateTransitions = function(stateTransitions) {\r\n    this.stateTransitions = stateTransitions;\r\n};\r\n\r\nNodeModel.prototype.setStateTransitionParamter = function(parameter, curve, state) {\r\n    if(!this.stateTransitions) {\r\n        this.stateTransitions = {};\r\n    }\r\n\r\n    if(curve) {\r\n        this.stateTransitions[state][parameter] = curve;\r\n    }\r\n    else {\r\n        delete this.stateTransitions[state][parameter];\r\n    }\r\n};\r\n\r\nNodeModel.prototype.setDefaultStateTransition = function(stateTransition, state) {\r\n    if(!this.defaultStateTransitions) {\r\n        this.defaultStateTransitions = {};\r\n    }\r\n    this.defaultStateTransitions[state] = stateTransition;\r\n};\r\n\r\nNodeModel.prototype.addInputPort = function(port) {\r\n    this.inputPorts[port.name] = port;\r\n    this.emit(\"inputPortAdded\", port);\r\n};\r\n\r\nNodeModel.prototype.getInputPort = function(portName) {\r\n    return this.inputPorts[portName];\r\n};\r\n\r\nNodeModel.prototype.getInputPorts = function() {\r\n    return this.inputPorts;\r\n};\r\n\r\nNodeModel.prototype.removeInputPortWithName = function(portName) {\r\n    if(this.inputPorts.hasOwnProperty(portName)) {\r\n        var port = this.inputPorts[portName];\r\n        delete this.inputPorts[portName];\r\n        this.emit(\"inputPortRemoved\", port);\r\n    }\r\n};\r\n\r\nNodeModel.prototype.updateInputPortTypes = function(ports) {\r\n    var changed = false;\r\n    for(var key in ports) {\r\n        if(this.inputPorts[key] !== undefined) {\r\n            this.inputPorts[key].type = ports[key].type;\r\n            changed = true;\r\n        }\r\n    }\r\n    changed && this.emit(\"inputPortTypesUpdated\");\r\n}\r\n\r\nNodeModel.prototype.addOutputPort = function(port) {\r\n    this.outputPorts[port.name] = port;\r\n    this.emit(\"outputPortAdded\", port);\r\n};\r\n\r\nNodeModel.prototype.getOutputPort = function(portName) {\r\n    return this.outputPorts[portName];\r\n};\r\n\r\nNodeModel.prototype.getOutputPorts = function() {\r\n    return this.outputPorts;\r\n};\r\n\r\nNodeModel.prototype.removeOutputPortWithName = function(portName) {\r\n    if(this.outputPorts.hasOwnProperty(portName)) {\r\n        var port = this.outputPorts[portName];\r\n        delete this.outputPorts[portName];\r\n        this.emit(\"outputPortRemoved\", port);\r\n    }\r\n};\r\n\r\nNodeModel.prototype.updateOutputPortTypes = function(ports) {\r\n    var changed = false;\r\n    for(var key in ports) {\r\n        if(this.outputPorts[key] !== undefined) {\r\n            this.outputPorts[key].type = ports[key].type;\r\n            changed = true;\r\n        }\r\n    }\r\n    changed && this.emit(\"outputPortTypesUpdated\");\r\n}\r\n\r\nNodeModel.prototype.addChild = function(child, index) {\r\n    child.parent = this;\r\n    if(index === undefined) {\r\n        this.children.push(child);\r\n    }\r\n    else {\r\n        this.children.splice(index, 0, child);\r\n    }\r\n    this.emit(\"childAdded\", child);\r\n};\r\n\r\nNodeModel.prototype.removeChild = function(child) {\r\n    child.parent = undefined;\r\n    var index = this.children.indexOf(child);\r\n    this.children.splice(index, 1);\r\n    this.emit(\"childRemoved\", child);\r\n};\r\n\r\nNodeModel.prototype.reset = function() {\r\n    this.removeAllListeners();\r\n};\r\n\r\nNodeModel.prototype.setVariant = function(variant) {\r\n    this.variant = variant;\r\n    this.emit(\"variantUpdated\", variant);\r\n};\r\n\r\nNodeModel.createFromExportData = function(nodeData) {\r\n    var node = new NodeModel(nodeData.id, nodeData.type);\r\n    nodeData.parameters && node.setParameters(nodeData.parameters);\r\n    nodeData.stateParameters && node.setStateParameters(nodeData.stateParameters);\r\n    nodeData.stateTransitions && node.setStateTransitions(nodeData.stateTransitions);\r\n    \r\n    if(nodeData.defaultStateTransitions) {\r\n        for(const state in nodeData.defaultStateTransitions) {\r\n            node.setDefaultStateTransition(nodeData.defaultStateTransitions[state], state);\r\n        }\r\n    }\r\n    \r\n    nodeData.ports && nodeData.ports.forEach(function(port) {\r\n\r\n        //some ports are incorrectly named outputs instead of output, patch it here so\r\n        //the rest of the code doesn't need to care\r\n        if(port.plug === \"outputs\") {\r\n          port.plug = \"output\";\r\n        }\r\n\r\n        if(port.plug === \"input\" || port.plug === \"input/output\") {\r\n            node.addInputPort(port);\r\n        }\r\n        if(port.plug === \"output\" || port.plug === \"input/output\") {\r\n            node.addOutputPort(port);\r\n        }\r\n    });\r\n\r\n    nodeData.variant && node.setVariant(nodeData.variant);\r\n\r\n    return node;\r\n};\r\n\r\nmodule.exports = NodeModel;","const OutputProperty = require('./outputproperty');\r\n\r\n/**\r\n * Base class for all Nodes\r\n * @constructor\r\n */\r\nfunction Node(context, id) {\r\n  this.id = id;\r\n  this.context = context;\r\n  this._dirty = false;\r\n\r\n  this._inputs = {};\r\n  this._inputValues = {};\r\n  this._outputs = {};\r\n\r\n  this._inputConnections = {};\r\n  this._outputList = [];\r\n  this._isUpdating = false;\r\n  this._inputValuesQueue = {};\r\n  this._afterInputsHaveUpdatedCallbacks = [];\r\n\r\n  this._internal = {};\r\n  this._signalsSentThisUpdate = {};\r\n\r\n  this._deleted = false;\r\n  this._deleteListeners = [];\r\n  this._isFirstUpdate = true;\r\n\r\n  this._valuesFromConnections = {};\r\n  this.updateOnDirtyFlagging = true;\r\n}\r\n\r\nNode.prototype.getInputValue = function (name) {\r\n  return this._inputValues[name];\r\n};\r\n\r\nNode.prototype.registerInput = function (name, input) {\r\n  if (this.hasInput(name)) {\r\n    throw new Error('Input property ' + name + ' already registered');\r\n  }\r\n\r\n  this._inputs[name] = input;\r\n\r\n  if (input.type && input.type.units) {\r\n    const defaultUnit = input.type.defaultUnit || input.type.units[0];\r\n    this._inputValues[name] = {\r\n      value: input.default,\r\n      type: defaultUnit\r\n    };\r\n  } else if (input.hasOwnProperty('default')) {\r\n    this._inputValues[name] = input.default;\r\n  }\r\n};\r\n\r\nNode.prototype.deregisterInput = function (name) {\r\n  if (this.hasInput(name) === false) {\r\n    throw new Error('Input property ' + name + \" doesn't exist\");\r\n  }\r\n  delete this._inputs[name];\r\n  delete this._inputValues[name];\r\n};\r\n\r\nNode.prototype.registerInputs = function (inputs) {\r\n  for (const name in inputs) {\r\n    this.registerInput(name, inputs[name]);\r\n  }\r\n};\r\n\r\nNode.prototype.getInput = function (name) {\r\n  if (this.hasInput(name) === false) {\r\n    console.log('Node ' + this.name + ': Invalid input property ' + name);\r\n    return undefined;\r\n  }\r\n\r\n  return this._inputs[name];\r\n};\r\n\r\nNode.prototype.hasInput = function (name) {\r\n  return name in this._inputs;\r\n};\r\n\r\nNode.prototype.registerInputIfNeeded = function () {\r\n  //noop, can be overriden by subclasses\r\n};\r\n\r\nNode.prototype.setInputValue = function (name, value) {\r\n  const input = this.getInput(name);\r\n  if (!input) {\r\n    console.log(\"node doesn't have input\", name);\r\n    return;\r\n  }\r\n\r\n  //inputs with units always expect objects in the shape of {value, unit, ...}\r\n  //these inputs might sometimes get raw numbers without units, and in those cases\r\n  //Noodl should just update the value and not the other parameters\r\n  const currentInputValue = this._inputValues[name];\r\n\r\n  if (isNaN(value) === false && currentInputValue && currentInputValue.unit) {\r\n    //update the value, and keep the other parameters\r\n    const newValue = Object.assign({}, currentInputValue); //copy it, so we don't modify the original object (e.g. it might come from a variant)\r\n    newValue.value = value;\r\n    value = newValue;\r\n  }\r\n\r\n  //Save the current input value. Save it before resolving color styles so delta updates on color styles work correctly\r\n  this._inputValues[name] = value;\r\n\r\n  if (input.type === 'color' && this.context && this.context.styles) {\r\n    value = this.context.styles.resolveColor(value);\r\n  } else if (input.type === 'array' && typeof value === 'string') {\r\n    try {\r\n      value = eval(value);\r\n      this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, 'invalid-array-' + name);\r\n    } catch (e) {\r\n      value = [];\r\n      console.log(e);\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.sendWarning(\r\n          this.nodeScope.componentOwner.name,\r\n          this.id,\r\n          'invalid-array-' + name,\r\n          {\r\n            showGlobally: true,\r\n            message: 'Invalid array<br>' + e.toString()\r\n          }\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  input.set.call(this, value);\r\n};\r\n\r\nNode.prototype.hasOutput = function (name) {\r\n  return name in this._outputs;\r\n};\r\n\r\nNode.prototype.registerOutput = function (name, output) {\r\n  if (this.hasOutput(name)) {\r\n    throw new Error('Output property ' + name + ' already registered');\r\n  }\r\n\r\n  const newOutput = new OutputProperty({\r\n    owner: this,\r\n    getter: output.get || output.getter,\r\n    name: name,\r\n    onFirstConnectionAdded: output.onFirstConnectionAdded,\r\n    onLastConnectionRemoved: output.onLastConnectionRemoved\r\n  });\r\n\r\n  this._outputs[name] = newOutput;\r\n  this._outputList.push(newOutput);\r\n};\r\n\r\nNode.prototype.deregisterOutput = function (name) {\r\n  if (this.hasOutput(name) === false) {\r\n    throw new Error('Output property ' + name + \" isn't registered\");\r\n  }\r\n\r\n  const output = this._outputs[name];\r\n\r\n  if (output.hasConnections()) {\r\n    throw new Error('Output property ' + name + \" has connections and can't be removed\");\r\n  }\r\n\r\n  delete this._outputs[name];\r\n  var index = this._outputList.indexOf(output);\r\n  this._outputList.splice(index, 1);\r\n};\r\n\r\nNode.prototype.registerOutputs = function (outputs) {\r\n  for (var name in outputs) {\r\n    this.registerOutput(name, outputs[name]);\r\n  }\r\n};\r\n\r\nNode.prototype.registerOutputIfNeeded = function () {\r\n  //noop, can be overriden by subclasses\r\n};\r\n\r\nNode.prototype.getOutput = function (name) {\r\n  if (this.hasOutput(name) === false) {\r\n    throw new Error('Node ' + this.name + \" doesn't have a port named \" + name);\r\n  }\r\n  return this._outputs[name];\r\n};\r\n\r\nNode.prototype.connectInput = function (inputName, sourceNode, sourcePortName) {\r\n  if (this.hasInput(inputName) === false) {\r\n    throw new Error(\r\n      \"Invalid connection, input doesn't exist. Trying to connect from \" +\r\n        sourceNode.name +\r\n        ' output ' +\r\n        sourcePortName +\r\n        ' to ' +\r\n        this.name +\r\n        ' input ' +\r\n        inputName\r\n    );\r\n  }\r\n\r\n  var sourcePort = sourceNode.getOutput(sourcePortName);\r\n  sourcePort.registerConnection(this, inputName);\r\n\r\n  if (!this._inputConnections[inputName]) {\r\n    this._inputConnections[inputName] = [];\r\n  }\r\n\r\n  this._inputConnections[inputName].push(sourcePort);\r\n\r\n  if (sourceNode._signalsSentThisUpdate[sourcePortName]) {\r\n    this._setValueFromConnection(inputName, true);\r\n    this._setValueFromConnection(inputName, false);\r\n  } else {\r\n    var outputValue = sourcePort.value;\r\n    if (outputValue !== undefined) {\r\n      this._setValueFromConnection(inputName, outputValue);\r\n\r\n      if (this.context) {\r\n        // Send value to editor for connection debugging.\r\n        // Conceptually the value has already been sent,\r\n        // but the editor needs to be notified after a connection is created\r\n        this.context.connectionSentValue(sourcePort, sourcePort.value);\r\n      }\r\n    }\r\n  }\r\n\r\n  this.flagDirty();\r\n};\r\n\r\nNode.prototype.removeInputConnection = function (inputName, sourceNodeId, sourcePortName) {\r\n  if (!this._inputConnections[inputName]) {\r\n    throw new Error(\"Node removeInputConnection: Input doesn't exist\");\r\n  }\r\n\r\n  const inputsToPort = this._inputConnections[inputName];\r\n\r\n  for (let i = 0; i < inputsToPort.length; i++) {\r\n    const sourcePort = inputsToPort[i];\r\n    if (sourcePort.owner.id === sourceNodeId && sourcePort.name === sourcePortName) {\r\n      inputsToPort.splice(i, 1);\r\n\r\n      //remove the output from the source node\r\n      const output = sourcePort.owner.getOutput(sourcePortName);\r\n      output.deregisterConnection(this, inputName);\r\n      break;\r\n    }\r\n  }\r\n\r\n  if (inputsToPort.length === 0) {\r\n    //no inputs left, remove the bookkeeping that traces values sent to this node as inputs\r\n    delete this._valuesFromConnections[inputName];\r\n  }\r\n};\r\n\r\nNode.prototype.isInputConnected = function (inputName) {\r\n  if (!this._inputConnections.hasOwnProperty(inputName)) {\r\n    return false;\r\n  }\r\n\r\n  //We have connections, but they might be from non-connected component inputs.\r\n  // If they are from a component input then check the input on the component instance.\r\n  return this._inputConnections[inputName].some((c) => {\r\n    //if this is not a component input, then we have a proper connection\r\n    if (c.owner.name !== 'Component Inputs') return true;\r\n\r\n    //the name of the output from the component input, is the same as the component instance input\r\n    const component = c.owner.nodeScope.componentOwner;\r\n    return component.isInputConnected(c.name);\r\n  });\r\n};\r\n\r\nNode.prototype.update = function () {\r\n  if (this._isUpdating || this._dirty === false) {\r\n    return;\r\n  }\r\n\r\n  if (this._updatedAtIteration !== this.context.updateIteration) {\r\n    this._updatedAtIteration = this.context.updateIteration;\r\n    this._updateIteration = 0;\r\n    if (this._cyclicLoop) this._cyclicLoop = false;\r\n  }\r\n\r\n  this._isUpdating = true;\r\n  const maxUpdateIterations = 100;\r\n\r\n  try {\r\n    while (this._dirty && !this._cyclicLoop) {\r\n      this._updateDependencies();\r\n\r\n      //all inputs are now updated, flag as not dirty\r\n      this._dirty = false;\r\n\r\n      const inputNames = Object.keys(this._inputValuesQueue);\r\n\r\n      let hasMoreInputs = true;\r\n\r\n      while (hasMoreInputs && !this._cyclicLoop) {\r\n        hasMoreInputs = false;\r\n\r\n        for (let i = 0; i < inputNames.length; i++) {\r\n          const inputName = inputNames[i];\r\n          const queue = this._inputValuesQueue[inputName];\r\n          if (queue.length > 0) {\r\n            this.setInputValue(inputName, queue.shift());\r\n            if (queue.length > 0) {\r\n              hasMoreInputs = true;\r\n            }\r\n          }\r\n        }\r\n\r\n        const afterInputCallbacks = this._afterInputsHaveUpdatedCallbacks;\r\n        this._afterInputsHaveUpdatedCallbacks = [];\r\n        for (let i = 0; i < afterInputCallbacks.length; i++) {\r\n          afterInputCallbacks[i].call(this);\r\n        }\r\n      }\r\n      this._updateIteration++;\r\n\r\n      if (this._updateIteration >= maxUpdateIterations) {\r\n        this._cyclicLoop = true;\r\n      }\r\n    }\r\n  } catch (e) {\r\n    this._isUpdating = false;\r\n    throw e;\r\n  }\r\n\r\n  if (this._cyclicLoop) {\r\n    //flag the node as dirty again to let it contiune next frame so we don't just stop it\r\n    //This will allow the browser a chance to render and run other code\r\n    this.context.scheduleNextFrame(() => {\r\n      this.context.nodeIsDirty(this);\r\n    });\r\n\r\n    if (this.context.editorConnection && !this._cyclicWarningSent && this.context.isWarningTypeEnabled('cyclicLoops')) {\r\n      this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'cyclic-loop', {\r\n        showGlobally: true,\r\n        message: 'Cyclic loop detected'\r\n      });\r\n      this._cyclicWarningSent = true;\r\n      console.log('cycle detected', {\r\n        id: this.id,\r\n        name: this.name,\r\n        component: this.nodeScope.componentOwner.name\r\n      });\r\n    }\r\n  }\r\n\r\n  this._isFirstUpdate = false;\r\n  this._isUpdating = false;\r\n};\r\n\r\nNode.prototype._updateDependencies = function () {\r\n  for (var inputName in this._inputConnections) {\r\n    var connectedPorts = this._inputConnections[inputName];\r\n    for (var i = 0; i < connectedPorts.length; ++i) {\r\n      connectedPorts[i].owner.update();\r\n    }\r\n  }\r\n};\r\n\r\nNode.prototype.flagDirty = function () {\r\n  if (this._dirty) {\r\n    return;\r\n  }\r\n\r\n  this._dirty = true;\r\n\r\n  //a hack to not update nodes as a component is being created.\r\n  //Nodes should update once all connections are in place, so inputs that rely on connections, e.g. \"Run\" on a Function node, have the correct context before running.\r\n  //This flag is being updated externally by the NodeScope and _performDirtyUpdate will be called when the component setup is done\r\n  if (this.updateOnDirtyFlagging) {\r\n    this._performDirtyUpdate();\r\n  }\r\n};\r\n\r\nNode.prototype._performDirtyUpdate = function () {\r\n  this.context && this.context.nodeIsDirty(this);\r\n\r\n  for (var i = 0; i < this._outputList.length; ++i) {\r\n    this._outputList[i].flagDependeesDirty();\r\n  }\r\n};\r\n\r\nNode.prototype.sendValue = function (name, value) {\r\n  if (this.hasOutput(name) === false) {\r\n    console.log('Error: Node', this.name, \"doesn't have a output named\", name);\r\n    return;\r\n  }\r\n\r\n  if (value === undefined) {\r\n    return;\r\n  }\r\n\r\n  const output = this.getOutput(name);\r\n  output.sendValue(value);\r\n\r\n  if (this.context) {\r\n    this.context.connectionSentValue(output, value);\r\n  }\r\n};\r\n\r\nNode.prototype.flagOutputDirty = function (name) {\r\n  const output = this.getOutput(name);\r\n  this.sendValue(name, output.value);\r\n};\r\n\r\nNode.prototype.flagAllOutputsDirty = function () {\r\n  for (const output of this._outputList) {\r\n    this.sendValue(output.name, output.value);\r\n  }\r\n};\r\n\r\nNode.prototype.sendSignalOnOutput = function (outputName) {\r\n  if (this.hasOutput(outputName) === false) {\r\n    console.log('Error: Node', this.name, \"doesn't have a output named\", outputName);\r\n    return;\r\n  }\r\n\r\n  const output = this.getOutput(outputName);\r\n  output.sendValue(true);\r\n  output.sendValue(false);\r\n\r\n  this._signalsSentThisUpdate[outputName] = true;\r\n  this.scheduleAfterInputsHaveUpdated(function () {\r\n    this._signalsSentThisUpdate[outputName] = false;\r\n  });\r\n\r\n  if (this.context) {\r\n    this.context.connectionSentSignal(output);\r\n  }\r\n};\r\n\r\nNode.prototype._setValueFromConnection = function (inputName, value) {\r\n  this._valuesFromConnections[inputName] = value;\r\n  this.queueInput(inputName, value);\r\n};\r\n\r\nNode.prototype._hasInputBeenSetFromAConnection = function (inputName) {\r\n  return this._valuesFromConnections.hasOwnProperty(inputName);\r\n};\r\n\r\nNode.prototype.queueInput = function (inputName, value) {\r\n  if (!this._inputValuesQueue[inputName]) {\r\n    this._inputValuesQueue[inputName] = [];\r\n  }\r\n\r\n  //when values are queued during the very first update, make the last value overwrite previous ones\r\n  //so a chain with multiple nodes with values that connect to each other all\r\n  //consolidate to a single value, instead of piling up in the queue\r\n  if (this._isFirstUpdate) {\r\n    //signals need two values, so make sure we don't suppress the 'false' that comes directly\r\n    //after a 'true'\r\n    const queueValue = this._inputValuesQueue[inputName][0];\r\n    const isSignal = queueValue === true; // && value === true;\r\n    if (!isSignal) {\r\n      //default units are set as an object {value, unit}\r\n      //subsequent inputs can be unitless. and will will then overwrite those\r\n      //and the node will get a value without ever getting a unit.\r\n      //To make sure that doesn't happen, look at the value being overwritten\r\n      //and use the unit from that before overwriting\r\n      if (queueValue instanceof Object && queueValue.unit && value instanceof Object === false) {\r\n        value = {\r\n          value,\r\n          unit: queueValue.unit\r\n        };\r\n      }\r\n\r\n      this._inputValuesQueue[inputName].length = 0;\r\n    }\r\n  }\r\n\r\n  this._inputValuesQueue[inputName].push(value);\r\n  this.flagDirty();\r\n};\r\n\r\nNode.prototype.scheduleAfterInputsHaveUpdated = function (callback) {\r\n  this._afterInputsHaveUpdatedCallbacks.push(callback);\r\n  this.flagDirty();\r\n};\r\n\r\nNode.prototype.setNodeModel = function (nodeModel) {\r\n  this.model = nodeModel;\r\n  nodeModel.on('parameterUpdated', this._onNodeModelParameterUpdated, this);\r\n  nodeModel.on('variantUpdated', this._onNodeModelVariantUpdated, this);\r\n\r\n  nodeModel.on(\r\n    'inputPortRemoved',\r\n    (port) => {\r\n      if (this.hasInput(port.name)) {\r\n        this.deregisterInput(port.name);\r\n      }\r\n    },\r\n    this\r\n  );\r\n\r\n  nodeModel.on(\r\n    'outputPortRemoved',\r\n    (port) => {\r\n      if (this.hasOutput(port.name)) {\r\n        this.deregisterOutput(port.name);\r\n      }\r\n    },\r\n    this\r\n  );\r\n};\r\n\r\nNode.prototype.addDeleteListener = function (listener) {\r\n  this._deleteListeners.push(listener);\r\n};\r\n\r\nNode.prototype._onNodeDeleted = function () {\r\n  if (this.model) {\r\n    this.model.removeListenersWithRef(this);\r\n    this.model = undefined;\r\n  }\r\n\r\n  this._deleted = true;\r\n\r\n  for (const deleteListener of this._deleteListeners) {\r\n    deleteListener.call(this);\r\n  }\r\n};\r\n\r\nNode.prototype._onNodeModelParameterUpdated = function (event) {\r\n  this.registerInputIfNeeded(event.name);\r\n\r\n  if (event.value !== undefined) {\r\n    if (event.state) {\r\n      //this parameter is only used in a certain visual state\r\n      //make sure we are in that state before setting it\r\n\r\n      if (!this._getVisualStates) {\r\n        console.log('Node has nos visual states, but got a parameter for state', event.state);\r\n        return;\r\n      }\r\n\r\n      const states = this._getVisualStates();\r\n      if (states.indexOf(event.state) !== -1) {\r\n        this.queueInput(event.name, event.value);\r\n      }\r\n    } else {\r\n      this.queueInput(event.name, event.value);\r\n    }\r\n  } else {\r\n    //parameter is undefined, that means it has been removed and we should reset to default\r\n    let defaultValue;\r\n\r\n    const variant = this.variant;\r\n\r\n    if (event.state) {\r\n      //local value has been reset, check the variant first\r\n      if (\r\n        variant &&\r\n        variant.stateParameters.hasOwnProperty(event.state) &&\r\n        variant.stateParameters[event.state].hasOwnProperty(event.name)\r\n      ) {\r\n        defaultValue = variant.stateParameters[event.state][event.name];\r\n      }\r\n      //and if variant has no value in that state, check for local values in the neutral state\r\n      else if (this.model.parameters.hasOwnProperty(event.name)) {\r\n        defaultValue = this.model.parameters[event.name];\r\n      }\r\n      //and then look in the variant neutral values\r\n      else if (variant && variant.parameters.hasOwnProperty(event.name)) {\r\n        defaultValue = variant.parameters[event.name];\r\n      }\r\n    } else if (variant && variant.parameters.hasOwnProperty(event.name)) {\r\n      defaultValue = variant.parameters[event.name];\r\n    }\r\n\r\n    if (defaultValue === undefined) {\r\n      //get the default value for the port\r\n      defaultValue = this.context.getDefaultValueForInput(this.model.type, event.name);\r\n\r\n      //when a paramter that's used by a text style is reset, Noodl will modify the original dom node, outside of React\r\n      //React will then re-render, and should apply the values from the text style, but won't see any delta in the virtual dom,\r\n      //even though there is a diff to the real dom.\r\n      //to fix that, we just force React to re-render the entire node\r\n      this._resetReactVirtualDOM && this._resetReactVirtualDOM();\r\n    }\r\n\r\n    this.queueInput(event.name, defaultValue);\r\n  }\r\n};\r\n\r\nNode.prototype._onNodeModelVariantUpdated = function (variant) {\r\n  this.setVariant(variant);\r\n};\r\n\r\nmodule.exports = Node;\r\n","'use strict';\r\n\r\nvar EventEmitter = require('./events');\r\nvar NodeRegister = require('./noderegister');\r\nvar TimerScheduler = require('./timerscheduler');\r\nconst Variants = require('./variants');\r\n\r\nfunction NodeContext(args) {\r\n  args = args || {};\r\n  args.runningInEditor = args.hasOwnProperty('runningInEditor') ? args.runningInEditor : false;\r\n\r\n  this._dirtyNodes = [];\r\n  this.callbacksAfterUpdate = [];\r\n\r\n  this.graphModel = args.graphModel;\r\n\r\n  this.platform = args.platform;\r\n\r\n  this.eventEmitter = new EventEmitter();\r\n  this.eventEmitter.setMaxListeners(1000000);\r\n\r\n  this.eventSenderEmitter = new EventEmitter(); //used by event senders and receivers\r\n  this.eventSenderEmitter.setMaxListeners(1000000);\r\n\r\n  this.globalValues = {};\r\n  this.globalsEventEmitter = new EventEmitter();\r\n  this.globalsEventEmitter.setMaxListeners(1000000);\r\n\r\n  this.runningInEditor = args.runningInEditor;\r\n  this.currentFrameTime = 0;\r\n  this.frameNumber = 0;\r\n  this.updateIteration = 0;\r\n\r\n  this.nodeRegister = new NodeRegister(this);\r\n  this.timerScheduler = new TimerScheduler(this.scheduleUpdate.bind(this));\r\n\r\n  this.componentModels = {};\r\n  this.debugInspectorsEnabled = false;\r\n  this.connectionsToPulse = {};\r\n  this.connectionsToPulseChanged = false;\r\n\r\n  this.debugInspectors = {};\r\n\r\n  this.connectionPulsingCallbackScheduled = false;\r\n\r\n  this.editorConnection = args.editorConnection;\r\n\r\n  this.rootComponent = undefined;\r\n\r\n  this._outputHistory = {};\r\n  this._signalHistory = {};\r\n\r\n  this.warningTypes = {}; //default is to send all warning types\r\n\r\n  this.bundleFetchesInFlight = new Map();\r\n\r\n  this.variants = new Variants({\r\n    graphModel: this.graphModel,\r\n    getNodeScope: () => (this.rootComponent ? this.rootComponent.nodeScope : null)\r\n  });\r\n\r\n  if (this.editorConnection) {\r\n    this.editorConnection.on('debugInspectorsUpdated', (inspectors) => {\r\n      this.onDebugInspectorsUpdated(inspectors);\r\n    });\r\n\r\n    this.editorConnection.on('getConnectionValue', ({ clientId, connectionId }) => {\r\n      if (this.editorConnection.clientId !== clientId) return;\r\n      const connection = this._outputHistory[connectionId];\r\n      this.editorConnection.sendConnectionValue(connectionId, connection ? connection.value : undefined);\r\n    });\r\n  }\r\n}\r\n\r\nNodeContext.prototype.setRootComponent = function (rootComponent) {\r\n  this.rootComponent = rootComponent;\r\n};\r\n\r\nNodeContext.prototype.getCurrentTime = function () {\r\n  return this.platform.getCurrentTime();\r\n};\r\n\r\nNodeContext.prototype.onDebugInspectorsUpdated = function (inspectors) {\r\n  if (!this.debugInspectorsEnabled) return;\r\n\r\n  inspectors = inspectors.map((inspector) => {\r\n    if (inspector.type === 'connection') {\r\n      const connection = inspector.connection;\r\n      inspector.id = connection.fromId + connection.fromProperty;\r\n    } else if (inspector.type === 'node') {\r\n      inspector.id = inspector.nodeId;\r\n    }\r\n    return inspector;\r\n  });\r\n\r\n  this.debugInspectors = {};\r\n  inspectors.forEach((inspector) => (this.debugInspectors[inspector.id] = inspector));\r\n\r\n  this.sendDebugInspectorValues();\r\n};\r\n\r\nNodeContext.prototype.updateDirtyNodes = function () {\r\n  var i, len;\r\n\r\n  var loop = true,\r\n    iterations = 0;\r\n\r\n  this.updateIteration++;\r\n\r\n  this.isUpdating = true;\r\n\r\n  while (loop && iterations < 10) {\r\n    var dirtyNodes = this._dirtyNodes;\r\n    this._dirtyNodes = [];\r\n    for (i = 0, len = dirtyNodes.length; i < len; ++i) {\r\n      try {\r\n        if (!dirtyNodes[i]._deleted) {\r\n          dirtyNodes[i].update();\r\n        }\r\n      } catch (e) {\r\n        console.error(e, e.stack);\r\n      }\r\n    }\r\n\r\n    //make a new reference and reset array in case new callbacks are scheduled\r\n    //by the current callbacks\r\n    var callbacks = this.callbacksAfterUpdate;\r\n    this.callbacksAfterUpdate = [];\r\n    for (i = 0, len = callbacks.length; i < len; i++) {\r\n      try {\r\n        callbacks[i]();\r\n      } catch (e) {\r\n        console.error(e);\r\n      }\r\n    }\r\n\r\n    loop = this.callbacksAfterUpdate.length > 0 || this._dirtyNodes.length > 0;\r\n    iterations++;\r\n  }\r\n\r\n  this.isUpdating = false;\r\n};\r\n\r\nNodeContext.prototype.update = function () {\r\n  this.frameNumber++;\r\n\r\n  this.updateDirtyNodes();\r\n\r\n  if (this.timerScheduler.hasPendingTimers()) {\r\n    this.scheduleUpdate();\r\n    this.timerScheduler.runTimers(this.currentFrameTime);\r\n  }\r\n\r\n  if (this.debugInspectorsEnabled) {\r\n    this.sendDebugInspectorValues();\r\n  }\r\n};\r\n\r\nNodeContext.prototype.reset = function () {\r\n  //removes listeners like device orientation, websockets and more\r\n  this.eventEmitter.emit('applicationDataReloaded');\r\n\r\n  var eventEmitter = this.eventEmitter;\r\n  ['frameStart', 'frameEnd'].forEach(function (name) {\r\n    eventEmitter.removeAllListeners(name);\r\n  });\r\n\r\n  this.globalValues = {};\r\n  this._dirtyNodes.length = 0;\r\n  this.callbacksAfterUpdate.length = 0;\r\n\r\n  this.timerScheduler.runningTimers = [];\r\n  this.timerScheduler.newTimers = [];\r\n  this.rootComponent = undefined;\r\n\r\n  this.clearDebugInspectors();\r\n};\r\n\r\nNodeContext.prototype.nodeIsDirty = function (node) {\r\n  this._dirtyNodes.push(node);\r\n  this.scheduleUpdate();\r\n};\r\n\r\nNodeContext.prototype.scheduleUpdate = function () {\r\n  this.eventEmitter.emit('scheduleUpdate');\r\n};\r\n\r\nNodeContext.prototype.scheduleAfterUpdate = function (func) {\r\n  this.callbacksAfterUpdate.push(func);\r\n  this.scheduleUpdate();\r\n};\r\n\r\nNodeContext.prototype.scheduleNextFrame = function (func) {\r\n  this.eventEmitter.once('frameStart', func);\r\n  this.scheduleUpdate();\r\n};\r\n\r\nNodeContext.prototype.setGlobalValue = function (name, value) {\r\n  this.globalValues[name] = value;\r\n  this.globalsEventEmitter.emit(name);\r\n};\r\n\r\nNodeContext.prototype.getGlobalValue = function (name) {\r\n  return this.globalValues[name];\r\n};\r\n\r\nNodeContext.prototype.registerComponentModel = function (componentModel) {\r\n  if (this.componentModels.hasOwnProperty(componentModel.name)) {\r\n    throw new Error('Duplicate component name ' + componentModel.name);\r\n  }\r\n  this.componentModels[componentModel.name] = componentModel;\r\n\r\n  var self = this;\r\n  componentModel.on(\r\n    'renamed',\r\n    function (event) {\r\n      delete self.componentModels[event.oldName];\r\n      self.componentModels[event.newName] = componentModel;\r\n    },\r\n    this\r\n  );\r\n};\r\n\r\nNodeContext.prototype.deregisterComponentModel = function (componentModel) {\r\n  if (this.componentModels.hasOwnProperty(componentModel.name)) {\r\n    this.componentModels[componentModel.name].removeListenersWithRef(this);\r\n    delete this.componentModels[componentModel.name];\r\n  }\r\n};\r\n\r\nNodeContext.prototype.fetchComponentBundle = async function (name) {\r\n  const fetchBundle = async (name) => {\r\n    let baseUrl = Noodl.Env['BaseUrl'] || '/';\r\n    let bundleUrl = `${baseUrl}noodl_bundles/${name}.json`;\r\n\r\n    const response = await fetch(bundleUrl);\r\n    if (response.status === 404) {\r\n      throw new Error('Component not found ' + name);\r\n    }\r\n\r\n    const data = await response.json();\r\n    for (const component of data) {\r\n      if (this.graphModel.hasComponentWithName(component.name) === false) {\r\n        await this.graphModel.importComponentFromEditorData(component);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (this.bundleFetchesInFlight.has(name)) {\r\n    await this.bundleFetchesInFlight.get(name);\r\n  } else {\r\n    const promise = fetchBundle(name);\r\n    this.bundleFetchesInFlight.set(name, promise);\r\n    await promise;\r\n    //the promise is kept in bundleFetchesInFlight to mark what bundles have been downloaded\r\n    //so eventual future requests will just await the resolved promise and resolve immediately\r\n  }\r\n};\r\n\r\nNodeContext.prototype.getComponentModel = async function (name) {\r\n  if (!name) {\r\n    throw new Error('Component instance must have a name');\r\n  }\r\n\r\n  if (this.componentModels.hasOwnProperty(name) === false) {\r\n    const bundleName = this.graphModel.getBundleContainingComponent(name);\r\n    if (!bundleName) {\r\n      throw new Error(\"Can't find component model for \" + name);\r\n    }\r\n\r\n    //start fetching dependencies in the background\r\n    for (const bundleDep of this.graphModel.getBundleDependencies(bundleName)) {\r\n      this.fetchComponentBundle(bundleDep);\r\n    }\r\n\r\n    //and wait for the bundle that has the component we need\r\n    await this.fetchComponentBundle(bundleName);\r\n  }\r\n\r\n  return this.componentModels[name];\r\n};\r\n\r\nNodeContext.prototype.hasComponentModelWithName = function (name) {\r\n  return this.componentModels.hasOwnProperty(name);\r\n};\r\n\r\nNodeContext.prototype.createComponentInstanceNode = async function (componentName, id, nodeScope, extraProps) {\r\n  var ComponentInstanceNode = require('./nodes/componentinstance');\r\n  var node = new ComponentInstanceNode(this, id, nodeScope);\r\n  node.name = componentName;\r\n\r\n  for (const prop in extraProps) {\r\n    node[prop] = extraProps[prop];\r\n  }\r\n\r\n  const componentModel = await this.getComponentModel(componentName);\r\n  await node.setComponentModel(componentModel);\r\n\r\n  return node;\r\n};\r\n\r\nNodeContext.prototype._formatConnectionValue = function (value) {\r\n  if (typeof value === 'object' && value && value.constructor && value.constructor.name === 'Node') {\r\n    value = '<Node> ' + value.name;\r\n  } else if (typeof value === 'object' && typeof window !== 'undefined' && value instanceof HTMLElement) {\r\n    value = `DOM Node <${value.tagName}>`;\r\n  } else if (typeof value === 'string' && !value.startsWith('[Signal]')) {\r\n    return '\"' + value + '\"';\r\n  } else if (Number.isNaN(value)) {\r\n    return 'NaN';\r\n  }\r\n\r\n  return value;\r\n};\r\n\r\nNodeContext.prototype.connectionSentValue = function (output, value) {\r\n  if (!this.editorConnection || !this.editorConnection.isConnected() || !this.debugInspectorsEnabled) {\r\n    return;\r\n  }\r\n\r\n  const timestamp = this.getCurrentTime();\r\n\r\n  this._outputHistory[output.id] = {\r\n    value,\r\n    timestamp\r\n  };\r\n\r\n  if (this.connectionsToPulse.hasOwnProperty(output.id)) {\r\n    this.connectionsToPulse[output.id].timestamp = timestamp;\r\n    return;\r\n  }\r\n\r\n  const connections = [];\r\n\r\n  output.connections.forEach((connection) => {\r\n    connections.push(output.owner.id + output.name + connection.node.id + connection.inputPortName);\r\n  });\r\n\r\n  this.connectionsToPulse[output.id] = {\r\n    timestamp,\r\n    connections: connections\r\n  };\r\n\r\n  this.connectionsToPulseChanged = true;\r\n\r\n  if (this.connectionPulsingCallbackScheduled === false) {\r\n    this.connectionPulsingCallbackScheduled = true;\r\n    setTimeout(this.clearOldConnectionPulsing.bind(this), 100);\r\n  }\r\n};\r\n\r\nNodeContext.prototype.connectionSentSignal = function (output) {\r\n  const id = output.id;\r\n  if (!this._signalHistory.hasOwnProperty(id)) {\r\n    this._signalHistory[id] = {\r\n      count: 0\r\n    };\r\n  }\r\n\r\n  this._signalHistory[id].count++;\r\n\r\n  this.connectionSentValue(output, '[Signal] Trigger count ' + this._signalHistory[id].count);\r\n};\r\n\r\nNodeContext.prototype.clearDebugInspectors = function () {\r\n  this.debugInspectors = {};\r\n  this.connectionsToPulse = {};\r\n\r\n  this.editorConnection.sendPulsingConnections(this.connectionsToPulse);\r\n};\r\n\r\nNodeContext.prototype.clearOldConnectionPulsing = function () {\r\n  this.connectionPulsingCallbackScheduled = false;\r\n\r\n  var now = this.getCurrentTime();\r\n  var self = this;\r\n\r\n  var connectionIds = Object.keys(this.connectionsToPulse);\r\n  connectionIds.forEach(function (id) {\r\n    var con = self.connectionsToPulse[id];\r\n    if (now - con.timestamp > 100) {\r\n      self.connectionsToPulseChanged = true;\r\n      delete self.connectionsToPulse[id];\r\n    }\r\n  });\r\n\r\n  if (this.connectionsToPulseChanged) {\r\n    this.connectionsToPulseChanged = false;\r\n    this.editorConnection.sendPulsingConnections(this.connectionsToPulse);\r\n  }\r\n\r\n  if (Object.keys(this.connectionsToPulse).length > 0) {\r\n    this.connectionPulsingCallbackScheduled = true;\r\n    setTimeout(this.clearOldConnectionPulsing.bind(this), 500);\r\n  }\r\n};\r\n\r\nNodeContext.prototype._getDebugInspectorValueForNode = function (id) {\r\n  if (!this.rootComponent) return;\r\n  const nodes = this.rootComponent.nodeScope.getNodesWithIdRecursive(id);\r\n  const node = nodes[nodes.length - 1];\r\n\r\n  if (node && node.getInspectInfo) {\r\n    const info = node.getInspectInfo();\r\n    if (info !== undefined) {\r\n      return { type: 'node', id, value: info };\r\n    }\r\n  }\r\n};\r\n\r\nNodeContext.prototype.sendDebugInspectorValues = function () {\r\n  const valuesToSend = [];\r\n\r\n  for (const id in this.debugInspectors) {\r\n    const inspector = this.debugInspectors[id];\r\n\r\n    if (inspector.type === 'connection' && this._outputHistory.hasOwnProperty(id)) {\r\n      const value = this._outputHistory[id].value;\r\n\r\n      valuesToSend.push({\r\n        type: 'connection',\r\n        id,\r\n        value: this._formatConnectionValue(value)\r\n      });\r\n    } else if (inspector.type === 'node') {\r\n      const inspectorValue = this._getDebugInspectorValueForNode(id);\r\n      inspectorValue && valuesToSend.push(inspectorValue);\r\n    }\r\n  }\r\n\r\n  if (valuesToSend.length > 0) {\r\n    this.editorConnection.sendDebugInspectorValues(valuesToSend);\r\n  }\r\n\r\n  if (this.connectionsToPulseChanged) {\r\n    this.connectionsToPulseChanged = false;\r\n    this.editorConnection.sendPulsingConnections(this.connectionsToPulse);\r\n  }\r\n};\r\n\r\nNodeContext.prototype.setDebugInspectorsEnabled = function (enabled) {\r\n  this.debugInspectorsEnabled = enabled;\r\n  this.editorConnection.debugInspectorsEnabled = enabled;\r\n  if (enabled) {\r\n    this.sendDebugInspectorValues();\r\n  }\r\n};\r\n\r\nNodeContext.prototype.sendGlobalEventFromEventSender = function (channelName, inputValues) {\r\n  this.eventSenderEmitter.emit(channelName, inputValues);\r\n};\r\n\r\nNodeContext.prototype.setPopupCallbacks = function ({ onShow, onClose }) {\r\n  this.onShowPopup = onShow;\r\n  this.onClosePopup = onClose;\r\n};\r\n\r\n/**\r\n * @param {string} popupComponent\r\n * @param {Record<string, unknown>} params\r\n * @param {{\r\n *  senderNode?: unknown;\r\n *  onClosePopup?: (action?: string, results: object) => void;\r\n * }} args\r\n * @returns\r\n */\r\nNodeContext.prototype.showPopup = async function (popupComponent, params, args) {\r\n  if (!this.onShowPopup) return;\r\n\r\n  const nodeScope = this.rootComponent.nodeScope;\r\n\r\n  const popupNode = await nodeScope.createNode(popupComponent);\r\n  for (const inputKey in params) {\r\n    popupNode.setInputValue(inputKey, params[inputKey]);\r\n  }\r\n\r\n  popupNode.popupParent = args?.senderNode || null;\r\n\r\n  // Create container group\r\n  const group = nodeScope.createPrimitiveNode('Group');\r\n  group.setInputValue('flexDirection', 'node');\r\n  group.setInputValue('cssClassName', 'noodl-popup');\r\n\r\n  const bodyScroll = this.graphModel.getSettings().bodyScroll;\r\n\r\n  //if the body can scroll the position of the popup needs to be fixed.\r\n  group.setInputValue('position', bodyScroll ? 'fixed' : 'absolute');\r\n\r\n  var closePopupNodes = popupNode.nodeScope.getNodesWithType('NavigationClosePopup');\r\n  if (closePopupNodes && closePopupNodes.length > 0) {\r\n    for (var j = 0; j < closePopupNodes.length; j++) {\r\n      closePopupNodes[j]._setCloseCallback((action, results) => {\r\n        //close next frame so all nodes have a chance to update before being deleted\r\n        this.scheduleNextFrame(() => {\r\n          //avoid double callbacks\r\n          if (!nodeScope.hasNodeWithId(group.id)) return;\r\n\r\n          this.onClosePopup(group);\r\n          nodeScope.deleteNode(group);\r\n          args && args.onClosePopup && args.onClosePopup(action, results);\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  this.onShowPopup(group);\r\n\r\n  requestAnimationFrame(() => {\r\n    //hack to make the react components have the right props\r\n    //TODO: figure out why this requestAnimationFrame is necessary\r\n    group.addChild(popupNode);\r\n  });\r\n};\r\n\r\nNodeContext.prototype.setWarningTypes = function (warningTypes) {\r\n  Object.assign(this.warningTypes, warningTypes);\r\n};\r\n\r\nNodeContext.prototype.isWarningTypeEnabled = function (warning) {\r\n  if (!this.warningTypes.hasOwnProperty(warning)) {\r\n    //if a level isn't set, default to true\r\n    return true;\r\n  }\r\n\r\n  return this.warningTypes[warning] ? true : false;\r\n};\r\n\r\nNodeContext.prototype.getDefaultValueForInput = function (nodeType, inputName) {\r\n  if (this.nodeRegister.hasNode(nodeType) === false) {\r\n    return undefined;\r\n  }\r\n\r\n  const nodeMetadata = this.nodeRegister.getNodeMetadata(nodeType);\r\n  const inputMetadata = nodeMetadata.inputs[inputName];\r\n\r\n  if (!inputMetadata) {\r\n    return undefined;\r\n  }\r\n\r\n  if (inputMetadata.type.defaultUnit) {\r\n    return {\r\n      value: inputMetadata.default,\r\n      unit: inputMetadata.type.defaultUnit\r\n    };\r\n  }\r\n\r\n  return inputMetadata.default;\r\n};\r\n\r\nmodule.exports = NodeContext;\r\n","const Node = require('./node'),\r\n  EdgeTriggeredInput = require('./edgetriggeredinput');\r\n\r\nfunction registerInput(object, metadata, name, input) {\r\n  if (object.hasOwnProperty(name)) {\r\n    throw new Error('Input property ' + name + ' already registered');\r\n  }\r\n\r\n  if (!input.set && !input.valueChangedToTrue) {\r\n    input.set = () => {};\r\n  }\r\n\r\n  if (input.set) {\r\n    object[name] = {\r\n      set: input.set\r\n    };\r\n\r\n    //types to keep in the input on the node instances\r\n    //color and textStyles are used for style updates\r\n    //array is for supporting eval:ing strings\r\n    const typesToSaveInInput = ['color', 'textStyle', 'array'];\r\n\r\n    typesToSaveInInput.forEach((type) => {\r\n      if (input.type && (input.type === type || input.type.name === type)) {\r\n        object[name].type = type;\r\n      }\r\n    });\r\n  }\r\n\r\n  if (input.setUnitType) {\r\n    object[name].setUnitType = input.setUnitType;\r\n  }\r\n\r\n  metadata.inputs[name] = {\r\n    displayName: input.displayName,\r\n    editorName: input.editorName,\r\n    group: input.group,\r\n    type: input.type,\r\n    default: input.default,\r\n    index: input.index,\r\n    exportToEditor: input.hasOwnProperty('exportToEditor') ? input.exportToEditor : true,\r\n    inputPriority: input.inputPriority || 0,\r\n    tooltip: input.tooltip,\r\n    tab: input.tab,\r\n    popout: input.popout,\r\n    allowVisualStates: input.allowVisualStates,\r\n    nodeDoubleClickAction: input.nodeDoubleClickAction\r\n  };\r\n\r\n  if (input.valueChangedToTrue) {\r\n    metadata.inputs[name].type = {\r\n      name: 'signal',\r\n      allowConnectionsOnly: true\r\n    };\r\n  }\r\n}\r\n\r\nfunction registerInputs(object, metadata, inputs) {\r\n  Object.keys(inputs).forEach(function (inputName) {\r\n    registerInput(object, metadata, inputName, inputs[inputName]);\r\n  });\r\n}\r\n\r\nfunction registerNumberedInputs(node, numberedInputs) {\r\n  for (const inputName of Object.keys(numberedInputs)) {\r\n    registerNumberedInput(node, inputName, numberedInputs[inputName]);\r\n  }\r\n}\r\n\r\nfunction registerNumberedInput(node, name, input) {\r\n  const oldRegisterInputIfNeeded = node.registerInputIfNeeded;\r\n\r\n  node.registerInputIfNeeded = function (inputName) {\r\n    if (oldRegisterInputIfNeeded) {\r\n      oldRegisterInputIfNeeded.call(node, inputName);\r\n    }\r\n\r\n    if (node.hasInput(inputName) || !inputName.startsWith(name)) {\r\n      return;\r\n    }\r\n\r\n    const index = Number(inputName.slice(name.length + 1)); // inputName is \"nameOfInput xxx\" where xxx is the index\r\n\r\n    node.registerInput(inputName, {\r\n      type: input.type,\r\n      set: input.createSetter.call(node, index)\r\n    });\r\n  };\r\n}\r\n\r\nfunction registerOutputsMetadata(metadata, outputs) {\r\n  Object.keys(outputs).forEach(function (name) {\r\n    var output = outputs[name];\r\n\r\n    metadata.outputs[name] = {\r\n      displayName: output.displayName,\r\n      editorName: output.editorName,\r\n      group: output.group,\r\n      type: output.type,\r\n      index: output.index,\r\n      exportToEditor: output.hasOwnProperty('exportToEditor') ? output.exportToEditor : true\r\n    };\r\n  });\r\n}\r\n\r\nfunction initializeDefaultValues(defaultValues, inputsMetadata) {\r\n  Object.keys(inputsMetadata).forEach((name) => {\r\n    const defaultValue = inputsMetadata[name].default;\r\n    if (defaultValue === undefined) return;\r\n\r\n    if (inputsMetadata[name].type.defaultUnit) {\r\n      defaultValues[name] = {\r\n        unit: inputsMetadata[name].type.defaultUnit,\r\n        value: defaultValue\r\n      };\r\n    } else {\r\n      defaultValues[name] = defaultValue;\r\n    }\r\n  });\r\n}\r\n\r\nfunction defineNode(opts) {\r\n  if (!opts.category) {\r\n    throw new Error('Node must have a category');\r\n  }\r\n\r\n  if (!opts.name) {\r\n    throw new Error('Node must have a name');\r\n  }\r\n\r\n  const metadata = {\r\n    inputs: {},\r\n    outputs: {},\r\n    category: opts.category,\r\n    dynamicports: opts.dynamicports,\r\n    exportDynamicPorts: opts.exportDynamicPorts,\r\n    useVariants: opts.useVariants,\r\n    allowChildren: opts.allowChildren,\r\n    allowChildrenWithCategory: opts.allowChildrenWithCategory,\r\n    singleton: opts.singleton,\r\n    connectionPanel: opts.connectionPanel,\r\n    allowAsChild: opts.allowAsChild,\r\n    visualStates: opts.visualStates,\r\n    panels: opts.panels,\r\n    color: opts.color,\r\n    usePortAsLabel: opts.usePortAsLabel,\r\n    portLabelTruncationMode: opts.portLabelTruncationMode,\r\n    name: opts.name,\r\n    displayNodeName: opts.displayNodeName || opts.displayName,\r\n    deprecated: opts.deprecated,\r\n    haveComponentPorts: opts.haveComponentPorts,\r\n    version: opts.version,\r\n    module: opts.module,\r\n    docs: opts.docs,\r\n    allowAsExportRoot: opts.allowAsExportRoot,\r\n    nodeDoubleClickAction: opts.nodeDoubleClickAction,\r\n    searchTags: opts.searchTags\r\n  };\r\n\r\n  opts._internal = opts._internal || {};\r\n\r\n  //prototypeExtensions - old API\r\n  //methods - new API\r\n  opts.prototypeExtensions = opts.methods || opts.prototypeExtensions || {};\r\n  opts.inputs = opts.inputs || {};\r\n  opts.outputs = opts.outputs || {};\r\n  opts.initialize = opts.initialize || function () {};\r\n\r\n  let inputs = {};\r\n\r\n  registerInputs(inputs, metadata, opts.inputs);\r\n  registerOutputsMetadata(metadata, opts.outputs);\r\n  function NodeConstructor(context, id) {\r\n    Node.call(this, context, id);\r\n  }\r\n\r\n  Object.keys(opts.prototypeExtensions).forEach(function (propName) {\r\n    if (!opts.prototypeExtensions[propName].value) {\r\n      opts.prototypeExtensions[propName] = {\r\n        value: opts.prototypeExtensions[propName]\r\n      };\r\n    }\r\n  });\r\n\r\n  NodeConstructor.prototype = Object.create(Node.prototype, opts.prototypeExtensions);\r\n  Object.defineProperty(NodeConstructor.prototype, 'name', {\r\n    value: opts.name\r\n  });\r\n\r\n  if (opts.getInspectInfo) NodeConstructor.prototype.getInspectInfo = opts.getInspectInfo;\r\n  if (opts.nodeScopeDidInitialize) NodeConstructor.prototype.nodeScopeDidInitialize = opts.nodeScopeDidInitialize;\r\n\r\n  const nodeDefinition = function (context, id, nodeScope) {\r\n    const node = new NodeConstructor(context, id);\r\n\r\n    //create all inputs. Use the inputs object for setters that don't have state and can be shared\r\n    node._inputs = Object.create(inputs);\r\n\r\n    //all inputs that use the valueChangedToTrue have state and need to be instanced\r\n    Object.keys(opts.inputs).forEach(function (name) {\r\n      var input = opts.inputs[name];\r\n      if (input.valueChangedToTrue) {\r\n        node._inputs[name] = {\r\n          set: EdgeTriggeredInput.createSetter({\r\n            valueChangedToTrue: input.valueChangedToTrue\r\n          })\r\n        };\r\n      }\r\n    });\r\n\r\n    Object.keys(opts.outputs).forEach(function (name) {\r\n      var output = opts.outputs[name];\r\n      if (output.type === 'signal') {\r\n        node.registerOutput(name, {\r\n          getter: function () {\r\n            //signals are always emitted as a sequence of false, true, so this getter is never used\r\n            return undefined;\r\n          }\r\n        });\r\n      } else {\r\n        node.registerOutput(name, output);\r\n      }\r\n    });\r\n\r\n    opts.numberedInputs && registerNumberedInputs(node, opts.numberedInputs);\r\n\r\n    node.nodeScope = nodeScope;\r\n    initializeDefaultValues(node._inputValues, metadata.inputs);\r\n\r\n    opts.initialize.call(node);\r\n\r\n    return node;\r\n  };\r\n\r\n  nodeDefinition.metadata = metadata;\r\n\r\n  if (opts.numberedInputs) registerSetupFunctionForNumberedInputs(nodeDefinition, opts.name, opts.numberedInputs);\r\n\r\n  return nodeDefinition;\r\n}\r\n\r\nfunction registerSetupFunctionForNumberedInputs(nodeDefinition, nodeType, numberedInputs) {\r\n  const inputNames = Object.keys(numberedInputs);\r\n\r\n  if (!inputNames.length) return;\r\n\r\n  nodeDefinition.setupNumberedInputDynamicPorts = function (context, graphModel) {\r\n    const editorConnection = context.editorConnection;\r\n\r\n    if (!editorConnection || !editorConnection.isRunningLocally()) {\r\n      return;\r\n    }\r\n\r\n    function collectPorts(node, inputName, input) {\r\n      const connections = node.component.getConnectionsTo(node.id).map((c) => c.targetPort);\r\n\r\n      const allPortNames = Object.keys(node.parameters).concat(connections);\r\n      const portNames = allPortNames.filter((p) => p.startsWith(inputName + ' '));\r\n\r\n      //Figure out how many we need to create\r\n      //It needs to be the highest index + 1\r\n      //Only parameters with values are present, e.g. input 3 can be missing even if input 4 is defined\r\n      const maxIndex = portNames.length\r\n        ? 1 + Math.max(...portNames.map((p) => Number(p.slice(inputName.length + 1))))\r\n        : 0;\r\n      const numPorts = maxIndex + 1;\r\n\r\n      const ports = [];\r\n\r\n      for (let i = 0; i < numPorts; i++) {\r\n        const port = {\r\n          name: inputName + ' ' + i,\r\n          displayName: (input.displayPrefix || inputName) + ' ' + i,\r\n          type: input.type,\r\n          plug: 'input',\r\n          group: input.group\r\n        };\r\n\r\n        if (input.hasOwnProperty('index')) {\r\n          port.index = input.index + i;\r\n        }\r\n\r\n        ports.push(port);\r\n      }\r\n\r\n      return ports;\r\n    }\r\n\r\n    function updatePorts(node) {\r\n      const ports = inputNames.map((inputName) => collectPorts(node, inputName, numberedInputs[inputName])).flat();\r\n      editorConnection.sendDynamicPorts(node.id, ports);\r\n    }\r\n\r\n    graphModel.on('nodeAdded.' + nodeType, (node) => {\r\n      updatePorts(node);\r\n      node.on('parameterUpdated', () => {\r\n        updatePorts(node);\r\n      });\r\n\r\n      node.on('inputConnectionAdded', () => {\r\n        updatePorts(node);\r\n      });\r\n\r\n      node.on('inputConnectionRemoved', () => {\r\n        updatePorts(node);\r\n      });\r\n    });\r\n  };\r\n}\r\n\r\nfunction extend(obj1, obj2) {\r\n  for (var p in obj2) {\r\n    if (p === 'initialize' && obj1.initialize) {\r\n      var oldInit = obj1.initialize;\r\n      obj1.initialize = function () {\r\n        oldInit.call(this);\r\n        obj2.initialize.call(this);\r\n      };\r\n    } else if (obj2[p] && obj2[p].constructor === Object) {\r\n      obj1[p] = extend(obj1[p] || {}, obj2[p]);\r\n    } else if (obj2[p] && obj2[p].constructor === Array && obj1[p] && obj1[p].constructor == Array) {\r\n      obj1[p] = obj1[p].concat(obj2[p]);\r\n    } else {\r\n      obj1[p] = obj2[p];\r\n    }\r\n  }\r\n  return obj1;\r\n}\r\n\r\nmodule.exports = {\r\n  defineNode: defineNode,\r\n  extend: extend\r\n};\r\n","'use strict';\r\n\r\nfunction formatDynamicPorts(nodeMetadata) {\r\n  const dynamicports = [];\r\n\r\n  for (const dp of nodeMetadata.dynamicports) {\r\n    if (dp.ports || dp.template || dp.port || dp.channelPort) {\r\n      //same format as editor expects, no need to transform it\r\n      dynamicports.push(dp);\r\n    } else if (dp.inputs || dp.outputs) {\r\n      //inputs and outputs is just list of names\r\n      //need to pull the metadata from the inputs/outputs since they\r\n      //won't be registered by the editor (it's either a regular port\r\n      // or a dynamic port, can't register both)\r\n      const ports = [];\r\n\r\n      if (dp.inputs) {\r\n        for (const inputName of dp.inputs) {\r\n          ports.push(formatPort(inputName, nodeMetadata.inputs[inputName], 'input'));\r\n        }\r\n      }\r\n\r\n      if (dp.outputs) {\r\n        for (const outputName of dp.outputs) {\r\n          ports.push(formatPort(outputName, nodeMetadata.outputs[outputName], 'output'));\r\n        }\r\n      }\r\n\r\n      const dynamicPortGroup = {\r\n        name: dp.name || 'conditionalports/basic',\r\n        condition: dp.condition,\r\n        ports\r\n      };\r\n\r\n      dynamicports.push(dynamicPortGroup);\r\n    }\r\n  }\r\n\r\n  return dynamicports;\r\n}\r\n\r\nfunction formatPort(portName, portData, plugType) {\r\n  var port = {\r\n    name: portName,\r\n    type: portData.type,\r\n    plug: plugType\r\n  };\r\n  if (portData.group) {\r\n    port.group = portData.group;\r\n  }\r\n  if (portData.displayName) {\r\n    port.displayName = portData.displayName;\r\n  }\r\n  if (portData.description) {\r\n    port.description = portData.description;\r\n  }\r\n  if (portData.editorName) {\r\n    port.editorName = portData.editorName;\r\n  }\r\n  if (portData.default !== undefined) {\r\n    port.default = portData.default;\r\n  }\r\n  if (portData.hasOwnProperty('index')) {\r\n    port.index = portData.index;\r\n  }\r\n  if (portData.tooltip) {\r\n    port.tooltip = portData.tooltip;\r\n  }\r\n  if (portData.tab) {\r\n    port.tab = portData.tab;\r\n  }\r\n  if (portData.popout) {\r\n    port.popout = portData.popout;\r\n  }\r\n  if (portData.allowVisualStates) {\r\n    port.allowVisualStates = portData.allowVisualStates;\r\n  }\r\n  return port;\r\n}\r\n\r\nfunction generateNodeLibrary(nodeRegister) {\r\n  var obj = {\r\n    //note: needs to include ALL types\r\n    typecasts: [\r\n      {\r\n        from: 'string',\r\n        to: ['number', 'boolean', 'image', 'color', 'enum', 'textStyle', 'dimension', 'array', 'object']\r\n      },\r\n      {\r\n        from: 'boolean',\r\n        to: ['number', 'string', 'signal']\r\n      },\r\n      {\r\n        from: 'number',\r\n        to: ['boolean', 'string', 'dimension']\r\n      },\r\n      {\r\n        from: 'date',\r\n        to: ['string']\r\n      },\r\n      {\r\n        from: 'signal',\r\n        to: ['boolean', 'number']\r\n      },\r\n      {\r\n        from: 'image',\r\n        to: []\r\n      },\r\n      {\r\n        from: 'cloudfile',\r\n        to: ['string', 'image']\r\n      },\r\n      {\r\n        from: 'color',\r\n        to: []\r\n      },\r\n      {\r\n        from: 'enum',\r\n        to: []\r\n      },\r\n      {\r\n        from: 'object',\r\n        to: []\r\n      },\r\n      {\r\n        from: 'domelement',\r\n        to: []\r\n      },\r\n      {\r\n        from: 'reference',\r\n        to: []\r\n      },\r\n      {\r\n        from: 'font',\r\n        to: []\r\n      },\r\n      {\r\n        from: 'textStyle',\r\n        to: ['string']\r\n      },\r\n      {\r\n        // Collection is deprecated but supported via typecasts\r\n        from: 'collection',\r\n        to: ['array']\r\n      },\r\n      {\r\n        from: 'array',\r\n        to: ['collection']\r\n      }\r\n    ],\r\n    dynamicports: [\r\n      {\r\n        type: 'conditionalports',\r\n        name: 'basic'\r\n      },\r\n      {\r\n        type: 'expand',\r\n        name: 'basic'\r\n      }\r\n    ],\r\n    colors: {\r\n      nodes: {\r\n        component: {\r\n          base: '#643D8B',\r\n          baseHighlighted: '#79559b',\r\n          header: '#4E2877',\r\n          headerHighlighted: '#643d8b',\r\n          outline: '#4E2877',\r\n          outlineHighlighted: '#b58900',\r\n          text: '#dbd0e4'\r\n        },\r\n        visual: {\r\n          base: '#315272',\r\n          baseHighlighted: '#4d6784',\r\n          header: '#173E5D',\r\n          headerHighlighted: '#315272',\r\n          outline: '#173E5D',\r\n          outlineHighlighted: '#b58900',\r\n          text: '#cfd5de'\r\n        },\r\n        data: {\r\n          base: '#465524',\r\n          baseHighlighted: '#5b6a37',\r\n          header: '#314110',\r\n          headerHighlighted: '#465524',\r\n          outline: '#314110',\r\n          outlineHighlighted: '#b58900',\r\n          text: '#d2d6c5'\r\n        },\r\n        javascript: {\r\n          base: '#7E3660',\r\n          baseHighlighted: '#944e74',\r\n          header: '#67214B',\r\n          headerHighlighted: '#7e3660',\r\n          outline: '#67214B',\r\n          outlineHighlighted: '#d57bab',\r\n          text: '#e4cfd9'\r\n        },\r\n        default: {\r\n          base: '#4C4F59',\r\n          baseHighlighted: '#62656e',\r\n          header: '#373B45',\r\n          headerHighlighted: '#4c4f59',\r\n          outline: '#373B45',\r\n          outlineHighlighted: '#b58900',\r\n          text: '#d3d4d6'\r\n        }\r\n      },\r\n      connections: {\r\n        signal: {\r\n          normal: '#006f82',\r\n          highlighted: '#7ec2cf',\r\n          pulsing: '#ffffff'\r\n        },\r\n        default: {\r\n          normal: '#875d00',\r\n          highlighted: '#e5ae32',\r\n          pulsing: '#ffffff'\r\n        }\r\n      }\r\n    },\r\n    nodetypes: [\r\n      {\r\n        name: 'Component Children',\r\n        shortDesc: 'This node is a placeholder for where children of this component will be inserted.',\r\n        docs: 'https://docs.noodl.net/nodes/component-utilities/component-children',\r\n        color: 'component',\r\n        allowAsChild: true,\r\n        category: 'Visual',\r\n        haveComponentChildren: ['Visual']\r\n      }\r\n    ]\r\n  };\r\n\r\n  var nodeTypes = Object.keys(nodeRegister._constructors);\r\n\r\n  nodeTypes.forEach(function (type) {\r\n    var nodeMetadata = nodeRegister._constructors[type].metadata;\r\n\r\n    var nodeObj = {\r\n      name: type,\r\n      searchTags: nodeMetadata.searchTags\r\n    };\r\n    obj.nodetypes.push(nodeObj);\r\n\r\n    if (nodeMetadata.version) {\r\n      nodeObj.version = nodeMetadata.version;\r\n    }\r\n    if (nodeMetadata.displayNodeName) {\r\n      nodeObj.displayNodeName = nodeMetadata.displayNodeName;\r\n    }\r\n    if (nodeMetadata.nodeDoubleClickAction) {\r\n      nodeObj.nodeDoubleClickAction = nodeMetadata.nodeDoubleClickAction;\r\n    }\r\n    if (nodeMetadata.shortDesc) {\r\n      nodeObj.shortDesc = nodeMetadata.shortDesc;\r\n    }\r\n    if (nodeMetadata.module) {\r\n      nodeObj.module = nodeMetadata.module;\r\n    }\r\n    if (nodeMetadata.deprecated) {\r\n      nodeObj.deprecated = true;\r\n    }\r\n    if (nodeMetadata.haveComponentPorts) {\r\n      nodeObj.haveComponentPorts = true;\r\n    }\r\n    if (nodeMetadata.category === 'Visual') {\r\n      nodeObj.allowAsChild = true;\r\n      nodeObj.allowAsExportRoot = true;\r\n      nodeObj.color = 'visual';\r\n    }\r\n\r\n    if (nodeMetadata.allowAsExportRoot !== undefined) {\r\n      nodeObj.allowAsExportRoot = nodeMetadata.allowAsExportRoot;\r\n    }\r\n\r\n    if (nodeMetadata.allowChildren) {\r\n      nodeObj.allowChildrenWithCategory = ['Visual'];\r\n      nodeObj.color = 'visual';\r\n    }\r\n    if (nodeMetadata.allowChildrenWithCategory) {\r\n      nodeObj.allowChildrenWithCategory = nodeMetadata.allowChildrenWithCategory;\r\n    }\r\n    if (nodeMetadata.singleton) {\r\n      nodeObj.singleton = true;\r\n    }\r\n    if (nodeMetadata.allowAsChild) {\r\n      nodeObj.allowAsChild = true;\r\n    }\r\n    if (nodeMetadata.docs) {\r\n      nodeObj.docs = nodeMetadata.docs;\r\n    }\r\n    if (nodeMetadata.shortDocs) {\r\n      nodeObj.shortDocs = nodeMetadata.shortDocs;\r\n    } else if (nodeMetadata.docs && nodeMetadata.docs.indexOf('https://docs.noodl.net') === 0) {\r\n      nodeObj.shortDocs = nodeMetadata.docs.replace('/#', '') + '-short.md';\r\n    }\r\n    nodeObj.category = nodeMetadata.category;\r\n\r\n    if (nodeMetadata.panels) {\r\n      nodeObj.panels = nodeMetadata.panels;\r\n    }\r\n    if (nodeMetadata.usePortAsLabel) {\r\n      nodeObj.usePortAsLabel = nodeMetadata.usePortAsLabel;\r\n      nodeObj.portLabelTruncationMode = nodeMetadata.portLabelTruncationMode;\r\n    }\r\n    if (nodeMetadata.color) {\r\n      nodeObj.color = nodeMetadata.color;\r\n    }\r\n    if (nodeMetadata.dynamicports) {\r\n      nodeObj.dynamicports = formatDynamicPorts(nodeMetadata);\r\n    }\r\n    if (nodeMetadata.exportDynamicPorts) {\r\n      nodeObj.exportDynamicPorts = nodeMetadata.exportDynamicPorts;\r\n    }\r\n    if (nodeMetadata.visualStates) {\r\n      nodeObj.visualStates = nodeMetadata.visualStates;\r\n    }\r\n    if (nodeMetadata.useVariants) {\r\n      nodeObj.useVariants = nodeMetadata.useVariants;\r\n    }\r\n    if (nodeMetadata.connectionPanel) {\r\n      nodeObj.connectionPanel = nodeMetadata.connectionPanel;\r\n    }\r\n    nodeObj.ports = [];\r\n\r\n    var dynamicports = nodeObj.dynamicports || [];\r\n    var selectorNames = {};\r\n    var conditionalPortNames = {};\r\n\r\n    //flag conditional ports so they don't get added from the normal ports, making them appear twice in the export\r\n    /* dynamicports.filter(d=> d.name === 'conditionalports/basic')\r\n            .forEach(d=> {\r\n                d.ports.forEach(port=> {\r\n                    conditionalPortNames[port.plug + '/' + port.name] = true;\r\n                });\r\n            });*/\r\n\r\n    //same for channel ports\r\n    dynamicports\r\n      .filter((d) => d.channelPort !== undefined)\r\n      .forEach((port) => {\r\n        conditionalPortNames[port.channelPort.plug + '/' + port.channelPort.name] = true;\r\n      });\r\n\r\n    if (dynamicports.length) {\r\n      nodeObj.dynamicports = dynamicports;\r\n    }\r\n\r\n    Object.keys(nodeMetadata.inputs).forEach(function (inputName) {\r\n      if (\r\n        selectorNames.hasOwnProperty('input/' + inputName) ||\r\n        conditionalPortNames.hasOwnProperty('input/' + inputName)\r\n      ) {\r\n        //this is a selector or dynamic port. It's already been registered\r\n        return;\r\n      }\r\n      var port = nodeMetadata.inputs[inputName];\r\n      if (port.exportToEditor === false) {\r\n        return;\r\n      }\r\n\r\n      nodeObj.ports.push(formatPort(inputName, port, 'input'));\r\n    });\r\n\r\n    function exportOutput(name, output) {\r\n      var port = {\r\n        name: name,\r\n        type: output.type,\r\n        plug: 'output'\r\n      };\r\n      if (output.group) {\r\n        port.group = output.group;\r\n      }\r\n      if (output.displayName) {\r\n        port.displayName = output.displayName;\r\n      }\r\n      if (output.editorName) {\r\n        port.editorName = output.editorName;\r\n      }\r\n      if (output.hasOwnProperty('index')) {\r\n        port.index = output.index;\r\n      }\r\n      nodeObj.ports.push(port);\r\n    }\r\n\r\n    Object.keys(nodeMetadata.outputs).forEach(function (prop) {\r\n      if (selectorNames.hasOwnProperty('output/' + prop) || conditionalPortNames.hasOwnProperty('output/' + prop)) {\r\n        //this is a selector or dynamic port. It's already been registered\r\n        return;\r\n      }\r\n\r\n      var output = nodeMetadata.outputs[prop];\r\n      exportOutput(prop, output);\r\n    });\r\n  });\r\n\r\n  const coreNodes = [\r\n    {\r\n      name: 'UI Elements',\r\n      description: 'Buttons, inputs, containers, media',\r\n      type: 'visual',\r\n      subCategories: [\r\n        {\r\n          name: 'Basic Elements',\r\n          items: ['Group', 'net.noodl.visual.columns', 'Text', 'Image', 'Video', 'Circle', 'net.noodl.visual.icon']\r\n        },\r\n        {\r\n          name: 'UI Controls',\r\n          items: [\r\n            'net.noodl.controls.button',\r\n            'net.noodl.controls.checkbox',\r\n            'net.noodl.controls.options',\r\n            'net.noodl.controls.radiobutton',\r\n            'Radio Button Group',\r\n            'net.noodl.controls.range',\r\n            'net.noodl.controls.textinput'\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      name: 'Navigation & Popups',\r\n      description: 'Page routing, navigation, popups',\r\n      type: 'logic',\r\n      subCategories: [\r\n        {\r\n          name: 'Navigation',\r\n          items: ['Router', 'RouterNavigate', 'PageInputs', 'net.noodl.externallink', 'PageStackNavigateToPath']\r\n        },\r\n        {\r\n          name: 'Component Stack',\r\n          items: ['Page Stack', 'PageStackNavigate', 'PageStackNavigateBack']\r\n        },\r\n        {\r\n          name: 'Popups',\r\n          items: ['NavigationShowPopup', 'NavigationClosePopup']\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      name: 'Logic & Utilities',\r\n      description: 'Logic, events, string manipulation',\r\n      type: 'logic',\r\n      subCategories: [\r\n        {\r\n          name: 'General Utils',\r\n          items: [\r\n            'States',\r\n            'Value Changed',\r\n            'Timer',\r\n            'Color Blend',\r\n            'Number Remapper',\r\n            'Counter',\r\n            'Drag',\r\n            'net.noodl.animatetovalue'\r\n          ]\r\n        },\r\n        {\r\n          name: 'Logic',\r\n          items: ['Boolean To String', 'Switch', 'And', 'Or', 'Condition', 'Inverter']\r\n        },\r\n        {\r\n          name: 'Events',\r\n          items: ['Event Sender', 'Event Receiver']\r\n        },\r\n        {\r\n          name: 'String Manipulation',\r\n          items: ['Substring', 'String Mapper', 'String Format', 'Date To String', 'Unique Id']\r\n        },\r\n        {\r\n          name: 'System',\r\n          items: ['Screen Resolution', 'Open File Picker']\r\n        },\r\n        {\r\n          name: 'Variables',\r\n          items: ['String', 'Boolean', 'Color', 'Number']\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      name: 'Component Utilities',\r\n      description: 'Component inputs, outputs & object',\r\n      type: 'component',\r\n      subCategories: [\r\n        {\r\n          name: '',\r\n          items: [\r\n            'Component Inputs',\r\n            'Component Outputs',\r\n            'Component Children',\r\n            'net.noodl.ComponentObject',\r\n            'net.noodl.ParentComponentObject',\r\n            'net.noodl.SetComponentObjectProperties',\r\n            'net.noodl.SetParentComponentObjectProperties'\r\n          ]\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      name: 'Read & Write Data',\r\n      description: 'Arrays, objects, cloud data',\r\n      type: 'data',\r\n      subCategories: [\r\n        {\r\n          name: '',\r\n          items: [\r\n            'RunTasks',\r\n            'For Each',\r\n            'For Each Actions',\r\n            'Model2',\r\n            'SetModelProperties',\r\n            'NewModel',\r\n            'Set Variable',\r\n            'Variable2'\r\n          ]\r\n        },\r\n        {\r\n          name: 'Array',\r\n          items: [\r\n            'Collection2',\r\n            'CollectionNew',\r\n            'CollectionRemove',\r\n            'CollectionClear',\r\n            'CollectionInsert',\r\n            'Filter Collection',\r\n            'Map Collection',\r\n            'Static Data'\r\n          ]\r\n        },\r\n        {\r\n          name: 'Cloud Data',\r\n          items: [\r\n            'DbModel2',\r\n            'NewDbModelProperties',\r\n            'FilterDBModels',\r\n            'SetDbModelProperties',\r\n            'DbCollection2',\r\n            'DeleteDbModelProperties',\r\n            'AddDbModelRelation',\r\n            'RemoveDbModelRelation',\r\n            'Cloud File',\r\n            'Upload File',\r\n            'CloudFunction2',\r\n            'DbConfig'\r\n          ]\r\n        },\r\n        {\r\n          name: 'User',\r\n          items: [\r\n            'net.noodl.user.LogIn',\r\n            'net.noodl.user.LogOut',\r\n            'net.noodl.user.SignUp',\r\n            'net.noodl.user.User',\r\n            'net.noodl.user.SetUserProperties',\r\n            'net.noodl.user.VerifyEmail',\r\n            'net.noodl.user.SendEmailVerification',\r\n            'net.noodl.user.ResetPassword',\r\n            'net.noodl.user.RequestPasswordReset'\r\n          ]\r\n        },\r\n        {\r\n          name: 'External Data',\r\n          items: ['REST2']\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      name: 'Custom Code',\r\n      description: 'Custom JavaScript and CSS',\r\n      type: 'javascript',\r\n      subCategories: [\r\n        {\r\n          name: '',\r\n          items: ['Expression', 'JavaScriptFunction', 'Javascript2', 'CSS Definition']\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      name: 'Cloud Functions',\r\n      description: 'Nodes to be used in cloud functions',\r\n      type: 'data',\r\n      subCategories: [\r\n        {\r\n          name: '',\r\n          items: ['noodl.cloud.request', 'noodl.cloud.response']\r\n        },\r\n        {\r\n          name: 'Cloud Data',\r\n          items: ['noodl.cloud.aggregate']\r\n        }\r\n      ]\r\n    }\r\n  ];\r\n\r\n  obj.nodeIndex = {\r\n    coreNodes\r\n  };\r\n\r\n  const moduleNodes = [];\r\n\r\n  nodeTypes.forEach((type) => {\r\n    const nodeMetadata = nodeRegister._constructors[type].metadata;\r\n    if (nodeMetadata.module) {\r\n      moduleNodes.push(type);\r\n    }\r\n  });\r\n\r\n  if (moduleNodes.length) {\r\n    obj.nodeIndex.moduleNodes = [\r\n      {\r\n        name: '',\r\n        items: moduleNodes\r\n      }\r\n    ];\r\n  }\r\n\r\n  return obj;\r\n}\r\n\r\nmodule.exports = generateNodeLibrary;\r\n","\"use strict\";\r\n\r\nfunction NodeRegister(context) {\r\n    this._constructors = {};\r\n    this.context = context;\r\n}\r\n\r\nNodeRegister.prototype.register = function(nodeDefinition) {\r\n    var name = nodeDefinition.metadata.name;\r\n\r\n    this._constructors[name] = nodeDefinition;\r\n};\r\n\r\nNodeRegister.prototype.createNode = function(name, id, nodeScope) {\r\n    if(this._constructors.hasOwnProperty(name) === false) {\r\n        throw new Error(\"Unknown node type with name \" + name);\r\n    }\r\n\r\n    return this._constructors[name](this.context, id, nodeScope);\r\n};\r\n\r\nNodeRegister.prototype.getNodeMetadata = function(type) {\r\n    if(this._constructors.hasOwnProperty(type) === false) {\r\n        throw new Error(\"Unknown node type with name \" + type);\r\n    }\r\n\r\n    return this._constructors[type].metadata;\r\n};\r\n\r\nNodeRegister.prototype.hasNode = function(type) {\r\n    return this._constructors.hasOwnProperty(type);\r\n};\r\n\r\nNodeRegister.prototype.getInputType = function(type, inputName) {\r\n    const metadata = this.getNodeMetadata(type);\r\n    return metadata.inputs[inputName] && metadata.inputs[inputName].type;\r\n}\r\n\r\nmodule.exports = NodeRegister;","'use strict';\r\n\r\nmodule.exports = {\r\n  node: {\r\n    name: 'Component Inputs',\r\n    shortDesc: 'This node is used to define the inputs of a component.',\r\n    docs: 'https://docs.noodl.net/nodes/component-utilities/component-inputs',\r\n    panels: [\r\n      {\r\n        name: 'PortEditor',\r\n        context: ['select', 'connectFrom'],\r\n        title: 'Inputs',\r\n        plug: 'output',\r\n        type: {\r\n          name: '*'\r\n        },\r\n        canArrangeInGroups: true\r\n      },\r\n      {\r\n        name: 'PropertyEditor',\r\n        hidden: true\r\n      }\r\n    ],\r\n    getInspectInfo() {\r\n      return { type: 'value', value: this.nodeScope.componentOwner._internal.inputValues };\r\n    },\r\n    color: 'component',\r\n    haveComponentPorts: true,\r\n    category: 'Component Utilities',\r\n    methods: {\r\n      registerOutputIfNeeded: function (name) {\r\n        if (this.hasOutput(name)) {\r\n          return;\r\n        }\r\n\r\n        this.registerOutput(name, {\r\n          getter: function () {\r\n            return this.nodeScope.componentOwner._internal.inputValues[name];\r\n          }\r\n        });\r\n      },\r\n      _updateDependencies: function () {\r\n        this.nodeScope.componentOwner.update();\r\n      }\r\n    }\r\n  }\r\n};\r\n","'use strict';\r\n\r\nvar Node = require('../node');\r\nvar NodeScope = require('../nodescope');\r\n\r\nlet componentIdCounter = 0;\r\n\r\nfunction ComponentInstanceNode(context, id, parentNodeScope) {\r\n  Node.call(this, context, id);\r\n\r\n  this.nodeScope = new NodeScope(context, this);\r\n  this.parentNodeScope = parentNodeScope;\r\n  this._internal.childRoot = null;\r\n  this._internal.componentOutputValues = {};\r\n  this._internal.componentOutputs = [];\r\n  this._internal.componentInputs = [];\r\n  this._internal.inputValues = {};\r\n  this._internal.roots = [];\r\n\r\n  this._internal.instanceId = '__$ndl_componentInstaceId' + componentIdCounter;\r\n\r\n  this.nodeScope.modelScope = parentNodeScope ? parentNodeScope.modelScope : undefined;\r\n\r\n  componentIdCounter++;\r\n}\r\n\r\nComponentInstanceNode.prototype = Object.create(Node.prototype, {\r\n  setComponentModel: {\r\n    value: async function (componentModel) {\r\n      this.componentModel = componentModel;\r\n      var self = this;\r\n\r\n      await this.nodeScope.setComponentModel(componentModel);\r\n\r\n      this._internal.componentInputs = this.nodeScope.getNodesWithType('Component Inputs');\r\n      this._internal.componentOutputs = this.nodeScope.getNodesWithType('Component Outputs');\r\n\r\n      Object.values(componentModel.getInputPorts()).forEach(this.registerComponentInputPort.bind(this));\r\n      Object.values(componentModel.getOutputPorts()).forEach(this.registerComponentOutputPort.bind(this));\r\n\r\n      const roots = componentModel.roots || [];\r\n      this._internal.roots = roots.map((id) => this.nodeScope.getNodeWithId(id));\r\n\r\n      componentModel.on(\r\n        'rootAdded',\r\n        (id) => {\r\n          this._internal.roots.push(this.nodeScope.getNodeWithId(id));\r\n          this.forceUpdate();\r\n        },\r\n        this\r\n      );\r\n\r\n      componentModel.on(\r\n        'rootRemoved',\r\n        function (id) {\r\n          const index = this._internal.roots.findIndex((root) => root.id === id);\r\n          if (index !== -1) {\r\n            this._internal.roots.splice(index, 1);\r\n          }\r\n          this.forceUpdate();\r\n        },\r\n        this\r\n      );\r\n\r\n      componentModel.on('inputPortAdded', this.registerComponentInputPort.bind(this), this);\r\n      componentModel.on('outputPortAdded', this.registerComponentOutputPort.bind(this), this);\r\n\r\n      componentModel.on(\r\n        'inputPortRemoved',\r\n        function (port) {\r\n          if (self.hasInput(port.name)) {\r\n            self.deregisterInput(port.name);\r\n          }\r\n        },\r\n        this\r\n      );\r\n      componentModel.on(\r\n        'outputPortRemoved',\r\n        function (port) {\r\n          if (this.hasOutput(port.name)) {\r\n            self.deregisterOutput(port.name);\r\n          }\r\n        },\r\n        this\r\n      );\r\n\r\n      componentModel.on(\r\n        'nodeAdded',\r\n        function (node) {\r\n          if (node.type === 'Component Inputs') {\r\n            self._internal.componentInputs.push(self.nodeScope.getNodeWithId(node.id));\r\n          } else if (node.type === 'Component Outputs') {\r\n            self._internal.componentOutputs.push(self.nodeScope.getNodeWithId(node.id));\r\n          }\r\n        },\r\n        this\r\n      );\r\n\r\n      componentModel.on(\r\n        'nodeRemoved',\r\n        function (node) {\r\n          function removeNodesWithId(array, id) {\r\n            return array.filter((e) => e.id !== id);\r\n          }\r\n          if (node.type === 'Component Inputs') {\r\n            self._internal.componentInputs = removeNodesWithId(self._internal.componentInputs, node.id);\r\n          } else if (node.type === 'Component Outputs') {\r\n            self._internal.componentOutputs = removeNodesWithId(self._internal.componentOutputs, node.id);\r\n          }\r\n        },\r\n        this\r\n      );\r\n\r\n      componentModel.on(\r\n        'renamed',\r\n        function (event) {\r\n          self.name = event.newName;\r\n        },\r\n        this\r\n      );\r\n    }\r\n  },\r\n  _onNodeDeleted: {\r\n    value: function () {\r\n      if (this.componentModel) {\r\n        this.componentModel.removeListenersWithRef(this);\r\n        this.componentModel = undefined;\r\n      }\r\n\r\n      this.nodeScope.reset();\r\n      Node.prototype._onNodeDeleted.call(this);\r\n    }\r\n  },\r\n  registerComponentInputPort: {\r\n    value: function (port) {\r\n      this.registerInput(port.name, {\r\n        set: function (value) {\r\n          this._internal.inputValues[port.name] = value;\r\n          this._internal.componentInputs.forEach(function (componentInput) {\r\n            componentInput.registerOutputIfNeeded(port.name);\r\n            componentInput.flagOutputDirty(port.name);\r\n          });\r\n        }\r\n      });\r\n    }\r\n  },\r\n  registerComponentOutputPort: {\r\n    value: function (port) {\r\n      this.registerOutput(port.name, {\r\n        getter: function () {\r\n          return this._internal.componentOutputValues[port.name];\r\n        }\r\n      });\r\n    }\r\n  },\r\n  setOutputFromComponentOutput: {\r\n    value: function (name, value) {\r\n      if (this.hasOutput(name) === false) {\r\n        return;\r\n      }\r\n\r\n      this._internal.creatorCallbacks &&\r\n        this._internal.creatorCallbacks.onOutputChanged &&\r\n        this._internal.creatorCallbacks.onOutputChanged(name, value, this._internal.componentOutputValues[name]);\r\n\r\n      this._internal.componentOutputValues[name] = value;\r\n      this.flagOutputDirty(name);\r\n    }\r\n  },\r\n  setChildRoot: {\r\n    value: function (node) {\r\n      const prevChildRoot = this._internal.childRoot;\r\n      const newChildRoot = node;\r\n\r\n      this._internal.childRoot = newChildRoot;\r\n\r\n      if (this.model && this.model.children) {\r\n        const parentNodeScope = this.parentNodeScope;\r\n\r\n        const children = this.model.children\r\n          .filter((child) => child.type !== 'Component Children')\r\n          .map((child) => parentNodeScope.getNodeWithId(child.id));\r\n\r\n        if (prevChildRoot) {\r\n          for (let i = 0; i < children.length; i++) {\r\n            if (prevChildRoot.isChild(children[i])) {\r\n              prevChildRoot.removeChild(children[i]);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (newChildRoot) {\r\n          for (let i = 0; i < children.length; i++) {\r\n            const child = children[i];\r\n            const index = child.model.parent.children.indexOf(child.model);\r\n            this.addChild(child, index);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  getChildRootIndex: {\r\n    value: function () {\r\n      if (!this._internal.childRoot || !this._internal.childRoot.model || !this._internal.childRoot.model.children) {\r\n        return 0;\r\n      }\r\n\r\n      var children = this._internal.childRoot.model.children;\r\n\r\n      for (var i = 0; i < children.length; i++) {\r\n        if (children[i].type === 'Component Children') {\r\n          return i;\r\n        }\r\n      }\r\n\r\n      return 0;\r\n    }\r\n  },\r\n  getChildRoot: {\r\n    value: function () {\r\n      if (this._internal.childRoot) {\r\n        return this._internal.childRoot;\r\n      }\r\n      return null;\r\n    }\r\n  },\r\n  getRoots: {\r\n    value: function () {\r\n      return this._internal.roots;\r\n    }\r\n  },\r\n  /** Added for SSR Support */\r\n  triggerDidMount: {\r\n    value: function () {\r\n      this._internal.roots.forEach((root) => {\r\n        root.triggerDidMount && root.triggerDidMount();\r\n      });\r\n    }\r\n  },\r\n  render: {\r\n    value: function () {\r\n      if (this._internal.roots.length === 0) {\r\n        return null;\r\n      }\r\n\r\n      return this._internal.roots[0].render();\r\n    }\r\n  },\r\n  setChildIndex: {\r\n    value: function (childIndex) {\r\n      // NOTE: setChildIndex can be undefined when it is not a React node,\r\n      //       but still a visual node like the foreach (Repeater) node.\r\n      this.getRoots().forEach((root) => root.setChildIndex && root.setChildIndex(childIndex));\r\n    }\r\n  },\r\n  addChild: {\r\n    value: function (child, index) {\r\n      this.getChildRoot().addChild(child, index + this.getChildRootIndex());\r\n    }\r\n  },\r\n  removeChild: {\r\n    value: function (child) {\r\n      this.getChildRoot().removeChild(child);\r\n    }\r\n  },\r\n  getChildren: {\r\n    value: function (child) {\r\n      const childRoot = this.getChildRoot();\r\n      return childRoot ? childRoot.getChildren() : [];\r\n    }\r\n  },\r\n  isChild: {\r\n    value: function (child) {\r\n      if (!this.getChildRoot()) {\r\n        return false;\r\n      }\r\n\r\n      return this.getChildRoot().isChild(child);\r\n    }\r\n  },\r\n  contains: {\r\n    value: function (node) {\r\n      return this.getRoots().some((root) => root.contains && root.contains(node));\r\n    }\r\n  },\r\n  _performDirtyUpdate: {\r\n    value: function () {\r\n      Node.prototype._performDirtyUpdate.call(this);\r\n\r\n      var componentInputs = this._internal.componentInputs;\r\n      for (var i = 0, len = componentInputs.length; i < len; i++) {\r\n        componentInputs[i].flagDirty();\r\n      }\r\n\r\n      this._internal.componentOutputs.forEach(function (componentOutput) {\r\n        componentOutput.flagDirty();\r\n      });\r\n    }\r\n  },\r\n  getRef: {\r\n    value: function () {\r\n      const root = this._internal.roots[0];\r\n      return root ? root.getRef() : undefined;\r\n    }\r\n  },\r\n  update: {\r\n    value: function () {\r\n      Node.prototype.update.call(this);\r\n\r\n      this._internal.componentOutputs.forEach(function (componentOutput) {\r\n        componentOutput.update();\r\n      });\r\n    }\r\n  },\r\n  forceUpdate: {\r\n    //this is only used when roots are added or removed\r\n    value: function () {\r\n      if (!this.parent) return;\r\n\r\n      //the parent will need to re-render the roots of this component instance\r\n      //TODO: make this use a cleaner API, and only invalidate the affected child, instead of all children\r\n      this.parent.cachedChildren = undefined;\r\n      this.parent.forceUpdate();\r\n    }\r\n  },\r\n  getInstanceId: {\r\n    value() {\r\n      return this._internal.instanceId;\r\n    }\r\n  }\r\n});\r\n\r\nComponentInstanceNode.prototype.constructor = ComponentInstanceNode;\r\nmodule.exports = ComponentInstanceNode;\r\n","'use strict';\r\n\r\nmodule.exports = {\r\n  node: {\r\n    category: 'Component Utilities',\r\n    name: 'Component Outputs',\r\n    shortDesc: 'This node is used to define the outputs of a component.',\r\n    docs: 'https://docs.noodl.net/nodes/component-utilities/component-outputs',\r\n    panels: [\r\n      {\r\n        name: 'PortEditor',\r\n        context: ['select', 'connectTo'],\r\n        title: 'Outputs',\r\n        plug: 'input',\r\n        type: {\r\n          name: '*'\r\n        },\r\n        canArrangeInGroups: true\r\n      },\r\n      {\r\n        name: 'PropertyEditor',\r\n        hidden: true\r\n      }\r\n    ],\r\n    color: 'component',\r\n    haveComponentPorts: true,\r\n    prototypeExtensions: {\r\n      registerInputIfNeeded: function (name) {\r\n        if (this.hasInput(name)) {\r\n          return;\r\n        }\r\n\r\n        this.registerInput(name, {\r\n          set: function (value) {\r\n            this.nodeScope.componentOwner.setOutputFromComponentOutput(name, value);\r\n          }\r\n        });\r\n      }\r\n    }\r\n  }\r\n};\r\n","'use strict';\r\n\r\nconst AndNode = {\r\n  name: 'And',\r\n  docs: 'https://docs.noodl.net/nodes/logic/and',\r\n  category: 'Logic',\r\n  initialize: function () {\r\n    this._internal.inputs = [];\r\n  },\r\n  getInspectInfo() {\r\n    return and(this._internal.inputs);\r\n  },\r\n  numberedInputs: {\r\n    input: {\r\n      displayPrefix: 'Input',\r\n      type: 'boolean',\r\n      createSetter(index) {\r\n        return function (value) {\r\n          value = value ? true : false;\r\n\r\n          if (this._internal.inputs[index] === value) {\r\n            return;\r\n          }\r\n\r\n          this._internal.inputs[index] = value;\r\n          const result = and(this._internal.inputs);\r\n\r\n          if (this._internal.result !== result) {\r\n            this._internal.result = result;\r\n            this.flagOutputDirty('result');\r\n          }\r\n        };\r\n      }\r\n    }\r\n  },\r\n  outputs: {\r\n    result: {\r\n      type: 'boolean',\r\n      displayName: 'Result',\r\n      get() {\r\n        return this._internal.result;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  node: AndNode\r\n};\r\n\r\nfunction and(values) {\r\n  //if none are false, then return true\r\n  return values.length > 0 && values.some((v) => !v) === false;\r\n}\r\n","'use strict';\r\n\r\nconst BooleanToStringNode = {\r\n  name: 'Boolean To String',\r\n  docs: 'https://docs.noodl.net/nodes/utilities/boolean-to-string',\r\n  category: 'Utilities',\r\n  initialize: function () {\r\n    this._internal.inputs = [];\r\n    this._internal.currentSelectedIndex = 0;\r\n    this._internal.indexChanged = false;\r\n\r\n    this._internal.trueString = '';\r\n    this._internal.falseString = '';\r\n  },\r\n  inputs: {\r\n    trueString: {\r\n      displayName: 'String for true',\r\n      type: 'string',\r\n      set: function (value) {\r\n        if (this._internal.trueString === value) return;\r\n        this._internal.trueString = value;\r\n\r\n        if (this._internal.currentInput) {\r\n          this.flagOutputDirty('currentValue');\r\n        }\r\n      }\r\n    },\r\n    falseString: {\r\n      displayName: 'String for false',\r\n      type: 'string',\r\n      set: function (value) {\r\n        if (this._internal.falseString === value) return;\r\n        this._internal.falseString = value;\r\n\r\n        if (!this._internal.currentInput) {\r\n          this.flagOutputDirty('currentValue');\r\n        }\r\n      }\r\n    },\r\n    input: {\r\n      type: { name: 'boolean' },\r\n      displayName: 'Selector',\r\n      set: function (value) {\r\n        if (this._internal.currentInput === value) return;\r\n\r\n        this._internal.currentInput = value;\r\n        this.flagOutputDirty('currentValue');\r\n        this.sendSignalOnOutput('inputChanged');\r\n      }\r\n    }\r\n  },\r\n  outputs: {\r\n    currentValue: {\r\n      type: 'string',\r\n      displayName: 'Current Value',\r\n      group: 'Value',\r\n      getter: function () {\r\n        return this._internal.currentInput ? this._internal.trueString : this._internal.falseString;\r\n      }\r\n    },\r\n    inputChanged: {\r\n      type: 'signal',\r\n      displayName: 'Selector Changed',\r\n      group: 'Signals'\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  node: BooleanToStringNode\r\n};\r\n","'use strict';\r\n\r\nconst ConditionNode = {\r\n  name: 'Condition',\r\n  docs: 'https://docs.noodl.net/nodes/utilities/logic/condition',\r\n  category: 'Logic',\r\n  initialize: function () {},\r\n  getInspectInfo() {\r\n    const condition = this.getInputValue('condition');\r\n    let value;\r\n    if (condition === undefined) {\r\n      value = '[No input]';\r\n    }\r\n    value = condition;\r\n    return [\r\n      {\r\n        type: 'value',\r\n        value\r\n      }\r\n    ];\r\n  },\r\n  inputs: {\r\n    condition: {\r\n      type: 'boolean',\r\n      displayName: 'Condition',\r\n      group: 'General',\r\n      set(value) {\r\n        if (!this.isInputConnected('eval')) {\r\n          // Evaluate right away\r\n          this.scheduleEvaluate();\r\n        }\r\n      }\r\n    },\r\n    eval: {\r\n      type: 'signal',\r\n      displayName: 'Evaluate',\r\n      group: 'Actions',\r\n      valueChangedToTrue() {\r\n        this.scheduleEvaluate();\r\n      }\r\n    }\r\n  },\r\n  outputs: {\r\n    ontrue: {\r\n      type: 'signal',\r\n      displayName: 'On True',\r\n      group: 'Events'\r\n    },\r\n    onfalse: {\r\n      type: 'signal',\r\n      displayName: 'On False',\r\n      group: 'Events'\r\n    },\r\n    result: {\r\n      type: 'boolean',\r\n      displayName: 'Is True',\r\n      group: 'Booleans',\r\n      get() {\r\n        return !!this.getInputValue('condition');\r\n      }\r\n    },\r\n    isfalse: {\r\n      type: 'boolean',\r\n      displayName: 'Is False',\r\n      group: 'Booleans',\r\n      get() {\r\n        return !this.getInputValue('condition');\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    scheduleEvaluate() {\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        this.flagOutputDirty('result');\r\n        this.flagOutputDirty('isfalse');\r\n\r\n        const condition = this.getInputValue('condition');\r\n        this.sendSignalOnOutput(condition ? 'ontrue' : 'onfalse');\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  node: ConditionNode\r\n};\r\n","'use strict';\r\n\r\nconst CounterNode = {\r\n  name: 'Counter',\r\n  docs: 'https://docs.noodl.net/nodes/math/counter',\r\n  category: 'Math',\r\n  initialize: function () {\r\n    this._internal.currentValue = 0;\r\n    this._internal.startValue = 0;\r\n    this._internal.startValueSet = false;\r\n\r\n    this._internal.limitsEnabled = false;\r\n    this._internal.limitsMin = 0;\r\n    this._internal.limitsMax = 0;\r\n  },\r\n  getInspectInfo() {\r\n    return 'Count: ' + this._internal.currentValue;\r\n  },\r\n  inputs: {\r\n    increase: {\r\n      group: 'Actions',\r\n      displayName: 'Increase Count',\r\n      valueChangedToTrue: function () {\r\n        if (this._internal.limitsEnabled && this._internal.currentValue >= this._internal.limitsMax) {\r\n          return;\r\n        }\r\n\r\n        this._internal.currentValue++;\r\n        this.flagOutputDirty('currentCount');\r\n        this.sendSignalOnOutput('countChanged');\r\n      }\r\n    },\r\n    decrease: {\r\n      group: 'Actions',\r\n      displayName: 'Decrease Count',\r\n      valueChangedToTrue: function () {\r\n        if (this._internal.limitsEnabled && this._internal.currentValue <= this._internal.limitsMin) {\r\n          return;\r\n        }\r\n\r\n        this._internal.currentValue--;\r\n        this.flagOutputDirty('currentCount');\r\n        this.sendSignalOnOutput('countChanged');\r\n      }\r\n    },\r\n    reset: {\r\n      group: 'Actions',\r\n      displayName: 'Reset To Start',\r\n      valueChangedToTrue: function () {\r\n        if (this.currentValue === 0) {\r\n          return;\r\n        }\r\n        this._internal.currentValue = this._internal.startValue;\r\n        this.flagOutputDirty('currentCount');\r\n        this.sendSignalOnOutput('countChanged');\r\n      }\r\n    },\r\n    startValue: {\r\n      type: 'number',\r\n      displayName: 'Start Value',\r\n      default: 0,\r\n      set: function (value) {\r\n        this._internal.startValue = Number(value);\r\n\r\n        if (this._internal.startValueSet === false) {\r\n          this._internal.startValueSet = true;\r\n          this._internal.currentValue = this._internal.startValue;\r\n          this.flagOutputDirty('currentCount');\r\n          this.sendSignalOnOutput('countChanged');\r\n        }\r\n      }\r\n    },\r\n    limitsMin: {\r\n      type: {\r\n        name: 'number'\r\n      },\r\n      displayName: 'Min Value',\r\n      group: 'Limits',\r\n      default: 0,\r\n      set: function (value) {\r\n        this._internal.limitsMin = Number(value);\r\n      }\r\n    },\r\n    limitsMax: {\r\n      type: {\r\n        name: 'number'\r\n      },\r\n      displayName: 'Max Value',\r\n      group: 'Limits',\r\n      default: 0,\r\n      set: function (value) {\r\n        this._internal.limitsMax = Number(value);\r\n      }\r\n    },\r\n    limitsEnabled: {\r\n      type: {\r\n        name: 'boolean'\r\n      },\r\n      displayName: 'Limits Enabled',\r\n      group: 'Limits',\r\n      default: false,\r\n      set: function (value) {\r\n        this._internal.limitsEnabled = value ? true : false;\r\n      }\r\n    }\r\n  },\r\n  outputs: {\r\n    currentCount: {\r\n      displayName: 'Current Count',\r\n      type: 'number',\r\n      getter: function () {\r\n        return this._internal.currentValue;\r\n      }\r\n    },\r\n    countChanged: {\r\n      displayName: 'Count Changed',\r\n      type: 'signal'\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  node: CounterNode\r\n};\r\n","const CloudFile = require('../../../api/cloudfile');\r\n\r\nconst CloudFileNode = {\r\n  name: 'Cloud File',\r\n  docs: 'https://docs.noodl.net/nodes/data/cloud-data/cloud-file',\r\n  category: 'Cloud Services',\r\n  color: 'data',\r\n  getInspectInfo() {\r\n    return this._internal.cloudFile && this._internal.cloudFile.getUrl();\r\n  },\r\n  outputs: {\r\n    url: {\r\n      type: 'string',\r\n      displayName: 'URL',\r\n      group: 'General',\r\n      get() {\r\n        return this._internal.cloudFile && this._internal.cloudFile.getUrl();\r\n      }\r\n    },\r\n    name: {\r\n      type: 'string',\r\n      displayName: 'Name',\r\n      group: 'General',\r\n      get() {\r\n        if (!this._internal.cloudFile) return;\r\n\r\n        //parse prefixes the file with a guid_\r\n        //remove it so the name is the same as the original file name\r\n        const n = this._internal.cloudFile.getName().split('_');\r\n        return n.length === 1 ? n[0] : n.slice(1).join('_');\r\n      }\r\n    }\r\n  },\r\n  inputs: {\r\n    file: {\r\n      type: 'cloudfile',\r\n      displayName: 'Cloud File',\r\n      group: 'General',\r\n      set(value) {\r\n        if (value instanceof CloudFile === false) {\r\n          return;\r\n        }\r\n        this._internal.cloudFile = value;\r\n        this.flagOutputDirty('name');\r\n        this.flagOutputDirty('url');\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  node: CloudFileNode\r\n};\r\n","const { Node, EdgeTriggeredInput } = require('../../../../noodl-runtime');\r\n\r\nconst Model = require('../../../model'),\r\n  Collection = require('../../../collection'),\r\n  CloudStore = require('../../../api/cloudstore'),\r\n  JavascriptNodeParser = require('../../../javascriptnodeparser'),\r\n  QueryUtils = require('../../../api/queryutils');\r\n\r\nvar DbCollectionNode = {\r\n  name: 'DbCollection2',\r\n  docs: 'https://docs.noodl.net/nodes/data/cloud-data/query-records',\r\n  displayName: 'Query Records',\r\n  /* shortDesc: \"A database collection.\",*/\r\n  category: 'Cloud Services',\r\n  usePortAsLabel: 'collectionName',\r\n  color: 'data',\r\n  initialize: function () {\r\n    var _this = this;\r\n    this._internal.queryParameters = {};\r\n\r\n    var collectionChangedScheduled = false;\r\n    this._internal.collectionChangedCallback = function () {\r\n      //this can be called multiple times when adding/removing more than one item\r\n      //so optimize by only updating outputs once\r\n      if (collectionChangedScheduled) return;\r\n      collectionChangedScheduled = true;\r\n\r\n      _this.scheduleAfterInputsHaveUpdated(function () {\r\n        _this.flagOutputDirty('count');\r\n        _this.flagOutputDirty('firstItemId');\r\n        _this.flagOutputDirty('isEmpty');\r\n        collectionChangedScheduled = false;\r\n      });\r\n    };\r\n\r\n    this._internal.cloudStoreEvents = function (args) {\r\n      if (_this.isInputConnected('storageFetch') === true) return;\r\n\r\n      if (_this._internal.collection === undefined) return;\r\n      if (args.collection !== _this._internal.name) return;\r\n\r\n      function _addModelAtCorrectIndex(m) {\r\n        if (_this._internal.currentQuery.sort !== undefined) {\r\n          // We need to add it at the right index\r\n          for (var i = 0; i < _this._internal.collection.size(); i++)\r\n            if (QueryUtils.compareObjects(_this._internal.currentQuery.sort, _this._internal.collection.get(i), m) > 0)\r\n              break;\r\n\r\n          _this._internal.collection.addAtIndex(m, i);\r\n        } else {\r\n          _this._internal.collection.add(m);\r\n        }\r\n\r\n        // Make sure we don't exceed limit\r\n        let size = _this._internal.collection.size();\r\n        if (_this._internal.currentQuery.limit !== undefined && size > _this._internal.currentQuery.limit)\r\n          _this._internal.collection.remove(\r\n            _this._internal.collection.get(\r\n              _this._internal.currentQuery.sort !== undefined && _this._internal.currentQuery.sort[0][0] === '-'\r\n                ? size - 1\r\n                : 0\r\n            )\r\n          );\r\n\r\n        //Send the array again over the items output to trigger function nodes etc that might be connected\r\n        _this.flagOutputDirty('items');\r\n\r\n        _this.flagOutputDirty('count');\r\n        _this.flagOutputDirty('firstItemId');\r\n        _this.flagOutputDirty('isEmpty');\r\n      }\r\n\r\n      if (args.type === 'create') {\r\n        const m = Model.get(args.object.objectId);\r\n        if (m !== undefined) {\r\n          // Check if the object matches the current query\r\n          if (QueryUtils.matchesQuery(m, _this._internal.currentQuery.where)) {\r\n            // If matches the query, add the item to results\r\n            _addModelAtCorrectIndex(m);\r\n          }\r\n        }\r\n      } else if (args.type === 'save') {\r\n        const m = Model.get(args.objectId);\r\n        if (m !== undefined) {\r\n          const matchesQuery = QueryUtils.matchesQuery(m, _this._internal.currentQuery.where);\r\n\r\n          if (!matchesQuery && _this._internal.collection.contains(m)) {\r\n            // The record no longer matches the filter, remove it\r\n            _this._internal.collection.remove(m);\r\n\r\n            //Send the array again over the items output to trigger function nodes etc that might be connected\r\n            _this.flagOutputDirty('items');\r\n\r\n            _this.flagOutputDirty('count');\r\n            _this.flagOutputDirty('firstItemId');\r\n            _this.flagOutputDirty('isEmpty');\r\n          } else if (matchesQuery && !_this._internal.collection.contains(m)) {\r\n            // It's not part of the result collection but now matches they query, add it and resort\r\n            _addModelAtCorrectIndex(m);\r\n          }\r\n        }\r\n      } else if (args.type === 'delete') {\r\n        const m = Model.get(args.objectId);\r\n        if (m !== undefined) {\r\n          _this._internal.collection.remove(m);\r\n\r\n          //Send the array again over the items output to trigger function nodes etc that might be connected\r\n          _this.flagOutputDirty('items');\r\n\r\n          _this.flagOutputDirty('count');\r\n          _this.flagOutputDirty('firstItemId');\r\n          _this.flagOutputDirty('isEmpty');\r\n        }\r\n      }\r\n    };\r\n\r\n    // Listening to cloud store events is only for the global model scope, only valid in browser\r\n    // in cloud runtime its a nop\r\n    const cloudstore = CloudStore.forScope(this.nodeScope.modelScope);\r\n    cloudstore.on('save', this._internal.cloudStoreEvents);\r\n    cloudstore.on('create', this._internal.cloudStoreEvents);\r\n    cloudstore.on('delete', this._internal.cloudStoreEvents);\r\n\r\n    this._internal.storageSettings = {};\r\n  },\r\n  getInspectInfo() {\r\n    const collection = this._internal.collection;\r\n    if (!collection) {\r\n      return { type: 'text', value: '[Not executed yet]' };\r\n    }\r\n\r\n    return [\r\n      {\r\n        type: 'value',\r\n        value: collection.items\r\n      }\r\n    ];\r\n  },\r\n  inputs: {},\r\n  outputs: {\r\n    items: {\r\n      type: 'array',\r\n      displayName: 'Items',\r\n      group: 'General',\r\n      getter: function () {\r\n        return this._internal.collection;\r\n      }\r\n    },\r\n    firstItemId: {\r\n      type: 'string',\r\n      displayName: 'First Record Id',\r\n      group: 'General',\r\n      getter: function () {\r\n        if (this._internal.collection) {\r\n          var firstItem = this._internal.collection.get(0);\r\n          if (firstItem !== undefined) return firstItem.getId();\r\n        }\r\n      }\r\n    },\r\n    isEmpty: {\r\n      type: 'boolean',\r\n      displayName: 'Is Empty',\r\n      group: 'General',\r\n      getter: function () {\r\n        if (this._internal.collection) {\r\n          return this._internal.collection.size() === 0;\r\n        }\r\n        return true;\r\n      }\r\n    },\r\n    count: {\r\n      type: 'number',\r\n      displayName: 'Count',\r\n      group: 'General',\r\n      getter: function () {\r\n        return this._internal.collection ? this._internal.collection.size() : 0;\r\n      }\r\n    },\r\n    fetched: {\r\n      group: 'Events',\r\n      type: 'signal',\r\n      displayName: 'Success'\r\n    },\r\n    failure: {\r\n      group: 'Events',\r\n      type: 'signal',\r\n      displayName: 'Failure'\r\n    },\r\n    error: {\r\n      type: 'string',\r\n      displayName: 'Error',\r\n      group: 'Error',\r\n      getter: function () {\r\n        return this._internal.error;\r\n      }\r\n    }\r\n  },\r\n  prototypeExtensions: {\r\n    setCollectionName: function (name) {\r\n      this._internal.name = name;\r\n\r\n      if (this.isInputConnected('storageFetch') === false) this.scheduleFetch();\r\n    },\r\n    setCollection: function (collection) {\r\n      this.bindCollection(collection);\r\n      this.flagOutputDirty('firstItemId');\r\n      this.flagOutputDirty('isEmpty');\r\n      this.flagOutputDirty('items');\r\n      this.flagOutputDirty('count');\r\n    },\r\n    unbindCurrentCollection: function () {\r\n      var collection = this._internal.collection;\r\n      if (!collection) return;\r\n      collection.off('change', this._internal.collectionChangedCallback);\r\n      this._internal.collection = undefined;\r\n    },\r\n    bindCollection: function (collection) {\r\n      this.unbindCurrentCollection();\r\n      this._internal.collection = collection;\r\n      collection && collection.on('change', this._internal.collectionChangedCallback);\r\n    },\r\n    _onNodeDeleted: function () {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      this.unbindCurrentCollection();\r\n\r\n      const cloudstore = CloudStore.forScope(this.nodeScope.modelScope);\r\n      cloudstore.off('insert', this._internal.cloudStoreEvents);\r\n      cloudstore.off('delete', this._internal.cloudStoreEvents);\r\n      cloudstore.off('save', this._internal.cloudStoreEvents);\r\n    },\r\n    setError: function (err) {\r\n      this._internal.err = err;\r\n      this.flagOutputDirty('error');\r\n      this.sendSignalOnOutput('failure');\r\n    },\r\n    scheduleFetch: function () {\r\n      var internal = this._internal;\r\n\r\n      if (internal.fetchScheduled) return;\r\n      internal.fetchScheduled = true;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        internal.fetchScheduled = false;\r\n\r\n        this.fetch();\r\n      });\r\n    },\r\n    fetch: function () {\r\n      if (this.context.editorConnection) {\r\n        if (this._internal.name === undefined) {\r\n          this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'query-collection', {\r\n            message: 'No collection specified for query'\r\n          });\r\n        } else {\r\n          this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, 'query-collection');\r\n        }\r\n      }\r\n\r\n      const _c = Collection.get();\r\n      const f = this.getStorageFilter();\r\n      const limit = this.getStorageLimit();\r\n      const skip = this.getStorageSkip();\r\n      const count = this.getStorageFetchTotalCount();\r\n      this._internal.currentQuery = {\r\n        where: f.where,\r\n        sort: f.sort,\r\n        limit: limit,\r\n        skip: skip\r\n      };\r\n      CloudStore.forScope(this.nodeScope.modelScope).query({\r\n        collection: this._internal.name,\r\n        where: f.where,\r\n        sort: f.sort,\r\n        limit: limit,\r\n        skip: skip,\r\n        count: count,\r\n        success: (results, count) => {\r\n          if (results !== undefined) {\r\n            _c.set(\r\n              results.map((i) => {\r\n                var m = CloudStore._fromJSON(i, this._internal.name, this.nodeScope.modelScope);\r\n\r\n                return m;\r\n              })\r\n            );\r\n          }\r\n          if (count !== undefined) {\r\n            this._internal.storageSettings.storageTotalCount = count;\r\n            if (this.hasOutput('storageTotalCount')) this.flagOutputDirty('storageTotalCount');\r\n          }\r\n          this.setCollection(_c);\r\n          this.sendSignalOnOutput('fetched');\r\n        },\r\n        error: (err) => {\r\n          this.setCollection(_c);\r\n          this.setError(err || 'Failed to fetch.');\r\n        }\r\n      });\r\n    },\r\n    getStorageFilter: function () {\r\n      const storageSettings = this._internal.storageSettings;\r\n      if (storageSettings['storageFilterType'] === undefined || storageSettings['storageFilterType'] === 'simple') {\r\n        // Create simple filter\r\n        const _where =\r\n          this._internal.visualFilter !== undefined\r\n            ? QueryUtils.convertVisualFilter(this._internal.visualFilter, {\r\n                queryParameters: this._internal.queryParameters,\r\n                collectionName: this._internal.name\r\n              })\r\n            : undefined;\r\n\r\n        const _sort =\r\n          this._internal.visualSorting !== undefined\r\n            ? QueryUtils.convertVisualSorting(this._internal.visualSorting)\r\n            : undefined;\r\n\r\n        return {\r\n          where: _where,\r\n          sort: _sort\r\n        };\r\n      } else if (storageSettings['storageFilterType'] === 'json') {\r\n        // JSON filter\r\n        if (!this._internal.filterFunc) {\r\n          try {\r\n            var filterCode = storageSettings['storageJSONFilter'];\r\n\r\n            // Parse out variables\r\n            filterCode = filterCode.replace(/\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/g, ''); // Remove comments\r\n            this._internal.filterVariables = filterCode.match(/\\$[A-Za-z0-9]+/g) || [];\r\n\r\n            var args = ['filter', 'where', 'sort', 'Inputs']\r\n              .concat(this._internal.filterVariables)\r\n              .concat([filterCode]);\r\n            this._internal.filterFunc = Function.apply(null, args);\r\n          } catch (e) {\r\n            this._internal.filterFunc = undefined;\r\n            console.log('Error while parsing filter script: ' + e);\r\n          }\r\n        }\r\n\r\n        if (!this._internal.filterFunc) return;\r\n\r\n        var _filter = {},\r\n          _sort = [],\r\n          _this = this;\r\n\r\n        // Collect filter variables\r\n        var _filterCb = function (f) {\r\n          _filter = QueryUtils.convertFilterOp(f, {\r\n            collectionName: _this._internal.name,\r\n            error: function (err) {\r\n              _this.context.editorConnection.sendWarning(\r\n                _this.nodeScope.componentOwner.name,\r\n                _this.id,\r\n                'query-collection-filter',\r\n                {\r\n                  message: err\r\n                }\r\n              );\r\n            }\r\n          });\r\n        };\r\n        var _sortCb = function (s) {\r\n          _sort = s;\r\n        };\r\n\r\n        // Extract inputs\r\n        const inputs = {};\r\n        for (let key in storageSettings) {\r\n          if (key.startsWith('storageFilterValue-'))\r\n            inputs[key.substring('storageFilterValue-'.length)] = storageSettings[key];\r\n        }\r\n\r\n        var filterFuncArgs = [_filterCb, _filterCb, _sortCb, inputs]; // One for filter, one for where\r\n\r\n        this._internal.filterVariables.forEach((v) => {\r\n          filterFuncArgs.push(storageSettings['storageFilterValue-' + v.substring(1)]);\r\n        });\r\n\r\n        // Run the code to get the filter\r\n        try {\r\n          this._internal.filterFunc.apply(this, filterFuncArgs);\r\n        } catch (e) {\r\n          console.log('Error while running filter script: ' + e);\r\n        }\r\n\r\n        return { where: _filter, sort: _sort };\r\n      }\r\n    },\r\n    getStorageLimit: function () {\r\n      const storageSettings = this._internal.storageSettings;\r\n\r\n      if (!storageSettings['storageEnableLimit']) return;\r\n      else return storageSettings['storageLimit'] || 10;\r\n    },\r\n    getStorageSkip: function () {\r\n      const storageSettings = this._internal.storageSettings;\r\n\r\n      if (!storageSettings['storageEnableLimit']) return;\r\n      else return storageSettings['storageSkip'] || 0;\r\n    },\r\n    getStorageFetchTotalCount: function () {\r\n      const storageSettings = this._internal.storageSettings;\r\n\r\n      return !!storageSettings['storageEnableCount'];\r\n    },\r\n    registerOutputIfNeeded: function (name) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      this.registerOutput(name, {\r\n        getter: userOutputGetter.bind(this, name)\r\n      });\r\n    },\r\n    setVisualFilter: function (value) {\r\n      this._internal.visualFilter = value;\r\n\r\n      if (this.isInputConnected('storageFetch') === false) this.scheduleFetch();\r\n    },\r\n    setVisualSorting: function (value) {\r\n      this._internal.visualSorting = value;\r\n\r\n      if (this.isInputConnected('storageFetch') === false) this.scheduleFetch();\r\n    },\r\n    setQueryParameter: function (name, value) {\r\n      this._internal.queryParameters[name] = value;\r\n\r\n      if (this.isInputConnected('storageFetch') === false) this.scheduleFetch();\r\n    },\r\n    registerInputIfNeeded: function (name) {\r\n      var _this = this;\r\n\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('qp-'))\r\n        return this.registerInput(name, {\r\n          set: this.setQueryParameter.bind(this, name.substring('qp-'.length))\r\n        });\r\n\r\n      const dynamicSignals = {\r\n        storageFetch: this.scheduleFetch.bind(this)\r\n      };\r\n\r\n      if (dynamicSignals[name])\r\n        return this.registerInput(name, {\r\n          set: EdgeTriggeredInput.createSetter({\r\n            valueChangedToTrue: dynamicSignals[name]\r\n          })\r\n        });\r\n\r\n      const dynamicSetters = {\r\n        collectionName: this.setCollectionName.bind(this),\r\n        visualFilter: this.setVisualFilter.bind(this),\r\n        visualSort: this.setVisualSorting.bind(this)\r\n      };\r\n\r\n      if (dynamicSetters[name])\r\n        return this.registerInput(name, {\r\n          set: dynamicSetters[name]\r\n        });\r\n\r\n      this.registerInput(name, {\r\n        set: userInputSetter.bind(this, name)\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\nfunction userOutputGetter(name) {\r\n  /* jshint validthis:true */\r\n  return this._internal.storageSettings[name];\r\n}\r\n\r\nfunction userInputSetter(name, value) {\r\n  /* jshint validthis:true */\r\n  this._internal.storageSettings[name] = value;\r\n\r\n  if (this.isInputConnected('storageFetch') === false) this.scheduleFetch();\r\n}\r\n\r\nconst _defaultJSONQuery =\r\n  '// Write your query script here, check out the reference documentation for examples\\n' + 'where({ })\\n';\r\n\r\nfunction updatePorts(nodeId, parameters, editorConnection, graphModel) {\r\n  var ports = [];\r\n\r\n  const dbCollections = graphModel.getMetaData('dbCollections');\r\n  const systemCollections = graphModel.getMetaData('systemCollections');\r\n\r\n  const _systemClasses = [\r\n    { label: 'User', value: '_User' },\r\n    { label: 'Role', value: '_Role' }\r\n  ];\r\n  ports.push({\r\n    name: 'collectionName',\r\n    type: {\r\n      name: 'enum',\r\n      enums: _systemClasses.concat(\r\n        dbCollections !== undefined\r\n          ? dbCollections.map((c) => {\r\n              return { value: c.name, label: c.name };\r\n            })\r\n          : []\r\n      ),\r\n      allowEditOnly: true\r\n    },\r\n    displayName: 'Class',\r\n    plug: 'input',\r\n    group: 'General'\r\n  });\r\n\r\n  ports.push({\r\n    name: 'storageFilterType',\r\n    type: {\r\n      name: 'enum',\r\n      allowEditOnly: true,\r\n      enums: [\r\n        { value: 'simple', label: 'Visual' },\r\n        { value: 'json', label: 'Javascript' }\r\n      ]\r\n    },\r\n    displayName: 'Filter',\r\n    default: 'simple',\r\n    plug: 'input',\r\n    group: 'General'\r\n  });\r\n\r\n  // Limit\r\n  ports.push({\r\n    type: 'boolean',\r\n    plug: 'input',\r\n    group: 'Limit',\r\n    name: 'storageEnableLimit',\r\n    displayName: 'Use limit'\r\n  });\r\n\r\n  if (parameters['storageEnableLimit']) {\r\n    ports.push({\r\n      type: 'number',\r\n      default: 10,\r\n      plug: 'input',\r\n      group: 'Limit',\r\n      name: 'storageLimit',\r\n      displayName: 'Limit'\r\n    });\r\n\r\n    ports.push({\r\n      type: 'number',\r\n      default: 0,\r\n      plug: 'input',\r\n      group: 'Limit',\r\n      name: 'storageSkip',\r\n      displayName: 'Skip'\r\n    });\r\n  }\r\n\r\n  ports.push({\r\n    type: 'signal',\r\n    plug: 'input',\r\n    group: 'Actions',\r\n    name: 'storageFetch',\r\n    displayName: 'Do'\r\n  });\r\n\r\n  // Total Count\r\n  ports.push({\r\n    type: 'boolean',\r\n    plug: 'input',\r\n    group: 'Total Count',\r\n    name: 'storageEnableCount',\r\n    displayName: 'Fetch total count'\r\n  });\r\n\r\n  if (parameters['storageEnableCount']) {\r\n    ports.push({\r\n      type: 'number',\r\n      plug: 'output',\r\n      group: 'General',\r\n      name: 'storageTotalCount',\r\n      displayName: 'Total Count'\r\n    });\r\n  }\r\n\r\n  // Simple query\r\n  if (parameters['storageFilterType'] === undefined || parameters['storageFilterType'] === 'simple') {\r\n    if (parameters.collectionName !== undefined) {\r\n      var c = dbCollections && dbCollections.find((c) => c.name === parameters.collectionName);\r\n      if (c === undefined && systemCollections) c = systemCollections.find((c) => c.name === parameters.collectionName);\r\n      if (c && c.schema && c.schema.properties) {\r\n        const schema = JSON.parse(JSON.stringify(c.schema));\r\n\r\n        // Find all records that have a relation with this type\r\n        function _findRelations(c) {\r\n          if (c.schema !== undefined && c.schema.properties !== undefined)\r\n            for (var key in c.schema.properties) {\r\n              var p = c.schema.properties[key];\r\n              if (p.type === 'Relation' && p.targetClass === parameters.collectionName) {\r\n                if (schema.relations === undefined) schema.relations = {};\r\n                if (schema.relations[c.name] === undefined) schema.relations[c.name] = [];\r\n\r\n                schema.relations[c.name].push({ property: key });\r\n              }\r\n            }\r\n        }\r\n\r\n        dbCollections && dbCollections.forEach(_findRelations);\r\n        systemCollections && systemCollections.forEach(_findRelations);\r\n\r\n        ports.push({\r\n          name: 'visualFilter',\r\n          plug: 'input',\r\n          type: { name: 'query-filter', schema: schema, allowEditOnly: true },\r\n          displayName: 'Filter',\r\n          group: 'Filter'\r\n        });\r\n\r\n        ports.push({\r\n          name: 'visualSort',\r\n          plug: 'input',\r\n          type: { name: 'query-sorting', schema: schema, allowEditOnly: true },\r\n          displayName: 'Sort',\r\n          group: 'Sorting'\r\n        });\r\n      }\r\n\r\n      if (parameters.visualFilter !== undefined) {\r\n        // Find all input ports\r\n        const uniqueInputs = {};\r\n        function _collectInputs(query) {\r\n          if (query === undefined) return;\r\n          if (query.rules !== undefined) query.rules.forEach((r) => _collectInputs(r));\r\n          else if (query.input !== undefined) uniqueInputs[query.input] = true;\r\n        }\r\n\r\n        _collectInputs(parameters.visualFilter);\r\n        Object.keys(uniqueInputs).forEach((input) => {\r\n          ports.push({\r\n            name: 'qp-' + input,\r\n            plug: 'input',\r\n            type: '*',\r\n            displayName: input,\r\n            group: 'Query Parameters'\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n  // JSON query\r\n  else if (parameters['storageFilterType'] === 'json') {\r\n    ports.push({\r\n      type: { name: 'string', allowEditOnly: true, codeeditor: 'javascript' },\r\n      plug: 'input',\r\n      group: 'Filter',\r\n      name: 'storageJSONFilter',\r\n      default: _defaultJSONQuery,\r\n      displayName: 'Filter'\r\n    });\r\n\r\n    var filter = parameters['storageJSONFilter'];\r\n    if (filter) {\r\n      filter = filter.replace(/\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/g, ''); // Remove comments\r\n      var variables = filter.match(/\\$[A-Za-z0-9]+/g);\r\n\r\n      if (variables) {\r\n        const unique = {};\r\n        variables.forEach((v) => {\r\n          unique[v] = true;\r\n        });\r\n\r\n        Object.keys(unique).forEach((p) => {\r\n          ports.push({\r\n            name: 'storageFilterValue-' + p.substring(1),\r\n            displayName: p.substring(1),\r\n            group: 'Filter Values',\r\n            plug: 'input',\r\n            type: { name: '*', allowConnectionsOnly: true }\r\n          });\r\n        });\r\n      }\r\n\r\n      // Support variables with the \"Inputs.\"\" syntax\r\n      JavascriptNodeParser.parseAndAddPortsFromScript(filter, ports, {\r\n        inputPrefix: 'storageFilterValue-',\r\n        inputGroup: 'Filter Values',\r\n        inputType: { name: '*', allowConnectionsOnly: true },\r\n        skipOutputs: true\r\n      });\r\n    }\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nmodule.exports = {\r\n  node: DbCollectionNode,\r\n  setup: function (context, graphModel) {\r\n    if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n      return;\r\n    }\r\n\r\n    function _managePortsForNode(node) {\r\n      updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n\r\n      node.on('parameterUpdated', function (event) {\r\n        if (event.name.startsWith('storage') || event.name === 'visualFilter' || event.name === 'collectionName') {\r\n          updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n        }\r\n      });\r\n\r\n      graphModel.on('metadataChanged.dbCollections', function (data) {\r\n        CloudStore.invalidateCollections();\r\n        updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n      });\r\n\r\n      graphModel.on('metadataChanged.systemCollections', function (data) {\r\n        CloudStore.invalidateCollections();\r\n        updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n      });\r\n\r\n      graphModel.on('metadataChanged.cloudservices', function (data) {\r\n        CloudStore.instance._initCloudServices();\r\n      });\r\n    }\r\n\r\n    graphModel.on('editorImportComplete', () => {\r\n      graphModel.on('nodeAdded.DbCollection2', function (node) {\r\n        _managePortsForNode(node);\r\n      });\r\n\r\n      for (const node of graphModel.getNodesWithType('DbCollection2')) {\r\n        _managePortsForNode(node);\r\n      }\r\n    });\r\n  }\r\n};\r\n","'use strict';\r\n\r\nconst ConfigService = require('../../../api/configservice');\r\n\r\nvar ConfigNodeDefinition = {\r\n  name: 'DbConfig',\r\n  docs: 'https://docs.noodl.net/nodes/data/cloud-data/config',\r\n  displayNodeName: 'Config',\r\n  category: 'Cloud Services',\r\n  usePortAsLabel: 'configKey',\r\n  color: 'data',\r\n  initialize: function () {\r\n    var internal = this._internal;\r\n\r\n    ConfigService.instance.getConfig().then((config) => {\r\n      internal.config = config;\r\n      if (this.hasOutput('value')) this.flagOutputDirty('value');\r\n    });\r\n  },\r\n  getInspectInfo() {\r\n    const value = this.getValue();\r\n\r\n    if (value === undefined) return '[No Value]';\r\n\r\n    return [{ type: 'value', value: value }];\r\n  },\r\n  inputs: {},\r\n  outputs: {},\r\n  methods: {\r\n    getValue: function () {\r\n      const internal = this._internal;\r\n      if (internal.useDevValue && this.context.editorConnection && this.context.editorConnection.isRunningLocally()) {\r\n        return internal.devValue;\r\n      } else if (internal.config !== undefined && internal.configKey !== undefined) {\r\n        return internal.config[internal.configKey];\r\n      }\r\n    },\r\n    setInternal: function (key, value) {\r\n      this._internal[key] = value;\r\n      if (this.hasOutput('value')) this.flagOutputDirty('value');\r\n    },\r\n    registerOutputIfNeeded: function (name) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === 'value')\r\n        return this.registerOutput(name, {\r\n          getter: this.getValue.bind(this)\r\n        });\r\n    },\r\n    registerInputIfNeeded: function (name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === 'configKey' || name === 'useDevValue' || name === 'devValue')\r\n        return this.registerInput(name, {\r\n          set: this.setInternal.bind(this, name)\r\n        });\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  node: ConfigNodeDefinition,\r\n  setup: function (context, graphModel) {\r\n    if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n      return;\r\n    }\r\n\r\n    function updatePorts(node) {\r\n      var ports = [];\r\n\r\n      context.editorConnection.clearWarning(node.component.name, node.id, 'dbconfig-warning');\r\n\r\n      const configSchema = graphModel.getMetaData('dbConfigSchema');\r\n      let valueType;\r\n\r\n      if (configSchema) {\r\n        const isCloud = typeof _noodl_cloud_runtime_version !== 'undefined';\r\n        ports.push({\r\n          name: 'configKey',\r\n          displayName: 'Parameter',\r\n          group: 'General',\r\n          type: {\r\n            name: 'enum',\r\n            enums: Object.keys(configSchema)\r\n              .filter((k) => isCloud || !configSchema[k].masterKeyOnly)\r\n              .map((k) => ({ value: k, label: k })),\r\n            allowEditOnly: true\r\n          },\r\n          plug: 'input'\r\n        });\r\n\r\n        if (node.parameters['configKey'] !== undefined && configSchema && configSchema[node.parameters['configKey']]) {\r\n          valueType = configSchema[node.parameters['configKey']].type;\r\n\r\n          if (\r\n            valueType === 'string' ||\r\n            valueType === 'boolean' ||\r\n            valueType === 'number' ||\r\n            valueType === 'object' ||\r\n            valueType === 'array'\r\n          ) {\r\n            ports.push({\r\n              name: 'useDevValue',\r\n              displayName: 'Enable',\r\n              group: 'Local Override',\r\n              type: 'boolean',\r\n              default: false,\r\n              plug: 'input'\r\n            });\r\n\r\n            if (node.parameters['useDevValue'] === true) {\r\n              ports.push({\r\n                name: 'devValue',\r\n                displayName: 'Value',\r\n                group: 'Local Override',\r\n                type: valueType,\r\n                plug: 'input'\r\n              });\r\n            }\r\n          }\r\n        } else if (node.parameters['configKey'] !== undefined) {\r\n          context.editorConnection.sendWarning(node.component.name, node.id, 'dbconfig-warning', {\r\n            showGlobally: true,\r\n            message: node.parameters['configKey'] + ' config parameter is missing, add it to your cloud service.'\r\n          });\r\n        }\r\n      } else {\r\n        context.editorConnection.sendWarning(node.component.name, node.id, 'dbconfig-warning', {\r\n          showGlobally: true,\r\n          message: 'You need an active cloud service.'\r\n        });\r\n      }\r\n\r\n      ports.push({\r\n        name: 'value',\r\n        displayName: 'Value',\r\n        group: 'General',\r\n        type: valueType || '*',\r\n        plug: 'output'\r\n      });\r\n\r\n      context.editorConnection.sendDynamicPorts(node.id, ports);\r\n    }\r\n\r\n    function _managePortsForNode(node) {\r\n      updatePorts(node);\r\n\r\n      node.on('parameterUpdated', function (event) {\r\n        updatePorts(node);\r\n      });\r\n\r\n      graphModel.on('metadataChanged.dbConfigSchema', function (data) {\r\n        ConfigService.instance.clearCache();\r\n        updatePorts(node);\r\n      });\r\n    }\r\n\r\n    graphModel.on('editorImportComplete', () => {\r\n      graphModel.on('nodeAdded.DbConfig', function (node) {\r\n        _managePortsForNode(node);\r\n      });\r\n\r\n      for (const node of graphModel.getNodesWithType('DbConfig')) {\r\n        _managePortsForNode(node);\r\n      }\r\n    });\r\n  }\r\n};\r\n","'use strict';\r\n\r\nconst Model = require('../../../model');\r\nconst CloudStore = require('../../../api/cloudstore');\r\n\r\nfunction _addBaseInfo(def, opts) {\r\n  const _includeInputProperties = opts === undefined || opts.includeInputProperties;\r\n  const _includeRelations = opts !== undefined && opts.includeRelations;\r\n\r\n  Object.assign(def.node, {\r\n    category: 'Data',\r\n    color: 'data',\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {}\r\n  });\r\n\r\n  // Outputs\r\n  Object.assign(def.node.outputs, {\r\n    failure: {\r\n      type: 'signal',\r\n      displayName: 'Failure',\r\n      group: 'Events'\r\n    },\r\n    error: {\r\n      type: 'string',\r\n      displayName: 'Error',\r\n      group: 'Error',\r\n      getter: function () {\r\n        return this._internal.error;\r\n      }\r\n    }\r\n  });\r\n\r\n  // Methods\r\n  Object.assign(def.node.methods, {\r\n    scheduleOnce: function (type, cb) {\r\n      const _this = this;\r\n      const _type = 'hasScheduled' + type;\r\n      if (this._internal[_type]) return;\r\n      this._internal[_type] = true;\r\n      this.scheduleAfterInputsHaveUpdated(function () {\r\n        _this._internal[_type] = false;\r\n        cb();\r\n      });\r\n    },\r\n    checkWarningsBeforeCloudOp() {\r\n      //clear all errors first\r\n      this.clearWarnings();\r\n\r\n      if (!this._internal.collectionId) {\r\n        this.setError('No class name specified');\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    },\r\n    setError: function (err) {\r\n      this._internal.error = err;\r\n      this.flagOutputDirty('error');\r\n      this.sendSignalOnOutput('failure');\r\n\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'storage-op-warning', {\r\n          message: err,\r\n          showGlobally: true\r\n        });\r\n      }\r\n    },\r\n    clearWarnings() {\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, 'storage-op-warning');\r\n      }\r\n    }\r\n  });\r\n\r\n  // Setup\r\n  Object.assign(def, {\r\n    setup: function (context, graphModel) {\r\n      if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n        return;\r\n      }\r\n\r\n      function _managePortsForNode(node) {\r\n        function _updatePorts() {\r\n          var ports = [];\r\n\r\n          const dbCollections = graphModel.getMetaData('dbCollections');\r\n          const systemCollections = graphModel.getMetaData('systemCollections');\r\n\r\n          const _systemClasses = [\r\n            { label: 'User', value: '_User' },\r\n            { label: 'Role', value: '_Role' }\r\n          ];\r\n\r\n          const parameters = node.parameters;\r\n\r\n          ports.push({\r\n            name: 'collectionName',\r\n            displayName: 'Class',\r\n            group: 'General',\r\n            type: {\r\n              name: 'enum',\r\n              enums: _systemClasses.concat(\r\n                dbCollections !== undefined\r\n                  ? dbCollections.map((c) => {\r\n                      return { value: c.name, label: c.name };\r\n                    })\r\n                  : []\r\n              ),\r\n              allowEditOnly: true\r\n            },\r\n            plug: 'input'\r\n          });\r\n\r\n          if (_includeRelations && parameters.collectionName && dbCollections) {\r\n            // Fetch ports from collection keys\r\n            var c = dbCollections.find((c) => c.name === parameters.collectionName);\r\n            if (c === undefined && systemCollections)\r\n              c = systemCollections.find((c) => c.name === parameters.collectionName);\r\n            if (c && c.schema && c.schema.properties) {\r\n              const props = c.schema.properties;\r\n              const enums = Object.keys(props)\r\n                .filter((key) => props[key].type === 'Relation')\r\n                .map((key) => ({ label: key, value: key }));\r\n\r\n              ports.push({\r\n                name: 'relationProperty',\r\n                displayName: 'Relation',\r\n                group: 'General',\r\n                type: { name: 'enum', enums: enums, allowEditOnly: true },\r\n                plug: 'input'\r\n              });\r\n            }\r\n          }\r\n\r\n          if (_includeInputProperties && parameters.collectionName && dbCollections) {\r\n            const _typeMap = {\r\n              String: 'string',\r\n              Boolean: 'boolean',\r\n              Number: 'number',\r\n              Date: 'date'\r\n            };\r\n\r\n            // Fetch ports from collection keys\r\n            var c = dbCollections.find((c) => c.name === parameters.collectionName);\r\n            if (c === undefined && systemCollections)\r\n              c = systemCollections.find((c) => c.name === parameters.collectionName);\r\n            if (c && c.schema && c.schema.properties) {\r\n              var props = c.schema.properties;\r\n              for (var key in props) {\r\n                var p = props[key];\r\n                if (ports.find((_p) => _p.name === key)) continue;\r\n\r\n                ports.push({\r\n                  type: {\r\n                    name: _typeMap[p.type] ? _typeMap[p.type] : '*'\r\n                  },\r\n                  plug: 'input',\r\n                  group: 'Properties',\r\n                  name: 'prop-' + key,\r\n                  displayName: key\r\n                });\r\n              }\r\n            }\r\n          }\r\n\r\n          def._additionalDynamicPorts && def._additionalDynamicPorts(node, ports, graphModel);\r\n\r\n          context.editorConnection.sendDynamicPorts(node.id, ports);\r\n        }\r\n\r\n        _updatePorts();\r\n\r\n        node.on('parameterUpdated', function (event) {\r\n          _updatePorts();\r\n        });\r\n\r\n        graphModel.on('metadataChanged.dbCollections', function (data) {\r\n          CloudStore.invalidateCollections();\r\n          _updatePorts();\r\n        });\r\n\r\n        graphModel.on('metadataChanged.systemCollections', function (data) {\r\n          CloudStore.invalidateCollections();\r\n          _updatePorts();\r\n        });\r\n      }\r\n\r\n      graphModel.on('editorImportComplete', () => {\r\n        graphModel.on('nodeAdded.' + def.node.name, function (node) {\r\n          _managePortsForNode(node);\r\n        });\r\n\r\n        for (const node of graphModel.getNodesWithType(def.node.name)) {\r\n          _managePortsForNode(node);\r\n        }\r\n      });\r\n    }\r\n  });\r\n}\r\n\r\nfunction _addModelId(def, opts) {\r\n  var _def = { node: Object.assign({}, def.node), setup: def.setup };\r\n  var _methods = Object.assign({}, def.node.methods);\r\n\r\n  const _includeInputs = opts === undefined || opts.includeInputs;\r\n  const _includeOutputs = opts === undefined || opts.includeOutputs;\r\n\r\n  Object.assign(def.node, {\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {}\r\n  });\r\n\r\n  if (_includeInputs) {\r\n    Object.assign(def.node, {\r\n      usePortAsLabel: 'collectionName'\r\n    });\r\n\r\n    def.node.dynamicports = (def.node.dynamicports || []).concat([\r\n      {\r\n        name: 'conditionalports/extended',\r\n        condition: 'idSource = explicit OR idSource NOT SET',\r\n        inputs: ['modelId']\r\n      }\r\n    ]);\r\n\r\n    // Inputs\r\n    Object.assign(def.node.inputs, {\r\n      idSource: {\r\n        type: {\r\n          name: 'enum',\r\n          enums: [\r\n            { label: 'Specify explicitly', value: 'explicit' },\r\n            { label: 'From repeater', value: 'foreach' }\r\n          ],\r\n          allowEditOnly: true\r\n        },\r\n        default: 'explicit',\r\n        displayName: 'Id Source',\r\n        group: 'General',\r\n        tooltip:\r\n          'Choose if you want to specify the Id explicitly, \\n or if you want it to be that of the current record in a repeater.',\r\n        set: function (value) {\r\n          if (value === 'foreach') {\r\n            this.scheduleAfterInputsHaveUpdated(() => {\r\n              // Find closest nodescope that have a _forEachModel\r\n              var component = this.nodeScope.componentOwner;\r\n              while (component !== undefined && component._forEachModel === undefined && component.parentNodeScope) {\r\n                component = component.parentNodeScope.componentOwner;\r\n              }\r\n              this.setModel(component !== undefined ? component._forEachModel : undefined);\r\n            });\r\n          }\r\n        }\r\n      },\r\n      modelId: {\r\n        type: {\r\n          name: 'string',\r\n          identifierOf: 'ModelName',\r\n          identifierDisplayName: 'Object Ids'\r\n        },\r\n        displayName: 'Id',\r\n        group: 'General',\r\n        set: function (value) {\r\n          if (value instanceof Model) value = value.getId(); // Can be passed as model as well\r\n          this._internal.modelId = value; // Wait to fetch data\r\n          this.setModelID(value);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // Outputs\r\n  if (_includeOutputs) {\r\n    Object.assign(def.node.outputs, {\r\n      id: {\r\n        type: 'string',\r\n        displayName: 'Id',\r\n        group: 'General',\r\n        getter: function () {\r\n          return this._internal.model ? this._internal.model.getId() : this._internal.modelId;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // Methods\r\n  Object.assign(def.node.methods, {\r\n    setCollectionID: function (id) {\r\n      this._internal.collectionId = id;\r\n      this.clearWarnings();\r\n    },\r\n    setModelID: function (id) {\r\n      var model = (this.nodeScope.modelScope || Model).get(id);\r\n      this.setModel(model);\r\n    },\r\n    setModel: function (model) {\r\n      this._internal.model = model;\r\n      this.flagOutputDirty('id');\r\n    },\r\n    registerInputIfNeeded: function (name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === 'collectionName')\r\n        this.registerInput(name, {\r\n          set: this.setCollectionID.bind(this)\r\n        });\r\n\r\n      _methods && _methods.registerInputIfNeeded && _methods.registerInputIfNeeded.call(this, name);\r\n    }\r\n  });\r\n}\r\n\r\nfunction _addInputProperties(def) {\r\n  var _def = { node: Object.assign({}, def.node), setup: def.setup };\r\n  var _methods = Object.assign({}, def.node.methods);\r\n\r\n  Object.assign(def.node, {\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {}\r\n  });\r\n\r\n  Object.assign(def.node, {\r\n    initialize: function () {\r\n      var internal = this._internal;\r\n      internal.inputValues = {};\r\n\r\n      _def.node.initialize && _def.node.initialize.call(this);\r\n    }\r\n  });\r\n\r\n  // Outputs\r\n  Object.assign(def.node.outputs, {});\r\n\r\n  // Inputs\r\n  Object.assign(def.node.inputs, {});\r\n\r\n  // Methods\r\n  Object.assign(def.node.methods, {\r\n    registerInputIfNeeded: function (name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('prop-'))\r\n        this.registerInput(name, {\r\n          set: this._setInputValue.bind(this, name.substring('prop-'.length))\r\n        });\r\n\r\n      _methods && _methods.registerInputIfNeeded && _methods.registerInputIfNeeded.call(this, name);\r\n    },\r\n    _setInputValue: function (name, value) {\r\n      this._internal.inputValues[name] = value;\r\n    }\r\n  });\r\n}\r\n\r\nfunction _addRelationProperty(def) {\r\n  var _def = { node: Object.assign({}, def.node), setup: def.setup };\r\n  var _methods = Object.assign({}, def.node.methods);\r\n\r\n  Object.assign(def.node, {\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {}\r\n  });\r\n\r\n  // Inputs\r\n  Object.assign(def.node.inputs, {\r\n    targetId: {\r\n      type: { name: 'string', allowConnectionsOnly: true },\r\n      displayName: 'Target Record Id',\r\n      group: 'General',\r\n      set: function (value) {\r\n        this._internal.targetModelId = value;\r\n      }\r\n    }\r\n  });\r\n\r\n  // Methods\r\n  Object.assign(def.node.methods, {\r\n    registerInputIfNeeded: function (name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === 'relationProperty')\r\n        this.registerInput(name, {\r\n          set: this.setRelationProperty.bind(this)\r\n        });\r\n\r\n      _methods && _methods.registerInputIfNeeded && _methods.registerInputIfNeeded.call(this, name);\r\n    },\r\n    setRelationProperty: function (value) {\r\n      this._internal.relationProperty = value;\r\n    }\r\n  });\r\n}\r\n\r\nfunction _getCurrentUser(modelScope) {\r\n  if (typeof _noodl_cloud_runtime_version === 'undefined') {\r\n    // We are running in browser, try to find the current user\r\n\r\n    var _cu = localStorage['Parse/' + CloudStore.instance.appId + '/currentUser'];\r\n    if (_cu !== undefined) {\r\n      let cu;\r\n      try {\r\n        cu = JSON.parse(_cu);\r\n      } catch (e) {}\r\n\r\n      return cu !== undefined ? cu.objectId : undefined;\r\n    }\r\n  } else {\r\n    // Assume we are running in cloud runtime\r\n    const request = modelScope.get('Request');\r\n    return request.UserId;\r\n  }\r\n}\r\n\r\nfunction _addAccessControl(def) {\r\n  var _def = { node: Object.assign({}, def.node), setup: def.setup };\r\n  var _methods = Object.assign({}, def.node.methods);\r\n\r\n  Object.assign(def.node, {\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {}\r\n  });\r\n\r\n  Object.assign(def.node, {\r\n    initialize: function () {\r\n      var internal = this._internal;\r\n      internal.accessControl = {};\r\n\r\n      _def.node.initialize && _def.node.initialize.call(this);\r\n    }\r\n  });\r\n\r\n  // Inputs\r\n  Object.assign(def.node.inputs, {\r\n    accessControl: {\r\n      type: { name: 'proplist', autoName: 'Rule', allowEditOnly: true },\r\n      index: 1000,\r\n      displayName: 'Access Control Rules',\r\n      group: 'Access Control Rules',\r\n      set: function (value) {\r\n        this._internal.accessControlRules = value;\r\n      }\r\n    }\r\n  });\r\n\r\n  // Dynamic ports\r\n  const _super = def._additionalDynamicPorts;\r\n  def._additionalDynamicPorts = function (node, ports, graphModel) {\r\n    if (node.parameters['accessControl'] !== undefined && node.parameters['accessControl'].length > 0) {\r\n      node.parameters['accessControl'].forEach((ac) => {\r\n        const prefix = 'acl-' + ac.id;\r\n        // User or role?\r\n        ports.push({\r\n          name: prefix + '-target',\r\n          displayName: 'Target',\r\n          editorName: ac.label + ' | Target',\r\n          plug: 'input',\r\n          type: {\r\n            name: 'enum',\r\n            enums: [\r\n              { value: 'user', label: 'User' },\r\n              { value: 'everyone', label: 'Everyone' },\r\n              { value: 'role', label: 'Role' }\r\n            ],\r\n            allowEditOnly: true\r\n          },\r\n          group: ac.label + ' Access Rule',\r\n          default: 'user',\r\n          parent: 'accessControl',\r\n          parentItemId: ac.id\r\n        });\r\n\r\n        if (node.parameters[prefix + '-target'] === 'role') {\r\n          ports.push({\r\n            name: prefix + '-role',\r\n            displayName: 'Role',\r\n            editorName: ac.label + ' | Role',\r\n            group: ac.label + ' Access Rule',\r\n            plug: 'input',\r\n            type: 'string',\r\n            parent: 'accessControl',\r\n            parentItemId: ac.id\r\n          });\r\n        } else if (\r\n          node.parameters[prefix + '-target'] === undefined ||\r\n          node.parameters[prefix + '-target'] === 'user'\r\n        ) {\r\n          ports.push({\r\n            name: prefix + '-userid',\r\n            displayName: 'User Id',\r\n            group: ac.label + ' Access Rule',\r\n            editorName: ac.label + ' | User Id',\r\n            plug: 'input',\r\n            type: { name: 'string', allowConnectionsOnly: true },\r\n            parent: 'accessControl',\r\n            parentItemId: ac.id\r\n          });\r\n        }\r\n\r\n        // Read\r\n        ports.push({\r\n          name: prefix + '-read',\r\n          displayName: 'Read',\r\n          editorName: ac.label + ' | Read',\r\n          group: ac.label + ' Access Rule',\r\n          plug: 'input',\r\n          type: { name: 'boolean' },\r\n          default: true,\r\n          parent: 'accessControl',\r\n          parentItemId: ac.id\r\n        });\r\n\r\n        // Write\r\n        ports.push({\r\n          name: prefix + '-write',\r\n          displayName: 'Write',\r\n          editorName: ac.label + ' | Write',\r\n          group: ac.label + ' Access Rule',\r\n          plug: 'input',\r\n          type: { name: 'boolean' },\r\n          default: true,\r\n          parent: 'accessControl',\r\n          parentItemId: ac.id\r\n        });\r\n      });\r\n    }\r\n\r\n    _super && _super(node, ports, graphModel);\r\n  };\r\n\r\n  // Methods\r\n  Object.assign(def.node.methods, {\r\n    registerInputIfNeeded: function (name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('acl-'))\r\n        this.registerInput(name, {\r\n          set: this.setAccessControl.bind(this, name)\r\n        });\r\n\r\n      _methods && _methods.registerInputIfNeeded && _methods.registerInputIfNeeded.call(this, name);\r\n    },\r\n    _getACL: function () {\r\n      let acl = {};\r\n\r\n      function _rule(rule) {\r\n        return {\r\n          read: rule.read === undefined ? true : rule.read,\r\n          write: rule.write === undefined ? true : rule.write\r\n        };\r\n      }\r\n\r\n      const currentUserId = _getCurrentUser(this.nodeScope.modelScope);\r\n\r\n      if (this._internal.accessControlRules !== undefined) {\r\n        this._internal.accessControlRules.forEach((r) => {\r\n          const rule = this._internal.accessControl[r.id];\r\n\r\n          if (rule === undefined) {\r\n            const userId = currentUserId;\r\n            if (userId !== undefined) acl[userId] = { write: true, read: true };\r\n          } else if (rule.target === 'everyone') {\r\n            acl['*'] = _rule(rule);\r\n          } else if (rule.target === 'user') {\r\n            const userId = rule.userid || currentUserId;\r\n            acl[userId] = _rule(rule);\r\n          } else if (rule.target === 'role') {\r\n            acl['role:' + rule.role] = _rule(rule);\r\n          }\r\n        });\r\n      }\r\n\r\n      return Object.keys(acl).length > 0 ? acl : undefined;\r\n    },\r\n    setAccessControl: function (name, value) {\r\n      const _parts = name.split('-');\r\n\r\n      if (this._internal.accessControl[_parts[1]] === undefined) this._internal.accessControl[_parts[1]] = {};\r\n      this._internal.accessControl[_parts[1]][_parts[2]] = value;\r\n    }\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  addInputProperties: _addInputProperties,\r\n  addModelId: _addModelId,\r\n  addBaseInfo: _addBaseInfo,\r\n  addRelationProperty: _addRelationProperty,\r\n  addAccessControl: _addAccessControl\r\n};\r\n","'use strict';\r\n\r\nvar Model = require('../../../model');\r\nvar DbModelCRUDBase = require('./dbmodelcrudbase');\r\nconst CloudStore = require('../../../api/cloudstore');\r\n\r\nvar AddDbModelRelationNodeDefinition = {\r\n  node: {\r\n    name: 'AddDbModelRelation',\r\n    docs: 'https://docs.noodl.net/nodes/data/cloud-data/add-record-relation',\r\n    displayNodeName: 'Add Record Relation',\r\n    usePortAsLabel: 'collectionName',\r\n    // shortDesc: \"Stores any amount of properties and can be used standalone or together with Collections and For Each nodes.\",\r\n    inputs: {\r\n      store: {\r\n        displayName: 'Do',\r\n        group: 'Actions',\r\n        valueChangedToTrue: function () {\r\n          this.scheduleAddRelation();\r\n        }\r\n      }\r\n    },\r\n    outputs: {\r\n      relationAdded: {\r\n        type: 'signal',\r\n        displayName: 'Success',\r\n        group: 'Events'\r\n      }\r\n    },\r\n    methods: {\r\n      validateInputs: function () {\r\n        if (!this.context.editorConnection) return;\r\n\r\n        const _warning = (message) => {\r\n          this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'add-relation', {\r\n            message\r\n          });\r\n        };\r\n\r\n        if (this._internal.collectionId === undefined) {\r\n          _warning('No class specified');\r\n        } else if (this._internal.relationProperty === undefined) {\r\n          _warning('No relation property specified');\r\n        } else if (this._internal.targetModelId === undefined) {\r\n          _warning('No target record Id (the record to add a relation to) specified');\r\n        } else if (this._internal.model === undefined) {\r\n          _warning('No record Id specified (the record that should get the relation)');\r\n        } else {\r\n          this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, 'add-relation');\r\n        }\r\n      },\r\n      scheduleAddRelation: function (key) {\r\n        const _this = this;\r\n        const internal = this._internal;\r\n\r\n        this.scheduleOnce('StorageAddRelation', function () {\r\n          _this.validateInputs();\r\n\r\n          if (!internal.model) return;\r\n          var model = internal.model;\r\n\r\n          var targetModelId = internal.targetModelId;\r\n          if (targetModelId === undefined) return;\r\n\r\n          CloudStore.forScope(_this.nodeScope.modelScope).addRelation({\r\n            collection: internal.collectionId,\r\n            objectId: model.getId(),\r\n            key: internal.relationProperty,\r\n            targetObjectId: targetModelId,\r\n            targetClass: (_this.nodeScope.modelScope || Model).get(targetModelId)._class,\r\n            success: function (response) {\r\n              for (var _key in response) {\r\n                model.set(_key, response[_key]);\r\n              }\r\n\r\n              // Successfully added relation\r\n              _this.sendSignalOnOutput('relationAdded');\r\n            },\r\n            error: function (err) {\r\n              _this.setError(err || 'Failed to add relation.');\r\n            }\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nDbModelCRUDBase.addBaseInfo(AddDbModelRelationNodeDefinition, {\r\n  includeRelations: true\r\n});\r\nDbModelCRUDBase.addModelId(AddDbModelRelationNodeDefinition);\r\nDbModelCRUDBase.addRelationProperty(AddDbModelRelationNodeDefinition);\r\n\r\nmodule.exports = AddDbModelRelationNodeDefinition;\r\n","'use strict';\r\n\r\nvar Model = require('../../../model');\r\nvar DbModelCRUDBase = require('./dbmodelcrudbase');\r\nconst CloudStore = require('../../../api/cloudstore');\r\n\r\nvar AddDbModelRelationNodeDefinition = {\r\n  node: {\r\n    name: 'RemoveDbModelRelation',\r\n    docs: 'https://docs.noodl.net/nodes/data/cloud-data/remove-record-relation',\r\n    displayName: 'Remove Record Relation',\r\n    usePortAsLabel: 'collectionName',\r\n    inputs: {\r\n      store: {\r\n        displayName: 'Do',\r\n        group: 'Actions',\r\n        valueChangedToTrue: function () {\r\n          this.scheduleRemoveRelation();\r\n        }\r\n      }\r\n    },\r\n    outputs: {\r\n      relationRemoved: {\r\n        type: 'signal',\r\n        displayName: 'Success',\r\n        group: 'Events'\r\n      }\r\n    },\r\n    methods: {\r\n      validateInputs: function () {\r\n        if (!this.context.editorConnection) return;\r\n\r\n        const _warning = (message) => {\r\n          this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'add-relation', {\r\n            message\r\n          });\r\n        };\r\n\r\n        if (this._internal.collectionId === undefined) {\r\n          _warning('No class specified');\r\n        } else if (this._internal.relationProperty === undefined) {\r\n          _warning('No relation property specified');\r\n        } else if (this._internal.targetModelId === undefined) {\r\n          _warning('No target record Id (the record to add a relation to) specified');\r\n        } else if (this._internal.model === undefined) {\r\n          _warning('No record Id specified (the record that should get the relation)');\r\n        } else {\r\n          this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, 'add-relation');\r\n        }\r\n      },\r\n      scheduleRemoveRelation: function (key) {\r\n        const _this = this;\r\n        const internal = this._internal;\r\n\r\n        this.scheduleOnce('StorageRemoveRelation', function () {\r\n          _this.validateInputs();\r\n\r\n          if (!internal.model) return;\r\n          var model = internal.model;\r\n\r\n          var targetModelId = internal.targetModelId;\r\n          if (targetModelId === undefined) return;\r\n\r\n          CloudStore.forScope(_this.nodeScope.modelScope).removeRelation({\r\n            collection: internal.collectionId,\r\n            objectId: model.getId(),\r\n            key: internal.relationProperty,\r\n            targetObjectId: targetModelId,\r\n            targetClass: (_this.nodeScope.modelScope || Model).get(targetModelId)._class,\r\n            success: function (response) {\r\n              for (var _key in response) {\r\n                model.set(_key, response[_key]);\r\n              }\r\n\r\n              // Successfully removed relation\r\n              _this.sendSignalOnOutput('relationRemoved');\r\n            },\r\n            error: function (err) {\r\n              _this.setError(err || 'Failed to remove relation.');\r\n            }\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nDbModelCRUDBase.addBaseInfo(AddDbModelRelationNodeDefinition, {\r\n  includeRelations: true\r\n});\r\nDbModelCRUDBase.addModelId(AddDbModelRelationNodeDefinition);\r\nDbModelCRUDBase.addRelationProperty(AddDbModelRelationNodeDefinition);\r\n\r\nmodule.exports = AddDbModelRelationNodeDefinition;\r\n","'use strict';\r\n\r\nconst { Node, EdgeTriggeredInput } = require('../../../../noodl-runtime');\r\n\r\nconst Model = require('../../../model');\r\nconst CloudStore = require('../../../api/cloudstore');\r\n\r\nconst ModelNodeDefinition = {\r\n  name: 'DbModel2',\r\n  docs: 'https://docs.noodl.net/nodes/data/cloud-data/record',\r\n  displayNodeName: 'Record',\r\n  shortDesc: 'Database model',\r\n  category: 'Cloud Services',\r\n  usePortAsLabel: 'collectionName',\r\n  color: 'data',\r\n  dynamicports: [\r\n    {\r\n      name: 'conditionalports/extended',\r\n      condition: 'idSource = explicit OR idSource NOT SET',\r\n      inputs: ['modelId']\r\n    }\r\n  ],\r\n  initialize: function () {\r\n    const internal = this._internal;\r\n    internal.inputValues = {};\r\n    internal.relationModelIds = {};\r\n\r\n    const _this = this;\r\n    this._internal.onModelChangedCallback = function (args) {\r\n      if (_this.isInputConnected('fetch')) return;\r\n\r\n      if (_this.hasOutput('prop-' + args.name)) _this.flagOutputDirty('prop-' + args.name);\r\n\r\n      if (_this.hasOutput('changed-' + args.name)) _this.sendSignalOnOutput('changed-' + args.name);\r\n\r\n      _this.sendSignalOnOutput('changed');\r\n    };\r\n  },\r\n  getInspectInfo() {\r\n    const model = this._internal.model;\r\n    if (!model) return '[No Record]';\r\n\r\n    return [\r\n      { type: 'text', value: 'Id: ' + model.getId() },\r\n      { type: 'value', value: model.data }\r\n    ];\r\n  },\r\n  outputs: {\r\n    id: {\r\n      type: 'string',\r\n      displayName: 'Id',\r\n      group: 'General',\r\n      getter: function () {\r\n        return this._internal.model ? this._internal.model.getId() : this._internal.modelId;\r\n      }\r\n    },\r\n    fetched: {\r\n      type: 'signal',\r\n      displayName: 'Fetched',\r\n      group: 'Events'\r\n    },\r\n    changed: {\r\n      type: 'signal',\r\n      displayName: 'Changed',\r\n      group: 'Events'\r\n    },\r\n    failure: {\r\n      type: 'signal',\r\n      displayName: 'Failure',\r\n      group: 'Events'\r\n    },\r\n    error: {\r\n      type: 'string',\r\n      displayName: 'Error',\r\n      group: 'Error',\r\n      getter: function () {\r\n        return this._internal.error;\r\n      }\r\n    }\r\n  },\r\n  inputs: {\r\n    idSource: {\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: 'Specify explicitly', value: 'explicit' },\r\n          { label: 'From repeater', value: 'foreach' }\r\n        ],\r\n        allowEditOnly: true\r\n      },\r\n      default: 'explicit',\r\n      displayName: 'Id Source',\r\n      group: 'General',\r\n      set: function (value) {\r\n        if (value === 'foreach') {\r\n          this.scheduleAfterInputsHaveUpdated(() => {\r\n            // Find closest nodescope that have a _forEachModel\r\n            var component = this.nodeScope.componentOwner;\r\n            while (component !== undefined && component._forEachModel === undefined && component.parentNodeScope) {\r\n              component = component.parentNodeScope.componentOwner;\r\n            }\r\n            this.setModel(component !== undefined ? component._forEachModel : undefined);\r\n          });\r\n        }\r\n      }\r\n    },\r\n    modelId: {\r\n      type: { name: 'string', allowConnectionsOnly: true },\r\n      displayName: 'Id',\r\n      group: 'General',\r\n      set: function (value) {\r\n        if (value instanceof Model) {\r\n          // Can be passed as model as well\r\n          value = value.getId();\r\n        } else if (typeof value === 'object') {\r\n          // If this is an js object, dereference it\r\n          value = Model.create(value).getId();\r\n        }\r\n\r\n        this._internal.modelId = value; // Wait to fetch data\r\n        if (this.isInputConnected('fetch') === false) {\r\n          this.setModelID(value);\r\n        } else {\r\n          this.flagOutputDirty('id');\r\n        }\r\n      }\r\n    },\r\n    fetch: {\r\n      displayName: 'Fetch',\r\n      group: 'Actions',\r\n      valueChangedToTrue: function () {\r\n        this.scheduleFetch();\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    setCollectionID: function (id) {\r\n      this._internal.collectionId = id;\r\n    },\r\n    setModelID: function (id) {\r\n      var model = (this.nodeScope.modelScope || Model).get(id);\r\n      // this._internal.modelIsNew = false;\r\n      this.setModel(model);\r\n    },\r\n    setModel: function (model) {\r\n      if (this._internal.model) {\r\n        // Remove old listener if existing\r\n        this._internal.model.off('change', this._internal.onModelChangedCallback);\r\n      }\r\n\r\n      this._internal.model = model;\r\n      this.flagOutputDirty('id');\r\n      model.on('change', this._internal.onModelChangedCallback);\r\n\r\n      // We have a new model, mark all outputs as dirty\r\n      for (var key in model.data) {\r\n        if (this.hasOutput('prop-' + key)) {\r\n          this.flagOutputDirty('prop-' + key);\r\n        }\r\n      }\r\n      this.sendSignalOnOutput('fetched');\r\n    },\r\n    _onNodeDeleted: function () {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      if (this._internal.model) this._internal.model.off('change', this._internal.onModelChangedCallback);\r\n    },\r\n    scheduleOnce: function (type, cb) {\r\n      const _this = this;\r\n      const _type = 'hasScheduled' + type;\r\n      if (this._internal[_type]) return;\r\n      this._internal[_type] = true;\r\n      this.scheduleAfterInputsHaveUpdated(function () {\r\n        _this._internal[_type] = false;\r\n        cb();\r\n      });\r\n    },\r\n    setError: function (err) {\r\n      this._internal.error = err;\r\n      this.flagOutputDirty('error');\r\n      this.sendSignalOnOutput('failure');\r\n\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'storage-op-warning', {\r\n          message: err,\r\n          showGlobally: true\r\n        });\r\n      }\r\n    },\r\n    clearWarnings() {\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, 'storage-op-warning');\r\n      }\r\n    },\r\n    scheduleFetch: function () {\r\n      const _this = this;\r\n      const internal = this._internal;\r\n\r\n      this.scheduleOnce('Fetch', function () {\r\n        // Don't do fetch if no id\r\n        if (internal.modelId === undefined || internal.modelId === '') {\r\n          _this.setError('Missing Id.');\r\n          return;\r\n        }\r\n\r\n        const cloudstore = CloudStore.forScope(_this.nodeScope.modelScope);\r\n        cloudstore.fetch({\r\n          collection: internal.collectionId,\r\n          objectId: internal.modelId, // Get the objectId part of the model id\r\n          success: function (response) {\r\n            const model = cloudstore._fromJSON(response, internal.collectionId);\r\n            if (internal.model !== model) {\r\n              // Check if we need to change model\r\n              if (internal.model) {\r\n                // Remove old listener if existing\r\n                internal.model.off('change', internal.onModelChangedCallback);\r\n              }\r\n\r\n              internal.model = model;\r\n              model.on('change', internal.onModelChangedCallback);\r\n            }\r\n            _this.flagOutputDirty('id');\r\n\r\n            delete response.objectId;\r\n\r\n            for (const key in response) {\r\n              if (_this.hasOutput('prop-' + key)) {\r\n                _this.flagOutputDirty('prop-' + key);\r\n              }\r\n            }\r\n\r\n            _this.sendSignalOnOutput('fetched');\r\n          },\r\n          error: function (err) {\r\n            _this.setError(err || 'Failed to fetch.');\r\n          }\r\n        });\r\n      });\r\n    },\r\n    scheduleStore: function () {\r\n      var internal = this._internal;\r\n      if (!internal.model) return;\r\n\r\n      this.scheduleOnce('Store', function () {\r\n        for (var i in internal.inputValues) {\r\n          internal.model.set(i, internal.inputValues[i], { resolve: true });\r\n        }\r\n      });\r\n    },\r\n    registerOutputIfNeeded: function (name) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('prop-'))\r\n        this.registerOutput(name, {\r\n          getter: userOutputGetter.bind(this, name.substring('prop-'.length))\r\n        });\r\n    },\r\n    registerInputIfNeeded: function (name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      const dynamicSignals = {};\r\n\r\n      if (dynamicSignals[name])\r\n        return this.registerInput(name, {\r\n          set: EdgeTriggeredInput.createSetter({\r\n            valueChangedToTrue: dynamicSignals[name]\r\n          })\r\n        });\r\n\r\n      const dynamicSetters = {\r\n        collectionName: this.setCollectionID.bind(this)\r\n      };\r\n\r\n      if (dynamicSetters[name])\r\n        return this.registerInput(name, {\r\n          set: dynamicSetters[name]\r\n        });\r\n\r\n      if (name.startsWith('prop-'))\r\n        this.registerInput(name, {\r\n          set: userInputSetter.bind(this, name.substring('prop-'.length))\r\n        });\r\n    }\r\n  }\r\n};\r\n\r\nfunction userOutputGetter(name) {\r\n  /* jshint validthis:true */\r\n  return this._internal.model ? this._internal.model.get(name, { resolve: true }) : undefined;\r\n}\r\n\r\nfunction userInputSetter(name, value) {\r\n  //console.log('dbmodel setter:',name,value)\r\n  /* jshint validthis:true */\r\n  this._internal.inputValues[name] = value;\r\n}\r\n\r\nfunction updatePorts(nodeId, parameters, editorConnection, graphModel) {\r\n  var ports = [];\r\n\r\n  const dbCollections = graphModel.getMetaData('dbCollections');\r\n  const systemCollections = graphModel.getMetaData('systemCollections');\r\n\r\n  const _systemClasses = [\r\n    { label: 'User', value: '_User' },\r\n    { label: 'Role', value: '_Role' }\r\n  ];\r\n  ports.push({\r\n    name: 'collectionName',\r\n    displayName: 'Class',\r\n    group: 'General',\r\n    type: {\r\n      name: 'enum',\r\n      enums: _systemClasses.concat(\r\n        dbCollections !== undefined\r\n          ? dbCollections.map((c) => {\r\n              return { value: c.name, label: c.name };\r\n            })\r\n          : []\r\n      ),\r\n      allowEditOnly: true\r\n    },\r\n    plug: 'input'\r\n  });\r\n\r\n  if (parameters.collectionName && dbCollections) {\r\n    // Fetch ports from collection keys\r\n    var c = dbCollections.find((c) => c.name === parameters.collectionName);\r\n    if (c === undefined && systemCollections) c = systemCollections.find((c) => c.name === parameters.collectionName);\r\n    if (c && c.schema && c.schema.properties) {\r\n      var props = c.schema.properties;\r\n      for (var key in props) {\r\n        var p = props[key];\r\n        if (ports.find((_p) => _p.name === key)) continue;\r\n\r\n        if (p.type !== 'Relation') {\r\n          // Other schema type ports\r\n          const _typeMap = {\r\n            String: 'string',\r\n            Boolean: 'boolean',\r\n            Number: 'number',\r\n            Date: 'date'\r\n          };\r\n\r\n          ports.push({\r\n            type: {\r\n              name: _typeMap[p.type] ? _typeMap[p.type] : '*'\r\n            },\r\n            plug: 'output',\r\n            group: 'Properties',\r\n            name: 'prop-' + key,\r\n            displayName: key\r\n          });\r\n\r\n          ports.push({\r\n            type: 'signal',\r\n            plug: 'output',\r\n            group: 'Changed Events',\r\n            displayName: key + ' Changed',\r\n            name: 'changed-' + key\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nmodule.exports = {\r\n  node: ModelNodeDefinition,\r\n  setup: function (context, graphModel) {\r\n    if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n      return;\r\n    }\r\n\r\n    function _managePortsForNode(node) {\r\n      updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n\r\n      node.on('parameterUpdated', function () {\r\n        updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n      });\r\n\r\n      graphModel.on('metadataChanged.dbCollections', function () {\r\n        CloudStore.invalidateCollections();\r\n        updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n      });\r\n\r\n      graphModel.on('metadataChanged.systemCollections', function () {\r\n        CloudStore.invalidateCollections();\r\n        updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n      });\r\n    }\r\n\r\n    graphModel.on('editorImportComplete', () => {\r\n      graphModel.on('nodeAdded.DbModel2', function (node) {\r\n        _managePortsForNode(node);\r\n      });\r\n\r\n      for (const node of graphModel.getNodesWithType('DbModel2')) {\r\n        _managePortsForNode(node);\r\n      }\r\n    });\r\n  }\r\n};\r\n","'use strict';\r\n\r\nvar DbModelCRUDBase = require('./dbmodelcrudbase');\r\nconst CloudStore = require('../../../api/cloudstore');\r\n\r\nvar DeleteDbModelPropertiedNodeDefinition = {\r\n  node: {\r\n    name: 'DeleteDbModelProperties',\r\n    docs: 'https://docs.noodl.net/nodes/data/cloud-data/delete-record',\r\n    displayNodeName: 'Delete Record',\r\n    shortDesc:\r\n      'Stores any amount of properties and can be used standalone or together with Collections and For Each nodes.',\r\n    inputs: {\r\n      store: {\r\n        displayName: 'Do',\r\n        group: 'Actions',\r\n        valueChangedToTrue: function () {\r\n          this.storageDelete();\r\n        }\r\n      }\r\n    },\r\n    outputs: {\r\n      deleted: {\r\n        type: 'signal',\r\n        displayName: 'Success',\r\n        group: 'Events'\r\n      }\r\n    },\r\n    methods: {\r\n      storageDelete: function () {\r\n        const _this = this;\r\n        const internal = this._internal;\r\n\r\n        if (!this.checkWarningsBeforeCloudOp()) return;\r\n\r\n        this.scheduleOnce('StorageDelete', function () {\r\n          if (!internal.model) {\r\n            _this.setError('Missing Record Id');\r\n            return;\r\n          }\r\n\r\n          CloudStore.forScope(_this.nodeScope.ModelScope).delete({\r\n            collection: internal.collectionId,\r\n            objectId: internal.model.getId(), // Get the objectId part of the model id,\r\n            success: function () {\r\n              internal.model.notify('delete'); // Notify that this model has been deleted\r\n              _this.sendSignalOnOutput('deleted');\r\n            },\r\n            error: function (err) {\r\n              _this.setError(err || 'Failed to delete.');\r\n            }\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nDbModelCRUDBase.addBaseInfo(DeleteDbModelPropertiedNodeDefinition, {\r\n  includeInputProperties: false\r\n});\r\nDbModelCRUDBase.addModelId(DeleteDbModelPropertiedNodeDefinition);\r\n\r\nmodule.exports = DeleteDbModelPropertiedNodeDefinition;\r\n","'use strict';\r\n\r\nconst { Node } = require('../../../../noodl-runtime');\r\n\r\nconst Collection = require('../../../collection'),\r\n  Model = require('../../../model'),\r\n  CloudStore = require('../../../api/cloudstore'),\r\n  QueryUtils = require('../../../api/queryutils');\r\n\r\nvar FilterDBModelsNode = {\r\n  name: 'FilterDBModels',\r\n  docs: 'https://docs.noodl.net/nodes/data/cloud-data/filter-records',\r\n  displayNodeName: 'Filter Records',\r\n  shortDesc: 'Filter, sort and limit array',\r\n  category: 'Data',\r\n  color: 'data',\r\n  initialize: function () {\r\n    var _this = this;\r\n\r\n    this._internal.collectionChangedCallback = function () {\r\n      if (_this.isInputConnected('filter') === true) return;\r\n\r\n      _this.scheduleFilter();\r\n    };\r\n\r\n    this._internal.cloudStoreEvents = function (args) {\r\n      if (_this.isInputConnected('filter') === true) return;\r\n\r\n      if (_this._internal.visualFilter === undefined) return;\r\n      if (_this._internal.collection === undefined) return;\r\n      if (args.collection !== _this._internal.collectionName) return;\r\n\r\n      if (args.objectId !== undefined && _this._internal.collection.contains(Model.get(args.objectId)))\r\n        _this.scheduleFilter();\r\n    };\r\n\r\n    CloudStore.instance.on('save', this._internal.cloudStoreEvents);\r\n\r\n    this._internal.enabled = true;\r\n    this._internal.filterSettings = {};\r\n    this._internal.filterParameters = {};\r\n    //   this._internal.filteredCollection = Collection.get();\r\n  },\r\n  getInspectInfo() {\r\n    const collection = this._internal.filteredCollection;\r\n\r\n    if (!collection) {\r\n      return { type: 'text', value: '[Not executed yet]' };\r\n    }\r\n\r\n    return [\r\n      {\r\n        type: 'text',\r\n        value: 'Id: ' + collection.getId()\r\n      },\r\n      {\r\n        type: 'value',\r\n        value: collection.items\r\n      }\r\n    ];\r\n  },\r\n  inputs: {\r\n    items: {\r\n      type: 'array',\r\n      displayName: 'Items',\r\n      group: 'General',\r\n      set(value) {\r\n        this.bindCollection(value);\r\n        if (this.isInputConnected('filter') === false) this.scheduleFilter();\r\n      }\r\n    },\r\n    enabled: {\r\n      type: 'boolean',\r\n      group: 'General',\r\n      displayName: 'Enabled',\r\n      default: true,\r\n      set: function (value) {\r\n        this._internal.enabled = value;\r\n        if (this.isInputConnected('filter') === false) this.scheduleFilter();\r\n      }\r\n    },\r\n    filter: {\r\n      type: 'signal',\r\n      group: 'Actions',\r\n      displayName: 'Filter',\r\n      valueChangedToTrue: function () {\r\n        this.scheduleFilter();\r\n      }\r\n    }\r\n  },\r\n  outputs: {\r\n    items: {\r\n      type: 'array',\r\n      displayName: 'Items',\r\n      group: 'General',\r\n      getter: function () {\r\n        return this._internal.filteredCollection;\r\n      }\r\n    },\r\n    firstItemId: {\r\n      type: 'string',\r\n      displayName: 'First Record Id',\r\n      group: 'General',\r\n      getter: function () {\r\n        if (this._internal.filteredCollection !== undefined) {\r\n          const firstItem = this._internal.filteredCollection.get(0);\r\n          if (firstItem !== undefined) return firstItem.getId();\r\n        }\r\n      }\r\n    },\r\n    /*   firstItem:{\r\n            type: 'object',\r\n            displayName: 'First Item',\r\n            group: 'General',\r\n            getter: function () {\r\n                if(this._internal.filteredCollection !== undefined) {\r\n                    return this._internal.filteredCollection.get(0);\r\n                }\r\n            }            \r\n        },  */\r\n    count: {\r\n      type: 'number',\r\n      displayName: 'Count',\r\n      group: 'General',\r\n      getter: function () {\r\n        return this._internal.filteredCollection ? this._internal.filteredCollection.size() : 0;\r\n      }\r\n    },\r\n    modified: {\r\n      group: 'Events',\r\n      type: 'signal',\r\n      displayName: 'Filtered'\r\n    }\r\n  },\r\n  prototypeExtensions: {\r\n    unbindCurrentCollection: function () {\r\n      var collection = this._internal.collection;\r\n      if (!collection) return;\r\n      collection.off('change', this._internal.collectionChangedCallback);\r\n      this._internal.collection = undefined;\r\n    },\r\n    bindCollection: function (collection) {\r\n      this.unbindCurrentCollection();\r\n      this._internal.collection = collection;\r\n      collection && collection.on('change', this._internal.collectionChangedCallback);\r\n    },\r\n    _onNodeDeleted: function () {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      this.unbindCurrentCollection();\r\n\r\n      CloudStore.instance.off('save', this._internal.cloudStoreEvents);\r\n    },\r\n    /* getFilter: function () {\r\n            const filterSettings = this._internal.filterSettings;\r\n\r\n            const options = ['case'] // List all supported options here\r\n\r\n            if (filterSettings['filterFilter']) {\r\n                const filters = filterSettings['filterFilter'].split(',');\r\n                var _filter = {};\r\n                filters.forEach(function (f) {\r\n                    var op = '$' + (filterSettings['filterFilterOp-' + f] || 'eq');\r\n                    _filter[f] = {};\r\n                    _filter[f][op] = filterSettings['filterFilterValue-' + f];\r\n\r\n                    options.forEach((o) => {\r\n                        var option = filterSettings['filterFilterOption-' + o + '-' + f];\r\n                        if(option) _filter[f]['$' + o] =  option\r\n                    })\r\n                })\r\n                return _filter;\r\n            }\r\n        },\r\n        getSort: function() {\r\n            const filterSettings = this._internal.filterSettings;\r\n\r\n            if (filterSettings['filterSort']) {\r\n                const sort = filterSettings['filterSort'].split(',');\r\n                var _sort = {};\r\n                sort.forEach(function (s) {\r\n                    _sort[s] = filterSettings['filterSort-'+s] === 'descending'?-1:1;\r\n                })\r\n                return _sort;\r\n            }\r\n        },*/\r\n    getLimit: function () {\r\n      const filterSettings = this._internal.filterSettings;\r\n\r\n      if (!filterSettings['filterEnableLimit']) return;\r\n      else return filterSettings['filterLimit'] || 10;\r\n    },\r\n    getSkip: function () {\r\n      const filterSettings = this._internal.filterSettings;\r\n\r\n      if (!filterSettings['filterEnableLimit']) return;\r\n      else return filterSettings['filterSkip'] || 0;\r\n    },\r\n    scheduleFilter: function () {\r\n      if (this.collectionChangedScheduled) return;\r\n      this.collectionChangedScheduled = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        this.collectionChangedScheduled = false;\r\n        if (!this._internal.collection) return;\r\n\r\n        // Apply filter and write to output collection\r\n        var filtered = [].concat(this._internal.collection.items);\r\n\r\n        if (this._internal.enabled) {\r\n          const _filter = this._internal.visualFilter;\r\n          if (_filter !== undefined) {\r\n            var filter = QueryUtils.convertVisualFilter(_filter, {\r\n              queryParameters: this._internal.filterParameters,\r\n              collectionName: this._internal.collectionName\r\n            });\r\n            if (filter) filtered = filtered.filter((m) => QueryUtils.matchesQuery(m, filter));\r\n          }\r\n\r\n          var _sort = this._internal.visualSorting;\r\n          if (_sort !== undefined && _sort.length > 0) {\r\n            var sort = QueryUtils.convertVisualSorting(_sort);\r\n          }\r\n          if (sort) filtered.sort(QueryUtils.compareObjects.bind(this, sort));\r\n\r\n          var skip = this.getSkip();\r\n          if (skip) filtered = filtered.slice(skip, filtered.length);\r\n\r\n          var limit = this.getLimit();\r\n          if (limit) filtered = filtered.slice(0, limit);\r\n        }\r\n\r\n        this._internal.filteredCollection = Collection.create(filtered);\r\n\r\n        this.sendSignalOnOutput('modified');\r\n        this.flagOutputDirty('firstItemId');\r\n        this.flagOutputDirty('items');\r\n        this.flagOutputDirty('count');\r\n      });\r\n    },\r\n    setCollectionName: function (name) {\r\n      this._internal.collectionName = name;\r\n    },\r\n    setVisualFilter: function (value) {\r\n      this._internal.visualFilter = value;\r\n\r\n      if (this.isInputConnected('filter') === false) this.scheduleFilter();\r\n    },\r\n    setVisualSorting: function (value) {\r\n      this._internal.visualSorting = value;\r\n\r\n      if (this.isInputConnected('filter') === false) this.scheduleFilter();\r\n    },\r\n    setFilterParameter: function (name, value) {\r\n      this._internal.filterParameters[name] = value;\r\n\r\n      if (this.isInputConnected('filter') === false) this.scheduleFilter();\r\n    },\r\n    registerInputIfNeeded: function (name) {\r\n      var _this = this;\r\n\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === 'collectionName')\r\n        return this.registerInput(name, {\r\n          set: this.setCollectionName.bind(this)\r\n        });\r\n\r\n      if (name === 'visualFilter')\r\n        return this.registerInput(name, {\r\n          set: this.setVisualFilter.bind(this)\r\n        });\r\n\r\n      if (name === 'visualSorting')\r\n        return this.registerInput(name, {\r\n          set: this.setVisualSorting.bind(this)\r\n        });\r\n\r\n      if (name.startsWith('fp-'))\r\n        return this.registerInput(name, {\r\n          set: this.setFilterParameter.bind(this, name.substring('fp-'.length))\r\n        });\r\n\r\n      this.registerInput(name, {\r\n        set: userInputSetter.bind(this, name)\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\nfunction userInputSetter(name, value) {\r\n  /* jshint validthis:true */\r\n  this._internal.filterSettings[name] = value;\r\n  if (this.isInputConnected('filter') === false) this.scheduleFilter();\r\n}\r\n\r\nfunction updatePorts(nodeId, parameters, editorConnection, dbCollections) {\r\n  var ports = [];\r\n\r\n  ports.push({\r\n    name: 'collectionName',\r\n    type: {\r\n      name: 'enum',\r\n      enums:\r\n        dbCollections !== undefined\r\n          ? dbCollections.map((c) => {\r\n              return { value: c.name, label: c.name };\r\n            })\r\n          : [],\r\n      allowEditOnly: true\r\n    },\r\n    displayName: 'Class',\r\n    plug: 'input',\r\n    group: 'General'\r\n  });\r\n\r\n  ports.push({\r\n    type: 'boolean',\r\n    plug: 'input',\r\n    group: 'Limit',\r\n    name: 'filterEnableLimit',\r\n    displayName: 'Use limit'\r\n  });\r\n\r\n  if (parameters['filterEnableLimit']) {\r\n    ports.push({\r\n      type: 'number',\r\n      default: 10,\r\n      plug: 'input',\r\n      group: 'Limit',\r\n      name: 'filterLimit',\r\n      displayName: 'Limit'\r\n    });\r\n\r\n    ports.push({\r\n      type: 'number',\r\n      default: 0,\r\n      plug: 'input',\r\n      group: 'Limit',\r\n      name: 'filterSkip',\r\n      displayName: 'Skip'\r\n    });\r\n  }\r\n\r\n  if (parameters.collectionName !== undefined) {\r\n    var c = dbCollections.find((c) => c.name === parameters.collectionName);\r\n    if (c && c.schema && c.schema.properties) {\r\n      const schema = JSON.parse(JSON.stringify(c.schema));\r\n\r\n      const _supportedTypes = {\r\n        Boolean: true,\r\n        String: true,\r\n        Date: true,\r\n        Number: true,\r\n        Pointer: true\r\n      };\r\n      for (var key in schema.properties) {\r\n        if (!_supportedTypes[schema.properties[key].type]) delete schema.properties[key];\r\n      }\r\n\r\n      ports.push({\r\n        name: 'visualFilter',\r\n        plug: 'input',\r\n        type: { name: 'query-filter', schema: schema, allowEditOnly: true },\r\n        displayName: 'Filter',\r\n        group: 'Filter'\r\n      });\r\n\r\n      ports.push({\r\n        name: 'visualSorting',\r\n        plug: 'input',\r\n        type: { name: 'query-sorting', schema: schema, allowEditOnly: true },\r\n        displayName: 'Sorting',\r\n        group: 'Sorting'\r\n      });\r\n    }\r\n\r\n    if (parameters.visualFilter !== undefined) {\r\n      // Find all input ports\r\n      const uniqueInputs = {};\r\n      function _collectInputs(query) {\r\n        if (query === undefined) return;\r\n        if (query.rules !== undefined) query.rules.forEach((r) => _collectInputs(r));\r\n        else if (query.input !== undefined) uniqueInputs[query.input] = true;\r\n      }\r\n\r\n      _collectInputs(parameters.visualFilter);\r\n      Object.keys(uniqueInputs).forEach((input) => {\r\n        ports.push({\r\n          name: 'fp-' + input,\r\n          plug: 'input',\r\n          type: '*',\r\n          displayName: input,\r\n          group: 'Filter Parameters'\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  /*  ports.push({\r\n        type: { name: 'stringlist', allowEditOnly: true },\r\n        plug: 'input',\r\n        group: 'Filter',\r\n        name: 'filterFilter',\r\n        displayName: 'Filter',\r\n    })\r\n\r\n    ports.push({\r\n        type: { name: 'stringlist', allowEditOnly: true },\r\n        plug: 'input',\r\n        group: 'Sort',\r\n        name: 'filterSort',\r\n        displayName: 'Sort',\r\n    })    \r\n\r\n    const filterOps = {\r\n        \"string\": [{ value: 'eq', label: 'Equals' }, { value: 'neq', label: 'Not Equals' },{value: 'regex', label: 'Matches RegEx'}],\r\n        \"boolean\": [{ value: 'eq', label: 'Equals' }, { value: 'neq', label: 'Not Equals' }],\r\n        \"number\": [{ value: 'eq', label: 'Equals' }, { value: 'neq', label: 'Not Equals' }, { value: 'lt', label: 'Less than' }, { value: 'gt', label: 'Greater than' },\r\n        { value: 'gte', label: 'Greater than or equal' }, { value: 'lte', label: 'Less than or equal' }]\r\n    }\r\n\r\n    if (parameters['filterFilter']) {\r\n        var filters = parameters['filterFilter'].split(',');\r\n        filters.forEach((f) => {\r\n            // Type\r\n            ports.push({\r\n                type: { name: 'enum', enums: [{ value: 'string', label: 'String' }, { value: 'number', label: 'Number' }, { value: 'boolean', label: 'Boolean' }] },\r\n                default: 'string',\r\n                plug: 'input',\r\n                group: f + ' filter',\r\n                displayName: 'Type',\r\n                editorName: f + ' filter | Type',\r\n                name: 'filterFilterType-' + f\r\n            })\r\n\r\n            var type = parameters['filterFilterType-' + f];\r\n\r\n            // String filter type\r\n            ports.push({\r\n                type: { name: 'enum', enums: filterOps[type || 'string'] },\r\n                default: 'eq',\r\n                plug: 'input',\r\n                group: f + ' filter',\r\n                displayName: 'Op',\r\n                editorName: f + ' filter| Op',\r\n                name: 'filterFilterOp-' + f\r\n            })\r\n\r\n            // Case sensitivite option\r\n            if(parameters['filterFilterOp-' + f] === 'regex') {\r\n                ports.push({\r\n                    type: 'boolean',\r\n                    default: false,\r\n                    plug: 'input',\r\n                    group: f + ' filter',\r\n                    displayName: 'Case sensitive',\r\n                    editorName: f + ' filter| Case',\r\n                    name: 'filterFilterOption-case-' + f\r\n                })\r\n            }\r\n\r\n            ports.push({\r\n                type: type || 'string',\r\n                plug: 'input',\r\n                group: f + ' filter',\r\n                displayName: 'Value',\r\n                editorName: f + ' Filter Value',\r\n                name: 'filterFilterValue-' + f\r\n            })\r\n\r\n        })\r\n    }\r\n\r\n    if (parameters['filterSort']) {\r\n        var filters = parameters['filterSort'].split(',');\r\n        filters.forEach((f) => {\r\n            ports.push({\r\n                type: { name: 'enum', enums: [{ value: 'ascending', label: 'Ascending' }, { value: 'descending', label: 'Descending' }] },\r\n                default: 'ascending',\r\n                plug: 'input',\r\n                group: f + ' sort',\r\n                displayName: 'Sort',\r\n                editorName: f + ' sorting',\r\n                name: 'filterSort-' + f\r\n            })\r\n        })\r\n    }*/\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nmodule.exports = {\r\n  node: FilterDBModelsNode,\r\n  setup: function (context, graphModel) {\r\n    if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n      return;\r\n    }\r\n\r\n    graphModel.on('nodeAdded.FilterDBModels', function (node) {\r\n      updatePorts(node.id, node.parameters, context.editorConnection, graphModel.getMetaData('dbCollections'));\r\n\r\n      node.on('parameterUpdated', function (event) {\r\n        updatePorts(node.id, node.parameters, context.editorConnection, graphModel.getMetaData('dbCollections'));\r\n      });\r\n\r\n      graphModel.on('metadataChanged.dbCollections', function (data) {\r\n        CloudStore.invalidateCollections();\r\n        updatePorts(node.id, node.parameters, context.editorConnection, data);\r\n      });\r\n\r\n      graphModel.on('metadataChanged.systemCollections', function (data) {\r\n        CloudStore.invalidateCollections();\r\n        updatePorts(node.id, node.parameters, context.editorConnection, data);\r\n      });\r\n    });\r\n  }\r\n};\r\n","'use strict';\r\n\r\nconst Collection = require('../../../collection');\r\nconst Model = require('../../../model');\r\n\r\nfunction _addBaseInfo(def) {\r\n  Object.assign(def.node, {\r\n    category: 'Data',\r\n    color: 'data'\r\n  });\r\n}\r\n\r\nfunction _addModelId(def, opts) {\r\n  const _includeInputs = opts === undefined || opts.includeInputs;\r\n  const _includeOutputs = opts === undefined || opts.includeOutputs;\r\n\r\n  Object.assign(def.node, {\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {}\r\n  });\r\n\r\n  if (_includeInputs) {\r\n    Object.assign(def.node, {\r\n      usePortAsLabel: 'modelId'\r\n    });\r\n\r\n    def.node.dynamicports = (def.node.dynamicports || []).concat([\r\n      {\r\n        name: 'conditionalports/extended',\r\n        condition: 'idSource = explicit OR idSource NOT SET',\r\n        inputs: ['modelId']\r\n      }\r\n    ]);\r\n\r\n    // Inputs\r\n    Object.assign(def.node.inputs, {\r\n      idSource: {\r\n        type: {\r\n          name: 'enum',\r\n          enums: [\r\n            { label: 'Specify explicitly', value: 'explicit' },\r\n            { label: 'From repeater', value: 'foreach' }\r\n          ],\r\n          allowEditOnly: true\r\n        },\r\n        default: 'explicit',\r\n        displayName: 'Id Source',\r\n        group: 'General',\r\n        set: function (value) {\r\n          if (value === 'foreach') {\r\n            this.scheduleAfterInputsHaveUpdated(() => {\r\n              // Find closest nodescope that have a _forEachModel\r\n              var component = this.nodeScope.componentOwner;\r\n              while (component !== undefined && component._forEachModel === undefined && component.parentNodeScope) {\r\n                component = component.parentNodeScope.componentOwner;\r\n              }\r\n              this.setModel(component !== undefined ? component._forEachModel : undefined);\r\n            });\r\n          }\r\n        }\r\n      },\r\n      modelId: {\r\n        type: {\r\n          name: 'string',\r\n          identifierOf: 'ModelName',\r\n          identifierDisplayName: 'Object Ids'\r\n        },\r\n        displayName: 'Id',\r\n        group: 'General',\r\n        set: function (value) {\r\n          if (value instanceof Model) value = value.getId(); // Can be passed as model as well\r\n          this._internal.modelId = value; // Wait to fetch data\r\n          this.setModelID(value);\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // Outputs\r\n  if (_includeOutputs) {\r\n    Object.assign(def.node.outputs, {\r\n      id: {\r\n        type: 'string',\r\n        displayName: 'Id',\r\n        group: 'General',\r\n        getter: function () {\r\n          return this._internal.model ? this._internal.model.getId() : this._internal.modelId;\r\n        }\r\n      }\r\n    });\r\n  }\r\n\r\n  // Methods\r\n  Object.assign(def.node.methods, {\r\n    setModelID: function (id) {\r\n      var model = (this.nodeScope.modelScope || Model).get(id);\r\n      this.setModel(model);\r\n    },\r\n    setModel: function (model) {\r\n      this._internal.model = model;\r\n      this.flagOutputDirty('id');\r\n    }\r\n  });\r\n\r\n  //Inspect model\r\n  if (!def.node.getInspectInfo) {\r\n    def.node.getInspectInfo = function () {\r\n      const model = this._internal.model;\r\n      if (!model) return '[No Object]';\r\n\r\n      return [\r\n        { type: 'text', value: 'Id: ' + model.getId() },\r\n        { type: 'value', value: model.data }\r\n      ];\r\n    };\r\n  }\r\n}\r\n\r\nfunction _addInputProperties(def) {\r\n  var _def = { node: Object.assign({}, def.node), setup: def.setup };\r\n  var _methods = Object.assign({}, def.node.methods);\r\n\r\n  Object.assign(def.node, {\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {}\r\n  });\r\n\r\n  Object.assign(def, {\r\n    setup: function (context, graphModel) {\r\n      if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n        return;\r\n      }\r\n\r\n      graphModel.on('nodeAdded.' + def.node.name, function (node) {\r\n        function _updatePorts() {\r\n          var ports = [];\r\n\r\n          const _types = [\r\n            { label: 'String', value: 'string' },\r\n            { label: 'Boolean', value: 'boolean' },\r\n            { label: 'Number', value: 'number' },\r\n            { label: 'Date', value: 'date' },\r\n            { label: 'Array', value: 'array' },\r\n            { label: 'Object', value: 'object' },\r\n            { label: 'Any', value: '*' }\r\n          ];\r\n\r\n          // Add value outputs\r\n          var properties = node.parameters.properties;\r\n          if (properties) {\r\n            properties = properties ? properties.split(',') : undefined;\r\n            for (var i in properties) {\r\n              var p = properties[i];\r\n\r\n              // Property input\r\n              ports.push({\r\n                type: {\r\n                  name: node.parameters['type-' + p] === undefined ? '*' : node.parameters['type-' + p]\r\n                },\r\n                plug: 'input',\r\n                group: 'Property Values',\r\n                displayName: p,\r\n                //  editorName:p,\r\n                name: 'prop-' + p\r\n              });\r\n\r\n              // Property type\r\n              ports.push({\r\n                type: {\r\n                  name: 'enum',\r\n                  enums: _types,\r\n                  allowEditOnly: true\r\n                },\r\n                plug: 'input',\r\n                group: 'Property Types',\r\n                displayName: p,\r\n                default: '*',\r\n                name: 'type-' + p\r\n              });\r\n            }\r\n          }\r\n\r\n          context.editorConnection.sendDynamicPorts(node.id, ports, {\r\n            detectRenamed: {\r\n              plug: 'input'\r\n            }\r\n          });\r\n        }\r\n\r\n        _updatePorts();\r\n\r\n        node.on('parameterUpdated', function (event) {\r\n          _updatePorts();\r\n        });\r\n      });\r\n\r\n      _def.setup && _def.setup(context, graphModel);\r\n    }\r\n  });\r\n\r\n  // Initilize\r\n  Object.assign(def.node, {\r\n    initialize: function () {\r\n      var internal = this._internal;\r\n      internal.inputValues = {};\r\n      internal.inputTypes = {};\r\n\r\n      _def.node.initialize && _def.node.initialize.call(this);\r\n    }\r\n  });\r\n\r\n  // Outputs\r\n  Object.assign(def.node.outputs, {});\r\n\r\n  // Inputs\r\n  Object.assign(def.node.inputs, {\r\n    properties: {\r\n      type: { name: 'stringlist', allowEditOnly: true },\r\n      displayName: 'Properties',\r\n      group: 'Properties to set',\r\n      set: function (value) {}\r\n    }\r\n  });\r\n\r\n  // Methods\r\n  Object.assign(def.node.methods, {\r\n    _pushInputValues: function (model) {\r\n      var internal = this._internal;\r\n\r\n      const _defaultValueForType = {\r\n        boolean: false,\r\n        string: '',\r\n        number: 0,\r\n        date: new Date()\r\n      };\r\n\r\n      const _allKeys = {};\r\n      for (const key in internal.inputTypes) _allKeys[key] = true;\r\n      for (const key in internal.inputValues) _allKeys[key] = true;\r\n\r\n      const properties = this.model.parameters.properties || '';\r\n\r\n      const validProperties = properties.split(',');\r\n\r\n      const keysToSet = Object.keys(_allKeys).filter((key) => validProperties.indexOf(key) !== -1);\r\n\r\n      for (const i of keysToSet) {\r\n        var value = internal.inputValues[i];\r\n\r\n        if (value !== undefined) {\r\n          //Parse array types with string as javascript\r\n          if (internal.inputTypes[i] !== undefined && internal.inputTypes[i] === 'array' && typeof value === 'string') {\r\n            this.context.editorConnection.clearWarning(\r\n              this.nodeScope.componentOwner.name,\r\n              this.id,\r\n              'invalid-array-' + i\r\n            );\r\n\r\n            try {\r\n              value = eval(value); //this might be static data in the form of javascript\r\n            } catch (e) {\r\n              if (value.indexOf('[') !== -1 || value.indexOf('{') !== -1) {\r\n                this.context.editorConnection.sendWarning(\r\n                  this.nodeScope.componentOwner.name,\r\n                  this.id,\r\n                  'invalid-array-' + i,\r\n                  {\r\n                    showGlobally: true,\r\n                    message: 'Invalid array<br>' + e.toString()\r\n                  }\r\n                );\r\n                value = [];\r\n              } else {\r\n                //backwards compability with how this node used to work\r\n                value = Collection.get(value);\r\n              }\r\n            }\r\n          }\r\n          // Resolve object  from IDs\r\n          if (\r\n            internal.inputTypes[i] !== undefined &&\r\n            internal.inputTypes[i] === 'object' &&\r\n            typeof value === 'string'\r\n          ) {\r\n            value = (this.nodeScope.modelScope || Model).get(value);\r\n          }\r\n\r\n          model.set(i, value, { resolve: true });\r\n        } else {\r\n          model.set(i, _defaultValueForType[internal.inputTypes[i]], {\r\n            resolve: true\r\n          });\r\n        }\r\n      }\r\n    },\r\n    scheduleStore: function () {\r\n      if (this.hasScheduledStore) return;\r\n      this.hasScheduledStore = true;\r\n\r\n      var internal = this._internal;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        this.hasScheduledStore = false;\r\n        if (!internal.model) return;\r\n\r\n        this._pushInputValues(internal.model);\r\n\r\n        this.sendSignalOnOutput('stored');\r\n      });\r\n    },\r\n    registerInputIfNeeded: function (name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('prop-'))\r\n        this.registerInput(name, {\r\n          set: this._setInputValue.bind(this, name.substring('prop-'.length))\r\n        });\r\n\r\n      if (name.startsWith('type-'))\r\n        this.registerInput(name, {\r\n          set: this._setInputType.bind(this, name.substring('type-'.length))\r\n        });\r\n\r\n      _methods && _methods.registerInputIfNeeded && _def.node.methods.registerInputIfNeeded.call(this, name);\r\n    },\r\n    _setInputValue: function (name, value) {\r\n      this._internal.inputValues[name] = value;\r\n    },\r\n    _setInputType: function (name, value) {\r\n      this._internal.inputTypes[name] = value;\r\n    }\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  addInputProperties: _addInputProperties,\r\n  addModelId: _addModelId,\r\n  addBaseInfo: _addBaseInfo\r\n};\r\n","'use strict';\r\n\r\nconst { Node } = require('../../../../noodl-runtime');\r\n\r\nvar Model = require('../../../model');\r\n\r\nvar ModelNodeDefinition = {\r\n  name: 'Model2',\r\n  docs: 'https://docs.noodl.net/nodes/data/object/object-node',\r\n  displayNodeName: 'Object',\r\n  shortDesc:\r\n    'Stores any amount of properties and can be used standalone or together with Collections and For Each nodes.',\r\n  category: 'Data',\r\n  usePortAsLabel: 'modelId',\r\n  color: 'data',\r\n  dynamicports: [\r\n    {\r\n      name: 'conditionalports/extended',\r\n      condition: 'idSource = explicit OR idSource NOT SET',\r\n      inputs: ['modelId']\r\n    }\r\n  ],\r\n  initialize: function () {\r\n    var internal = this._internal;\r\n    internal.inputValues = {};\r\n    internal.dirtyValues = {};\r\n\r\n    var _this = this;\r\n    this._internal.onModelChangedCallback = function (args) {\r\n      if (_this.isInputConnected('fetch') === true) return;\r\n\r\n      if (_this.hasOutput('prop-' + args.name)) _this.flagOutputDirty('prop-' + args.name);\r\n\r\n      if (_this.hasOutput('changed-' + args.name)) _this.sendSignalOnOutput('changed-' + args.name);\r\n\r\n      _this.sendSignalOnOutput('changed');\r\n    };\r\n  },\r\n  getInspectInfo() {\r\n    const model = this._internal.model;\r\n    if (!model) return '[No Object]';\r\n\r\n    return [\r\n      { type: 'text', value: 'Id: ' + model.getId() },\r\n      { type: 'value', value: model.data }\r\n    ];\r\n  },\r\n  outputs: {\r\n    id: {\r\n      type: 'string',\r\n      displayName: 'Id',\r\n      group: 'General',\r\n      getter: function () {\r\n        return this._internal.model ? this._internal.model.getId() : this._internal.modelId;\r\n      }\r\n    },\r\n    changed: {\r\n      type: 'signal',\r\n      displayName: 'Changed',\r\n      group: 'Events'\r\n    },\r\n    fetched: {\r\n      type: 'signal',\r\n      displayName: 'Fetched',\r\n      group: 'Events'\r\n    }\r\n  },\r\n  inputs: {\r\n    idSource: {\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: 'Specify explicitly', value: 'explicit' },\r\n          { label: 'From repeater', value: 'foreach' }\r\n        ],\r\n        allowEditOnly: true\r\n      },\r\n      default: 'explicit',\r\n      displayName: 'Get Id from',\r\n      group: 'General',\r\n      set: function (value) {\r\n        if (value === 'foreach') {\r\n          this.scheduleAfterInputsHaveUpdated(() => {\r\n            // Find closest nodescope that have a _forEachModel\r\n            var component = this.nodeScope.componentOwner;\r\n            while (component !== undefined && component._forEachModel === undefined && component.parentNodeScope) {\r\n              component = component.parentNodeScope.componentOwner;\r\n            }\r\n            this.setModel(component !== undefined ? component._forEachModel : undefined);\r\n          });\r\n        }\r\n      }\r\n    },\r\n    modelId: {\r\n      type: {\r\n        name: 'string',\r\n        identifierOf: 'ModelName',\r\n        identifierDisplayName: 'Object Ids'\r\n      },\r\n      displayName: 'Id',\r\n      group: 'General',\r\n      set: function (value) {\r\n        if (value instanceof Model) value = value.getId();\r\n        // Can be passed as model as well\r\n        else if (typeof value === 'object') value = Model.create(value).getId(); // If this is an js object, dereference it\r\n\r\n        this._internal.modelId = value; // Wait to fetch data\r\n        if (this.isInputConnected('fetch') === false) this.setModelID(value);\r\n        else {\r\n          this.flagOutputDirty('id');\r\n        }\r\n      }\r\n    },\r\n    properties: {\r\n      type: { name: 'stringlist', allowEditOnly: true },\r\n      displayName: 'Properties',\r\n      group: 'Properties',\r\n      set: function (value) {}\r\n    },\r\n    fetch: {\r\n      displayName: 'Fetch',\r\n      group: 'Actions',\r\n      valueChangedToTrue: function () {\r\n        this.scheduleSetModel();\r\n      }\r\n    }\r\n  },\r\n  prototypeExtensions: {\r\n    scheduleStore: function () {\r\n      if (this.hasScheduledStore) return;\r\n      this.hasScheduledStore = true;\r\n\r\n      var internal = this._internal;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        this.hasScheduledStore = false;\r\n        if (!internal.model) return;\r\n\r\n        for (var i in internal.dirtyValues) {\r\n          internal.model.set(i, internal.inputValues[i], { resolve: true });\r\n        }\r\n        internal.dirtyValues = {}; // Reset dirty values\r\n      });\r\n    },\r\n    scheduleSetModel: function () {\r\n      if (this.hasScheduledSetModel) return;\r\n      this.hasScheduledSetModel = true;\r\n\r\n      var internal = this._internal;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        this.hasScheduledSetModel = false;\r\n        this.setModelID(this._internal.modelId);\r\n      });\r\n    },\r\n    setModelID: function (id) {\r\n      var model = (this.nodeScope.modelScope || Model).get(id);\r\n      this.setModel(model);\r\n      this.sendSignalOnOutput('fetched');\r\n    },\r\n    setModel: function (model) {\r\n      if (this._internal.model)\r\n        // Remove old listener if existing\r\n        this._internal.model.off('change', this._internal.onModelChangedCallback);\r\n\r\n      this._internal.model = model;\r\n      this.flagOutputDirty('id');\r\n\r\n      // In set idSource, we are calling setModel with undefined\r\n      if (model) {\r\n        model.on('change', this._internal.onModelChangedCallback);\r\n\r\n        // We have a new model, mark all outputs as dirty\r\n        for (var key in model.data) {\r\n          if (this.hasOutput('prop-' + key)) this.flagOutputDirty('prop-' + key);\r\n        }\r\n      }\r\n    },\r\n    _onNodeDeleted: function () {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      if (this._internal.model) this._internal.model.off('change', this._internal.onModelChangedCallback);\r\n    },\r\n    registerOutputIfNeeded: function (name) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('prop-'))\r\n        this.registerOutput(name, {\r\n          getter: userOutputGetter.bind(this, name.substring('prop-'.length))\r\n        });\r\n    },\r\n    registerInputIfNeeded: function (name) {\r\n      var _this = this;\r\n\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('prop-'))\r\n        this.registerInput(name, {\r\n          set: userInputSetter.bind(this, name.substring('prop-'.length))\r\n        });\r\n    }\r\n  }\r\n};\r\n\r\nfunction userOutputGetter(name) {\r\n  /* jshint validthis:true */\r\n  return this._internal.model ? this._internal.model.get(name, { resolve: true }) : undefined;\r\n}\r\n\r\nfunction userInputSetter(name, value) {\r\n  /* jshint validthis:true */\r\n  this._internal.inputValues[name] = value;\r\n\r\n  // Store on change if no connection to store or new\r\n  const model = this._internal.model;\r\n  const valueChanged = model ? model.get(name) !== value : true;\r\n  if (valueChanged) {\r\n    this._internal.dirtyValues[name] = true;\r\n    this.scheduleStore();\r\n  }\r\n}\r\n\r\nfunction updatePorts(nodeId, parameters, editorConnection) {\r\n  var ports = [];\r\n\r\n  // Add value outputs\r\n  var properties = parameters.properties;\r\n  if (properties) {\r\n    properties = properties ? properties.split(',') : undefined;\r\n    for (var i in properties) {\r\n      var p = properties[i];\r\n\r\n      ports.push({\r\n        type: {\r\n          name: '*',\r\n          allowConnectionsOnly: true\r\n        },\r\n        plug: 'input/output',\r\n        group: 'Properties',\r\n        name: 'prop-' + p,\r\n        displayName: p\r\n      });\r\n\r\n      ports.push({\r\n        type: 'signal',\r\n        plug: 'output',\r\n        group: 'Changed Events',\r\n        displayName: p + ' Changed',\r\n        name: 'changed-' + p\r\n      });\r\n    }\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports, {\r\n    detectRenamed: {\r\n      plug: 'input/output'\r\n    }\r\n  });\r\n}\r\n\r\nmodule.exports = {\r\n  node: ModelNodeDefinition,\r\n  setup: function (context, graphModel) {\r\n    if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n      return;\r\n    }\r\n\r\n    graphModel.on('nodeAdded.Model2', function (node) {\r\n      updatePorts(node.id, node.parameters, context.editorConnection);\r\n\r\n      node.on('parameterUpdated', function (event) {\r\n        updatePorts(node.id, node.parameters, context.editorConnection);\r\n      });\r\n    });\r\n  }\r\n};\r\n","'use strict';\r\n\r\nvar Model = require('../../../model');\r\nvar DbModelCRUDBase = require('./dbmodelcrudbase');\r\nconst CloudStore = require('../../../api/cloudstore');\r\n\r\nvar NewDbModelPropertiedNodeDefinition = {\r\n  node: {\r\n    name: 'NewDbModelProperties',\r\n    docs: 'https://docs.noodl.net/nodes/data/cloud-data/create-new-record',\r\n    displayName: 'Create New Record',\r\n    usePortAsLabel: 'collectionName',\r\n    inputs: {\r\n      store: {\r\n        displayName: 'Do',\r\n        group: 'Actions',\r\n        valueChangedToTrue: function () {\r\n          this.storageInsert();\r\n        }\r\n      },\r\n      sourceObjectId: {\r\n        type: { name: 'string', allowConnectionsOnly: true },\r\n        displayName: 'Source Object Id',\r\n        group: 'General',\r\n        set: function (value) {\r\n          if (value instanceof Model) value = value.getId(); // Can be passed as model as well\r\n          this._internal.sourceObjectId = value; // Wait to fetch data\r\n        }\r\n      }\r\n    },\r\n    outputs: {\r\n      created: {\r\n        type: 'signal',\r\n        displayName: 'Success',\r\n        group: 'Events'\r\n      }\r\n    },\r\n    methods: {\r\n      storageInsert: function () {\r\n        const internal = this._internal;\r\n\r\n        if (!this.checkWarningsBeforeCloudOp()) return;\r\n\r\n        this.scheduleOnce('StorageInsert', () => {\r\n          const initValues = Object.assign(\r\n            {},\r\n            internal.sourceObjectId ? (this.nodeScope.modelScope || Model).get(internal.sourceObjectId).data : {},\r\n            internal.inputValues\r\n          );\r\n\r\n          const cloudstore = CloudStore.forScope(this.nodeScope.modelScope);\r\n          cloudstore.create({\r\n            collection: internal.collectionId,\r\n            data: initValues,\r\n            acl: this._getACL(),\r\n            success: (data) => {\r\n              // Successfully created\r\n              const m = cloudstore._fromJSON(data, internal.collectionId);\r\n              this.setModel(m);\r\n              this.sendSignalOnOutput('created');\r\n            },\r\n            error: (err) => {\r\n              this.setError(err || 'Failed to insert.');\r\n            }\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nDbModelCRUDBase.addBaseInfo(NewDbModelPropertiedNodeDefinition);\r\nDbModelCRUDBase.addModelId(NewDbModelPropertiedNodeDefinition, {\r\n  includeOutputs: true\r\n});\r\nDbModelCRUDBase.addInputProperties(NewDbModelPropertiedNodeDefinition);\r\nDbModelCRUDBase.addAccessControl(NewDbModelPropertiedNodeDefinition);\r\n\r\nmodule.exports = NewDbModelPropertiedNodeDefinition;\r\n","'use strict';\r\n\r\nvar Model = require('../../../model');\r\nvar ModelCRUDBase = require('./modelcrudbase');\r\n\r\nvar NewModelNodeDefinition = {\r\n  node: {\r\n    name: 'NewModel',\r\n    docs: 'https://docs.noodl.net/nodes/data/object/create-new-object',\r\n    displayNodeName: 'Create New Object',\r\n    inputs: {\r\n      new: {\r\n        displayName: 'Do',\r\n        group: 'Actions',\r\n        valueChangedToTrue: function () {\r\n          this.scheduleNew();\r\n        }\r\n      }\r\n    },\r\n    outputs: {\r\n      created: {\r\n        type: 'signal',\r\n        displayName: 'Done',\r\n        group: 'Events'\r\n      }\r\n    },\r\n    methods: {\r\n      scheduleNew: function () {\r\n        if (this.hasScheduledNew) return;\r\n        this.hasScheduledNew = true;\r\n\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          this.hasScheduledNew = false;\r\n          const newModel = (this.nodeScope.modelScope || Model).get();\r\n\r\n          this._pushInputValues(newModel);\r\n\r\n          this.setModel(newModel);\r\n\r\n          this.sendSignalOnOutput('created');\r\n        });\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nModelCRUDBase.addBaseInfo(NewModelNodeDefinition);\r\nModelCRUDBase.addModelId(NewModelNodeDefinition, { includeOutputs: true });\r\nModelCRUDBase.addInputProperties(NewModelNodeDefinition);\r\n\r\nmodule.exports = NewModelNodeDefinition;\r\n","var defaultRequestScript =\r\n  '' +\r\n  '//Add custom code to setup the request object before the request\\n' +\r\n  '//is made.\\n' +\r\n  '//\\n' +\r\n  '//*Request.resource     contains the resource path of the request.\\n' +\r\n  '//*Request.method       contains the method, GET, POST, PUT or DELETE.\\n' +\r\n  '//*Request.headers      is a map where you can add additional headers.\\n' +\r\n  '//*Request.parameters   is a map the parameters that will be appended\\n' +\r\n  '//                      to the url.\\n' +\r\n  '//*Request.content      contains the content of the request as a javascript\\n' +\r\n  '//                      object.\\n' +\r\n  '//\\n';\r\n('//*Inputs and *Outputs contain the inputs and outputs of the node.\\n');\r\n\r\nvar defaultResponseScript =\r\n  '' +\r\n  '// Add custom code to convert the response content to outputs\\n' +\r\n  '//\\n' +\r\n  '//*Response.status    The status code of the response\\n' +\r\n  '//*Response.content   The content of the response as a javascript\\n' +\r\n  '//                    object.\\n' +\r\n  '//*Response.request   The request object that resulted in the response.\\n' +\r\n  '//\\n' +\r\n  '//*Inputs and *Outputs contain the inputs and outputs of the node.\\n';\r\n\r\nvar RestNode = {\r\n  name: 'REST2',\r\n  displayNodeName: 'REST',\r\n  docs: 'https://docs.noodl.net/nodes/data/rest',\r\n  category: 'Data',\r\n  color: 'data',\r\n  searchTags: ['http', 'request', 'fetch'],\r\n  initialize: function () {\r\n    this._internal.inputValues = {};\r\n    this._internal.outputValues = {};\r\n\r\n    this._internal.outputValuesProxy = new Proxy(this._internal.outputValues, {\r\n      set: (obj, prop, value) => {\r\n        //only send outputs when they change.\r\n        //Some Noodl projects rely on this behavior, so changing it breaks backwards compability\r\n        if (value !== this._internal.outputValues[prop]) {\r\n          this.registerOutputIfNeeded('out-' + prop);\r\n\r\n          this._internal.outputValues[prop] = value;\r\n          this.flagOutputDirty('out-' + prop);\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n\r\n    this._internal.self = {};\r\n  },\r\n  getInspectInfo() {\r\n    return this._internal.inspectData\r\n      ? { type: 'value', value: this._internal.inspectData }\r\n      : { type: 'text', value: '[Not executed yet]' };\r\n  },\r\n  inputs: {\r\n    resource: {\r\n      type: 'string',\r\n      displayName: 'Resource',\r\n      group: 'Request',\r\n      default: '/',\r\n      set: function (value) {\r\n        this._internal.resource = value;\r\n      }\r\n    },\r\n    method: {\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: 'GET', value: 'GET' },\r\n          { label: 'POST', value: 'POST' },\r\n          { label: 'PUT', value: 'PUT' },\r\n          { label: 'PATCH', value: 'PATCH' },\r\n          { label: 'DELETE', value: 'DELETE' }\r\n        ]\r\n      },\r\n      displayName: 'Method',\r\n      group: 'Request',\r\n      default: 'GET',\r\n      set: function (value) {\r\n        this._internal.method = value;\r\n      }\r\n    },\r\n    /*  scriptInputs: {\r\n      type: { name: 'proplist', allowEditOnly: true },\r\n      group: 'Inputs',\r\n      set: function (value) {\r\n        //  this._internal.scriptInputs = value;   \r\n      }\r\n    },\r\n    scriptOutputs: {\r\n      type: { name: 'proplist', allowEditOnly: true },\r\n      group: 'Outputs',\r\n      set: function (value) {\r\n        //   this._internal.scriptOutputs = value;   \r\n      }\r\n    },*/\r\n    requestScript: {\r\n      type: {\r\n        name: 'string',\r\n        allowEditOnly: true,\r\n        codeeditor: 'javascript'\r\n      },\r\n      displayName: 'Request',\r\n      default: defaultRequestScript,\r\n      group: 'Scripts',\r\n      set: function (script) {\r\n        try {\r\n          this._internal.requestFunc = new Function('Inputs', 'Outputs', 'Request', script);\r\n        } catch (e) {\r\n          console.log(e);\r\n        }\r\n      }\r\n    },\r\n    responseScript: {\r\n      type: {\r\n        name: 'string',\r\n        allowEditOnly: true,\r\n        codeeditor: 'javascript'\r\n      },\r\n      displayName: 'Response',\r\n      default: defaultResponseScript,\r\n      group: 'Scripts',\r\n      set: function (script) {\r\n        try {\r\n          this._internal.responseFunc = new Function('Inputs', 'Outputs', 'Response', script);\r\n        } catch (e) {\r\n          console.log(e);\r\n        }\r\n      }\r\n    },\r\n    fetch: {\r\n      type: 'signal',\r\n      displayName: 'Fetch',\r\n      group: 'Actions',\r\n      valueChangedToTrue: function () {\r\n        this.scheduleFetch();\r\n      }\r\n    },\r\n    cancel: {\r\n      type: 'signal',\r\n      displayName: 'Cancel',\r\n      group: 'Actions',\r\n      valueChangedToTrue: function () {\r\n        this.cancelFetch();\r\n      }\r\n    }\r\n  },\r\n  outputs: {\r\n    failure: {\r\n      type: 'signal',\r\n      displayName: 'Failure',\r\n      group: 'Events'\r\n    },\r\n    success: {\r\n      type: 'signal',\r\n      displayName: 'Success',\r\n      group: 'Events'\r\n    },\r\n    canceled: {\r\n      type: 'signal',\r\n      displayName: 'Canceled',\r\n      group: 'Events'\r\n    }\r\n  },\r\n  prototypeExtensions: {\r\n    getScriptOutputValue: function (name) {\r\n      return this._internal.outputValues[name];\r\n    },\r\n    setScriptInputValue: function (name, value) {\r\n      return (this._internal.inputValues[name] = value);\r\n    },\r\n    registerOutputIfNeeded: function (name) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('out-'))\r\n        return this.registerOutput(name, {\r\n          getter: this.getScriptOutputValue.bind(this, name.substring('out-'.length))\r\n        });\r\n    },\r\n    registerInputIfNeeded: function (name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('in-'))\r\n        return this.registerInput(name, {\r\n          set: this.setScriptInputValue.bind(this, name.substring('in-'.length))\r\n        });\r\n\r\n      /*    if (name.startsWith('intype-')) return this.registerInput(name, {\r\n        set: function() {} // Ignore input type\r\n      })\r\n\r\n      if (name.startsWith('outtype-')) return this.registerInput(name, {\r\n        set: function() {} // Ignore output type\r\n      })*/\r\n    },\r\n    scheduleFetch: function () {\r\n      var internal = this._internal;\r\n      if (!internal.hasScheduledFetch) {\r\n        internal.hasScheduledFetch = true;\r\n        this.scheduleAfterInputsHaveUpdated(this.doFetch.bind(this));\r\n      }\r\n    },\r\n    doResponse: function (status, response, request) {\r\n      // Process the response content with the response function\r\n      if (this._internal.responseFunc) {\r\n        this._internal.responseFunc.apply(this._internal.self, [\r\n          this._internal.inputValues,\r\n          this._internal.outputValuesProxy,\r\n          { status: status, content: response, request: request }\r\n        ]);\r\n      }\r\n\r\n      this._internal.inspectData = { status: status, content: response };\r\n\r\n      // Flag status\r\n      if (status >= 200 && status < 300) {\r\n        this.sendSignalOnOutput('success');\r\n      } else {\r\n        this.sendSignalOnOutput('failure');\r\n      }\r\n    },\r\n    doExternalFetch: function (request) {\r\n      var url = request.resource;\r\n\r\n      // Append parameters from request as query\r\n      if (Object.keys(request.parameters).length > 0) {\r\n        var parameters = Object.keys(request.parameters).map(function (p) {\r\n          return p + '=' + encodeURIComponent(request.parameters[p]);\r\n        });\r\n        url += '?' + parameters.join('&');\r\n      }\r\n\r\n      if (typeof _noodl_cloud_runtime_version === 'undefined') {\r\n        // Running in browser\r\n        var _this = this;\r\n        var xhr = new window.XMLHttpRequest();\r\n        this._xhr = xhr;\r\n\r\n        xhr.open(request.method, url, true);\r\n        for (var header in request.headers) {\r\n          xhr.setRequestHeader(header, request.headers[header]);\r\n        }\r\n        xhr.onreadystatechange = function () {\r\n          // XMLHttpRequest.DONE = 4, but torped runtime doesn't support enum\r\n\r\n          var sentResponse = false;\r\n\r\n          if (this.readyState === 4 || this.readyState === XMLHttpRequest.DONE) {\r\n            var statusCode = this.status;\r\n            var responseType = this.getResponseHeader('content-type');\r\n            var rawResponse = this.response;\r\n            delete this._xhr;\r\n\r\n            if (responseType) {\r\n              responseType = responseType.toLowerCase();\r\n              const responseData = responseType.indexOf('json') !== -1 ? JSON.parse(rawResponse) : rawResponse;\r\n\r\n              _this.doResponse(statusCode, responseData, request);\r\n              sentResponse = true;\r\n            }\r\n\r\n            if (sentResponse === false) {\r\n              _this.doResponse(statusCode, rawResponse, request);\r\n            }\r\n          }\r\n        };\r\n        xhr.onerror = function (e) {\r\n          //console.log('REST: Failed to request', url);\r\n          delete this._xhr;\r\n          _this.sendSignalOnOutput('failure');\r\n        };\r\n\r\n        xhr.onabort = function () {\r\n          delete this._xhr;\r\n          _this.sendSignalOnOutput('canceled');\r\n        };\r\n\r\n        if (request.content) {\r\n          xhr.setRequestHeader('Content-Type', 'application/json');\r\n          xhr.send(JSON.stringify(request.content));\r\n        } else {\r\n          xhr.send();\r\n        }\r\n      } else {\r\n        // Running in cloud runtime\r\n        const headers = Object.assign(\r\n          {},\r\n          request.headers,\r\n          request.content\r\n            ? {\r\n                'Content-Type': 'application/json'\r\n              }\r\n            : {}\r\n        );\r\n        fetch(url, {\r\n          method: request.method,\r\n          headers,\r\n          body: request.content ? JSON.stringify(request.content) : undefined\r\n        })\r\n          .then((response) => {\r\n            const responseType = response.headers.get('content-type');\r\n            if (responseType) {\r\n              if (responseType.indexOf('/json') !== -1) {\r\n                response.json().then((json) => {\r\n                  this.doResponse(response.status, json, request);\r\n                });\r\n              } else {\r\n                if (this.context.editorConnection) {\r\n                  this.context.editorConnection.sendWarning(\r\n                    this.nodeScope.componentOwner.name,\r\n                    this.id,\r\n                    'rest-run-waring-',\r\n                    {\r\n                      message: 'REST only supports json content type in response.'\r\n                    }\r\n                  );\r\n                }\r\n              }\r\n            } else {\r\n              response.text().then((raw) => {\r\n                this.doResponse(response.status, raw, request);\r\n              });\r\n            }\r\n          })\r\n          .catch((e) => {\r\n            console.log('REST: Failed to request', url);\r\n            console.log(e);\r\n            this.sendSignalOnOutput('failure');\r\n          });\r\n      }\r\n    },\r\n    doFetch: function () {\r\n      this._internal.hasScheduledFetch = false;\r\n\r\n      // Format resource path\r\n      var resource = this._internal.resource;\r\n      if (resource) {\r\n        for (var key in this._internal.inputValues) {\r\n          resource = resource.replace('{' + key + '}', this._internal.inputValues[key]);\r\n        }\r\n      }\r\n\r\n      // Setup the request\r\n      var request = {\r\n        resource: resource,\r\n        headers: {},\r\n        method: this._internal.method !== undefined ? this._internal.method : 'GET',\r\n        parameters: {}\r\n      };\r\n\r\n      // Process the request content with the preprocess function\r\n      if (this._internal.requestFunc) {\r\n        this._internal.requestFunc.apply(this._internal.self, [\r\n          this._internal.inputValues,\r\n          this._internal.outputValuesProxy,\r\n          request\r\n        ]);\r\n      }\r\n\r\n      // Perform request\r\n      this.doExternalFetch(request);\r\n    },\r\n    cancelFetch: function () {\r\n      if (typeof _noodl_cloud_runtime_version === 'undefined') {\r\n        this._xhr && this._xhr.abort();\r\n      } else {\r\n        if (this.context.editorConnection) {\r\n          this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'rest-run-waring-', {\r\n            message: \"REST doesn't support cancel in cloud functions.\"\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nfunction _parseScriptForErrors(script, args, name, node, context, ports) {\r\n  // Clear run warnings if the script is edited\r\n  context.editorConnection.clearWarning(node.component.name, node.id, 'rest-run-waring-' + name);\r\n\r\n  if (script === undefined) {\r\n    context.editorConnection.clearWarning(node.component.name, node.id, 'rest-parse-waring-' + name);\r\n    return;\r\n  }\r\n\r\n  try {\r\n    new Function(...args, script);\r\n\r\n    context.editorConnection.clearWarning(node.component.name, node.id, 'rest-parse-waring-' + name);\r\n  } catch (e) {\r\n    context.editorConnection.sendWarning(node.component.name, node.id, 'rest-parse-waring-' + name, {\r\n      message: '<strong>' + name + '</strong>: ' + e.message,\r\n      showGlobally: true\r\n    });\r\n  }\r\n\r\n  // Extract inputs and outputs\r\n  function _exists(port) {\r\n    return ports.find((p) => p.name === port) !== undefined;\r\n  }\r\n\r\n  const scriptWithoutComments = script.replace(/\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/g, ''); // Remove comments\r\n  const inputs = scriptWithoutComments.match(/Inputs\\.[A-Za-z0-9]+/g);\r\n  if (inputs) {\r\n    const unique = {};\r\n    inputs.forEach((v) => {\r\n      unique[v.substring('Inputs.'.length)] = true;\r\n    });\r\n\r\n    Object.keys(unique).forEach((p) => {\r\n      if (_exists('in-' + p)) return;\r\n\r\n      ports.push({\r\n        name: 'in-' + p,\r\n        displayName: p,\r\n        plug: 'input',\r\n        type: '*',\r\n        group: 'Inputs'\r\n      });\r\n    });\r\n  }\r\n\r\n  const outputs = scriptWithoutComments.match(/Outputs\\.[A-Za-z0-9]+/g);\r\n  if (outputs) {\r\n    const unique = {};\r\n    outputs.forEach((v) => {\r\n      unique[v.substring('Outputs.'.length)] = true;\r\n    });\r\n\r\n    Object.keys(unique).forEach((p) => {\r\n      if (_exists('out-' + p)) return;\r\n\r\n      ports.push({\r\n        name: 'out-' + p,\r\n        displayName: p,\r\n        plug: 'output',\r\n        type: '*',\r\n        group: 'Outputs'\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  node: RestNode,\r\n  setup: function (context, graphModel) {\r\n    if (!context.editorConnection) {\r\n      return;\r\n    }\r\n\r\n    function _managePortsForNode(node) {\r\n      function _updatePorts() {\r\n        if (!node.parameters) {\r\n          return;\r\n        }\r\n\r\n        var ports = [];\r\n        function exists(name) {\r\n          for (var i = 0; i < ports.length; i++) if (ports[i].name === name && ports[i].plug === 'input') return true;\r\n          return false;\r\n        }\r\n\r\n        /*  const _typeEnums = [{value:'string',label:'String'},\r\n                                {value:'boolean',label:'Boolean'},\r\n                                {value:'number',label:'Number'},\r\n                                {value:'color',label:'Color'},\r\n                                {value:'object',label:'Object'},\r\n                                {value:'array',label:'Array'}]*/\r\n\r\n        // Inputs\r\n        /* if (node.parameters['scriptInputs'] !== undefined && node.parameters['scriptInputs'].length > 0) {\r\n          node.parameters['scriptInputs'].forEach((p) => {\r\n            // Type for input\r\n            ports.push({\r\n              name: 'intype-' + p.label,\r\n              displayName: 'Type',\r\n              plug: 'input',\r\n              type: { name: 'enum', enums: _typeEnums, allowEditOnly: true },\r\n              default: 'string',\r\n              parent: 'scriptInputs',\r\n              parentItemId: p.id\r\n            })\r\n      \r\n            // Default Value for input\r\n            ports.push({\r\n              name: 'in-' + p.label,\r\n              displayName: p.label,\r\n              plug: 'input',\r\n              type: node.parameters['intype-' + p.label] || 'string',\r\n              group: 'Input Values'\r\n            })\r\n          })\r\n        }*/\r\n\r\n        // Outputs\r\n        /* if (node.parameters['scriptOutputs'] !== undefined && node.parameters['scriptOutputs'].length > 0) {\r\n          node.parameters['scriptOutputs'].forEach((p) => {\r\n            // Type for output\r\n            ports.push({\r\n              name: 'outtype-' + p.label,\r\n              displayName: 'Type',\r\n              plug: 'input',\r\n              type: { name: 'enum', enums: _typeEnums, allowEditOnly: true },\r\n              default: 'string',\r\n              parent: 'scriptOutputs',\r\n              parentItemId: p.id\r\n            })\r\n      \r\n            // Value for output\r\n            ports.push({\r\n              name: 'out-' + p.label,\r\n              displayName: p.label,\r\n              plug: 'output',\r\n              type: node.parameters['outtype-' + p.label] || '*',\r\n              group: 'Outputs',\r\n            })\r\n          })\r\n        }*/\r\n\r\n        // Parse resource path inputs\r\n        if (node.parameters.resource) {\r\n          var inputs = node.parameters.resource.match(/\\{[A-Za-z0-9_]*\\}/g);\r\n          for (var i in inputs) {\r\n            var def = inputs[i];\r\n            var name = def.replace('{', '').replace('}', '');\r\n            if (exists('in-' + name)) continue;\r\n\r\n            ports.push({\r\n              name: 'in-' + name,\r\n              displayName: name,\r\n              type: 'string',\r\n              plug: 'input',\r\n              group: 'Inputs'\r\n            });\r\n          }\r\n        }\r\n\r\n        if (node.parameters['requestScript']) {\r\n          _parseScriptForErrors(\r\n            node.parameters['requestScript'],\r\n            ['Inputs', 'Outputs', 'Request'],\r\n            'Request script',\r\n            node,\r\n            context,\r\n            ports\r\n          );\r\n        }\r\n\r\n        if (node.parameters['responseScript']) {\r\n          _parseScriptForErrors(\r\n            node.parameters['responseScript'],\r\n            ['Inputs', 'Outputs', 'Response'],\r\n            'Response script',\r\n            node,\r\n            context,\r\n            ports\r\n          );\r\n        }\r\n\r\n        context.editorConnection.sendDynamicPorts(node.id, ports);\r\n      }\r\n\r\n      _updatePorts();\r\n      node.on('parameterUpdated', function () {\r\n        _updatePorts();\r\n      });\r\n    }\r\n\r\n    graphModel.on('editorImportComplete', () => {\r\n      graphModel.on('nodeAdded.REST2', function (node) {\r\n        _managePortsForNode(node);\r\n      });\r\n\r\n      for (const node of graphModel.getNodesWithType('REST2')) {\r\n        _managePortsForNode(node);\r\n      }\r\n    });\r\n  }\r\n};\r\n","'use strict';\r\n\r\nvar DbModelCRUDBase = require('./dbmodelcrudbase');\r\nconst CloudStore = require('../../../api/cloudstore');\r\n\r\nvar SetDbModelPropertiedNodeDefinition = {\r\n  node: {\r\n    name: 'SetDbModelProperties',\r\n    docs: 'https://docs.noodl.net/nodes/data/cloud-data/set-record-properties',\r\n    displayNodeName: 'Set Record Properties',\r\n    usePortAsLabel: 'collectionName',\r\n    dynamicports: [\r\n      {\r\n        name: 'conditionalports/extended',\r\n        condition: 'storeType = cloud OR storeType NOT SET',\r\n        inputs: ['storeProperties']\r\n      }\r\n    ],\r\n    inputs: {\r\n      store: {\r\n        displayName: 'Do',\r\n        group: 'Actions',\r\n        valueChangedToTrue: function () {\r\n          if (this._internal.storeType === undefined || this._internal.storeType === 'cloud') this.scheduleSave();\r\n          else this.scheduleStore();\r\n        }\r\n      },\r\n      storeProperties: {\r\n        displayName: 'Properties to  store',\r\n        group: 'General',\r\n        type: {\r\n          name: 'enum',\r\n          enums: [\r\n            { label: 'Only specified', value: 'specified' },\r\n            { label: 'All', value: 'all' }\r\n          ]\r\n        },\r\n        default: 'specified',\r\n        set: function (value) {\r\n          this._internal.storeProperties = value;\r\n        }\r\n      },\r\n      storeType: {\r\n        displayName: 'Store to',\r\n        group: 'General',\r\n        type: {\r\n          name: 'enum',\r\n          enums: [\r\n            { label: 'Cloud and local', value: 'cloud' },\r\n            { label: 'Local only', value: 'local' }\r\n          ]\r\n        },\r\n        default: 'cloud',\r\n        set: function (value) {\r\n          this._internal.storeType = value;\r\n        }\r\n      }\r\n    },\r\n    outputs: {\r\n      stored: {\r\n        type: 'signal',\r\n        displayName: 'Success',\r\n        group: 'Events'\r\n      }\r\n    },\r\n    methods: {\r\n      scheduleSave: function () {\r\n        const _this = this;\r\n        const internal = this._internal;\r\n\r\n        if (!this.checkWarningsBeforeCloudOp()) return;\r\n\r\n        this.scheduleOnce('StorageSave', function () {\r\n          if (!internal.model) {\r\n            _this.setError('Missing Record Id');\r\n            return;\r\n          }\r\n          \r\n          const model = internal.model;\r\n          for (const key in internal.inputValues) {\r\n            model.set(key, internal.inputValues[key], { resolve: true });\r\n          }\r\n          \r\n          CloudStore.forScope(_this.nodeScope.modelScope).save({\r\n            collection: internal.collectionId,\r\n            objectId: model.getId(), // Get the objectId part of the model id\r\n            data: internal.storeProperties === 'all' ? model.data : internal.inputValues, // Only store input values by default, if not explicitly specified\r\n            acl: _this._getACL(),\r\n            success: function (response) {\r\n              for (var key in response) {\r\n                model.set(key, response[key]);\r\n              }\r\n\r\n              _this.sendSignalOnOutput('stored');\r\n            },\r\n            error: function (err) {\r\n              _this.setError(err || 'Failed to save.');\r\n            }\r\n          });\r\n        });\r\n      },\r\n      scheduleStore: function () {\r\n        if (this.hasScheduledStore) return;\r\n        this.hasScheduledStore = true;\r\n\r\n        var internal = this._internal;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          this.hasScheduledStore = false;\r\n          if (!internal.model) return;\r\n\r\n          for (var i in internal.inputValues) {\r\n            internal.model.set(i, internal.inputValues[i], { resolve: true });\r\n          }\r\n          this.sendSignalOnOutput('stored');\r\n        });\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nDbModelCRUDBase.addBaseInfo(SetDbModelPropertiedNodeDefinition);\r\nDbModelCRUDBase.addModelId(SetDbModelPropertiedNodeDefinition);\r\nDbModelCRUDBase.addInputProperties(SetDbModelPropertiedNodeDefinition);\r\nDbModelCRUDBase.addAccessControl(SetDbModelPropertiedNodeDefinition);\r\n\r\nmodule.exports = SetDbModelPropertiedNodeDefinition;\r\n","'use strict';\r\n\r\nvar ModelCRUDBase = require('./modelcrudbase');\r\n\r\nvar SetModelPropertiedNodeDefinition = {\r\n  node: {\r\n    name: 'SetModelProperties',\r\n    docs: 'https://docs.noodl.net/nodes/data/object/set-object-properties',\r\n    displayNodeName: 'Set Object Properties',\r\n    inputs: {\r\n      store: {\r\n        displayName: 'Do',\r\n        group: 'Actions',\r\n        valueChangedToTrue: function () {\r\n          this.scheduleStore();\r\n        }\r\n      }\r\n    },\r\n    outputs: {\r\n      stored: {\r\n        type: 'signal',\r\n        displayName: 'Done',\r\n        group: 'Events'\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nModelCRUDBase.addBaseInfo(SetModelPropertiedNodeDefinition);\r\nModelCRUDBase.addModelId(SetModelPropertiedNodeDefinition);\r\nModelCRUDBase.addInputProperties(SetModelPropertiedNodeDefinition);\r\n\r\nmodule.exports = SetModelPropertiedNodeDefinition;\r\n","'use strict';\n\nconst DateToStringNode = {\n  name: 'Date To String',\n  docs: 'https://docs.noodl.net/nodes/utilities/date-to-string',\n  category: 'Utilities',\n  initialize: function () {\n    this._internal.formatString = '{year}-{month}-{date}';\n  },\n  inputs: {\n    formatString: {\n      displayName: 'Format',\n      type: 'string',\n      default: '{year}-{month}-{date}',\n      set: function (value) {\n        if (this._internal.formatString === value) return;\n        this._internal.formatString = value;\n\n        if (this._internal.currentInput !== undefined) {\n          this._format();\n          this.flagOutputDirty('currentValue');\n        }\n      }\n    },\n    input: {\n      type: { name: 'date' },\n      displayName: 'Date',\n      set: function (value) {\n        const _value = typeof value === 'string' ? new Date(value) : value;\n        if (this._internal.currentInput === _value) return;\n\n        this._internal.currentInput = _value;\n        this._format();\n      }\n    }\n  },\n  outputs: {\n    currentValue: {\n      type: 'string',\n      displayName: 'Date String',\n      group: 'Value',\n      getter: function () {\n        return this._internal.dateString;\n      }\n    },\n    inputChanged: {\n      type: 'signal',\n      displayName: 'Date Changed',\n      group: 'Signals'\n    },\n    onError: {\n      type: 'signal',\n      displayName: 'Invalid Date',\n      group: 'Signals'\n    }\n  },\n  methods: {\n    _format() {\n      try {\n        const t = this._internal.currentInput;\n        const format = this._internal.formatString;\n        const date = ('0' + t.getDate()).slice(-2);\n        const month = ('0' + (t.getMonth() + 1)).slice(-2);\n        const monthShort = new Intl.DateTimeFormat('en-US', { month: 'short' }).format(t);\n        const year = t.getFullYear();\n        const yearShort = year.toString().substring(2);\n        const hours = ('0' + t.getHours()).slice(-2);\n        const minutes = ('0' + t.getMinutes()).slice(-2);\n        const seconds = ('0' + t.getSeconds()).slice(-2);\n\n        this._internal.dateString = format\n          .replace(/\\{date\\}/g, date)\n          .replace(/\\{month\\}/g, month)\n          .replace(/\\{monthShort\\}/g, monthShort)\n          .replace(/\\{year\\}/g, year)\n          .replace(/\\{yearShort\\}/g, yearShort)\n          .replace(/\\{hours\\}/g, hours)\n          .replace(/\\{minutes\\}/g, minutes)\n          .replace(/\\{seconds\\}/g, seconds);\n      } catch (error) {\n        // Set the output to be blank, makes it easier to handle.\n        this._internal.dateString = '';\n        this.flagOutputDirty('onError');\n      }\n\n      // Flag that the value have changed\n      this.flagOutputDirty('currentValue');\n      this.sendSignalOnOutput('inputChanged');\n    }\n  }\n};\n\nmodule.exports = {\n  node: DateToStringNode\n};\n","'use strict';\r\n\r\nconst difference = require('lodash.difference');\r\n\r\n//const Model = require('./data/model');\r\n\r\nconst ExpressionNode = {\r\n  name: 'Expression',\r\n  docs: 'https://docs.noodl.net/nodes/math/expression',\r\n  usePortAsLabel: 'expression',\r\n  category: 'CustomCode',\r\n  color: 'javascript',\r\n  nodeDoubleClickAction: {\r\n    focusPort: 'Expression'\r\n  },\r\n  searchTags: ['javascript'],\r\n  initialize: function () {\r\n    var internal = this._internal;\r\n\r\n    internal.scope = {};\r\n    internal.hasScheduledEvaluation = false;\r\n\r\n    internal.code = undefined;\r\n    internal.cachedValue = 0;\r\n    internal.currentExpression = '';\r\n    internal.compiledFunction = undefined;\r\n    internal.inputNames = [];\r\n    internal.inputValues = [];\r\n  },\r\n  getInspectInfo() {\r\n    return this._internal.cachedValue;\r\n  },\r\n  inputs: {\r\n    expression: {\r\n      group: 'General',\r\n      inputPriority: 1,\r\n      type: {\r\n        name: 'string',\r\n        allowEditOnly: true,\r\n        codeeditor: 'javascript'\r\n      },\r\n      displayName: 'Expression',\r\n      set: function (value) {\r\n        var internal = this._internal;\r\n        internal.currentExpression = functionPreamble + 'return (' + value + ');';\r\n        internal.compiledFunction = undefined;\r\n\r\n        var newInputs = parsePorts(value);\r\n\r\n        var inputsToAdd = difference(newInputs, internal.inputNames);\r\n        var inputsToRemove = difference(internal.inputNames, newInputs);\r\n\r\n        var self = this;\r\n        inputsToRemove.forEach(function (name) {\r\n          self.deregisterInput(name);\r\n          delete internal.scope[name];\r\n        });\r\n\r\n        inputsToAdd.forEach(function (name) {\r\n          if (self.hasInput(name)) {\r\n            return;\r\n          }\r\n\r\n          self.registerInput(name, {\r\n            set: function (value) {\r\n              internal.scope[name] = value;\r\n              if (!this.isInputConnected('run')) this._scheduleEvaluateExpression();\r\n            }\r\n          });\r\n\r\n          internal.scope[name] = 0;\r\n          self._inputValues[name] = 0;\r\n        });\r\n\r\n        /*      if(value.indexOf('Vars') !== -1 || value.indexOf('Variables') !== -1)  {\r\n                    // This expression is using variables, it should listen for changes\r\n                    this._internal.onVariablesChangedCallback = (args) => {\r\n                        this._scheduleEvaluateExpression()\r\n                    }\r\n\r\n                    Model.get('--ndl--global-variables').off('change',this._internal.onVariablesChangedCallback)\r\n                    Model.get('--ndl--global-variables').on('change',this._internal.onVariablesChangedCallback)\r\n                }*/\r\n\r\n        internal.inputNames = Object.keys(internal.scope);\r\n        if (!this.isInputConnected('run')) this._scheduleEvaluateExpression();\r\n      }\r\n    },\r\n    run: {\r\n      group: 'Actions',\r\n      displayName: 'Run',\r\n      type: 'signal',\r\n      valueChangedToTrue: function () {\r\n        this._scheduleEvaluateExpression();\r\n      }\r\n    }\r\n  },\r\n  outputs: {\r\n    result: {\r\n      group: 'Result',\r\n      type: '*',\r\n      displayName: 'Result',\r\n      getter: function () {\r\n        if (!this._internal.currentExpression) {\r\n          return 0;\r\n        }\r\n\r\n        return this._internal.cachedValue;\r\n      }\r\n    },\r\n    isTrue: {\r\n      group: 'Result',\r\n      type: 'boolean',\r\n      displayName: 'Is True',\r\n      getter: function () {\r\n        if (!this._internal.currentExpression) {\r\n          return false;\r\n        }\r\n\r\n        return !!this._internal.cachedValue;\r\n      }\r\n    },\r\n    isFalse: {\r\n      group: 'Result',\r\n      type: 'boolean',\r\n      displayName: 'Is False',\r\n      getter: function () {\r\n        if (!this._internal.currentExpression) {\r\n          return true;\r\n        }\r\n\r\n        return !this._internal.cachedValue;\r\n      }\r\n    },\r\n    isTrueEv: {\r\n      group: 'Events',\r\n      type: 'signal',\r\n      displayName: 'On True'\r\n    },\r\n    isFalseEv: {\r\n      group: 'Events',\r\n      type: 'signal',\r\n      displayName: 'On False'\r\n    }\r\n  },\r\n  prototypeExtensions: {\r\n    registerInputIfNeeded: {\r\n      value: function (name) {\r\n        if (this.hasInput(name)) {\r\n          return;\r\n        }\r\n\r\n        this._internal.scope[name] = 0;\r\n        this._inputValues[name] = 0;\r\n\r\n        this.registerInput(name, {\r\n          set: function (value) {\r\n            this._internal.scope[name] = value;\r\n            if (!this.isInputConnected('run')) this._scheduleEvaluateExpression();\r\n          }\r\n        });\r\n      }\r\n    },\r\n    _scheduleEvaluateExpression: {\r\n      value: function () {\r\n        var internal = this._internal;\r\n        if (internal.hasScheduledEvaluation === false) {\r\n          internal.hasScheduledEvaluation = true;\r\n          this.flagDirty();\r\n          this.scheduleAfterInputsHaveUpdated(function () {\r\n            var lastValue = internal.cachedValue;\r\n            internal.cachedValue = this._calculateExpression();\r\n            if (lastValue !== internal.cachedValue) {\r\n              this.flagOutputDirty('result');\r\n              this.flagOutputDirty('isTrue');\r\n              this.flagOutputDirty('isFalse');\r\n            }\r\n            if (internal.cachedValue) this.sendSignalOnOutput('isTrueEv');\r\n            else this.sendSignalOnOutput('isFalseEv');\r\n            internal.hasScheduledEvaluation = false;\r\n          });\r\n        }\r\n      }\r\n    },\r\n    _calculateExpression: {\r\n      value: function () {\r\n        var internal = this._internal;\r\n\r\n        if (!internal.compiledFunction) {\r\n          internal.compiledFunction = this._compileFunction();\r\n        }\r\n        for (var i = 0; i < internal.inputNames.length; ++i) {\r\n          var inputValue = internal.scope[internal.inputNames[i]];\r\n          internal.inputValues[i] = inputValue;\r\n        }\r\n        try {\r\n          return internal.compiledFunction.apply(null, internal.inputValues);\r\n        } catch (e) {\r\n          console.error('Error in expression:', e.message);\r\n        }\r\n        return 0;\r\n      }\r\n    },\r\n    _compileFunction: {\r\n      value: function () {\r\n        var expression = this._internal.currentExpression;\r\n        var args = Object.keys(this._internal.scope);\r\n\r\n        var key = expression + args.join(' ');\r\n\r\n        if (compiledFunctionsCache.hasOwnProperty(key) === false) {\r\n          args.push(expression);\r\n\r\n          try {\r\n            compiledFunctionsCache[key] = construct(Function, args);\r\n          } catch (e) {\r\n            console.error('Failed to compile JS function', e.message);\r\n          }\r\n        }\r\n        return compiledFunctionsCache[key];\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nvar functionPreamble = [\r\n  'var min = Math.min,' +\r\n    '    max = Math.max,' +\r\n    '    cos = Math.cos,' +\r\n    '    sin = Math.sin,' +\r\n    '    tan = Math.tan,' +\r\n    '    sqrt = Math.sqrt,' +\r\n    '    pi = Math.PI,' +\r\n    '    round = Math.round,' +\r\n    '    floor = Math.floor,' +\r\n    '    ceil = Math.ceil,' +\r\n    '    abs = Math.abs,' +\r\n    '    random = Math.random;'\r\n  /* '    Vars = Variables = Noodl.Object.get(\"--ndl--global-variables\");' */\r\n].join('');\r\n\r\n//Since apply cannot be used on constructors (i.e. new Something) we need this hax\r\n//see http://stackoverflow.com/questions/1606797/use-of-apply-with-new-operator-is-this-possible\r\nfunction construct(constructor, args) {\r\n  function F() {\r\n    return constructor.apply(this, args);\r\n  }\r\n  F.prototype = constructor.prototype;\r\n  return new F();\r\n}\r\n\r\nvar compiledFunctionsCache = {};\r\n\r\nvar portsToIgnore = [\r\n  'min',\r\n  'max',\r\n  'cos',\r\n  'sin',\r\n  'tan',\r\n  'sqrt',\r\n  'pi',\r\n  'round',\r\n  'floor',\r\n  'ceil',\r\n  'abs',\r\n  'random',\r\n  'Math',\r\n  'window',\r\n  'document',\r\n  'undefined',\r\n  'Vars',\r\n  'true',\r\n  'false',\r\n  'null',\r\n  'Boolean'\r\n];\r\n\r\nfunction parsePorts(expression) {\r\n  var ports = [];\r\n\r\n  function addPort(name) {\r\n    if (portsToIgnore.indexOf(name) !== -1) return;\r\n    if (\r\n      ports.some(function (p) {\r\n        return p === name;\r\n      })\r\n    )\r\n      return;\r\n\r\n    ports.push(name);\r\n  }\r\n\r\n  // First remove all strings\r\n  expression = expression.replace(/\\\"([^\\\"]*)\\\"/g, '').replace(/\\'([^\\']*)\\'/g, '');\r\n\r\n  // Extract identifiers\r\n  var identifiers = expression.matchAll(/[a-zA-Z\\_\\$][a-zA-Z0-9\\.\\_\\$]*/g);\r\n  for (const _id of identifiers) {\r\n    var name = _id[0];\r\n    if (name.indexOf('.') !== -1) {\r\n      name = name.split('.')[0]; // Take first symbol on \".\" sequence\r\n    }\r\n\r\n    addPort(name);\r\n  }\r\n\r\n  return ports;\r\n}\r\n\r\nfunction updatePorts(nodeId, expression, editorConnection) {\r\n  var portNames = parsePorts(expression);\r\n\r\n  var ports = portNames.map(function (name) {\r\n    return {\r\n      group: 'Parameters',\r\n      name: name,\r\n      type: {\r\n        name: '*',\r\n        editAsType: 'string'\r\n      },\r\n      plug: 'input'\r\n    };\r\n  });\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nfunction evalCompileWarnings(editorConnection, node) {\r\n  try {\r\n    new Function(node.parameters.expression);\r\n    editorConnection.clearWarning(node.component.name, node.id, 'expression-compile-error');\r\n  } catch (e) {\r\n    editorConnection.sendWarning(node.component.name, node.id, 'expression-compile-error', {\r\n      message: e.message\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  node: ExpressionNode,\r\n  setup: function (context, graphModel) {\r\n    if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n      return;\r\n    }\r\n\r\n    graphModel.on('nodeAdded.Expression', function (node) {\r\n      if (node.parameters.expression) {\r\n        updatePorts(node.id, node.parameters.expression, context.editorConnection);\r\n        evalCompileWarnings(context.editorConnection, node);\r\n      }\r\n      node.on('parameterUpdated', function (event) {\r\n        if (event.name === 'expression') {\r\n          updatePorts(node.id, node.parameters.expression, context.editorConnection);\r\n          evalCompileWarnings(context.editorConnection, node);\r\n        }\r\n      });\r\n    });\r\n  }\r\n};\r\n","'use strict';\r\n\r\nfunction invert(value) {\r\n  if (value === undefined) {\r\n    return undefined;\r\n  }\r\n  return !value;\r\n}\r\n\r\nconst InverterNode = {\r\n  name: 'Inverter',\r\n  docs: 'https://docs.noodl.net/nodes/logic/inverter',\r\n  category: 'Logic',\r\n  initialize: function () {\r\n    this._internal.currentValue = undefined;\r\n  },\r\n  getInspectInfo() {\r\n    return String(invert(this._internal.currentValue));\r\n  },\r\n  inputs: {\r\n    value: {\r\n      type: {\r\n        name: 'boolean'\r\n      },\r\n      displayName: 'Value',\r\n      set: function (value) {\r\n        this._internal.currentValue = value;\r\n        this.flagOutputDirty('result');\r\n      }\r\n    }\r\n  },\r\n  outputs: {\r\n    result: {\r\n      type: 'boolean',\r\n      displayName: 'Result',\r\n      getter: function () {\r\n        return invert(this._internal.currentValue);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  node: InverterNode\r\n};\r\n","'use strict';\r\n\r\nconst OrNode = {\r\n  name: 'Or',\r\n  docs: 'https://docs.noodl.net/nodes/logic/or',\r\n  category: 'Logic',\r\n  initialize: function () {\r\n    this._internal.inputs = [];\r\n  },\r\n  getInspectInfo() {\r\n    return this._internal.inputs.some(isTrue);\r\n  },\r\n  numberedInputs: {\r\n    input: {\r\n      type: 'boolean',\r\n      displayPrefix: 'Input',\r\n      createSetter(index) {\r\n        return function (value) {\r\n          if (this._internal.inputs[index] === value) {\r\n            return;\r\n          }\r\n\r\n          this._internal.inputs[index] = value;\r\n          this.flagOutputDirty('result');\r\n        };\r\n      }\r\n    }\r\n  },\r\n  outputs: {\r\n    result: {\r\n      type: 'boolean',\r\n      displayName: 'Result',\r\n      getter: function () {\r\n        return this._internal.inputs.some(isTrue);\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  node: OrNode\r\n};\r\n\r\nfunction isTrue(value) {\r\n  return value ? true : false;\r\n}\r\n","const { Node } = require('../../../noodl-runtime');\r\nconst guid = require('../../guid');\r\nconst Model = require('../../model');\r\n\r\nfunction sendSignalOnInput(itemNode, name) {\r\n  itemNode.queueInput(name, true); // send signal\r\n  itemNode.queueInput(name, false);\r\n}\r\n\r\nconst RunTasksDefinition = {\r\n  name: 'RunTasks',\r\n  displayNodeName: 'Run Tasks',\r\n  docs: 'https://docs.noodl.net/nodes/data/run-tasks',\r\n  color: 'data',\r\n  category: 'Data',\r\n  initialize() {\r\n    this._internal.queuedOperations = [];\r\n    this._internal.state = 'idle';\r\n    this._internal.maxRunningTasks = 10;\r\n    this._internal.activeTasks = new Map(); //id => ComponentInstanceNode\r\n  },\r\n  inputs: {\r\n    items: {\r\n      group: 'Data',\r\n      displayName: 'Items',\r\n      type: 'array',\r\n      set: function (value) {\r\n        if (!value) return;\r\n        if (value === this._internal.items) return;\r\n\r\n        this._internal.items = value;\r\n      }\r\n    },\r\n    stopOnFailure: {\r\n      group: 'General',\r\n      displayName: 'Stop On Failure',\r\n      type: 'boolean',\r\n      default: false,\r\n      set: function (value) {\r\n        this._internal.stopOnFailure = value;\r\n      }\r\n    },\r\n    maxRunningTasks: {\r\n      group: 'General',\r\n      displayName: 'Max Running Tasks',\r\n      type: 'number',\r\n      default: 10,\r\n      set: function (value) {\r\n        this._internal.maxRunningTasks = value;\r\n      }\r\n    },\r\n    taskTemplate: {\r\n      type: 'component',\r\n      displayName: 'Template',\r\n      group: 'General',\r\n      set: function (value) {\r\n        this._internal.template = value;\r\n      }\r\n    },\r\n    run: {\r\n      group: 'General',\r\n      displayName: 'Do',\r\n      type: 'signal',\r\n      valueChangedToTrue: function () {\r\n        this.scheduleRun();\r\n      }\r\n    },\r\n    abort: {\r\n      group: 'General',\r\n      displayName: 'Abort',\r\n      type: 'signal',\r\n      valueChangedToTrue: function () {\r\n        this.scheduleAbort();\r\n      }\r\n    }\r\n  },\r\n  outputs: {\r\n    success: {\r\n      type: 'signal',\r\n      group: 'Events',\r\n      displayName: 'Success'\r\n    },\r\n    failure: {\r\n      type: 'signal',\r\n      group: 'Events',\r\n      displayName: 'Failure'\r\n    },\r\n    done: {\r\n      type: 'signal',\r\n      group: 'Events',\r\n      displayName: 'Done'\r\n    },\r\n    aborted: {\r\n      type: 'signal',\r\n      group: 'Events',\r\n      displayName: 'Aborted'\r\n    }\r\n  },\r\n  methods: {\r\n    scheduleRun() {\r\n      var internal = this._internal;\r\n      if (!internal.hasScheduledRun) {\r\n        internal.hasScheduledRun = true;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          this._queueOperation(() => {\r\n            internal.hasScheduledRun = false;\r\n            this.run();\r\n          });\r\n        });\r\n      }\r\n    },\r\n    scheduleAbort() {\r\n      var internal = this._internal;\r\n      if (!internal.hasScheduledAbort) {\r\n        internal.hasScheduledAbort = true;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          this._queueOperation(() => {\r\n            internal.hasScheduledAbort = false;\r\n            this.abort();\r\n          });\r\n        });\r\n      }\r\n    },\r\n    async createTaskComponent(item) {\r\n      const internal = this._internal;\r\n\r\n      const modelScope = this.nodeScope.modelScope || Model;\r\n      const model = modelScope.create(item);\r\n\r\n      var itemNode = await this.nodeScope.createNode(internal.template, guid(), {\r\n        _forEachModel: model,\r\n        _forEachNode: this\r\n      });\r\n\r\n      // This is needed to make sure any action connected to \"Do\"\r\n      // is not run directly\r\n      const _isInputConnected = itemNode.isInputConnected.bind(itemNode);\r\n      itemNode.isInputConnected = (name) => {\r\n        if (name === 'Do') return true;\r\n        return _isInputConnected(name);\r\n      };\r\n\r\n      // Set the Id as an input\r\n      if (itemNode.hasInput('Id')) {\r\n        itemNode.setInputValue('Id', model.getId());\r\n      }\r\n      if (itemNode.hasInput('id')) {\r\n        itemNode.setInputValue('id', model.getId());\r\n      }\r\n\r\n      // Push all other values also as inputs\r\n      // if they exist as component inputs\r\n      for (var inputKey in itemNode._inputs) {\r\n        if (model.data[inputKey] !== undefined) itemNode.setInputValue(inputKey, model.data[inputKey]);\r\n      }\r\n\r\n      // capture signals\r\n      itemNode._internal.creatorCallbacks = {\r\n        onOutputChanged: (name, value, oldValue) => {\r\n          if ((oldValue === false || oldValue === undefined) && value === true) {\r\n            this.itemOutputSignalTriggered(name, model, itemNode);\r\n          }\r\n        }\r\n      };\r\n\r\n      return itemNode;\r\n    },\r\n    async startTask(task) {\r\n      const internal = this._internal;\r\n\r\n      try {\r\n        const taskComponent = await this.createTaskComponent(task);\r\n        internal.runningTasks++;\r\n        sendSignalOnInput(taskComponent, 'Do');\r\n        internal.activeTasks.set(taskComponent.id, taskComponent);\r\n      } catch (e) {\r\n        // Something went wrong starting the task\r\n        console.log(e);\r\n      }\r\n    },\r\n    async run() {\r\n      const internal = this._internal;\r\n\r\n      if (this.context.editorConnection) {\r\n        if (internal.state !== 'idle') {\r\n          this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'run-tasks', {\r\n            message: 'Cannot start when not in idle mode'\r\n          });\r\n        } else if (!internal.template) {\r\n          this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'run-tasks', {\r\n            message: 'No task template specified.'\r\n          });\r\n        } else if (!internal.items) {\r\n          this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'run-tasks', {\r\n            message: 'No items array provided.'\r\n          });\r\n        } else {\r\n          this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, 'run-tasks');\r\n        }\r\n      }\r\n\r\n      if (internal.state !== 'idle') {\r\n        return;\r\n      }\r\n\r\n      if (!internal.template) {\r\n        return;\r\n      }\r\n\r\n      if (!internal.items) {\r\n        return;\r\n      }\r\n\r\n      internal.state = 'running';\r\n      internal.numTasks = internal.items.length;\r\n      internal.failedTasks = 0;\r\n      internal.completedTasks = 0;\r\n      internal.queuedTasks = [].concat(internal.items);\r\n      internal.runningTasks = 0;\r\n\r\n      // No tasks\r\n      if (internal.items.length === 0) {\r\n        this.sendSignalOnOutput('success');\r\n        internal.state = 'idle';\r\n      }\r\n\r\n      // Start tasks\r\n      for (let i = 0; i < Math.min(internal.maxRunningTasks, internal.queuedTasks.length); i++) {\r\n        const task = internal.queuedTasks.shift();\r\n        if (!task) break;\r\n\r\n        this.startTask(task);\r\n      }\r\n    },\r\n    abort: function () {\r\n      const internal = this._internal;\r\n\r\n      internal.state = 'aborted';\r\n    },\r\n    itemOutputSignalTriggered: function (name, model, itemNode) {\r\n      const internal = this._internal;\r\n\r\n      if (internal.state === 'idle') {\r\n        // Signal while we are not running is ignored\r\n        return;\r\n      }\r\n\r\n      const checkDone = () => {\r\n        if (internal.state === 'aborted') {\r\n          this.sendSignalOnOutput('aborted');\r\n          internal.state = 'idle';\r\n          return;\r\n        }\r\n\r\n        if (internal.completedTasks === internal.numTasks) {\r\n          if (internal.failedTasks === 0) this.sendSignalOnOutput('success');\r\n          else this.sendSignalOnOutput('failure');\r\n          this.sendSignalOnOutput('done');\r\n          internal.state = 'idle';\r\n        } else {\r\n          if (internal.stopOnFailure) {\r\n            // Only continue if there are no failed tasks, otherwise aborted\r\n            if (internal.failedTasks === 0) {\r\n              internal.runningTasks++;\r\n              const task = internal.queuedTasks.shift();\r\n              if (task) this.startTask(task);\r\n            } else {\r\n              this.sendSignalOnOutput('failure');\r\n              this.sendSignalOnOutput('aborted');\r\n            }\r\n          } else {\r\n            internal.runningTasks++;\r\n            const task = internal.queuedTasks.shift();\r\n            if (task) this.startTask(task);\r\n          }\r\n        }\r\n      };\r\n\r\n      if (name === 'Success') {\r\n        internal.completedTasks++;\r\n        internal.runningTasks--;\r\n        checkDone();\r\n      } else if (name === 'Failure') {\r\n        internal.completedTasks++;\r\n        internal.failedTasks++;\r\n        internal.runningTasks--;\r\n        checkDone();\r\n      }\r\n\r\n      internal.activeTasks.delete(itemNode.id);\r\n      this.nodeScope.deleteNode(itemNode);\r\n    },\r\n    _queueOperation(op) {\r\n      this._internal.queuedOperations.push(op);\r\n      this._runQueueOperations();\r\n    },\r\n    async _runQueueOperations() {\r\n      if (this.runningOperations) {\r\n        return;\r\n      }\r\n      this.runningOperations = true;\r\n\r\n      while (this._internal.queuedOperations.length) {\r\n        const op = this._internal.queuedOperations.shift();\r\n        await op();\r\n      }\r\n\r\n      this.runningOperations = false;\r\n    }\r\n  },\r\n  _deleteAllTasks() {\r\n    for (const taskComponent of this._internal.activeTasks) {\r\n      this.nodeScope.deleteNode(taskComponent);\r\n    }\r\n    this._internal.activeTasks.clear();\r\n  },\r\n  _onNodeDeleted: function () {\r\n    Node.prototype._onNodeDeleted.call(this);\r\n    this._deleteAllTasks();\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  node: RunTasksDefinition\r\n};\r\n","const JavascriptNodeParser = require('../../javascriptnodeparser');\r\nconst { logJavaScriptNodeError } = require('../../utils');\r\n\r\nconst SimpleJavascriptNode = {\r\n  name: 'JavaScriptFunction',\r\n  displayNodeName: 'Function',\r\n  docs: 'https://docs.noodl.net/nodes/javascript/function',\r\n  category: 'CustomCode',\r\n  color: 'javascript',\r\n  nodeDoubleClickAction: {\r\n    focusPort: 'Script'\r\n  },\r\n  searchTags: ['javascript'],\r\n  exportDynamicPorts: true,\r\n  initialize: function () {\r\n    this._internal.inputValues = {};\r\n    this._internal.outputValues = {};\r\n\r\n    this._internal.outputValuesProxy = new Proxy(this._internal.outputValues, {\r\n      set: (obj, prop, value) => {\r\n        //a function node can continue running after it has been deleted. E.g. with timeouts or event listeners that hasn't been removed.\r\n        //if the node is deleted, just do nothing\r\n        if (this._deleted) {\r\n          return;\r\n        }\r\n\r\n        //only send outputs when they change.\r\n        //Some Noodl projects rely on this behavior, so changing it breaks backwards compability\r\n        if (value !== this._internal.outputValues[prop]) {\r\n          this.registerOutputIfNeeded('out-' + prop);\r\n\r\n          this._internal.outputValues[prop] = value;\r\n          this.flagOutputDirty('out-' + prop);\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n\r\n    this._internal._this = {};\r\n  },\r\n  getInspectInfo() {\r\n    return [\r\n      {\r\n        type: 'value',\r\n        value: {\r\n          inputs: this._internal.inputValues,\r\n          outputs: this._internal.outputValues\r\n        }\r\n      }\r\n    ];\r\n  },\r\n  inputs: {\r\n    scriptInputs: {\r\n      type: {\r\n        name: 'proplist',\r\n        allowEditOnly: true\r\n      },\r\n      group: 'Script Inputs',\r\n      set(value) {\r\n        //  ignore\r\n      }\r\n    },\r\n    scriptOutputs: {\r\n      type: {\r\n        name: 'proplist',\r\n        allowEditOnly: true\r\n      },\r\n      group: 'Script Outputs',\r\n      set(value) {\r\n        //  ignore\r\n      }\r\n    },\r\n    functionScript: {\r\n      displayName: 'Script',\r\n      plug: 'input',\r\n      type: {\r\n        name: 'string',\r\n        allowEditOnly: true,\r\n        codeeditor: 'javascript'\r\n      },\r\n      group: 'General',\r\n      set(script) {\r\n        if (script === undefined) {\r\n          this._internal.func = undefined;\r\n          return;\r\n        }\r\n\r\n        this._internal.func = this.parseScript(script);\r\n\r\n        if (!this.isInputConnected('run')) this.scheduleRun();\r\n      }\r\n    },\r\n    run: {\r\n      type: 'signal',\r\n      displayName: 'Run',\r\n      group: 'Actions',\r\n      valueChangedToTrue: function () {\r\n        this.scheduleRun();\r\n      }\r\n    }\r\n  },\r\n  outputs: {},\r\n  methods: {\r\n    scheduleRun: function () {\r\n      if (this.runScheduled) return;\r\n      this.runScheduled = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        this.runScheduled = false;\r\n\r\n        if (!this._deleted) {\r\n          this.runScript();\r\n        }\r\n      });\r\n    },\r\n    runScript: async function () {\r\n      const func = this._internal.func;\r\n\r\n      if (func === undefined) return;\r\n\r\n      const inputs = this._internal.inputValues;\r\n      const outputs = this._internal.outputValuesProxy;\r\n\r\n      // Prepare send signal functions\r\n      for (const key in this.model.outputPorts) {\r\n        if (this._isSignalType(key)) {\r\n          const _sendSignal = () => {\r\n            if (this.hasOutput(key)) this.sendSignalOnOutput(key);\r\n          };\r\n          this._internal.outputValues[key.substring('out-'.length)] = _sendSignal;\r\n          this._internal.outputValues[key.substring('out-'.length)].send = _sendSignal;\r\n        }\r\n      }\r\n\r\n      try {\r\n        await func.apply(this._internal._this, [\r\n          inputs,\r\n          outputs,\r\n          JavascriptNodeParser.createNoodlAPI(this.nodeScope.modelScope),\r\n          JavascriptNodeParser.getComponentScopeForNode(this)\r\n        ]);\r\n      } catch (e) {\r\n        logJavaScriptNodeError(e);\r\n\r\n        if (this.context.editorConnection && this.context.isWarningTypeEnabled('javascriptExecution')) {\r\n          this.context.editorConnection.sendWarning(\r\n            this.nodeScope.componentOwner.name,\r\n            this.id,\r\n            'js-function-run-waring',\r\n            {\r\n              showGlobally: true,\r\n              message: e.message,\r\n              stack: e.stack\r\n            }\r\n          );\r\n        }\r\n      }\r\n    },\r\n    setScriptInputValue: function (name, value) {\r\n      this._internal.inputValues[name] = value;\r\n\r\n      if (!this.isInputConnected('run')) this.scheduleRun();\r\n    },\r\n    getScriptOutputValue: function (name) {\r\n      if (this._isSignalType(name)) {\r\n        return undefined;\r\n      }\r\n      return this._internal.outputValues[name];\r\n    },\r\n    setScriptInputType: function (name, type) {\r\n      this._internal.inputTypes[name] = type;\r\n    },\r\n    setScriptOutputType: function (name, type) {\r\n      this._internal.outputTypes[name] = type;\r\n    },\r\n    parseScript: function (script) {\r\n      var func;\r\n      try {\r\n        const AsyncFunction = Object.getPrototypeOf(async function () {}).constructor;\r\n        func = new AsyncFunction(\r\n          'Inputs',\r\n          'Outputs',\r\n          'Noodl',\r\n          'Component',\r\n          JavascriptNodeParser.getCodePrefix() + script\r\n        );\r\n      } catch (e) {\r\n        console.log('Error while parsing action script: ' + e);\r\n      }\r\n\r\n      return func;\r\n    },\r\n    _isSignalType: function (name) {\r\n      // This will catch signals in script that may not have been delivered by the editor yet\r\n      return this.model.outputPorts[name] && this.model.outputPorts[name].type === 'signal';\r\n    },\r\n    registerInputIfNeeded: function (name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('in-')) {\r\n        const n = name.substring('in-'.length);\r\n\r\n        const input = {\r\n          set: this.setScriptInputValue.bind(this, n)\r\n        };\r\n\r\n        //make sure we register the type as well, so Noodl resolves types like color styles to an actual color\r\n        if (this.model && this.model.parameters['intype-' + n]) {\r\n          input.type = this.model.parameters['intype-' + n];\r\n        }\r\n\r\n        this.registerInput(name, input);\r\n      }\r\n\r\n      if (name.startsWith('intype-')) {\r\n        const n = name.substring('intype-'.length);\r\n\r\n        this.registerInput(name, {\r\n          set(value) {\r\n            //make sure we register the type as well, so Noodl resolves types like color styles to an actual color\r\n            if (this.hasInput('in' + n)) {\r\n              this.getInput('in' + n).type = value;\r\n            }\r\n          }\r\n        });\r\n      }\r\n\r\n      if (name.startsWith('outtype-')) {\r\n        this.registerInput(name, {\r\n          set() {} // Ignore\r\n        });\r\n      }\r\n    },\r\n    registerOutputIfNeeded: function (name) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('out-'))\r\n        return this.registerOutput(name, {\r\n          getter: this.getScriptOutputValue.bind(this, name.substring('out-'.length))\r\n        });\r\n    }\r\n  }\r\n};\r\n\r\nfunction _parseScriptForErrorsAndPorts(script, name, node, context, ports) {\r\n  // Clear run warnings if the script is edited\r\n  context.editorConnection.clearWarning(node.component.name, node.id, 'js-function-run-waring');\r\n\r\n  if (script === undefined) {\r\n    context.editorConnection.clearWarning(node.component.name, node.id, 'js-function-parse-waring');\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const AsyncFunction = Object.getPrototypeOf(async function () {}).constructor;\r\n    new AsyncFunction('Inputs', 'Outputs', 'Noodl', 'Component', script);\r\n\r\n    context.editorConnection.clearWarning(node.component.name, node.id, 'js-function-parse-waring');\r\n  } catch (e) {\r\n    context.editorConnection.sendWarning(node.component.name, node.id, 'js-function-parse-waring', {\r\n      showGlobally: true,\r\n      message: e.message\r\n    });\r\n  }\r\n\r\n  JavascriptNodeParser.parseAndAddPortsFromScript(script, ports, {\r\n    inputPrefix: 'in-',\r\n    outputPrefix: 'out-'\r\n  });\r\n}\r\n\r\nconst inputTypeEnums = [\r\n  {\r\n    value: 'string',\r\n    label: 'String'\r\n  },\r\n  {\r\n    value: 'boolean',\r\n    label: 'Boolean'\r\n  },\r\n  {\r\n    value: 'number',\r\n    label: 'Number'\r\n  },\r\n  {\r\n    value: 'object',\r\n    label: 'Object'\r\n  },\r\n  {\r\n    value: 'date',\r\n    label: 'Date'\r\n  },\r\n  {\r\n    value: 'array',\r\n    label: 'Array'\r\n  },\r\n  {\r\n    value: 'color',\r\n    label: 'Color'\r\n  }\r\n];\r\n\r\nmodule.exports = {\r\n  node: SimpleJavascriptNode,\r\n  setup: function (context, graphModel) {\r\n    if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n      return;\r\n    }\r\n\r\n    function _managePortsForNode(node) {\r\n      function _updatePorts() {\r\n        var ports = [];\r\n\r\n        const _outputTypeEnums = inputTypeEnums.concat([\r\n          {\r\n            value: 'signal',\r\n            label: 'Signal'\r\n          }\r\n        ]);\r\n\r\n        // Outputs\r\n        if (node.parameters['scriptOutputs'] !== undefined && node.parameters['scriptOutputs'].length > 0) {\r\n          node.parameters['scriptOutputs'].forEach((p) => {\r\n            // Type for output\r\n            ports.push({\r\n              name: 'outtype-' + p.label,\r\n              displayName: 'Type',\r\n              editorName: p.label + ' | Type',\r\n              plug: 'input',\r\n              type: {\r\n                name: 'enum',\r\n                enums: _outputTypeEnums,\r\n                allowEditOnly: true\r\n              },\r\n              default: 'string',\r\n              parent: 'scriptOutputs',\r\n              parentItemId: p.id\r\n            });\r\n\r\n            // Value for output\r\n            ports.push({\r\n              name: 'out-' + p.label,\r\n              displayName: p.label,\r\n              plug: 'output',\r\n              type: node.parameters['outtype-' + p.label] || '*',\r\n              group: 'Outputs'\r\n            });\r\n          });\r\n        }\r\n\r\n        // Inputs\r\n        if (node.parameters['scriptInputs'] !== undefined && node.parameters['scriptInputs'].length > 0) {\r\n          node.parameters['scriptInputs'].forEach((p) => {\r\n            // Type for input\r\n            ports.push({\r\n              name: 'intype-' + p.label,\r\n              displayName: 'Type',\r\n              editorName: p.label + ' | Type',\r\n              plug: 'input',\r\n              type: {\r\n                name: 'enum',\r\n                enums: inputTypeEnums,\r\n                allowEditOnly: true\r\n              },\r\n              default: 'string',\r\n              parent: 'scriptInputs',\r\n              parentItemId: p.id\r\n            });\r\n\r\n            // Default Value for input\r\n            ports.push({\r\n              name: 'in-' + p.label,\r\n              displayName: p.label,\r\n              plug: 'input',\r\n              type: node.parameters['intype-' + p.label] || 'string',\r\n              group: 'Inputs'\r\n            });\r\n          });\r\n        }\r\n\r\n        _parseScriptForErrorsAndPorts(node.parameters['functionScript'], 'Script ', node, context, ports);\r\n\r\n        // Push output ports that are signals directly to the model, it's needed by the initial run of\r\n        // the script function\r\n        ports.forEach((p) => {\r\n          if (p.type === 'signal' && p.plug === 'output') {\r\n            node.outputPorts[p.name] = p;\r\n          }\r\n        });\r\n\r\n        context.editorConnection.sendDynamicPorts(node.id, ports);\r\n      }\r\n\r\n      _updatePorts();\r\n      node.on('parameterUpdated', function (ev) {\r\n        _updatePorts();\r\n      });\r\n    }\r\n\r\n    graphModel.on('editorImportComplete', () => {\r\n      graphModel.on('nodeAdded.JavaScriptFunction', function (node) {\r\n        _managePortsForNode(node);\r\n      });\r\n\r\n      for (const node of graphModel.getNodesWithType('JavaScriptFunction')) {\r\n        _managePortsForNode(node);\r\n      }\r\n    });\r\n  }\r\n};\r\n","const StringFormatDefinition = {\n  name: 'String Format',\n  docs: 'https://docs.noodl.net/nodes/string-manipulation/string-format',\n  category: 'String Manipulation',\n  usePortAsLabel: 'format',\n  portLabelTruncationMode: 'length',\n  initialize() {\n    const internal = this._internal;\n    internal.format = '';\n    internal.cachedResult = '';\n    internal.resultDirty = false;\n    internal.inputValues = {};\n  },\n  getInspectInfo() {\n    return this.formatValue();\n  },\n  inputs: {\n    format: {\n      type: { name: 'string', multiline: true },\n      displayName: 'Format',\n      set(value) {\n        if (this._internal.format === value) return;\n\n        this._internal.format = value;\n        this._internal.resultDirty = true;\n        this.scheduleFormat();\n      }\n    }\n  },\n  outputs: {\n    formatted: {\n      type: 'string',\n      displayName: 'Formatted',\n      get() {\n        return this.formatValue();\n      }\n    }\n  },\n  methods: {\n    formatValue() {\n      var internal = this._internal;\n\n      if (internal.resultDirty) {\n        var formatted = internal.format;\n\n        var matches = internal.format.match(/\\{[A-Za-z0-9_]*\\}/g);\n        var inputs = [];\n        if (matches) {\n          inputs = matches.map(function (name) {\n            return name.replace('{', '').replace('}', '');\n          });\n        }\n\n        inputs.forEach(function (name) {\n          var v = internal.inputValues[name];\n          formatted = formatted.replace('{' + name + '}', v !== undefined ? v : '');\n        });\n\n        internal.cachedResult = formatted;\n        internal.resultDirty = false;\n      }\n\n      return internal.cachedResult;\n    },\n    registerInputIfNeeded(name) {\n      if (this.hasInput(name)) {\n        return;\n      }\n\n      this.registerInput(name, {\n        set: userInputSetter.bind(this, name)\n      });\n    },\n    scheduleFormat() {\n      if (this.formatScheduled) return;\n\n      this.formatScheduled = true;\n      this.scheduleAfterInputsHaveUpdated(() => {\n        this.formatValue();\n        this.flagOutputDirty('formatted');\n        this.formatScheduled = false;\n      });\n    }\n  }\n};\n\nfunction userInputSetter(name, value) {\n  /* jshint validthis:true */\n  if (this._internal.inputValues[name] === value) return;\n\n  this._internal.inputValues[name] = value;\n  this._internal.resultDirty = true;\n  this.scheduleFormat();\n}\n\nfunction updatePorts(id, format, editorConnection) {\n  var inputs = format.match(/\\{[A-Za-z0-9_]*\\}/g) || [];\n  var portsNames = inputs.map(function (def) {\n    return def.replace('{', '').replace('}', '');\n  });\n\n  var ports = portsNames\n    //get unique names\n    .filter(function (value, index, self) {\n      return self.indexOf(value) === index;\n    })\n    //and map names to ports\n    .map(function (name) {\n      return {\n        name: name,\n        type: 'string',\n        plug: 'input'\n      };\n    });\n\n  editorConnection.sendDynamicPorts(id, ports);\n}\n\nmodule.exports = {\n  node: StringFormatDefinition,\n  setup: function (context, graphModel) {\n    if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\n      return;\n    }\n\n    graphModel.on('nodeAdded.String Format', function (node) {\n      if (node.parameters.format) {\n        updatePorts(node.id, node.parameters.format, context.editorConnection);\n      }\n      node.on('parameterUpdated', function (event) {\n        if (event.name === 'format') {\n          updatePorts(node.id, node.parameters.format, context.editorConnection);\n        }\n      });\n    });\n  }\n};\n","const StringMapperNode = {\r\n  name: 'String Mapper',\r\n  docs: 'https://docs.noodl.net/nodes/string-manipulation/string-mapper',\r\n  category: 'Utilities',\r\n  initialize: function () {\r\n    this._internal.inputs = [];\r\n    this._internal.mappings = [];\r\n  },\r\n  getInspectInfo() {\r\n    return this._internal.mappedString;\r\n  },\r\n  numberedInputs: {\r\n    input: {\r\n      type: 'string',\r\n      displayPrefix: 'Input',\r\n      group: 'Inputs',\r\n      index: 10,\r\n      createSetter(index) {\r\n        return function (value) {\r\n          value = value === undefined ? '' : value.toString();\r\n          this._internal.inputs[index] = value;\r\n          this.scheduleMapping();\r\n        };\r\n      }\r\n    },\r\n    output: {\r\n      type: 'string',\r\n      displayPrefix: 'Mapping',\r\n      index: 1001,\r\n      group: 'Mappings',\r\n      createSetter(index) {\r\n        return function (value) {\r\n          value = value === undefined ? '' : value.toString();\r\n          this._internal.mappings[index] = value;\r\n          this.scheduleMapping();\r\n        };\r\n      }\r\n    }\r\n  },\r\n  inputs: {\r\n    inputString: {\r\n      type: {\r\n        name: 'string'\r\n      },\r\n      index: 1,\r\n      displayName: 'Input String',\r\n      set: function (value) {\r\n        this._internal.currentInputString = value !== undefined ? value.toString() : undefined;\r\n        this.scheduleMapping();\r\n      }\r\n    },\r\n    defaultMapping: {\r\n      type: 'string',\r\n      displayName: 'Default',\r\n      index: 1000,\r\n      group: 'Mappings',\r\n      set: function (value) {\r\n        this._internal.defaultMapping = value;\r\n        this.scheduleMapping();\r\n      }\r\n    }\r\n  },\r\n  outputs: {\r\n    mappedString: {\r\n      type: 'string',\r\n      displayName: 'Mapped String',\r\n      group: 'Value',\r\n      getter: function () {\r\n        return this._internal.mappedString;\r\n      }\r\n    }\r\n  },\r\n  prototypeExtensions: {\r\n    doMapping: function () {\r\n      this._internal.hasScheduledFetch = false;\r\n      var idx = this._internal.inputs.indexOf(this._internal.currentInputString);\r\n      if (idx !== -1) this._internal.mappedString = this._internal.mappings[idx];\r\n      else this._internal.mappedString = this._internal.defaultMapping;\r\n\r\n      this.flagOutputDirty('mappedString');\r\n    },\r\n    scheduleMapping: function () {\r\n      var internal = this._internal;\r\n      if (!internal.hasScheduledFetch) {\r\n        internal.hasScheduledFetch = true;\r\n        this.scheduleAfterInputsHaveUpdated(this.doMapping.bind(this));\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  node: StringMapperNode\r\n};\r\n","'use strict';\r\n\r\nconst SubStringNode = {\r\n  name: 'Substring',\r\n  docs: 'https://docs.noodl.net/nodes/string-manipulation/substring',\r\n  category: 'String Manipulation',\r\n  initialize: function () {\r\n    var internal = this._internal;\r\n    internal.startIndex = 0;\r\n    internal.endIndex = -1;\r\n    internal.cachedResult = '';\r\n    internal.inputString = '';\r\n    internal.resultDirty = false;\r\n  },\r\n  inputs: {\r\n    start: {\r\n      type: 'number',\r\n      displayName: 'Start',\r\n      default: 0,\r\n      set: function (value) {\r\n        this._internal.startIndex = value;\r\n        this._internal.resultDirty = true;\r\n        this.flagOutputDirty('result');\r\n      }\r\n    },\r\n    end: {\r\n      type: 'number',\r\n      displayName: 'End',\r\n      default: 0,\r\n      set: function (value) {\r\n        this._internal.endIndex = value;\r\n        this._internal.resultDirty = true;\r\n        this.flagOutputDirty('result');\r\n      }\r\n    },\r\n    string: {\r\n      type: {\r\n        name: 'string'\r\n      },\r\n      displayName: 'String',\r\n      default: '',\r\n      set: function (value) {\r\n        value = value.toString();\r\n        this._internal.inputString = value;\r\n        this._internal.resultDirty = true;\r\n        this.flagOutputDirty('result');\r\n      }\r\n    }\r\n  },\r\n  outputs: {\r\n    result: {\r\n      type: 'string',\r\n      displayName: 'Result',\r\n      getter: function () {\r\n        var internal = this._internal;\r\n\r\n        if (internal.resultDirty) {\r\n          if (internal.endIndex === -1) {\r\n            internal.cachedResult = internal.inputString.substr(internal.startIndex);\r\n          } else {\r\n            internal.cachedResult = internal.inputString.substr(\r\n              internal.startIndex,\r\n              internal.endIndex - internal.startIndex\r\n            );\r\n          }\r\n          internal.resultDirty = false;\r\n        }\r\n        return internal.cachedResult;\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  node: SubStringNode\r\n};\r\n","'use strict';\r\n\r\nconst Model = require('../../model');\r\n\r\nconst UniqueIdNode = {\r\n  name: 'Unique Id',\r\n  docs: 'https://docs.noodl.net/nodes/utilities/unique-id',\r\n  category: 'String Manipulation',\r\n  initialize: function () {\r\n    var internal = this._internal;\r\n    internal.guid = Model.guid();\r\n  },\r\n  getInspectInfo() {\r\n    return this._internal.guid;\r\n  },\r\n  inputs: {\r\n    new: {\r\n      displayName: 'New',\r\n      valueChangedToTrue: function () {\r\n        var internal = this._internal;\r\n        internal.guid = Model.guid();\r\n        this.flagOutputDirty('guid');\r\n      }\r\n    }\r\n  },\r\n  outputs: {\r\n    guid: {\r\n      type: 'string',\r\n      displayName: 'Id',\r\n      getter: function () {\r\n        var internal = this._internal;\r\n        return internal.guid;\r\n      }\r\n    }\r\n  },\r\n  prototypeExtensions: {}\r\n};\r\n\r\nmodule.exports = {\r\n  node: UniqueIdNode\r\n};\r\n","'use strict';\r\n\r\nconst NoodlRuntime = require('../../../../noodl-runtime');\r\n\r\nvar SetUserPropertiesNodeDefinition = {\r\n  name: 'net.noodl.user.SetUserProperties',\r\n  docs: 'https://docs.noodl.net/nodes/data/user/set-user-properties',\r\n  displayNodeName: 'Set User Properties',\r\n  category: 'Cloud Services',\r\n  color: 'data',\r\n  initialize: function () {\r\n    var internal = this._internal;\r\n\r\n    internal.userProperties = {};\r\n  },\r\n  getInspectInfo() {},\r\n  outputs: {\r\n    success: {\r\n      type: 'signal',\r\n      displayName: 'Success',\r\n      group: 'Events'\r\n    },\r\n    failure: {\r\n      type: 'signal',\r\n      displayName: 'Failure',\r\n      group: 'Events'\r\n    },\r\n    error: {\r\n      type: 'string',\r\n      displayName: 'Error',\r\n      group: 'Error',\r\n      getter: function () {\r\n        return this._internal.error;\r\n      }\r\n    }\r\n  },\r\n  inputs: {\r\n    store: {\r\n      displayName: 'Do',\r\n      group: 'Actions',\r\n      valueChangedToTrue: function () {\r\n        this.scheduleStore();\r\n      }\r\n    },\r\n    email: {\r\n      displayName: 'Email',\r\n      type: 'string',\r\n      group: 'General',\r\n      set: function (value) {\r\n        this._internal.email = value;\r\n      }\r\n    },\r\n    username: {\r\n      displayName: 'Username',\r\n      type: 'string',\r\n      group: 'General',\r\n      set: function (value) {\r\n        this._internal.username = value;\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    setError: function (err) {\r\n      this._internal.error = err;\r\n      this.flagOutputDirty('error');\r\n      this.sendSignalOnOutput('failure');\r\n\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'user-set-warning', {\r\n          message: err,\r\n          showGlobally: true\r\n        });\r\n      }\r\n    },\r\n    clearWarnings() {\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, 'user-set-warning');\r\n      }\r\n    },\r\n    scheduleStore: function () {\r\n      const internal = this._internal;\r\n\r\n      if (this.storeScheduled === true) return;\r\n      this.storeScheduled = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        this.storeScheduled = false;\r\n\r\n        const UserService = NoodlRuntime.Services.UserService;\r\n        UserService.forScope(this.nodeScope.modelScope).setUserProperties({\r\n          email: this._internal.email,\r\n          username: this._internal.username,\r\n          properties: internal.userProperties,\r\n          success: () => {\r\n            this.sendSignalOnOutput('success');\r\n          },\r\n          error: (e) => {\r\n            this.setError(e);\r\n          }\r\n        });\r\n      });\r\n    },\r\n    setUserProperty: function (name, value) {\r\n      this._internal.userProperties[name] = value;\r\n    },\r\n    registerInputIfNeeded: function (name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('prop-'))\r\n        return this.registerInput(name, {\r\n          set: this.setUserProperty.bind(this, name.substring('prop-'.length))\r\n        });\r\n    }\r\n  }\r\n};\r\n\r\nfunction updatePorts(nodeId, parameters, editorConnection, systemCollections) {\r\n  var ports = [];\r\n\r\n  if (systemCollections) {\r\n    // Fetch ports from collection keys\r\n    var c = systemCollections.find((c) => c.name === '_User');\r\n    if (c && c.schema && c.schema.properties) {\r\n      var props = c.schema.properties;\r\n\r\n      const _ignoreKeys =\r\n        typeof _noodl_cloud_runtime_version === 'undefined'\r\n          ? ['authData', 'createdAt', 'updatedAt', 'email', 'username', 'emailVerified', 'password']\r\n          : ['authData', 'createdAt', 'updatedAt', 'email', 'username'];\r\n\r\n      for (var key in props) {\r\n        if (_ignoreKeys.indexOf(key) !== -1) continue;\r\n\r\n        var p = props[key];\r\n        if (ports.find((_p) => _p.name === key)) continue;\r\n\r\n        if (p.type === 'Relation') {\r\n        } else {\r\n          // Other schema type ports\r\n          const _typeMap = {\r\n            String: 'string',\r\n            Boolean: 'boolean',\r\n            Number: 'number',\r\n            Date: 'date'\r\n          };\r\n\r\n          ports.push({\r\n            type: {\r\n              name: _typeMap[p.type] ? _typeMap[p.type] : '*'\r\n            },\r\n            plug: 'input',\r\n            group: 'Properties',\r\n            name: 'prop-' + key,\r\n            displayName: key\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nmodule.exports = {\r\n  node: SetUserPropertiesNodeDefinition,\r\n  setup: function (context, graphModel) {\r\n    if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n      return;\r\n    }\r\n\r\n    function _managePortsForNode(node) {\r\n      updatePorts(node.id, node.parameters, context.editorConnection, graphModel.getMetaData('systemCollections'));\r\n\r\n      node.on('parameterUpdated', function (event) {\r\n        updatePorts(node.id, node.parameters, context.editorConnection, graphModel.getMetaData('systemCollections'));\r\n      });\r\n\r\n      graphModel.on('metadataChanged.systemCollections', function (data) {\r\n        updatePorts(node.id, node.parameters, context.editorConnection, data);\r\n      });\r\n    }\r\n\r\n    graphModel.on('editorImportComplete', () => {\r\n      graphModel.on('nodeAdded.net.noodl.user.SetUserProperties', function (node) {\r\n        _managePortsForNode(node);\r\n      });\r\n\r\n      for (const node of graphModel.getNodesWithType('net.noodl.user.SetUserProperties')) {\r\n        _managePortsForNode(node);\r\n      }\r\n    });\r\n  }\r\n};\r\n","'use strict';\r\n\r\nconst NoodlRuntime = require('../../../../noodl-runtime');\r\nconst { Node } = require('../../../../noodl-runtime');\r\n\r\nvar UserNodeDefinition = {\r\n  name: 'net.noodl.user.User',\r\n  docs: 'https://docs.noodl.net/nodes/data/user/user-node',\r\n  displayNodeName: 'User',\r\n  category: 'Cloud Services',\r\n  color: 'data',\r\n  initialize: function () {\r\n    var _this = this;\r\n    this._internal.onModelChangedCallback = function (args) {\r\n      if (_this.isInputConnected('fetch')) return;\r\n\r\n      if (_this.hasOutput('prop-' + args.name)) _this.flagOutputDirty('prop-' + args.name);\r\n\r\n      if (_this.hasOutput('changed-' + args.name)) _this.sendSignalOnOutput('changed-' + args.name);\r\n\r\n      _this.sendSignalOnOutput('changed');\r\n    };\r\n\r\n    const userService = NoodlRuntime.Services.UserService.forScope(this.nodeScope.modelScope);\r\n\r\n    this.setUserModel(userService.current);\r\n    userService.on('loggedIn', () => {\r\n      this.setUserModel(userService.current);\r\n\r\n      if (this.hasOutput('loggedIn')) this.sendSignalOnOutput('loggedIn');\r\n    });\r\n\r\n    userService.on('sessionGained', () => {\r\n      this.setUserModel(userService.current);\r\n    });\r\n\r\n    userService.on('loggedOut', () => {\r\n      this.setUserModel(undefined);\r\n      if (this.hasOutput('loggedOut')) this.sendSignalOnOutput('loggedOut');\r\n    });\r\n\r\n    userService.on('sessionLost', () => {\r\n      this.setUserModel(undefined);\r\n      if (this.hasOutput('sessionLost')) this.sendSignalOnOutput('sessionLost');\r\n    });\r\n  },\r\n  getInspectInfo() {\r\n    const model = this._internal.model;\r\n    if (!model) return '[No Model]';\r\n\r\n    return [\r\n      { type: 'text', value: 'Id: ' + model.getId() },\r\n      { type: 'value', value: this._internal.model.data }\r\n    ];\r\n  },\r\n  outputs: {\r\n    id: {\r\n      type: 'string',\r\n      displayName: 'Id',\r\n      group: 'General',\r\n      getter: function () {\r\n        return this._internal.model !== undefined ? this._internal.model.getId() : undefined;\r\n      }\r\n    },\r\n    fetched: {\r\n      type: 'signal',\r\n      displayName: 'Fetched',\r\n      group: 'Events'\r\n    },\r\n    changed: {\r\n      type: 'signal',\r\n      displayName: 'Changed',\r\n      group: 'Events'\r\n    },\r\n    failure: {\r\n      type: 'signal',\r\n      displayName: 'Failure',\r\n      group: 'Events'\r\n    },\r\n    error: {\r\n      type: 'string',\r\n      displayName: 'Error',\r\n      group: 'Error',\r\n      getter: function () {\r\n        return this._internal.error;\r\n      }\r\n    },\r\n    username: {\r\n      type: 'string',\r\n      displayName: 'Username',\r\n      group: 'General',\r\n      getter: function () {\r\n        return this._internal.model !== undefined ? this._internal.model.get('username') : undefined;\r\n      }\r\n    },\r\n    email: {\r\n      type: 'string',\r\n      displayName: 'Email',\r\n      group: 'General',\r\n      getter: function () {\r\n        return this._internal.model !== undefined ? this._internal.model.get('email') : undefined;\r\n      }\r\n    },\r\n    authenticated: {\r\n      type: 'boolean',\r\n      displayName: 'Authenticated',\r\n      group: 'General',\r\n      getter: function () {\r\n        return this._internal.model !== undefined;\r\n      }\r\n    }\r\n    /*    loggedIn:{\r\n            type:'signal',\r\n            displayName:'Logged In',\r\n            group:'Events'\r\n        },\r\n        loggedOut:{\r\n            type:'signal',\r\n            displayName:'Logged Out',\r\n            group:'Events'\r\n        },\r\n        sessionLost:{\r\n            type:'signal',\r\n            displayName:'Session Lost',\r\n            group:'Events'\r\n        },         */\r\n  },\r\n  inputs: {\r\n    fetch: {\r\n      displayName: 'Fetch',\r\n      group: 'Actions',\r\n      valueChangedToTrue: function () {\r\n        this.scheduleFetch();\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    _onNodeDeleted: function () {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      if (this._internal.model) this._internal.model.off('change', this._internal.onModelChangedCallback);\r\n    },\r\n    scheduleOnce: function (type, cb) {\r\n      const _this = this;\r\n      const _type = 'hasScheduled' + type;\r\n      if (this._internal[_type]) return;\r\n      this._internal[_type] = true;\r\n      this.scheduleAfterInputsHaveUpdated(function () {\r\n        _this._internal[_type] = false;\r\n        cb();\r\n      });\r\n    },\r\n    setError: function (err) {\r\n      this._internal.error = err;\r\n      this.flagOutputDirty('error');\r\n      this.sendSignalOnOutput('failure');\r\n\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'user-warning', {\r\n          message: err,\r\n          showGlobally: true\r\n        });\r\n      }\r\n    },\r\n    clearWarnings() {\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, 'user-warning');\r\n      }\r\n    },\r\n    setUserModel(model) {\r\n      const internal = this._internal;\r\n\r\n      if (internal.model !== model) {\r\n        // Check if we need to change model\r\n        if (internal.model)\r\n          // Remove old listener if existing\r\n          internal.model.off('change', internal.onModelChangedCallback);\r\n\r\n        internal.model = model;\r\n        if (model) model.on('change', internal.onModelChangedCallback);\r\n      }\r\n      this.flagOutputDirty('id');\r\n      this.flagOutputDirty('authenticated');\r\n      this.flagOutputDirty('email');\r\n      this.flagOutputDirty('username');\r\n\r\n      // Notify all properties changed\r\n      if (model)\r\n        for (var key in model.data) {\r\n          if (this.hasOutput('prop-' + key)) this.flagOutputDirty('prop-' + key);\r\n        }\r\n    },\r\n    scheduleFetch: function () {\r\n      const internal = this._internal;\r\n\r\n      this.scheduleOnce('Fetch', () => {\r\n        const userService = NoodlRuntime.Services.UserService.forScope(this.nodeScope.modelScope);\r\n        userService.fetchCurrentUser({\r\n          success: (response) => {\r\n            this.setUserModel(userService.current);\r\n\r\n            this.sendSignalOnOutput('fetched');\r\n          },\r\n          error: (err) => {\r\n            this.setError(err || 'Failed to fetch.');\r\n          }\r\n        });\r\n      });\r\n    },\r\n    registerOutputIfNeeded: function (name) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === 'loggedOut' || name === 'loggedIn' || name === 'sessionLost') {\r\n        this.registerOutput(name, {\r\n          getter: () => {} /* No getter needed, signal */\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('prop-'))\r\n        this.registerOutput(name, {\r\n          getter: this.getUserProperty.bind(this, name.substring('prop-'.length))\r\n        });\r\n    },\r\n    getUserProperty: function (name) {\r\n      return this._internal.model !== undefined ? this._internal.model.get(name) : undefined;\r\n    }\r\n  }\r\n};\r\n\r\nfunction updatePorts(nodeId, parameters, editorConnection, systemCollections) {\r\n  var ports = [];\r\n\r\n  if (systemCollections) {\r\n    // Fetch ports from collection keys\r\n    var c = systemCollections.find((c) => c.name === '_User');\r\n    if (c && c.schema && c.schema.properties) {\r\n      var props = c.schema.properties;\r\n      const _ignoreKeys = ['authData', 'password', 'username', 'email'];\r\n      for (var key in props) {\r\n        if (_ignoreKeys.indexOf(key) !== -1) continue;\r\n\r\n        var p = props[key];\r\n        if (ports.find((_p) => _p.name === key)) continue;\r\n\r\n        if (p.type === 'Relation') {\r\n        } else {\r\n          // Other schema type ports\r\n          const _typeMap = {\r\n            String: 'string',\r\n            Boolean: 'boolean',\r\n            Number: 'number',\r\n            Date: 'date'\r\n          };\r\n\r\n          ports.push({\r\n            type: {\r\n              name: _typeMap[p.type] ? _typeMap[p.type] : '*'\r\n            },\r\n            plug: 'output',\r\n            group: 'Properties',\r\n            name: 'prop-' + key,\r\n            displayName: key\r\n          });\r\n\r\n          ports.push({\r\n            type: 'signal',\r\n            plug: 'output',\r\n            group: 'Changed Events',\r\n            displayName: key + ' Changed',\r\n            name: 'changed-' + key\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  if (typeof _noodl_cloud_runtime_version === 'undefined') {\r\n    // On the client we have some extra outputs\r\n    ports.push({\r\n      plug: 'output',\r\n      name: 'loggedIn',\r\n      type: 'signal',\r\n      displayName: 'Logged In',\r\n      group: 'Events'\r\n    });\r\n\r\n    ports.push({\r\n      plug: 'output',\r\n      name: 'loggedOut',\r\n      type: 'signal',\r\n      displayName: 'Logged Out',\r\n      group: 'Events'\r\n    });\r\n\r\n    ports.push({\r\n      plug: 'output',\r\n      name: 'sessionLost',\r\n      type: 'signal',\r\n      displayName: 'Session Lost',\r\n      group: 'Events'\r\n    });\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nmodule.exports = {\r\n  node: UserNodeDefinition,\r\n  setup: function (context, graphModel) {\r\n    if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n      return;\r\n    }\r\n\r\n    function _managePortsForNode(node) {\r\n      updatePorts(node.id, node.parameters, context.editorConnection, graphModel.getMetaData('systemCollections'));\r\n\r\n      node.on('parameterUpdated', function (event) {\r\n        updatePorts(node.id, node.parameters, context.editorConnection, graphModel.getMetaData('systemCollections'));\r\n      });\r\n\r\n      graphModel.on('metadataChanged.systemCollections', function (data) {\r\n        updatePorts(node.id, node.parameters, context.editorConnection, data);\r\n      });\r\n    }\r\n\r\n    graphModel.on('editorImportComplete', () => {\r\n      graphModel.on('nodeAdded.net.noodl.user.User', function (node) {\r\n        _managePortsForNode(node);\r\n      });\r\n\r\n      for (const node of graphModel.getNodesWithType('net.noodl.user.User')) {\r\n        _managePortsForNode(node);\r\n      }\r\n    });\r\n  }\r\n};\r\n","'use strict';\r\n\r\nconst VariableBase = require('./variablebase');\r\n\r\nconst BooleanNode = VariableBase.createDefinition({\r\n  name: 'Boolean',\r\n  docs: 'https://docs.noodl.net/nodes/data/boolean',\r\n  startValue: false,\r\n  type: {\r\n    name: 'boolean'\r\n  },\r\n  cast: function (value) {\r\n    return Boolean(value);\r\n  }\r\n});\r\n\r\nmodule.exports = {\r\n  node: BooleanNode\r\n};\r\n","'use strict';\r\n\r\nconst VariableBase = require('./variablebase');\r\n\r\nconst NumberNode = VariableBase.createDefinition({\r\n  name: 'Number',\r\n  docs: 'https://docs.noodl.net/nodes/data/number',\r\n  startValue: 0,\r\n  nodeDoubleClickAction: {\r\n    focusPort: 'value'\r\n  },\r\n  type: {\r\n    name: 'number'\r\n  },\r\n  cast: function (value) {\r\n    return Number(value);\r\n  }\r\n});\r\n\r\nmodule.exports = {\r\n  node: NumberNode\r\n};\r\n","'use strict';\r\n\r\nconst VariableBase = require('./variablebase');\r\nconst { NodeDefinition } = require('../../../../noodl-runtime');\r\n\r\nconst StringNode = VariableBase.createDefinition({\r\n  name: 'String',\r\n  docs: 'https://docs.noodl.net/nodes/data/string',\r\n  shortDesc: 'Contains a string (text).',\r\n  startValue: '',\r\n  nodeDoubleClickAction: {\r\n    focusPort: 'value'\r\n  },\r\n  type: {\r\n    name: 'string'\r\n  },\r\n  cast: function (value) {\r\n    return String(value);\r\n  },\r\n  onChanged: function () {\r\n    this.flagOutputDirty('length');\r\n  }\r\n});\r\n\r\nNodeDefinition.extend(StringNode, {\r\n  usePortAsLabel: 'value',\r\n  portLabelTruncationMode: 'length',\r\n  outputs: {\r\n    length: {\r\n      type: 'number',\r\n      displayName: 'Length',\r\n      getter: function () {\r\n        return this._internal.currentValue.length;\r\n      }\r\n    }\r\n  }\r\n});\r\n\r\nmodule.exports = {\r\n  node: StringNode\r\n};\r\n","'use strict';\r\n\r\nfunction createDefinition(args) {\r\n  return {\r\n    name: args.name,\r\n    docs: args.docs,\r\n    shortDesc: args.shortDesc,\r\n    nodeDoubleClickAction: args.nodeDoubleClickAction,\r\n    category: 'Variables',\r\n    initialize: function () {\r\n      this._internal.currentValue = args.startValue;\r\n      this._internal.latestValue = 0;\r\n    },\r\n    getInspectInfo() {\r\n      const type = args.type.name === 'color' ? 'color' : 'text';\r\n      return [{ type, value: this._internal.currentValue }];\r\n    },\r\n    inputs: {\r\n      value: {\r\n        type: args.type,\r\n        displayName: 'Value',\r\n        default: args.startValue,\r\n        set: function (value) {\r\n          if (this.isInputConnected('saveValue') === false) {\r\n            this.setValueTo(value);\r\n          } else {\r\n            this._internal.latestValue = value;\r\n          }\r\n        }\r\n      },\r\n      saveValue: {\r\n        displayName: 'Set',\r\n        valueChangedToTrue: function () {\r\n          this.scheduleAfterInputsHaveUpdated(function () {\r\n            this.setValueTo(this._internal.latestValue);\r\n            this.sendSignalOnOutput('stored');\r\n          });\r\n        }\r\n      }\r\n    },\r\n    outputs: {\r\n      savedValue: {\r\n        type: args.type.name,\r\n        displayName: 'Value',\r\n        getter: function () {\r\n          return this._internal.currentValue;\r\n        }\r\n      },\r\n      changed: {\r\n        type: 'signal',\r\n        displayName: 'Changed'\r\n      },\r\n      stored: {\r\n        type: 'signal',\r\n        displayName: 'Stored'\r\n      }\r\n    },\r\n    prototypeExtensions: {\r\n      setValueTo: function (value) {\r\n        value = args.cast(value);\r\n        const changed = this._internal.currentValue !== value;\r\n        this._internal.currentValue = value;\r\n\r\n        if (changed) {\r\n          this.flagOutputDirty('savedValue');\r\n          this.sendSignalOnOutput('changed');\r\n          args.onChanged && args.onChanged.call(this);\r\n        }\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nmodule.exports = {\r\n  createDefinition: createDefinition\r\n};\r\n","'use strict';\r\n\r\nconst guid = require('./guid');\r\n\r\nfunction NodeScope(context, componentOwner) {\r\n  this.context = context;\r\n  this.nodes = {};\r\n  this.componentOwner = componentOwner; //Component Instance that owns this NodeScope\r\n  this.componentInstanceChildren = {};\r\n}\r\n\r\nfunction verifyData(data, requiredKeys) {\r\n  requiredKeys.forEach(function (key) {\r\n    if (!data[key]) {\r\n      throw new Error('Missing ' + key);\r\n    }\r\n  });\r\n}\r\n\r\nNodeScope.prototype.addConnection = function (connectionData) {\r\n  try {\r\n    verifyData(connectionData, ['sourceId', 'sourcePort', 'targetId', 'targetPort']);\r\n  } catch (e) {\r\n    throw new Error('Error in connection: ' + e.message);\r\n  }\r\n\r\n  try {\r\n    var sourceNode = this.getNodeWithId(connectionData.sourceId),\r\n      targetNode = this.getNodeWithId(connectionData.targetId);\r\n\r\n    targetNode.registerInputIfNeeded(connectionData.targetPort);\r\n    sourceNode.registerOutputIfNeeded(connectionData.sourcePort);\r\n    targetNode.connectInput(connectionData.targetPort, sourceNode, connectionData.sourcePort);\r\n  } catch (e) {\r\n    console.error(e.message);\r\n  }\r\n};\r\n\r\nNodeScope.prototype.setNodeParameters = function (node, nodeModel) {\r\n  const variant = this.context.variants.getVariant(nodeModel.type, nodeModel.variant);\r\n\r\n  if (variant) {\r\n    //apply the variant (this will also apply the parameters)\r\n    node.setVariant(variant);\r\n  } else {\r\n    const parameters = nodeModel.parameters;\r\n\r\n    var inputNames = Object.keys(parameters);\r\n\r\n    if (this.context.nodeRegister.hasNode(node.name)) {\r\n      var metadata = this.context.nodeRegister.getNodeMetadata(node.name);\r\n      inputNames.sort(function (a, b) {\r\n        var inputA = metadata.inputs[a];\r\n        var inputB = metadata.inputs[b];\r\n        return (inputB ? inputB.inputPriority : 0) - (inputA ? inputA.inputPriority : 0);\r\n      });\r\n    }\r\n\r\n    inputNames.forEach((inputName) => {\r\n      node.registerInputIfNeeded(inputName);\r\n\r\n      //protect against obsolete parameters\r\n      if (node.hasInput(inputName) === false) {\r\n        return;\r\n      }\r\n\r\n      node.queueInput(inputName, parameters[inputName]);\r\n    });\r\n  }\r\n};\r\n\r\nNodeScope.prototype.createNodeFromModel = async function (nodeModel, updateOnDirtyFlagging) {\r\n  if (nodeModel.type === 'Component Children') {\r\n    if (nodeModel.parent) {\r\n      var parentInstance = this.getNodeWithId(nodeModel.parent.id);\r\n      this.componentOwner.setChildRoot(parentInstance);\r\n    }\r\n    return;\r\n  }\r\n\r\n  var node;\r\n  try {\r\n    node = await this.createNode(nodeModel.type, nodeModel.id);\r\n    node.updateOnDirtyFlagging = updateOnDirtyFlagging === false ? false : true;\r\n    node.setNodeModel(nodeModel);\r\n  } catch (e) {\r\n    console.error(e.message);\r\n    if (this.context.editorConnection && this.context.isWarningTypeEnabled('nodescope')) {\r\n      this.context.editorConnection.sendWarning(this.componentOwner.name, nodeModel.id, 'nodelibrary-unknown-node', {\r\n        message: e.message,\r\n        showGlobally: true\r\n      });\r\n    }\r\n    return;\r\n  }\r\n\r\n  if (nodeModel.variant && node.setVariant) node.setVariant(nodeModel.variant);\r\n  this.setNodeParameters(node, nodeModel);\r\n\r\n  if (nodeModel.parent) {\r\n    this.insertNodeInTree(node, nodeModel);\r\n  }\r\n\r\n  return node;\r\n};\r\n\r\nNodeScope.prototype.insertNodeInTree = function (nodeInstance, nodeModel) {\r\n  var parentInstance = this.getNodeWithId(nodeModel.parent.id);\r\n  var childIndex = nodeModel.parent.children.indexOf(nodeModel);\r\n\r\n  if (!parentInstance.addChild) {\r\n    throw new Error(\r\n      'Node ' + parentInstance.id + ' of type ' + parentInstance.constructor.name + \" can't have children\"\r\n    );\r\n  }\r\n\r\n  parentInstance.addChild(nodeInstance, childIndex);\r\n};\r\n\r\nNodeScope.prototype.getNodeWithId = function (id) {\r\n  if (this.nodes.hasOwnProperty(id) === false) {\r\n    throw new Error('Unknown node id ' + id);\r\n  }\r\n  return this.nodes[id];\r\n};\r\n\r\nNodeScope.prototype.hasNodeWithId = function (id) {\r\n  return this.nodes.hasOwnProperty(id);\r\n};\r\n\r\nNodeScope.prototype.createPrimitiveNode = function (name, id, extraProps) {\r\n  if (!id) id = guid();\r\n\r\n  if (this.nodes.hasOwnProperty(id)) {\r\n    throw Error('duplicate id ' + id);\r\n  }\r\n\r\n  const node = this.context.nodeRegister.createNode(name, id, this);\r\n  if (extraProps) {\r\n    for (const prop in extraProps) {\r\n      node[prop] = extraProps[prop];\r\n    }\r\n  }\r\n\r\n  this.nodes[id] = node;\r\n  return node;\r\n};\r\n\r\nNodeScope.prototype.createNode = async function (name, id, extraProps) {\r\n  if (!id) id = guid();\r\n\r\n  if (this.nodes.hasOwnProperty(id)) {\r\n    throw Error('duplicate id ' + id);\r\n  }\r\n\r\n  let node;\r\n\r\n  if (this.context.nodeRegister.hasNode(name)) {\r\n    node = this.context.nodeRegister.createNode(name, id, this);\r\n    if (extraProps) {\r\n      for (const prop in extraProps) {\r\n        node[prop] = extraProps[prop];\r\n      }\r\n    }\r\n  } else {\r\n    node = await this.context.createComponentInstanceNode(name, id, this, extraProps);\r\n    this.componentInstanceChildren[id] = node;\r\n  }\r\n\r\n  this.nodes[id] = node;\r\n  return node;\r\n};\r\n\r\nNodeScope.prototype.getNodesWithIdRecursive = function (id) {\r\n  var ComponentInstanceNode = require('./nodes/componentinstance');\r\n\r\n  function findNodesWithIdRec(scope, id, result) {\r\n    if (scope.nodes.hasOwnProperty(id)) {\r\n      result.push(scope.nodes[id]);\r\n    }\r\n\r\n    var componentIds = Object.keys(scope.nodes).filter(function (nodeId) {\r\n      return scope.nodes[nodeId] instanceof ComponentInstanceNode;\r\n    });\r\n\r\n    componentIds.forEach(function (componentId) {\r\n      findNodesWithIdRec(scope.nodes[componentId].nodeScope, id, result);\r\n    });\r\n  }\r\n\r\n  var result = [];\r\n  findNodesWithIdRec(this, id, result);\r\n  return result;\r\n};\r\n\r\nNodeScope.prototype.getNodesWithType = function (name) {\r\n  var self = this;\r\n  var ids = Object.keys(this.nodes).filter(function (id) {\r\n    return self.nodes[id].name === name;\r\n  });\r\n  return ids.map(function (id) {\r\n    return self.nodes[id];\r\n  });\r\n};\r\n\r\nNodeScope.prototype.getNodesWithTypeRecursive = function (name) {\r\n  var ComponentInstanceNode = require('./nodes/componentinstance');\r\n\r\n  var self = this;\r\n  function findNodesWithTypeRec() {\r\n    result = result.concat(self.getNodesWithType(name));\r\n\r\n    var componentIds = Object.keys(self.nodes).filter(function (nodeId) {\r\n      return self.nodes[nodeId] instanceof ComponentInstanceNode;\r\n    });\r\n\r\n    componentIds.forEach(function (componentId) {\r\n      var res = self.nodes[componentId].nodeScope.getNodesWithTypeRecursive(name);\r\n      result = result.concat(res);\r\n    });\r\n  }\r\n\r\n  var result = [];\r\n  findNodesWithTypeRec(result);\r\n  return result;\r\n};\r\n\r\nNodeScope.prototype.getAllNodesRecursive = function () {\r\n  var ComponentInstanceNode = require('./nodes/componentinstance');\r\n\r\n  let result = [];\r\n\r\n  const getAllNodesRec = () => {\r\n    result = result.concat(Object.values(this.nodes));\r\n\r\n    var componentIds = Object.keys(this.nodes).filter((nodeId) => {\r\n      return this.nodes[nodeId] instanceof ComponentInstanceNode;\r\n    });\r\n\r\n    componentIds.forEach((componentId) => {\r\n      var res = this.nodes[componentId].nodeScope.getAllNodesRecursive();\r\n      result = result.concat(res);\r\n    });\r\n  };\r\n\r\n  getAllNodesRec(result);\r\n  return result;\r\n};\r\n\r\nNodeScope.prototype.getAllNodesWithVariantRecursive = function (variant) {\r\n  const nodes = this.getAllNodesRecursive();\r\n  return nodes.filter((node) => node.variant === variant);\r\n};\r\n\r\nNodeScope.prototype.onNodeModelRemoved = function (nodeModel) {\r\n  var nodeInstance = this.getNodeWithId(nodeModel.id);\r\n\r\n  if (nodeModel.parent) {\r\n    var parentInstance = this.getNodeWithId(nodeModel.parent.id);\r\n    parentInstance.removeChild(nodeInstance);\r\n  }\r\n\r\n  nodeInstance._onNodeDeleted();\r\n  delete this.nodes[nodeInstance.id];\r\n  delete this.componentInstanceChildren[nodeInstance.id];\r\n};\r\n\r\nNodeScope.prototype.removeConnection = function (connectionModel) {\r\n  var targetNode = this.getNodeWithId(connectionModel.targetId);\r\n  targetNode.removeInputConnection(connectionModel.targetPort, connectionModel.sourceId, connectionModel.sourcePort);\r\n};\r\n\r\nNodeScope.prototype.setComponentModel = async function (componentModel) {\r\n  this.componentModel = componentModel;\r\n\r\n  const nodes = [];\r\n\r\n  //create all nodes\r\n  for (const nodeModel of componentModel.getAllNodes()) {\r\n    const node = await this.createNodeFromModel(nodeModel, false);\r\n    if (node) nodes.push(node);\r\n  }\r\n\r\n  componentModel.getAllConnections().forEach((conn) => this.addConnection(conn));\r\n\r\n  //now that all nodes and connections are setup, trigger the dirty flagging so nodes can run with all the connections in place\r\n  nodes.forEach((node) => (node.updateOnDirtyFlagging = true));\r\n\r\n  nodes.forEach((node) => {\r\n    if (node._dirty) {\r\n      node._performDirtyUpdate();\r\n    }\r\n  });\r\n\r\n  componentModel.on('connectionAdded', (conn) => this.addConnection(conn), this);\r\n  componentModel.on('connectionRemoved', this.removeConnection, this);\r\n  componentModel.on('nodeAdded', this.createNodeFromModel, this);\r\n\r\n  var self = this;\r\n  componentModel.on(\r\n    'nodeParentWillBeRemoved',\r\n    function (nodeModel) {\r\n      if (nodeModel.type === 'Component Children') {\r\n        if (nodeModel.parent) {\r\n          this.componentOwner.setChildRoot(null);\r\n        }\r\n        return;\r\n      }\r\n\r\n      const nodeInstance = self.getNodeWithId(nodeModel.id);\r\n      if (nodeInstance.parent) {\r\n        nodeInstance.parent.removeChild(nodeInstance);\r\n      }\r\n    },\r\n    this\r\n  );\r\n\r\n  componentModel.on(\r\n    'nodeParentUpdated',\r\n    function (nodeModel) {\r\n      if (nodeModel.type === 'Component Children') {\r\n        var parentInstance = this.getNodeWithId(nodeModel.parent.id);\r\n        this.componentOwner.setChildRoot(parentInstance);\r\n      } else {\r\n        var nodeInstance = self.getNodeWithId(nodeModel.id);\r\n        self.insertNodeInTree(nodeInstance, nodeModel);\r\n      }\r\n    },\r\n    this\r\n  );\r\n\r\n  componentModel.on(\r\n    'nodeRemoved',\r\n    function (nodeModel) {\r\n      if (nodeModel.type !== 'Component Children') {\r\n        self.onNodeModelRemoved(nodeModel);\r\n      }\r\n    },\r\n    this\r\n  );\r\n\r\n  for (const id in this.nodes) {\r\n    const node = this.nodes[id];\r\n    node.nodeScopeDidInitialize && node.nodeScopeDidInitialize();\r\n  }\r\n};\r\n\r\nNodeScope.prototype.reset = function () {\r\n  if (this.componentModel) {\r\n    this.componentModel.removeListenersWithRef(this);\r\n    this.componentModel = undefined;\r\n  }\r\n\r\n  Object.keys(this.nodes).forEach((id) => {\r\n    if (this.nodes.hasOwnProperty(id)) {\r\n      this.deleteNode(this.nodes[id]);\r\n    }\r\n  });\r\n};\r\n\r\nNodeScope.prototype.deleteNode = function (nodeInstance) {\r\n  if (this.nodes.hasOwnProperty(nodeInstance.id) === false) {\r\n    console.error(\"Node doesn't belong to this scope\", nodeInstance.id, nodeInstance.name);\r\n    return;\r\n  }\r\n\r\n  if (nodeInstance.parent) {\r\n    nodeInstance.parent.removeChild(nodeInstance);\r\n  }\r\n\r\n  //depth first\r\n  if (nodeInstance.getChildren) {\r\n    nodeInstance.getChildren().forEach((child) => {\r\n      nodeInstance.removeChild(child);\r\n      //the child might be created in a different scope\r\n      //if the child is a component instance, we want its parent scope, not the inner scope\r\n      const nodeScope = child.parentNodeScope || child.nodeScope;\r\n      nodeScope.deleteNode(child);\r\n    });\r\n  }\r\n\r\n  if (this.componentModel) {\r\n    const connectionFrom = this.componentModel.getConnectionsFrom(nodeInstance.id);\r\n    const connectionTo = this.componentModel.getConnectionsTo(nodeInstance.id);\r\n\r\n    connectionFrom.concat(connectionTo).forEach((connection) => {\r\n      if (this.nodes.hasOwnProperty(connection.targetId) && this.nodes.hasOwnProperty(connection.sourceId)) {\r\n        this.removeConnection(connection);\r\n      }\r\n    });\r\n  }\r\n\r\n  nodeInstance._onNodeDeleted();\r\n  delete this.nodes[nodeInstance.id];\r\n  delete this.componentInstanceChildren[nodeInstance.id]; //in case this is a component\r\n};\r\n\r\nNodeScope.prototype.sendEventFromThisScope = function (eventName, data, propagation, sendEventInThisScope, _exclude) {\r\n  if (sendEventInThisScope) {\r\n    var eventReceivers = this.getNodesWithType('Event Receiver').filter(function (eventReceiver) {\r\n      return eventReceiver.getChannelName() === eventName;\r\n    });\r\n\r\n    for (var i = 0; i < eventReceivers.length; i++) {\r\n      var consumed = eventReceivers[i].handleEvent(data);\r\n      if (consumed) return true;\r\n    }\r\n  }\r\n\r\n  if (propagation === 'parent' && this.componentOwner.parentNodeScope) {\r\n    // Send event to parent scope\r\n    //either the scope of the visual parent if there is one, otherwise the parent component\r\n    const parentNodeScope = this.componentOwner.parent\r\n      ? this.componentOwner.parent.nodeScope\r\n      : this.componentOwner.parentNodeScope;\r\n    if (!parentNodeScope) return;\r\n    parentNodeScope.sendEventFromThisScope(eventName, data, propagation, true);\r\n  } else if (propagation === 'children') {\r\n    // Send event to all child scopes\r\n    var nodes = this.nodes;\r\n    for (var nodeId in nodes) {\r\n      var children = nodes[nodeId].children;\r\n      if (children)\r\n        children.forEach((child) => {\r\n          if (child.name && this.context.hasComponentModelWithName(child.name)) {\r\n            // This is a component instance child\r\n            var consumed = child.nodeScope.sendEventFromThisScope(eventName, data, propagation, true);\r\n            if (consumed) return true;\r\n          }\r\n        });\r\n    }\r\n  } else if (propagation === 'siblings') {\r\n    // Send event to all siblings, that is all children of the parent scope except this scope\r\n    let parentNodeScope;\r\n    if (this.componentOwner.parent) {\r\n      parentNodeScope = this.componentOwner.parent.nodeScope;\r\n    } else {\r\n      parentNodeScope = this.componentOwner.parentNodeScope;\r\n    }\r\n\r\n    if (!parentNodeScope) return;\r\n\r\n    var nodes = parentNodeScope.nodes;\r\n    for (var nodeId in nodes) {\r\n      var children = nodes[nodeId].children;\r\n      if (children) {\r\n        var _c = children.filter(\r\n          (child) => child.name && this.context.hasComponentModelWithName(child.name) && child.nodeScope !== this\r\n        );\r\n        _c.forEach((child) => {\r\n          var consumed = child.nodeScope.sendEventFromThisScope(eventName, data, null, true);\r\n          if (consumed) return true;\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nmodule.exports = NodeScope;\r\n","\"use strict\";\r\n\r\n/**\r\n * @class OutputProperty\r\n *\r\n * @param args Arguments\r\n * @param {Function} args.getter Function that returns the value\r\n * @param {Node} args.owner Port owner\r\n * @param {string} args.type Output value type\r\n * @constructor\r\n */\r\nfunction OutputProperty(args) {\r\n\r\n    if(!args.owner) {\r\n        throw new Error(\"Owner must be set\");\r\n    }\r\n    this.getter = args.getter;\r\n    this.connections = [];\r\n    this.owner = args.owner;\r\n    this.name = args.name;\r\n    this.onFirstConnectionAdded = args.onFirstConnectionAdded;\r\n    this.onLastConnectionRemoved = args.onLastConnectionRemoved;\r\n\r\n    this._id = undefined;\r\n}\r\n\r\nObject.defineProperties(OutputProperty.prototype, {\r\n    /**\r\n     * Gets the current value\r\n     * @name OutputProperty#value\r\n     * @readonly\r\n     */\r\n    value: {\r\n        get: function() {\r\n            return this.getter.call(this.owner);\r\n        }\r\n    },\r\n\r\n    id: {\r\n        get: function() {\r\n            if(!this._id) {\r\n                this._id = this.owner.id + this.name;\r\n            }\r\n            return this._id;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Registers a connection to propagate dirtiness\r\n     * Also records which input port it's connected to so nodes like\r\n     * Animation can set it's implicit start value\r\n     * @name OutputProperty#registerConnection\r\n     * @readonly\r\n     */\r\n    registerConnection: {\r\n        value: function(node, inputPortName) {\r\n            this.connections.push({\r\n                node: node,\r\n                inputPortName: inputPortName\r\n            });\r\n\r\n            if(this.connections.length === 1 && this.onFirstConnectionAdded) {\r\n                this.onFirstConnectionAdded.call(this.owner);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Deregisters a connection to a specific input port\r\n     * @name OutputProperty#deregisterConnection\r\n     * @readonly\r\n     */\r\n    deregisterConnection: {\r\n        value: function(node, inputPortName) {\r\n            for(var i=0; i<this.connections.length; i++) {\r\n                var connection = this.connections[i];\r\n                if(connection.node === node && connection.inputPortName === inputPortName) {\r\n                    this.connections.splice(i,1);\r\n                    break;\r\n                }\r\n            }\r\n\r\n            if(this.connections.length === 0 && this.onLastConnectionRemoved) {\r\n                this.onLastConnectionRemoved.call(this.owner);\r\n            }\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Sets dirty flag of all nodes that depend on this output port\r\n     * @name OutputProperty#flagDependeesDirty\r\n     * @readonly\r\n     */\r\n    flagDependeesDirty: {\r\n        value: function(value) {\r\n            for(var i= 0, len=this.connections.length; i<len; i++) {\r\n                this.connections[i].node.flagDirty();\r\n            }\r\n        }\r\n    },\r\n    sendValue: {\r\n        value: function(value) {\r\n            if(this._lastUpdateIteration !== this.owner._updatedAtIteration) {\r\n                this._lastUpdateIteration = this.owner._updatedAtIteration;\r\n                this.valuesSendThisIteration = 0;\r\n            }\r\n            else {\r\n                this.valuesSendThisIteration++;\r\n            }\r\n\r\n            if(this.valuesSendThisIteration > 500) {\r\n                //this will make the owner send a warning and stop its update\r\n                this.owner._cyclicLoop = true;\r\n            }\r\n\r\n            for(var i= 0, len=this.connections.length; i<len; i++) {\r\n                var connection = this.connections[i];\r\n                connection.node._setValueFromConnection(connection.inputPortName, value);\r\n            }\r\n        }\r\n    },\r\n    /**\r\n     * @name OutputProperty#hasConnections\r\n     * @readonly\r\n     */\r\n    hasConnections: {\r\n        value: function() {\r\n            return this.connections.length > 0;\r\n        }\r\n    }\r\n});\r\nmodule.exports = OutputProperty;","\"use strict\";\r\n\r\nfunction addModuleSettings(result, modules) {\r\n    // Add module settings\r\n    for(var i = 0; i < modules.length; i++) {\r\n        var m = modules[i];\r\n        if(m.settings) {\r\n            m.settings.forEach(function(p) {\r\n                result.ports.push(p);\r\n            })\r\n        }\r\n    }\r\n}\r\n\r\nfunction generateProjectSettings(projectSettings, modules) {\r\n    const result = {\r\n        dynamicports: [],\r\n        ports: []\r\n    };\r\n\r\n    addModuleSettings(result, modules);\r\n\r\n    return result;\r\n}\r\n\r\nmodule.exports = {\r\n    generateProjectSettings: generateProjectSettings\r\n};","var EventEmitter = require('../events');\r\n\r\nfunction Services() {\r\n}\r\n\r\nServices.events = new EventEmitter();\r\n\r\nmodule.exports = Services;","'use strict';\r\n\r\nfunction Timer(scheduler, args) {\r\n    this.duration = args.duration || 0;\r\n    this._isRunning = false;\r\n    this._hasCalledOnStart = false;\r\n    this.scheduler = scheduler;\r\n    this.repeatCount = 1;\r\n    this.delay = 0;\r\n\r\n    for(var arg in args) {\r\n        this[arg] = args[arg];\r\n    }\r\n}\r\n\r\nTimer.prototype.start = function() {\r\n    if(this._isRunning) {\r\n        this.stop();\r\n    }\r\n\r\n    this.scheduler.scheduleTimer(this);\r\n    return this;\r\n};\r\n\r\nTimer.prototype.stop = function() {\r\n    this.scheduler.stopTimer(this);\r\n    this._hasCalledOnStart = false;\r\n    this._isRunning = false;\r\n    this._wasStopped = true;    // This is used to avoid calling onFinish\r\n};\r\n\r\nTimer.prototype.isRunning = function() {\r\n    return this._isRunning;\r\n};\r\n\r\nTimer.prototype.durationLeft = function() {\r\n    return this._durationLeft;\r\n};\r\n\r\nfunction TimerScheduler(requestFrameCallback) {\r\n    this.requestFrame = requestFrameCallback;\r\n    this.runningTimers = [];\r\n    this.newTimers = [];\r\n}\r\n\r\nTimerScheduler.prototype.createTimer = function(args) {\r\n    return new Timer(this, args);\r\n};\r\n\r\nTimerScheduler.prototype.scheduleTimer = function(timer) {\r\n    if(this.newTimers.indexOf(timer) === -1) {\r\n        if(timer.repeatCount === 0) {\r\n            timer.repeatCount = 100000;\r\n        }\r\n\r\n        this.newTimers.push(timer);\r\n        this.requestFrame();\r\n    }\r\n};\r\n\r\nTimerScheduler.prototype.stopTimer = function(timer) {\r\n    var index;\r\n\r\n    if(timer._isRunning) {\r\n        index = this.runningTimers.indexOf(timer);\r\n        if(index !== -1) {\r\n            this.runningTimers.splice(index, 1);\r\n        }\r\n\r\n        if (timer.onStop && !timer._wasStopped) {\r\n            timer.onStop();\r\n        }\r\n    }\r\n    else {\r\n        index = this.newTimers.indexOf(timer);\r\n        if(index !== -1) {\r\n            this.newTimers.splice(index, 1);\r\n        }\r\n    }\r\n};\r\n\r\nTimerScheduler.prototype.runTimers = function(currentTime) {\r\n\r\n    var remainingTimers = [],\r\n        finishedTimers = [],\r\n        timersThisFrame = [];\r\n\r\n    var i,\r\n        len = this.runningTimers.length,\r\n        timer;\r\n\r\n    //copy timer list in case timers are added or removed during onStart or onRunning\r\n    for(i=0; i<len; ++i) {\r\n        timersThisFrame[i] = this.runningTimers[i];\r\n    }\r\n\r\n    for(i=0; i<len; ++i) {\r\n        timer = timersThisFrame[i];\r\n        if(timer && currentTime >= timer._start) {\r\n\r\n            if(timer._hasCalledOnStart === false && timer.onStart) {\r\n                timer.onStart();\r\n                timer._hasCalledOnStart = true;\r\n            }\r\n\r\n            var t;\r\n            if(timer.duration > 0) {\r\n                t = (currentTime - timer._start)/(timer.duration*timer.repeatCount);\r\n            } else {\r\n                t = 1.0;\r\n            }\r\n\r\n            timer._durationLeft = timer.duration * (1-t);\r\n\r\n            var localT = t*timer.repeatCount - Math.floor(t*timer.repeatCount);\r\n            if(t >= 1.0) {\r\n                localT = 1.0;\r\n            }\r\n\r\n            if(timer.onRunning) {\r\n                timer.onRunning(localT);\r\n            }\r\n\r\n            if(t < 1.0 && timer._isRunning) {\r\n                remainingTimers.push(timer);\r\n            }\r\n            else if (!timer._wasStopped) {\r\n                finishedTimers.push(timer);\r\n            }\r\n        } else {\r\n            remainingTimers.push(timer);\r\n        }\r\n    }\r\n\r\n    this.runningTimers = remainingTimers;\r\n\r\n    for(i=0; i<finishedTimers.length; ++i) {\r\n        finishedTimers[i]._isRunning = false;\r\n        finishedTimers[i]._hasCalledOnStart = false;\r\n        if( finishedTimers[i].onFinish ) {\r\n            finishedTimers[i].onFinish();\r\n        }\r\n    }\r\n\r\n    //add newly queued timers\r\n    if(this.newTimers.length > 0) {\r\n        for(i=0; i<this.newTimers.length; ++i) {\r\n            timer = this.newTimers[i];\r\n            timer._start = currentTime + timer.delay;\r\n            timer._isRunning = true;\r\n            timer._wasStopped = false;\r\n            this.runningTimers.push(timer);\r\n\r\n            if(timer.delay === 0) {\r\n                //play first timer frame directly to keep everything nicely synched\r\n                if(timer.onStart) {\r\n                    timer.onStart();\r\n                    timer._hasCalledOnStart = true;\r\n                }\r\n                if(timer.onRunning) {\r\n                    timer.onRunning(0);\r\n                }\r\n            }\r\n        }\r\n        this.newTimers.length = 0;\r\n    }\r\n};\r\n\r\nTimerScheduler.prototype.hasPendingTimers = function() {\r\n    return this.runningTimers.length > 0 || this.newTimers.length > 0;\r\n};\r\n\r\nmodule.exports = TimerScheduler;\r\n","//this just assumes the base url is '/' always\r\nfunction getAbsoluteUrl(_url) {\r\n\r\n  //convert to string in case the _url is a Cloud File (which is an object with a custom toString())\r\n  const url = String(_url);\r\n\r\n  //only add a the base url if this is a local URL (e.g. not a https url or  base64 string)\r\n  if (!url || url[0] === \"/\" || url.includes(\"://\") || url.startsWith('data:')) {\r\n    return url;\r\n  }\r\n\r\n  return (Noodl.baseUrl || '/') + url;\r\n}\r\n\r\n/**\r\n * Log an error thrown by the JavaScript nodes.\r\n *\r\n * @param {any} error \r\n */\r\nfunction logJavaScriptNodeError(error) {\r\n  if (typeof error === 'string') {\r\n    console.log('Error in JS node run code.', error);\r\n  } else {\r\n    console.log(\r\n      'Error in JS node run code.',\r\n      Object.getPrototypeOf(error).constructor.name + ': ' + error.message,\r\n      error.stack\r\n    );\r\n  }\r\n}\r\n\r\nmodule.exports = {\r\n  getAbsoluteUrl,\r\n  logJavaScriptNodeError\r\n};\r\n","class Variants {\r\n\r\n    constructor({graphModel, getNodeScope}) {\r\n        this.getNodeScope = getNodeScope;\r\n\r\n        if(graphModel) {\r\n            this.graphModel = graphModel;\r\n            graphModel.on('variantUpdated', variant => this.onVariantUpdated(variant));\r\n        }\r\n    }\r\n\r\n    getVariant(typename, name) {\r\n        if(!this.graphModel) return undefined;\r\n        \r\n        return this.graphModel.getVariant(typename, name);\r\n    }\r\n\r\n    onVariantUpdated(variant) {\r\n        const nodeScope = this.getNodeScope();\r\n        if(!nodeScope) return;\r\n\r\n        //get all nodes with the type the variant applies to\r\n        const nodes = nodeScope.getNodesWithTypeRecursive(variant.typename);\r\n\r\n        //and filter for the ones using the updated variant\r\n        const nodesWithVariant = nodes.filter(node => {\r\n\r\n            //if a variant has been set during runtime, it'll override the value from the model\r\n            if(node.variant) return node.variant.name === variant.name;\r\n\r\n            //otherwise check the model (which always matches the editor)\r\n            return node.model && node.model.variant === variant.name;\r\n        });\r\n\r\n        //and re-apply the variant\r\n        for(const node of nodesWithVariant) {\r\n            node.setVariant(variant);\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Variants;","const CloudStore = require('@noodl/runtime/src/api/cloudstore');\r\n\r\nconst files = {\r\n  async delete(fileName) {\r\n    return new Promise((resolve, reject) => {\r\n      CloudStore.instance.deleteFile({\r\n        file: { name: fileName },\r\n        success: (response) => {\r\n          resolve();\r\n        },\r\n        error: (e) => {\r\n          reject(e);\r\n        }\r\n      });\r\n    });\r\n  }\r\n};\r\n\r\nmodule.exports = files;\r\n","const Model = require('@noodl/runtime/src/model');\r\nconst CloudStore = require('@noodl/runtime/src/api/cloudstore');\r\nconst NoodlRuntime = require('@noodl/runtime');\r\nconst RecordsAPI = require('@noodl/runtime/src/api/records');\r\n\r\nfunction createUsersAPI(modelScope) {\r\n  let _cloudstore;\r\n  const cloudstore = () => {\r\n    // We must create the cloud store just in time so all meta data is loaded\r\n    if (!_cloudstore) _cloudstore = new CloudStore(modelScope);\r\n    return _cloudstore;\r\n  };\r\n\r\n  const Records = RecordsAPI(modelScope);\r\n\r\n  const api = {\r\n    // This API should support an options object, this is how it works on\r\n    // the frontend and in the docs. To support any old use added a ugly fix\r\n    async logIn(username, password) {\r\n      if(typeof username === 'object' && password === undefined) {\r\n        const options = username; \r\n        username = options.username;\r\n        password = options.password;\r\n      }\r\n\r\n      return new Promise((resolve, reject) => {\r\n        const userService = NoodlRuntime.Services.UserService.forScope(modelScope);\r\n        userService.logIn({\r\n          username,\r\n          password,\r\n          success: (user) => {\r\n            resolve(user);\r\n          },\r\n          error: (e) => {\r\n            reject(Error(e));\r\n          }\r\n        });\r\n      });\r\n    },\r\n\r\n    async impersonate(username, options) {\r\n      // Look for the user based on username\r\n      const users = await Records.query('_User', {\r\n        username: { equalTo: username }\r\n      });\r\n\r\n      if (!users || users.length !== 1) {\r\n        throw Error('Could not find user.');\r\n      }\r\n\r\n      // See if there is a session already\r\n      const user = users[0];\r\n\r\n      const query = {\r\n        and: [{ user: { pointsTo: user.id } }, { expiresAt: { greaterThan: new Date() } }]\r\n      };\r\n\r\n      if (options && options.installationId) {\r\n        query.and.push({ installationId: { equalTo: options.installationId } });\r\n      }\r\n\r\n      const sessions = await Records.query('_Session', query);\r\n\r\n      async function _fetchUser(sessionToken) {\r\n        return new Promise((resolve, reject) => {\r\n          const userService = NoodlRuntime.Services.UserService.forScope(modelScope);\r\n          userService.fetchUser({\r\n            sessionToken,\r\n            success: (user) => resolve(user),\r\n            error: (e) => reject(Error(e))\r\n          });\r\n        });\r\n      }\r\n\r\n      if (!sessions || sessions.length === 0) {\r\n        // No session, we need to create one\r\n        const session = await Records.create('_Session', {\r\n          user: user.id,\r\n          installationId: options ? options.installationId : undefined,\r\n          sessionToken: 'r:' + Model.guid() + Model.guid(),\r\n          expiresAt: new Date(\r\n            Date.now() + (options && options.duration !== undefined ? options.duration : 24 * 60 * 60 * 1000)\r\n          ),\r\n          restricted: false\r\n        });\r\n\r\n        return _fetchUser(session.sessionToken);\r\n      } else {\r\n        return _fetchUser(sessions[0].sessionToken);\r\n      }\r\n    }\r\n  };\r\n\r\n  Object.defineProperty(api, 'Current', {\r\n    get: function () {\r\n      const request = (modelScope || Model).get('Request');\r\n      const userId = request.get('UserId');\r\n      if (!userId) return;\r\n\r\n      return {\r\n        UserId: userId,\r\n        Properties: (modelScope || Model).get(userId),\r\n        async save(options) {\r\n          return new Promise((resolve, reject) => {\r\n            cloudstore().save({\r\n              collection: '_User',\r\n              objectId: userId,\r\n              data: (modelScope || Model).get(userId).data,\r\n              acl: options ? options.acl : undefined,\r\n              success: (response) => {\r\n                resolve();\r\n              },\r\n              error: (err) => {\r\n                reject(Error(err || 'Failed to save.'));\r\n              }\r\n            });\r\n          });\r\n        },\r\n        async fetch() {\r\n          return new Promise((resolve, reject) => {\r\n            cloudstore().fetch({\r\n              collection: '_User',\r\n              objectId: userId,\r\n              success: function (response) {\r\n                var record = cloudstore()._fromJSON(response, '_User');\r\n                resolve(record);\r\n              },\r\n              error: function (err) {\r\n                reject(Error(err || 'Failed to fetch.'));\r\n              }\r\n            });\r\n          });\r\n        }\r\n      };\r\n    }\r\n  });\r\n\r\n  return api;\r\n}\r\n\r\nmodule.exports = createUsersAPI;\r\n","const { Node, EdgeTriggeredInput } = require('@noodl/runtime');\r\n\r\nconst CloudStore = require('@noodl/runtime/src/api/cloudstore'),\r\n  JavascriptNodeParser = require('@noodl/runtime/src/javascriptnodeparser'),\r\n  QueryUtils = require('@noodl/runtime/src/api/queryutils');\r\n\r\nvar AggregateNode = {\r\n  name: 'noodl.cloud.aggregate',\r\n  docs: 'https://docs.noodl.net/nodes/cloud-functions/cloud-data/aggregate-records',\r\n  displayName: 'Aggregate Records',\r\n  category: 'Cloud Services',\r\n  usePortAsLabel: 'collectionName',\r\n  color: 'data',\r\n  initialize: function () {\r\n    this._internal.queryParameters = {};\r\n\r\n    this._internal.storageSettings = {};\r\n\r\n    this._internal.aggregates = {};\r\n  },\r\n  getInspectInfo() {\r\n    const aggregates = this._internal.aggregateValues;\r\n    if (!aggregates) {\r\n      return { type: 'text', value: '[Not executed yet]' };\r\n    }\r\n\r\n    return [\r\n      {\r\n        type: 'value',\r\n        value: aggregates\r\n      }\r\n    ];\r\n  },\r\n  inputs: {\r\n    aggregates:{\r\n        index:100,\r\n        group:\"Aggregates\",\r\n        type:{name:\"stringlist\",allowEditOnly:true},\r\n        displayName:\"Aggregates\",\r\n        set:function(value) {\r\n            this._internal.aggregatesList = value;\r\n        }\r\n    }\r\n  },\r\n  outputs: {\r\n    fetched: {\r\n      group: 'Events',\r\n      type: 'signal',\r\n      displayName: 'Success'\r\n    },\r\n    failure: {\r\n      group: 'Events',\r\n      type: 'signal',\r\n      displayName: 'Failure'\r\n    },\r\n    error: {\r\n      type: 'string',\r\n      displayName: 'Error',\r\n      group: 'Error',\r\n      getter: function () {\r\n        return this._internal.error;\r\n      }\r\n    }\r\n  },\r\n  prototypeExtensions: {\r\n    setCollectionName: function (name) {\r\n      this._internal.name = name;\r\n\r\n      if (this.isInputConnected('storageFetch') === false) this.scheduleFetch();\r\n    },\r\n    _onNodeDeleted: function () {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n    },\r\n    setError: function (err) {\r\n      this._internal.err = err;\r\n      this.flagOutputDirty('error');\r\n      this.sendSignalOnOutput('failure');\r\n    },\r\n    scheduleFetch: function () {\r\n      var internal = this._internal;\r\n\r\n      if (internal.fetchScheduled) return;\r\n      internal.fetchScheduled = true;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        internal.fetchScheduled = false;\r\n\r\n        this.fetch();\r\n      });\r\n    },\r\n    fetch: function () {\r\n      if (this.context.editorConnection) {\r\n        let validateAggNames = true;\r\n        if(this._internal.aggregatesList) {\r\n            this._internal.aggregatesList.split(',').forEach(k => {\r\n                if(k.indexOf(' ')!==-1)\r\n                    validateAggNames = false;\r\n            })\r\n        }\r\n\r\n        if (this._internal.name === undefined) {\r\n          this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'aggregate-node', {\r\n            message: 'No class specified for aggregate.'\r\n          });\r\n        }\r\n        else if(this._internal.aggregatesList === undefined) {\r\n            this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'aggregate-node', {\r\n                message: 'No aggregates specified.'\r\n              });\r\n        }\r\n        else if(!validateAggNames) {\r\n            this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'aggregate-node', {\r\n                message: 'Invalid aggregate names, dont use space and special characters.'\r\n              });\r\n        }\r\n        else {\r\n          this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, 'aggregate-node');\r\n        }\r\n      }\r\n\r\n      const f = this.getStorageFilter();\r\n      this._internal.currentQuery = {\r\n        where: f.where,\r\n      };\r\n      CloudStore.forScope(this.nodeScope.modelScope).aggregate({\r\n        collection: this._internal.name,\r\n        where: f.where,\r\n        group: this.getAggregates(),\r\n        success: (results) => {\r\n            this._internal.aggregateValues = results;\r\n            for(const key in results) {\r\n                if(this.hasOutput('agg-'+key))\r\n                    this.flagOutputDirty('agg-'+key);\r\n            }\r\n          this.sendSignalOnOutput('fetched');\r\n        },\r\n        error: (err) => {\r\n          this.setError(err || 'Failed to aggregate.');\r\n        }\r\n      });\r\n    },\r\n    getStorageFilter: function () {\r\n      const storageSettings = this._internal.storageSettings;\r\n      if (storageSettings['storageFilterType'] === undefined || storageSettings['storageFilterType'] === 'simple') {\r\n        // Create simple filter\r\n        const _where =\r\n          this._internal.visualFilter !== undefined\r\n            ? QueryUtils.convertVisualFilter(this._internal.visualFilter, {\r\n                queryParameters: this._internal.queryParameters,\r\n                collectionName: this._internal.name\r\n              })\r\n            : undefined;\r\n\r\n        return {\r\n          where: _where,\r\n        };\r\n      } else if (storageSettings['storageFilterType'] === 'json') {\r\n        // JSON filter\r\n        if (!this._internal.filterFunc) {\r\n          try {\r\n            var filterCode = storageSettings['storageJSONFilter'];\r\n\r\n            // Parse out variables\r\n            filterCode = filterCode.replace(/\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/g, ''); // Remove comments\r\n            this._internal.filterVariables = filterCode.match(/\\$[A-Za-z0-9]+/g) || [];\r\n\r\n            var args = ['where', 'Inputs']\r\n              .concat(this._internal.filterVariables)\r\n              .concat([filterCode]);\r\n            this._internal.filterFunc = Function.apply(null, args);\r\n          } catch (e) {\r\n            this._internal.filterFunc = undefined;\r\n            console.log('Error while parsing filter script: ' + e);\r\n          }\r\n        }\r\n\r\n        if (!this._internal.filterFunc) return;\r\n\r\n        var _filter = {},\r\n          _this = this;\r\n\r\n        // Collect filter variables\r\n        var _filterCb = function (f) {\r\n          _filter = QueryUtils.convertFilterOp(f, {\r\n            collectionName: _this._internal.name,\r\n            error: function (err) {\r\n              _this.context.editorConnection.sendWarning(\r\n                _this.nodeScope.componentOwner.name,\r\n                _this.id,\r\n                'aggregate-node-filter',\r\n                {\r\n                  message: err\r\n                }\r\n              );\r\n            }\r\n          });\r\n        };\r\n\r\n        // Extract inputs\r\n        const inputs = {};\r\n        for (let key in storageSettings) {\r\n          if (key.startsWith('storageFilterValue-'))\r\n            inputs[key.substring('storageFilterValue-'.length)] = storageSettings[key];\r\n        }\r\n\r\n        var filterFuncArgs = [ _filterCb, inputs]; // One for filter, one for where\r\n\r\n        this._internal.filterVariables.forEach((v) => {\r\n          filterFuncArgs.push(storageSettings['storageFilterValue-' + v.substring(1)]);\r\n        });\r\n\r\n        // Run the code to get the filter\r\n        try {\r\n          this._internal.filterFunc.apply(this, filterFuncArgs);\r\n        } catch (e) {\r\n          console.log('Error while running filter script: ' + e);\r\n        }\r\n\r\n        return { where: _filter };\r\n      }\r\n    },\r\n    getAggregates:function() {\r\n        if(!this._internal.aggregatesList) return {};\r\n        if(!this._internal.aggregates) return {};\r\n\r\n        const schema = CloudStore._collections;\r\n        const classSchema = schema[this._internal.name];\r\n        if(!classSchema || !classSchema.schema || !classSchema.schema.properties) return {};\r\n\r\n        const defs = this._internal.aggregates;\r\n        const aggs = {};\r\n        this._internal.aggregatesList.split(',').forEach(a => {\r\n            if(defs[a].prop === undefined) return;\r\n            const propSchema = classSchema.schema.properties[defs[a].prop];\r\n            if(propSchema === undefined) return;\r\n\r\n            const op = {}\r\n\r\n            const _def = (propSchema.type === 'String')?'distinct':'avg';\r\n            \r\n            op[defs[a].op || _def] = defs[a].prop;\r\n            aggs[a] = op;\r\n        })\r\n\r\n        return aggs;\r\n    },\r\n    getAggregateValue:function(name) {\r\n        if(!this._internal.aggregateValues) return;\r\n        return this._internal.aggregateValues[name];\r\n    },\r\n    registerOutputIfNeeded: function (name) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if(name.startsWith('agg-')) this.registerOutput(name, {\r\n        getter: this.getAggregateValue.bind(this, name.substring('agg-'.length))\r\n      });\r\n    },\r\n    setVisualFilter: function (value) {\r\n      this._internal.visualFilter = value;\r\n\r\n      if (this.isInputConnected('storageFetch') === false) this.scheduleFetch();\r\n    },\r\n    setQueryParameter: function (name, value) {\r\n      this._internal.queryParameters[name] = value;\r\n\r\n      if (this.isInputConnected('storageFetch') === false) this.scheduleFetch();\r\n    },\r\n    setAggregateParameter:function(name,value) {\r\n        const aggregates = this._internal.aggregates;\r\n        if(name.startsWith('aggprop-')) {\r\n            const _name = name.substring('aggprop-'.length);\r\n            if(!aggregates[_name]) aggregates[_name] = {}\r\n            aggregates[_name].prop = value;\r\n        }\r\n        else if(name.startsWith('aggop-')) {\r\n            const _name = name.substring('aggop-'.length);\r\n            if(!aggregates[_name]) aggregates[_name] = {}\r\n            aggregates[_name].op = value;\r\n        }\r\n    },\r\n    registerInputIfNeeded: function (name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith('agg'))\r\n      return this.registerInput(name, {\r\n        set: this.setAggregateParameter.bind(this, name)\r\n      });\r\n\r\n      if (name.startsWith('qp-'))\r\n        return this.registerInput(name, {\r\n          set: this.setQueryParameter.bind(this, name.substring('qp-'.length))\r\n        });\r\n\r\n      const dynamicSignals = {\r\n        storageFetch: this.scheduleFetch.bind(this)\r\n      };\r\n\r\n      if (dynamicSignals[name])\r\n        return this.registerInput(name, {\r\n          set: EdgeTriggeredInput.createSetter({\r\n            valueChangedToTrue: dynamicSignals[name]\r\n          })\r\n        });\r\n\r\n      const dynamicSetters = {\r\n        collectionName: this.setCollectionName.bind(this),\r\n        visualFilter: this.setVisualFilter.bind(this)\r\n      };\r\n\r\n      if (dynamicSetters[name])\r\n        return this.registerInput(name, {\r\n          set: dynamicSetters[name]\r\n        });\r\n\r\n      this.registerInput(name, {\r\n        set: userInputSetter.bind(this, name)\r\n      });\r\n    }\r\n  }\r\n};\r\n\r\nfunction userInputSetter(name, value) {\r\n  /* jshint validthis:true */\r\n  this._internal.storageSettings[name] = value;\r\n\r\n  if (this.isInputConnected('storageFetch') === false) this.scheduleFetch();\r\n}\r\n\r\nconst _defaultJSONQuery =\r\n  '// Write your query script here, check out the reference documentation for examples\\n' + 'where({ })\\n';\r\n\r\nfunction updatePorts(nodeId, parameters, editorConnection, graphModel) {\r\n  var ports = [];\r\n\r\n  const dbCollections = graphModel.getMetaData('dbCollections');\r\n  const systemCollections = graphModel.getMetaData('systemCollections');\r\n\r\n  const _systemClasses = [\r\n    { label: 'User', value: '_User' },\r\n    { label: 'Role', value: '_Role' }\r\n  ];\r\n  ports.push({\r\n    name: 'collectionName',\r\n    type: {\r\n      name: 'enum',\r\n      enums: _systemClasses.concat(\r\n        dbCollections !== undefined\r\n          ? dbCollections.map((c) => {\r\n              return { value: c.name, label: c.name };\r\n            })\r\n          : []\r\n      ),\r\n      allowEditOnly: true\r\n    },\r\n    displayName: 'Class',\r\n    plug: 'input',\r\n    group: 'General'\r\n  });\r\n\r\n  ports.push({\r\n    name: 'storageFilterType',\r\n    type: {\r\n      name: 'enum',\r\n      allowEditOnly: true,\r\n      enums: [\r\n        { value: 'simple', label: 'Visual' },\r\n        { value: 'json', label: 'Javascript' }\r\n      ]\r\n    },\r\n    displayName: 'Filter',\r\n    default: 'simple',\r\n    plug: 'input',\r\n    group: 'General'\r\n  });\r\n\r\n  ports.push({\r\n    type: 'signal',\r\n    plug: 'input',\r\n    group: 'Actions',\r\n    name: 'storageFetch',\r\n    displayName: 'Do'\r\n  });\r\n\r\n  if(parameters['aggregates'] !== undefined && parameters.collectionName !== undefined) {\r\n    var c = dbCollections && dbCollections.find((c) => c.name === parameters.collectionName);\r\n      if (c === undefined && systemCollections) c = systemCollections.find((c) => c.name === parameters.collectionName);\r\n      if (c && c.schema && c.schema.properties) {\r\n\r\n        const aggs = parameters['aggregates'].split(',');\r\n\r\n        const props = Object.keys(c.schema.properties).filter(k => c.schema.properties[k].type === 'Number' || c.schema.properties[k].type === 'String');\r\n\r\n        aggs.forEach(a => {\r\n            ports.push({\r\n                index:101,\r\n                name:'aggprop-'+a,\r\n                plug:'input',\r\n                type:{name:'enum',enums:props.map(k => ({value:k,label:k})),allowEditOnly:true},\r\n                displayName:'Property',\r\n                group:a\r\n            });\r\n\r\n            if(parameters['aggprop-'+a] !== undefined) {\r\n                const prop = parameters['aggprop-'+a];\r\n                const schema = c.schema.properties[prop];\r\n\r\n                if(schema && schema.type === 'Number') {\r\n                    // Number aggregate\r\n                    ports.push({\r\n                        index:102,\r\n                        name: 'aggop-' + a,\r\n                        plug: 'input',\r\n                        type: {name:'enum', enums:[{value:'min',label:'Min'},\r\n                                                    {value:'max',label:'Max'},\r\n                                                    {value:'sum',label:'Sum'},\r\n                                                    {value:'avg',label:'Avg'}],allowEditOnly:true},\r\n                        default:'avg',\r\n                        displayName: 'Operation',\r\n                        group: a\r\n                    })\r\n\r\n                    ports.push({\r\n                        name: 'agg-' + a,\r\n                        plug: 'output',\r\n                        type: 'number',\r\n                        displayName: a,\r\n                        group: 'Aggregates'\r\n                    })\r\n                }\r\n                else if(schema && schema.type === 'String') {\r\n                    // String aggregate\r\n                    ports.push({\r\n                        index:102,\r\n                        name: 'aggop-' + a,\r\n                        plug: 'input',\r\n                        type: {name:'enum', enums:[{value:'distinct',label:'Distinct'}],allowEditOnly:true},\r\n                        default:'distinct',\r\n                        displayName: 'Operation',\r\n                        group: a\r\n                    })\r\n\r\n                    ports.push({\r\n                        name: 'agg-' + a,\r\n                        plug: 'output',\r\n                        type: 'string',\r\n                        displayName: a,\r\n                        group: 'Aggregates'\r\n                    })\r\n                }\r\n            }\r\n\r\n        })\r\n    }\r\n  }\r\n\r\n  // Simple query\r\n  if (parameters['storageFilterType'] === undefined || parameters['storageFilterType'] === 'simple') {\r\n    if (parameters.collectionName !== undefined) {\r\n      var c = dbCollections && dbCollections.find((c) => c.name === parameters.collectionName);\r\n      if (c === undefined && systemCollections) c = systemCollections.find((c) => c.name === parameters.collectionName);\r\n      if (c && c.schema && c.schema.properties) {\r\n        const schema = JSON.parse(JSON.stringify(c.schema));\r\n\r\n        // Find all records that have a relation with this type\r\n        function _findRelations(c) {\r\n          if (c.schema !== undefined && c.schema.properties !== undefined)\r\n            for (var key in c.schema.properties) {\r\n              var p = c.schema.properties[key];\r\n              if (p.type === 'Relation' && p.targetClass === parameters.collectionName) {\r\n                if (schema.relations === undefined) schema.relations = {};\r\n                if (schema.relations[c.name] === undefined) schema.relations[c.name] = [];\r\n\r\n                schema.relations[c.name].push({ property: key });\r\n              }\r\n            }\r\n        }\r\n\r\n        dbCollections && dbCollections.forEach(_findRelations);\r\n        systemCollections && systemCollections.forEach(_findRelations);\r\n\r\n        ports.push({\r\n          name: 'visualFilter',\r\n          plug: 'input',\r\n          type: { name: 'query-filter', schema: schema, allowEditOnly: true },\r\n          displayName: 'Filter',\r\n          group: 'Filter'\r\n        });\r\n      }\r\n\r\n      if (parameters.visualFilter !== undefined) {\r\n        // Find all input ports\r\n        const uniqueInputs = {};\r\n        function _collectInputs(query) {\r\n          if (query === undefined) return;\r\n          if (query.rules !== undefined) query.rules.forEach((r) => _collectInputs(r));\r\n          else if (query.input !== undefined) uniqueInputs[query.input] = true;\r\n        }\r\n\r\n        _collectInputs(parameters.visualFilter);\r\n        Object.keys(uniqueInputs).forEach((input) => {\r\n          ports.push({\r\n            name: 'qp-' + input,\r\n            plug: 'input',\r\n            type: '*',\r\n            displayName: input,\r\n            group: 'Query Parameters'\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n  // JSON query\r\n  else if (parameters['storageFilterType'] === 'json') {\r\n    ports.push({\r\n      type: { name: 'string', allowEditOnly: true, codeeditor: 'javascript' },\r\n      plug: 'input',\r\n      group: 'Filter',\r\n      name: 'storageJSONFilter',\r\n      default: _defaultJSONQuery,\r\n      displayName: 'Filter'\r\n    });\r\n\r\n    var filter = parameters['storageJSONFilter'];\r\n    if (filter) {\r\n      filter = filter.replace(/\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/g, ''); // Remove comments\r\n      var variables = filter.match(/\\$[A-Za-z0-9]+/g);\r\n\r\n      if (variables) {\r\n        const unique = {};\r\n        variables.forEach((v) => {\r\n          unique[v] = true;\r\n        });\r\n\r\n        Object.keys(unique).forEach((p) => {\r\n          ports.push({\r\n            name: 'storageFilterValue-' + p.substring(1),\r\n            displayName: p.substring(1),\r\n            group: 'Filter Values',\r\n            plug: 'input',\r\n            type: { name: '*', allowConnectionsOnly: true }\r\n          });\r\n        });\r\n      }\r\n\r\n      // Support variables with the \"Inputs.\"\" syntax\r\n      JavascriptNodeParser.parseAndAddPortsFromScript(filter, ports, {\r\n        inputPrefix: 'storageFilterValue-',\r\n        inputGroup: 'Filter Values',\r\n        inputType: { name: '*', allowConnectionsOnly: true },\r\n        skipOutputs: true\r\n      });\r\n    }\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nmodule.exports = {\r\n  node: AggregateNode,\r\n  setup: function (context, graphModel) {\r\n    if (!context.editorConnection || !context.editorConnection.isRunningLocally()) {\r\n      return;\r\n    }\r\n\r\n    function _managePortsForNode(node) {\r\n      updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n\r\n      node.on('parameterUpdated', function (event) {\r\n        if (event.name.startsWith('storage') || event.name === 'visualFilter' || event.name === 'collectionName' || event.name.startsWith('agg')) {\r\n          updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n        }\r\n      });\r\n\r\n      graphModel.on('metadataChanged.dbCollections', function (data) {\r\n        CloudStore.invalidateCollections();\r\n        updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n      });\r\n\r\n      graphModel.on('metadataChanged.systemCollections', function (data) {\r\n        CloudStore.invalidateCollections();\r\n        updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n      });\r\n\r\n      graphModel.on('metadataChanged.cloudservices', function (data) {\r\n        CloudStore.instance._initCloudServices();\r\n      });\r\n    }\r\n\r\n    graphModel.on('editorImportComplete', () => {\r\n      graphModel.on('nodeAdded.noodl.cloud.aggregate', function (node) {\r\n        _managePortsForNode(node);\r\n      });\r\n\r\n      for (const node of graphModel.getNodesWithType('noodl.cloud.aggregate')) {\r\n        _managePortsForNode(node);\r\n      }\r\n    });\r\n  }\r\n};\r\n","'use strict';\r\n\r\nconst Model = require('@noodl/runtime/src/model');\r\nconst NoodlRuntime = require('@noodl/runtime');\r\nconst JavascriptNodeParser = require('@noodl/runtime/src/javascriptnodeparser');\r\n\r\n//Cloud functions override some of the JavascriptNodeParser functions\r\n\r\n//Override getComponentScopeForNode to just return an empty object. This basically disabled the 'Component' API in Function/Script nodes and removes a massive memory leak\r\n//Also improves performance.\r\nconst componentScope = {};\r\nJavascriptNodeParser.getComponentScopeForNode = function () {\r\n  return componentScope;\r\n};\r\n\r\n//override the Noodl API so it uses a model scope\r\nJavascriptNodeParser.createNoodlAPI = function (modelScope) {\r\n  return {\r\n    getProjectSettings: NoodlRuntime.instance.getProjectSettings.bind(NoodlRuntime.instance),\r\n    getMetaData: NoodlRuntime.instance.getMetaData.bind(NoodlRuntime.instance),\r\n    Object: modelScope || Model,\r\n    Variables: (modelScope || Model).get('--ndl--global-variables'),\r\n    Records: require('@noodl/runtime/src/api/records')(modelScope),\r\n    Users: require('./api/users')(modelScope),\r\n    //   CloudFunctions: require('./api/cloudfunctions'),\r\n    Files: require('./api/files'),\r\n    Objects: new Proxy(modelScope || Model, {\r\n      get(target, prop, receiver) {\r\n        return (modelScope || Model).get(prop);\r\n      },\r\n      set(obj, prop, value) {\r\n        (modelScope || Model).get(prop).setAll(value);\r\n      }\r\n    })\r\n  };\r\n};\r\n","const NoodlRuntime = require('@noodl/runtime');\r\nconst EventEmitter = require('@noodl/runtime/src/events');\r\n//const guid = require('../../../guid');\r\nconst Model = require('@noodl/runtime/src/model');\r\nconst CloudStore = require('@noodl/runtime/src/api/cloudstore');\r\n\r\nclass UserService {\r\n  constructor(modelScope) {\r\n    this.events = new EventEmitter();\r\n    this.events.setMaxListeners(100000);\r\n\r\n    // User is fetched and validate when the request is initiated\r\n    // see if there is a current user\r\n    const request = (modelScope || Model).get('Request');\r\n    if (request.UserId !== undefined) {\r\n      const user = (modelScope || Model).get(request.UserId);\r\n\r\n      this.current = user;\r\n    }\r\n\r\n    this.modelScope = modelScope;\r\n  }\r\n\r\n  on() {\r\n    this.events.on.apply(this.events, arguments);\r\n  }\r\n\r\n  off() {\r\n    this.events.off.apply(this.events, arguments);\r\n  }\r\n\r\n  _makeRequest(path, options) {\r\n    if (typeof _noodl_cloudservices === 'undefined') {\r\n      options.error && options.error({ error: 'No active cloud service', status: 0 });\r\n      return;\r\n    }\r\n\r\n    const cs = _noodl_cloudservices;\r\n\r\n    fetch(cs.endpoint + path, {\r\n      method: options.method || 'GET',\r\n      headers: {\r\n        'X-Parse-Application-Id': cs.appId,\r\n        'X-Parse-Master-Key': cs.masterKey,\r\n        'content-type': 'application/json',\r\n        'X-Parse-Session-Token': options.sessionToken\r\n      },\r\n      body: JSON.stringify(options.content)\r\n    })\r\n      .then((res) => {\r\n        if (res.ok) {\r\n          res.json().then((json) => options.success(json));\r\n        } else {\r\n          res.json().then((json) => options.error({ error: json.error, status: res.status }));\r\n        }\r\n      })\r\n      .catch((e) => {\r\n        options.error({ error: e.message });\r\n      });\r\n  }\r\n\r\n  setUserProperties(options) {\r\n    if (this.current !== undefined) {\r\n      //make a shallow copy to feed through CloudStore._serializeObject, which will modify the object\r\n      const propsToSave = CloudStore._serializeObject({ ...options.properties }, '_User', this.modelScope || Model);\r\n\r\n      const _content = Object.assign({}, { email: options.email, username: options.username }, propsToSave);\r\n\r\n      delete _content.createdAt; // Remove props you cannot set\r\n      delete _content.updatedAt;\r\n\r\n      this._makeRequest('/users/' + this.current.getId(), {\r\n        method: 'PUT',\r\n        content: _content,\r\n        success: (response) => {\r\n          // Store current user\r\n          for (let key in _content) {\r\n            this.current.set(key, _content[key]);\r\n          }\r\n          options.success(response);\r\n        },\r\n        error: (e) => {\r\n          options.error(e.error);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  logIn(options) {\r\n    this._makeRequest('/login', {\r\n      method: 'POST',\r\n      content: {\r\n        username: options.username,\r\n        password: options.password,\r\n        method: 'GET'\r\n      },\r\n      success: (user) => {\r\n        delete user.ACL;\r\n        delete user.className;\r\n        delete user.__type;\r\n\r\n        const _user = CloudStore._fromJSON(user, '_User', this.modelScope || Model);\r\n\r\n        options.success(_user);\r\n      },\r\n      error: (e) => {\r\n        options.error(e.error);\r\n      }\r\n    });\r\n  }\r\n\r\n  // Just fetch the user don't set to current\r\n  fetchUser(options) {\r\n    this._makeRequest('/users/me', {\r\n      method: 'GET',\r\n      sessionToken: options.sessionToken,\r\n      success: (user) => {\r\n        // Store current user\r\n        delete user.ACL;\r\n        delete user.className;\r\n        delete user.__type;\r\n\r\n        const _user = CloudStore._fromJSON(user, '_User', this.modelScope || Model);\r\n\r\n        options.success(_user);\r\n      },\r\n      error: (e) => {\r\n        options.error(e.error);\r\n      }\r\n    });\r\n  }\r\n\r\n  fetchCurrentUser(options) {\r\n    if (options.sessionToken) {\r\n      // Fetch the current user with the session token\r\n      this._makeRequest('/users/me', {\r\n        method: 'GET',\r\n        sessionToken: options.sessionToken,\r\n        success: (user) => {\r\n          // Store current user\r\n          delete user.ACL;\r\n          delete user.className;\r\n          delete user.__type;\r\n\r\n          this.current = CloudStore._fromJSON(user, '_User', this.modelScope || Model);\r\n          this.events.emit('sessionGained');\r\n          options.success(this.current);\r\n        },\r\n        error: (e) => {\r\n          options.error(e.error);\r\n        }\r\n      });\r\n    } else if (this.current !== undefined) {\r\n      // Fetch the current user, will use master key\r\n      this._makeRequest('/users/' + this.current.getId(), {\r\n        method: 'GET',\r\n        success: (user) => {\r\n          // Store current user\r\n          delete user.ACL;\r\n          delete user.className;\r\n          delete user.__type;\r\n\r\n          this.current = CloudStore._fromJSON(user, '_User', this.modelScope || Model);\r\n\r\n          options.success(this.current);\r\n        },\r\n        error: (e) => {\r\n          options.error(e.error);\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nUserService.forScope = (modelScope) => {\r\n  if (modelScope === undefined) return UserService.instance;\r\n  if (modelScope._userService) return modelScope._userService;\r\n\r\n  modelScope._userService = new UserService(modelScope);\r\n  return modelScope._userService;\r\n};\r\n\r\nvar _instance;\r\nObject.defineProperty(UserService, 'instance', {\r\n  get: function () {\r\n    if (_instance === undefined) _instance = new UserService();\r\n    return _instance;\r\n  }\r\n});\r\n\r\nNoodlRuntime.Services.UserService = UserService;\r\n\r\nmodule.exports = UserService;\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","import { CloudRunner } from '.';\r\n\r\nconsole.log('Noodl Editor Cloud Runtime!');\r\nconsole.log('Version: ' + _noodl_cloud_runtime_version);\r\n\r\nconst _runner = new CloudRunner({\r\n  webSocketClass: WebSocket,\r\n  connectToEditor: true,\r\n  editorAddress: 'ws://localhost:8574',\r\n  enableDebugInspectors: true\r\n});\r\n\r\n_runner.runtime.graphModel.on('editorImportComplete', () => {\r\n  ipcRenderer.send('noodl-cf-has-loaded-project');\r\n});\r\n\r\nconst handleRequest = async (functionName, req) => {\r\n  return await _runner.run(functionName, req);\r\n};\r\n\r\nconst eventQueue = [];\r\nlet hasScheduledProcessJobs = false;\r\nconst _noodl_process_jobs = () => {\r\n  hasScheduledProcessJobs = false;\r\n  while (eventQueue.length > 0) {\r\n    const cb = eventQueue.shift();\r\n    cb();\r\n  }\r\n};\r\n\r\nconst _setImmediate = window.setImmediate;\r\nwindow.setImmediate = (cb) => {\r\n  eventQueue.push(cb);\r\n  if (!hasScheduledProcessJobs) {\r\n    hasScheduledProcessJobs = true;\r\n    _setImmediate(_noodl_process_jobs);\r\n  }\r\n};\r\n\r\nconst _fetch_response_handlers = {};\r\nconst _fetch = window.fetch;\r\nwindow.fetch = function (url, args) {\r\n  if (args && args.platform === 'node') {\r\n    return new Promise((resolve, reject) => {\r\n      // Perform the fetch via the host node platform\r\n      const token = Math.random().toString(26).slice(2);\r\n      _fetch_response_handlers[token] = (args) => {\r\n        if (args.error === undefined) {\r\n          const res = {\r\n            body: args.body,\r\n            status: args.status,\r\n            headers: args.headers,\r\n            ok: args.status === 200 || args.status === 201\r\n          };\r\n          res.json = () => {\r\n            try {\r\n              return Promise.resolve(JSON.parse(res.body));\r\n            } catch (e) {\r\n              return Promise.reject('Failed to parse JSON response');\r\n            }\r\n          };\r\n          res.text = () => {\r\n            return Promise.resolve(res.body);\r\n          };\r\n\r\n          resolve(res);\r\n        } else reject(args.error);\r\n      };\r\n\r\n      ipcRenderer.send('noodl-cf-fetch', {\r\n        url,\r\n        method: args.method,\r\n        token,\r\n        headers: JSON.parse(JSON.stringify(args.headers)),\r\n        body: args.body\r\n      });\r\n    });\r\n  } else return _fetch(url, args);\r\n};\r\n\r\nipcRenderer.on('noodl-cf-fetch-response', async function (event, args) {\r\n  if (typeof _fetch_response_handlers[args.token] === 'function') {\r\n    typeof _fetch_response_handlers[args.token](args);\r\n    delete _fetch_response_handlers[args.token];\r\n  }\r\n});\r\n\r\nipcRenderer.on('noodl-cf-request', async function (event, args) {\r\n  if (args.cloudService) {\r\n    window._noodl_cloudservices = {\r\n      endpoint: args.cloudService.endpoint,\r\n      appId: args.cloudService.appId,\r\n      masterKey: args.cloudService.masterKey\r\n    };\r\n  }\r\n\r\n  console.info(`Cloud function ${args.function} called`);\r\n\r\n  try {\r\n    // args.function\r\n    // args.headers\r\n    // args.body\r\n\r\n    const res = await handleRequest(args.function, {\r\n      body: args.body,\r\n      headers: args.headers\r\n    });\r\n\r\n    console.info(`Cloud function ${args.function} response [${res.statusCode}]`);\r\n\r\n    event.sender.send('noodl-cf-response', Object.assign({}, res, { token: args.token }));\r\n  } catch (e) {\r\n    console.error(`Cloud function ${args.function} response [400] message: ${e.message}`);\r\n\r\n    event.sender.send('noodl-cf-response', {\r\n      token: args.token,\r\n      statusCode: 400,\r\n      body: JSON.stringify({ error: e.message })\r\n    });\r\n  }\r\n});\r\n"],"names":["HASH_UNDEFINED","MAX_SAFE_INTEGER","argsTag","funcTag","genTag","reIsHostCtor","freeGlobal","g","Object","freeSelf","self","root","Function","arrayIncludes","array","value","length","fromIndex","predicate","fromRight","index","baseFindIndex","baseIsNaN","baseIndexOf","arrayIncludesWith","comparator","arrayPush","values","offset","cacheHas","cache","key","has","uid","arrayProto","Array","prototype","funcProto","objectProto","coreJsData","maskSrcKey","exec","keys","IE_PROTO","funcToString","toString","hasOwnProperty","objectToString","reIsNative","RegExp","call","replace","Symbol","propertyIsEnumerable","splice","spreadableSymbol","isConcatSpreadable","undefined","nativeMax","Math","max","Map","getNative","nativeCreate","Hash","entries","this","clear","entry","set","ListCache","MapCache","SetCache","__data__","add","assocIndexOf","other","baseFlatten","depth","isStrict","result","isFlattenable","getMapData","map","type","data","object","getValue","isObject","pattern","isFunction","e","isHostObject","test","func","toSource","baseIsNative","isArray","isArrayLikeObject","isArguments","get","pop","push","start","difference","iteratee","includes","isCommon","valuesLength","arrayMap","outer","computed","valuesIndex","baseDifference","args","arguments","otherArgs","thisArg","apply","isObjectLike","isLength","isArrayLike","tag","module","exports","constructor","options","runtime","platform","requestUpdate","f","setImmediate","getCurrentTime","Date","getTime","o","JSON","stringify","webSocketClass","isRunningLocally","connectToEditor","componentFilter","c","name","startsWith","dontCreateRootComponent","registerNodes","setDebugInspectorsEnabled","enableDebugInspectors","editorAddress","async","exportData","projectSettings","setData","setProjectSettings","functionName","request","Promise","resolve","reject","requestId","random","slice","requestScope","context","modelScope","Scope","createComponentInstanceNode","then","functionComponent","requestNode","nodeScope","getNodesWithType","hasResponded","getNodesWithTypeRecursive","forEach","resp","_internal","_sendResponseCallback","_onNodeDeleted","reset","sendRequest","catch","Error","node","displayNodeName","category","docs","useVariants","mountedInput","allowAsExportRoot","singleton","color","connectionPanel","groupPriority","outputs","receive","displayName","group","auth","getter","authenticated","userId","authUserId","inputs","allowNoAuth","default","params","allowEditOnly","initialize","requestParameters","userProperties","Authenticated","methods","getRequestParameter","setRequestParameter","hasOutput","flagOutputDirty","fetchCurrentUser","sessionToken","Services","UserService","forScope","success","error","req","headers","parse","body","userModel","current","getId","instance","getConfig","requestModel","sendSignalOnOutput","registerOutputIfNeeded","registerOutput","bind","substring","graphModel","_managePortsForNode","_updatePorts","ports","parameters","i","split","p","plug","editorConnection","sendDynamicPorts","id","on","event","dynamicports","condition","responseParameters","errorMessage","send","valueChangedToTrue","status","statusCode","enums","label","setResponseParameter","registerInputIfNeeded","hasInput","registerInput","nodeDefinition","registerNode","NodeContext","EditorConnection","generateNodeLibrary","ProjectSettings","GraphModel","NodeDefinition","Node","EditorModelEventsHandler","EdgeTriggeredInput","EventEmitter","asyncPool","NoodlRuntime","noodlModules","eventEmitter","updateScheduled","rootComponent","_currentLoadedData","isWaitingForExport","errorHandlers","frameNumber","runningInEditor","runDeployed","webSocketOptions","noodlRuntime","runtimeType","scheduleUpdate","_setupEditorCommunication","registerGraphModelListeners","prefetchBundles","bundleNames","numParallelFetches","fetchComponentBundle","objectEquals","x","y","every","indexOf","isEmpty","components","filter","componentIndex","allBundles","emit","reload","onModelUpdateReceived","onMetaDataUpdateReceived","sendNodeLibrary","enabled","registerModule","nodes","component","registerComponentModel","deregisterComponentModel","location","definedNode","defineNode","nodeRegister","register","setupNumberedInputDynamicPorts","setup","_setRootComponent","rootComponentName","model","removeListenersWithRef","componentModel","setRootComponent","graphData","_disableLoad","importEditorData","setTimeout","_doUpdate","currentFrameTime","update","settings","getNodeLibrary","generateProjectSettings","getSettings","concat","nodeLibrary","projectsettings","lastSentNodeLibrary","address","connect","EditorMetaDataEventsHandler","handleEvent","addErrorHandler","callback","reportError","message","eh","getProjectSettings","getMetaData","url","getUrl","getName","Model","Collection","CloudFile","_protectedFields","_common","_User","_removeProtectedFields","className","_data","assign","CloudStore","_initCloudServices","events","setMaxListeners","_fromJSON","item","collectionName","_deserializeJSON","_serializeObject","_collections","cloudServices","appId","endpoint","dbVersionMajor","off","_makeRequest","path","_noodl_cloud_runtime_version","xhr","XMLHttpRequest","onreadystatechange","readyState","json","response","responseText","open","method","setRequestHeader","_noodl_cloudservices","masterKey","_cu","localStorage","currentUser","onUploadProgress","upload","onprogress","pe","content","File","fetch","r","query","collection","_method","where","limit","skip","include","join","select","order","sort","count","results","aggregate","grouping","k","_g","_id","encodeURIComponent","objectId","res","distinct","property","excludeKeys","create","ACL","acl","_obj","increment","properties","__op","amount","save","createdAt","updatedAt","delete","addRelation","_content","objects","__type","targetObjectId","targetClass","removeRelation","uploadFile","file","contentType","err","deleteFile","_toJSON","obj","items","m","schema","_type","instanceOf","iso","toISOString","cloudFile","exists","latitude","Number","longitude","a","_isArrayOfObjects","_class","_instance","_cloudStore","defineProperty","invalidateCollections","ConfigService","cacheDuration","_getConfig","config","configCachePending","configCache","now","ttl","clearCache","_value","v","convertVisualFilter","queryParameters","combinator","rules","_res","_op","cond","operator","input","$relatedTo","relatedTo","relationProperty","$exists","$gt","$gte","$lt","$lte","$eq","$ne","$regex","$options","compareObjects","b","_s","prop","matchesQuery","match","q","convertVisualSorting","sorting","s","convertFilterOp","$in","modelId","relationKey","opAndValue","$nin","_v","$text","$search","$term","$caseSensitive","term","$language","language","caseSensitive","$diacriticSensitive","diacriticSensitive","$nearSphere","$maxDistanceInMiles","$maxDistanceInKilometers","maxDistanceInKilometers","$maxDistanceInRadians","maxDistanceInRadians","$within","$box","gp","$geoWithin","$polygon","QueryUtils","_cloudstore","cloudstore","_results","objectOrId","record","notify","recordId","targetRecordId","targetRecord","targetClassName","poolLimit","iteratorFn","ret","executing","race","all","enumerable","writable","src","bItems","aItems","aKeys","keyIndex","bKeys","removeAtIndex","min","remove","addAtIndex","_listeners","l","contains","idx","listener","collections","guid","createSetter","currentValue","currentWarnings","setWarning","nodeId","warning","warningKeys","clearWarning","clearWarnings","EventSender","ActiveWarnings","opts","_opts","ws","WebSocket","wsOptions","reconnectOnClose","enableDebugger","lastSendTimestamp","sendQueue","sendTimer","activeWarnings","document","hostname","socket","addEventListener","clientId","cmd","reconnect","console","log","code","reason","evt","text","target","debugInspectorsEnabled","inspectors","connectionId","pubsub","routeMessage","isConnected","OPEN","dt","trySend","msg","seen","WeakSet","getCircularReplacer","chunk","sendInspectId","sendSelectComponent","componentName","sendPulsingConnections","connectionMap","connectionsToPulse","connection","connections","sendDebugInspectorValues","sendConnectionValue","dynamicPortsHash","hash","detectRenamed","renamed","d","before","after","prefix","_detectRename","patterns","nodeid","sendWarning","sendPatches","patches","requestFullExport","requestNoodlModules","serviceRequests","sendServiceRequest","token","close","nodelibrary","sendComponentMetadata","sendProjectMetadata","array1","array2","valueSet","Set","applyPortDelta","nodeModel","newPorts","inputPorts","outputPorts","port","existingInputs","getInputPorts","inputPortsToRemove","inputPortsToAdd","updateInputPortTypes","removeInputPortWithName","portName","addInputPort","setInputValueOnNodeInstancesWithModel","updateOutputPortTypes","existingOutputs","getOutputPorts","outputPortsToRemove","outputPortsToAdd","removeOutputPortWithName","addOutputPort","getNodesWithIdRecursive","queueInput","getComponentWithName","eventHandlers","nodeAdded","importEditorNodeData","parentId","childIndex","nodeRemoved","hasNodeWithId","removeNodeWithId","connectionAdded","addConnection","connectionRemoved","removeConnection","targetNodeModel","getNodeWithId","targetId","getConnectionsToPort","targetPort","getDefaultValueForInput","parameterChanged","allParams","oldParameters","param","setParameter","parameterName","parameterValue","state","nodeAttached","setNodeParent","nodeDetached","addRootId","componentAdded","importComponentFromEditorData","componentRemoved","removeComponentWithName","rootAdded","portAdded","portRemoved","nodePortRenamed","renameInputPortOnNodeWithId","oldName","renameOutputPortOnNodeWithId","componentInstance","componentPortsUpdated","instancePortsChanged","componentRenamed","renameComponent","newName","settingsChanged","setSettings","metadataChanged","setMetaData","componentMetadataChanged","setMetadata","variantParametersChanged","variant","updateVariant","updateVariantParameter","variantName","variantTypeName","getVariant","getAllNodesWithVariantRecursive","getParameter","variantDeleted","deleteVariant","variantChanged","setVariant","variantRenamed","oldVariantName","defaultStateTransitionChanged","setDefaultStateTransition","curve","stateTransitionsChanged","setStateTransitionParamter","variantDefaultStateTransitionChanged","updateVariantDefaultStateTransition","variantStateTransitionsChanged","updateVariantStateTransition","routerIndexChanged","routerIndex","ReflectOwnKeys","R","Reflect","ReflectApply","receiver","ownKeys","getOwnPropertySymbols","getOwnPropertyNames","NumberIsNaN","isNaN","init","once","emitter","errorListener","removeListener","resolver","eventTargetAgnosticAddListener","handler","flags","addErrorHandlerIfEventEmitter","_events","_eventsCount","_maxListeners","defaultMaxListeners","checkListener","TypeError","_getMaxListeners","that","_addListener","prepend","existing","newListener","unshift","warned","w","String","warn","onceWrapper","fired","wrapFn","_onceWrap","wrapped","unwrap","evlistener","arr","unwrapListeners","arrayClone","listenerCount","n","copy","wrapListener","arg","removeEventListener","RangeError","getPrototypeOf","getMaxListeners","doError","er","len","listeners","addListener","prependListener","prependOnceListener","list","position","originalListener","shift","spliceOne","removeAllListeners","rawListeners","eventNames","listenersWithRefs","eventName","ref","callbacks","s4","floor","getAbsoluteUrl","userFunctionsCache","JavascriptNodeParser","_initializeAPIs","userCode","getCodePrefix","define","script","apis","getComponentScopeForNode","_afterSourced","userObject","change","run","destroy","definedObject","_userObjectExtended","_this","_extended","setOutputs","states","old","_oldInputs","changed","changedFunction","signals","_scriptExtend","Inputs","Outputs","Signals","Setters","_Node","_outputs","OnInit","OnDestroy","destory","changedInputs","OnInputsChanged","createFromCode","createFromURL","window","DONE","onerror","parseAndAddPortsFromScript","_addPortsFromMatch","unique","find","skipInputs","matchAll","inputType","inputGroup","inputPrefix","skipOutputs","skipOutputSignals","outputPrefix","skipRegularOutputs","getPorts","inputPort","_componentScopes","componentId","componentOwner","getInstanceId","componentObject","parentComponentObjectId","parent","getParentComponent","getRoots","getVisualParentNode","parentNodeScope","_findParentComponentStateModelId","parentComponentObject","ParentObject","RepeaterObject","_forEachModel","_findForEachModel","createNoodlAPI","Noodl","models","_models","proxies","_modelProxyHandler","getOwnPropertyDescriptor","_randomString","size","chars","Proxy","modelData","setAll","fill","temp","forceChange","oldValue","silent","toJSON","NodeModel","ComponentModel","roots","metadata","addNode","getAllNodes","findIndex","con","sourceId","sourcePort","getConnectionsFromPort","sourcePortName","targetPortName","getConnectionsFrom","getConnectionsTo","rootId","removeRootId","children","child","getAllConnections","getInputPort","getOutputPort","childModel","newParentModel","removeChild","addChild","nodeData","createFromExportData","rename","getMetadata","componentData","addComponent","getBundleContainingComponent","componentToBundleMap","getBundlesContainingSheet","sheetName","bundles","isOnDefaultSheet","from","getBundleDependencies","bundleName","recurse","bundle","dep","dependencies","variants","setAllMetaData","setRootComponentName","componentNames","hasComponentWithName","getAllComponents","_addComponentPorts","_onNodeAdded","_onNodeRemoved","_onNodeWasRemoved","getVariants","typename","stateParameters","transition","defaultStateTransitions","stateTransitions","setParameters","setStateParameters","setStateTransitions","parameter","stateTransition","OutputProperty","_dirty","_inputs","_inputValues","_inputConnections","_outputList","_isUpdating","_inputValuesQueue","_afterInputsHaveUpdatedCallbacks","_signalsSentThisUpdate","_deleted","_deleteListeners","_isFirstUpdate","_valuesFromConnections","updateOnDirtyFlagging","getInputValue","units","defaultUnit","deregisterInput","registerInputs","getInput","setInputValue","currentInputValue","unit","newValue","styles","resolveColor","eval","showGlobally","output","newOutput","owner","onFirstConnectionAdded","onLastConnectionRemoved","deregisterOutput","hasConnections","registerOutputs","getOutput","connectInput","inputName","sourceNode","registerConnection","_setValueFromConnection","outputValue","connectionSentValue","flagDirty","removeInputConnection","sourceNodeId","inputsToPort","deregisterConnection","isInputConnected","some","_updatedAtIteration","updateIteration","_updateIteration","_cyclicLoop","_updateDependencies","inputNames","hasMoreInputs","queue","afterInputCallbacks","scheduleNextFrame","nodeIsDirty","_cyclicWarningSent","isWarningTypeEnabled","connectedPorts","_performDirtyUpdate","flagDependeesDirty","sendValue","flagAllOutputsDirty","outputName","scheduleAfterInputsHaveUpdated","connectionSentSignal","_hasInputBeenSetFromAConnection","queueValue","setNodeModel","_onNodeModelParameterUpdated","_onNodeModelVariantUpdated","addDeleteListener","deleteListener","_getVisualStates","defaultValue","_resetReactVirtualDOM","NodeRegister","TimerScheduler","Variants","_dirtyNodes","callbacksAfterUpdate","eventSenderEmitter","globalValues","globalsEventEmitter","timerScheduler","componentModels","connectionsToPulseChanged","debugInspectors","connectionPulsingCallbackScheduled","_outputHistory","_signalHistory","warningTypes","bundleFetchesInFlight","getNodeScope","onDebugInspectorsUpdated","inspector","fromId","fromProperty","updateDirtyNodes","loop","iterations","isUpdating","dirtyNodes","stack","hasPendingTimers","runTimers","runningTimers","newTimers","clearDebugInspectors","scheduleAfterUpdate","setGlobalValue","getGlobalValue","fetchBundle","bundleUrl","Env","promise","getComponentModel","bundleDep","hasComponentModelWithName","extraProps","setComponentModel","_formatConnectionValue","HTMLElement","tagName","timestamp","inputPortName","clearOldConnectionPulsing","_getDebugInspectorValueForNode","getInspectInfo","info","valuesToSend","inspectorValue","sendGlobalEventFromEventSender","channelName","inputValues","setPopupCallbacks","onShow","onClose","onShowPopup","onClosePopup","showPopup","popupComponent","popupNode","createNode","inputKey","popupParent","senderNode","createPrimitiveNode","bodyScroll","closePopupNodes","j","_setCloseCallback","action","deleteNode","requestAnimationFrame","setWarningTypes","nodeType","hasNode","inputMetadata","getNodeMetadata","registerNumberedInput","oldRegisterInputIfNeeded","exportDynamicPorts","allowChildren","allowChildrenWithCategory","allowAsChild","visualStates","panels","usePortAsLabel","portLabelTruncationMode","deprecated","haveComponentPorts","version","nodeDoubleClickAction","searchTags","prototypeExtensions","NodeConstructor","setUnitType","editorName","exportToEditor","inputPriority","tooltip","tab","popout","allowVisualStates","allowConnectionsOnly","registerOutputsMetadata","propName","nodeScopeDidInitialize","defaultValues","inputsMetadata","numberedInputs","registerNumberedInputs","updatePorts","portNames","numPorts","displayPrefix","collectPorts","flat","registerSetupFunctionForNumberedInputs","extend","obj1","obj2","oldInit","formatPort","portData","plugType","description","typecasts","to","colors","base","baseHighlighted","header","headerHighlighted","outline","outlineHighlighted","visual","javascript","signal","normal","highlighted","pulsing","nodetypes","shortDesc","haveComponentChildren","nodeTypes","_constructors","nodeMetadata","nodeObj","shortDocs","dp","template","channelPort","dynamicPortGroup","formatDynamicPorts","selectorNames","conditionalPortNames","nodeIndex","coreNodes","subCategories","moduleNodes","getInputType","title","canArrangeInGroups","hidden","NodeScope","componentIdCounter","ComponentInstanceNode","childRoot","componentOutputValues","componentOutputs","componentInputs","instanceId","registerComponentInputPort","registerComponentOutputPort","forceUpdate","removeNodesWithId","componentInput","setOutputFromComponentOutput","creatorCallbacks","onOutputChanged","setChildRoot","prevChildRoot","newChildRoot","isChild","getChildRootIndex","getChildRoot","triggerDidMount","render","setChildIndex","getChildren","componentOutput","getRef","cachedChildren","AndNode","and","currentSelectedIndex","indexChanged","trueString","falseString","currentInput","inputChanged","ConditionNode","scheduleEvaluate","ontrue","onfalse","isfalse","CounterNode","startValue","startValueSet","limitsEnabled","limitsMin","limitsMax","increase","decrease","currentCount","countChanged","CloudFileNode","DbCollectionNode","collectionChangedScheduled","collectionChangedCallback","cloudStoreEvents","currentQuery","_addModelAtCorrectIndex","storageSettings","firstItemId","firstItem","fetched","failure","setCollectionName","scheduleFetch","setCollection","bindCollection","unbindCurrentCollection","setError","internal","fetchScheduled","_c","getStorageFilter","getStorageLimit","getStorageSkip","getStorageFetchTotalCount","storageTotalCount","visualFilter","visualSorting","filterFunc","filterCode","filterVariables","_filter","_sort","_filterCb","filterFuncArgs","userOutputGetter","setVisualFilter","setVisualSorting","setQueryParameter","dynamicSignals","storageFetch","dynamicSetters","visualSort","userInputSetter","dbCollections","systemCollections","_findRelations","relations","uniqueInputs","_collectInputs","codeeditor","variables","ConfigNodeDefinition","useDevValue","devValue","configKey","setInternal","configSchema","valueType","isCloud","masterKeyOnly","addInputProperties","def","_def","_methods","_setInputValue","addModelId","_includeInputs","includeInputs","_includeOutputs","includeOutputs","idSource","setModel","identifierOf","identifierDisplayName","setModelID","setCollectionID","collectionId","addBaseInfo","_includeInputProperties","includeInputProperties","_includeRelations","includeRelations","scheduleOnce","cb","checkWarningsBeforeCloudOp","props","_typeMap","Boolean","_p","_additionalDynamicPorts","addRelationProperty","targetModelId","setRelationProperty","addAccessControl","accessControl","autoName","accessControlRules","_super","ac","parentItemId","setAccessControl","_getACL","_rule","rule","read","write","currentUserId","UserId","cu","_getCurrentUser","userid","role","_parts","DbModelCRUDBase","AddDbModelRelationNodeDefinition","store","scheduleAddRelation","relationAdded","validateInputs","_warning","_key","scheduleRemoveRelation","relationRemoved","ModelNodeDefinition","relationModelIds","onModelChangedCallback","scheduleStore","DeleteDbModelPropertiedNodeDefinition","storageDelete","deleted","ModelScope","FilterDBModelsNode","scheduleFilter","filterSettings","filterParameters","filteredCollection","modified","getLimit","getSkip","filtered","setFilterParameter","_supportedTypes","Pointer","_addBaseInfo","_addModelId","_addInputProperties","_types","inputTypes","_pushInputValues","_defaultValueForType","boolean","string","number","date","_allKeys","validProperties","keysToSet","hasScheduledStore","_setInputType","dirtyValues","scheduleSetModel","hasScheduledSetModel","NewDbModelPropertiedNodeDefinition","storageInsert","sourceObjectId","created","initValues","ModelCRUDBase","NewModelNodeDefinition","new","scheduleNew","hasScheduledNew","newModel","RestNode","outputValues","outputValuesProxy","inspectData","resource","requestScript","requestFunc","responseScript","responseFunc","cancel","cancelFetch","canceled","getScriptOutputValue","setScriptInputValue","hasScheduledFetch","doFetch","doResponse","doExternalFetch","_xhr","sentResponse","responseType","getResponseHeader","rawResponse","responseData","toLowerCase","onabort","raw","abort","_parseScriptForErrors","_exists","scriptWithoutComments","SetDbModelPropertiedNodeDefinition","storeType","scheduleSave","storeProperties","stored","SetModelPropertiedNodeDefinition","DateToStringNode","formatString","_format","dateString","onError","t","format","getDate","month","getMonth","monthShort","Intl","DateTimeFormat","year","getFullYear","yearShort","hours","getHours","minutes","getMinutes","seconds","getSeconds","ExpressionNode","focusPort","scope","hasScheduledEvaluation","cachedValue","currentExpression","compiledFunction","expression","functionPreamble","newInputs","parsePorts","inputsToAdd","inputsToRemove","_scheduleEvaluateExpression","isTrue","isFalse","isTrueEv","isFalseEv","lastValue","_calculateExpression","_compileFunction","inputValue","compiledFunctionsCache","F","construct","portsToIgnore","addPort","identifiers","editAsType","evalCompileWarnings","invert","InverterNode","OrNode","RunTasksDefinition","queuedOperations","maxRunningTasks","activeTasks","stopOnFailure","taskTemplate","scheduleRun","scheduleAbort","done","aborted","hasScheduledRun","_queueOperation","hasScheduledAbort","itemNode","_forEachNode","_isInputConnected","itemOutputSignalTriggered","task","taskComponent","createTaskComponent","runningTasks","numTasks","failedTasks","completedTasks","queuedTasks","startTask","checkDone","op","_runQueueOperations","runningOperations","_deleteAllTasks","logJavaScriptNodeError","SimpleJavascriptNode","scriptInputs","scriptOutputs","functionScript","parseScript","runScheduled","runScript","_isSignalType","_sendSignal","setScriptInputType","setScriptOutputType","outputTypes","AsyncFunction","inputTypeEnums","_outputTypeEnums","_parseScriptForErrorsAndPorts","ev","StringFormatDefinition","cachedResult","resultDirty","formatValue","multiline","scheduleFormat","formatted","matches","formatScheduled","StringMapperNode","mappings","mappedString","scheduleMapping","inputString","currentInputString","defaultMapping","doMapping","startIndex","endIndex","end","substr","UniqueIdNode","SetUserPropertiesNodeDefinition","email","username","storeScheduled","setUserProperties","setUserProperty","_ignoreKeys","UserNodeDefinition","userService","setUserModel","getUserProperty","BooleanNode","createDefinition","cast","NumberNode","VariableBase","StringNode","onChanged","latestValue","setValueTo","saveValue","savedValue","componentInstanceChildren","connectionData","targetNode","setNodeParameters","inputA","inputB","createNodeFromModel","insertNodeInTree","parentInstance","nodeInstance","findNodesWithIdRec","getAllNodesRecursive","getAllNodesRec","onNodeModelRemoved","connectionModel","conn","connectionFrom","connectionTo","sendEventFromThisScope","propagation","sendEventInThisScope","_exclude","eventReceivers","eventReceiver","getChannelName","defineProperties","_lastUpdateIteration","valuesSendThisIteration","modules","addModuleSettings","Timer","scheduler","duration","_isRunning","_hasCalledOnStart","repeatCount","delay","requestFrameCallback","requestFrame","stop","scheduleTimer","stopTimer","_wasStopped","isRunning","durationLeft","_durationLeft","createTimer","timer","onStop","currentTime","remainingTimers","finishedTimers","timersThisFrame","_start","onStart","localT","onRunning","onFinish","_url","baseUrl","onVariantUpdated","nodesWithVariant","files","fileName","RecordsAPI","Records","api","password","logIn","user","users","equalTo","pointsTo","expiresAt","greaterThan","installationId","sessions","_fetchUser","fetchUser","restricted","Properties","AggregateNode","aggregates","aggregateValues","aggregatesList","validateAggNames","getAggregates","classSchema","defs","aggs","propSchema","getAggregateValue","setAggregateParameter","_name","componentScope","Variables","Users","Files","Objects","cs","ok","propsToSave","_user","_userService","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","__esModule","definition","globalThis","_runner","CloudRunner","ipcRenderer","eventQueue","hasScheduledProcessJobs","_noodl_process_jobs","_setImmediate","_fetch_response_handlers","_fetch","cloudService","function","handleRequest","sender"],"sourceRoot":""}