{"version":3,"file":"noodl.viewer.js","mappings":"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,KACA,YACA,aAGJ,CACEpwB,KAAM,SACNowB,MAAO,CAAC,eAAgB,mBAE1B,CACEpwB,KAAM,sBACNowB,MAAO,CACL,YACA,gBACA,gBACA,iBACA,cAGJ,CACEpwB,KAAM,SACNowB,MAAO,CAAC,oBAAqB,qBAE/B,CACEpwB,KAAM,YACNowB,MAAO,CAAC,SAAU,UAAW,QAAS,aAI5C,CACEpwB,KAAM,sBACNkxC,YAAa,qCACb3qC,KAAM,YACNs3D,cAAe,CACb,CACE79D,KAAM,GACNowB,MAAO,CACL,mBACA,oBACA,qBACA,4BACA,kCACA,yCACA,mDAKR,CACEpwB,KAAM,oBACNkxC,YAAa,8BACb3qC,KAAM,OACNs3D,cAAe,CACb,CACE79D,KAAM,GACNowB,MAAO,CACL,WACA,WACA,mBACA,SACA,qBACA,WACA,eACA,cAGJ,CACEpwB,KAAM,QACNowB,MAAO,CACL,cACA,gBACA,mBACA,kBACA,mBACA,oBACA,iBACA,gBAGJ,CACEpwB,KAAM,aACNowB,MAAO,CACL,WACA,uBACA,iBACA,uBACA,gBACA,0BACA,qBACA,wBACA,aACA,cACA,iBACA,aAGJ,CACEpwB,KAAM,OACNowB,MAAO,CACL,uBACA,wBACA,wBACA,sBACA,mCACA,6BACA,uCACA,+BACA,wCAGJ,CACEpwB,KAAM,gBACNowB,MAAO,CAAC,YAId,CACEpwB,KAAM,cACNkxC,YAAa,4BACb3qC,KAAM,aACNs3D,cAAe,CACb,CACE79D,KAAM,GACNowB,MAAO,CACL,aACA,qBACA,cACA,qBAKR,CACEpwB,KAAM,kBACNkxC,YAAa,sCACb3qC,KAAM,OACNs3D,cAAe,CACb,CACE79D,KAAM,GACNowB,MAAO,CAAC,sBAAuB,yBAEjC,CACEpwB,KAAM,aACNowB,MAAO,CAAC,8BAUhB,MAAM0tC,EAAwB,GAkB9B,OAhBAd,EAAU51C,SAAS7gB,IACKi7B,EAAqB5D,cAAcr3B,GAAMw3B,SAC9Ch8B,QACf+7D,EAAYt+D,KAAK+G,EACnB,IAGEu3D,EAAYp9D,SACduV,EAAI0nD,UAAUG,YAAc,CAC1B,CACE9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QAAS,aAIlD,CACIpwB,KAAM,sBACNkxC,YAAa,qCACb3qC,KAAM,YACNs3D,cAAe,CACX,CACI79D,KAAM,GACNowB,MAAO,CACH,mBACA,oBACA,qBACA,4BACA,kCACA,yCACA,mDAKhB,CACIpwB,KAAM,oBACNkxC,YAAa,8BACb3qC,KAAM,OACNs3D,cAAe,CACX,CACI79D,KAAM,GACNowB,MAAO,CACH,WACA,WACA,mBACA,SACA,qBACA,WACA,eACA,cAGR,CACIpwB,KAAM,QACNowB,MAAO,CACH,cACA,gBACA,mBACA,kBACA,mBACA,oBACA,iBACA,gBAGR,CACIpwB,KAAM,aACNowB,MAAO,CACH,WACA,uBACA,iBACA,uBACA,gBACA,0BACA,qBACA,wBACA,aACA,cACA,iBACA,aAGR,CACIpwB,KAAM,OACNowB,MAAO,CACH,uBACA,wBACA,wBACA,sBACA,mCACA,6BACA,uCACA,+BACA,wCAGR,CACIpwB,KAAM,gBACNowB,MAAO,CAAC,YAIpB,CACIpwB,KAAM,cACNkxC,YAAa,4BACb3qC,KAAM,aACNs3D,cAAe,CACX,CACI79D,KAAM,GACNowB,MAAO,CACH,aACA,qBACA,cACA,qBAKhB,CACIpwB,KAAM,kBACNkxC,YAAa,sCACb3qC,KAAM,OACNs3D,cAAe,CACX,CACI79D,KAAM,GACNowB,MAAO,CAAC,sBAAuB,yBAEnC,CACIpwB,KAAM,aACNowB,MAAO,CAAC,8BAQxB,MAAM0tC,EAAc,GAepB,OAdAd,EAAU51C,SAAS7gB,IACMi7B,EAAa5D,cAAcr3B,GAAMw3B,SACrCh8B,QACb+7D,EAAYt+D,KAAK+G,EACrB,IAEAu3D,EAAYp9D,SACZuV,EAAI0nD,UAAUG,YAAc,CACxB,CACI99D,KAAM,GACNowB,MAAO0tC,KAIZ7nD,CACX,CAEA,SAAS6lD,kBAAkB31D,EAAQ4G,GAE/B,IAAK,IAAIvM,EAAI,EAAGA,EAAIuM,EAAQrM,OAAQF,IAAK,CACrC,MAAMwQ,EAAIjE,EAAQvM,GACdwQ,EAAEwjC,UACFxjC,EAAEwjC,SAASptB,SAAS2U,IAChB51B,EAAO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","sources":["webpack://@noodl/noodl-viewer-react/../noodl-runtime/node_modules/eventemitter3/index.js","webpack://@noodl/noodl-viewer-react/../noodl-runtime/node_modules/lodash.difference/index.js","webpack://@noodl/noodl-viewer-react/./node_modules/bezier-easing/index.js","webpack://@noodl/noodl-viewer-react/./node_modules/clsx/dist/clsx.m.js","webpack://@noodl/noodl-viewer-react/./src/assets/style.css","webpack://@noodl/noodl-viewer-react/./node_modules/css-loader/dist/runtime/api.js","webpack://@noodl/noodl-viewer-react/./node_modules/css-loader/dist/runtime/cssWithMappingToString.js","webpack://@noodl/noodl-viewer-react/./node_modules/events/events.js","webpack://@noodl/noodl-viewer-react/./node_modules/prop-types/factoryWithThrowingShims.js","webpack://@noodl/noodl-viewer-react/./node_modules/prop-types/index.js","webpack://@noodl/noodl-viewer-react/./node_modules/prop-types/lib/ReactPropTypesSecret.js","webpack://@noodl/noodl-viewer-react/./node_modules/react-draggable/build/cjs/Draggable.js","webpack://@noodl/noodl-viewer-react/./node_modules/react-draggable/build/cjs/DraggableCore.js","webpack://@noodl/noodl-viewer-react/./node_modules/react-draggable/build/cjs/cjs.js","webpack://@noodl/noodl-viewer-react/./node_modules/react-draggable/build/cjs/utils/domFns.js","webpack://@noodl/noodl-viewer-react/./node_modules/react-draggable/build/cjs/utils/getPrefix.js","webpack://@noodl/noodl-viewer-react/./node_modules/react-draggable/build/cjs/utils/log.js","webpack://@noodl/noodl-viewer-react/./node_modules/react-draggable/build/cjs/utils/positionFns.js","webpack://@noodl/noodl-viewer-react/./node_modules/react-draggable/build/cjs/utils/shims.js","webpack://@noodl/noodl-viewer-react/./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/api/cloudfile.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/api/cloudstore.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/collection.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/edgetriggeredinput.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/model.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/node.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/modelcrudbase.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/outputproperty.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/noderegister.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/timerscheduler.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/variants.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodescope.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/componentinstance.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodecontext.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/eventsender.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/editorconnection.activewarnings.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/editorconnection.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodelibraryexport.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/models/nodemodel.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/models/componentmodel.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/models/graphmodel.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/editormodeleventshandler.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/services.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodedefinition.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/componentinputs.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/componentoutputs.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/runtasks.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/restnode.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/expression.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/javascriptnodeparser.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/simplejavascript.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/api/queryutils.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/dbcollectionnode2.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/dbmodelnode2.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/dbmodelcrudbase.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/setdbmodelpropertiesnode.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/deletedbmodelpropertiesnode.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/newdbmodelpropertiesnode.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/dbmodelnode-addrelation.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/dbmodelnode-removerelation.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/filterdbmodelsnode.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/modelnode2.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/setmodelpropertiesnode.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/newmodelnode.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/cloudfilenode.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/api/configservice.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/data/dbconfig.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/variables/variablebase.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/variables/number.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/variables/string.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/variables/boolean.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/condition.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/and.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/or.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/booleantostring.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/datetostring.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/stringmapper.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/inverter.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/substring.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/stringformat.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/counter.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/uniqueid.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/user/setuserproperties.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/nodes/std-library/user/user.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/runtime.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/runtime.nodes.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/async-pool.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/projectsettings.ts","webpack://@noodl/noodl-viewer-react/../noodl-runtime/src/utils.ts","webpack://@noodl/noodl-viewer-react/./src/easecurves.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/closepopup.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/navigate-back.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/navigate-to-path.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/navigate.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/navigation-handler.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/page-inputs.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/router-handler.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/router-navigate.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/showpopup.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/transitions/transition.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/transitions.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/transitions/none-transition.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/transitions/push-transition.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/transitions/popup-transition.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/animate-to-value.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/colorblend.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/componentutils/base.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/componentutils/componentobject.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/componentutils/parentcomponentobject.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/componentutils/setcomponentobjectproperties.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/componentutils/setparentcomponentobjectproperties.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/data/cloudfunction2.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/data/collectionnode-clear.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/data/collectionnode-insert.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/data/collectionnode-new.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/data/collectionnode-remove.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/data/collectionnode2.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/data/filtercollectionnode.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/data/foreach.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/data/foreachactions.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/data/mapcollectionnode.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/data/setvariablenode.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/data/staticdata.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/data/variablenode2.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/eventreceiver.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/eventsender.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/javascript.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/numberremapper.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/openfilepicker.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/screenresolution.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/states.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/switch.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/timer.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/uploadfile.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/user/login.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/user/logout.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/user/signup.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/user/userservice.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/valuechanged.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/variables/color.ts","webpack://@noodl/noodl-viewer-react/./node_modules/webfontloader/webfontloader.js","webpack://@noodl/noodl-viewer-react/./src/api/cloudfunctions.js","webpack://@noodl/noodl-viewer-react/./src/api/users.js","webpack://@noodl/noodl-viewer-react/./src/components/visual/Group/scroll-plugins/patched-momentum-scroll.js","webpack://@noodl/noodl-viewer-react/./src/nodes/visual/css-definition.js","webpack://@noodl/noodl-viewer-react/external var \"React\"","webpack://@noodl/noodl-viewer-react/external var \"ReactDOM\"","webpack://@noodl/noodl-viewer-react/../noodl-runtime/dist/noodl-runtime.esm.js","webpack://@noodl/noodl-viewer-react/webpack/bootstrap","webpack://@noodl/noodl-viewer-react/webpack/runtime/compat get default export","webpack://@noodl/noodl-viewer-react/webpack/runtime/define property getters","webpack://@noodl/noodl-viewer-react/webpack/runtime/global","webpack://@noodl/noodl-viewer-react/webpack/runtime/hasOwnProperty shorthand","webpack://@noodl/noodl-viewer-react/webpack/runtime/make namespace object","webpack://@noodl/noodl-viewer-react/webpack/runtime/nonce","webpack://@noodl/noodl-viewer-react/./src/graph-warnings.ts","webpack://@noodl/noodl-viewer-react/./src/highlighter.ts","webpack://@noodl/noodl-viewer-react/./src/inspector.ts","webpack://@noodl/noodl-viewer-react/./src/api/seo.ts","webpack://@noodl/noodl-viewer-react/./src/api/navigation.ts","webpack://@noodl/noodl-viewer-react/./src/api/files.ts","webpack://@noodl/noodl-viewer-react/./src/project-settings.ts","webpack://@noodl/noodl-viewer-react/./src/dom-boundingbox-oberver.ts","webpack://@noodl/noodl-viewer-react/./src/layout.ts","webpack://@noodl/noodl-viewer-react/./src/mergedeep.ts","webpack://@noodl/noodl-viewer-react/./src/fontloader.ts","webpack://@noodl/noodl-viewer-react/./src/tooltips.ts","webpack://@noodl/noodl-viewer-react/./src/node-shared-port-definitions.js","webpack://@noodl/noodl-viewer-react/./src/node-transitions.ts","webpack://@noodl/noodl-viewer-react/./src/react-component-node.ts","webpack://@noodl/noodl-viewer-react/./src/pointerlisteners.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/controls/utils.ts","webpack://@noodl/noodl-viewer-react/./src/components/controls/Button/Button.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/controls/button.ts","webpack://@noodl/noodl-viewer-react/./src/components/controls/Checkbox/Checkbox.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/controls/checkbox.ts","webpack://@noodl/noodl-viewer-react/./src/components/controls/Select/Select.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/controls/options.ts","webpack://@noodl/noodl-viewer-react/./src/contexts/radiobuttoncontext.ts","webpack://@noodl/noodl-viewer-react/./src/components/controls/RadioButton/RadioButton.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/controls/radiobutton.ts","webpack://@noodl/noodl-viewer-react/./src/components/controls/RadioButtonGroup/RadioButtonGroup.tsx","webpack://@noodl/noodl-viewer-react/./src/constants/flex.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/controls/radiobuttongroup.ts","webpack://@noodl/noodl-viewer-react/./src/components/controls/Slider/Slider.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/controls/slider.ts","webpack://@noodl/noodl-viewer-react/./src/components/controls/TextInput/TextInput.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/controls/text-input.ts","webpack://@noodl/noodl-viewer-react/./src/async-queue.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/navigation-stack.tsx","webpack://@noodl/noodl-viewer-react/./src/components/navigation/Page/Page.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/page.ts","webpack://@noodl/noodl-viewer-react/./src/nodes/navigation/router.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/std-library/externallink.ts","webpack://@noodl/noodl-viewer-react/./src/components/visual/Circle/Circle.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/visual/circle.ts","webpack://@noodl/noodl-viewer-react/./src/components/visual/Columns/Columns.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/visual/columns.js","webpack://@noodl/noodl-viewer-react/./src/components/visual/Drag/Drag.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/visual/drag.js","webpack://@noodl/noodl-viewer-react/./node_modules/@better-scroll/core/dist/core.esm.js","webpack://@noodl/noodl-viewer-react/./node_modules/@better-scroll/mouse-wheel/dist/mouse-wheel.esm.js","webpack://@noodl/noodl-viewer-react/./node_modules/@better-scroll/scroll-bar/dist/scroll-bar.esm.js","webpack://@noodl/noodl-viewer-react/./src/components/visual/Group/scroll-plugins/nested-scroll-plugin.js","webpack://@noodl/noodl-viewer-react/./src/components/visual/Group/scroll-plugins/slide-scroll-plugin.js","webpack://@noodl/noodl-viewer-react/./src/components/visual/Group/Group.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/visual/group.js","webpack://@noodl/noodl-viewer-react/./src/components/visual/Icon/Icon.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/visual/icon.js","webpack://@noodl/noodl-viewer-react/./src/components/visual/Image/Image.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/visual/image.js","webpack://@noodl/noodl-viewer-react/./src/components/visual/Text/Text.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/visual/text.js","webpack://@noodl/noodl-viewer-react/./src/components/visual/Video/Video.tsx","webpack://@noodl/noodl-viewer-react/./src/nodes/visual/video.js","webpack://@noodl/noodl-viewer-react/./src/assets/style.css?76bd","webpack://@noodl/noodl-viewer-react/./src/styles.ts","webpack://@noodl/noodl-viewer-react/./src/viewer.jsx","webpack://@noodl/noodl-viewer-react/./src/register-nodes.ts","webpack://@noodl/noodl-viewer-react/./src/noodl-js-api.ts","webpack://@noodl/noodl-viewer-react/./src/components/common/NoHomeError/NoHomeError.tsx","webpack://@noodl/noodl-viewer-react/./noodl-viewer-react.js","webpack://@noodl/noodl-viewer-react/./src/polyfills.ts","webpack://@noodl/noodl-viewer-react/./index.viewer.js"],"sourcesContent":["'use strict';\n\nvar has = Object.prototype.hasOwnProperty\n  , prefix = '~';\n\n/**\n * Constructor to create a storage for our `EE` objects.\n * An `Events` instance is a plain object whose properties are event names.\n *\n * @constructor\n * @private\n */\nfunction Events() {}\n\n//\n// We try to not inherit from `Object.prototype`. In some engines creating an\n// instance in this way is faster than calling `Object.create(null)` directly.\n// If `Object.create(null)` is not supported we prefix the event names with a\n// character to make sure that the built-in object properties are not\n// overridden or used as an attack vector.\n//\nif (Object.create) {\n  Events.prototype = Object.create(null);\n\n  //\n  // This hack is needed because the `__proto__` property is still inherited in\n  // some old browsers like Android 4, iPhone 5.1, Opera 11 and Safari 5.\n  //\n  if (!new Events().__proto__) prefix = false;\n}\n\n/**\n * Representation of a single event listener.\n *\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} [once=false] Specify if the listener is a one-time listener.\n * @constructor\n * @private\n */\nfunction EE(fn, context, once) {\n  this.fn = fn;\n  this.context = context;\n  this.once = once || false;\n}\n\n/**\n * Add a listener for a given event.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} context The context to invoke the listener with.\n * @param {Boolean} once Specify if the listener is a one-time listener.\n * @returns {EventEmitter}\n * @private\n */\nfunction addListener(emitter, event, fn, context, once) {\n  if (typeof fn !== 'function') {\n    throw new TypeError('The listener must be a function');\n  }\n\n  var listener = new EE(fn, context || emitter, once)\n    , evt = prefix ? prefix + event : event;\n\n  if (!emitter._events[evt]) emitter._events[evt] = listener, emitter._eventsCount++;\n  else if (!emitter._events[evt].fn) emitter._events[evt].push(listener);\n  else emitter._events[evt] = [emitter._events[evt], listener];\n\n  return emitter;\n}\n\n/**\n * Clear event by name.\n *\n * @param {EventEmitter} emitter Reference to the `EventEmitter` instance.\n * @param {(String|Symbol)} evt The Event name.\n * @private\n */\nfunction clearEvent(emitter, evt) {\n  if (--emitter._eventsCount === 0) emitter._events = new Events();\n  else delete emitter._events[evt];\n}\n\n/**\n * Minimal `EventEmitter` interface that is molded against the Node.js\n * `EventEmitter` interface.\n *\n * @constructor\n * @public\n */\nfunction EventEmitter() {\n  this._events = new Events();\n  this._eventsCount = 0;\n}\n\n/**\n * Return an array listing the events for which the emitter has registered\n * listeners.\n *\n * @returns {Array}\n * @public\n */\nEventEmitter.prototype.eventNames = function eventNames() {\n  var names = []\n    , events\n    , name;\n\n  if (this._eventsCount === 0) return names;\n\n  for (name in (events = this._events)) {\n    if (has.call(events, name)) names.push(prefix ? name.slice(1) : name);\n  }\n\n  if (Object.getOwnPropertySymbols) {\n    return names.concat(Object.getOwnPropertySymbols(events));\n  }\n\n  return names;\n};\n\n/**\n * Return the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Array} The registered listeners.\n * @public\n */\nEventEmitter.prototype.listeners = function listeners(event) {\n  var evt = prefix ? prefix + event : event\n    , handlers = this._events[evt];\n\n  if (!handlers) return [];\n  if (handlers.fn) return [handlers.fn];\n\n  for (var i = 0, l = handlers.length, ee = new Array(l); i < l; i++) {\n    ee[i] = handlers[i].fn;\n  }\n\n  return ee;\n};\n\n/**\n * Return the number of listeners listening to a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Number} The number of listeners.\n * @public\n */\nEventEmitter.prototype.listenerCount = function listenerCount(event) {\n  var evt = prefix ? prefix + event : event\n    , listeners = this._events[evt];\n\n  if (!listeners) return 0;\n  if (listeners.fn) return 1;\n  return listeners.length;\n};\n\n/**\n * Calls each of the listeners registered for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @returns {Boolean} `true` if the event had listeners, else `false`.\n * @public\n */\nEventEmitter.prototype.emit = function emit(event, a1, a2, a3, a4, a5) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return false;\n\n  var listeners = this._events[evt]\n    , len = arguments.length\n    , args\n    , i;\n\n  if (listeners.fn) {\n    if (listeners.once) this.removeListener(event, listeners.fn, undefined, true);\n\n    switch (len) {\n      case 1: return listeners.fn.call(listeners.context), true;\n      case 2: return listeners.fn.call(listeners.context, a1), true;\n      case 3: return listeners.fn.call(listeners.context, a1, a2), true;\n      case 4: return listeners.fn.call(listeners.context, a1, a2, a3), true;\n      case 5: return listeners.fn.call(listeners.context, a1, a2, a3, a4), true;\n      case 6: return listeners.fn.call(listeners.context, a1, a2, a3, a4, a5), true;\n    }\n\n    for (i = 1, args = new Array(len -1); i < len; i++) {\n      args[i - 1] = arguments[i];\n    }\n\n    listeners.fn.apply(listeners.context, args);\n  } else {\n    var length = listeners.length\n      , j;\n\n    for (i = 0; i < length; i++) {\n      if (listeners[i].once) this.removeListener(event, listeners[i].fn, undefined, true);\n\n      switch (len) {\n        case 1: listeners[i].fn.call(listeners[i].context); break;\n        case 2: listeners[i].fn.call(listeners[i].context, a1); break;\n        case 3: listeners[i].fn.call(listeners[i].context, a1, a2); break;\n        case 4: listeners[i].fn.call(listeners[i].context, a1, a2, a3); break;\n        default:\n          if (!args) for (j = 1, args = new Array(len -1); j < len; j++) {\n            args[j - 1] = arguments[j];\n          }\n\n          listeners[i].fn.apply(listeners[i].context, args);\n      }\n    }\n  }\n\n  return true;\n};\n\n/**\n * Add a listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.on = function on(event, fn, context) {\n  return addListener(this, event, fn, context, false);\n};\n\n/**\n * Add a one-time listener for a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn The listener function.\n * @param {*} [context=this] The context to invoke the listener with.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.once = function once(event, fn, context) {\n  return addListener(this, event, fn, context, true);\n};\n\n/**\n * Remove the listeners of a given event.\n *\n * @param {(String|Symbol)} event The event name.\n * @param {Function} fn Only remove the listeners that match this function.\n * @param {*} context Only remove the listeners that have this context.\n * @param {Boolean} once Only remove one-time listeners.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeListener = function removeListener(event, fn, context, once) {\n  var evt = prefix ? prefix + event : event;\n\n  if (!this._events[evt]) return this;\n  if (!fn) {\n    clearEvent(this, evt);\n    return this;\n  }\n\n  var listeners = this._events[evt];\n\n  if (listeners.fn) {\n    if (\n      listeners.fn === fn &&\n      (!once || listeners.once) &&\n      (!context || listeners.context === context)\n    ) {\n      clearEvent(this, evt);\n    }\n  } else {\n    for (var i = 0, events = [], length = listeners.length; i < length; i++) {\n      if (\n        listeners[i].fn !== fn ||\n        (once && !listeners[i].once) ||\n        (context && listeners[i].context !== context)\n      ) {\n        events.push(listeners[i]);\n      }\n    }\n\n    //\n    // Reset the array, or remove it completely if we have no more listeners.\n    //\n    if (events.length) this._events[evt] = events.length === 1 ? events[0] : events;\n    else clearEvent(this, evt);\n  }\n\n  return this;\n};\n\n/**\n * Remove all listeners, or those of the specified event.\n *\n * @param {(String|Symbol)} [event] The event name.\n * @returns {EventEmitter} `this`.\n * @public\n */\nEventEmitter.prototype.removeAllListeners = function removeAllListeners(event) {\n  var evt;\n\n  if (event) {\n    evt = prefix ? prefix + event : event;\n    if (this._events[evt]) clearEvent(this, evt);\n  } else {\n    this._events = new Events();\n    this._eventsCount = 0;\n  }\n\n  return this;\n};\n\n//\n// Alias methods names because people roll like that.\n//\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\nEventEmitter.prototype.addListener = EventEmitter.prototype.on;\n\n//\n// Expose the prefix.\n//\nEventEmitter.prefixed = prefix;\n\n//\n// Allow `EventEmitter` to be imported as module namespace.\n//\nEventEmitter.EventEmitter = EventEmitter;\n\n//\n// Expose the module.\n//\nif ('undefined' !== typeof module) {\n  module.exports = EventEmitter;\n}\n","/**\n * lodash (Custom Build) <https://lodash.com/>\n * Build: `lodash modularize exports=\"npm\" -o ./`\n * Copyright jQuery Foundation and other contributors <https://jquery.org/>\n * Released under MIT license <https://lodash.com/license>\n * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>\n * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors\n */\n\n/** Used as the size to enable large array optimizations. */\nvar LARGE_ARRAY_SIZE = 200;\n\n/** Used to stand-in for `undefined` hash values. */\nvar HASH_UNDEFINED = '__lodash_hash_undefined__';\n\n/** Used as references for various `Number` constants. */\nvar MAX_SAFE_INTEGER = 9007199254740991;\n\n/** `Object#toString` result references. */\nvar argsTag = '[object Arguments]',\n    funcTag = '[object Function]',\n    genTag = '[object GeneratorFunction]';\n\n/**\n * Used to match `RegExp`\n * [syntax characters](http://ecma-international.org/ecma-262/7.0/#sec-patterns).\n */\nvar reRegExpChar = /[\\\\^$.*+?()[\\]{}|]/g;\n\n/** Used to detect host constructors (Safari). */\nvar reIsHostCtor = /^\\[object .+?Constructor\\]$/;\n\n/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\n/**\n * A faster alternative to `Function#apply`, this function invokes `func`\n * with the `this` binding of `thisArg` and the arguments of `args`.\n *\n * @private\n * @param {Function} func The function to invoke.\n * @param {*} thisArg The `this` binding of `func`.\n * @param {Array} args The arguments to invoke `func` with.\n * @returns {*} Returns the result of `func`.\n */\nfunction apply(func, thisArg, args) {\n  switch (args.length) {\n    case 0: return func.call(thisArg);\n    case 1: return func.call(thisArg, args[0]);\n    case 2: return func.call(thisArg, args[0], args[1]);\n    case 3: return func.call(thisArg, args[0], args[1], args[2]);\n  }\n  return func.apply(thisArg, args);\n}\n\n/**\n * A specialized version of `_.includes` for arrays without support for\n * specifying an index to search from.\n *\n * @private\n * @param {Array} [array] The array to inspect.\n * @param {*} target The value to search for.\n * @returns {boolean} Returns `true` if `target` is found, else `false`.\n */\nfunction arrayIncludes(array, value) {\n  var length = array ? array.length : 0;\n  return !!length && baseIndexOf(array, value, 0) > -1;\n}\n\n/**\n * This function is like `arrayIncludes` except that it accepts a comparator.\n *\n * @private\n * @param {Array} [array] The array to inspect.\n * @param {*} target The value to search for.\n * @param {Function} comparator The comparator invoked per element.\n * @returns {boolean} Returns `true` if `target` is found, else `false`.\n */\nfunction arrayIncludesWith(array, value, comparator) {\n  var index = -1,\n      length = array ? array.length : 0;\n\n  while (++index < length) {\n    if (comparator(value, array[index])) {\n      return true;\n    }\n  }\n  return false;\n}\n\n/**\n * A specialized version of `_.map` for arrays without support for iteratee\n * shorthands.\n *\n * @private\n * @param {Array} [array] The array to iterate over.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the new mapped array.\n */\nfunction arrayMap(array, iteratee) {\n  var index = -1,\n      length = array ? array.length : 0,\n      result = Array(length);\n\n  while (++index < length) {\n    result[index] = iteratee(array[index], index, array);\n  }\n  return result;\n}\n\n/**\n * Appends the elements of `values` to `array`.\n *\n * @private\n * @param {Array} array The array to modify.\n * @param {Array} values The values to append.\n * @returns {Array} Returns `array`.\n */\nfunction arrayPush(array, values) {\n  var index = -1,\n      length = values.length,\n      offset = array.length;\n\n  while (++index < length) {\n    array[offset + index] = values[index];\n  }\n  return array;\n}\n\n/**\n * The base implementation of `_.findIndex` and `_.findLastIndex` without\n * support for iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Function} predicate The function invoked per iteration.\n * @param {number} fromIndex The index to search from.\n * @param {boolean} [fromRight] Specify iterating from right to left.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseFindIndex(array, predicate, fromIndex, fromRight) {\n  var length = array.length,\n      index = fromIndex + (fromRight ? 1 : -1);\n\n  while ((fromRight ? index-- : ++index < length)) {\n    if (predicate(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.indexOf` without `fromIndex` bounds checks.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} value The value to search for.\n * @param {number} fromIndex The index to search from.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseIndexOf(array, value, fromIndex) {\n  if (value !== value) {\n    return baseFindIndex(array, baseIsNaN, fromIndex);\n  }\n  var index = fromIndex - 1,\n      length = array.length;\n\n  while (++index < length) {\n    if (array[index] === value) {\n      return index;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of `_.isNaN` without support for number objects.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is `NaN`, else `false`.\n */\nfunction baseIsNaN(value) {\n  return value !== value;\n}\n\n/**\n * The base implementation of `_.unary` without support for storing metadata.\n *\n * @private\n * @param {Function} func The function to cap arguments for.\n * @returns {Function} Returns the new capped function.\n */\nfunction baseUnary(func) {\n  return function(value) {\n    return func(value);\n  };\n}\n\n/**\n * Checks if a cache value for `key` exists.\n *\n * @private\n * @param {Object} cache The cache to query.\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction cacheHas(cache, key) {\n  return cache.has(key);\n}\n\n/**\n * Gets the value at `key` of `object`.\n *\n * @private\n * @param {Object} [object] The object to query.\n * @param {string} key The key of the property to get.\n * @returns {*} Returns the property value.\n */\nfunction getValue(object, key) {\n  return object == null ? undefined : object[key];\n}\n\n/**\n * Checks if `value` is a host object in IE < 9.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a host object, else `false`.\n */\nfunction isHostObject(value) {\n  // Many host objects are `Object` objects that can coerce to strings\n  // despite having improperly defined `toString` methods.\n  var result = false;\n  if (value != null && typeof value.toString != 'function') {\n    try {\n      result = !!(value + '');\n    } catch (e) {}\n  }\n  return result;\n}\n\n/** Used for built-in method references. */\nvar arrayProto = Array.prototype,\n    funcProto = Function.prototype,\n    objectProto = Object.prototype;\n\n/** Used to detect overreaching core-js shims. */\nvar coreJsData = root['__core-js_shared__'];\n\n/** Used to detect methods masquerading as native. */\nvar maskSrcKey = (function() {\n  var uid = /[^.]+$/.exec(coreJsData && coreJsData.keys && coreJsData.keys.IE_PROTO || '');\n  return uid ? ('Symbol(src)_1.' + uid) : '';\n}());\n\n/** Used to resolve the decompiled source of functions. */\nvar funcToString = funcProto.toString;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar objectToString = objectProto.toString;\n\n/** Used to detect if a method is native. */\nvar reIsNative = RegExp('^' +\n  funcToString.call(hasOwnProperty).replace(reRegExpChar, '\\\\$&')\n  .replace(/hasOwnProperty|(function).*?(?=\\\\\\()| for .+?(?=\\\\\\])/g, '$1.*?') + '$'\n);\n\n/** Built-in value references. */\nvar Symbol = root.Symbol,\n    propertyIsEnumerable = objectProto.propertyIsEnumerable,\n    splice = arrayProto.splice,\n    spreadableSymbol = Symbol ? Symbol.isConcatSpreadable : undefined;\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max;\n\n/* Built-in method references that are verified to be native. */\nvar Map = getNative(root, 'Map'),\n    nativeCreate = getNative(Object, 'create');\n\n/**\n * Creates a hash object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction Hash(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the hash.\n *\n * @private\n * @name clear\n * @memberOf Hash\n */\nfunction hashClear() {\n  this.__data__ = nativeCreate ? nativeCreate(null) : {};\n}\n\n/**\n * Removes `key` and its value from the hash.\n *\n * @private\n * @name delete\n * @memberOf Hash\n * @param {Object} hash The hash to modify.\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction hashDelete(key) {\n  return this.has(key) && delete this.__data__[key];\n}\n\n/**\n * Gets the hash value for `key`.\n *\n * @private\n * @name get\n * @memberOf Hash\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction hashGet(key) {\n  var data = this.__data__;\n  if (nativeCreate) {\n    var result = data[key];\n    return result === HASH_UNDEFINED ? undefined : result;\n  }\n  return hasOwnProperty.call(data, key) ? data[key] : undefined;\n}\n\n/**\n * Checks if a hash value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf Hash\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction hashHas(key) {\n  var data = this.__data__;\n  return nativeCreate ? data[key] !== undefined : hasOwnProperty.call(data, key);\n}\n\n/**\n * Sets the hash `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf Hash\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the hash instance.\n */\nfunction hashSet(key, value) {\n  var data = this.__data__;\n  data[key] = (nativeCreate && value === undefined) ? HASH_UNDEFINED : value;\n  return this;\n}\n\n// Add methods to `Hash`.\nHash.prototype.clear = hashClear;\nHash.prototype['delete'] = hashDelete;\nHash.prototype.get = hashGet;\nHash.prototype.has = hashHas;\nHash.prototype.set = hashSet;\n\n/**\n * Creates an list cache object.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction ListCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the list cache.\n *\n * @private\n * @name clear\n * @memberOf ListCache\n */\nfunction listCacheClear() {\n  this.__data__ = [];\n}\n\n/**\n * Removes `key` and its value from the list cache.\n *\n * @private\n * @name delete\n * @memberOf ListCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction listCacheDelete(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    return false;\n  }\n  var lastIndex = data.length - 1;\n  if (index == lastIndex) {\n    data.pop();\n  } else {\n    splice.call(data, index, 1);\n  }\n  return true;\n}\n\n/**\n * Gets the list cache value for `key`.\n *\n * @private\n * @name get\n * @memberOf ListCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction listCacheGet(key) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  return index < 0 ? undefined : data[index][1];\n}\n\n/**\n * Checks if a list cache value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf ListCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction listCacheHas(key) {\n  return assocIndexOf(this.__data__, key) > -1;\n}\n\n/**\n * Sets the list cache `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf ListCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the list cache instance.\n */\nfunction listCacheSet(key, value) {\n  var data = this.__data__,\n      index = assocIndexOf(data, key);\n\n  if (index < 0) {\n    data.push([key, value]);\n  } else {\n    data[index][1] = value;\n  }\n  return this;\n}\n\n// Add methods to `ListCache`.\nListCache.prototype.clear = listCacheClear;\nListCache.prototype['delete'] = listCacheDelete;\nListCache.prototype.get = listCacheGet;\nListCache.prototype.has = listCacheHas;\nListCache.prototype.set = listCacheSet;\n\n/**\n * Creates a map cache object to store key-value pairs.\n *\n * @private\n * @constructor\n * @param {Array} [entries] The key-value pairs to cache.\n */\nfunction MapCache(entries) {\n  var index = -1,\n      length = entries ? entries.length : 0;\n\n  this.clear();\n  while (++index < length) {\n    var entry = entries[index];\n    this.set(entry[0], entry[1]);\n  }\n}\n\n/**\n * Removes all key-value entries from the map.\n *\n * @private\n * @name clear\n * @memberOf MapCache\n */\nfunction mapCacheClear() {\n  this.__data__ = {\n    'hash': new Hash,\n    'map': new (Map || ListCache),\n    'string': new Hash\n  };\n}\n\n/**\n * Removes `key` and its value from the map.\n *\n * @private\n * @name delete\n * @memberOf MapCache\n * @param {string} key The key of the value to remove.\n * @returns {boolean} Returns `true` if the entry was removed, else `false`.\n */\nfunction mapCacheDelete(key) {\n  return getMapData(this, key)['delete'](key);\n}\n\n/**\n * Gets the map value for `key`.\n *\n * @private\n * @name get\n * @memberOf MapCache\n * @param {string} key The key of the value to get.\n * @returns {*} Returns the entry value.\n */\nfunction mapCacheGet(key) {\n  return getMapData(this, key).get(key);\n}\n\n/**\n * Checks if a map value for `key` exists.\n *\n * @private\n * @name has\n * @memberOf MapCache\n * @param {string} key The key of the entry to check.\n * @returns {boolean} Returns `true` if an entry for `key` exists, else `false`.\n */\nfunction mapCacheHas(key) {\n  return getMapData(this, key).has(key);\n}\n\n/**\n * Sets the map `key` to `value`.\n *\n * @private\n * @name set\n * @memberOf MapCache\n * @param {string} key The key of the value to set.\n * @param {*} value The value to set.\n * @returns {Object} Returns the map cache instance.\n */\nfunction mapCacheSet(key, value) {\n  getMapData(this, key).set(key, value);\n  return this;\n}\n\n// Add methods to `MapCache`.\nMapCache.prototype.clear = mapCacheClear;\nMapCache.prototype['delete'] = mapCacheDelete;\nMapCache.prototype.get = mapCacheGet;\nMapCache.prototype.has = mapCacheHas;\nMapCache.prototype.set = mapCacheSet;\n\n/**\n *\n * Creates an array cache object to store unique values.\n *\n * @private\n * @constructor\n * @param {Array} [values] The values to cache.\n */\nfunction SetCache(values) {\n  var index = -1,\n      length = values ? values.length : 0;\n\n  this.__data__ = new MapCache;\n  while (++index < length) {\n    this.add(values[index]);\n  }\n}\n\n/**\n * Adds `value` to the array cache.\n *\n * @private\n * @name add\n * @memberOf SetCache\n * @alias push\n * @param {*} value The value to cache.\n * @returns {Object} Returns the cache instance.\n */\nfunction setCacheAdd(value) {\n  this.__data__.set(value, HASH_UNDEFINED);\n  return this;\n}\n\n/**\n * Checks if `value` is in the array cache.\n *\n * @private\n * @name has\n * @memberOf SetCache\n * @param {*} value The value to search for.\n * @returns {number} Returns `true` if `value` is found, else `false`.\n */\nfunction setCacheHas(value) {\n  return this.__data__.has(value);\n}\n\n// Add methods to `SetCache`.\nSetCache.prototype.add = SetCache.prototype.push = setCacheAdd;\nSetCache.prototype.has = setCacheHas;\n\n/**\n * Gets the index at which the `key` is found in `array` of key-value pairs.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {*} key The key to search for.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction assocIndexOf(array, key) {\n  var length = array.length;\n  while (length--) {\n    if (eq(array[length][0], key)) {\n      return length;\n    }\n  }\n  return -1;\n}\n\n/**\n * The base implementation of methods like `_.difference` without support\n * for excluding multiple arrays or iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Array} values The values to exclude.\n * @param {Function} [iteratee] The iteratee invoked per element.\n * @param {Function} [comparator] The comparator invoked per element.\n * @returns {Array} Returns the new array of filtered values.\n */\nfunction baseDifference(array, values, iteratee, comparator) {\n  var index = -1,\n      includes = arrayIncludes,\n      isCommon = true,\n      length = array.length,\n      result = [],\n      valuesLength = values.length;\n\n  if (!length) {\n    return result;\n  }\n  if (iteratee) {\n    values = arrayMap(values, baseUnary(iteratee));\n  }\n  if (comparator) {\n    includes = arrayIncludesWith;\n    isCommon = false;\n  }\n  else if (values.length >= LARGE_ARRAY_SIZE) {\n    includes = cacheHas;\n    isCommon = false;\n    values = new SetCache(values);\n  }\n  outer:\n  while (++index < length) {\n    var value = array[index],\n        computed = iteratee ? iteratee(value) : value;\n\n    value = (comparator || value !== 0) ? value : 0;\n    if (isCommon && computed === computed) {\n      var valuesIndex = valuesLength;\n      while (valuesIndex--) {\n        if (values[valuesIndex] === computed) {\n          continue outer;\n        }\n      }\n      result.push(value);\n    }\n    else if (!includes(values, computed, comparator)) {\n      result.push(value);\n    }\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.flatten` with support for restricting flattening.\n *\n * @private\n * @param {Array} array The array to flatten.\n * @param {number} depth The maximum recursion depth.\n * @param {boolean} [predicate=isFlattenable] The function invoked per iteration.\n * @param {boolean} [isStrict] Restrict to values that pass `predicate` checks.\n * @param {Array} [result=[]] The initial result value.\n * @returns {Array} Returns the new flattened array.\n */\nfunction baseFlatten(array, depth, predicate, isStrict, result) {\n  var index = -1,\n      length = array.length;\n\n  predicate || (predicate = isFlattenable);\n  result || (result = []);\n\n  while (++index < length) {\n    var value = array[index];\n    if (depth > 0 && predicate(value)) {\n      if (depth > 1) {\n        // Recursively flatten arrays (susceptible to call stack limits).\n        baseFlatten(value, depth - 1, predicate, isStrict, result);\n      } else {\n        arrayPush(result, value);\n      }\n    } else if (!isStrict) {\n      result[result.length] = value;\n    }\n  }\n  return result;\n}\n\n/**\n * The base implementation of `_.isNative` without bad shim checks.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a native function,\n *  else `false`.\n */\nfunction baseIsNative(value) {\n  if (!isObject(value) || isMasked(value)) {\n    return false;\n  }\n  var pattern = (isFunction(value) || isHostObject(value)) ? reIsNative : reIsHostCtor;\n  return pattern.test(toSource(value));\n}\n\n/**\n * The base implementation of `_.rest` which doesn't validate or coerce arguments.\n *\n * @private\n * @param {Function} func The function to apply a rest parameter to.\n * @param {number} [start=func.length-1] The start position of the rest parameter.\n * @returns {Function} Returns the new function.\n */\nfunction baseRest(func, start) {\n  start = nativeMax(start === undefined ? (func.length - 1) : start, 0);\n  return function() {\n    var args = arguments,\n        index = -1,\n        length = nativeMax(args.length - start, 0),\n        array = Array(length);\n\n    while (++index < length) {\n      array[index] = args[start + index];\n    }\n    index = -1;\n    var otherArgs = Array(start + 1);\n    while (++index < start) {\n      otherArgs[index] = args[index];\n    }\n    otherArgs[start] = array;\n    return apply(func, this, otherArgs);\n  };\n}\n\n/**\n * Gets the data for `map`.\n *\n * @private\n * @param {Object} map The map to query.\n * @param {string} key The reference key.\n * @returns {*} Returns the map data.\n */\nfunction getMapData(map, key) {\n  var data = map.__data__;\n  return isKeyable(key)\n    ? data[typeof key == 'string' ? 'string' : 'hash']\n    : data.map;\n}\n\n/**\n * Gets the native function at `key` of `object`.\n *\n * @private\n * @param {Object} object The object to query.\n * @param {string} key The key of the method to get.\n * @returns {*} Returns the function if it's native, else `undefined`.\n */\nfunction getNative(object, key) {\n  var value = getValue(object, key);\n  return baseIsNative(value) ? value : undefined;\n}\n\n/**\n * Checks if `value` is a flattenable `arguments` object or array.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is flattenable, else `false`.\n */\nfunction isFlattenable(value) {\n  return isArray(value) || isArguments(value) ||\n    !!(spreadableSymbol && value && value[spreadableSymbol]);\n}\n\n/**\n * Checks if `value` is suitable for use as unique object key.\n *\n * @private\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is suitable, else `false`.\n */\nfunction isKeyable(value) {\n  var type = typeof value;\n  return (type == 'string' || type == 'number' || type == 'symbol' || type == 'boolean')\n    ? (value !== '__proto__')\n    : (value === null);\n}\n\n/**\n * Checks if `func` has its source masked.\n *\n * @private\n * @param {Function} func The function to check.\n * @returns {boolean} Returns `true` if `func` is masked, else `false`.\n */\nfunction isMasked(func) {\n  return !!maskSrcKey && (maskSrcKey in func);\n}\n\n/**\n * Converts `func` to its source code.\n *\n * @private\n * @param {Function} func The function to process.\n * @returns {string} Returns the source code.\n */\nfunction toSource(func) {\n  if (func != null) {\n    try {\n      return funcToString.call(func);\n    } catch (e) {}\n    try {\n      return (func + '');\n    } catch (e) {}\n  }\n  return '';\n}\n\n/**\n * Creates an array of `array` values not included in the other given arrays\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons. The order of result values is determined by the\n * order they occur in the first array.\n *\n * **Note:** Unlike `_.pullAll`, this method returns a new array.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {Array} array The array to inspect.\n * @param {...Array} [values] The values to exclude.\n * @returns {Array} Returns the new array of filtered values.\n * @see _.without, _.xor\n * @example\n *\n * _.difference([2, 1], [2, 3]);\n * // => [1]\n */\nvar difference = baseRest(function(array, values) {\n  return isArrayLikeObject(array)\n    ? baseDifference(array, baseFlatten(values, 1, isArrayLikeObject, true))\n    : [];\n});\n\n/**\n * Performs a\n * [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * comparison between two values to determine if they are equivalent.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to compare.\n * @param {*} other The other value to compare.\n * @returns {boolean} Returns `true` if the values are equivalent, else `false`.\n * @example\n *\n * var object = { 'a': 1 };\n * var other = { 'a': 1 };\n *\n * _.eq(object, object);\n * // => true\n *\n * _.eq(object, other);\n * // => false\n *\n * _.eq('a', 'a');\n * // => true\n *\n * _.eq('a', Object('a'));\n * // => false\n *\n * _.eq(NaN, NaN);\n * // => true\n */\nfunction eq(value, other) {\n  return value === other || (value !== value && other !== other);\n}\n\n/**\n * Checks if `value` is likely an `arguments` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an `arguments` object,\n *  else `false`.\n * @example\n *\n * _.isArguments(function() { return arguments; }());\n * // => true\n *\n * _.isArguments([1, 2, 3]);\n * // => false\n */\nfunction isArguments(value) {\n  // Safari 8.1 makes `arguments.callee` enumerable in strict mode.\n  return isArrayLikeObject(value) && hasOwnProperty.call(value, 'callee') &&\n    (!propertyIsEnumerable.call(value, 'callee') || objectToString.call(value) == argsTag);\n}\n\n/**\n * Checks if `value` is classified as an `Array` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array, else `false`.\n * @example\n *\n * _.isArray([1, 2, 3]);\n * // => true\n *\n * _.isArray(document.body.children);\n * // => false\n *\n * _.isArray('abc');\n * // => false\n *\n * _.isArray(_.noop);\n * // => false\n */\nvar isArray = Array.isArray;\n\n/**\n * Checks if `value` is array-like. A value is considered array-like if it's\n * not a function and has a `value.length` that's an integer greater than or\n * equal to `0` and less than or equal to `Number.MAX_SAFE_INTEGER`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is array-like, else `false`.\n * @example\n *\n * _.isArrayLike([1, 2, 3]);\n * // => true\n *\n * _.isArrayLike(document.body.children);\n * // => true\n *\n * _.isArrayLike('abc');\n * // => true\n *\n * _.isArrayLike(_.noop);\n * // => false\n */\nfunction isArrayLike(value) {\n  return value != null && isLength(value.length) && !isFunction(value);\n}\n\n/**\n * This method is like `_.isArrayLike` except that it also checks if `value`\n * is an object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an array-like object,\n *  else `false`.\n * @example\n *\n * _.isArrayLikeObject([1, 2, 3]);\n * // => true\n *\n * _.isArrayLikeObject(document.body.children);\n * // => true\n *\n * _.isArrayLikeObject('abc');\n * // => false\n *\n * _.isArrayLikeObject(_.noop);\n * // => false\n */\nfunction isArrayLikeObject(value) {\n  return isObjectLike(value) && isArrayLike(value);\n}\n\n/**\n * Checks if `value` is classified as a `Function` object.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a function, else `false`.\n * @example\n *\n * _.isFunction(_);\n * // => true\n *\n * _.isFunction(/abc/);\n * // => false\n */\nfunction isFunction(value) {\n  // The use of `Object#toString` avoids issues with the `typeof` operator\n  // in Safari 8-9 which returns 'object' for typed array and other constructors.\n  var tag = isObject(value) ? objectToString.call(value) : '';\n  return tag == funcTag || tag == genTag;\n}\n\n/**\n * Checks if `value` is a valid array-like length.\n *\n * **Note:** This method is loosely based on\n * [`ToLength`](http://ecma-international.org/ecma-262/7.0/#sec-tolength).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a valid length, else `false`.\n * @example\n *\n * _.isLength(3);\n * // => true\n *\n * _.isLength(Number.MIN_VALUE);\n * // => false\n *\n * _.isLength(Infinity);\n * // => false\n *\n * _.isLength('3');\n * // => false\n */\nfunction isLength(value) {\n  return typeof value == 'number' &&\n    value > -1 && value % 1 == 0 && value <= MAX_SAFE_INTEGER;\n}\n\n/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return !!value && (type == 'object' || type == 'function');\n}\n\n/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return !!value && typeof value == 'object';\n}\n\nmodule.exports = difference;\n","/**\n * BezierEasing - use bezier curve for transition easing function\n * by Gaëtan Renaudeau 2014 - 2015 – MIT License\n *\n * Credits: is based on Firefox's nsSMILKeySpline.cpp\n * Usage:\n * var spline = BezierEasing([ 0.25, 0.1, 0.25, 1.0 ])\n * spline.get(x) => returns the easing value | x must be in [0, 1] range\n *\n */\n\n// These values are established by empiricism with tests (tradeoff: performance VS precision)\nvar NEWTON_ITERATIONS = 4;\nvar NEWTON_MIN_SLOPE = 0.001;\nvar SUBDIVISION_PRECISION = 0.0000001;\nvar SUBDIVISION_MAX_ITERATIONS = 10;\n\nvar kSplineTableSize = 11;\nvar kSampleStepSize = 1.0 / (kSplineTableSize - 1.0);\n\nvar float32ArraySupported = typeof Float32Array === \"function\";\n\nfunction A (aA1, aA2) { return 1.0 - 3.0 * aA2 + 3.0 * aA1; }\nfunction B (aA1, aA2) { return 3.0 * aA2 - 6.0 * aA1; }\nfunction C (aA1)      { return 3.0 * aA1; }\n\n// Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.\nfunction calcBezier (aT, aA1, aA2) {\n  return ((A(aA1, aA2)*aT + B(aA1, aA2))*aT + C(aA1))*aT;\n}\n\n// Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.\nfunction getSlope (aT, aA1, aA2) {\n  return 3.0 * A(aA1, aA2)*aT*aT + 2.0 * B(aA1, aA2) * aT + C(aA1);\n}\n\nfunction binarySubdivide (aX, aA, aB, mX1, mX2) {\n  var currentX, currentT, i = 0;\n  do {\n    currentT = aA + (aB - aA) / 2.0;\n    currentX = calcBezier(currentT, mX1, mX2) - aX;\n    if (currentX > 0.0) {\n      aB = currentT;\n    } else {\n      aA = currentT;\n    }\n  } while (Math.abs(currentX) > SUBDIVISION_PRECISION && ++i < SUBDIVISION_MAX_ITERATIONS);\n  return currentT;\n}\n\nfunction newtonRaphsonIterate (aX, aGuessT, mX1, mX2) {\n  for (var i = 0; i < NEWTON_ITERATIONS; ++i) {\n    var currentSlope = getSlope(aGuessT, mX1, mX2);\n    if (currentSlope === 0.0) return aGuessT;\n    var currentX = calcBezier(aGuessT, mX1, mX2) - aX;\n    aGuessT -= currentX / currentSlope;\n  }\n  return aGuessT;\n}\n\n/**\n * points is an array of [ mX1, mY1, mX2, mY2 ]\n */\nfunction BezierEasing (points, b, c, d) {\n  if (arguments.length === 4) {\n    return new BezierEasing([ points, b, c, d ]);\n  }\n  if (!(this instanceof BezierEasing)) return new BezierEasing(points);\n\n  if (!points || points.length !== 4) {\n    throw new Error(\"BezierEasing: points must contains 4 values\");\n  }\n  for (var i=0; i<4; ++i) {\n    if (typeof points[i] !== \"number\" || isNaN(points[i]) || !isFinite(points[i])) {\n      throw new Error(\"BezierEasing: points should be integers.\");\n    }\n  }\n  if (points[0] < 0 || points[0] > 1 || points[2] < 0 || points[2] > 1) {\n    throw new Error(\"BezierEasing x values must be in [0, 1] range.\");\n  }\n\n  this._str = \"BezierEasing(\"+points+\")\";\n  this._css = \"cubic-bezier(\"+points+\")\";\n  this._p = points;\n  this._mSampleValues = float32ArraySupported ? new Float32Array(kSplineTableSize) : new Array(kSplineTableSize);\n  this._precomputed = false;\n\n  this.get = this.get.bind(this);\n}\n\nBezierEasing.prototype = {\n\n  get: function (x) {\n    var mX1 = this._p[0],\n      mY1 = this._p[1],\n      mX2 = this._p[2],\n      mY2 = this._p[3];\n    if (!this._precomputed) this._precompute();\n    if (mX1 === mY1 && mX2 === mY2) return x; // linear\n    // Because JavaScript number are imprecise, we should guarantee the extremes are right.\n    if (x === 0) return 0;\n    if (x === 1) return 1;\n    return calcBezier(this._getTForX(x), mY1, mY2);\n  },\n\n  getPoints: function() {\n    return this._p;\n  },\n\n  toString: function () {\n    return this._str;\n  },\n\n  toCSS: function () {\n    return this._css;\n  },\n\n  // Private part\n\n  _precompute: function () {\n    var mX1 = this._p[0],\n      mY1 = this._p[1],\n      mX2 = this._p[2],\n      mY2 = this._p[3];\n    this._precomputed = true;\n    if (mX1 !== mY1 || mX2 !== mY2)\n      this._calcSampleValues();\n  },\n\n  _calcSampleValues: function () {\n    var mX1 = this._p[0],\n      mX2 = this._p[2];\n    for (var i = 0; i < kSplineTableSize; ++i) {\n      this._mSampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);\n    }\n  },\n\n  /**\n   * getTForX chose the fastest heuristic to determine the percentage value precisely from a given X projection.\n   */\n  _getTForX: function (aX) {\n    var mX1 = this._p[0],\n      mX2 = this._p[2],\n      mSampleValues = this._mSampleValues;\n\n    var intervalStart = 0.0;\n    var currentSample = 1;\n    var lastSample = kSplineTableSize - 1;\n\n    for (; currentSample !== lastSample && mSampleValues[currentSample] <= aX; ++currentSample) {\n      intervalStart += kSampleStepSize;\n    }\n    --currentSample;\n\n    // Interpolate to provide an initial guess for t\n    var dist = (aX - mSampleValues[currentSample]) / (mSampleValues[currentSample+1] - mSampleValues[currentSample]);\n    var guessForT = intervalStart + dist * kSampleStepSize;\n\n    var initialSlope = getSlope(guessForT, mX1, mX2);\n    if (initialSlope >= NEWTON_MIN_SLOPE) {\n      return newtonRaphsonIterate(aX, guessForT, mX1, mX2);\n    } else if (initialSlope === 0.0) {\n      return guessForT;\n    } else {\n      return binarySubdivide(aX, intervalStart, intervalStart + kSampleStepSize, mX1, mX2);\n    }\n  }\n};\n\n// CSS mapping\nBezierEasing.css = {\n  \"ease\":        BezierEasing.ease      = BezierEasing(0.25, 0.1, 0.25, 1.0),\n  \"linear\":      BezierEasing.linear    = BezierEasing(0.00, 0.0, 1.00, 1.0),\n  \"ease-in\":     BezierEasing.easeIn    = BezierEasing(0.42, 0.0, 1.00, 1.0),\n  \"ease-out\":    BezierEasing.easeOut   = BezierEasing(0.00, 0.0, 0.58, 1.0),\n  \"ease-in-out\": BezierEasing.easeInOut = BezierEasing(0.42, 0.0, 0.58, 1.0)\n};\n\nmodule.exports = BezierEasing;\n","function r(e){var t,f,n=\"\";if(\"string\"==typeof e||\"number\"==typeof e)n+=e;else if(\"object\"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(f=r(e[t]))&&(n&&(n+=\" \"),n+=f);else for(t in e)e[t]&&(n&&(n+=\" \"),n+=t);return n}export function clsx(){for(var e,t,f=0,n=\"\";f<arguments.length;)(e=arguments[f++])&&(t=r(e))&&(n&&(n+=\" \"),n+=t);return n}export default clsx;","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/cssWithMappingToString.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".ndl-visual-text {\\r\\n  font-weight: 400;\\r\\n  margin: 0;\\r\\n}\\r\\n\\r\\n.ndl-controls-pointer,\\r\\n.ndl-controls-pointer * {\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-abs-center {\\r\\n  position: absolute;\\r\\n  transform: translate(-50%, -50%);\\r\\n  left: 50%;\\r\\n  top: 50%;\\r\\n}\\r\\n\\r\\n/** Button **/\\r\\n.ndl-controls-button {\\r\\n  outline: none;\\r\\n  border: none;\\r\\n  color: white;\\r\\n  background-color: black;\\r\\n  padding: 5px 20px 5px 20px;\\r\\n  cursor: pointer;\\r\\n  display: flex;\\r\\n  align-items: center;\\r\\n  justify-content: center;\\r\\n}\\r\\n.ndl-controls-button:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/** Deprecated checkbox **/\\r\\n.ndl-controls-checkbox {\\r\\n  margin: 0;\\r\\n  border: 1px solid #000000;\\r\\n  border-radius: 0;\\r\\n  background-color: transparent;\\r\\n  -webkit-appearance: none;\\r\\n  outline: none;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-checkbox:checked {\\r\\n  background-color: #000000;\\r\\n}\\r\\n\\r\\n.ndl-controls-checkbox:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/** Deprecated radio button **/\\r\\n.ndl-controls-radiobutton {\\r\\n  margin: 0;\\r\\n  border: 1px solid #000000;\\r\\n  border-radius: 16px;\\r\\n  background-color: transparent;\\r\\n  -webkit-appearance: none;\\r\\n  outline: none;\\r\\n  width: 32px;\\r\\n  height: 32px;\\r\\n  display: block;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-radiobutton:checked {\\r\\n  background-color: #000000;\\r\\n}\\r\\n\\r\\n.ndl-controls-radiobutton:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/** New radio button **/\\r\\n.ndl-controls-radio-2 {\\r\\n  opacity: 0;\\r\\n  position: absolute;\\r\\n  margin: 0;\\r\\n}\\r\\n\\r\\n.ndl-controls-radio-2:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/** New checkbox **/\\r\\n.ndl-controls-checkbox-2 {\\r\\n  opacity: 0;\\r\\n  position: absolute;\\r\\n  margin: 0;\\r\\n}\\r\\n\\r\\n.ndl-controls-checkbox-2:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/** Options **/\\r\\n.ndl-controls-select {\\r\\n  -webkit-appearance: none;\\r\\n  appearance: none;\\r\\n  background-color: transparent;\\r\\n  border: 1px solid #000000;\\r\\n  border-radius: 0;\\r\\n  padding: 0 1em 0 0;\\r\\n  margin: 0;\\r\\n  width: 100%;\\r\\n  font-family: inherit;\\r\\n  font-size: inherit;\\r\\n  cursor: inherit;\\r\\n  line-height: inherit;\\r\\n\\r\\n  /* Stack above custom arrow */\\r\\n  z-index: 1;\\r\\n\\r\\n  /* Remove dropdown arrow in IE10 & IE11\\r\\n      @link https://www.filamentgroup.com/lab/select-css.html */\\r\\n  /*  &::-ms-expand {\\r\\n      display: none;\\r\\n    }*/\\r\\n\\r\\n  /* Remove focus outline, will add on alternate element */\\r\\n  outline: none;\\r\\n}\\r\\n\\r\\n.ndl-controls-select:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/** Range **/\\r\\n.ndl-controls-range2 {\\r\\n  margin: 0;\\r\\n  padding: 0;\\r\\n  -webkit-appearance: none;\\r\\n  appearance: none;\\r\\n  outline: none;\\r\\n  border: none;\\r\\n  background: transparent;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-range2::-webkit-slider-thumb {\\r\\n  height: 100%;\\r\\n  border: 0;\\r\\n  -webkit-appearance: none;\\r\\n  appearance: none;\\r\\n}\\r\\n\\r\\n.ndl-controls-range2::-moz-range-thumb {\\r\\n  height: 100%;\\r\\n  border: 0;\\r\\n  -webkit-appearance: none;\\r\\n  appearance: none;\\r\\n}\\r\\n\\r\\n.ndl-controls-range2::-webkit-slider-runnable-track {\\r\\n  border: none;\\r\\n  height: 100%;\\r\\n}\\r\\n\\r\\n.ndl-controls-range2::-moz-range-track {\\r\\n  border: none;\\r\\n  height: 100%;\\r\\n}\\r\\n\\r\\n.ndl-controls-range2:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/* Old range */\\r\\n\\r\\n.ndl-controls-range {\\r\\n  margin: 0;\\r\\n  padding: 0;\\r\\n  -webkit-appearance: none;\\r\\n  outline: none;\\r\\n  border: none;\\r\\n  background-color: transparent;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-webkit-slider-thumb {\\r\\n  width: 16px;\\r\\n  height: 16px;\\r\\n  background: #000000;\\r\\n  border: 0;\\r\\n  border-radius: 8px;\\r\\n  cursor: pointer;\\r\\n  -webkit-appearance: none;\\r\\n  margin-top: -5px;\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-moz-range-thumb {\\r\\n  width: 16px;\\r\\n  height: 16px;\\r\\n  background: #000000;\\r\\n  border: none;\\r\\n  border-radius: 8px;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-ms-thumb {\\r\\n  width: 16px;\\r\\n  height: 16px;\\r\\n  background: #000000;\\r\\n  border: none;\\r\\n  border-radius: 8px;\\r\\n  cursor: pointer;\\r\\n  margin-top: 0px;\\r\\n  /*Needed to keep the Edge thumb centred*/\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-webkit-slider-runnable-track {\\r\\n  background: #f0f0f0;\\r\\n  border: none;\\r\\n  width: 100%;\\r\\n  height: 6px;\\r\\n  cursor: pointer;\\r\\n  top: 4px;\\r\\n  margin-top: 5px;\\r\\n}\\r\\n\\r\\n.ndl-controls-range:focus::-webkit-slider-runnable-track {\\r\\n  background: #f0f0f0;\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-moz-range-track {\\r\\n  background: #f0f0f0;\\r\\n  border: none;\\r\\n  width: 100%;\\r\\n  height: 6px;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-ms-track {\\r\\n  background: transparent;\\r\\n  border-color: transparent;\\r\\n  border-width: 5px 0;\\r\\n  color: transparent;\\r\\n  width: 100%;\\r\\n  height: 6px;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-ms-fill-lower {\\r\\n  background: #f0f0f0;\\r\\n  border: none;\\r\\n}\\r\\n.ndl-controls-range::-ms-fill-upper {\\r\\n  background: #f0f0f0;\\r\\n  border: none;\\r\\n}\\r\\n\\r\\n/** Field Set **/\\r\\n.ndl-controls-fieldset {\\r\\n  outline: none;\\r\\n  border: none;\\r\\n  margin: 0;\\r\\n  padding: 0;\\r\\n}\\r\\n\\r\\n/** Text Input **/\\r\\n.ndl-controls-textinput {\\r\\n  outline: none;\\r\\n  border-style: none;\\r\\n  background-color: transparent;\\r\\n}\\r\\n\\r\\n.ndl-controls-textinput::placeholder {\\r\\n  color: inherit;\\r\\n  opacity: 0.5;\\r\\n}\\r\\n\", \"\",{\"version\":3,\"sources\":[\"webpack://./src/assets/style.css\"],\"names\":[],\"mappings\":\"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\",\"sourcesContent\":[\".ndl-visual-text {\\r\\n  font-weight: 400;\\r\\n  margin: 0;\\r\\n}\\r\\n\\r\\n.ndl-controls-pointer,\\r\\n.ndl-controls-pointer * {\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-abs-center {\\r\\n  position: absolute;\\r\\n  transform: translate(-50%, -50%);\\r\\n  left: 50%;\\r\\n  top: 50%;\\r\\n}\\r\\n\\r\\n/** Button **/\\r\\n.ndl-controls-button {\\r\\n  outline: none;\\r\\n  border: none;\\r\\n  color: white;\\r\\n  background-color: black;\\r\\n  padding: 5px 20px 5px 20px;\\r\\n  cursor: pointer;\\r\\n  display: flex;\\r\\n  align-items: center;\\r\\n  justify-content: center;\\r\\n}\\r\\n.ndl-controls-button:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/** Deprecated checkbox **/\\r\\n.ndl-controls-checkbox {\\r\\n  margin: 0;\\r\\n  border: 1px solid #000000;\\r\\n  border-radius: 0;\\r\\n  background-color: transparent;\\r\\n  -webkit-appearance: none;\\r\\n  outline: none;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-checkbox:checked {\\r\\n  background-color: #000000;\\r\\n}\\r\\n\\r\\n.ndl-controls-checkbox:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/** Deprecated radio button **/\\r\\n.ndl-controls-radiobutton {\\r\\n  margin: 0;\\r\\n  border: 1px solid #000000;\\r\\n  border-radius: 16px;\\r\\n  background-color: transparent;\\r\\n  -webkit-appearance: none;\\r\\n  outline: none;\\r\\n  width: 32px;\\r\\n  height: 32px;\\r\\n  display: block;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-radiobutton:checked {\\r\\n  background-color: #000000;\\r\\n}\\r\\n\\r\\n.ndl-controls-radiobutton:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/** New radio button **/\\r\\n.ndl-controls-radio-2 {\\r\\n  opacity: 0;\\r\\n  position: absolute;\\r\\n  margin: 0;\\r\\n}\\r\\n\\r\\n.ndl-controls-radio-2:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/** New checkbox **/\\r\\n.ndl-controls-checkbox-2 {\\r\\n  opacity: 0;\\r\\n  position: absolute;\\r\\n  margin: 0;\\r\\n}\\r\\n\\r\\n.ndl-controls-checkbox-2:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/** Options **/\\r\\n.ndl-controls-select {\\r\\n  -webkit-appearance: none;\\r\\n  appearance: none;\\r\\n  background-color: transparent;\\r\\n  border: 1px solid #000000;\\r\\n  border-radius: 0;\\r\\n  padding: 0 1em 0 0;\\r\\n  margin: 0;\\r\\n  width: 100%;\\r\\n  font-family: inherit;\\r\\n  font-size: inherit;\\r\\n  cursor: inherit;\\r\\n  line-height: inherit;\\r\\n\\r\\n  /* Stack above custom arrow */\\r\\n  z-index: 1;\\r\\n\\r\\n  /* Remove dropdown arrow in IE10 & IE11\\r\\n      @link https://www.filamentgroup.com/lab/select-css.html */\\r\\n  /*  &::-ms-expand {\\r\\n      display: none;\\r\\n    }*/\\r\\n\\r\\n  /* Remove focus outline, will add on alternate element */\\r\\n  outline: none;\\r\\n}\\r\\n\\r\\n.ndl-controls-select:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/** Range **/\\r\\n.ndl-controls-range2 {\\r\\n  margin: 0;\\r\\n  padding: 0;\\r\\n  -webkit-appearance: none;\\r\\n  appearance: none;\\r\\n  outline: none;\\r\\n  border: none;\\r\\n  background: transparent;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-range2::-webkit-slider-thumb {\\r\\n  height: 100%;\\r\\n  border: 0;\\r\\n  -webkit-appearance: none;\\r\\n  appearance: none;\\r\\n}\\r\\n\\r\\n.ndl-controls-range2::-moz-range-thumb {\\r\\n  height: 100%;\\r\\n  border: 0;\\r\\n  -webkit-appearance: none;\\r\\n  appearance: none;\\r\\n}\\r\\n\\r\\n.ndl-controls-range2::-webkit-slider-runnable-track {\\r\\n  border: none;\\r\\n  height: 100%;\\r\\n}\\r\\n\\r\\n.ndl-controls-range2::-moz-range-track {\\r\\n  border: none;\\r\\n  height: 100%;\\r\\n}\\r\\n\\r\\n.ndl-controls-range2:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n\\r\\n/* Old range */\\r\\n\\r\\n.ndl-controls-range {\\r\\n  margin: 0;\\r\\n  padding: 0;\\r\\n  -webkit-appearance: none;\\r\\n  outline: none;\\r\\n  border: none;\\r\\n  background-color: transparent;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-webkit-slider-thumb {\\r\\n  width: 16px;\\r\\n  height: 16px;\\r\\n  background: #000000;\\r\\n  border: 0;\\r\\n  border-radius: 8px;\\r\\n  cursor: pointer;\\r\\n  -webkit-appearance: none;\\r\\n  margin-top: -5px;\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-moz-range-thumb {\\r\\n  width: 16px;\\r\\n  height: 16px;\\r\\n  background: #000000;\\r\\n  border: none;\\r\\n  border-radius: 8px;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-ms-thumb {\\r\\n  width: 16px;\\r\\n  height: 16px;\\r\\n  background: #000000;\\r\\n  border: none;\\r\\n  border-radius: 8px;\\r\\n  cursor: pointer;\\r\\n  margin-top: 0px;\\r\\n  /*Needed to keep the Edge thumb centred*/\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-webkit-slider-runnable-track {\\r\\n  background: #f0f0f0;\\r\\n  border: none;\\r\\n  width: 100%;\\r\\n  height: 6px;\\r\\n  cursor: pointer;\\r\\n  top: 4px;\\r\\n  margin-top: 5px;\\r\\n}\\r\\n\\r\\n.ndl-controls-range:focus::-webkit-slider-runnable-track {\\r\\n  background: #f0f0f0;\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-moz-range-track {\\r\\n  background: #f0f0f0;\\r\\n  border: none;\\r\\n  width: 100%;\\r\\n  height: 6px;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-ms-track {\\r\\n  background: transparent;\\r\\n  border-color: transparent;\\r\\n  border-width: 5px 0;\\r\\n  color: transparent;\\r\\n  width: 100%;\\r\\n  height: 6px;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.ndl-controls-range::-ms-fill-lower {\\r\\n  background: #f0f0f0;\\r\\n  border: none;\\r\\n}\\r\\n.ndl-controls-range::-ms-fill-upper {\\r\\n  background: #f0f0f0;\\r\\n  border: none;\\r\\n}\\r\\n\\r\\n/** Field Set **/\\r\\n.ndl-controls-fieldset {\\r\\n  outline: none;\\r\\n  border: none;\\r\\n  margin: 0;\\r\\n  padding: 0;\\r\\n}\\r\\n\\r\\n/** Text Input **/\\r\\n.ndl-controls-textinput {\\r\\n  outline: none;\\r\\n  border-style: none;\\r\\n  background-color: transparent;\\r\\n}\\r\\n\\r\\n.ndl-controls-textinput::placeholder {\\r\\n  color: inherit;\\r\\n  opacity: 0.5;\\r\\n}\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\"use strict\";\n\n/*\n  MIT License http://www.opensource.org/licenses/mit-license.php\n  Author Tobias Koppers @sokra\n*/\n// css base code, injected by the css-loader\n// eslint-disable-next-line func-names\nmodule.exports = function (cssWithMappingToString) {\n  var list = []; // return the list of modules as css string\n\n  list.toString = function toString() {\n    return this.map(function (item) {\n      var content = cssWithMappingToString(item);\n\n      if (item[2]) {\n        return \"@media \".concat(item[2], \" {\").concat(content, \"}\");\n      }\n\n      return content;\n    }).join(\"\");\n  }; // import a list of modules into the list\n  // eslint-disable-next-line func-names\n\n\n  list.i = function (modules, mediaQuery, dedupe) {\n    if (typeof modules === \"string\") {\n      // eslint-disable-next-line no-param-reassign\n      modules = [[null, modules, \"\"]];\n    }\n\n    var alreadyImportedModules = {};\n\n    if (dedupe) {\n      for (var i = 0; i < this.length; i++) {\n        // eslint-disable-next-line prefer-destructuring\n        var id = this[i][0];\n\n        if (id != null) {\n          alreadyImportedModules[id] = true;\n        }\n      }\n    }\n\n    for (var _i = 0; _i < modules.length; _i++) {\n      var item = [].concat(modules[_i]);\n\n      if (dedupe && alreadyImportedModules[item[0]]) {\n        // eslint-disable-next-line no-continue\n        continue;\n      }\n\n      if (mediaQuery) {\n        if (!item[2]) {\n          item[2] = mediaQuery;\n        } else {\n          item[2] = \"\".concat(mediaQuery, \" and \").concat(item[2]);\n        }\n      }\n\n      list.push(item);\n    }\n  };\n\n  return list;\n};","\"use strict\";\n\nfunction _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _unsupportedIterableToArray(arr, i) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _iterableToArrayLimit(arr, i) { var _i = arr && (typeof Symbol !== \"undefined\" && arr[Symbol.iterator] || arr[\"@@iterator\"]); if (_i == null) return; var _arr = []; var _n = true; var _d = false; var _s, _e; try { for (_i = _i.call(arr); !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"] != null) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nmodule.exports = function cssWithMappingToString(item) {\n  var _item = _slicedToArray(item, 4),\n      content = _item[1],\n      cssMapping = _item[3];\n\n  if (!cssMapping) {\n    return content;\n  }\n\n  if (typeof btoa === \"function\") {\n    // eslint-disable-next-line no-undef\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(cssMapping))));\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\n    var sourceMapping = \"/*# \".concat(data, \" */\");\n    var sourceURLs = cssMapping.sources.map(function (source) {\n      return \"/*# sourceURL=\".concat(cssMapping.sourceRoot || \"\").concat(source, \" */\");\n    });\n    return [content].concat(sourceURLs).concat([sourceMapping]).join(\"\\n\");\n  }\n\n  return [content].join(\"\\n\");\n};","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar ReactPropTypesSecret = require('./lib/ReactPropTypesSecret');\n\nfunction emptyFunction() {}\nfunction emptyFunctionWithReset() {}\nemptyFunctionWithReset.resetWarningCache = emptyFunction;\n\nmodule.exports = function() {\n  function shim(props, propName, componentName, location, propFullName, secret) {\n    if (secret === ReactPropTypesSecret) {\n      // It is still safe when called from React.\n      return;\n    }\n    var err = new Error(\n      'Calling PropTypes validators directly is not supported by the `prop-types` package. ' +\n      'Use PropTypes.checkPropTypes() to call them. ' +\n      'Read more at http://fb.me/use-check-prop-types'\n    );\n    err.name = 'Invariant Violation';\n    throw err;\n  };\n  shim.isRequired = shim;\n  function getShim() {\n    return shim;\n  };\n  // Important!\n  // Keep this list in sync with production version in `./factoryWithTypeCheckers.js`.\n  var ReactPropTypes = {\n    array: shim,\n    bigint: shim,\n    bool: shim,\n    func: shim,\n    number: shim,\n    object: shim,\n    string: shim,\n    symbol: shim,\n\n    any: shim,\n    arrayOf: getShim,\n    element: shim,\n    elementType: shim,\n    instanceOf: getShim,\n    node: shim,\n    objectOf: getShim,\n    oneOf: getShim,\n    oneOfType: getShim,\n    shape: getShim,\n    exact: getShim,\n\n    checkPropTypes: emptyFunctionWithReset,\n    resetWarningCache: emptyFunction\n  };\n\n  ReactPropTypes.PropTypes = ReactPropTypes;\n\n  return ReactPropTypes;\n};\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\nif (process.env.NODE_ENV !== 'production') {\n  var ReactIs = require('react-is');\n\n  // By explicitly using `prop-types` you are opting into new development behavior.\n  // http://fb.me/prop-types-in-prod\n  var throwOnDirectAccess = true;\n  module.exports = require('./factoryWithTypeCheckers')(ReactIs.isElement, throwOnDirectAccess);\n} else {\n  // By explicitly using `prop-types` you are opting into new production behavior.\n  // http://fb.me/prop-types-in-prod\n  module.exports = require('./factoryWithThrowingShims')();\n}\n","/**\n * Copyright (c) 2013-present, Facebook, Inc.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\n\n'use strict';\n\nvar ReactPropTypesSecret = 'SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED';\n\nmodule.exports = ReactPropTypesSecret;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nObject.defineProperty(exports, \"DraggableCore\", {\n  enumerable: true,\n  get: function () {\n    return _DraggableCore.default;\n  }\n});\nexports.default = void 0;\nvar React = _interopRequireWildcard(require(\"react\"));\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\nvar _reactDom = _interopRequireDefault(require(\"react-dom\"));\nvar _clsx = _interopRequireDefault(require(\"clsx\"));\nvar _domFns = require(\"./utils/domFns\");\nvar _positionFns = require(\"./utils/positionFns\");\nvar _shims = require(\"./utils/shims\");\nvar _DraggableCore = _interopRequireDefault(require(\"./DraggableCore\"));\nvar _log = _interopRequireDefault(require(\"./utils/log\"));\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); } /*:: import type {ControlPosition, PositionOffsetControlPosition, DraggableCoreProps, DraggableCoreDefaultProps} from './DraggableCore';*/\n/*:: import type {Bounds, DraggableEventHandler} from './utils/types';*/\n/*:: import type {Element as ReactElement} from 'react';*/\n/*:: type DraggableState = {\n  dragging: boolean,\n  dragged: boolean,\n  x: number, y: number,\n  slackX: number, slackY: number,\n  isElementSVG: boolean,\n  prevPropsPosition: ?ControlPosition,\n};*/\n/*:: export type DraggableDefaultProps = {\n  ...DraggableCoreDefaultProps,\n  axis: 'both' | 'x' | 'y' | 'none',\n  bounds: Bounds | string | false,\n  defaultClassName: string,\n  defaultClassNameDragging: string,\n  defaultClassNameDragged: string,\n  defaultPosition: ControlPosition,\n  scale: number,\n};*/\n/*:: export type DraggableProps = {\n  ...DraggableCoreProps,\n  ...DraggableDefaultProps,\n  positionOffset: PositionOffsetControlPosition,\n  position: ControlPosition,\n};*/\n//\n// Define <Draggable>\n//\nclass Draggable extends React.Component /*:: <DraggableProps, DraggableState>*/{\n  // React 16.3+\n  // Arity (props, state)\n  static getDerivedStateFromProps(_ref /*:: */, _ref2 /*:: */) /*: ?Partial<DraggableState>*/{\n    let {\n      position\n    } /*: DraggableProps*/ = _ref /*: DraggableProps*/;\n    let {\n      prevPropsPosition\n    } /*: DraggableState*/ = _ref2 /*: DraggableState*/;\n    // Set x/y if a new position is provided in props that is different than the previous.\n    if (position && (!prevPropsPosition || position.x !== prevPropsPosition.x || position.y !== prevPropsPosition.y)) {\n      (0, _log.default)('Draggable: getDerivedStateFromProps %j', {\n        position,\n        prevPropsPosition\n      });\n      return {\n        x: position.x,\n        y: position.y,\n        prevPropsPosition: {\n          ...position\n        }\n      };\n    }\n    return null;\n  }\n  constructor(props /*: DraggableProps*/) {\n    super(props);\n    _defineProperty(this, \"onDragStart\", (e, coreData) => {\n      (0, _log.default)('Draggable: onDragStart: %j', coreData);\n\n      // Short-circuit if user's callback killed it.\n      const shouldStart = this.props.onStart(e, (0, _positionFns.createDraggableData)(this, coreData));\n      // Kills start event on core as well, so move handlers are never bound.\n      if (shouldStart === false) return false;\n      this.setState({\n        dragging: true,\n        dragged: true\n      });\n    });\n    _defineProperty(this, \"onDrag\", (e, coreData) => {\n      if (!this.state.dragging) return false;\n      (0, _log.default)('Draggable: onDrag: %j', coreData);\n      const uiData = (0, _positionFns.createDraggableData)(this, coreData);\n      const newState = {\n        x: uiData.x,\n        y: uiData.y,\n        slackX: 0,\n        slackY: 0\n      };\n\n      // Keep within bounds.\n      if (this.props.bounds) {\n        // Save original x and y.\n        const {\n          x,\n          y\n        } = newState;\n\n        // Add slack to the values used to calculate bound position. This will ensure that if\n        // we start removing slack, the element won't react to it right away until it's been\n        // completely removed.\n        newState.x += this.state.slackX;\n        newState.y += this.state.slackY;\n\n        // Get bound position. This will ceil/floor the x and y within the boundaries.\n        const [newStateX, newStateY] = (0, _positionFns.getBoundPosition)(this, newState.x, newState.y);\n        newState.x = newStateX;\n        newState.y = newStateY;\n\n        // Recalculate slack by noting how much was shaved by the boundPosition handler.\n        newState.slackX = this.state.slackX + (x - newState.x);\n        newState.slackY = this.state.slackY + (y - newState.y);\n\n        // Update the event we fire to reflect what really happened after bounds took effect.\n        uiData.x = newState.x;\n        uiData.y = newState.y;\n        uiData.deltaX = newState.x - this.state.x;\n        uiData.deltaY = newState.y - this.state.y;\n      }\n\n      // Short-circuit if user's callback killed it.\n      const shouldUpdate = this.props.onDrag(e, uiData);\n      if (shouldUpdate === false) return false;\n      this.setState(newState);\n    });\n    _defineProperty(this, \"onDragStop\", (e, coreData) => {\n      if (!this.state.dragging) return false;\n\n      // Short-circuit if user's callback killed it.\n      const shouldContinue = this.props.onStop(e, (0, _positionFns.createDraggableData)(this, coreData));\n      if (shouldContinue === false) return false;\n      (0, _log.default)('Draggable: onDragStop: %j', coreData);\n      const newState /*: Partial<DraggableState>*/ = {\n        dragging: false,\n        slackX: 0,\n        slackY: 0\n      };\n\n      // If this is a controlled component, the result of this operation will be to\n      // revert back to the old position. We expect a handler on `onDragStop`, at the least.\n      const controlled = Boolean(this.props.position);\n      if (controlled) {\n        const {\n          x,\n          y\n        } = this.props.position;\n        newState.x = x;\n        newState.y = y;\n      }\n      this.setState(newState);\n    });\n    this.state = {\n      // Whether or not we are currently dragging.\n      dragging: false,\n      // Whether or not we have been dragged before.\n      dragged: false,\n      // Current transform x and y.\n      x: props.position ? props.position.x : props.defaultPosition.x,\n      y: props.position ? props.position.y : props.defaultPosition.y,\n      prevPropsPosition: {\n        ...props.position\n      },\n      // Used for compensating for out-of-bounds drags\n      slackX: 0,\n      slackY: 0,\n      // Can only determine if SVG after mounting\n      isElementSVG: false\n    };\n    if (props.position && !(props.onDrag || props.onStop)) {\n      // eslint-disable-next-line no-console\n      console.warn('A `position` was applied to this <Draggable>, without drag handlers. This will make this ' + 'component effectively undraggable. Please attach `onDrag` or `onStop` handlers so you can adjust the ' + '`position` of this element.');\n    }\n  }\n  componentDidMount() {\n    // Check to see if the element passed is an instanceof SVGElement\n    if (typeof window.SVGElement !== 'undefined' && this.findDOMNode() instanceof window.SVGElement) {\n      this.setState({\n        isElementSVG: true\n      });\n    }\n  }\n  componentWillUnmount() {\n    this.setState({\n      dragging: false\n    }); // prevents invariant if unmounted while dragging\n  }\n\n  // React Strict Mode compatibility: if `nodeRef` is passed, we will use it instead of trying to find\n  // the underlying DOM node ourselves. See the README for more information.\n  findDOMNode() /*: ?HTMLElement*/{\n    var _this$props$nodeRef$c, _this$props;\n    return (_this$props$nodeRef$c = (_this$props = this.props) === null || _this$props === void 0 || (_this$props = _this$props.nodeRef) === null || _this$props === void 0 ? void 0 : _this$props.current) !== null && _this$props$nodeRef$c !== void 0 ? _this$props$nodeRef$c : _reactDom.default.findDOMNode(this);\n  }\n  render() /*: ReactElement<any>*/{\n    const {\n      axis,\n      bounds,\n      children,\n      defaultPosition,\n      defaultClassName,\n      defaultClassNameDragging,\n      defaultClassNameDragged,\n      position,\n      positionOffset,\n      scale,\n      ...draggableCoreProps\n    } = this.props;\n    let style = {};\n    let svgTransform = null;\n\n    // If this is controlled, we don't want to move it - unless it's dragging.\n    const controlled = Boolean(position);\n    const draggable = !controlled || this.state.dragging;\n    const validPosition = position || defaultPosition;\n    const transformOpts = {\n      // Set left if horizontal drag is enabled\n      x: (0, _positionFns.canDragX)(this) && draggable ? this.state.x : validPosition.x,\n      // Set top if vertical drag is enabled\n      y: (0, _positionFns.canDragY)(this) && draggable ? this.state.y : validPosition.y\n    };\n\n    // If this element was SVG, we use the `transform` attribute.\n    if (this.state.isElementSVG) {\n      svgTransform = (0, _domFns.createSVGTransform)(transformOpts, positionOffset);\n    } else {\n      // Add a CSS transform to move the element around. This allows us to move the element around\n      // without worrying about whether or not it is relatively or absolutely positioned.\n      // If the item you are dragging already has a transform set, wrap it in a <span> so <Draggable>\n      // has a clean slate.\n      style = (0, _domFns.createCSSTransform)(transformOpts, positionOffset);\n    }\n\n    // Mark with class while dragging\n    const className = (0, _clsx.default)(children.props.className || '', defaultClassName, {\n      [defaultClassNameDragging]: this.state.dragging,\n      [defaultClassNameDragged]: this.state.dragged\n    });\n\n    // Reuse the child provided\n    // This makes it flexible to use whatever element is wanted (div, ul, etc)\n    return /*#__PURE__*/React.createElement(_DraggableCore.default, _extends({}, draggableCoreProps, {\n      onStart: this.onDragStart,\n      onDrag: this.onDrag,\n      onStop: this.onDragStop\n    }), /*#__PURE__*/React.cloneElement(React.Children.only(children), {\n      className: className,\n      style: {\n        ...children.props.style,\n        ...style\n      },\n      transform: svgTransform\n    }));\n  }\n}\nexports.default = Draggable;\n_defineProperty(Draggable, \"displayName\", 'Draggable');\n_defineProperty(Draggable, \"propTypes\", {\n  // Accepts all props <DraggableCore> accepts.\n  ..._DraggableCore.default.propTypes,\n  /**\n   * `axis` determines which axis the draggable can move.\n   *\n   *  Note that all callbacks will still return data as normal. This only\n   *  controls flushing to the DOM.\n   *\n   * 'both' allows movement horizontally and vertically.\n   * 'x' limits movement to horizontal axis.\n   * 'y' limits movement to vertical axis.\n   * 'none' limits all movement.\n   *\n   * Defaults to 'both'.\n   */\n  axis: _propTypes.default.oneOf(['both', 'x', 'y', 'none']),\n  /**\n   * `bounds` determines the range of movement available to the element.\n   * Available values are:\n   *\n   * 'parent' restricts movement within the Draggable's parent node.\n   *\n   * Alternatively, pass an object with the following properties, all of which are optional:\n   *\n   * {left: LEFT_BOUND, right: RIGHT_BOUND, bottom: BOTTOM_BOUND, top: TOP_BOUND}\n   *\n   * All values are in px.\n   *\n   * Example:\n   *\n   * ```jsx\n   *   let App = React.createClass({\n   *       render: function () {\n   *         return (\n   *            <Draggable bounds={{right: 300, bottom: 300}}>\n   *              <div>Content</div>\n   *           </Draggable>\n   *         );\n   *       }\n   *   });\n   * ```\n   */\n  bounds: _propTypes.default.oneOfType([_propTypes.default.shape({\n    left: _propTypes.default.number,\n    right: _propTypes.default.number,\n    top: _propTypes.default.number,\n    bottom: _propTypes.default.number\n  }), _propTypes.default.string, _propTypes.default.oneOf([false])]),\n  defaultClassName: _propTypes.default.string,\n  defaultClassNameDragging: _propTypes.default.string,\n  defaultClassNameDragged: _propTypes.default.string,\n  /**\n   * `defaultPosition` specifies the x and y that the dragged item should start at\n   *\n   * Example:\n   *\n   * ```jsx\n   *      let App = React.createClass({\n   *          render: function () {\n   *              return (\n   *                  <Draggable defaultPosition={{x: 25, y: 25}}>\n   *                      <div>I start with transformX: 25px and transformY: 25px;</div>\n   *                  </Draggable>\n   *              );\n   *          }\n   *      });\n   * ```\n   */\n  defaultPosition: _propTypes.default.shape({\n    x: _propTypes.default.number,\n    y: _propTypes.default.number\n  }),\n  positionOffset: _propTypes.default.shape({\n    x: _propTypes.default.oneOfType([_propTypes.default.number, _propTypes.default.string]),\n    y: _propTypes.default.oneOfType([_propTypes.default.number, _propTypes.default.string])\n  }),\n  /**\n   * `position`, if present, defines the current position of the element.\n   *\n   *  This is similar to how form elements in React work - if no `position` is supplied, the component\n   *  is uncontrolled.\n   *\n   * Example:\n   *\n   * ```jsx\n   *      let App = React.createClass({\n   *          render: function () {\n   *              return (\n   *                  <Draggable position={{x: 25, y: 25}}>\n   *                      <div>I start with transformX: 25px and transformY: 25px;</div>\n   *                  </Draggable>\n   *              );\n   *          }\n   *      });\n   * ```\n   */\n  position: _propTypes.default.shape({\n    x: _propTypes.default.number,\n    y: _propTypes.default.number\n  }),\n  /**\n   * These properties should be defined on the child, not here.\n   */\n  className: _shims.dontSetMe,\n  style: _shims.dontSetMe,\n  transform: _shims.dontSetMe\n});\n_defineProperty(Draggable, \"defaultProps\", {\n  ..._DraggableCore.default.defaultProps,\n  axis: 'both',\n  bounds: false,\n  defaultClassName: 'react-draggable',\n  defaultClassNameDragging: 'react-draggable-dragging',\n  defaultClassNameDragged: 'react-draggable-dragged',\n  defaultPosition: {\n    x: 0,\n    y: 0\n  },\n  scale: 1\n});","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\nvar React = _interopRequireWildcard(require(\"react\"));\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\nvar _reactDom = _interopRequireDefault(require(\"react-dom\"));\nvar _domFns = require(\"./utils/domFns\");\nvar _positionFns = require(\"./utils/positionFns\");\nvar _shims = require(\"./utils/shims\");\nvar _log = _interopRequireDefault(require(\"./utils/log\"));\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(arg) { var key = _toPrimitive(arg, \"string\"); return typeof key === \"symbol\" ? key : String(key); }\nfunction _toPrimitive(input, hint) { if (typeof input !== \"object\" || input === null) return input; var prim = input[Symbol.toPrimitive]; if (prim !== undefined) { var res = prim.call(input, hint || \"default\"); if (typeof res !== \"object\") return res; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (hint === \"string\" ? String : Number)(input); }\n/*:: import type {EventHandler, MouseTouchEvent} from './utils/types';*/\n/*:: import type {Element as ReactElement} from 'react';*/\n// Simple abstraction for dragging events names.\nconst eventsFor = {\n  touch: {\n    start: 'touchstart',\n    move: 'touchmove',\n    stop: 'touchend'\n  },\n  mouse: {\n    start: 'mousedown',\n    move: 'mousemove',\n    stop: 'mouseup'\n  }\n};\n\n// Default to mouse events.\nlet dragEventFor = eventsFor.mouse;\n/*:: export type DraggableData = {\n  node: HTMLElement,\n  x: number, y: number,\n  deltaX: number, deltaY: number,\n  lastX: number, lastY: number,\n};*/\n/*:: export type DraggableEventHandler = (e: MouseEvent, data: DraggableData) => void | false;*/\n/*:: export type ControlPosition = {x: number, y: number};*/\n/*:: export type PositionOffsetControlPosition = {x: number|string, y: number|string};*/\n/*:: export type DraggableCoreDefaultProps = {\n  allowAnyClick: boolean,\n  disabled: boolean,\n  enableUserSelectHack: boolean,\n  onStart: DraggableEventHandler,\n  onDrag: DraggableEventHandler,\n  onStop: DraggableEventHandler,\n  onMouseDown: (e: MouseEvent) => void,\n  scale: number,\n};*/\n/*:: export type DraggableCoreProps = {\n  ...DraggableCoreDefaultProps,\n  cancel: string,\n  children: ReactElement<any>,\n  offsetParent: HTMLElement,\n  grid: [number, number],\n  handle: string,\n  nodeRef?: ?React.ElementRef<any>,\n};*/\n//\n// Define <DraggableCore>.\n//\n// <DraggableCore> is for advanced usage of <Draggable>. It maintains minimal internal state so it can\n// work well with libraries that require more control over the element.\n//\n\nclass DraggableCore extends React.Component /*:: <DraggableCoreProps>*/{\n  constructor() {\n    super(...arguments);\n    _defineProperty(this, \"dragging\", false);\n    // Used while dragging to determine deltas.\n    _defineProperty(this, \"lastX\", NaN);\n    _defineProperty(this, \"lastY\", NaN);\n    _defineProperty(this, \"touchIdentifier\", null);\n    _defineProperty(this, \"mounted\", false);\n    _defineProperty(this, \"handleDragStart\", e => {\n      // Make it possible to attach event handlers on top of this one.\n      this.props.onMouseDown(e);\n\n      // Only accept left-clicks.\n      if (!this.props.allowAnyClick && typeof e.button === 'number' && e.button !== 0) return false;\n\n      // Get nodes. Be sure to grab relative document (could be iframed)\n      const thisNode = this.findDOMNode();\n      if (!thisNode || !thisNode.ownerDocument || !thisNode.ownerDocument.body) {\n        throw new Error('<DraggableCore> not mounted on DragStart!');\n      }\n      const {\n        ownerDocument\n      } = thisNode;\n\n      // Short circuit if handle or cancel prop was provided and selector doesn't match.\n      if (this.props.disabled || !(e.target instanceof ownerDocument.defaultView.Node) || this.props.handle && !(0, _domFns.matchesSelectorAndParentsTo)(e.target, this.props.handle, thisNode) || this.props.cancel && (0, _domFns.matchesSelectorAndParentsTo)(e.target, this.props.cancel, thisNode)) {\n        return;\n      }\n\n      // Prevent scrolling on mobile devices, like ipad/iphone.\n      // Important that this is after handle/cancel.\n      if (e.type === 'touchstart') e.preventDefault();\n\n      // Set touch identifier in component state if this is a touch event. This allows us to\n      // distinguish between individual touches on multitouch screens by identifying which\n      // touchpoint was set to this element.\n      const touchIdentifier = (0, _domFns.getTouchIdentifier)(e);\n      this.touchIdentifier = touchIdentifier;\n\n      // Get the current drag point from the event. This is used as the offset.\n      const position = (0, _positionFns.getControlPosition)(e, touchIdentifier, this);\n      if (position == null) return; // not possible but satisfies flow\n      const {\n        x,\n        y\n      } = position;\n\n      // Create an event object with all the data parents need to make a decision here.\n      const coreEvent = (0, _positionFns.createCoreData)(this, x, y);\n      (0, _log.default)('DraggableCore: handleDragStart: %j', coreEvent);\n\n      // Call event handler. If it returns explicit false, cancel.\n      (0, _log.default)('calling', this.props.onStart);\n      const shouldUpdate = this.props.onStart(e, coreEvent);\n      if (shouldUpdate === false || this.mounted === false) return;\n\n      // Add a style to the body to disable user-select. This prevents text from\n      // being selected all over the page.\n      if (this.props.enableUserSelectHack) (0, _domFns.addUserSelectStyles)(ownerDocument);\n\n      // Initiate dragging. Set the current x and y as offsets\n      // so we know how much we've moved during the drag. This allows us\n      // to drag elements around even if they have been moved, without issue.\n      this.dragging = true;\n      this.lastX = x;\n      this.lastY = y;\n\n      // Add events to the document directly so we catch when the user's mouse/touch moves outside of\n      // this element. We use different events depending on whether or not we have detected that this\n      // is a touch-capable device.\n      (0, _domFns.addEvent)(ownerDocument, dragEventFor.move, this.handleDrag);\n      (0, _domFns.addEvent)(ownerDocument, dragEventFor.stop, this.handleDragStop);\n    });\n    _defineProperty(this, \"handleDrag\", e => {\n      // Get the current drag point from the event. This is used as the offset.\n      const position = (0, _positionFns.getControlPosition)(e, this.touchIdentifier, this);\n      if (position == null) return;\n      let {\n        x,\n        y\n      } = position;\n\n      // Snap to grid if prop has been provided\n      if (Array.isArray(this.props.grid)) {\n        let deltaX = x - this.lastX,\n          deltaY = y - this.lastY;\n        [deltaX, deltaY] = (0, _positionFns.snapToGrid)(this.props.grid, deltaX, deltaY);\n        if (!deltaX && !deltaY) return; // skip useless drag\n        x = this.lastX + deltaX, y = this.lastY + deltaY;\n      }\n      const coreEvent = (0, _positionFns.createCoreData)(this, x, y);\n      (0, _log.default)('DraggableCore: handleDrag: %j', coreEvent);\n\n      // Call event handler. If it returns explicit false, trigger end.\n      const shouldUpdate = this.props.onDrag(e, coreEvent);\n      if (shouldUpdate === false || this.mounted === false) {\n        try {\n          // $FlowIgnore\n          this.handleDragStop(new MouseEvent('mouseup'));\n        } catch (err) {\n          // Old browsers\n          const event = ((document.createEvent('MouseEvents') /*: any*/) /*: MouseTouchEvent*/);\n          // I see why this insanity was deprecated\n          // $FlowIgnore\n          event.initMouseEvent('mouseup', true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\n          this.handleDragStop(event);\n        }\n        return;\n      }\n      this.lastX = x;\n      this.lastY = y;\n    });\n    _defineProperty(this, \"handleDragStop\", e => {\n      if (!this.dragging) return;\n      const position = (0, _positionFns.getControlPosition)(e, this.touchIdentifier, this);\n      if (position == null) return;\n      let {\n        x,\n        y\n      } = position;\n\n      // Snap to grid if prop has been provided\n      if (Array.isArray(this.props.grid)) {\n        let deltaX = x - this.lastX || 0;\n        let deltaY = y - this.lastY || 0;\n        [deltaX, deltaY] = (0, _positionFns.snapToGrid)(this.props.grid, deltaX, deltaY);\n        x = this.lastX + deltaX, y = this.lastY + deltaY;\n      }\n      const coreEvent = (0, _positionFns.createCoreData)(this, x, y);\n\n      // Call event handler\n      const shouldContinue = this.props.onStop(e, coreEvent);\n      if (shouldContinue === false || this.mounted === false) return false;\n      const thisNode = this.findDOMNode();\n      if (thisNode) {\n        // Remove user-select hack\n        if (this.props.enableUserSelectHack) (0, _domFns.removeUserSelectStyles)(thisNode.ownerDocument);\n      }\n      (0, _log.default)('DraggableCore: handleDragStop: %j', coreEvent);\n\n      // Reset the el.\n      this.dragging = false;\n      this.lastX = NaN;\n      this.lastY = NaN;\n      if (thisNode) {\n        // Remove event handlers\n        (0, _log.default)('DraggableCore: Removing handlers');\n        (0, _domFns.removeEvent)(thisNode.ownerDocument, dragEventFor.move, this.handleDrag);\n        (0, _domFns.removeEvent)(thisNode.ownerDocument, dragEventFor.stop, this.handleDragStop);\n      }\n    });\n    _defineProperty(this, \"onMouseDown\", e => {\n      dragEventFor = eventsFor.mouse; // on touchscreen laptops we could switch back to mouse\n\n      return this.handleDragStart(e);\n    });\n    _defineProperty(this, \"onMouseUp\", e => {\n      dragEventFor = eventsFor.mouse;\n      return this.handleDragStop(e);\n    });\n    // Same as onMouseDown (start drag), but now consider this a touch device.\n    _defineProperty(this, \"onTouchStart\", e => {\n      // We're on a touch device now, so change the event handlers\n      dragEventFor = eventsFor.touch;\n      return this.handleDragStart(e);\n    });\n    _defineProperty(this, \"onTouchEnd\", e => {\n      // We're on a touch device now, so change the event handlers\n      dragEventFor = eventsFor.touch;\n      return this.handleDragStop(e);\n    });\n  }\n  componentDidMount() {\n    this.mounted = true;\n    // Touch handlers must be added with {passive: false} to be cancelable.\n    // https://developers.google.com/web/updates/2017/01/scrolling-intervention\n    const thisNode = this.findDOMNode();\n    if (thisNode) {\n      (0, _domFns.addEvent)(thisNode, eventsFor.touch.start, this.onTouchStart, {\n        passive: false\n      });\n    }\n  }\n  componentWillUnmount() {\n    this.mounted = false;\n    // Remove any leftover event handlers. Remove both touch and mouse handlers in case\n    // some browser quirk caused a touch event to fire during a mouse move, or vice versa.\n    const thisNode = this.findDOMNode();\n    if (thisNode) {\n      const {\n        ownerDocument\n      } = thisNode;\n      (0, _domFns.removeEvent)(ownerDocument, eventsFor.mouse.move, this.handleDrag);\n      (0, _domFns.removeEvent)(ownerDocument, eventsFor.touch.move, this.handleDrag);\n      (0, _domFns.removeEvent)(ownerDocument, eventsFor.mouse.stop, this.handleDragStop);\n      (0, _domFns.removeEvent)(ownerDocument, eventsFor.touch.stop, this.handleDragStop);\n      (0, _domFns.removeEvent)(thisNode, eventsFor.touch.start, this.onTouchStart, {\n        passive: false\n      });\n      if (this.props.enableUserSelectHack) (0, _domFns.removeUserSelectStyles)(ownerDocument);\n    }\n  }\n\n  // React Strict Mode compatibility: if `nodeRef` is passed, we will use it instead of trying to find\n  // the underlying DOM node ourselves. See the README for more information.\n  findDOMNode() /*: ?HTMLElement*/{\n    var _this$props, _this$props2;\n    return (_this$props = this.props) !== null && _this$props !== void 0 && _this$props.nodeRef ? (_this$props2 = this.props) === null || _this$props2 === void 0 || (_this$props2 = _this$props2.nodeRef) === null || _this$props2 === void 0 ? void 0 : _this$props2.current : _reactDom.default.findDOMNode(this);\n  }\n  render() /*: React.Element<any>*/{\n    // Reuse the child provided\n    // This makes it flexible to use whatever element is wanted (div, ul, etc)\n    return /*#__PURE__*/React.cloneElement(React.Children.only(this.props.children), {\n      // Note: mouseMove handler is attached to document so it will still function\n      // when the user drags quickly and leaves the bounds of the element.\n      onMouseDown: this.onMouseDown,\n      onMouseUp: this.onMouseUp,\n      // onTouchStart is added on `componentDidMount` so they can be added with\n      // {passive: false}, which allows it to cancel. See\n      // https://developers.google.com/web/updates/2017/01/scrolling-intervention\n      onTouchEnd: this.onTouchEnd\n    });\n  }\n}\nexports.default = DraggableCore;\n_defineProperty(DraggableCore, \"displayName\", 'DraggableCore');\n_defineProperty(DraggableCore, \"propTypes\", {\n  /**\n   * `allowAnyClick` allows dragging using any mouse button.\n   * By default, we only accept the left button.\n   *\n   * Defaults to `false`.\n   */\n  allowAnyClick: _propTypes.default.bool,\n  children: _propTypes.default.node.isRequired,\n  /**\n   * `disabled`, if true, stops the <Draggable> from dragging. All handlers,\n   * with the exception of `onMouseDown`, will not fire.\n   */\n  disabled: _propTypes.default.bool,\n  /**\n   * By default, we add 'user-select:none' attributes to the document body\n   * to prevent ugly text selection during drag. If this is causing problems\n   * for your app, set this to `false`.\n   */\n  enableUserSelectHack: _propTypes.default.bool,\n  /**\n   * `offsetParent`, if set, uses the passed DOM node to compute drag offsets\n   * instead of using the parent node.\n   */\n  offsetParent: function (props /*: DraggableCoreProps*/, propName /*: $Keys<DraggableCoreProps>*/) {\n    if (props[propName] && props[propName].nodeType !== 1) {\n      throw new Error('Draggable\\'s offsetParent must be a DOM Node.');\n    }\n  },\n  /**\n   * `grid` specifies the x and y that dragging should snap to.\n   */\n  grid: _propTypes.default.arrayOf(_propTypes.default.number),\n  /**\n   * `handle` specifies a selector to be used as the handle that initiates drag.\n   *\n   * Example:\n   *\n   * ```jsx\n   *   let App = React.createClass({\n   *       render: function () {\n   *         return (\n   *            <Draggable handle=\".handle\">\n   *              <div>\n   *                  <div className=\"handle\">Click me to drag</div>\n   *                  <div>This is some other content</div>\n   *              </div>\n   *           </Draggable>\n   *         );\n   *       }\n   *   });\n   * ```\n   */\n  handle: _propTypes.default.string,\n  /**\n   * `cancel` specifies a selector to be used to prevent drag initialization.\n   *\n   * Example:\n   *\n   * ```jsx\n   *   let App = React.createClass({\n   *       render: function () {\n   *           return(\n   *               <Draggable cancel=\".cancel\">\n   *                   <div>\n   *                     <div className=\"cancel\">You can't drag from here</div>\n   *                     <div>Dragging here works fine</div>\n   *                   </div>\n   *               </Draggable>\n   *           );\n   *       }\n   *   });\n   * ```\n   */\n  cancel: _propTypes.default.string,\n  /* If running in React Strict mode, ReactDOM.findDOMNode() is deprecated.\n   * Unfortunately, in order for <Draggable> to work properly, we need raw access\n   * to the underlying DOM node. If you want to avoid the warning, pass a `nodeRef`\n   * as in this example:\n   *\n   * function MyComponent() {\n   *   const nodeRef = React.useRef(null);\n   *   return (\n   *     <Draggable nodeRef={nodeRef}>\n   *       <div ref={nodeRef}>Example Target</div>\n   *     </Draggable>\n   *   );\n   * }\n   *\n   * This can be used for arbitrarily nested components, so long as the ref ends up\n   * pointing to the actual child DOM node and not a custom component.\n   */\n  nodeRef: _propTypes.default.object,\n  /**\n   * Called when dragging starts.\n   * If this function returns the boolean false, dragging will be canceled.\n   */\n  onStart: _propTypes.default.func,\n  /**\n   * Called while dragging.\n   * If this function returns the boolean false, dragging will be canceled.\n   */\n  onDrag: _propTypes.default.func,\n  /**\n   * Called when dragging stops.\n   * If this function returns the boolean false, the drag will remain active.\n   */\n  onStop: _propTypes.default.func,\n  /**\n   * A workaround option which can be passed if onMouseDown needs to be accessed,\n   * since it'll always be blocked (as there is internal use of onMouseDown)\n   */\n  onMouseDown: _propTypes.default.func,\n  /**\n   * `scale`, if set, applies scaling while dragging an element\n   */\n  scale: _propTypes.default.number,\n  /**\n   * These properties should be defined on the child, not here.\n   */\n  className: _shims.dontSetMe,\n  style: _shims.dontSetMe,\n  transform: _shims.dontSetMe\n});\n_defineProperty(DraggableCore, \"defaultProps\", {\n  allowAnyClick: false,\n  // by default only accept left click\n  disabled: false,\n  enableUserSelectHack: true,\n  onStart: function () {},\n  onDrag: function () {},\n  onStop: function () {},\n  onMouseDown: function () {},\n  scale: 1\n});","\"use strict\";\n\nconst {\n  default: Draggable,\n  DraggableCore\n} = require('./Draggable');\n\n// Previous versions of this lib exported <Draggable> as the root export. As to no-// them, or TypeScript, we export *both* as the root and as 'default'.\n// See https://github.com/mzabriskie/react-draggable/pull/254\n// and https://github.com/mzabriskie/react-draggable/issues/266\nmodule.exports = Draggable;\nmodule.exports.default = Draggable;\nmodule.exports.DraggableCore = DraggableCore;","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.addClassName = addClassName;\nexports.addEvent = addEvent;\nexports.addUserSelectStyles = addUserSelectStyles;\nexports.createCSSTransform = createCSSTransform;\nexports.createSVGTransform = createSVGTransform;\nexports.getTouch = getTouch;\nexports.getTouchIdentifier = getTouchIdentifier;\nexports.getTranslation = getTranslation;\nexports.innerHeight = innerHeight;\nexports.innerWidth = innerWidth;\nexports.matchesSelector = matchesSelector;\nexports.matchesSelectorAndParentsTo = matchesSelectorAndParentsTo;\nexports.offsetXYFromParent = offsetXYFromParent;\nexports.outerHeight = outerHeight;\nexports.outerWidth = outerWidth;\nexports.removeClassName = removeClassName;\nexports.removeEvent = removeEvent;\nexports.removeUserSelectStyles = removeUserSelectStyles;\nvar _shims = require(\"./shims\");\nvar _getPrefix = _interopRequireWildcard(require(\"./getPrefix\"));\nfunction _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== \"function\") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function (nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }\nfunction _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== \"object\" && typeof obj !== \"function\") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== \"default\" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n/*:: import type {ControlPosition, PositionOffsetControlPosition, MouseTouchEvent} from './types';*/\nlet matchesSelectorFunc = '';\nfunction matchesSelector(el /*: Node*/, selector /*: string*/) /*: boolean*/{\n  if (!matchesSelectorFunc) {\n    matchesSelectorFunc = (0, _shims.findInArray)(['matches', 'webkitMatchesSelector', 'mozMatchesSelector', 'msMatchesSelector', 'oMatchesSelector'], function (method) {\n      // $FlowIgnore: Doesn't think elements are indexable\n      return (0, _shims.isFunction)(el[method]);\n    });\n  }\n\n  // Might not be found entirely (not an Element?) - in that case, bail\n  // $FlowIgnore: Doesn't think elements are indexable\n  if (!(0, _shims.isFunction)(el[matchesSelectorFunc])) return false;\n\n  // $FlowIgnore: Doesn't think elements are indexable\n  return el[matchesSelectorFunc](selector);\n}\n\n// Works up the tree to the draggable itself attempting to match selector.\nfunction matchesSelectorAndParentsTo(el /*: Node*/, selector /*: string*/, baseNode /*: Node*/) /*: boolean*/{\n  let node = el;\n  do {\n    if (matchesSelector(node, selector)) return true;\n    if (node === baseNode) return false;\n    // $FlowIgnore[incompatible-type]\n    node = node.parentNode;\n  } while (node);\n  return false;\n}\nfunction addEvent(el /*: ?Node*/, event /*: string*/, handler /*: Function*/, inputOptions /*: Object*/) /*: void*/{\n  if (!el) return;\n  const options = {\n    capture: true,\n    ...inputOptions\n  };\n  // $FlowIgnore[method-unbinding]\n  if (el.addEventListener) {\n    el.addEventListener(event, handler, options);\n  } else if (el.attachEvent) {\n    el.attachEvent('on' + event, handler);\n  } else {\n    // $FlowIgnore: Doesn't think elements are indexable\n    el['on' + event] = handler;\n  }\n}\nfunction removeEvent(el /*: ?Node*/, event /*: string*/, handler /*: Function*/, inputOptions /*: Object*/) /*: void*/{\n  if (!el) return;\n  const options = {\n    capture: true,\n    ...inputOptions\n  };\n  // $FlowIgnore[method-unbinding]\n  if (el.removeEventListener) {\n    el.removeEventListener(event, handler, options);\n  } else if (el.detachEvent) {\n    el.detachEvent('on' + event, handler);\n  } else {\n    // $FlowIgnore: Doesn't think elements are indexable\n    el['on' + event] = null;\n  }\n}\nfunction outerHeight(node /*: HTMLElement*/) /*: number*/{\n  // This is deliberately excluding margin for our calculations, since we are using\n  // offsetTop which is including margin. See getBoundPosition\n  let height = node.clientHeight;\n  const computedStyle = node.ownerDocument.defaultView.getComputedStyle(node);\n  height += (0, _shims.int)(computedStyle.borderTopWidth);\n  height += (0, _shims.int)(computedStyle.borderBottomWidth);\n  return height;\n}\nfunction outerWidth(node /*: HTMLElement*/) /*: number*/{\n  // This is deliberately excluding margin for our calculations, since we are using\n  // offsetLeft which is including margin. See getBoundPosition\n  let width = node.clientWidth;\n  const computedStyle = node.ownerDocument.defaultView.getComputedStyle(node);\n  width += (0, _shims.int)(computedStyle.borderLeftWidth);\n  width += (0, _shims.int)(computedStyle.borderRightWidth);\n  return width;\n}\nfunction innerHeight(node /*: HTMLElement*/) /*: number*/{\n  let height = node.clientHeight;\n  const computedStyle = node.ownerDocument.defaultView.getComputedStyle(node);\n  height -= (0, _shims.int)(computedStyle.paddingTop);\n  height -= (0, _shims.int)(computedStyle.paddingBottom);\n  return height;\n}\nfunction innerWidth(node /*: HTMLElement*/) /*: number*/{\n  let width = node.clientWidth;\n  const computedStyle = node.ownerDocument.defaultView.getComputedStyle(node);\n  width -= (0, _shims.int)(computedStyle.paddingLeft);\n  width -= (0, _shims.int)(computedStyle.paddingRight);\n  return width;\n}\n/*:: interface EventWithOffset {\n  clientX: number, clientY: number\n}*/\n// Get from offsetParent\nfunction offsetXYFromParent(evt /*: EventWithOffset*/, offsetParent /*: HTMLElement*/, scale /*: number*/) /*: ControlPosition*/{\n  const isBody = offsetParent === offsetParent.ownerDocument.body;\n  const offsetParentRect = isBody ? {\n    left: 0,\n    top: 0\n  } : offsetParent.getBoundingClientRect();\n  const x = (evt.clientX + offsetParent.scrollLeft - offsetParentRect.left) / scale;\n  const y = (evt.clientY + offsetParent.scrollTop - offsetParentRect.top) / scale;\n  return {\n    x,\n    y\n  };\n}\nfunction createCSSTransform(controlPos /*: ControlPosition*/, positionOffset /*: PositionOffsetControlPosition*/) /*: Object*/{\n  const translation = getTranslation(controlPos, positionOffset, 'px');\n  return {\n    [(0, _getPrefix.browserPrefixToKey)('transform', _getPrefix.default)]: translation\n  };\n}\nfunction createSVGTransform(controlPos /*: ControlPosition*/, positionOffset /*: PositionOffsetControlPosition*/) /*: string*/{\n  const translation = getTranslation(controlPos, positionOffset, '');\n  return translation;\n}\nfunction getTranslation(_ref /*:: */, positionOffset /*: PositionOffsetControlPosition*/, unitSuffix /*: string*/) /*: string*/{\n  let {\n    x,\n    y\n  } /*: ControlPosition*/ = _ref /*: ControlPosition*/;\n  let translation = \"translate(\".concat(x).concat(unitSuffix, \",\").concat(y).concat(unitSuffix, \")\");\n  if (positionOffset) {\n    const defaultX = \"\".concat(typeof positionOffset.x === 'string' ? positionOffset.x : positionOffset.x + unitSuffix);\n    const defaultY = \"\".concat(typeof positionOffset.y === 'string' ? positionOffset.y : positionOffset.y + unitSuffix);\n    translation = \"translate(\".concat(defaultX, \", \").concat(defaultY, \")\") + translation;\n  }\n  return translation;\n}\nfunction getTouch(e /*: MouseTouchEvent*/, identifier /*: number*/) /*: ?{clientX: number, clientY: number}*/{\n  return e.targetTouches && (0, _shims.findInArray)(e.targetTouches, t => identifier === t.identifier) || e.changedTouches && (0, _shims.findInArray)(e.changedTouches, t => identifier === t.identifier);\n}\nfunction getTouchIdentifier(e /*: MouseTouchEvent*/) /*: ?number*/{\n  if (e.targetTouches && e.targetTouches[0]) return e.targetTouches[0].identifier;\n  if (e.changedTouches && e.changedTouches[0]) return e.changedTouches[0].identifier;\n}\n\n// User-select Hacks:\n//\n// Useful for preventing blue highlights all over everything when dragging.\n\n// Note we're passing `document` b/c we could be iframed\nfunction addUserSelectStyles(doc /*: ?Document*/) {\n  if (!doc) return;\n  let styleEl = doc.getElementById('react-draggable-style-el');\n  if (!styleEl) {\n    styleEl = doc.createElement('style');\n    styleEl.type = 'text/css';\n    styleEl.id = 'react-draggable-style-el';\n    styleEl.innerHTML = '.react-draggable-transparent-selection *::-moz-selection {all: inherit;}\\n';\n    styleEl.innerHTML += '.react-draggable-transparent-selection *::selection {all: inherit;}\\n';\n    doc.getElementsByTagName('head')[0].appendChild(styleEl);\n  }\n  if (doc.body) addClassName(doc.body, 'react-draggable-transparent-selection');\n}\nfunction removeUserSelectStyles(doc /*: ?Document*/) {\n  if (!doc) return;\n  try {\n    if (doc.body) removeClassName(doc.body, 'react-draggable-transparent-selection');\n    // $FlowIgnore: IE\n    if (doc.selection) {\n      // $FlowIgnore: IE\n      doc.selection.empty();\n    } else {\n      // Remove selection caused by scroll, unless it's a focused input\n      // (we use doc.defaultView in case we're in an iframe)\n      const selection = (doc.defaultView || window).getSelection();\n      if (selection && selection.type !== 'Caret') {\n        selection.removeAllRanges();\n      }\n    }\n  } catch (e) {\n    // probably IE\n  }\n}\nfunction addClassName(el /*: HTMLElement*/, className /*: string*/) {\n  if (el.classList) {\n    el.classList.add(className);\n  } else {\n    if (!el.className.match(new RegExp(\"(?:^|\\\\s)\".concat(className, \"(?!\\\\S)\")))) {\n      el.className += \" \".concat(className);\n    }\n  }\n}\nfunction removeClassName(el /*: HTMLElement*/, className /*: string*/) {\n  if (el.classList) {\n    el.classList.remove(className);\n  } else {\n    el.className = el.className.replace(new RegExp(\"(?:^|\\\\s)\".concat(className, \"(?!\\\\S)\"), 'g'), '');\n  }\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.browserPrefixToKey = browserPrefixToKey;\nexports.browserPrefixToStyle = browserPrefixToStyle;\nexports.default = void 0;\nexports.getPrefix = getPrefix;\nconst prefixes = ['Moz', 'Webkit', 'O', 'ms'];\nfunction getPrefix() /*: string*/{\n  var _window$document;\n  let prop /*: string*/ = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'transform';\n  // Ensure we're running in an environment where there is actually a global\n  // `window` obj\n  if (typeof window === 'undefined') return '';\n\n  // If we're in a pseudo-browser server-side environment, this access\n  // path may not exist, so bail out if it doesn't.\n  const style = (_window$document = window.document) === null || _window$document === void 0 || (_window$document = _window$document.documentElement) === null || _window$document === void 0 ? void 0 : _window$document.style;\n  if (!style) return '';\n  if (prop in style) return '';\n  for (let i = 0; i < prefixes.length; i++) {\n    if (browserPrefixToKey(prop, prefixes[i]) in style) return prefixes[i];\n  }\n  return '';\n}\nfunction browserPrefixToKey(prop /*: string*/, prefix /*: string*/) /*: string*/{\n  return prefix ? \"\".concat(prefix).concat(kebabToTitleCase(prop)) : prop;\n}\nfunction browserPrefixToStyle(prop /*: string*/, prefix /*: string*/) /*: string*/{\n  return prefix ? \"-\".concat(prefix.toLowerCase(), \"-\").concat(prop) : prop;\n}\nfunction kebabToTitleCase(str /*: string*/) /*: string*/{\n  let out = '';\n  let shouldCapitalize = true;\n  for (let i = 0; i < str.length; i++) {\n    if (shouldCapitalize) {\n      out += str[i].toUpperCase();\n      shouldCapitalize = false;\n    } else if (str[i] === '-') {\n      shouldCapitalize = true;\n    } else {\n      out += str[i];\n    }\n  }\n  return out;\n}\n\n// Default export is the prefix itself, like 'Moz', 'Webkit', etc\n// Note that you may have to re-test for certain things; for instance, Chrome 50\n// can handle unprefixed `transform`, but not unprefixed `user-select`\nvar _default = exports.default = (getPrefix() /*: string*/);","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = log;\n/*eslint no-console:0*/\nfunction log() {\n  if (undefined) console.log(...arguments);\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.canDragX = canDragX;\nexports.canDragY = canDragY;\nexports.createCoreData = createCoreData;\nexports.createDraggableData = createDraggableData;\nexports.getBoundPosition = getBoundPosition;\nexports.getControlPosition = getControlPosition;\nexports.snapToGrid = snapToGrid;\nvar _shims = require(\"./shims\");\nvar _domFns = require(\"./domFns\");\n/*:: import type Draggable from '../Draggable';*/\n/*:: import type {Bounds, ControlPosition, DraggableData, MouseTouchEvent} from './types';*/\n/*:: import type DraggableCore from '../DraggableCore';*/\nfunction getBoundPosition(draggable /*: Draggable*/, x /*: number*/, y /*: number*/) /*: [number, number]*/{\n  // If no bounds, short-circuit and move on\n  if (!draggable.props.bounds) return [x, y];\n\n  // Clone new bounds\n  let {\n    bounds\n  } = draggable.props;\n  bounds = typeof bounds === 'string' ? bounds : cloneBounds(bounds);\n  const node = findDOMNode(draggable);\n  if (typeof bounds === 'string') {\n    const {\n      ownerDocument\n    } = node;\n    const ownerWindow = ownerDocument.defaultView;\n    let boundNode;\n    if (bounds === 'parent') {\n      boundNode = node.parentNode;\n    } else {\n      boundNode = ownerDocument.querySelector(bounds);\n    }\n    if (!(boundNode instanceof ownerWindow.HTMLElement)) {\n      throw new Error('Bounds selector \"' + bounds + '\" could not find an element.');\n    }\n    const boundNodeEl /*: HTMLElement*/ = boundNode; // for Flow, can't seem to refine correctly\n    const nodeStyle = ownerWindow.getComputedStyle(node);\n    const boundNodeStyle = ownerWindow.getComputedStyle(boundNodeEl);\n    // Compute bounds. This is a pain with padding and offsets but this gets it exactly right.\n    bounds = {\n      left: -node.offsetLeft + (0, _shims.int)(boundNodeStyle.paddingLeft) + (0, _shims.int)(nodeStyle.marginLeft),\n      top: -node.offsetTop + (0, _shims.int)(boundNodeStyle.paddingTop) + (0, _shims.int)(nodeStyle.marginTop),\n      right: (0, _domFns.innerWidth)(boundNodeEl) - (0, _domFns.outerWidth)(node) - node.offsetLeft + (0, _shims.int)(boundNodeStyle.paddingRight) - (0, _shims.int)(nodeStyle.marginRight),\n      bottom: (0, _domFns.innerHeight)(boundNodeEl) - (0, _domFns.outerHeight)(node) - node.offsetTop + (0, _shims.int)(boundNodeStyle.paddingBottom) - (0, _shims.int)(nodeStyle.marginBottom)\n    };\n  }\n\n  // Keep x and y below right and bottom limits...\n  if ((0, _shims.isNum)(bounds.right)) x = Math.min(x, bounds.right);\n  if ((0, _shims.isNum)(bounds.bottom)) y = Math.min(y, bounds.bottom);\n\n  // But above left and top limits.\n  if ((0, _shims.isNum)(bounds.left)) x = Math.max(x, bounds.left);\n  if ((0, _shims.isNum)(bounds.top)) y = Math.max(y, bounds.top);\n  return [x, y];\n}\nfunction snapToGrid(grid /*: [number, number]*/, pendingX /*: number*/, pendingY /*: number*/) /*: [number, number]*/{\n  const x = Math.round(pendingX / grid[0]) * grid[0];\n  const y = Math.round(pendingY / grid[1]) * grid[1];\n  return [x, y];\n}\nfunction canDragX(draggable /*: Draggable*/) /*: boolean*/{\n  return draggable.props.axis === 'both' || draggable.props.axis === 'x';\n}\nfunction canDragY(draggable /*: Draggable*/) /*: boolean*/{\n  return draggable.props.axis === 'both' || draggable.props.axis === 'y';\n}\n\n// Get {x, y} positions from event.\nfunction getControlPosition(e /*: MouseTouchEvent*/, touchIdentifier /*: ?number*/, draggableCore /*: DraggableCore*/) /*: ?ControlPosition*/{\n  const touchObj = typeof touchIdentifier === 'number' ? (0, _domFns.getTouch)(e, touchIdentifier) : null;\n  if (typeof touchIdentifier === 'number' && !touchObj) return null; // not the right touch\n  const node = findDOMNode(draggableCore);\n  // User can provide an offsetParent if desired.\n  const offsetParent = draggableCore.props.offsetParent || node.offsetParent || node.ownerDocument.body;\n  return (0, _domFns.offsetXYFromParent)(touchObj || e, offsetParent, draggableCore.props.scale);\n}\n\n// Create an data object exposed by <DraggableCore>'s events\nfunction createCoreData(draggable /*: DraggableCore*/, x /*: number*/, y /*: number*/) /*: DraggableData*/{\n  const isStart = !(0, _shims.isNum)(draggable.lastX);\n  const node = findDOMNode(draggable);\n  if (isStart) {\n    // If this is our first move, use the x and y as last coords.\n    return {\n      node,\n      deltaX: 0,\n      deltaY: 0,\n      lastX: x,\n      lastY: y,\n      x,\n      y\n    };\n  } else {\n    // Otherwise calculate proper values.\n    return {\n      node,\n      deltaX: x - draggable.lastX,\n      deltaY: y - draggable.lastY,\n      lastX: draggable.lastX,\n      lastY: draggable.lastY,\n      x,\n      y\n    };\n  }\n}\n\n// Create an data exposed by <Draggable>'s events\nfunction createDraggableData(draggable /*: Draggable*/, coreData /*: DraggableData*/) /*: DraggableData*/{\n  const scale = draggable.props.scale;\n  return {\n    node: coreData.node,\n    x: draggable.state.x + coreData.deltaX / scale,\n    y: draggable.state.y + coreData.deltaY / scale,\n    deltaX: coreData.deltaX / scale,\n    deltaY: coreData.deltaY / scale,\n    lastX: draggable.state.x,\n    lastY: draggable.state.y\n  };\n}\n\n// A lot faster than stringify/parse\nfunction cloneBounds(bounds /*: Bounds*/) /*: Bounds*/{\n  return {\n    left: bounds.left,\n    top: bounds.top,\n    right: bounds.right,\n    bottom: bounds.bottom\n  };\n}\nfunction findDOMNode(draggable /*: Draggable | DraggableCore*/) /*: HTMLElement*/{\n  const node = draggable.findDOMNode();\n  if (!node) {\n    throw new Error('<DraggableCore>: Unmounted during event!');\n  }\n  // $FlowIgnore we can't assert on HTMLElement due to tests... FIXME\n  return node;\n}","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.dontSetMe = dontSetMe;\nexports.findInArray = findInArray;\nexports.int = int;\nexports.isFunction = isFunction;\nexports.isNum = isNum;\n// @credits https://gist.github.com/rogozhnikoff/a43cfed27c41e4e68cdc\nfunction findInArray(array /*: Array<any> | TouchList*/, callback /*: Function*/) /*: any*/{\n  for (let i = 0, length = array.length; i < length; i++) {\n    if (callback.apply(callback, [array[i], i, array])) return array[i];\n  }\n}\nfunction isFunction(func /*: any*/) /*: boolean %checks*/{\n  // $FlowIgnore[method-unbinding]\n  return typeof func === 'function' || Object.prototype.toString.call(func) === '[object Function]';\n}\nfunction isNum(num /*: any*/) /*: boolean %checks*/{\n  return typeof num === 'number' && !isNaN(num);\n}\nfunction int(a /*: string*/) /*: number*/{\n  return parseInt(a, 10);\n}\nfunction dontSetMe(props /*: Object*/, propName /*: string*/, componentName /*: string*/) /*: ?Error*/{\n  if (props[propName]) {\n    return new Error(\"Invalid prop \".concat(propName, \" passed to \").concat(componentName, \" - do not set this, set it on the child.\"));\n  }\n}","\"use strict\";\n\nvar isOldIE = function isOldIE() {\n  var memo;\n  return function memorize() {\n    if (typeof memo === 'undefined') {\n      // Test for IE <= 9 as proposed by Browserhacks\n      // @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n      // Tests for existence of standard globals is to allow style-loader\n      // to operate correctly into non-standard environments\n      // @see https://github.com/webpack-contrib/style-loader/issues/177\n      memo = Boolean(window && document && document.all && !window.atob);\n    }\n\n    return memo;\n  };\n}();\n\nvar getTarget = function getTarget() {\n  var memo = {};\n  return function memorize(target) {\n    if (typeof memo[target] === 'undefined') {\n      var styleTarget = document.querySelector(target); // Special case to return head of iframe instead of iframe itself\n\n      if (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n        try {\n          // This will throw an exception if access to iframe is blocked\n          // due to cross-origin restrictions\n          styleTarget = styleTarget.contentDocument.head;\n        } catch (e) {\n          // istanbul ignore next\n          styleTarget = null;\n        }\n      }\n\n      memo[target] = styleTarget;\n    }\n\n    return memo[target];\n  };\n}();\n\nvar stylesInDom = [];\n\nfunction getIndexByIdentifier(identifier) {\n  var result = -1;\n\n  for (var i = 0; i < stylesInDom.length; i++) {\n    if (stylesInDom[i].identifier === identifier) {\n      result = i;\n      break;\n    }\n  }\n\n  return result;\n}\n\nfunction modulesToDom(list, options) {\n  var idCountMap = {};\n  var identifiers = [];\n\n  for (var i = 0; i < list.length; i++) {\n    var item = list[i];\n    var id = options.base ? item[0] + options.base : item[0];\n    var count = idCountMap[id] || 0;\n    var identifier = \"\".concat(id, \" \").concat(count);\n    idCountMap[id] = count + 1;\n    var index = getIndexByIdentifier(identifier);\n    var obj = {\n      css: item[1],\n      media: item[2],\n      sourceMap: item[3]\n    };\n\n    if (index !== -1) {\n      stylesInDom[index].references++;\n      stylesInDom[index].updater(obj);\n    } else {\n      stylesInDom.push({\n        identifier: identifier,\n        updater: addStyle(obj, options),\n        references: 1\n      });\n    }\n\n    identifiers.push(identifier);\n  }\n\n  return identifiers;\n}\n\nfunction insertStyleElement(options) {\n  var style = document.createElement('style');\n  var attributes = options.attributes || {};\n\n  if (typeof attributes.nonce === 'undefined') {\n    var nonce = typeof __webpack_nonce__ !== 'undefined' ? __webpack_nonce__ : null;\n\n    if (nonce) {\n      attributes.nonce = nonce;\n    }\n  }\n\n  Object.keys(attributes).forEach(function (key) {\n    style.setAttribute(key, attributes[key]);\n  });\n\n  if (typeof options.insert === 'function') {\n    options.insert(style);\n  } else {\n    var target = getTarget(options.insert || 'head');\n\n    if (!target) {\n      throw new Error(\"Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.\");\n    }\n\n    target.appendChild(style);\n  }\n\n  return style;\n}\n\nfunction removeStyleElement(style) {\n  // istanbul ignore if\n  if (style.parentNode === null) {\n    return false;\n  }\n\n  style.parentNode.removeChild(style);\n}\n/* istanbul ignore next  */\n\n\nvar replaceText = function replaceText() {\n  var textStore = [];\n  return function replace(index, replacement) {\n    textStore[index] = replacement;\n    return textStore.filter(Boolean).join('\\n');\n  };\n}();\n\nfunction applyToSingletonTag(style, index, remove, obj) {\n  var css = remove ? '' : obj.media ? \"@media \".concat(obj.media, \" {\").concat(obj.css, \"}\") : obj.css; // For old IE\n\n  /* istanbul ignore if  */\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = replaceText(index, css);\n  } else {\n    var cssNode = document.createTextNode(css);\n    var childNodes = style.childNodes;\n\n    if (childNodes[index]) {\n      style.removeChild(childNodes[index]);\n    }\n\n    if (childNodes.length) {\n      style.insertBefore(cssNode, childNodes[index]);\n    } else {\n      style.appendChild(cssNode);\n    }\n  }\n}\n\nfunction applyToTag(style, options, obj) {\n  var css = obj.css;\n  var media = obj.media;\n  var sourceMap = obj.sourceMap;\n\n  if (media) {\n    style.setAttribute('media', media);\n  } else {\n    style.removeAttribute('media');\n  }\n\n  if (sourceMap && typeof btoa !== 'undefined') {\n    css += \"\\n/*# sourceMappingURL=data:application/json;base64,\".concat(btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))), \" */\");\n  } // For old IE\n\n  /* istanbul ignore if  */\n\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    while (style.firstChild) {\n      style.removeChild(style.firstChild);\n    }\n\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar singleton = null;\nvar singletonCounter = 0;\n\nfunction addStyle(obj, options) {\n  var style;\n  var update;\n  var remove;\n\n  if (options.singleton) {\n    var styleIndex = singletonCounter++;\n    style = singleton || (singleton = insertStyleElement(options));\n    update = applyToSingletonTag.bind(null, style, styleIndex, false);\n    remove = applyToSingletonTag.bind(null, style, styleIndex, true);\n  } else {\n    style = insertStyleElement(options);\n    update = applyToTag.bind(null, style, options);\n\n    remove = function remove() {\n      removeStyleElement(style);\n    };\n  }\n\n  update(obj);\n  return function updateStyle(newObj) {\n    if (newObj) {\n      if (newObj.css === obj.css && newObj.media === obj.media && newObj.sourceMap === obj.sourceMap) {\n        return;\n      }\n\n      update(obj = newObj);\n    } else {\n      remove();\n    }\n  };\n}\n\nmodule.exports = function (list, options) {\n  options = options || {}; // Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n  // tags it will allow on a page\n\n  if (!options.singleton && typeof options.singleton !== 'boolean') {\n    options.singleton = isOldIE();\n  }\n\n  list = list || [];\n  var lastIdentifiers = modulesToDom(list, options);\n  return function update(newList) {\n    newList = newList || [];\n\n    if (Object.prototype.toString.call(newList) !== '[object Array]') {\n      return;\n    }\n\n    for (var i = 0; i < lastIdentifiers.length; i++) {\n      var identifier = lastIdentifiers[i];\n      var index = getIndexByIdentifier(identifier);\n      stylesInDom[index].references--;\n    }\n\n    var newLastIdentifiers = modulesToDom(newList, options);\n\n    for (var _i = 0; _i < lastIdentifiers.length; _i++) {\n      var _identifier = lastIdentifiers[_i];\n\n      var _index = getIndexByIdentifier(_identifier);\n\n      if (stylesInDom[_index].references === 0) {\n        stylesInDom[_index].updater();\n\n        stylesInDom.splice(_index, 1);\n      }\n    }\n\n    lastIdentifiers = newLastIdentifiers;\n  };\n};","export class CloudFile {\r\n  private name: string;\r\n  private url: string;\r\n\r\n  constructor({ name, url }: { name: string; url: string }) {\r\n    this.name = name;\r\n    this.url = url;\r\n  }\r\n\r\n  getUrl(): string {\r\n    return this.url;\r\n  }\r\n\r\n  getName(): string {\r\n    return this.name;\r\n  }\r\n\r\n  toString(): string {\r\n    return this.url;\r\n  }\r\n}\r\n","import { Model } from \"../model\";\r\nimport { Collection } from \"../collection\";\r\nimport { CloudFile } from \"./cloudfile\";\r\nimport { EventEmitter } from \"eventemitter3\";\r\nimport NoodlRuntime from \"../runtime\";\r\n\r\ninterface ProtectedFields {\r\n  _common: string[];\r\n  _User: string[];\r\n  [key: string]: string[];\r\n}\r\n\r\nconst _protectedFields: ProtectedFields = {\r\n  _common: [\"_createdAt\", \"_updatedAt\", \"objectId\"],\r\n  _User: [\"_email_verify_token\"],\r\n};\r\n\r\ninterface CloudCollection {\r\n  name: string;\r\n  schema: {\r\n    properties?: {\r\n      [key: string]: {\r\n        type: string;\r\n        targetClass?: string;\r\n      };\r\n    };\r\n  };\r\n}\r\n\r\ninterface CloudStoreOptions {\r\n  collection: string;\r\n  objectId?: string;\r\n  where?: any;\r\n  limit?: number;\r\n  skip?: number;\r\n  include?: string[] | string;\r\n  select?: string[] | string;\r\n  sort?: string[] | string;\r\n  count?: boolean;\r\n  keys?: string[] | string;\r\n  excludeKeys?: string[] | string;\r\n  data?: any;\r\n  acl?: any;\r\n  properties?: { [key: string]: number };\r\n  key?: string;\r\n  targetObjectId?: string;\r\n  targetClass?: string;\r\n  file?: File;\r\n  success: (data?: any, count?: number) => void;\r\n  error: (error?: any) => void;\r\n  onUploadProgress?: (progress: ProgressEvent) => void;\r\n}\r\n\r\ninterface GroupOptions {\r\n  avg?: string;\r\n  sum?: string;\r\n  max?: string;\r\n  min?: string;\r\n  distinct?: string;\r\n}\r\n\r\ninterface AggregateOptions extends CloudStoreOptions {\r\n  group: { [key: string]: GroupOptions };\r\n}\r\n\r\nfunction _removeProtectedFields(data: any, className?: string): any {\r\n  const _data = Object.assign({}, data);\r\n  _protectedFields._common.forEach((f) => delete _data[f]);\r\n  if (className && _protectedFields[className])\r\n    _protectedFields[className].forEach((f) => delete _data[f]);\r\n\r\n  return _data;\r\n}\r\n\r\nexport class CloudStore {\r\n  static _instance: CloudStore;\r\n  static get instance() {\r\n    if (CloudStore._instance === undefined)\r\n      CloudStore._instance = new CloudStore();\r\n    return CloudStore._instance;\r\n  }\r\n\r\n  static _collections: { [key: string]: CloudCollection } | undefined;\r\n  static get collections() {\r\n    if (CloudStore._collections === undefined) {\r\n      CloudStore._collections = {};\r\n      const dbCollections =\r\n        NoodlRuntime.instance.getMetaData(\"dbCollections\") || [];\r\n      dbCollections.forEach((c) => {\r\n        if (CloudStore._collections) {\r\n          CloudStore._collections[c.name] = c;\r\n        }\r\n      });\r\n\r\n      const systemCollections =\r\n        NoodlRuntime.instance.getMetaData(\"systemCollections\") || [];\r\n      systemCollections.forEach((c) => {\r\n        if (CloudStore._collections) {\r\n          CloudStore._collections[c.name] = c;\r\n        }\r\n      });\r\n    }\r\n    return CloudStore._collections;\r\n  }\r\n\r\n  appId?: string;\r\n  private endpoint?: string;\r\n  private dbVersionMajor?: number;\r\n  private events: EventEmitter;\r\n  private modelScope: typeof Model;\r\n\r\n  constructor(modelScope?: typeof Model) {\r\n    this._initCloudServices();\r\n\r\n    this.events = new EventEmitter();\r\n    // this.events.setMaxListeners(10000);\r\n    this.modelScope = modelScope || Model;\r\n  }\r\n\r\n  _fromJSON(\r\n    item: Parameters<typeof CloudStore._fromJSON>[0],\r\n    collectionName: Parameters<typeof CloudStore._fromJSON>[1]\r\n  ) {\r\n    return CloudStore._fromJSON(item, collectionName, this.modelScope);\r\n  }\r\n\r\n  _deserializeJSON(\r\n    data: Parameters<typeof CloudStore._deserializeJSON>[0],\r\n    type: Parameters<typeof CloudStore._deserializeJSON>[1]\r\n  ) {\r\n    return CloudStore._deserializeJSON(data, type, this.modelScope);\r\n  }\r\n\r\n  _serializeObject(\r\n    data: Parameters<typeof CloudStore._serializeObject>[0],\r\n    collectionName: Parameters<typeof CloudStore._serializeObject>[1]\r\n  ) {\r\n    return CloudStore._serializeObject(data, collectionName, this.modelScope);\r\n  }\r\n\r\n  _initCloudServices(): void {\r\n    CloudStore._collections = undefined; // clear collection cache, so it's refetched\r\n\r\n    const cloudServices = NoodlRuntime.instance.getMetaData(\"cloudservices\");\r\n    if (cloudServices) {\r\n      this.appId = cloudServices.appId;\r\n      this.endpoint = cloudServices.endpoint;\r\n    }\r\n\r\n    const dbVersionMajor = NoodlRuntime.instance.getMetaData(\"dbVersionMajor\");\r\n    this.dbVersionMajor = dbVersionMajor;\r\n  }\r\n\r\n  on(\r\n    event: string | symbol,\r\n    fn: (...args: any[]) => void,\r\n    context?: any\r\n  ): void {\r\n    this.events.on.apply(this.events, [event, fn, context]);\r\n  }\r\n\r\n  off(\r\n    event: string | symbol,\r\n    fn?: (...args: any[]) => void,\r\n    context?: any,\r\n    once?: boolean\r\n  ): void {\r\n    this.events.off.apply(this.events, [event, fn, context, once]);\r\n  }\r\n\r\n  private _makeRequest(\r\n    path: string,\r\n    options: {\r\n      method?: string;\r\n      content?: any;\r\n      contentType?: string;\r\n      success: (response: any) => void;\r\n      error: (error: any) => void;\r\n      onUploadProgress?: (progress: ProgressEvent) => void;\r\n    }\r\n  ): void {\r\n    if (!this.appId) throw new Error(\"App ID is not set\");\r\n\r\n    // @ts-expect-error _noodl_cloud_runtime_version\r\n    if (typeof _noodl_cloud_runtime_version === \"undefined\") {\r\n      // Running in browser\r\n      const xhr = new XMLHttpRequest();\r\n\r\n      xhr.onreadystatechange = function () {\r\n        if (xhr.readyState === 4) {\r\n          let json;\r\n          try {\r\n            // In SSR, we dont have xhr.response\r\n            json = JSON.parse(xhr.response || xhr.responseText);\r\n          } catch (e) {}\r\n\r\n          if (xhr.status === 200 || xhr.status === 201) {\r\n            options.success(json);\r\n          } else\r\n            options.error(\r\n              json || { error: xhr.responseText, status: xhr.status }\r\n            );\r\n        }\r\n      };\r\n\r\n      xhr.open(options.method || \"GET\", this.endpoint + path, true);\r\n\r\n      xhr.setRequestHeader(\"X-Parse-Application-Id\", this.appId);\r\n      // @ts-expect-error\r\n      if (typeof _noodl_cloudservices !== \"undefined\") {\r\n        xhr.setRequestHeader(\r\n          \"X-Parse-Master-Key\",\r\n          // @ts-expect-error\r\n          _noodl_cloudservices.masterKey\r\n        );\r\n      }\r\n\r\n      // Check for current users\r\n      const _cu = localStorage[\"Parse/\" + this.appId + \"/currentUser\"];\r\n      if (_cu !== undefined) {\r\n        try {\r\n          const currentUser = JSON.parse(_cu);\r\n          xhr.setRequestHeader(\r\n            \"X-Parse-Session-Token\",\r\n            currentUser.sessionToken\r\n          );\r\n        } catch (e) {\r\n          // Failed to extract session token\r\n        }\r\n      }\r\n\r\n      if (options.onUploadProgress) {\r\n        xhr.upload.onprogress = (pe) => {\r\n          if (options.onUploadProgress) {\r\n            options.onUploadProgress(pe);\r\n          }\r\n        };\r\n      }\r\n\r\n      if (options.content instanceof File) {\r\n        xhr.send(options.content);\r\n      } else {\r\n        xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n        xhr.send(JSON.stringify(options.content));\r\n      }\r\n    } else {\r\n      // Running in cloud runtime\r\n      const endpoint =\r\n        // @ts-expect-error\r\n        typeof _noodl_cloudservices !== \"undefined\"\r\n          ? // @ts-expect-error\r\n            _noodl_cloudservices.endpoint\r\n          : this.endpoint;\r\n      const appId =\r\n        // @ts-expect-error\r\n        typeof _noodl_cloudservices !== \"undefined\"\r\n          ? // @ts-expect-error\r\n            _noodl_cloudservices.appId\r\n          : this.appId;\r\n      const masterKey =\r\n        // @ts-expect-error\r\n        typeof _noodl_cloudservices !== \"undefined\"\r\n          ? // @ts-expect-error\r\n            _noodl_cloudservices.masterKey\r\n          : undefined;\r\n\r\n      fetch(endpoint + path, {\r\n        method: options.method || \"GET\",\r\n        headers: {\r\n          \"X-Parse-Application-Id\": appId,\r\n          \"X-Parse-Master-Key\": masterKey,\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(options.content),\r\n      })\r\n        .then((r) => {\r\n          if (r.status === 200 || r.status === 201) {\r\n            if (options.method === \"DELETE\") {\r\n              options.success(undefined);\r\n            } else {\r\n              r.json()\r\n                .then((json) => options.success(json))\r\n                .catch((e) =>\r\n                  options.error({\r\n                    error: \"CloudStore: Failed to get json result.\",\r\n                  })\r\n                );\r\n            }\r\n          } else {\r\n            if (options.method === \"DELETE\") {\r\n              options.error({ error: \"Failed to delete.\" });\r\n            } else {\r\n              r.json()\r\n                .then((json) => options.error(json))\r\n                .catch((e) => options.error({ error: \"Failed to fetch.\" }));\r\n            }\r\n          }\r\n        })\r\n        .catch((e) => {\r\n          options.error({ error: e.message });\r\n        });\r\n    }\r\n  }\r\n\r\n  query(options: CloudStoreOptions): void {\r\n    this._makeRequest(\"/classes/\" + options.collection, {\r\n      method: \"POST\",\r\n      content: {\r\n        _method: \"GET\",\r\n        where: options.where,\r\n        limit: options.limit,\r\n        skip: options.skip,\r\n        include: Array.isArray(options.include)\r\n          ? options.include.join(\",\")\r\n          : options.include,\r\n        keys: Array.isArray(options.select)\r\n          ? options.select.join(\",\")\r\n          : options.select,\r\n        order: Array.isArray(options.sort)\r\n          ? options.sort.join(\",\")\r\n          : options.sort,\r\n        count: options.count,\r\n      },\r\n      success: function (response) {\r\n        options.success(response.results, response.count);\r\n      },\r\n      error: function () {\r\n        options.error();\r\n      },\r\n    });\r\n  }\r\n\r\n  aggregate(options: AggregateOptions): void {\r\n    const args: string[] = [];\r\n\r\n    if (!options.group) {\r\n      options.error(\"You need to provide group option.\");\r\n      return;\r\n    }\r\n\r\n    if (options.limit) args.push(\"limit=\" + options.limit);\r\n    if (options.skip) args.push(\"skip=\" + options.skip);\r\n\r\n    const grouping: { [key: string]: any } = {};\r\n\r\n    Object.keys(options.group).forEach((k) => {\r\n      const _g: { [key: string]: string } = {};\r\n      const group = options.group[k];\r\n      if (group[\"avg\"] !== undefined) _g[\"$avg\"] = \"$\" + group[\"avg\"];\r\n      else if (group[\"sum\"] !== undefined) _g[\"$sum\"] = \"$\" + group[\"sum\"];\r\n      else if (group[\"max\"] !== undefined) _g[\"$max\"] = \"$\" + group[\"max\"];\r\n      else if (group[\"min\"] !== undefined) _g[\"$min\"] = \"$\" + group[\"min\"];\r\n      else if (group[\"distinct\"] !== undefined)\r\n        _g[\"$addToSet\"] = \"$\" + group[\"distinct\"];\r\n\r\n      grouping[k] = _g;\r\n    });\r\n\r\n    // I don't know which version the API was changed, lets just say above 4 for now.\r\n    if (this.dbVersionMajor && this.dbVersionMajor > 4) {\r\n      grouping._id = null;\r\n\r\n      if (options.where)\r\n        args.push(\r\n          \"$match=\" + encodeURIComponent(JSON.stringify(options.where))\r\n        );\r\n\r\n      args.push(\"$group=\" + JSON.stringify(grouping));\r\n    } else {\r\n      grouping.objectId = null;\r\n\r\n      if (options.where)\r\n        args.push(\"match=\" + encodeURIComponent(JSON.stringify(options.where)));\r\n\r\n      args.push(\"group=\" + JSON.stringify(grouping));\r\n    }\r\n\r\n    this._makeRequest(\r\n      \"/aggregate/\" +\r\n        options.collection +\r\n        (args.length > 0 ? \"?\" + args.join(\"&\") : \"\"),\r\n      {\r\n        success: function (response) {\r\n          const res: { [key: string]: any } = {};\r\n\r\n          if (!response.results || response.results.length !== 1) {\r\n            options.success({}); // No result\r\n            return;\r\n          }\r\n\r\n          Object.keys(options.group).forEach((k) => {\r\n            res[k] = response.results[0][k];\r\n          });\r\n\r\n          options.success(res);\r\n        },\r\n        error: function () {\r\n          options.error();\r\n        },\r\n      }\r\n    );\r\n  }\r\n\r\n  count(options: CloudStoreOptions): void {\r\n    const args: string[] = [];\r\n\r\n    if (options.where)\r\n      args.push(\"where=\" + encodeURIComponent(JSON.stringify(options.where)));\r\n    args.push(\"limit=0\");\r\n    args.push(\"count=1\");\r\n\r\n    this._makeRequest(\r\n      \"/classes/\" +\r\n        options.collection +\r\n        (args.length > 0 ? \"?\" + args.join(\"&\") : \"\"),\r\n      {\r\n        success: function (response) {\r\n          options.success(response.count);\r\n        },\r\n        error: function () {\r\n          options.error();\r\n        },\r\n      }\r\n    );\r\n  }\r\n\r\n  distinct(options: CloudStoreOptions & { property: string }): void {\r\n    const args: string[] = [];\r\n\r\n    if (options.where)\r\n      args.push(\"where=\" + encodeURIComponent(JSON.stringify(options.where)));\r\n    args.push(\"distinct=\" + options.property);\r\n\r\n    this._makeRequest(\r\n      \"/aggregate/\" +\r\n        options.collection +\r\n        (args.length > 0 ? \"?\" + args.join(\"&\") : \"\"),\r\n      {\r\n        success: function (response) {\r\n          options.success(response.results);\r\n        },\r\n        error: function () {\r\n          options.error();\r\n        },\r\n      }\r\n    );\r\n  }\r\n\r\n  fetch(options: CloudStoreOptions): void {\r\n    const args: string[] = [];\r\n\r\n    if (options.include) {\r\n      args.push(\r\n        \"include=\" +\r\n          (Array.isArray(options.include)\r\n            ? options.include.join(\",\")\r\n            : options.include)\r\n      );\r\n    }\r\n\r\n    if (options.keys) {\r\n      args.push(\r\n        \"keys=\" +\r\n          (Array.isArray(options.keys) ? options.keys.join(\",\") : options.keys)\r\n      );\r\n    }\r\n\r\n    if (options.excludeKeys) {\r\n      args.push(\r\n        \"excludeKeys=\" +\r\n          (Array.isArray(options.excludeKeys)\r\n            ? options.excludeKeys.join(\",\")\r\n            : options.excludeKeys)\r\n      );\r\n    }\r\n\r\n    this._makeRequest(\r\n      \"/classes/\" +\r\n        options.collection +\r\n        \"/\" +\r\n        options.objectId +\r\n        (args.length > 0 ? \"?\" + args.join(\"&\") : \"\"),\r\n      {\r\n        method: \"GET\",\r\n        success: (response) => {\r\n          options.success(response);\r\n          this.events.emit(\"fetch\", {\r\n            type: \"fetch\",\r\n            objectId: options.objectId,\r\n            object: response,\r\n            collection: options.collection,\r\n          });\r\n        },\r\n        error: function (res) {\r\n          options.error(res.error);\r\n        },\r\n      }\r\n    );\r\n  }\r\n\r\n  create(options: CloudStoreOptions): void {\r\n    this._makeRequest(\"/classes/\" + options.collection, {\r\n      method: \"POST\",\r\n      content: Object.assign(\r\n        _removeProtectedFields(\r\n          CloudStore._serializeObject(options.data, options.collection),\r\n          options.collection\r\n        ),\r\n        { ACL: options.acl }\r\n      ),\r\n      success: (response) => {\r\n        const _obj = Object.assign({}, options.data, response);\r\n        options.success(_obj);\r\n        this.events.emit(\"create\", {\r\n          type: \"create\",\r\n          objectId: options.objectId,\r\n          object: _obj,\r\n          collection: options.collection,\r\n        });\r\n      },\r\n      error: function (res) {\r\n        options.error(res.error);\r\n      },\r\n    });\r\n  }\r\n\r\n  increment(options: CloudStoreOptions): void {\r\n    const data: { [key: string]: { __op: string; amount: number } } = {};\r\n\r\n    for (let key in options.properties) {\r\n      data[key] = { __op: \"Increment\", amount: options.properties[key] };\r\n    }\r\n\r\n    this._makeRequest(\r\n      \"/classes/\" + options.collection + \"/\" + options.objectId,\r\n      {\r\n        method: \"PUT\",\r\n        content: data,\r\n        success: (response) => {\r\n          options.success(response);\r\n        },\r\n        error: function (res) {\r\n          options.error(res.error);\r\n        },\r\n      }\r\n    );\r\n  }\r\n\r\n  save(options: CloudStoreOptions): void {\r\n    const _data = Object.assign({}, options.data);\r\n    delete _data.createdAt;\r\n    delete _data.updatedAt;\r\n\r\n    this._makeRequest(\r\n      \"/classes/\" + options.collection + \"/\" + options.objectId,\r\n      {\r\n        method: \"PUT\",\r\n        content: Object.assign(\r\n          _removeProtectedFields(\r\n            CloudStore._serializeObject(_data, options.collection),\r\n            options.collection\r\n          ),\r\n          {\r\n            ACL: options.acl,\r\n          }\r\n        ),\r\n        success: (response) => {\r\n          options.success(response);\r\n          this.events.emit(\"save\", {\r\n            type: \"save\",\r\n            objectId: options.objectId,\r\n            object: Object.assign({}, options.data, response),\r\n            collection: options.collection,\r\n          });\r\n        },\r\n        error: function (res) {\r\n          options.error(res.error);\r\n        },\r\n      }\r\n    );\r\n  }\r\n\r\n  delete(options: CloudStoreOptions): void {\r\n    this._makeRequest(\r\n      \"/classes/\" + options.collection + \"/\" + options.objectId,\r\n      {\r\n        method: \"DELETE\",\r\n        success: () => {\r\n          options.success();\r\n          this.events.emit(\"delete\", {\r\n            type: \"delete\",\r\n            objectId: options.objectId,\r\n            collection: options.collection,\r\n          });\r\n        },\r\n        error: function (res) {\r\n          options.error(res.error);\r\n        },\r\n      }\r\n    );\r\n  }\r\n\r\n  addRelation(options: CloudStoreOptions): void {\r\n    if (!options.key) throw new Error(\"Key is required\");\r\n\r\n    const _content: { [key: string]: any } = {};\r\n    _content[options.key] = {\r\n      __op: \"AddRelation\",\r\n      objects: [\r\n        {\r\n          __type: \"Pointer\",\r\n          objectId: options.targetObjectId,\r\n          className: options.targetClass,\r\n        },\r\n      ],\r\n    };\r\n    this._makeRequest(\r\n      \"/classes/\" + options.collection + \"/\" + options.objectId,\r\n      {\r\n        method: \"PUT\",\r\n        content: _content,\r\n        success: function (response) {\r\n          options.success(response);\r\n        },\r\n        error: function (res) {\r\n          options.error(res.error);\r\n        },\r\n      }\r\n    );\r\n  }\r\n\r\n  removeRelation(options: CloudStoreOptions): void {\r\n    if (!options.key) throw new Error(\"Key is required\");\r\n\r\n    const _content: { [key: string]: any } = {};\r\n    _content[options.key] = {\r\n      __op: \"RemoveRelation\",\r\n      objects: [\r\n        {\r\n          __type: \"Pointer\",\r\n          objectId: options.targetObjectId,\r\n          className: options.targetClass,\r\n        },\r\n      ],\r\n    };\r\n    this._makeRequest(\r\n      \"/classes/\" + options.collection + \"/\" + options.objectId,\r\n      {\r\n        method: \"PUT\",\r\n        content: _content,\r\n        success: function (response) {\r\n          options.success(response);\r\n        },\r\n        error: function (res) {\r\n          options.error(res.error);\r\n        },\r\n      }\r\n    );\r\n  }\r\n\r\n  uploadFile(options: CloudStoreOptions): void {\r\n    if (!options.file) throw new Error(\"File is required\");\r\n\r\n    this._makeRequest(\"/files/\" + options.file.name, {\r\n      method: \"POST\",\r\n      content: options.file,\r\n      contentType: options.file.type,\r\n      success: (response) =>\r\n        options.success(Object.assign({}, options.data, response)),\r\n      error: (err) => options.error(err),\r\n      onUploadProgress: options.onUploadProgress,\r\n    });\r\n  }\r\n\r\n  deleteFile(options: CloudStoreOptions): void {\r\n    if (!options.file) throw new Error(\"File is required\");\r\n    this._makeRequest(\"/files/\" + options.file.name, {\r\n      method: \"DELETE\",\r\n      success: (response) =>\r\n        options.success(Object.assign({}, options.data, response)),\r\n      error: (err) => options.error(err),\r\n    });\r\n  }\r\n\r\n  // TODO: What is modelScope?\r\n  static forScope(modelScope?: typeof Model): CloudStore {\r\n    if (modelScope === undefined) return CloudStore.instance;\r\n    // @ts-expect-error\r\n    if (modelScope._cloudStore) return modelScope._cloudStore;\r\n\r\n    // @ts-expect-error\r\n    modelScope._cloudStore = new CloudStore(modelScope);\r\n    // @ts-expect-error\r\n    return modelScope._cloudStore;\r\n  }\r\n\r\n  static invalidateCollections(): void {\r\n    // @ts-expect-error\r\n    _collections = undefined;\r\n  }\r\n\r\n  static _fromJSON(\r\n    item: any,\r\n    collectionName: string,\r\n    modelScope?: typeof Model\r\n  ): any {\r\n    const modelStore = modelScope || Model;\r\n\r\n    const model = modelStore.get(item.objectId);\r\n    model._class = collectionName;\r\n\r\n    let schema;\r\n    if (\r\n      collectionName !== undefined &&\r\n      // @ts-expect-error\r\n      CloudStore._collections[collectionName] !== undefined\r\n    ) {\r\n      // @ts-expect-error\r\n      schema = CloudStore._collections[collectionName].schema;\r\n    }\r\n\r\n    for (const key in item) {\r\n      if (key === \"objectId\" || key === \"ACL\") {\r\n        continue;\r\n      }\r\n\r\n      const _type =\r\n        schema && schema.properties && schema.properties[key]\r\n          ? schema.properties[key].type\r\n          : undefined;\r\n      model.set(key, CloudStore._deserializeJSON(item[key], _type, modelScope));\r\n    }\r\n\r\n    return model;\r\n  }\r\n\r\n  static _serializeObject(\r\n    data: any,\r\n    collectionName: string,\r\n    modelScope?: typeof Model\r\n  ): any {\r\n    let schema;\r\n    // @ts-expect-error\r\n    if (CloudStore._collections[collectionName])\r\n      // @ts-expect-error\r\n      schema = CloudStore._collections[collectionName].schema;\r\n\r\n    for (const key in data) {\r\n      const _type =\r\n        schema && schema.properties && schema.properties[key]\r\n          ? schema.properties[key].type\r\n          : undefined;\r\n\r\n      if (data[key] === undefined || data[key] === null) {\r\n        // Keep null and undefined as is\r\n      } else if (_type === \"Pointer\" && typeof data[key] === \"string\") {\r\n        // This is a string pointer to an object\r\n        data[key] = {\r\n          __type: \"Pointer\",\r\n          className: schema.properties[key].targetClass,\r\n          objectId: data[key],\r\n        };\r\n      } else if (\r\n        _type === \"Pointer\" &&\r\n        typeof data[key] === \"object\" &&\r\n        (modelScope || Model).instanceOf(data[key])\r\n      ) {\r\n        // This is an embedded object that should be stored as pointer\r\n        data[key] = {\r\n          __type: \"Pointer\",\r\n          className: schema.properties[key].targetClass,\r\n          objectId: data[key].getId(),\r\n        };\r\n      } else if (\r\n        _type === \"Date\" &&\r\n        (typeof data[key] === \"string\" || data[key] instanceof Date)\r\n      ) {\r\n        data[key] = {\r\n          __type: \"Date\",\r\n          iso: data[key] instanceof Date ? data[key].toISOString() : data[key],\r\n        };\r\n      } else if (_type === \"File\" && data[key] instanceof CloudFile) {\r\n        const cloudFile = data[key];\r\n        data[key] = {\r\n          __type: \"File\",\r\n          url: cloudFile.getUrl(),\r\n          name: cloudFile.getName(),\r\n        };\r\n      } else if (\r\n        _type === \"Array\" &&\r\n        typeof data[key] === \"string\" &&\r\n        Collection.exists(data[key])\r\n      ) {\r\n        data[key] = _toJSON(Collection.get(data[key]));\r\n      } else if (\r\n        _type === \"Object\" &&\r\n        typeof data[key] === \"string\" &&\r\n        (modelScope || Model).exists(data[key])\r\n      ) {\r\n        data[key] = _toJSON((modelScope || Model).get(data[key]));\r\n      } else if (_type === \"GeoPoint\" && typeof data[key] === \"object\") {\r\n        data[key] = {\r\n          __type: \"GeoPoint\",\r\n          latitude: Number(data[key].latitude),\r\n          longitude: Number(data[key].longitude),\r\n        };\r\n      } else data[key] = _toJSON(data[key]);\r\n    }\r\n\r\n    return data;\r\n  }\r\n\r\n  static _deserializeJSON(\r\n    data: any,\r\n    type?: string,\r\n    modelScope?: typeof Model\r\n  ): any {\r\n    if (data === undefined) return;\r\n    if (data === null) return null;\r\n\r\n    if (type === \"Relation\" && data.__type === \"Relation\") {\r\n      return undefined; // Ignore relation fields\r\n    } else if (type === \"Pointer\" && data.__type === \"Pointer\") {\r\n      // This is a pointer type, resolve into id\r\n      return data.objectId;\r\n    } else if (type === \"Date\" && data.__type === \"Date\") {\r\n      return new Date(data.iso);\r\n    } else if (type === \"Date\" && typeof data === \"string\") {\r\n      return new Date(data);\r\n    } else if (type === \"File\" && data.__type === \"File\") {\r\n      return new CloudFile(data);\r\n    } else if (type === \"GeoPoint\" && data.__type === \"GeoPoint\") {\r\n      return {\r\n        latitude: data.latitude,\r\n        longitude: data.longitude,\r\n      };\r\n    } else if (_isArrayOfObjects(data)) {\r\n      const a: any[] = [];\r\n      for (let i = 0; i < data.length; i++) {\r\n        a.push(CloudStore._deserializeJSON(data[i], undefined, modelScope));\r\n      }\r\n      const c = Collection.get();\r\n      c.set(a);\r\n      return c;\r\n    } else if (Array.isArray(data)) return data;\r\n    // This is an array with mixed data, just return it\r\n    else if (\r\n      data &&\r\n      data.__type === \"Object\" &&\r\n      data.className !== undefined &&\r\n      data.objectId !== undefined\r\n    ) {\r\n      const _data = Object.assign({}, data);\r\n      delete _data.className;\r\n      delete _data.__type;\r\n      return CloudStore._fromJSON(_data, data.className, modelScope);\r\n    } else if (typeof data === \"object\" && data !== null) {\r\n      const m = (modelScope || Model).get();\r\n      for (const key in data) {\r\n        m.set(\r\n          key,\r\n          CloudStore._deserializeJSON(data[key], undefined, modelScope)\r\n        );\r\n      }\r\n      return m;\r\n    } else return data;\r\n  }\r\n}\r\n\r\nfunction _isArrayOfObjects(a: any[]): boolean {\r\n  if (!Array.isArray(a)) return false;\r\n  for (let i = 0; i < a.length; i++)\r\n    if (typeof a[i] !== \"object\" || a[i] === null) return false;\r\n\r\n  return true;\r\n}\r\n\r\nfunction _toJSON(obj: any): any {\r\n  if (obj instanceof Model) {\r\n    const res: { [key: string]: any } = {};\r\n    for (const key in obj.data) {\r\n      res[key] = _toJSON(obj.data[key]);\r\n    }\r\n    return res;\r\n  } else if (obj instanceof Collection) {\r\n    const res: any[] = [];\r\n    obj.items.forEach((m) => {\r\n      res.push(_toJSON(m));\r\n    });\r\n    return res;\r\n  }\r\n  return obj;\r\n}\r\n","import { Model } from \"./model\";\r\n\r\ninterface ListenerMap {\r\n  [key: string]: ((args: any) => Promise<void>)[];\r\n}\r\n\r\ndeclare global {\r\n  interface Array<T> {\r\n    items: T[];\r\n    each: typeof Array.prototype.forEach;\r\n    size(): number;\r\n    get(index: number): T;\r\n    getId(): string;\r\n    id: string;\r\n    set(src: T[]): void;\r\n    notify(event: string, args: any): Promise<void>;\r\n    contains(item: T): boolean;\r\n    add(item: T): Promise<void>;\r\n    remove(item: T): void;\r\n    addAtIndex(item: T, index: number): Promise<void>;\r\n    removeAtIndex(idx: number): Promise<void>;\r\n    on(event: string, listener: (args: any) => Promise<void>): void;\r\n    off(event: string, listener: (args: any) => Promise<void>): void;\r\n    _id?: string;\r\n    _listeners?: ListenerMap;\r\n  }\r\n}\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"items\")) {\r\n  Object.defineProperty(Array.prototype, \"items\", {\r\n    enumerable: false,\r\n    get() {\r\n      return this;\r\n    },\r\n    set(data: any[]) {\r\n      this.set(data);\r\n    },\r\n  });\r\n}\r\n\r\nObject.defineProperty(Array.prototype, \"each\", {\r\n  enumerable: false,\r\n  writable: false,\r\n  value: Array.prototype.forEach,\r\n});\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"size\")) {\r\n  Object.defineProperty(Array.prototype, \"size\", {\r\n    enumerable: false,\r\n    writable: false,\r\n    value: function (): number {\r\n      return this.length;\r\n    },\r\n  });\r\n}\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"get\")) {\r\n  Object.defineProperty(Array.prototype, \"get\", {\r\n    enumerable: false,\r\n    writable: false,\r\n    value: function <T>(index: number): T {\r\n      return this[index];\r\n    },\r\n  });\r\n}\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"getId\")) {\r\n  Object.defineProperty(Array.prototype, \"getId\", {\r\n    enumerable: false,\r\n    writable: false,\r\n    value: function (): string {\r\n      return this._id as string;\r\n    },\r\n  });\r\n}\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"id\")) {\r\n  Object.defineProperty(Array.prototype, \"id\", {\r\n    enumerable: false,\r\n    get() {\r\n      return this.getId();\r\n    },\r\n  });\r\n}\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"set\")) {\r\n  Object.defineProperty(Array.prototype, \"set\", {\r\n    enumerable: false,\r\n    writable: false,\r\n    value: function <T extends Model>(src: T[]): void {\r\n      let length: number, i: number;\r\n\r\n      if (src === this) return;\r\n\r\n      src = src || []; //handle if src is undefined\r\n\r\n      function keyIndex(a: T[]): Record<string, T> {\r\n        const keys: Record<string, T> = {};\r\n        const length = a.length;\r\n        for (let i = 0; i < length; i++) {\r\n          const item = a[i];\r\n          keys[item.getId()] = item;\r\n        }\r\n        return keys;\r\n      }\r\n\r\n      // Src can be a collection, or an array\r\n      const bItems: T[] = [];\r\n      length = src.length;\r\n      for (i = 0; i < length; i++) {\r\n        const item = src[i];\r\n        if (Model.instanceOf(item)) bItems.push(item);\r\n        // @ts-expect-error TODO: What is this?\r\n        else bItems.push(Model.create(item));\r\n      }\r\n\r\n      const aItems = this.items;\r\n      const aKeys = keyIndex(aItems);\r\n      const bKeys = keyIndex(bItems);\r\n\r\n      // First remove all items not in the new collection\r\n      length = aItems.length;\r\n      for (i = 0; i < length; i++) {\r\n        if (!bKeys.hasOwnProperty(aItems[i].getId())) {\r\n          // This item is not present in new collection, remove it\r\n          this.removeAtIndex(i);\r\n          i--;\r\n          length--;\r\n        }\r\n      }\r\n\r\n      // Reorder items\r\n      for (i = 0; i < Math.min(aItems.length, bItems.length); i++) {\r\n        if (aItems[i] !== bItems[i]) {\r\n          if (aKeys.hasOwnProperty(bItems[i].getId())) {\r\n            // The bItem exist in the collection but is in the wrong place\r\n            this.remove(bItems[i]);\r\n          }\r\n\r\n          // This is a new item, add it at correct index\r\n          this.addAtIndex(bItems[i], i);\r\n        }\r\n      }\r\n\r\n      // Add remaining items\r\n      for (i = aItems.length; i < bItems.length; i++) {\r\n        this.add(bItems[i]);\r\n      }\r\n    },\r\n  });\r\n}\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"notify\")) {\r\n  Object.defineProperty(Array.prototype, \"notify\", {\r\n    enumerable: false,\r\n    writable: false,\r\n    value: async function (event: string, args: any): Promise<void> {\r\n      if (!this._listeners) return;\r\n      if (!this._listeners[event]) return;\r\n\r\n      const l = this._listeners[event].slice(); //clone in case listeners array is modified in the callbacks\r\n      for (let i = 0; i < l.length; i++) {\r\n        await l[i](args);\r\n      }\r\n    },\r\n  });\r\n}\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"contains\")) {\r\n  Object.defineProperty(Array.prototype, \"contains\", {\r\n    enumerable: false,\r\n    writable: false,\r\n    value: function <T>(item: T): boolean {\r\n      return this.indexOf(item) !== -1;\r\n    },\r\n  });\r\n}\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"add\")) {\r\n  Object.defineProperty(Array.prototype, \"add\", {\r\n    enumerable: false,\r\n    writable: false,\r\n    value: async function <T extends Model>(item: T): Promise<void> {\r\n      if (this.contains(item)) return; // Already contains item\r\n\r\n      this.items.push(item);\r\n      await this.notify(\"add\", { item: item, index: this.items.length - 1 });\r\n      await this.notify(\"change\");\r\n      item.notify(\"add\", { collection: this });\r\n    },\r\n  });\r\n}\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"remove\")) {\r\n  Object.defineProperty(Array.prototype, \"remove\", {\r\n    enumerable: false,\r\n    writable: false,\r\n    value: function <T>(item: T): void {\r\n      const idx = this.items.indexOf(item);\r\n      if (idx !== -1) this.removeAtIndex(idx);\r\n    },\r\n  });\r\n}\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"addAtIndex\")) {\r\n  Object.defineProperty(Array.prototype, \"addAtIndex\", {\r\n    enumerable: false,\r\n    writable: false,\r\n    value: async function <T extends Model>(\r\n      item: T,\r\n      index: number\r\n    ): Promise<void> {\r\n      if (this.contains(item)) return; // Already contains item\r\n\r\n      this.items.splice(index, 0, item);\r\n      await this.notify(\"add\", { item: item, index: index });\r\n      await this.notify(\"change\");\r\n      item.notify(\"add\", { collection: this, index: index });\r\n    },\r\n  });\r\n}\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"removeAtIndex\")) {\r\n  Object.defineProperty(Array.prototype, \"removeAtIndex\", {\r\n    enumerable: false,\r\n    writable: false,\r\n    value: async function (idx: number): Promise<void> {\r\n      const item = this.items[idx];\r\n      this.items.splice(idx, 1);\r\n      await this.notify(\"remove\", { item: item, index: idx });\r\n      await this.notify(\"change\");\r\n      await item.notify(\"remove\", { collection: this });\r\n    },\r\n  });\r\n}\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"on\")) {\r\n  Object.defineProperty(Array.prototype, \"on\", {\r\n    enumerable: false,\r\n    writable: false,\r\n    value: function (\r\n      event: string,\r\n      listener: (args: any) => Promise<void>\r\n    ): void {\r\n      if (!this._listeners)\r\n        Object.defineProperty(this, \"_listeners\", {\r\n          enumerable: false,\r\n          writable: false,\r\n          value: {},\r\n        });\r\n      if (!this._listeners[event]) this._listeners[event] = [];\r\n      this._listeners[event].push(listener);\r\n    },\r\n  });\r\n}\r\n\r\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"off\")) {\r\n  Object.defineProperty(Array.prototype, \"off\", {\r\n    enumerable: false,\r\n    writable: false,\r\n    value: function (\r\n      event: string,\r\n      listener: (args: any) => Promise<void>\r\n    ): void {\r\n      if (!this._listeners) return;\r\n      if (!this._listeners[event]) return;\r\n      const idx = this._listeners[event].indexOf(listener);\r\n      if (idx !== -1) this._listeners[event].splice(idx, 1);\r\n    },\r\n  });\r\n}\r\n\r\nexport class Collection<T extends Model> extends Array<T> {\r\n  static _collections: Record<string, Collection<any>> = {};\r\n\r\n  static create<T extends Model>(items?: T[]): Collection<T> {\r\n    const name = Model.guid();\r\n    Collection._collections[name] = new Collection<T>();\r\n    Object.defineProperty(Collection._collections[name], \"_id\", {\r\n      enumerable: false,\r\n      writable: false,\r\n      value: name,\r\n    });\r\n    if (items) {\r\n      Collection._collections[name].set(items);\r\n    }\r\n    return Collection._collections[name];\r\n  }\r\n\r\n  static get<T extends Model>(name?: string): Collection<T> {\r\n    if (name === undefined) name = Model.guid();\r\n    if (!Collection._collections[name]) {\r\n      Collection._collections[name] = new Collection<T>();\r\n      Object.defineProperty(Collection._collections[name], \"_id\", {\r\n        enumerable: false,\r\n        writable: false,\r\n        value: name,\r\n      });\r\n    }\r\n\r\n    return Collection._collections[name];\r\n  }\r\n\r\n  static instanceOf(collection: any): boolean {\r\n    return collection instanceof Collection;\r\n  }\r\n\r\n  static exists(name: string): boolean {\r\n    return Collection._collections[name] !== undefined;\r\n  }\r\n}\r\n","interface SetterArgs {\r\n  valueChangedToTrue: () => void;\r\n}\r\n\r\nexport function createSetter(args: SetterArgs): (value: any) => void {\r\n  let currentValue: boolean = false;\r\n\r\n  return function (value: any): void {\r\n    value = value ? true : false;\r\n    // value changed from false to true\r\n    if (value && currentValue === false) {\r\n      // @ts-expect-error\r\n      args.valueChangedToTrue.call(this);\r\n    }\r\n    currentValue = value;\r\n  };\r\n}\r\n","import { randomString } from \"./utils\";\r\n\r\ninterface ModelData {\r\n  id?: string;\r\n  [key: string]: any;\r\n}\r\n\r\ninterface ModelSetArgs {\r\n  resolve?: boolean;\r\n  forceChange?: boolean;\r\n  silent?: boolean;\r\n}\r\n\r\ninterface ModelGetArgs {\r\n  resolve?: boolean;\r\n}\r\n\r\nexport class Model {\r\n  private id: string;\r\n  _class?: string;\r\n  data: ModelData;\r\n  private listeners?: Record<string, Function[]>;\r\n  private static _models: Record<string, Model> = {};\r\n\r\n  constructor(id: string, data: ModelData) {\r\n    this.id = id;\r\n    this.data = data;\r\n  }\r\n\r\n  private static models = Model._models;\r\n  private static proxies: Record<string, any> = {};\r\n\r\n  static _modelProxyHandler = {\r\n    get: function (target: Model, prop: string | symbol, receiver: any) {\r\n      if (typeof target[prop as keyof Model] === \"function\")\r\n        // @ts-expect-error\r\n        return target[prop as keyof Model].bind(target);\r\n      else if (prop in target) return Reflect.get(target, prop, receiver);\r\n      else return target.get(prop.toString());\r\n    },\r\n    set: function (obj: Model, prop: string | symbol, value: any) {\r\n      if (prop === \"_class\") {\r\n        (obj as any)._class = value;\r\n      } else if (prop === \"id\") {\r\n        console.log(\r\n          `Noodl.Object warning: id is readonly (Id is ${obj.id}, trying to set to ${value})`\r\n        );\r\n        return true;\r\n      } else {\r\n        obj.set(prop.toString(), value);\r\n      }\r\n      return true;\r\n    },\r\n    ownKeys(target: Model) {\r\n      return Reflect.ownKeys(target.data);\r\n    },\r\n    getOwnPropertyDescriptor(target: Model, prop: string | symbol) {\r\n      return Object.getOwnPropertyDescriptor(target.data, prop.toString());\r\n    },\r\n  };\r\n\r\n  static get(id?: string): Model {\r\n    if (id === undefined) id = Model.guid();\r\n    if (!Model.models[id]) {\r\n      Model.models[id] = new Model(id, {});\r\n      Model.proxies[id] = new Proxy(Model.models[id], Model._modelProxyHandler);\r\n    }\r\n    return Model.proxies[id];\r\n  }\r\n\r\n  static create(data?: ModelData): Model {\r\n    const modelData = data ? data : {};\r\n    const m = Model.get(modelData.id);\r\n    for (const key in modelData) {\r\n      if (key === \"id\") continue;\r\n      m.set(key, modelData[key]);\r\n    }\r\n    return m;\r\n  }\r\n\r\n  static exists(id: string): boolean {\r\n    return Model.models[id] !== undefined;\r\n  }\r\n\r\n  static instanceOf(collection: any): boolean {\r\n    return collection instanceof Model || collection.target instanceof Model;\r\n  }\r\n\r\n  static guid(): string {\r\n    return randomString(10);\r\n  }\r\n\r\n  on(event: string, listener: Function): void {\r\n    if (!this.listeners) this.listeners = {};\r\n    if (!this.listeners[event]) this.listeners[event] = [];\r\n    this.listeners[event].push(listener);\r\n  }\r\n\r\n  off(event: string, listener: Function): void {\r\n    if (!this.listeners) return;\r\n    if (!this.listeners[event]) return;\r\n    const idx = this.listeners[event].indexOf(listener);\r\n    if (idx !== -1) this.listeners[event].splice(idx, 1);\r\n  }\r\n\r\n  notify(event: string, args: any): void {\r\n    if (!this.listeners) return;\r\n    if (!this.listeners[event]) return;\r\n\r\n    const l = this.listeners[event].slice();\r\n    for (let i = 0; i < l.length; i++) {\r\n      l[i](args);\r\n    }\r\n  }\r\n\r\n  setAll(obj: ModelData): void {\r\n    for (const i in obj) {\r\n      if (i === \"id\") continue;\r\n      if (this.data[i] !== obj[i]) {\r\n        const old = this.data[i];\r\n        this.data[i] = obj[i];\r\n        this.notify(\"change\", { name: i, value: obj[i], old });\r\n      }\r\n    }\r\n  }\r\n\r\n  fill(value: any = null): void {\r\n    for (const key in this.data) {\r\n      if (key === \"id\") continue;\r\n      const temp = this.data[key];\r\n      this.data[key] = value;\r\n      this.notify(\"change\", { name: key, value: this.data[key], old: temp });\r\n    }\r\n  }\r\n\r\n  set(name: string, value: any, args?: ModelSetArgs): void {\r\n    if (args?.resolve && name.indexOf(\".\") !== -1) {\r\n      const path = name.split(\".\");\r\n      let model: Model = this;\r\n      for (let i = 0; i < path.length - 1; i++) {\r\n        const v = model.get(path[i]);\r\n        if (Model.instanceOf(v)) model = v;\r\n        else return;\r\n      }\r\n      model.set(path[path.length - 1], value);\r\n      return;\r\n    }\r\n\r\n    const forceChange = args?.forceChange;\r\n    const oldValue = this.data[name];\r\n    this.data[name] = value;\r\n\r\n    if ((forceChange || oldValue !== value) && !args?.silent) {\r\n      this.notify(\"change\", { name, value, old: oldValue });\r\n    }\r\n  }\r\n\r\n  getId(): string {\r\n    return this.id;\r\n  }\r\n\r\n  get(name: string, args?: ModelGetArgs): any {\r\n    if (args?.resolve && name.indexOf(\".\") !== -1) {\r\n      const path = name.split(\".\");\r\n      let model: Model = this;\r\n      for (let i = 0; i < path.length - 1; i++) {\r\n        const v = model.get(path[i]);\r\n        if (Model.instanceOf(v)) model = v;\r\n        else return;\r\n      }\r\n      return model.get(path[path.length - 1]);\r\n    }\r\n\r\n    return this.data[name];\r\n  }\r\n\r\n  toJSON(): ModelData {\r\n    return Object.assign({}, this.data, { id: this.id });\r\n  }\r\n}\r\n\r\nexport class ModelScope {\r\n  private models: Record<string, Model> = {};\r\n  private proxies: Record<string, any> = {};\r\n  private _cloudStore?: any;\r\n\r\n  get(id?: string): Model {\r\n    if (id === undefined) id = Model.guid();\r\n    if (!this.models[id]) {\r\n      this.models[id] = new Model(id, {});\r\n      this.proxies[id] = new Proxy(this.models[id], Model._modelProxyHandler);\r\n    }\r\n    return this.proxies[id];\r\n  }\r\n\r\n  create(data?: ModelData): Model {\r\n    const modelData = data ? data : {};\r\n    const m = this.get(modelData.id);\r\n    for (const key in modelData) {\r\n      if (key === \"id\") continue;\r\n      m.set(key, modelData[key]);\r\n    }\r\n    return m;\r\n  }\r\n\r\n  exists(id: string): boolean {\r\n    return this.models[id] !== undefined;\r\n  }\r\n\r\n  instanceOf(collection: any): boolean {\r\n    return collection instanceof Model || collection.target instanceof Model;\r\n  }\r\n\r\n  guid(): string {\r\n    return randomString(10);\r\n  }\r\n\r\n  reset(): void {\r\n    this.models = {};\r\n    this.proxies = {};\r\n    delete this._cloudStore;\r\n  }\r\n}\r\n","import type { NodeModel } from \"./models/nodemodel\";\r\nimport type { NodeContext } from \"./nodecontext\";\r\nimport { NodeDefinition } from \"./nodedefinition\";\r\nimport type { NodeScope } from \"./nodescope\";\r\nimport { OutputProperty } from \"./outputproperty\";\r\nimport { Variant } from \"./variants\";\r\n\r\ninterface Input<TSelf extends Node<any>> {\r\n  type?:\r\n    | {\r\n        units?: string[];\r\n        defaultUnit?: string;\r\n        name?: string;\r\n      }\r\n    | string;\r\n  default?: any;\r\n  set: (this: TSelf, value: any) => void;\r\n  value?: any;\r\n}\r\n\r\ninterface Output<TSelf extends Node<any>> {\r\n  get?: (this: TSelf) => any;\r\n  getter?: (this: TSelf) => any;\r\n  onFirstConnectionAdded?: (this: TSelf) => void;\r\n  onLastConnectionRemoved?: (this: TSelf) => void;\r\n}\r\n\r\nexport class Node<TInternal extends Record<string, any> = any> {\r\n  id: string;\r\n  context: NodeContext;\r\n  name?: string;\r\n  nodeScope?: NodeScope;\r\n  variant?: Variant | string;\r\n  model?: NodeModel;\r\n  updateOnDirtyFlagging: boolean = true;\r\n  children: Node[] = [];\r\n  nodeScopeDidInitialize?: () => void;\r\n\r\n  // This is used by the node definitions to store internal state.\r\n  // Something that should get cleaned up in the future.\r\n  public _internal = {} as TInternal;\r\n\r\n  private _dirty: boolean = false;\r\n  _inputs: Record<string, Input<this>> = {};\r\n  _inputValues: Record<string, any> = {};\r\n  private _outputs: Record<string, OutputProperty> = {};\r\n  private _inputConnections: Record<string, OutputProperty[]> = {};\r\n  private _outputList: OutputProperty[] = [];\r\n  private _isUpdating: boolean = false;\r\n  private _inputValuesQueue: Record<string, any[]> = {};\r\n  private _afterInputsHaveUpdatedCallbacks: ((\r\n    this: Node<TInternal>\r\n  ) => void)[] = [];\r\n  private _signalsSentThisUpdate: Record<string, boolean> = {};\r\n  _deleted: boolean = false;\r\n  private _deleteListeners: Function[] = [];\r\n  private _isFirstUpdate: boolean = true;\r\n  private _valuesFromConnections: Record<string, any> = {};\r\n  private _updatedAtIteration?: number;\r\n  private _updateIteration: number = 0;\r\n  private _cyclicLoop?: boolean;\r\n  private _cyclicWarningSent?: boolean;\r\n  private _getVisualStates?: () => string[];\r\n  private _resetReactVirtualDOM?: () => void;\r\n\r\n  public getInspectInfo: NodeDefinition[\"getInspectInfo\"];\r\n\r\n  constructor(context: NodeContext, id: string) {\r\n    this.id = id;\r\n    this.context = context;\r\n  }\r\n\r\n  getInputValue(name: string): any {\r\n    return this._inputValues[name];\r\n  }\r\n\r\n  registerInput(name: string, input: Input<this>): void {\r\n    if (this.hasInput(name)) {\r\n      throw new Error(\"Input property \" + name + \" already registered\");\r\n    }\r\n\r\n    this._inputs[name] = input;\r\n\r\n    if (input.type && typeof input.type === \"object\" && \"units\" in input.type) {\r\n      const defaultUnit = input.type.defaultUnit || input.type.units?.[0] || \"\";\r\n      this._inputValues[name] = {\r\n        value: input.default,\r\n        type: defaultUnit,\r\n      };\r\n    } else if (input.hasOwnProperty(\"default\")) {\r\n      this._inputValues[name] = input.default;\r\n    }\r\n  }\r\n\r\n  deregisterInput(name: string): void {\r\n    if (this.hasInput(name) === false) {\r\n      throw new Error(\"Input property \" + name + \" doesn't exist\");\r\n    }\r\n    delete this._inputs[name];\r\n    delete this._inputValues[name];\r\n  }\r\n\r\n  registerInputs(inputs: Record<string, Input<this>>): void {\r\n    for (const name in inputs) {\r\n      this.registerInput(name, inputs[name]);\r\n    }\r\n  }\r\n\r\n  getInput(name: string): Input<this> | undefined {\r\n    if (this.hasInput(name) === false) {\r\n      console.log(\"Node \" + this.name + \": Invalid input property \" + name);\r\n      return undefined;\r\n    }\r\n\r\n    return this._inputs[name];\r\n  }\r\n\r\n  hasInput(name: string): boolean {\r\n    return name in this._inputs;\r\n  }\r\n\r\n  registerInputIfNeeded(_name?: string): void {\r\n    //noop, can be overriden by subclasses\r\n  }\r\n\r\n  setInputValue(name: string, value: any): void {\r\n    const input = this.getInput(name);\r\n    if (!input) {\r\n      console.log(\"node doesn't have input\", name);\r\n      return;\r\n    }\r\n\r\n    if (\r\n      typeof input.type === \"object\" &&\r\n      input.type.name === \"array\" &&\r\n      typeof value === \"string\"\r\n    ) {\r\n      try {\r\n        const parsedValue = JSON.parse(value);\r\n        input.set.call(this, parsedValue);\r\n        input.value = parsedValue;\r\n        this._inputValues[name] = parsedValue;\r\n      } catch (e) {\r\n        // Handle parsing error if needed\r\n      }\r\n    } else {\r\n      input.set.call(this, value);\r\n      input.value = value;\r\n      this._inputValues[name] = value;\r\n    }\r\n\r\n    if (input.type === \"color\" && this.context && this.context.styles) {\r\n      value = this.context.styles.resolveColor(value);\r\n    } else if (input.type === \"array\" && typeof value === \"string\") {\r\n      try {\r\n        value = eval(value);\r\n        this.context.editorConnection?.clearWarning(\r\n          this.nodeScope?.componentOwner?.name,\r\n          this.id,\r\n          \"invalid-array-\" + name\r\n        );\r\n      } catch (e) {\r\n        const error = e as Error;\r\n\r\n        value = [];\r\n        console.log(e);\r\n        if (this.context.editorConnection) {\r\n          this.context.editorConnection.sendWarning(\r\n            this.nodeScope?.componentOwner?.name,\r\n            this.id,\r\n            \"invalid-array-\" + name,\r\n            {\r\n              showGlobally: true,\r\n              message: \"Invalid array<br>\" + error.toString(),\r\n            }\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    input.set.call(this, value);\r\n  }\r\n\r\n  hasOutput(name: string): boolean {\r\n    return name in this._outputs;\r\n  }\r\n\r\n  registerOutput(name: string, output: Output<this>): void {\r\n    if (this.hasOutput(name)) {\r\n      throw new Error(\"Output property \" + name + \" already registered\");\r\n    }\r\n\r\n    const newOutput = new OutputProperty({\r\n      owner: this,\r\n      getter: output.get || output.getter,\r\n      name: name,\r\n      onFirstConnectionAdded: output.onFirstConnectionAdded,\r\n      onLastConnectionRemoved: output.onLastConnectionRemoved,\r\n    });\r\n\r\n    this._outputs[name] = newOutput;\r\n    this._outputList.push(newOutput);\r\n  }\r\n\r\n  deregisterOutput(name: string): void {\r\n    if (this.hasOutput(name) === false) {\r\n      throw new Error(\"Output property \" + name + \" isn't registered\");\r\n    }\r\n\r\n    const output = this._outputs[name];\r\n\r\n    if (output.hasConnections()) {\r\n      throw new Error(\r\n        \"Output property \" + name + \" has connections and can't be removed\"\r\n      );\r\n    }\r\n\r\n    delete this._outputs[name];\r\n    const index = this._outputList.indexOf(output);\r\n    this._outputList.splice(index, 1);\r\n  }\r\n\r\n  registerOutputs(outputs: Record<string, Output<this>>): void {\r\n    for (const name in outputs) {\r\n      this.registerOutput(name, outputs[name]);\r\n    }\r\n  }\r\n\r\n  registerOutputIfNeeded(): void {\r\n    //noop, can be overriden by subclasses\r\n  }\r\n\r\n  getOutput(name: string): OutputProperty {\r\n    if (this.hasOutput(name) === false) {\r\n      throw new Error(\r\n        \"Node \" + this.name + \" doesn't have a port named \" + name\r\n      );\r\n    }\r\n    return this._outputs[name];\r\n  }\r\n\r\n  connectInput(\r\n    inputName: string,\r\n    sourceNode: Node,\r\n    sourcePortName: string\r\n  ): void {\r\n    if (this.hasInput(inputName) === false) {\r\n      throw new Error(\r\n        \"Invalid connection, input doesn't exist. Trying to connect from \" +\r\n          sourceNode.name +\r\n          \" output \" +\r\n          sourcePortName +\r\n          \" to \" +\r\n          this.name +\r\n          \" input \" +\r\n          inputName\r\n      );\r\n    }\r\n\r\n    const sourcePort = sourceNode.getOutput(sourcePortName);\r\n    sourcePort.registerConnection(this, inputName);\r\n\r\n    if (!this._inputConnections[inputName]) {\r\n      this._inputConnections[inputName] = [];\r\n    }\r\n\r\n    this._inputConnections[inputName].push(sourcePort);\r\n\r\n    if (sourceNode._signalsSentThisUpdate[sourcePortName]) {\r\n      this._setValueFromConnection(inputName, true);\r\n      this._setValueFromConnection(inputName, false);\r\n    } else {\r\n      const outputValue = sourcePort.value;\r\n      if (outputValue !== undefined) {\r\n        this._setValueFromConnection(inputName, outputValue);\r\n\r\n        if (this.context) {\r\n          // Send value to editor for connection debugging.\r\n          // Conceptually the value has already been sent,\r\n          // but the editor needs to be notified after a connection is created\r\n          this.context.connectionSentValue(sourcePort, sourcePort.value);\r\n        }\r\n      }\r\n    }\r\n\r\n    this.flagDirty();\r\n  }\r\n\r\n  removeInputConnection(\r\n    inputName: string,\r\n    sourceNodeId: string,\r\n    sourcePortName: string\r\n  ): void {\r\n    if (!this._inputConnections[inputName]) {\r\n      throw new Error(\"Node removeInputConnection: Input doesn't exist\");\r\n    }\r\n\r\n    const inputsToPort = this._inputConnections[inputName];\r\n\r\n    for (let i = 0; i < inputsToPort.length; i++) {\r\n      const sourcePort = inputsToPort[i];\r\n      if (\r\n        sourcePort.owner.id === sourceNodeId &&\r\n        sourcePort.name === sourcePortName\r\n      ) {\r\n        inputsToPort.splice(i, 1);\r\n\r\n        //remove the output from the source node\r\n        const output = sourcePort.owner.getOutput(sourcePortName);\r\n        output.deregisterConnection(this, inputName);\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (inputsToPort.length === 0) {\r\n      //no inputs left, remove the bookkeeping that traces values sent to this node as inputs\r\n      delete this._valuesFromConnections[inputName];\r\n    }\r\n  }\r\n\r\n  isInputConnected(inputName: string): boolean {\r\n    if (!this._inputConnections.hasOwnProperty(inputName)) {\r\n      return false;\r\n    }\r\n\r\n    //We have connections, but they might be from non-connected component inputs.\r\n    // If they are from a component input then check the input on the component instance.\r\n    return this._inputConnections[inputName].some((c) => {\r\n      //if this is not a component input, then we have a proper connection\r\n      if (c.owner.name !== \"Component Inputs\") return true;\r\n\r\n      //the name of the output from the component input, is the same as the component instance input\r\n      const component = c.owner.nodeScope?.componentOwner;\r\n      return component?.isInputConnected(c.name);\r\n    });\r\n  }\r\n\r\n  update(): void {\r\n    if (this._isUpdating || this._dirty === false) {\r\n      return;\r\n    }\r\n\r\n    if (this._updatedAtIteration !== this.context.updateIteration) {\r\n      this._updatedAtIteration = this.context.updateIteration;\r\n      this._updateIteration = 0;\r\n      if (this._cyclicLoop) this._cyclicLoop = false;\r\n    }\r\n\r\n    this._isUpdating = true;\r\n    const maxUpdateIterations = 100;\r\n\r\n    try {\r\n      while (this._dirty && !this._cyclicLoop) {\r\n        this._updateDependencies();\r\n\r\n        //all inputs are now updated, flag as not dirty\r\n        this._dirty = false;\r\n\r\n        const inputNames = Object.keys(this._inputValuesQueue);\r\n\r\n        let hasMoreInputs = true;\r\n\r\n        while (hasMoreInputs && !this._cyclicLoop) {\r\n          hasMoreInputs = false;\r\n\r\n          for (let i = 0; i < inputNames.length; i++) {\r\n            const inputName = inputNames[i];\r\n            const queue = this._inputValuesQueue[inputName];\r\n            if (queue.length > 0) {\r\n              this.setInputValue(inputName, queue.shift());\r\n              if (queue.length > 0) {\r\n                hasMoreInputs = true;\r\n              }\r\n            }\r\n          }\r\n\r\n          const afterInputCallbacks = this._afterInputsHaveUpdatedCallbacks;\r\n          this._afterInputsHaveUpdatedCallbacks = [];\r\n          for (let i = 0; i < afterInputCallbacks.length; i++) {\r\n            afterInputCallbacks[i].call(this);\r\n          }\r\n        }\r\n        this._updateIteration++;\r\n\r\n        if (this._updateIteration >= maxUpdateIterations) {\r\n          this._cyclicLoop = true;\r\n        }\r\n      }\r\n    } catch (e) {\r\n      this._isUpdating = false;\r\n      throw e;\r\n    }\r\n\r\n    if (this._cyclicLoop) {\r\n      //flag the node as dirty again to let it contiune next frame so we don't just stop it\r\n      //This will allow the browser a chance to render and run other code\r\n      this.context.scheduleNextFrame(() => {\r\n        this.context.nodeIsDirty(this);\r\n      });\r\n\r\n      if (\r\n        this.context.editorConnection &&\r\n        !this._cyclicWarningSent &&\r\n        this.context.isWarningTypeEnabled(\"cyclicLoops\")\r\n      ) {\r\n        this.context.editorConnection.sendWarning(\r\n          this.nodeScope?.componentOwner?.name,\r\n          this.id,\r\n          \"cyclic-loop\",\r\n          {\r\n            showGlobally: true,\r\n            message: \"Cyclic loop detected\",\r\n          }\r\n        );\r\n        this._cyclicWarningSent = true;\r\n        console.log(\"cycle detected\", {\r\n          id: this.id,\r\n          name: this.name,\r\n          component: this.nodeScope?.componentOwner?.name,\r\n        });\r\n      }\r\n    }\r\n\r\n    this._isFirstUpdate = false;\r\n    this._isUpdating = false;\r\n  }\r\n\r\n  private _updateDependencies(): void {\r\n    for (const inputName in this._inputConnections) {\r\n      const connectedPorts = this._inputConnections[inputName];\r\n      for (let i = 0; i < connectedPorts.length; ++i) {\r\n        connectedPorts[i].owner.update();\r\n      }\r\n    }\r\n  }\r\n\r\n  flagDirty(): void {\r\n    if (this._dirty) {\r\n      return;\r\n    }\r\n\r\n    this._dirty = true;\r\n\r\n    //a hack to not update nodes as a component is being created.\r\n    //Nodes should update once all connections are in place, so inputs that rely on connections, e.g. \"Run\" on a Function node, have the correct context before running.\r\n    //This flag is being updated externally by the NodeScope and _performDirtyUpdate will be called when the component setup is done\r\n    if (this.updateOnDirtyFlagging) {\r\n      this._performDirtyUpdate();\r\n    }\r\n  }\r\n\r\n  protected _performDirtyUpdate(): void {\r\n    this.context && this.context.nodeIsDirty(this);\r\n\r\n    for (let i = 0; i < this._outputList.length; ++i) {\r\n      this._outputList[i].flagDependeesDirty();\r\n    }\r\n  }\r\n\r\n  sendValue(name: string, value: any): void {\r\n    if (this.hasOutput(name) === false) {\r\n      console.log(\r\n        \"Error: Node\",\r\n        this.name,\r\n        \"doesn't have a output named\",\r\n        name\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (value === undefined) {\r\n      return;\r\n    }\r\n\r\n    const output = this.getOutput(name);\r\n    output.sendValue(value);\r\n\r\n    if (this.context) {\r\n      this.context.connectionSentValue(output, value);\r\n    }\r\n  }\r\n\r\n  flagOutputDirty(name: string): void {\r\n    const output = this.getOutput(name);\r\n    this.sendValue(name, output.value);\r\n  }\r\n\r\n  flagAllOutputsDirty(): void {\r\n    for (const output of this._outputList) {\r\n      this.sendValue(output.name, output.value);\r\n    }\r\n  }\r\n\r\n  sendSignalOnOutput(outputName: string): void {\r\n    if (this.hasOutput(outputName) === false) {\r\n      console.log(\r\n        \"Error: Node\",\r\n        this.name,\r\n        \"doesn't have a output named\",\r\n        outputName\r\n      );\r\n      return;\r\n    }\r\n\r\n    const output = this.getOutput(outputName);\r\n    output.sendValue(true);\r\n    output.sendValue(false);\r\n\r\n    this._signalsSentThisUpdate[outputName] = true;\r\n    this.scheduleAfterInputsHaveUpdated(function (this: Node) {\r\n      this._signalsSentThisUpdate[outputName] = false;\r\n    });\r\n\r\n    if (this.context) {\r\n      this.context.connectionSentSignal(output);\r\n    }\r\n  }\r\n\r\n  _setValueFromConnection(inputName: string, value: any): void {\r\n    this._valuesFromConnections[inputName] = value;\r\n    this.queueInput(inputName, value);\r\n  }\r\n\r\n  _hasInputBeenSetFromAConnection(inputName: string): boolean {\r\n    return this._valuesFromConnections.hasOwnProperty(inputName);\r\n  }\r\n\r\n  queueInput(inputName: string, value: any): void {\r\n    if (!this._inputValuesQueue[inputName]) {\r\n      this._inputValuesQueue[inputName] = [];\r\n    }\r\n\r\n    //when values are queued during the very first update, make the last value overwrite previous ones\r\n    //so a chain with multiple nodes with values that connect to each other all\r\n    //consolidate to a single value, instead of piling up in the queue\r\n    if (this._isFirstUpdate) {\r\n      //signals need two values, so make sure we don't suppress the 'false' that comes directly\r\n      //after a 'true'\r\n      const queueValue = this._inputValuesQueue[inputName][0];\r\n      const isSignal = queueValue === true; // && value === true;\r\n      if (!isSignal) {\r\n        //default units are set as an object {value, unit}\r\n        //subsequent inputs can be unitless. and will will then overwrite those\r\n        //and the node will get a value without ever getting a unit.\r\n        //To make sure that doesn't happen, look at the value being overwritten\r\n        //and use the unit from that before overwriting\r\n        if (\r\n          queueValue instanceof Object &&\r\n          (queueValue as any).unit &&\r\n          value instanceof Object === false\r\n        ) {\r\n          value = {\r\n            value,\r\n            unit: (queueValue as any).unit,\r\n          };\r\n        }\r\n\r\n        this._inputValuesQueue[inputName].length = 0;\r\n      }\r\n    }\r\n\r\n    this._inputValuesQueue[inputName].push(value);\r\n    this.flagDirty();\r\n  }\r\n\r\n  scheduleAfterInputsHaveUpdated(\r\n    callbackFn: (this: Node<TInternal>) => void\r\n  ): void {\r\n    this._afterInputsHaveUpdatedCallbacks.push(callbackFn);\r\n    this.flagDirty();\r\n  }\r\n\r\n  setNodeModel(nodeModel: NodeModel): void {\r\n    this.model = nodeModel;\r\n    nodeModel.on(\"parameterUpdated\", this._onNodeModelParameterUpdated, this);\r\n    nodeModel.on(\"variantUpdated\", this._onNodeModelVariantUpdated, this);\r\n\r\n    nodeModel.on(\r\n      \"inputPortRemoved\",\r\n      (port: { name: string }) => {\r\n        if (this.hasInput(port.name)) {\r\n          this.deregisterInput(port.name);\r\n        }\r\n      },\r\n      this\r\n    );\r\n\r\n    nodeModel.on(\r\n      \"outputPortRemoved\",\r\n      (port: { name: string }) => {\r\n        if (this.hasOutput(port.name)) {\r\n          this.deregisterOutput(port.name);\r\n        }\r\n      },\r\n      this\r\n    );\r\n  }\r\n\r\n  addDeleteListener(listener: Function): void {\r\n    this._deleteListeners.push(listener);\r\n  }\r\n\r\n  /*protected*/ _onNodeDeleted(): void {\r\n    if (this.model) {\r\n      this.model.removeListenersWithRef(this);\r\n      this.model = undefined;\r\n    }\r\n\r\n    this._deleted = true;\r\n\r\n    for (const deleteListener of this._deleteListeners) {\r\n      deleteListener.call(this);\r\n    }\r\n  }\r\n\r\n  private _onNodeModelParameterUpdated(event: {\r\n    name: string;\r\n    value: any;\r\n    state?: string;\r\n  }): void {\r\n    this.registerInputIfNeeded(event.name);\r\n\r\n    if (event.value !== undefined) {\r\n      if (event.state) {\r\n        //this parameter is only used in a certain visual state\r\n        //make sure we are in that state before setting it\r\n\r\n        if (!this._getVisualStates) {\r\n          console.log(\r\n            \"Node has nos visual states, but got a parameter for state\",\r\n            event.state\r\n          );\r\n          return;\r\n        }\r\n\r\n        const states = this._getVisualStates();\r\n        if (states.indexOf(event.state) !== -1) {\r\n          this.queueInput(event.name, event.value);\r\n        }\r\n      } else {\r\n        this.queueInput(event.name, event.value);\r\n      }\r\n    } else {\r\n      //parameter is undefined, that means it has been removed and we should reset to default\r\n      let defaultValue;\r\n\r\n      const variant = this.variant;\r\n\r\n      if (typeof variant === \"object\") {\r\n        if (event.state) {\r\n          //local value has been reset, check the variant first\r\n          if (\r\n            variant &&\r\n            variant.stateParameters.hasOwnProperty(event.state) &&\r\n            variant.stateParameters[event.state].hasOwnProperty(event.name)\r\n          ) {\r\n            defaultValue = variant.stateParameters[event.state][event.name];\r\n          }\r\n          //and if variant has no value in that state, check for local values in the neutral state\r\n          else if (this.model?.parameters.hasOwnProperty(event.name)) {\r\n            defaultValue = this.model.parameters[event.name];\r\n          }\r\n          //and then look in the variant neutral values\r\n          else if (variant && variant.parameters.hasOwnProperty(event.name)) {\r\n            defaultValue = variant.parameters[event.name];\r\n          }\r\n        } else if (variant && variant.parameters.hasOwnProperty(event.name)) {\r\n          defaultValue = variant.parameters[event.name];\r\n        }\r\n      }\r\n\r\n      if (defaultValue === undefined) {\r\n        //get the default value for the port\r\n        defaultValue = this.context.getDefaultValueForInput(\r\n          this.model!.type,\r\n          event.name\r\n        );\r\n\r\n        //when a paramter that's used by a text style is reset, Noodl will modify the original dom node, outside of React\r\n        //React will then re-render, and should apply the values from the text style, but won't see any delta in the virtual dom,\r\n        //even though there is a diff to the real dom.\r\n        //to fix that, we just force React to re-render the entire node\r\n        this._resetReactVirtualDOM && this._resetReactVirtualDOM();\r\n      }\r\n\r\n      this.queueInput(event.name, defaultValue);\r\n    }\r\n  }\r\n\r\n  private _onNodeModelVariantUpdated(variant: any): void {\r\n    this.setVariant(variant);\r\n  }\r\n\r\n  setVariant(variant: Variant): void {\r\n    this.variant = variant;\r\n  }\r\n}\r\n","import { Collection } from \"../../../collection\";\r\nimport { Model } from \"../../../model\";\r\n\r\ninterface NodeDefinition {\r\n  node: {\r\n    name?: string;\r\n    category?: string;\r\n    color?: string;\r\n    inputs?: Record<string, any>;\r\n    outputs?: Record<string, any>;\r\n    methods?: Record<string, any>;\r\n    dynamicports?: any[];\r\n    usePortAsLabel?: string;\r\n    initialize?: () => void;\r\n    getInspectInfo?: () => any;\r\n  };\r\n  setup?: (context: any, graphModel: any) => void;\r\n}\r\n\r\ninterface Internal {\r\n  modelId?: string;\r\n  model?: typeof Model;\r\n  inputValues: Record<string, any>;\r\n  inputTypes: Record<string, string>;\r\n}\r\n\r\nfunction _addBaseInfo(def: NodeDefinition): void {\r\n  Object.assign(def.node, {\r\n    category: \"Data\",\r\n    color: \"data\",\r\n  });\r\n}\r\n\r\nfunction _addModelId(\r\n  def: NodeDefinition,\r\n  opts?: { includeInputs?: boolean; includeOutputs?: boolean }\r\n): void {\r\n  const _includeInputs = opts === undefined || opts.includeInputs;\r\n  const _includeOutputs = opts === undefined || opts.includeOutputs;\r\n\r\n  Object.assign(def.node, {\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {},\r\n  });\r\n\r\n  if (_includeInputs) {\r\n    Object.assign(def.node, {\r\n      usePortAsLabel: \"modelId\",\r\n    });\r\n\r\n    def.node.dynamicports = (def.node.dynamicports || []).concat([\r\n      {\r\n        name: \"conditionalports/extended\",\r\n        condition: \"idSource = explicit OR idSource NOT SET\",\r\n        inputs: [\"modelId\"],\r\n      },\r\n    ]);\r\n\r\n    // Inputs\r\n    // @ts-expect-error\r\n    Object.assign(def.node.inputs, {\r\n      idSource: {\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { label: \"Specify explicitly\", value: \"explicit\" },\r\n            { label: \"From repeater\", value: \"foreach\" },\r\n          ],\r\n          allowEditOnly: true,\r\n        },\r\n        default: \"explicit\",\r\n        displayName: \"Id Source\",\r\n        group: \"General\",\r\n        set(value: string) {\r\n          if (value === \"foreach\") {\r\n            // @ts-expect-error\r\n            this.scheduleAfterInputsHaveUpdated(() => {\r\n              // Find closest nodescope that have a _forEachModel\r\n              // @ts-expect-error\r\n              let component = this.nodeScope.componentOwner;\r\n              while (\r\n                component !== undefined &&\r\n                component._forEachModel === undefined &&\r\n                component.parentNodeScope\r\n              ) {\r\n                component = component.parentNodeScope.componentOwner;\r\n              }\r\n              // @ts-expect-error\r\n              this.setModel(\r\n                component !== undefined ? component._forEachModel : undefined\r\n              );\r\n            });\r\n          }\r\n        },\r\n      },\r\n      modelId: {\r\n        type: {\r\n          name: \"string\",\r\n          identifierOf: \"ModelName\",\r\n          identifierDisplayName: \"Object Ids\",\r\n        },\r\n        displayName: \"Id\",\r\n        group: \"General\",\r\n        set: function (value: string | typeof Model): void {\r\n          if (value instanceof Model) value = value.getId(); // Can be passed as model as well\r\n          // @ts-expect-error\r\n          this._internal.modelId = value; // Wait to fetch data\r\n          // @ts-expect-error\r\n          this.setModelID(value);\r\n        },\r\n      },\r\n    });\r\n  }\r\n\r\n  // Outputs\r\n  if (_includeOutputs) {\r\n    // @ts-expect-error\r\n    Object.assign(def.node.outputs, {\r\n      id: {\r\n        type: \"string\",\r\n        displayName: \"Id\",\r\n        group: \"General\",\r\n        getter: function (): string {\r\n          // @ts-expect-error\r\n          return this._internal.model\r\n            ? // @ts-expect-error\r\n              this._internal.model.getId()\r\n            : // @ts-expect-error\r\n              this._internal.modelId;\r\n        },\r\n      },\r\n    });\r\n  }\r\n\r\n  // Methods\r\n  // @ts-expect-error\r\n  Object.assign(def.node.methods, {\r\n    setModelID: function (id: string): void {\r\n      // @ts-expect-error\r\n      const model = (this.nodeScope.modelScope || Model).get(id);\r\n      // @ts-expect-error\r\n      this.setModel(model);\r\n    },\r\n    setModel: function (model: typeof Model): void {\r\n      // @ts-expect-error\r\n      this._internal.model = model;\r\n      // @ts-expect-error\r\n      this.flagOutputDirty(\"id\");\r\n    },\r\n  });\r\n\r\n  //Inspect model\r\n  if (!def.node.getInspectInfo) {\r\n    def.node.getInspectInfo = function (): any[] | string {\r\n      // @ts-expect-error\r\n      const model = this._internal.model;\r\n      if (!model) return \"[No Object]\";\r\n\r\n      return [\r\n        { type: \"text\", value: \"Id: \" + model.getId() },\r\n        { type: \"value\", value: model.data },\r\n      ];\r\n    };\r\n  }\r\n}\r\n\r\nfunction _addInputProperties(def: NodeDefinition): void {\r\n  const _def: NodeDefinition = {\r\n    node: Object.assign({}, def.node),\r\n    setup: def.setup,\r\n  };\r\n  const _methods = Object.assign({}, def.node.methods);\r\n\r\n  Object.assign(def.node, {\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {},\r\n  });\r\n\r\n  Object.assign(def, {\r\n    setup: function (context: any, graphModel: any): void {\r\n      if (\r\n        !context.editorConnection ||\r\n        !context.editorConnection.isRunningLocally()\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      graphModel.on(\"nodeAdded.\" + def.node.name, function (node: any) {\r\n        function _updatePorts(): void {\r\n          const ports: any[] = [];\r\n\r\n          const _types = [\r\n            { label: \"String\", value: \"string\" },\r\n            { label: \"Boolean\", value: \"boolean\" },\r\n            { label: \"Number\", value: \"number\" },\r\n            { label: \"Date\", value: \"date\" },\r\n            { label: \"Array\", value: \"array\" },\r\n            { label: \"Object\", value: \"object\" },\r\n            { label: \"Any\", value: \"*\" },\r\n          ];\r\n\r\n          // Add value outputs\r\n          let properties = node.parameters.properties;\r\n          if (properties) {\r\n            properties = properties ? properties.split(\",\") : undefined;\r\n            for (const p of properties) {\r\n              // Property input\r\n              ports.push({\r\n                type: {\r\n                  name:\r\n                    node.parameters[\"type-\" + p] === undefined\r\n                      ? \"*\"\r\n                      : node.parameters[\"type-\" + p],\r\n                },\r\n                plug: \"input\",\r\n                group: \"Property Values\",\r\n                displayName: p,\r\n                name: \"prop-\" + p,\r\n              });\r\n\r\n              // Property type\r\n              ports.push({\r\n                type: {\r\n                  name: \"enum\",\r\n                  enums: _types,\r\n                  allowEditOnly: true,\r\n                },\r\n                plug: \"input\",\r\n                group: \"Property Types\",\r\n                displayName: p,\r\n                default: \"*\",\r\n                name: \"type-\" + p,\r\n              });\r\n            }\r\n          }\r\n\r\n          context.editorConnection.sendDynamicPorts(node.id, ports, {\r\n            detectRenamed: {\r\n              plug: \"input\",\r\n            },\r\n          });\r\n        }\r\n\r\n        _updatePorts();\r\n\r\n        node.on(\"parameterUpdated\", function () {\r\n          _updatePorts();\r\n        });\r\n      });\r\n\r\n      _def.setup && _def.setup(context, graphModel);\r\n    },\r\n  });\r\n\r\n  // Initialize\r\n  Object.assign(def.node, {\r\n    initialize: function (): void {\r\n      // @ts-expect-error\r\n      const internal = this._internal as Internal;\r\n      internal.inputValues = {};\r\n      internal.inputTypes = {};\r\n\r\n      _def.node.initialize && _def.node.initialize.call(this);\r\n    },\r\n  });\r\n\r\n  // Outputs\r\n  // @ts-expect-error\r\n  Object.assign(def.node.outputs, {});\r\n\r\n  // Inputs\r\n  // @ts-expect-error\r\n  Object.assign(def.node.inputs, {\r\n    properties: {\r\n      type: { name: \"stringlist\", allowEditOnly: true },\r\n      displayName: \"Properties\",\r\n      group: \"Properties to set\",\r\n      set: function (): void {},\r\n    },\r\n  });\r\n\r\n  // Methods\r\n  // @ts-expect-error\r\n  Object.assign(def.node.methods, {\r\n    _pushInputValues: function (model: typeof Model): void {\r\n      // @ts-expect-error\r\n      const internal = this._internal as Internal;\r\n\r\n      const _defaultValueForType: Record<string, any> = {\r\n        boolean: false,\r\n        string: \"\",\r\n        number: 0,\r\n        date: new Date(),\r\n      };\r\n\r\n      const _allKeys: Record<string, boolean> = {};\r\n      for (const key in internal.inputTypes) _allKeys[key] = true;\r\n      for (const key in internal.inputValues) _allKeys[key] = true;\r\n\r\n      // @ts-expect-error\r\n      const properties = this.model.parameters.properties || \"\";\r\n\r\n      const validProperties = properties.split(\",\");\r\n\r\n      const keysToSet = Object.keys(_allKeys).filter(\r\n        (key) => validProperties.indexOf(key) !== -1\r\n      );\r\n\r\n      for (const i of keysToSet) {\r\n        let value = internal.inputValues[i];\r\n\r\n        if (value !== undefined) {\r\n          //Parse array types with string as javascript\r\n          if (\r\n            internal.inputTypes[i] !== undefined &&\r\n            internal.inputTypes[i] === \"array\" &&\r\n            typeof value === \"string\"\r\n          ) {\r\n            // @ts-expect-error\r\n            this.context.editorConnection.clearWarning(\r\n              // @ts-expect-error\r\n              this.nodeScope.componentOwner.name,\r\n              // @ts-expect-error\r\n              this.id,\r\n              \"invalid-array-\" + i\r\n            );\r\n\r\n            try {\r\n              value = eval(value); //this might be static data in the form of javascript\r\n            } catch (e) {\r\n              if (value.indexOf(\"[\") !== -1 || value.indexOf(\"{\") !== -1) {\r\n                // @ts-expect-error\r\n                this.context.editorConnection.sendWarning(\r\n                  // @ts-expect-error\r\n                  this.nodeScope.componentOwner.name,\r\n                  // @ts-expect-error\r\n                  this.id,\r\n                  \"invalid-array-\" + i,\r\n                  {\r\n                    showGlobally: true,\r\n                    // @ts-expect-error\r\n                    message: \"Invalid array<br>\" + e.toString(),\r\n                  }\r\n                );\r\n                value = [];\r\n              } else {\r\n                //backwards compatibility with how this node used to work\r\n                value = Collection.get(value);\r\n              }\r\n            }\r\n          }\r\n          // Resolve object from IDs\r\n          if (\r\n            internal.inputTypes[i] !== undefined &&\r\n            internal.inputTypes[i] === \"object\" &&\r\n            typeof value === \"string\"\r\n          ) {\r\n            // @ts-expect-error\r\n            value = (this.nodeScope.modelScope || Model).get(value);\r\n          }\r\n\r\n          // @ts-expect-error\r\n          model.set(i, value, { resolve: true });\r\n        } else {\r\n          // @ts-expect-error\r\n          model.set(i, _defaultValueForType[internal.inputTypes[i]], {\r\n            resolve: true,\r\n          });\r\n        }\r\n      }\r\n    },\r\n    scheduleStore: function (): void {\r\n      // @ts-expect-error\r\n      if (this.hasScheduledStore) return;\r\n      // @ts-expect-error\r\n      this.hasScheduledStore = true;\r\n\r\n      // @ts-expect-error\r\n      const internal = this._internal as Internal;\r\n      // @ts-expect-error\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.hasScheduledStore = false;\r\n        if (!internal.model) return;\r\n\r\n        // @ts-expect-error\r\n        this._pushInputValues(internal.model);\r\n\r\n        // @ts-expect-error\r\n        this.sendSignalOnOutput(\"stored\");\r\n      });\r\n    },\r\n    registerInputIfNeeded: function (name: string): void {\r\n      // @ts-expect-error\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"prop-\"))\r\n        // @ts-expect-error\r\n        this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this._setInputValue.bind(this, name.substring(\"prop-\".length)),\r\n        });\r\n\r\n      if (name.startsWith(\"type-\"))\r\n        // @ts-expect-error\r\n        this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this._setInputType.bind(this, name.substring(\"type-\".length)),\r\n        });\r\n\r\n      _methods &&\r\n        _methods.registerInputIfNeeded &&\r\n        // @ts-expect-error\r\n        _def.node.methods.registerInputIfNeeded.call(this, name);\r\n    },\r\n    _setInputValue: function (name: string, value: any): void {\r\n      // @ts-expect-error\r\n      (this._internal as Internal).inputValues[name] = value;\r\n    },\r\n    _setInputType: function (name: string, value: string): void {\r\n      // @ts-expect-error\r\n      (this._internal as Internal).inputTypes[name] = value;\r\n    },\r\n  });\r\n}\r\n\r\nexport {\r\n  _addInputProperties as addInputProperties,\r\n  _addModelId as addModelId,\r\n  _addBaseInfo as addBaseInfo,\r\n};\r\n","import type { Node } from \"./node\";\r\n\r\ninterface OutputPropertyArgs {\r\n  getter?: () => any;\r\n  owner: Node<any>;\r\n  name: string;\r\n  type?: string;\r\n  onFirstConnectionAdded?: () => void;\r\n  onLastConnectionRemoved?: () => void;\r\n}\r\n\r\ninterface Connection {\r\n  node: Node;\r\n  inputPortName: string;\r\n}\r\n\r\nexport class OutputProperty {\r\n  private getter: () => any;\r\n  private connections: Connection[];\r\n  private _owner: Node;\r\n  private _name: string;\r\n  private onFirstConnectionAdded?: () => void;\r\n  private onLastConnectionRemoved?: () => void;\r\n  private _id?: string;\r\n  private _lastUpdateIteration?: number;\r\n  private valuesSendThisIteration: number = 0;\r\n\r\n  constructor(args: OutputPropertyArgs) {\r\n    if (!args.owner) {\r\n      throw new Error(\"Owner must be set\");\r\n    }\r\n    this.getter = args.getter || (() => undefined);\r\n    this.connections = [];\r\n    this._owner = args.owner;\r\n    this._name = args.name;\r\n    this.onFirstConnectionAdded = args.onFirstConnectionAdded;\r\n    this.onLastConnectionRemoved = args.onLastConnectionRemoved;\r\n  }\r\n\r\n  get name(): string {\r\n    return this._name;\r\n  }\r\n\r\n  get owner(): Node {\r\n    return this._owner;\r\n  }\r\n\r\n  get value(): any {\r\n    return this.getter.call(this.owner);\r\n  }\r\n\r\n  get id(): string {\r\n    if (!this._id) {\r\n      this._id = this.owner.id + this.name;\r\n    }\r\n    return this._id;\r\n  }\r\n\r\n  registerConnection(node: Node<any>, inputPortName: string): void {\r\n    this.connections.push({\r\n      node,\r\n      inputPortName,\r\n    });\r\n\r\n    if (this.connections.length === 1 && this.onFirstConnectionAdded) {\r\n      this.onFirstConnectionAdded.call(this.owner);\r\n    }\r\n  }\r\n\r\n  deregisterConnection(node: Node<any>, inputPortName: string): void {\r\n    for (let i = 0; i < this.connections.length; i++) {\r\n      const connection = this.connections[i];\r\n      if (\r\n        connection.node === node &&\r\n        connection.inputPortName === inputPortName\r\n      ) {\r\n        this.connections.splice(i, 1);\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (this.connections.length === 0 && this.onLastConnectionRemoved) {\r\n      this.onLastConnectionRemoved.call(this.owner);\r\n    }\r\n  }\r\n\r\n  flagDependeesDirty(value?: any): void {\r\n    for (let i = 0, len = this.connections.length; i < len; i++) {\r\n      this.connections[i].node.flagDirty();\r\n    }\r\n  }\r\n\r\n  sendValue(value: any): void {\r\n    if (this._lastUpdateIteration !== (this.owner as any)._updatedAtIteration) {\r\n      this._lastUpdateIteration = (this.owner as any)._updatedAtIteration;\r\n      this.valuesSendThisIteration = 0;\r\n    } else {\r\n      this.valuesSendThisIteration++;\r\n    }\r\n\r\n    if (this.valuesSendThisIteration > 500) {\r\n      (this.owner as any)._cyclicLoop = true;\r\n    }\r\n\r\n    for (let i = 0, len = this.connections.length; i < len; i++) {\r\n      const connection = this.connections[i];\r\n      (connection.node as any)._setValueFromConnection(\r\n        connection.inputPortName,\r\n        value\r\n      );\r\n    }\r\n  }\r\n\r\n  hasConnections(): boolean {\r\n    return this.connections.length > 0;\r\n  }\r\n}\r\n","import type { GraphModel } from \"./models/graphmodel\";\r\nimport type { NodeContext } from \"./nodecontext\";\r\nimport type { InputDefinition, NodeDefinition } from \"./nodedefinition\";\r\nimport type { NodeScope } from \"./nodescope\";\r\n\r\nexport interface NodeSetup {\r\n  metadata: NodeDefinition;\r\n  setupNumberedInputDynamicPorts?: (\r\n    context: NodeContext,\r\n    graphModel: GraphModel\r\n  ) => void;\r\n  (context: any, id: string, nodeScope: any): any;\r\n}\r\n\r\nexport class NodeRegister {\r\n  private _constructors: { [key: string]: NodeSetup };\r\n  private context: NodeContext;\r\n\r\n  constructor(context: NodeContext) {\r\n    this._constructors = {};\r\n    this.context = context;\r\n  }\r\n\r\n  register(nodeDefinition: NodeSetup): void {\r\n    const name = nodeDefinition.metadata.name;\r\n    this._constructors[name] = nodeDefinition;\r\n  }\r\n\r\n  createNode(name: string, id: string, nodeScope: NodeScope): any {\r\n    if (!this._constructors.hasOwnProperty(name)) {\r\n      throw new Error(\"Unknown node type with name \" + name);\r\n    }\r\n\r\n    return this._constructors[name](this.context, id, nodeScope);\r\n  }\r\n\r\n  getNodeMetadata(type: string): NodeDefinition {\r\n    if (!this._constructors.hasOwnProperty(type)) {\r\n      throw new Error(\"Unknown node type with name \" + type);\r\n    }\r\n\r\n    return this._constructors[type].metadata;\r\n  }\r\n\r\n  hasNode(type: string): boolean {\r\n    return this._constructors.hasOwnProperty(type);\r\n  }\r\n\r\n  getInputType(type: string, inputName: string): InputDefinition {\r\n    const metadata = this.getNodeMetadata(type);\r\n    return metadata.inputs?.[inputName]?.type;\r\n  }\r\n}\r\n","interface TimerArgs {\r\n  duration?: number;\r\n  delay?: number;\r\n  repeatCount?: number;\r\n  onStart?: () => void;\r\n  onRunning?: (t: number) => void;\r\n  onStop?: () => void;\r\n  onFinish?: () => void;\r\n  [key: string]: any;\r\n}\r\n\r\nclass Timer {\r\n  [key: string]: any;\r\n\r\n  duration: number;\r\n  delay: number;\r\n  repeatCount: number;\r\n  _isRunning: boolean;\r\n  _hasCalledOnStart: boolean = false;\r\n  _wasStopped: boolean = false;\r\n  _start: number = 0;\r\n  _durationLeft: number = 0;\r\n  scheduler: TimerScheduler;\r\n  onStart?: () => void;\r\n  onRunning?: (t: number) => void;\r\n  onStop?: () => void;\r\n  onFinish?: () => void;\r\n\r\n  constructor(scheduler: TimerScheduler, args: TimerArgs) {\r\n    this.duration = args.duration || 0;\r\n    this._isRunning = false;\r\n    this._hasCalledOnStart = false;\r\n    this.scheduler = scheduler;\r\n    this.repeatCount = 1;\r\n    this.delay = 0;\r\n\r\n    for (const arg in args) {\r\n      this[arg] = args[arg];\r\n    }\r\n  }\r\n\r\n  start(): Timer {\r\n    if (this._isRunning) {\r\n      this.stop();\r\n    }\r\n\r\n    this.scheduler.scheduleTimer(this);\r\n    return this;\r\n  }\r\n\r\n  stop(): void {\r\n    this.scheduler.stopTimer(this);\r\n    this._hasCalledOnStart = false;\r\n    this._isRunning = false;\r\n    this._wasStopped = true; // This is used to avoid calling onFinish\r\n  }\r\n\r\n  isRunning(): boolean {\r\n    return this._isRunning;\r\n  }\r\n\r\n  durationLeft(): number {\r\n    return this._durationLeft;\r\n  }\r\n}\r\n\r\nexport class TimerScheduler {\r\n  requestFrame: () => void;\r\n  runningTimers: Timer[];\r\n  newTimers: Timer[];\r\n\r\n  constructor(requestFrameCallback: () => void) {\r\n    this.requestFrame = requestFrameCallback;\r\n    this.runningTimers = [];\r\n    this.newTimers = [];\r\n  }\r\n\r\n  createTimer(args: TimerArgs): Timer {\r\n    return new Timer(this, args);\r\n  }\r\n\r\n  scheduleTimer(timer: Timer): void {\r\n    if (this.newTimers.indexOf(timer) === -1) {\r\n      if (timer.repeatCount === 0) {\r\n        timer.repeatCount = 100000;\r\n      }\r\n\r\n      this.newTimers.push(timer);\r\n      this.requestFrame();\r\n    }\r\n  }\r\n\r\n  stopTimer(timer: Timer): void {\r\n    let index: number;\r\n\r\n    if (timer._isRunning) {\r\n      index = this.runningTimers.indexOf(timer);\r\n      if (index !== -1) {\r\n        this.runningTimers.splice(index, 1);\r\n      }\r\n\r\n      if (timer.onStop && !timer._wasStopped) {\r\n        timer.onStop();\r\n      }\r\n    } else {\r\n      index = this.newTimers.indexOf(timer);\r\n      if (index !== -1) {\r\n        this.newTimers.splice(index, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  runTimers(currentTime: number): void {\r\n    const remainingTimers: Timer[] = [];\r\n    const finishedTimers: Timer[] = [];\r\n    const timersThisFrame: Timer[] = [];\r\n\r\n    let i: number;\r\n    const len = this.runningTimers.length;\r\n    let timer: Timer;\r\n\r\n    //copy timer list in case timers are added or removed during onStart or onRunning\r\n    for (i = 0; i < len; ++i) {\r\n      timersThisFrame[i] = this.runningTimers[i];\r\n    }\r\n\r\n    for (i = 0; i < len; ++i) {\r\n      timer = timersThisFrame[i];\r\n      if (timer && currentTime >= timer._start) {\r\n        if (timer._hasCalledOnStart === false && timer.onStart) {\r\n          timer.onStart();\r\n          timer._hasCalledOnStart = true;\r\n        }\r\n\r\n        let t: number;\r\n        if (timer.duration > 0) {\r\n          t =\r\n            (currentTime - timer._start) / (timer.duration * timer.repeatCount);\r\n        } else {\r\n          t = 1.0;\r\n        }\r\n\r\n        timer._durationLeft = timer.duration * (1 - t);\r\n\r\n        let localT = t * timer.repeatCount - Math.floor(t * timer.repeatCount);\r\n        if (t >= 1.0) {\r\n          localT = 1.0;\r\n        }\r\n\r\n        if (timer.onRunning) {\r\n          timer.onRunning(localT);\r\n        }\r\n\r\n        if (t < 1.0 && timer._isRunning) {\r\n          remainingTimers.push(timer);\r\n        } else if (!timer._wasStopped) {\r\n          finishedTimers.push(timer);\r\n        }\r\n      } else {\r\n        remainingTimers.push(timer);\r\n      }\r\n    }\r\n\r\n    this.runningTimers = remainingTimers;\r\n\r\n    for (i = 0; i < finishedTimers.length; ++i) {\r\n      finishedTimers[i]._isRunning = false;\r\n      finishedTimers[i]._hasCalledOnStart = false;\r\n      finishedTimers[i]?.onFinish?.();\r\n    }\r\n\r\n    //add newly queued timers\r\n    if (this.newTimers.length > 0) {\r\n      for (i = 0; i < this.newTimers.length; ++i) {\r\n        timer = this.newTimers[i];\r\n        timer._start = currentTime + timer.delay;\r\n        timer._isRunning = true;\r\n        timer._wasStopped = false;\r\n        this.runningTimers.push(timer);\r\n\r\n        if (timer.delay === 0) {\r\n          //play first timer frame directly to keep everything nicely synched\r\n          if (timer.onStart) {\r\n            timer.onStart();\r\n            timer._hasCalledOnStart = true;\r\n          }\r\n          if (timer.onRunning) {\r\n            timer.onRunning(0);\r\n          }\r\n        }\r\n      }\r\n      this.newTimers.length = 0;\r\n    }\r\n  }\r\n\r\n  hasPendingTimers(): boolean {\r\n    return this.runningTimers.length > 0 || this.newTimers.length > 0;\r\n  }\r\n}\r\n","import { GraphModel } from \"./models/graphmodel\";\r\nimport { NodeScope } from \"./nodescope\";\r\n\r\nexport interface Variant {\r\n  name: string;\r\n  typename: string;\r\n  variantName?: string;\r\n  parameters: { [key: string]: any };\r\n  stateParameters: { [key: string]: { [key: string]: any } };\r\n  defaultStateTransitions: { [key: string]: any };\r\n  stateTransitions: { [key: string]: { [key: string]: any } };\r\n}\r\n\r\ninterface ConstructorParams {\r\n  graphModel?: GraphModel;\r\n  getNodeScope: () => NodeScope | null;\r\n}\r\n\r\nexport class Variants {\r\n  private getNodeScope: () => NodeScope | null;\r\n  private graphModel?: GraphModel;\r\n\r\n  constructor({ graphModel, getNodeScope }: ConstructorParams) {\r\n    this.getNodeScope = getNodeScope;\r\n\r\n    if (graphModel) {\r\n      this.graphModel = graphModel;\r\n      graphModel.on(\"variantUpdated\", (variant: Variant) =>\r\n        this.onVariantUpdated(variant)\r\n      );\r\n    }\r\n  }\r\n\r\n  getVariant(typename: string, name: string | undefined): Variant | undefined {\r\n    if (!this.graphModel) return undefined;\r\n    if (!name) return undefined;\r\n\r\n    return this.graphModel.getVariant(typename, name);\r\n  }\r\n\r\n  private onVariantUpdated(variant: Variant): void {\r\n    const nodeScope = this.getNodeScope();\r\n    if (!nodeScope) return;\r\n\r\n    //get all nodes with the type the variant applies to\r\n    const nodes = nodeScope.getNodesWithTypeRecursive(variant.typename);\r\n\r\n    //and filter for the ones using the updated variant\r\n    const nodesWithVariant = nodes.filter((node) => {\r\n      //if a variant has been set during runtime, it'll override the value from the model\r\n      if (typeof node.variant === \"object\")\r\n        return node.variant.name === variant.name;\r\n\r\n      if (typeof node.variant === \"string\")\r\n        return node.variant === variant.name;\r\n\r\n      //otherwise check the model (which always matches the editor)\r\n      return node.model && node.model.variant === variant.name;\r\n    });\r\n\r\n    //and re-apply the variant\r\n    for (const node of nodesWithVariant) {\r\n      node.setVariant(variant);\r\n    }\r\n  }\r\n}\r\n","import type { ComponentModel } from \"./models/componentmodel\";\r\nimport type { NodeModel } from \"./models/nodemodel\";\r\nimport type { NodeContext } from \"./nodecontext\";\r\nimport type { Node } from \"./node\";\r\nimport type { Variant } from \"./variants\";\r\nimport { ComponentInstanceNode } from \"./nodes/componentinstance\";\r\nimport { guid } from \"./utils\";\r\n\r\nexport interface Connection {\r\n  sourceId: string;\r\n  sourcePort: string;\r\n  targetId: string;\r\n  targetPort: string;\r\n}\r\n\r\nexport class NodeScope {\r\n  context: NodeContext;\r\n  nodes: Record<string, Node>;\r\n  componentOwner: any;\r\n  componentInstanceChildren: Record<string, any>;\r\n  componentModel?: ComponentModel;\r\n\r\n  modelScope?: any;\r\n\r\n  constructor(context: NodeContext, componentOwner: any) {\r\n    this.context = context;\r\n    this.nodes = {};\r\n    this.componentOwner = componentOwner; //Component Instance that owns this NodeScope\r\n    this.componentInstanceChildren = {};\r\n  }\r\n\r\n  private verifyData(data: any, requiredKeys: string[]): void {\r\n    requiredKeys.forEach((key) => {\r\n      if (!data[key]) {\r\n        throw new Error(\"Missing \" + key);\r\n      }\r\n    });\r\n  }\r\n\r\n  addConnection(connectionData: Connection): void {\r\n    try {\r\n      this.verifyData(connectionData, [\r\n        \"sourceId\",\r\n        \"sourcePort\",\r\n        \"targetId\",\r\n        \"targetPort\",\r\n      ]);\r\n    } catch (e) {\r\n      // @ts-expect-error\r\n      throw new Error(\"Error in connection: \" + e.message);\r\n    }\r\n\r\n    try {\r\n      const sourceNode = this.getNodeWithId(connectionData.sourceId);\r\n      const targetNode = this.getNodeWithId(connectionData.targetId);\r\n\r\n      targetNode.registerInputIfNeeded(connectionData.targetPort);\r\n      sourceNode.registerOutputIfNeeded(connectionData.sourcePort);\r\n      targetNode.connectInput(\r\n        connectionData.targetPort,\r\n        sourceNode,\r\n        connectionData.sourcePort\r\n      );\r\n    } catch (e) {\r\n      // @ts-expect-error\r\n      console.error(e.message);\r\n    }\r\n  }\r\n\r\n  setNodeParameters(node: any, nodeModel: NodeModel): void {\r\n    const variant = this.context.variants.getVariant(\r\n      nodeModel.type,\r\n      // @ts-expect-error WTF is this codebase?\r\n      nodeModel.variant\r\n    );\r\n\r\n    if (variant) {\r\n      //apply the variant (this will also apply the parameters)\r\n      node.setVariant(variant);\r\n    } else {\r\n      const parameters = nodeModel.parameters || {};\r\n\r\n      let inputNames = Object.keys(parameters);\r\n\r\n      if (this.context.nodeRegister.hasNode(node.name)) {\r\n        const metadata = this.context.nodeRegister.getNodeMetadata(node.name);\r\n        if (metadata.inputs) {\r\n          inputNames.sort((a, b) => {\r\n            const inputA = metadata.inputs![a];\r\n            const inputB = metadata.inputs![b];\r\n            return (inputB?.inputPriority ?? 0) - (inputA?.inputPriority ?? 0);\r\n          });\r\n        }\r\n      }\r\n\r\n      inputNames.forEach((inputName) => {\r\n        node.registerInputIfNeeded(inputName);\r\n\r\n        //protect against obsolete parameters\r\n        if (node.hasInput(inputName) === false) {\r\n          return;\r\n        }\r\n\r\n        node.queueInput(inputName, parameters[inputName]);\r\n      });\r\n    }\r\n  }\r\n\r\n  async createNodeFromModel(\r\n    nodeModel: NodeModel,\r\n    updateOnDirtyFlagging?: boolean\r\n  ): Promise<any> {\r\n    if (nodeModel.type === \"Component Children\") {\r\n      if (nodeModel.parent) {\r\n        const parentInstance = this.getNodeWithId(nodeModel.parent.id);\r\n        this.componentOwner.setChildRoot(parentInstance);\r\n      }\r\n      return;\r\n    }\r\n\r\n    let node;\r\n    try {\r\n      node = await this.createNode(nodeModel.type, nodeModel.id);\r\n      node.updateOnDirtyFlagging =\r\n        updateOnDirtyFlagging === false ? false : true;\r\n      node.setNodeModel(nodeModel);\r\n    } catch (e) {\r\n      // @ts-expect-error\r\n      console.error(e.message);\r\n      if (\r\n        this.context.editorConnection &&\r\n        this.context.isWarningTypeEnabled(\"nodescope\")\r\n      ) {\r\n        this.context.editorConnection.sendWarning(\r\n          this.componentOwner.name,\r\n          nodeModel.id,\r\n          \"nodelibrary-unknown-node\",\r\n          {\r\n            // @ts-expect-error\r\n            message: e.message,\r\n            showGlobally: true,\r\n          }\r\n        );\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (nodeModel.variant && node.setVariant)\r\n      node.setVariant(nodeModel.variant);\r\n    this.setNodeParameters(node, nodeModel);\r\n\r\n    if (nodeModel.parent) {\r\n      this.insertNodeInTree(node, nodeModel);\r\n    }\r\n\r\n    return node;\r\n  }\r\n\r\n  insertNodeInTree(nodeInstance: any, nodeModel: NodeModel): void {\r\n    if (!nodeModel.parent) {\r\n      throw new Error(\"Cannot insert node without parent\");\r\n    }\r\n\r\n    const parentInstance = this.getNodeWithId(nodeModel.parent.id);\r\n    const childIndex = nodeModel.parent.children.indexOf(nodeModel);\r\n\r\n    if (!parentInstance.addChild) {\r\n      throw new Error(\r\n        \"Node \" +\r\n          parentInstance.id +\r\n          \" of type \" +\r\n          parentInstance.constructor.name +\r\n          \" can't have children\"\r\n      );\r\n    }\r\n\r\n    parentInstance.addChild(nodeInstance, childIndex);\r\n  }\r\n\r\n  getNodeWithId(id: string): any {\r\n    if (!this.nodes.hasOwnProperty(id)) {\r\n      throw new Error(\"Unknown node id \" + id);\r\n    }\r\n    return this.nodes[id];\r\n  }\r\n\r\n  hasNodeWithId(id: string): boolean {\r\n    return this.nodes.hasOwnProperty(id);\r\n  }\r\n\r\n  createPrimitiveNode(\r\n    name: string,\r\n    id?: string,\r\n    extraProps?: Record<string, any>\r\n  ): any {\r\n    if (!id) id = guid();\r\n\r\n    if (this.nodes.hasOwnProperty(id)) {\r\n      throw Error(\"duplicate id \" + id);\r\n    }\r\n\r\n    const node = this.context.nodeRegister.createNode(name, id, this);\r\n    if (extraProps) {\r\n      for (const prop in extraProps) {\r\n        node[prop] = extraProps[prop];\r\n      }\r\n    }\r\n\r\n    this.nodes[id] = node;\r\n    return node;\r\n  }\r\n\r\n  async createNode(\r\n    name: string,\r\n    id?: string,\r\n    extraProps?: Record<string, any>\r\n  ): Promise<any> {\r\n    if (!id) id = guid();\r\n\r\n    if (this.nodes.hasOwnProperty(id)) {\r\n      throw Error(\"duplicate id \" + id);\r\n    }\r\n\r\n    let node;\r\n\r\n    if (this.context.nodeRegister.hasNode(name)) {\r\n      node = this.context.nodeRegister.createNode(name, id, this);\r\n      if (extraProps) {\r\n        for (const prop in extraProps) {\r\n          node[prop] = extraProps[prop];\r\n        }\r\n      }\r\n    } else {\r\n      node = await this.context.createComponentInstanceNode(\r\n        name,\r\n        id,\r\n        this,\r\n        extraProps\r\n      );\r\n      this.componentInstanceChildren[id] = node;\r\n    }\r\n\r\n    this.nodes[id] = node;\r\n    return node;\r\n  }\r\n\r\n  getNodesWithIdRecursive(id: string): Node[] {\r\n    function findNodesWithIdRec(\r\n      scope: NodeScope,\r\n      id: string,\r\n      result: Node[]\r\n    ): void {\r\n      if (scope.nodes.hasOwnProperty(id)) {\r\n        result.push(scope.nodes[id]);\r\n      }\r\n\r\n      const componentIds = Object.keys(scope.nodes).filter((nodeId) => {\r\n        return scope.nodes[nodeId] instanceof ComponentInstanceNode;\r\n      });\r\n\r\n      componentIds.forEach((componentId) => {\r\n        const nodeScope = scope.nodes[componentId].nodeScope;\r\n        if (nodeScope) {\r\n          findNodesWithIdRec(nodeScope, id, result);\r\n        }\r\n      });\r\n    }\r\n\r\n    const result: Node[] = [];\r\n    findNodesWithIdRec(this, id, result);\r\n    return result;\r\n  }\r\n\r\n  getNodesWithType(name: string): Node[] {\r\n    const ids = Object.keys(this.nodes).filter((id) => {\r\n      return this.nodes[id].name === name;\r\n    });\r\n    return ids.map((id) => {\r\n      return this.nodes[id];\r\n    });\r\n  }\r\n\r\n  getNodesWithTypeRecursive(name: string): Node[] {\r\n    let result: Node[] = [];\r\n\r\n    const findNodesWithTypeRec = () => {\r\n      result = result.concat(this.getNodesWithType(name));\r\n\r\n      const componentIds = Object.keys(this.nodes).filter((nodeId) => {\r\n        return this.nodes[nodeId] instanceof ComponentInstanceNode;\r\n      });\r\n\r\n      componentIds.forEach((componentId) => {\r\n        const node = this.nodes[componentId];\r\n        if (node && node.nodeScope) {\r\n          const res = node.nodeScope.getNodesWithTypeRecursive(name);\r\n          result = result.concat(res);\r\n        }\r\n      });\r\n    };\r\n\r\n    findNodesWithTypeRec();\r\n    return result;\r\n  }\r\n\r\n  getAllNodesRecursive(): any[] {\r\n    let result: any[] = [];\r\n\r\n    const getAllNodesRec = () => {\r\n      result = result.concat(Object.values(this.nodes));\r\n\r\n      const componentIds = Object.keys(this.nodes).filter((nodeId) => {\r\n        return this.nodes[nodeId] instanceof ComponentInstanceNode;\r\n      });\r\n      componentIds.forEach((componentId) => {\r\n        const node = this.nodes[componentId];\r\n        if (node && node.nodeScope) {\r\n          const res = node.nodeScope.getAllNodesRecursive();\r\n          result = result.concat(res);\r\n        }\r\n      });\r\n    };\r\n\r\n    getAllNodesRec();\r\n    return result;\r\n  }\r\n\r\n  getAllNodesWithVariantRecursive(variant: Variant | string): any[] {\r\n    const nodes = this.getAllNodesRecursive();\r\n    return nodes.filter((node) => node.variant === variant);\r\n  }\r\n\r\n  onNodeModelRemoved(nodeModel: NodeModel): void {\r\n    const nodeInstance = this.getNodeWithId(nodeModel.id);\r\n\r\n    if (nodeModel.parent) {\r\n      const parentInstance = this.getNodeWithId(nodeModel.parent.id);\r\n      parentInstance.removeChild(nodeInstance);\r\n    }\r\n\r\n    nodeInstance._onNodeDeleted();\r\n    delete this.nodes[nodeInstance.id];\r\n    delete this.componentInstanceChildren[nodeInstance.id];\r\n  }\r\n\r\n  removeConnection(connectionModel: Connection): void {\r\n    const targetNode = this.getNodeWithId(connectionModel.targetId);\r\n    targetNode.removeInputConnection(\r\n      connectionModel.targetPort,\r\n      connectionModel.sourceId,\r\n      connectionModel.sourcePort\r\n    );\r\n  }\r\n\r\n  async setComponentModel(componentModel: ComponentModel): Promise<void> {\r\n    this.componentModel = componentModel;\r\n\r\n    const nodes: any[] = [];\r\n\r\n    //create all nodes\r\n    for (const nodeModel of componentModel.getAllNodes()) {\r\n      const node = await this.createNodeFromModel(nodeModel, false);\r\n      if (node) nodes.push(node);\r\n    }\r\n\r\n    componentModel\r\n      .getAllConnections()\r\n      .forEach((conn) => this.addConnection(conn));\r\n\r\n    //now that all nodes and connections are setup, trigger the dirty flagging so nodes can run with all the connections in place\r\n    nodes.forEach((node) => (node.updateOnDirtyFlagging = true));\r\n\r\n    nodes.forEach((node) => {\r\n      if (node._dirty) {\r\n        node._performDirtyUpdate();\r\n      }\r\n    });\r\n\r\n    componentModel.on(\r\n      \"connectionAdded\",\r\n      (conn: Connection) => this.addConnection(conn),\r\n      this\r\n    );\r\n    componentModel.on(\"connectionRemoved\", this.removeConnection, this);\r\n    componentModel.on(\"nodeAdded\", this.createNodeFromModel, this);\r\n\r\n    componentModel.on(\r\n      \"nodeParentWillBeRemoved\",\r\n      (nodeModel: NodeModel) => {\r\n        if (nodeModel.type === \"Component Children\") {\r\n          if (nodeModel.parent) {\r\n            this.componentOwner.setChildRoot(null);\r\n          }\r\n          return;\r\n        }\r\n\r\n        const nodeInstance = this.getNodeWithId(nodeModel.id);\r\n        if (nodeInstance.parent) {\r\n          nodeInstance.parent.removeChild(nodeInstance);\r\n        }\r\n      },\r\n      this\r\n    );\r\n\r\n    componentModel.on(\r\n      \"nodeParentUpdated\",\r\n      (nodeModel: NodeModel) => {\r\n        if (nodeModel.type === \"Component Children\") {\r\n          const parentInstance = nodeModel.parent\r\n            ? this.getNodeWithId(nodeModel.parent.id)\r\n            : null;\r\n          this.componentOwner.setChildRoot(parentInstance);\r\n        } else {\r\n          const nodeInstance = this.getNodeWithId(nodeModel.id);\r\n          this.insertNodeInTree(nodeInstance, nodeModel);\r\n        }\r\n      },\r\n      this\r\n    );\r\n\r\n    componentModel.on(\r\n      \"nodeRemoved\",\r\n      (nodeModel: NodeModel) => {\r\n        if (nodeModel.type !== \"Component Children\") {\r\n          this.onNodeModelRemoved(nodeModel);\r\n        }\r\n      },\r\n      this\r\n    );\r\n\r\n    for (const id in this.nodes) {\r\n      const node = this.nodes[id];\r\n      node?.nodeScopeDidInitialize?.();\r\n    }\r\n  }\r\n\r\n  reset(): void {\r\n    if (this.componentModel) {\r\n      this.componentModel.removeListenersWithRef(this);\r\n      this.componentModel = undefined;\r\n    }\r\n\r\n    Object.keys(this.nodes).forEach((id) => {\r\n      if (this.nodes.hasOwnProperty(id)) {\r\n        this.deleteNode(this.nodes[id]);\r\n      }\r\n    });\r\n  }\r\n\r\n  deleteNode(nodeInstance: any): void {\r\n    if (!this.nodes.hasOwnProperty(nodeInstance.id)) {\r\n      console.error(\r\n        \"Node doesn't belong to this scope\",\r\n        nodeInstance.id,\r\n        nodeInstance.name\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (nodeInstance.parent) {\r\n      nodeInstance.parent.removeChild(nodeInstance);\r\n    }\r\n\r\n    //depth first\r\n    if (nodeInstance.getChildren) {\r\n      nodeInstance.getChildren().forEach((child: any) => {\r\n        nodeInstance.removeChild(child);\r\n        //the child might be created in a different scope\r\n        //if the child is a component instance, we want its parent scope, not the inner scope\r\n        const nodeScope = child.parentNodeScope || child.nodeScope;\r\n        nodeScope.deleteNode(child);\r\n      });\r\n    }\r\n\r\n    if (this.componentModel) {\r\n      const connectionFrom = this.componentModel.getConnectionsFrom(\r\n        nodeInstance.id\r\n      );\r\n      const connectionTo = this.componentModel.getConnectionsTo(\r\n        nodeInstance.id\r\n      );\r\n\r\n      connectionFrom.concat(connectionTo).forEach((connection) => {\r\n        if (\r\n          this.nodes.hasOwnProperty(connection.targetId) &&\r\n          this.nodes.hasOwnProperty(connection.sourceId)\r\n        ) {\r\n          this.removeConnection(connection);\r\n        }\r\n      });\r\n    }\r\n\r\n    nodeInstance._onNodeDeleted();\r\n    delete this.nodes[nodeInstance.id];\r\n    delete this.componentInstanceChildren[nodeInstance.id]; //in case this is a component\r\n  }\r\n\r\n  sendEventFromThisScope(\r\n    eventName: string,\r\n    data: any,\r\n    propagation?: string,\r\n    sendEventInThisScope?: boolean\r\n  ): boolean {\r\n    if (sendEventInThisScope) {\r\n      const eventReceivers = this.getNodesWithType(\"Event Receiver\").filter(\r\n        (eventReceiver) => {\r\n          // @ts-expect-error TODO: fix this\r\n          return eventReceiver.getChannelName() === eventName;\r\n        }\r\n      );\r\n\r\n      for (let i = 0; i < eventReceivers.length; i++) {\r\n        // @ts-expect-error TODO: fix this\r\n        const consumed = eventReceivers[i].handleEvent(data);\r\n        if (consumed) return true;\r\n      }\r\n    }\r\n\r\n    if (propagation === \"parent\" && this.componentOwner.parentNodeScope) {\r\n      // Send event to parent scope\r\n      //either the scope of the visual parent if there is one, otherwise the parent component\r\n      const parentNodeScope = this.componentOwner.parent\r\n        ? this.componentOwner.parent.nodeScope\r\n        : this.componentOwner.parentNodeScope;\r\n      if (!parentNodeScope) return false;\r\n      return parentNodeScope.sendEventFromThisScope(\r\n        eventName,\r\n        data,\r\n        propagation,\r\n        true\r\n      );\r\n    } else if (propagation === \"children\") {\r\n      // Send event to all child scopes\r\n      const nodes = this.nodes;\r\n      for (const nodeId in nodes) {\r\n        const children = nodes[nodeId].children;\r\n        if (children)\r\n          for (const child of children) {\r\n            if (\r\n              child.name &&\r\n              this.context.hasComponentModelWithName(child.name)\r\n            ) {\r\n              // This is a component instance child\r\n              const consumed = child.nodeScope?.sendEventFromThisScope(\r\n                eventName,\r\n                data,\r\n                propagation,\r\n                true\r\n              );\r\n              if (consumed) return true;\r\n            }\r\n          }\r\n      }\r\n    } else if (propagation === \"siblings\") {\r\n      // Send event to all siblings, that is all children of the parent scope except this scope\r\n      let parentNodeScope: NodeScope | undefined;\r\n      if (this.componentOwner.parent) {\r\n        parentNodeScope = this.componentOwner.parent.nodeScope;\r\n      } else {\r\n        parentNodeScope = this.componentOwner.parentNodeScope;\r\n      }\r\n\r\n      if (!parentNodeScope) return false;\r\n\r\n      const nodes = parentNodeScope.nodes;\r\n      for (const nodeId in nodes) {\r\n        const children = nodes[nodeId].children;\r\n        if (children) {\r\n          const _c = children.filter(\r\n            (child) =>\r\n              child.name &&\r\n              this.context.hasComponentModelWithName(child.name) &&\r\n              child.nodeScope !== this\r\n          );\r\n          for (const child of _c) {\r\n            const consumed = child.nodeScope?.sendEventFromThisScope(\r\n              eventName,\r\n              data,\r\n              undefined,\r\n              true\r\n            );\r\n            if (consumed) return true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n}\r\n","import type { ComponentModel } from \"../models/componentmodel\";\r\nimport { Node } from \"../node\";\r\nimport { NodeScope } from \"../nodescope\";\r\n\r\nlet componentIdCounter = 0;\r\n\r\ninterface Internal {\r\n  childRoot: any;\r\n  componentOutputValues: Record<string, any>;\r\n  componentOutputs: any[];\r\n  componentInputs: any[];\r\n  inputValues: Record<string, any>;\r\n  roots: any[];\r\n  instanceId: string;\r\n  creatorCallbacks?: {\r\n    onOutputChanged?: (name: string, value: any, prevValue: any) => void;\r\n  };\r\n}\r\n\r\nexport class ComponentInstanceNode extends Node<Internal> {\r\n  nodeScope: NodeScope;\r\n  parentNodeScope: NodeScope | null;\r\n  _internal: Internal;\r\n  componentModel?: ComponentModel;\r\n  parent?: any;\r\n  cachedChildren?: any;\r\n\r\n  constructor(context: any, id: string, parentNodeScope: NodeScope | null) {\r\n    super(context, id);\r\n\r\n    this.nodeScope = new NodeScope(context, this);\r\n    this.parentNodeScope = parentNodeScope;\r\n    this._internal = {\r\n      childRoot: null,\r\n      componentOutputValues: {},\r\n      componentOutputs: [],\r\n      componentInputs: [],\r\n      inputValues: {},\r\n      roots: [],\r\n      instanceId: \"__$ndl_componentInstaceId\" + componentIdCounter,\r\n    };\r\n\r\n    this.nodeScope.modelScope = parentNodeScope\r\n      ? parentNodeScope.modelScope\r\n      : undefined;\r\n\r\n    componentIdCounter++;\r\n  }\r\n\r\n  async setComponentModel(componentModel: ComponentModel) {\r\n    this.componentModel = componentModel;\r\n    const self = this;\r\n\r\n    await this.nodeScope.setComponentModel(componentModel);\r\n\r\n    this._internal.componentInputs =\r\n      this.nodeScope.getNodesWithType(\"Component Inputs\");\r\n    this._internal.componentOutputs =\r\n      this.nodeScope.getNodesWithType(\"Component Outputs\");\r\n\r\n    Object.values(componentModel.getInputPorts()).forEach(\r\n      this.registerComponentInputPort.bind(this)\r\n    );\r\n    Object.values(componentModel.getOutputPorts()).forEach(\r\n      this.registerComponentOutputPort.bind(this)\r\n    );\r\n\r\n    const roots = componentModel.roots || [];\r\n    this._internal.roots = roots.map((id: string) =>\r\n      this.nodeScope.getNodeWithId(id)\r\n    );\r\n\r\n    componentModel.on(\r\n      \"rootAdded\",\r\n      (id: string) => {\r\n        this._internal.roots.push(this.nodeScope.getNodeWithId(id));\r\n        this.forceUpdate();\r\n      },\r\n      this\r\n    );\r\n\r\n    componentModel.on(\r\n      \"rootRemoved\",\r\n      function (this: ComponentInstanceNode, id: string) {\r\n        const index = this._internal.roots.findIndex(\r\n          (root: any) => root.id === id\r\n        );\r\n        if (index !== -1) {\r\n          this._internal.roots.splice(index, 1);\r\n        }\r\n        this.forceUpdate();\r\n      },\r\n      this\r\n    );\r\n\r\n    componentModel.on(\r\n      \"inputPortAdded\",\r\n      this.registerComponentInputPort.bind(this),\r\n      this\r\n    );\r\n    componentModel.on(\r\n      \"outputPortAdded\",\r\n      this.registerComponentOutputPort.bind(this),\r\n      this\r\n    );\r\n\r\n    componentModel.on(\r\n      \"inputPortRemoved\",\r\n      function (port: { name: string }) {\r\n        if (self.hasInput(port.name)) {\r\n          self.deregisterInput(port.name);\r\n        }\r\n      },\r\n      this\r\n    );\r\n\r\n    componentModel.on(\r\n      \"outputPortRemoved\",\r\n      function (this: ComponentInstanceNode, port: { name: string }) {\r\n        if (this.hasOutput(port.name)) {\r\n          self.deregisterOutput(port.name);\r\n        }\r\n      },\r\n      this\r\n    );\r\n\r\n    componentModel.on(\r\n      \"nodeAdded\",\r\n      function (node: { type: string; id: string }) {\r\n        if (node.type === \"Component Inputs\") {\r\n          self._internal.componentInputs.push(\r\n            self.nodeScope.getNodeWithId(node.id)\r\n          );\r\n        } else if (node.type === \"Component Outputs\") {\r\n          self._internal.componentOutputs.push(\r\n            self.nodeScope.getNodeWithId(node.id)\r\n          );\r\n        }\r\n      },\r\n      this\r\n    );\r\n\r\n    componentModel.on(\r\n      \"nodeRemoved\",\r\n      function (node: { type: string; id: string }) {\r\n        function removeNodesWithId(array: any[], id: string) {\r\n          return array.filter((e) => e.id !== id);\r\n        }\r\n        if (node.type === \"Component Inputs\") {\r\n          self._internal.componentInputs = removeNodesWithId(\r\n            self._internal.componentInputs,\r\n            node.id\r\n          );\r\n        } else if (node.type === \"Component Outputs\") {\r\n          self._internal.componentOutputs = removeNodesWithId(\r\n            self._internal.componentOutputs,\r\n            node.id\r\n          );\r\n        }\r\n      },\r\n      this\r\n    );\r\n\r\n    componentModel.on(\r\n      \"renamed\",\r\n      function (event: { newName: string }) {\r\n        self.name = event.newName;\r\n      },\r\n      this\r\n    );\r\n  }\r\n\r\n  _onNodeDeleted() {\r\n    if (this.componentModel) {\r\n      this.componentModel.removeListenersWithRef(this);\r\n      this.componentModel = undefined;\r\n    }\r\n\r\n    this.nodeScope.reset();\r\n    super._onNodeDeleted();\r\n  }\r\n\r\n  registerComponentInputPort(port: { name: string }) {\r\n    this.registerInput(port.name, {\r\n      set: function (this: ComponentInstanceNode, value: any) {\r\n        this._internal.inputValues[port.name] = value;\r\n        this._internal.componentInputs.forEach(function (componentInput) {\r\n          componentInput.registerOutputIfNeeded(port.name);\r\n          componentInput.flagOutputDirty(port.name);\r\n        });\r\n      },\r\n    });\r\n  }\r\n\r\n  registerComponentOutputPort(port: { name: string }) {\r\n    this.registerOutput(port.name, {\r\n      getter() {\r\n        return this._internal.componentOutputValues[port.name];\r\n      },\r\n    });\r\n  }\r\n\r\n  setOutputFromComponentOutput(name: string, value: any) {\r\n    if (this.hasOutput(name) === false) {\r\n      return;\r\n    }\r\n\r\n    this._internal.creatorCallbacks?.onOutputChanged?.(\r\n      name,\r\n      value,\r\n      this._internal.componentOutputValues[name]\r\n    );\r\n\r\n    this._internal.componentOutputValues[name] = value;\r\n    this.flagOutputDirty(name);\r\n  }\r\n\r\n  setChildRoot(node: any) {\r\n    const prevChildRoot = this._internal.childRoot;\r\n    const newChildRoot = node;\r\n\r\n    this._internal.childRoot = newChildRoot;\r\n\r\n    if (this.model && this.model.children) {\r\n      const parentNodeScope = this.parentNodeScope;\r\n\r\n      const children = this.model.children\r\n        .filter((child) => child.type !== \"Component Children\")\r\n        .map((child) => parentNodeScope?.getNodeWithId(child.id));\r\n\r\n      if (prevChildRoot) {\r\n        for (let i = 0; i < children.length; i++) {\r\n          if (prevChildRoot.isChild(children[i])) {\r\n            prevChildRoot.removeChild(children[i]);\r\n          }\r\n        }\r\n      }\r\n\r\n      if (newChildRoot) {\r\n        for (let i = 0; i < children.length; i++) {\r\n          const child = children[i];\r\n          const index = child.model.parent.children.indexOf(child.model);\r\n          this.addChild(child, index);\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  getChildRootIndex(): number {\r\n    if (!this._internal.childRoot?.model?.children) {\r\n      return 0;\r\n    }\r\n\r\n    const children = this._internal.childRoot.model.children;\r\n\r\n    for (let i = 0; i < children.length; i++) {\r\n      if (children[i].type === \"Component Children\") {\r\n        return i;\r\n      }\r\n    }\r\n\r\n    return 0;\r\n  }\r\n\r\n  getChildRoot() {\r\n    if (this._internal.childRoot) {\r\n      return this._internal.childRoot;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  getRoots() {\r\n    return this._internal.roots;\r\n  }\r\n\r\n  /** Added for SSR Support */\r\n  triggerDidMount() {\r\n    this._internal.roots.forEach((root) => {\r\n      root.triggerDidMount?.();\r\n    });\r\n  }\r\n\r\n  render() {\r\n    if (this._internal.roots.length === 0) {\r\n      return null;\r\n    }\r\n\r\n    return this._internal.roots[0].render();\r\n  }\r\n\r\n  setChildIndex(childIndex: number) {\r\n    // NOTE: setChildIndex can be undefined when it is not a React node,\r\n    //       but still a visual node like the foreach (Repeater) node.\r\n    this.getRoots().forEach((root) => root.setChildIndex?.(childIndex));\r\n  }\r\n\r\n  addChild(child: any, index: number) {\r\n    this.getChildRoot().addChild(child, index + this.getChildRootIndex());\r\n  }\r\n\r\n  removeChild(child: any) {\r\n    this.getChildRoot().removeChild(child);\r\n  }\r\n\r\n  getChildren() {\r\n    const childRoot = this.getChildRoot();\r\n    return childRoot ? childRoot.getChildren() : [];\r\n  }\r\n\r\n  isChild(child: any) {\r\n    if (!this.getChildRoot()) {\r\n      return false;\r\n    }\r\n\r\n    return this.getChildRoot().isChild(child);\r\n  }\r\n\r\n  contains(node: any) {\r\n    return this.getRoots().some((root) => root.contains?.(node));\r\n  }\r\n\r\n  _performDirtyUpdate() {\r\n    super._performDirtyUpdate();\r\n\r\n    const componentInputs = this._internal.componentInputs;\r\n    for (let i = 0, len = componentInputs.length; i < len; i++) {\r\n      componentInputs[i].flagDirty();\r\n    }\r\n\r\n    this._internal.componentOutputs.forEach(function (componentOutput) {\r\n      componentOutput.flagDirty();\r\n    });\r\n  }\r\n\r\n  getRef() {\r\n    const root = this._internal.roots[0];\r\n    return root ? root.getRef() : undefined;\r\n  }\r\n\r\n  update() {\r\n    super.update();\r\n\r\n    this._internal.componentOutputs.forEach(function (componentOutput) {\r\n      componentOutput.update();\r\n    });\r\n  }\r\n\r\n  forceUpdate() {\r\n    if (!this.parent) return;\r\n\r\n    //the parent will need to re-render the roots of this component instance\r\n    //TODO: make this use a cleaner API, and only invalidate the affected child, instead of all children\r\n    this.parent.cachedChildren = undefined;\r\n    this.parent.forceUpdate();\r\n  }\r\n\r\n  getInstanceId() {\r\n    return this._internal.instanceId;\r\n  }\r\n}\r\n","import { EventEmitter } from \"eventemitter3\";\r\nimport { NodeRegister } from \"./noderegister\";\r\nimport { TimerScheduler } from \"./timerscheduler\";\r\nimport { Variants } from \"./variants\";\r\nimport { ComponentInstanceNode } from \"./nodes/componentinstance\";\r\nimport {\r\n  ConnectionPulse,\r\n  EditorConnection,\r\n  Platform,\r\n} from \"./editorconnection\";\r\nimport { NodeScope } from \"./nodescope\";\r\nimport { ComponentModel } from \"./models/componentmodel\";\r\nimport { Node } from \"./node\";\r\nimport { GraphModel } from \"./models/graphmodel\";\r\n\r\ninterface NodeContextArgs {\r\n  runningInEditor?: boolean;\r\n  graphModel?: any;\r\n  platform?: any;\r\n  editorConnection?: any;\r\n}\r\n\r\ninterface DebugInspector {\r\n  type: \"connection\" | \"node\";\r\n  id: string;\r\n  connection?: {\r\n    fromId: string;\r\n    fromProperty: string;\r\n  };\r\n  nodeId?: string;\r\n}\r\n\r\ninterface OutputHistory {\r\n  value: any;\r\n  timestamp: number;\r\n}\r\n\r\ninterface SignalHistory {\r\n  count: number;\r\n}\r\n\r\ninterface PopupCallbacks {\r\n  onShow: (group: any) => void;\r\n  onClose: (group: any) => void;\r\n}\r\n\r\ninterface PopupArgs {\r\n  senderNode?: any; // TODO: Is this Node?\r\n  onClosePopup?: (\r\n    action: string | undefined,\r\n    results: Record<string, any>\r\n  ) => void;\r\n}\r\n\r\nexport class NodeContext {\r\n  private _dirtyNodes: Node[];\r\n  private callbacksAfterUpdate: Function[];\r\n  private graphModel: GraphModel;\r\n  private platform: Platform;\r\n\r\n  eventEmitter: EventEmitter;\r\n  eventSenderEmitter: EventEmitter;\r\n  globalsEventEmitter: EventEmitter;\r\n\r\n  private globalValues: Record<string, any>;\r\n  private runningInEditor: boolean;\r\n  currentFrameTime: number;\r\n  private frameNumber: number;\r\n  public updateIteration: number;\r\n  nodeRegister: NodeRegister;\r\n  timerScheduler: TimerScheduler;\r\n  private componentModels: Record<string, ComponentModel>;\r\n  private debugInspectorsEnabled: boolean;\r\n  private connectionsToPulse: Record<string, ConnectionPulse>;\r\n  private connectionsToPulseChanged: boolean;\r\n  private debugInspectors: Record<string, DebugInspector>;\r\n  private connectionPulsingCallbackScheduled: boolean;\r\n  rootComponent: ComponentInstanceNode | undefined;\r\n  private _outputHistory: Record<string, OutputHistory>;\r\n  private _signalHistory: Record<string, SignalHistory>;\r\n  private warningTypes: Record<string, boolean>;\r\n  private bundleFetchesInFlight: Map<string, Promise<void>>;\r\n  variants: Variants;\r\n  private isUpdating: boolean = false;\r\n  private onShowPopup?: (group: any) => void;\r\n  private onClosePopup?: (group: any) => void;\r\n\r\n  public editorConnection?: EditorConnection;\r\n\r\n  public styles?: {\r\n    resolveColor: (color: any) => any;\r\n  };\r\n\r\n  constructor(args: NodeContextArgs = {}) {\r\n    const runningInEditor = args.hasOwnProperty(\"runningInEditor\")\r\n      ? args.runningInEditor\r\n      : false;\r\n\r\n    this._dirtyNodes = [];\r\n    this.callbacksAfterUpdate = [];\r\n\r\n    this.graphModel = args.graphModel;\r\n    this.platform = args.platform;\r\n\r\n    this.eventEmitter = new EventEmitter();\r\n    // this.eventEmitter.setMaxListeners(1000000);\r\n\r\n    this.eventSenderEmitter = new EventEmitter(); //used by event senders and receivers\r\n    // this.eventSenderEmitter.setMaxListeners(1000000);\r\n\r\n    this.globalValues = {};\r\n    this.globalsEventEmitter = new EventEmitter();\r\n    // this.globalsEventEmitter.setMaxListeners(1000000);\r\n\r\n    this.runningInEditor = !!runningInEditor;\r\n    this.currentFrameTime = 0;\r\n    this.frameNumber = 0;\r\n    this.updateIteration = 0;\r\n\r\n    this.nodeRegister = new NodeRegister(this);\r\n    this.timerScheduler = new TimerScheduler(this.scheduleUpdate.bind(this));\r\n\r\n    this.componentModels = {};\r\n    this.debugInspectorsEnabled = false;\r\n    this.connectionsToPulse = {};\r\n    this.connectionsToPulseChanged = false;\r\n\r\n    this.debugInspectors = {};\r\n\r\n    this.connectionPulsingCallbackScheduled = false;\r\n\r\n    this.editorConnection = args.editorConnection;\r\n\r\n    this.rootComponent = undefined;\r\n\r\n    this._outputHistory = {};\r\n    this._signalHistory = {};\r\n\r\n    this.warningTypes = {}; //default is to send all warning types\r\n\r\n    this.bundleFetchesInFlight = new Map();\r\n\r\n    this.variants = new Variants({\r\n      graphModel: this.graphModel,\r\n      getNodeScope: () =>\r\n        this.rootComponent ? this.rootComponent.nodeScope : null,\r\n    });\r\n\r\n    if (this.editorConnection) {\r\n      this.editorConnection.on(\r\n        \"debugInspectorsUpdated\",\r\n        (inspectors: DebugInspector[]) => {\r\n          this.onDebugInspectorsUpdated(inspectors);\r\n        }\r\n      );\r\n\r\n      this.editorConnection?.on(\r\n        \"getConnectionValue\",\r\n        ({\r\n          clientId,\r\n          connectionId,\r\n        }: {\r\n          clientId: string;\r\n          connectionId: string;\r\n        }) => {\r\n          if (this.editorConnection?.clientId !== clientId) return;\r\n          const connection = this._outputHistory[connectionId];\r\n          this.editorConnection?.sendConnectionValue(\r\n            connectionId,\r\n            connection ? connection.value : undefined\r\n          );\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  setRootComponent(rootComponent: any): void {\r\n    this.rootComponent = rootComponent;\r\n  }\r\n\r\n  getCurrentTime(): number {\r\n    return this.platform.getCurrentTime();\r\n  }\r\n\r\n  onDebugInspectorsUpdated(inspectors: DebugInspector[]): void {\r\n    if (!this.debugInspectorsEnabled) return;\r\n\r\n    inspectors = inspectors.map((inspector) => {\r\n      if (inspector.type === \"connection\" && inspector.connection) {\r\n        const connection = inspector.connection;\r\n        inspector.id = connection.fromId + connection.fromProperty;\r\n      } else if (inspector.type === \"node\" && inspector.nodeId) {\r\n        inspector.id = inspector.nodeId;\r\n      }\r\n      return inspector;\r\n    });\r\n\r\n    this.debugInspectors = {};\r\n    inspectors.forEach(\r\n      (inspector) => (this.debugInspectors[inspector.id] = inspector)\r\n    );\r\n\r\n    this.sendDebugInspectorValues();\r\n  }\r\n\r\n  updateDirtyNodes(): void {\r\n    let i: number, len: number;\r\n\r\n    let loop = true;\r\n    let iterations = 0;\r\n\r\n    this.updateIteration++;\r\n\r\n    this.isUpdating = true;\r\n\r\n    while (loop && iterations < 10) {\r\n      const dirtyNodes = this._dirtyNodes;\r\n      this._dirtyNodes = [];\r\n      for (i = 0, len = dirtyNodes.length; i < len; ++i) {\r\n        try {\r\n          if (!dirtyNodes[i]._deleted) {\r\n            dirtyNodes[i].update();\r\n          }\r\n        } catch (e) {\r\n          console.error(e);\r\n        }\r\n      }\r\n\r\n      //make a new reference and reset array in case new callbacks are scheduled\r\n      //by the current callbacks\r\n      const callbacks = this.callbacksAfterUpdate;\r\n      this.callbacksAfterUpdate = [];\r\n      for (i = 0, len = callbacks.length; i < len; i++) {\r\n        try {\r\n          callbacks[i]();\r\n        } catch (e) {\r\n          console.error(e);\r\n        }\r\n      }\r\n\r\n      loop =\r\n        this.callbacksAfterUpdate.length > 0 || this._dirtyNodes.length > 0;\r\n      iterations++;\r\n    }\r\n\r\n    this.isUpdating = false;\r\n  }\r\n\r\n  update(): void {\r\n    this.frameNumber++;\r\n\r\n    this.updateDirtyNodes();\r\n\r\n    if (this.timerScheduler.hasPendingTimers()) {\r\n      this.scheduleUpdate();\r\n      this.timerScheduler.runTimers(this.currentFrameTime);\r\n    }\r\n\r\n    if (this.debugInspectorsEnabled) {\r\n      this.sendDebugInspectorValues();\r\n    }\r\n  }\r\n\r\n  reset(): void {\r\n    //removes listeners like device orientation, websockets and more\r\n    this.eventEmitter.emit(\"applicationDataReloaded\");\r\n\r\n    const eventEmitter = this.eventEmitter;\r\n    [\"frameStart\", \"frameEnd\"].forEach(function (name) {\r\n      eventEmitter.removeAllListeners(name);\r\n    });\r\n\r\n    this.globalValues = {};\r\n    this._dirtyNodes.length = 0;\r\n    this.callbacksAfterUpdate.length = 0;\r\n\r\n    this.timerScheduler.runningTimers = [];\r\n    this.timerScheduler.newTimers = [];\r\n    this.rootComponent = undefined;\r\n\r\n    this.clearDebugInspectors();\r\n  }\r\n\r\n  nodeIsDirty(node: Node): void {\r\n    this._dirtyNodes.push(node);\r\n    this.scheduleUpdate();\r\n  }\r\n\r\n  scheduleUpdate(): void {\r\n    this.eventEmitter.emit(\"scheduleUpdate\");\r\n  }\r\n\r\n  scheduleAfterUpdate(fn: Parameters<EventEmitter[\"on\"]>[1]): void {\r\n    this.callbacksAfterUpdate.push(fn);\r\n    this.scheduleUpdate();\r\n  }\r\n\r\n  scheduleNextFrame(fn: Parameters<EventEmitter[\"once\"]>[1]): void {\r\n    this.eventEmitter.once(\"frameStart\", fn);\r\n    this.scheduleUpdate();\r\n  }\r\n\r\n  setGlobalValue(name: string, value: any): void {\r\n    this.globalValues[name] = value;\r\n    this.globalsEventEmitter.emit(name);\r\n  }\r\n\r\n  getGlobalValue(name: string): any {\r\n    return this.globalValues[name];\r\n  }\r\n\r\n  registerComponentModel(componentModel: ComponentModel): void {\r\n    if (this.componentModels.hasOwnProperty(componentModel.name)) {\r\n      throw new Error(\"Duplicate component name \" + componentModel.name);\r\n    }\r\n    this.componentModels[componentModel.name] = componentModel;\r\n\r\n    componentModel.on(\r\n      \"renamed\",\r\n      (event: { oldName: string; newName: string }) => {\r\n        delete this.componentModels[event.oldName];\r\n        this.componentModels[event.newName] = componentModel;\r\n      },\r\n      this\r\n    );\r\n  }\r\n\r\n  deregisterComponentModel(componentModel: ComponentModel): void {\r\n    if (this.componentModels.hasOwnProperty(componentModel.name)) {\r\n      this.componentModels[componentModel.name].removeListenersWithRef(this);\r\n      delete this.componentModels[componentModel.name];\r\n    }\r\n  }\r\n\r\n  async fetchComponentBundle(name: string): Promise<void> {\r\n    const fetchBundle = async (name: string) => {\r\n      const baseUrl = (window as any).Noodl.Env[\"BaseUrl\"] || \"/\";\r\n      const bundleUrl = `${baseUrl}noodl_bundles/${name}.json`;\r\n\r\n      const response = await fetch(bundleUrl);\r\n      if (response.status === 404) {\r\n        throw new Error(\"Component not found \" + name);\r\n      }\r\n\r\n      const data = await response.json();\r\n      for (const component of data) {\r\n        if (this.graphModel.hasComponentWithName(component.name) === false) {\r\n          await this.graphModel.importComponentFromEditorData(component);\r\n        }\r\n      }\r\n    };\r\n\r\n    if (this.bundleFetchesInFlight.has(name)) {\r\n      await this.bundleFetchesInFlight.get(name);\r\n    } else {\r\n      const promise = fetchBundle(name);\r\n      this.bundleFetchesInFlight.set(name, promise);\r\n      await promise;\r\n    }\r\n  }\r\n\r\n  async getComponentModel(name: string): Promise<any> {\r\n    if (!name) {\r\n      throw new Error(\"Component instance must have a name\");\r\n    }\r\n\r\n    if (this.componentModels.hasOwnProperty(name) === false) {\r\n      const bundleName = this.graphModel.getBundleContainingComponent(name);\r\n      if (!bundleName) {\r\n        throw new Error(\"Can't find component model for \" + name);\r\n      }\r\n\r\n      //start fetching dependencies in the background\r\n      for (const bundleDep of this.graphModel.getBundleDependencies(\r\n        bundleName\r\n      )) {\r\n        this.fetchComponentBundle(bundleDep);\r\n      }\r\n\r\n      //and wait for the bundle that has the component we need\r\n      await this.fetchComponentBundle(bundleName);\r\n    }\r\n\r\n    return this.componentModels[name];\r\n  }\r\n\r\n  hasComponentModelWithName(name: string): boolean {\r\n    return this.componentModels.hasOwnProperty(name);\r\n  }\r\n\r\n  async createComponentInstanceNode(\r\n    componentName: string,\r\n    id: string,\r\n    nodeScope: NodeScope | null,\r\n    extraProps?: Record<string, any>\r\n  ): Promise<any> {\r\n    const node = new ComponentInstanceNode(this, id, nodeScope);\r\n    node.name = componentName;\r\n\r\n    if (extraProps) {\r\n      for (const prop in extraProps) {\r\n        node[prop] = extraProps[prop];\r\n      }\r\n    }\r\n\r\n    const componentModel = await this.getComponentModel(componentName);\r\n    await node.setComponentModel(componentModel);\r\n\r\n    return node;\r\n  }\r\n\r\n  _formatConnectionValue(value: any): any {\r\n    if (\r\n      typeof value === \"object\" &&\r\n      value &&\r\n      value.constructor &&\r\n      value.constructor.name === \"Node\"\r\n    ) {\r\n      value = \"<Node> \" + value.name;\r\n    } else if (\r\n      typeof value === \"object\" &&\r\n      typeof window !== \"undefined\" &&\r\n      value instanceof HTMLElement\r\n    ) {\r\n      value = `DOM Node <${value.tagName}>`;\r\n    } else if (typeof value === \"string\" && !value.startsWith(\"[Signal]\")) {\r\n      return '\"' + value + '\"';\r\n    } else if (Number.isNaN(value)) {\r\n      return \"NaN\";\r\n    }\r\n\r\n    return value;\r\n  }\r\n\r\n  connectionSentValue(output: any, value: any): void {\r\n    if (\r\n      !this.editorConnection ||\r\n      !this.editorConnection.isConnected() ||\r\n      !this.debugInspectorsEnabled\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    const timestamp = this.getCurrentTime();\r\n\r\n    this._outputHistory[output.id] = {\r\n      value,\r\n      timestamp,\r\n    };\r\n\r\n    if (this.connectionsToPulse.hasOwnProperty(output.id)) {\r\n      this.connectionsToPulse[output.id].timestamp = timestamp;\r\n      return;\r\n    }\r\n\r\n    const connections: string[] = [];\r\n\r\n    output.connections.forEach((connection: any) => {\r\n      connections.push(\r\n        output.owner.id +\r\n          output.name +\r\n          connection.node.id +\r\n          connection.inputPortName\r\n      );\r\n    });\r\n\r\n    this.connectionsToPulse[output.id] = {\r\n      timestamp,\r\n      connections,\r\n    };\r\n\r\n    this.connectionsToPulseChanged = true;\r\n\r\n    if (this.connectionPulsingCallbackScheduled === false) {\r\n      this.connectionPulsingCallbackScheduled = true;\r\n      setTimeout(this.clearOldConnectionPulsing.bind(this), 100);\r\n    }\r\n  }\r\n\r\n  connectionSentSignal(output: any): void {\r\n    const id = output.id;\r\n    if (!this._signalHistory.hasOwnProperty(id)) {\r\n      this._signalHistory[id] = {\r\n        count: 0,\r\n      };\r\n    }\r\n\r\n    this._signalHistory[id].count++;\r\n\r\n    this.connectionSentValue(\r\n      output,\r\n      \"[Signal] Trigger count \" + this._signalHistory[id].count\r\n    );\r\n  }\r\n\r\n  clearDebugInspectors(): void {\r\n    this.debugInspectors = {};\r\n    this.connectionsToPulse = {};\r\n\r\n    this.editorConnection?.sendPulsingConnections(this.connectionsToPulse);\r\n  }\r\n\r\n  clearOldConnectionPulsing(): void {\r\n    this.connectionPulsingCallbackScheduled = false;\r\n\r\n    const now = this.getCurrentTime();\r\n\r\n    const connectionIds = Object.keys(this.connectionsToPulse);\r\n    connectionIds.forEach((id) => {\r\n      const con = this.connectionsToPulse[id];\r\n      if (now - con.timestamp > 100) {\r\n        this.connectionsToPulseChanged = true;\r\n        delete this.connectionsToPulse[id];\r\n      }\r\n    });\r\n\r\n    if (this.connectionsToPulseChanged) {\r\n      this.connectionsToPulseChanged = false;\r\n      this.editorConnection?.sendPulsingConnections(this.connectionsToPulse);\r\n    }\r\n\r\n    if (Object.keys(this.connectionsToPulse).length > 0) {\r\n      this.connectionPulsingCallbackScheduled = true;\r\n      setTimeout(this.clearOldConnectionPulsing.bind(this), 500);\r\n    }\r\n  }\r\n\r\n  _getDebugInspectorValueForNode(\r\n    id: string\r\n  ): { type: \"node\"; id: string; value: any } | undefined {\r\n    if (!this.rootComponent) return;\r\n    const nodes = this.rootComponent.nodeScope.getNodesWithIdRecursive(id);\r\n    const node = nodes[nodes.length - 1];\r\n\r\n    if (node && node.getInspectInfo) {\r\n      const info = node.getInspectInfo();\r\n      if (info !== undefined) {\r\n        return { type: \"node\", id, value: info };\r\n      }\r\n    }\r\n  }\r\n\r\n  sendDebugInspectorValues(): void {\r\n    const valuesToSend: Array<{ type: string; id: string; value: any }> = [];\r\n\r\n    for (const id in this.debugInspectors) {\r\n      const inspector = this.debugInspectors[id];\r\n\r\n      if (\r\n        inspector.type === \"connection\" &&\r\n        this._outputHistory.hasOwnProperty(id)\r\n      ) {\r\n        const value = this._outputHistory[id].value;\r\n\r\n        valuesToSend.push({\r\n          type: \"connection\",\r\n          id,\r\n          value: this._formatConnectionValue(value),\r\n        });\r\n      } else if (inspector.type === \"node\") {\r\n        const inspectorValue = this._getDebugInspectorValueForNode(id);\r\n        inspectorValue && valuesToSend.push(inspectorValue);\r\n      }\r\n    }\r\n\r\n    if (valuesToSend.length > 0) {\r\n      this.editorConnection?.sendDebugInspectorValues(valuesToSend);\r\n    }\r\n\r\n    if (this.connectionsToPulseChanged) {\r\n      this.connectionsToPulseChanged = false;\r\n      this.editorConnection?.sendPulsingConnections(this.connectionsToPulse);\r\n    }\r\n  }\r\n\r\n  setDebugInspectorsEnabled(enabled: boolean): void {\r\n    this.debugInspectorsEnabled = enabled;\r\n    if (this.editorConnection) {\r\n      // TODO: this.editorConnection.sendDebugInspectorsEnabled(enabled);\r\n    }\r\n    if (enabled) {\r\n      this.sendDebugInspectorValues();\r\n    }\r\n  }\r\n\r\n  sendGlobalEventFromEventSender(\r\n    channelName: string,\r\n    inputValues: Record<string, any>\r\n  ): void {\r\n    this.eventSenderEmitter.emit(channelName, inputValues);\r\n  }\r\n\r\n  setPopupCallbacks(callbacks: PopupCallbacks): void {\r\n    this.onShowPopup = callbacks.onShow;\r\n    this.onClosePopup = callbacks.onClose;\r\n  }\r\n\r\n  async showPopup(\r\n    popupComponent: string,\r\n    params: Record<string, any>,\r\n    args?: PopupArgs\r\n  ): Promise<void> {\r\n    if (!this.onShowPopup) return;\r\n\r\n    const nodeScope = this.rootComponent!.nodeScope;\r\n\r\n    const popupNode = await nodeScope.createNode(popupComponent);\r\n    for (const inputKey in params) {\r\n      popupNode.setInputValue(inputKey, params[inputKey]);\r\n    }\r\n\r\n    popupNode.popupParent = args?.senderNode || null;\r\n\r\n    // Create container group\r\n    const group = nodeScope.createPrimitiveNode(\"Group\");\r\n    group.setInputValue(\"flexDirection\", \"node\");\r\n    group.setInputValue(\"cssClassName\", \"noodl-popup\");\r\n\r\n    const bodyScroll = this.graphModel.getSettings().bodyScroll;\r\n\r\n    //if the body can scroll the position of the popup needs to be fixed.\r\n    group.setInputValue(\"position\", bodyScroll ? \"fixed\" : \"absolute\");\r\n\r\n    const closePopupNodes = popupNode.nodeScope.getNodesWithType(\r\n      \"NavigationClosePopup\"\r\n    );\r\n    if (closePopupNodes && closePopupNodes.length > 0) {\r\n      for (let j = 0; j < closePopupNodes.length; j++) {\r\n        closePopupNodes[j]._setCloseCallback(\r\n          (action?: string, results?: Record<string, any>) => {\r\n            //close next frame so all nodes have a chance to update before being deleted\r\n            this.scheduleNextFrame(() => {\r\n              //avoid double callbacks\r\n              if (!nodeScope.hasNodeWithId(group.id)) return;\r\n\r\n              this.onClosePopup?.(group);\r\n              nodeScope.deleteNode(group);\r\n              args?.onClosePopup?.(action, results || {});\r\n            });\r\n          }\r\n        );\r\n      }\r\n    }\r\n\r\n    this.onShowPopup(group);\r\n\r\n    requestAnimationFrame(() => {\r\n      //hack to make the react components have the right props\r\n      //TODO: figure out why this requestAnimationFrame is necessary\r\n      group.addChild(popupNode);\r\n    });\r\n  }\r\n\r\n  setWarningTypes(warningTypes: Record<string, boolean>): void {\r\n    Object.assign(this.warningTypes, warningTypes);\r\n  }\r\n\r\n  isWarningTypeEnabled(warning: string): boolean {\r\n    if (!this.warningTypes.hasOwnProperty(warning)) {\r\n      //if a level isn't set, default to true\r\n      return true;\r\n    }\r\n\r\n    return this.warningTypes[warning] ? true : false;\r\n  }\r\n\r\n  getDefaultValueForInput(nodeType: string, inputName: string): any {\r\n    if (this.nodeRegister.hasNode(nodeType) === false) {\r\n      return undefined;\r\n    }\r\n\r\n    const nodeMetadata = this.nodeRegister.getNodeMetadata(nodeType);\r\n\r\n    const inputMetadata = nodeMetadata.inputs?.[inputName];\r\n    if (!inputMetadata) {\r\n      return undefined;\r\n    }\r\n\r\n    if (inputMetadata.type.defaultUnit) {\r\n      return {\r\n        value: inputMetadata.default,\r\n        unit: inputMetadata.type.defaultUnit,\r\n      };\r\n    }\r\n\r\n    return inputMetadata.default;\r\n  }\r\n}\r\n","type Callback = (data?: any) => void | Promise<void>;\r\ntype ListenersMap = Record<string, Callback[]>;\r\ntype ListenersWithRefsMap = Record<string, Map<any, Callback[]>>;\r\n\r\nexport class EventSender {\r\n  private listeners: ListenersMap;\r\n  private listenersWithRefs: ListenersWithRefsMap;\r\n\r\n  constructor() {\r\n    this.listeners = {};\r\n    this.listenersWithRefs = {};\r\n  }\r\n\r\n  on(eventName: string, callback: Callback, ref?: any): void {\r\n    if (ref) {\r\n      if (!this.listenersWithRefs.hasOwnProperty(eventName)) {\r\n        this.listenersWithRefs[eventName] = new Map();\r\n      }\r\n\r\n      if (!this.listenersWithRefs[eventName].get(ref)) {\r\n        this.listenersWithRefs[eventName].set(ref, []);\r\n      }\r\n\r\n      this.listenersWithRefs[eventName].get(ref)!.push(callback);\r\n    } else {\r\n      if (!this.listeners.hasOwnProperty(eventName)) {\r\n        this.listeners[eventName] = [];\r\n      }\r\n\r\n      this.listeners[eventName].push(callback);\r\n    }\r\n  }\r\n\r\n  removeListenersWithRef(ref: any): void {\r\n    Object.keys(this.listenersWithRefs).forEach((eventName) => {\r\n      const listeners = this.listenersWithRefs[eventName];\r\n      if (listeners.has(ref)) {\r\n        listeners.delete(ref);\r\n      }\r\n    });\r\n  }\r\n\r\n  removeAllListeners(eventName?: string): void {\r\n    if (eventName) {\r\n      delete this.listeners[eventName];\r\n      delete this.listenersWithRefs[eventName];\r\n    } else {\r\n      this.listeners = {};\r\n      this.listenersWithRefs = {};\r\n    }\r\n  }\r\n\r\n  async emit(eventName: string, data?: any): Promise<void> {\r\n    const array = this.listeners[eventName];\r\n\r\n    if (array) {\r\n      const callbacks = [...array];\r\n      for (const callback of callbacks) {\r\n        await Promise.resolve(callback(data));\r\n      }\r\n    }\r\n\r\n    const map = this.listenersWithRefs[eventName];\r\n\r\n    if (map) {\r\n      for (const [ref, callbacks] of map) {\r\n        for (const callback of callbacks) {\r\n          await Promise.resolve(callback.call(ref, data));\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n","//used to optimize warnings so we're not sending unneccessary warnings.\r\n//Improves editor performance, especially in larger projects\r\n\r\ninterface WarningMap {\r\n  [key: string]: string;\r\n}\r\n\r\nexport class ActiveWarnings {\r\n  private currentWarnings: Map<string, WarningMap>;\r\n\r\n  constructor() {\r\n    this.currentWarnings = new Map();\r\n  }\r\n\r\n  setWarning(nodeId: string, key: string, warning: string): boolean {\r\n    //Check if we've already sent this warning\r\n    if (this.currentWarnings.has(nodeId)) {\r\n      //we have sent warnings to this node before, check if we've sent this particular one before\r\n      const warningKeys = this.currentWarnings.get(nodeId);\r\n      if (warningKeys && warningKeys[key] === warning) {\r\n        //we've already sent this warning, no need to send it again\r\n        return false;\r\n      }\r\n\r\n      //new warning, remember that we sent it\r\n      if (warningKeys) {\r\n        warningKeys[key] = warning;\r\n      }\r\n      return true;\r\n    } else {\r\n      //new warning, we havent sent any warnings to this node before\r\n      //Remember that we sent it\r\n      this.currentWarnings.set(nodeId, { [key]: warning });\r\n      return true;\r\n    }\r\n  }\r\n\r\n  clearWarning(nodeId: string, key: string): boolean {\r\n    const warningKeys = this.currentWarnings.get(nodeId);\r\n\r\n    if (!warningKeys || !warningKeys[key]) {\r\n      //There are no warnings that we've sent on this node.\r\n      //Save some performance by not sending an uneccesary message to the editor\r\n      return false;\r\n    }\r\n\r\n    delete warningKeys[key];\r\n    if (Object.keys(warningKeys).length === 0) {\r\n      this.currentWarnings.delete(nodeId);\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  clearWarnings(nodeId: string): boolean {\r\n    if (this.currentWarnings.has(nodeId) === false) {\r\n      //no warnings on this node, save some performance by not sending a message to the editor\r\n      return false;\r\n    }\r\n\r\n    //no warnings for this node anymore\r\n    this.currentWarnings.delete(nodeId);\r\n    return true;\r\n  }\r\n}\r\n","import { EventSender } from \"./eventsender\";\r\nimport { ActiveWarnings } from \"./editorconnection.activewarnings\";\r\nimport { guid } from \"./utils\";\r\n\r\nexport interface Platform {\r\n  webSocketClass?: typeof WebSocket;\r\n  webSocketOptions?: any;\r\n  getCurrentTime: () => number;\r\n  isRunningLocally?: () => boolean;\r\n  requestUpdate?: (callback: () => void) => void;\r\n  objectToString?: (obj: any) => string;\r\n}\r\n\r\ninterface EditorConnectionOptions {\r\n  runtimeType?: string;\r\n  platform?: Platform;\r\n}\r\n\r\ninterface ServiceRequest {\r\n  token: string;\r\n  clientId: string;\r\n  [key: string]: any;\r\n}\r\n\r\nexport interface ConnectionPulse {\r\n  timestamp: number;\r\n  connections: string[];\r\n}\r\n\r\nexport class EditorConnection extends EventSender {\r\n  private runtimeType: string | undefined;\r\n  private platform: Platform;\r\n  private ws: typeof WebSocket;\r\n  private wsOptions: any;\r\n  private reconnectOnClose: boolean;\r\n  private enableDebugger: boolean;\r\n  private lastSendTimestamp: number;\r\n  private sendQueue: any[];\r\n  private sendTimer: ReturnType<typeof setTimeout> | undefined;\r\n  private activeWarnings: ActiveWarnings;\r\n  private socket?: WebSocket;\r\n\r\n  clientId: string = \"\";\r\n  debugInspectorsEnabled?: boolean;\r\n\r\n  constructor(opts: EditorConnectionOptions = {}) {\r\n    super();\r\n\r\n    this.runtimeType = opts.runtimeType;\r\n    this.platform = opts.platform || { getCurrentTime: () => Date.now() };\r\n    // @ts-expect-error\r\n    this.ws =\r\n      opts.platform?.webSocketClass ||\r\n      (typeof WebSocket !== \"undefined\" ? WebSocket : undefined);\r\n    this.wsOptions = opts.platform?.webSocketOptions;\r\n    this.reconnectOnClose = true;\r\n    this.enableDebugger = false;\r\n\r\n    this.lastSendTimestamp = 0;\r\n    this.sendQueue = [];\r\n    this.sendTimer = undefined;\r\n\r\n    //used to optimize warnings so we're not sending unneccessary warnings.\r\n    //Can slow down the editor in large projects\r\n    this.activeWarnings = new ActiveWarnings();\r\n  }\r\n\r\n  isRunningLocally(): boolean {\r\n    const runningLocallyInBrowser =\r\n      (this.platform.isRunningLocally && this.platform.isRunningLocally()) ||\r\n      (typeof document !== \"undefined\" &&\r\n        (document.location.hostname === \"localhost\" ||\r\n          document.location.hostname === \"127.0.0.1\"));\r\n    return runningLocallyInBrowser;\r\n  }\r\n\r\n  connect(address: string): void {\r\n    this.socket = this.wsOptions\r\n      ? new this.ws(address, this.wsOptions)\r\n      : new this.ws(address);\r\n\r\n    this.socket.addEventListener(\"open\", () => {\r\n      this.clientId = guid();\r\n      this.socket?.send(\r\n        JSON.stringify({\r\n          cmd: \"register\",\r\n          type: \"viewer\",\r\n          clientId: this.clientId,\r\n        })\r\n      );\r\n      this.emit(\"connected\");\r\n    });\r\n\r\n    this.socket.addEventListener(\"close\", (event: CloseEvent) => {\r\n      if (this.reconnectOnClose) {\r\n        this.reconnect(address);\r\n      }\r\n      console.log(\"Editor connection closed\", event.code, event.reason);\r\n      this.emit(\"connectionClosed\");\r\n    });\r\n\r\n    this.socket.addEventListener(\"error\", () => {\r\n      console.log(\"Editor connection error, trying to reconnect\");\r\n    });\r\n\r\n    this.socket.addEventListener(\"message\", async (e: MessageEvent) => {\r\n      // NOTE: When the data is too big it seems to change from string to a blob\r\n      const text = typeof e.data === \"string\" ? e.data : await e.data.text();\r\n      const message = JSON.parse(text);\r\n\r\n      let content;\r\n\r\n      if (message.cmd === \"registered\") {\r\n        //ignore\r\n      } else if (message.cmd === \"export\") {\r\n        content = JSON.parse(message.content);\r\n        if (message.type === \"full\" && message.target === this.clientId) {\r\n          this.emit(\"exportDataFull\", content);\r\n        }\r\n      } else if (message.cmd === \"hoverStart\") {\r\n        this.emit(\"hoverStart\", message.content.id);\r\n      } else if (message.cmd === \"hoverEnd\") {\r\n        this.emit(\"hoverEnd\", message.content.id);\r\n      } else if (message.cmd === \"refresh\") {\r\n        this.emit(\"reload\");\r\n      } else if (message.cmd === \"debugInspectors\") {\r\n        if (this.debugInspectorsEnabled) {\r\n          content = JSON.parse(message.content);\r\n          this.emit(\"debugInspectorsUpdated\", content.inspectors);\r\n        }\r\n      } else if (message.cmd === \"debuggingEnabled\") {\r\n        if (this.isRunningLocally()) {\r\n          content = JSON.parse(message.content);\r\n          this.emit(\"debuggingEnabledChanged\", content.enabled);\r\n        }\r\n      } else if (message.cmd === \"getConnectionValue\") {\r\n        if (this.isRunningLocally()) {\r\n          content = JSON.parse(message.content);\r\n          await this.emit(\"getConnectionValue\", {\r\n            clientId: content.clientId,\r\n            connectionId: content.connectionId,\r\n          });\r\n        }\r\n      } else if (message.cmd === \"modelUpdate\") {\r\n        await this.emit(\"modelUpdate\", message.content);\r\n      } else if (message.cmd === \"publish\") {\r\n        // TODO: What is this?\r\n        // Services.pubsub.routeMessage(message); // Publish a message from the pubsub service\r\n      } else if (message.cmd === \"noodlModules\") {\r\n        this.emit(\"noodlModules\", JSON.parse(message.content));\r\n      } else if (message.cmd === \"mqttUpdate\") {\r\n        this.emit(\"mqttUpdate\", message.content);\r\n      } else if (message.cmd === \"activeComponentChanged\") {\r\n        this.emit(\"activeComponentChanged\", message.component);\r\n      } else {\r\n        console.log(\"Command not implemented\", message);\r\n      }\r\n    });\r\n  }\r\n\r\n  reconnect(address: string): void {\r\n    setTimeout(() => {\r\n      this.connect(address);\r\n    }, 2000);\r\n  }\r\n\r\n  isConnected(): boolean {\r\n    return this.socket !== undefined && this.socket.readyState === this.ws.OPEN;\r\n  }\r\n\r\n  //JSON replacer to make cyclic objects non-cyclic.\r\n  //Using this example: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Errors/Cyclic_object_value#examples\r\n  private getCircularReplacer() {\r\n    const seen = new WeakSet();\r\n    return (key: string, value: any) => {\r\n      if (typeof value === \"object\" && value !== null) {\r\n        if (seen.has(value)) {\r\n          return \"[Circular]\";\r\n        }\r\n        seen.add(value);\r\n      }\r\n      return value;\r\n    };\r\n  }\r\n\r\n  send(data: any): void {\r\n    const now = this.platform.getCurrentTime();\r\n    const dt = now - this.lastSendTimestamp;\r\n\r\n    //Send objects as json and capture exceptions\r\n    const trySend = (msg: any) => {\r\n      try {\r\n        this.socket?.send(JSON.stringify(msg));\r\n      } catch (e: any) {\r\n        if (e.message && e.message.startsWith(\"Converting circular\")) {\r\n          //the object is circular, try to address it\r\n          try {\r\n            this.socket?.send(JSON.stringify(msg, this.getCircularReplacer()));\r\n          } catch (e) {\r\n            //still failed, give up\r\n            console.log(\"failed to send message to editor\", msg, e);\r\n          }\r\n        } else {\r\n          //message couldn't be serialized to json\r\n          console.log(\"failed to send message to editor\", msg, e);\r\n        }\r\n      }\r\n    };\r\n\r\n    //batch messages so they're only sent at most every 200ms\r\n    //note that the first message will always be sent immediately, and the ones for 200ms after\r\n    //that one will be queued. So initial message response time is as low as possible (for hover etc)\r\n    if (dt < 200 || this.sendTimer || !this.isConnected()) {\r\n      this.sendQueue.push(data);\r\n      if (!this.sendTimer) {\r\n        this.sendTimer = setTimeout(() => {\r\n          if (this.isConnected() === false) {\r\n            return;\r\n          }\r\n\r\n          //send messages in chunks. If we send too many at once the editor UI can freeze for a while\r\n          //since it's handling these in the renderer process\r\n          const chunkSize = 50;\r\n          for (let i = 0; i < this.sendQueue.length; i += chunkSize) {\r\n            const chunk = this.sendQueue.slice(i, i + chunkSize);\r\n            trySend(chunk);\r\n          }\r\n\r\n          this.sendQueue = [];\r\n          this.sendTimer = undefined;\r\n          this.lastSendTimestamp = this.platform.getCurrentTime();\r\n        }, 100);\r\n      }\r\n    } else {\r\n      this.lastSendTimestamp = now;\r\n      trySend(data);\r\n    }\r\n  }\r\n\r\n  sendInspectId(id: string): void {\r\n    this.send({\r\n      cmd: \"select\",\r\n      type: \"viewer\",\r\n      content: JSON.stringify({ id: id }),\r\n    });\r\n  }\r\n\r\n  sendSelectComponent(componentName: string): void {\r\n    this.send({\r\n      cmd: \"select\",\r\n      type: \"viewer\",\r\n      content: JSON.stringify({ componentName }),\r\n    });\r\n  }\r\n\r\n  sendPulsingConnections(connectionMap: Record<string, ConnectionPulse>): void {\r\n    const connectionsToPulse: any[] = [];\r\n    Object.keys(connectionMap).forEach((c) => {\r\n      const connection = connectionMap[c];\r\n      connectionsToPulse.push(...connection.connections);\r\n    });\r\n\r\n    this.send({\r\n      cmd: \"connectiondebugpulse\",\r\n      type: \"viewer\",\r\n      content: JSON.stringify({\r\n        connectionsToPulse: connectionsToPulse,\r\n      }),\r\n    });\r\n  }\r\n\r\n  sendDebugInspectorValues(inspectors: any): void {\r\n    this.send({\r\n      cmd: \"debuginspectorvalues\",\r\n      type: \"viewer\",\r\n      content: { inspectors },\r\n    });\r\n  }\r\n\r\n  sendConnectionValue(connectionId: string, value: any): void {\r\n    this.send({\r\n      cmd: \"connectionValue\",\r\n      type: \"viewer\",\r\n      content: { connectionId, value },\r\n    });\r\n  }\r\n\r\n  private dynamicPortsHash: Record<string, string> = {};\r\n\r\n  private _detectRename(\r\n    before: string[],\r\n    after: string[]\r\n  ): { before: string; after: string } | undefined {\r\n    if (!before || !after) return;\r\n\r\n    if (before.length !== after.length) return; // Must be of same length\r\n\r\n    const res: { before?: string; after?: string } = {};\r\n    for (let i = 0; i < before.length; i++) {\r\n      if (after.indexOf(before[i]) === -1) {\r\n        if (res.before) return; // Can only be one from before that is missing\r\n        res.before = before[i];\r\n      }\r\n\r\n      if (before.indexOf(after[i]) === -1) {\r\n        if (res.after) return; // Only one can be missing,otherwise we cannot match\r\n        res.after = after[i];\r\n      }\r\n    }\r\n\r\n    return res.before && res.after\r\n      ? { before: res.before, after: res.after }\r\n      : undefined;\r\n  }\r\n\r\n  sendDynamicPorts(id: string, ports: any[], options?: any): void {\r\n    const hash = JSON.stringify(ports);\r\n    if (this.dynamicPortsHash[id] === hash) {\r\n      // Make sure we don't resend the same port data\r\n      return;\r\n    }\r\n\r\n    if (\r\n      this.dynamicPortsHash[id] &&\r\n      ports &&\r\n      options &&\r\n      options.detectRenamed\r\n    ) {\r\n      const detectRenamed = Array.isArray(options.detectRenamed)\r\n        ? options.detectRenamed\r\n        : [options.detectRenamed];\r\n\r\n      const renamed: any[] = [];\r\n      detectRenamed.forEach((d: any) => {\r\n        let before = JSON.parse(this.dynamicPortsHash[id]);\r\n        let after = [...ports];\r\n\r\n        // Filter ports with correct prefix and plug\r\n        if (d.prefix) {\r\n          before = before.filter((p: any) => p.name.startsWith(d.prefix));\r\n          after = after.filter((p: any) => p.name.startsWith(d.prefix));\r\n        }\r\n\r\n        if (d.plug) {\r\n          before = before.filter((p: any) => p.plug === d.plug);\r\n          after = after.filter((p: any) => p.plug === d.plug);\r\n        }\r\n\r\n        // Remove the prefix\r\n        after = after.map((p: any) =>\r\n          p.name.substring((d.prefix || \"\").length)\r\n        );\r\n        before = before.map((p: any) =>\r\n          p.name.substring((d.prefix || \"\").length)\r\n        );\r\n\r\n        // Find the one that is renamed (if any)\r\n        const res = this._detectRename(before, after);\r\n        if (res) {\r\n          renamed.push({\r\n            plug: d.plug,\r\n            patterns: [(d.prefix || \"\") + \"{{*}}\"],\r\n            before: res.before,\r\n            after: res.after,\r\n          });\r\n        }\r\n      });\r\n      if (renamed.length > 0) options.renamed = renamed;\r\n\r\n      delete options.detectRenamed;\r\n    }\r\n\r\n    this.dynamicPortsHash[id] = hash;\r\n\r\n    this.send({\r\n      cmd: \"instanceports\",\r\n      type: \"viewer\",\r\n      content: JSON.stringify({\r\n        nodeid: id,\r\n        ports: ports,\r\n        options: options,\r\n      }),\r\n    });\r\n  }\r\n\r\n  sendWarning(\r\n    componentName: string,\r\n    nodeId: string,\r\n    key: string,\r\n    warning: any\r\n  ): void {\r\n    const isNewWarning = this.activeWarnings.setWarning(nodeId, key, warning);\r\n\r\n    if (isNewWarning) {\r\n      this.send({\r\n        cmd: \"showwarning\",\r\n        type: \"viewer\",\r\n        content: JSON.stringify({\r\n          componentName: componentName,\r\n          nodeId: nodeId,\r\n          key: key,\r\n          warning: warning,\r\n        }),\r\n      });\r\n    }\r\n  }\r\n\r\n  clearWarning(componentName: string, nodeId: string, key: string): void {\r\n    const hasWarning = this.activeWarnings.clearWarning(nodeId, key);\r\n\r\n    if (hasWarning) {\r\n      this.send({\r\n        cmd: \"showwarning\",\r\n        type: \"viewer\",\r\n        content: JSON.stringify({\r\n          componentName: componentName,\r\n          nodeId: nodeId,\r\n          key: key,\r\n          warning: undefined,\r\n        }),\r\n      });\r\n    }\r\n  }\r\n\r\n  clearWarnings(componentName: string, nodeId: string): void {\r\n    const hasWarnings = this.activeWarnings.clearWarnings(nodeId);\r\n\r\n    if (hasWarnings) {\r\n      this.send({\r\n        cmd: \"clearwarnings\",\r\n        type: \"viewer\",\r\n        content: JSON.stringify({\r\n          componentName: componentName,\r\n          nodeId: nodeId,\r\n        }),\r\n      });\r\n    }\r\n  }\r\n\r\n  sendPatches(patches: any): void {\r\n    this.send({\r\n      cmd: \"patchproject\",\r\n      type: \"viewer\",\r\n      content: JSON.stringify(patches),\r\n    });\r\n  }\r\n\r\n  requestFullExport(): void {\r\n    this.send({\r\n      cmd: \"register\",\r\n      type: \"viewer\",\r\n    });\r\n  }\r\n\r\n  requestNoodlModules(): void {\r\n    this.send({\r\n      cmd: \"getNoodlModules\",\r\n      type: \"viewer\",\r\n    });\r\n  }\r\n\r\n  private serviceRequests: Record<string, (response: any) => void> = {};\r\n\r\n  sendServiceRequest(\r\n    request: ServiceRequest,\r\n    callback: (response: any) => void\r\n  ): void {\r\n    request.token = guid();\r\n    request.clientId = this.clientId;\r\n    this.serviceRequests[request.token] = callback;\r\n    this.send(request);\r\n  }\r\n\r\n  close(): void {\r\n    this.reconnectOnClose = false;\r\n\r\n    if (this.isConnected() === false) {\r\n      return;\r\n    }\r\n\r\n    this.socket?.close();\r\n  }\r\n\r\n  sendNodeLibrary(nodelibrary: any): void {\r\n    this.send({\r\n      cmd: \"nodelibrary\",\r\n      type: \"viewer\",\r\n      runtimeType: this.runtimeType,\r\n      content: nodelibrary,\r\n      clientId: this.clientId,\r\n    });\r\n  }\r\n\r\n  sendComponentMetadata(componentName: string, key: string, data: any): void {\r\n    this.send({\r\n      cmd: \"componentMetadata\",\r\n      type: \"viewer\",\r\n      content: JSON.stringify({\r\n        componentName,\r\n        key,\r\n        data,\r\n      }),\r\n    });\r\n  }\r\n\r\n  sendProjectMetadata(key: string, data: any): void {\r\n    this.send({\r\n      cmd: \"projectMetadata\",\r\n      type: \"viewer\",\r\n      content: JSON.stringify({\r\n        key,\r\n        data,\r\n      }),\r\n    });\r\n  }\r\n}\r\n","import { Port } from \"./models/componentmodel\";\r\nimport type {\r\n  DynamicPort,\r\n  InputDefinition,\r\n  NodeDefinition,\r\n  OutputDefinition,\r\n} from \"./nodedefinition\";\r\nimport { NodeRegister } from \"./noderegister\";\r\n\r\nfunction formatDynamicPorts(nodeMetadata: NodeDefinition): DynamicPort[] {\r\n  const dynamicports: DynamicPort[] = [];\r\n\r\n  for (const dp of nodeMetadata.dynamicports || []) {\r\n    if (dp.ports || dp.template || dp.port || dp.channelPort) {\r\n      //same format as editor expects, no need to transform it\r\n      dynamicports.push(dp as DynamicPort);\r\n    } else if (dp.inputs || dp.outputs) {\r\n      //inputs and outputs is just list of names\r\n      //need to pull the metadata from the inputs/outputs since they\r\n      //won't be registered by the editor (it's either a regular port\r\n      // or a dynamic port, can't register both)\r\n      const ports: Port[] = [];\r\n\r\n      if (dp.inputs) {\r\n        for (const inputName of dp.inputs) {\r\n          const input = nodeMetadata.inputs?.[inputName];\r\n          if (input) {\r\n            ports.push(formatPort(inputName, input, \"input\"));\r\n          }\r\n        }\r\n      }\r\n\r\n      if (dp.outputs) {\r\n        for (const outputName of dp.outputs) {\r\n          const output = nodeMetadata.outputs?.[outputName];\r\n          if (output) {\r\n            ports.push(formatPort(outputName, output, \"output\"));\r\n          }\r\n        }\r\n      }\r\n\r\n      const dynamicPortGroup: DynamicPort = {\r\n        name: dp.name || \"conditionalports/basic\",\r\n        condition: dp.condition,\r\n        ports,\r\n      };\r\n\r\n      dynamicports.push(dynamicPortGroup);\r\n    }\r\n  }\r\n\r\n  return dynamicports;\r\n}\r\n\r\nfunction formatPort(\r\n  portName: string,\r\n  portData: InputDefinition<any> | OutputDefinition<any>,\r\n  plugType: Port[\"plug\"]\r\n): Port {\r\n  const port: Port = {\r\n    name: portName,\r\n    type: portData.type,\r\n    plug: plugType,\r\n  };\r\n  if (portData.group) {\r\n    port.group = portData.group;\r\n  }\r\n  if (portData.displayName) {\r\n    port.displayName = portData.displayName;\r\n  }\r\n  if (portData.description) {\r\n    port.description = portData.description;\r\n  }\r\n  if (portData.editorName) {\r\n    port.editorName = portData.editorName;\r\n  }\r\n  if (portData.default !== undefined) {\r\n    port.default = portData.default;\r\n  }\r\n  if (portData.hasOwnProperty(\"index\")) {\r\n    port.index = portData.index;\r\n  }\r\n  if (portData.tooltip) {\r\n    port.tooltip = portData.tooltip;\r\n  }\r\n  if (portData.tab) {\r\n    port.tab = portData.tab;\r\n  }\r\n  if (portData.popout) {\r\n    port.popout = portData.popout;\r\n  }\r\n  if (portData.allowVisualStates) {\r\n    port.allowVisualStates = portData.allowVisualStates;\r\n  }\r\n  return port;\r\n}\r\n\r\nexport function generateNodeLibrary(nodeRegister: NodeRegister) {\r\n  const obj: Record<string, any> = {\r\n    //note: needs to include ALL types\r\n    typecasts: [\r\n      {\r\n        from: \"string\",\r\n        to: [\r\n          \"number\",\r\n          \"boolean\",\r\n          \"image\",\r\n          \"color\",\r\n          \"enum\",\r\n          \"textStyle\",\r\n          \"dimension\",\r\n          \"array\",\r\n          \"object\",\r\n        ],\r\n      },\r\n      {\r\n        from: \"boolean\",\r\n        to: [\"number\", \"string\", \"signal\"],\r\n      },\r\n      {\r\n        from: \"number\",\r\n        to: [\"boolean\", \"string\", \"dimension\"],\r\n      },\r\n      {\r\n        from: \"date\",\r\n        to: [\"string\"],\r\n      },\r\n      {\r\n        from: \"signal\",\r\n        to: [\"boolean\", \"number\"],\r\n      },\r\n      {\r\n        from: \"image\",\r\n        to: [],\r\n      },\r\n      {\r\n        from: \"cloudfile\",\r\n        to: [\"string\", \"image\"],\r\n      },\r\n      {\r\n        from: \"color\",\r\n        to: [],\r\n      },\r\n      {\r\n        from: \"enum\",\r\n        to: [],\r\n      },\r\n      {\r\n        from: \"object\",\r\n        to: [],\r\n      },\r\n      {\r\n        from: \"domelement\",\r\n        to: [],\r\n      },\r\n      {\r\n        from: \"reference\",\r\n        to: [],\r\n      },\r\n      {\r\n        from: \"font\",\r\n        to: [],\r\n      },\r\n      {\r\n        from: \"textStyle\",\r\n        to: [\"string\"],\r\n      },\r\n      {\r\n        // Collection is deprecated but supported via typecasts\r\n        from: \"collection\",\r\n        to: [\"array\"],\r\n      },\r\n      {\r\n        from: \"array\",\r\n        to: [\"collection\"],\r\n      },\r\n    ],\r\n    dynamicports: [\r\n      {\r\n        type: \"conditionalports\",\r\n        name: \"basic\",\r\n      },\r\n      {\r\n        type: \"expand\",\r\n        name: \"basic\",\r\n      },\r\n    ],\r\n    colors: {\r\n      nodes: {\r\n        component: {\r\n          base: \"#643D8B\",\r\n          baseHighlighted: \"#79559b\",\r\n          header: \"#4E2877\",\r\n          headerHighlighted: \"#643d8b\",\r\n          outline: \"#4E2877\",\r\n          outlineHighlighted: \"#b58900\",\r\n          text: \"#dbd0e4\",\r\n        },\r\n        visual: {\r\n          base: \"#315272\",\r\n          baseHighlighted: \"#4d6784\",\r\n          header: \"#173E5D\",\r\n          headerHighlighted: \"#315272\",\r\n          outline: \"#173E5D\",\r\n          outlineHighlighted: \"#b58900\",\r\n          text: \"#cfd5de\",\r\n        },\r\n        data: {\r\n          base: \"#465524\",\r\n          baseHighlighted: \"#5b6a37\",\r\n          header: \"#314110\",\r\n          headerHighlighted: \"#465524\",\r\n          outline: \"#314110\",\r\n          outlineHighlighted: \"#b58900\",\r\n          text: \"#d2d6c5\",\r\n        },\r\n        javascript: {\r\n          base: \"#7E3660\",\r\n          baseHighlighted: \"#944e74\",\r\n          header: \"#67214B\",\r\n          headerHighlighted: \"#7e3660\",\r\n          outline: \"#67214B\",\r\n          outlineHighlighted: \"#d57bab\",\r\n          text: \"#e4cfd9\",\r\n        },\r\n        default: {\r\n          base: \"#4C4F59\",\r\n          baseHighlighted: \"#62656e\",\r\n          header: \"#373B45\",\r\n          headerHighlighted: \"#4c4f59\",\r\n          outline: \"#373B45\",\r\n          outlineHighlighted: \"#b58900\",\r\n          text: \"#d3d4d6\",\r\n        },\r\n      },\r\n      connections: {\r\n        signal: {\r\n          normal: \"#006f82\",\r\n          highlighted: \"#7ec2cf\",\r\n          pulsing: \"#ffffff\",\r\n        },\r\n        default: {\r\n          normal: \"#875d00\",\r\n          highlighted: \"#e5ae32\",\r\n          pulsing: \"#ffffff\",\r\n        },\r\n      },\r\n    },\r\n    nodetypes: [\r\n      {\r\n        name: \"Component Children\",\r\n        shortDesc:\r\n          \"This node is a placeholder for where children of this component will be inserted.\",\r\n        docs: \"https://docs.noodl.net/nodes/component-utilities/component-children\",\r\n        color: \"component\",\r\n        allowAsChild: true,\r\n        category: \"Visual\",\r\n        haveComponentChildren: [\"Visual\"],\r\n      },\r\n    ],\r\n  };\r\n\r\n  const nodeTypes = Object.keys((nodeRegister as any)._constructors);\r\n\r\n  nodeTypes.forEach(function (type) {\r\n    const nodeMetadata: NodeDefinition = (nodeRegister as any)._constructors[\r\n      type\r\n    ].metadata;\r\n\r\n    const nodeObj: Partial<NodeDefinition> = {\r\n      name: type,\r\n      searchTags: nodeMetadata.searchTags,\r\n    };\r\n    obj.nodetypes.push(nodeObj);\r\n\r\n    if (nodeMetadata.version) {\r\n      nodeObj.version = nodeMetadata.version;\r\n    }\r\n    if (nodeMetadata.displayNodeName) {\r\n      nodeObj.displayNodeName = nodeMetadata.displayNodeName;\r\n    }\r\n    if (nodeMetadata.nodeDoubleClickAction) {\r\n      nodeObj.nodeDoubleClickAction = nodeMetadata.nodeDoubleClickAction;\r\n    }\r\n    if (nodeMetadata.shortDesc) {\r\n      nodeObj.shortDesc = nodeMetadata.shortDesc;\r\n    }\r\n    if (nodeMetadata.module) {\r\n      nodeObj.module = nodeMetadata.module;\r\n    }\r\n    if (nodeMetadata.deprecated) {\r\n      nodeObj.deprecated = true;\r\n    }\r\n    if (nodeMetadata.haveComponentPorts) {\r\n      nodeObj.haveComponentPorts = true;\r\n    }\r\n    if (nodeMetadata.category === \"Visual\") {\r\n      nodeObj.allowAsChild = true;\r\n      nodeObj.allowAsExportRoot = true;\r\n      nodeObj.color = \"visual\";\r\n    }\r\n\r\n    if (nodeMetadata.allowAsExportRoot !== undefined) {\r\n      nodeObj.allowAsExportRoot = nodeMetadata.allowAsExportRoot;\r\n    }\r\n\r\n    if (nodeMetadata.allowChildren) {\r\n      nodeObj.allowChildrenWithCategory = [\"Visual\"];\r\n      nodeObj.color = \"visual\";\r\n    }\r\n    if (nodeMetadata.allowChildrenWithCategory) {\r\n      nodeObj.allowChildrenWithCategory =\r\n        nodeMetadata.allowChildrenWithCategory;\r\n    }\r\n    if (nodeMetadata.singleton) {\r\n      nodeObj.singleton = true;\r\n    }\r\n    if (nodeMetadata.allowAsChild) {\r\n      nodeObj.allowAsChild = true;\r\n    }\r\n    if (nodeMetadata.docs) {\r\n      nodeObj.docs = nodeMetadata.docs;\r\n    }\r\n    if (nodeMetadata.shortDocs) {\r\n      nodeObj.shortDocs = nodeMetadata.shortDocs;\r\n    } else if (\r\n      nodeMetadata.docs &&\r\n      nodeMetadata.docs.indexOf(\"https://docs.noodl.net\") === 0\r\n    ) {\r\n      nodeObj.shortDocs = nodeMetadata.docs.replace(\"/#\", \"\") + \"-short.md\";\r\n    }\r\n    nodeObj.category = nodeMetadata.category;\r\n\r\n    if (nodeMetadata.panels) {\r\n      nodeObj.panels = nodeMetadata.panels;\r\n    }\r\n    if (nodeMetadata.usePortAsLabel) {\r\n      nodeObj.usePortAsLabel = nodeMetadata.usePortAsLabel;\r\n      nodeObj.portLabelTruncationMode = nodeMetadata.portLabelTruncationMode;\r\n    }\r\n    if (nodeMetadata.color) {\r\n      nodeObj.color = nodeMetadata.color;\r\n    }\r\n    if (nodeMetadata.dynamicports) {\r\n      nodeObj.dynamicports = formatDynamicPorts(nodeMetadata);\r\n    }\r\n    if (nodeMetadata.exportDynamicPorts) {\r\n      nodeObj.exportDynamicPorts = nodeMetadata.exportDynamicPorts;\r\n    }\r\n    if (nodeMetadata.visualStates) {\r\n      nodeObj.visualStates = nodeMetadata.visualStates;\r\n    }\r\n    if (nodeMetadata.useVariants) {\r\n      nodeObj.useVariants = nodeMetadata.useVariants;\r\n    }\r\n    if (nodeMetadata.connectionPanel) {\r\n      nodeObj.connectionPanel = nodeMetadata.connectionPanel;\r\n    }\r\n    nodeObj.ports = [];\r\n\r\n    const dynamicports = nodeObj.dynamicports || [];\r\n    const selectorNames: Record<string, boolean> = {};\r\n    const conditionalPortNames: Record<string, boolean> = {};\r\n\r\n    //same for channel ports\r\n    dynamicports\r\n      .filter((d) => d.channelPort !== undefined)\r\n      .forEach((port) => {\r\n        conditionalPortNames[\r\n          port.channelPort.plug + \"/\" + port.channelPort.name\r\n        ] = true;\r\n      });\r\n\r\n    if (dynamicports.length) {\r\n      nodeObj.dynamicports = dynamicports;\r\n    }\r\n\r\n    Object.keys(nodeMetadata.inputs || {}).forEach(function (inputName) {\r\n      if (\r\n        selectorNames.hasOwnProperty(\"input/\" + inputName) ||\r\n        conditionalPortNames.hasOwnProperty(\"input/\" + inputName)\r\n      ) {\r\n        //this is a selector or dynamic port. It's already been registered\r\n        return;\r\n      }\r\n\r\n      const port = nodeMetadata.inputs?.[inputName];\r\n      if (!port || port.exportToEditor === false) {\r\n        return;\r\n      }\r\n\r\n      if (!nodeObj.ports) {\r\n        nodeObj.ports = [];\r\n      }\r\n      nodeObj.ports.push(formatPort(inputName, port, \"input\"));\r\n    });\r\n\r\n    function exportOutput(name: string, output: OutputDefinition<{}>) {\r\n      const port: Port = {\r\n        name: name,\r\n        type: output.type,\r\n        plug: \"output\",\r\n      };\r\n      if (output.group) {\r\n        port.group = output.group;\r\n      }\r\n      if (output.displayName) {\r\n        port.displayName = output.displayName;\r\n      }\r\n      if (output.editorName) {\r\n        port.editorName = output.editorName;\r\n      }\r\n      if (output.hasOwnProperty(\"index\")) {\r\n        port.index = output.index;\r\n      }\r\n      if (!nodeObj.ports) {\r\n        nodeObj.ports = [];\r\n      }\r\n      nodeObj.ports.push(port);\r\n    }\r\n\r\n    Object.keys(nodeMetadata.outputs || {}).forEach(function (prop) {\r\n      if (\r\n        selectorNames.hasOwnProperty(\"output/\" + prop) ||\r\n        conditionalPortNames.hasOwnProperty(\"output/\" + prop)\r\n      ) {\r\n        //this is a selector or dynamic port. It's already been registered\r\n        return;\r\n      }\r\n\r\n      const output = nodeMetadata.outputs?.[prop];\r\n      if (output) {\r\n        exportOutput(prop, output);\r\n      }\r\n    });\r\n  });\r\n\r\n  const coreNodes = [\r\n    {\r\n      name: \"UI Elements\",\r\n      description: \"Buttons, inputs, containers, media\",\r\n      type: \"visual\",\r\n      subCategories: [\r\n        {\r\n          name: \"Basic Elements\",\r\n          items: [\r\n            \"Group\",\r\n            \"net.noodl.visual.columns\",\r\n            \"Text\",\r\n            \"Image\",\r\n            \"Video\",\r\n            \"Circle\",\r\n            \"net.noodl.visual.icon\",\r\n          ],\r\n        },\r\n        {\r\n          name: \"UI Controls\",\r\n          items: [\r\n            \"net.noodl.controls.button\",\r\n            \"net.noodl.controls.checkbox\",\r\n            \"net.noodl.controls.options\",\r\n            \"net.noodl.controls.radiobutton\",\r\n            \"Radio Button Group\",\r\n            \"net.noodl.controls.range\",\r\n            \"net.noodl.controls.textinput\",\r\n          ],\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      name: \"Navigation & Popups\",\r\n      description: \"Page routing, navigation, popups\",\r\n      type: \"logic\",\r\n      subCategories: [\r\n        {\r\n          name: \"Navigation\",\r\n          items: [\r\n            \"Router\",\r\n            \"RouterNavigate\",\r\n            \"PageInputs\",\r\n            \"net.noodl.externallink\",\r\n            \"PageStackNavigateToPath\",\r\n          ],\r\n        },\r\n        {\r\n          name: \"Component Stack\",\r\n          items: [\"Page Stack\", \"PageStackNavigate\", \"PageStackNavigateBack\"],\r\n        },\r\n        {\r\n          name: \"Popups\",\r\n          items: [\"NavigationShowPopup\", \"NavigationClosePopup\"],\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      name: \"Logic & Utilities\",\r\n      description: \"Logic, events, string manipulation\",\r\n      type: \"logic\",\r\n      subCategories: [\r\n        {\r\n          name: \"General Utils\",\r\n          items: [\r\n            \"States\",\r\n            \"Value Changed\",\r\n            \"Timer\",\r\n            \"Color Blend\",\r\n            \"Number Remapper\",\r\n            \"Counter\",\r\n            \"Drag\",\r\n            \"net.noodl.animatetovalue\",\r\n          ],\r\n        },\r\n        {\r\n          name: \"Logic\",\r\n          items: [\r\n            \"Boolean To String\",\r\n            \"Switch\",\r\n            \"And\",\r\n            \"Or\",\r\n            \"Condition\",\r\n            \"Inverter\",\r\n          ],\r\n        },\r\n        {\r\n          name: \"Events\",\r\n          items: [\"Event Sender\", \"Event Receiver\"],\r\n        },\r\n        {\r\n          name: \"String Manipulation\",\r\n          items: [\r\n            \"Substring\",\r\n            \"String Mapper\",\r\n            \"String Format\",\r\n            \"Date To String\",\r\n            \"Unique Id\",\r\n          ],\r\n        },\r\n        {\r\n          name: \"System\",\r\n          items: [\"Screen Resolution\", \"Open File Picker\"],\r\n        },\r\n        {\r\n          name: \"Variables\",\r\n          items: [\"String\", \"Boolean\", \"Color\", \"Number\"],\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      name: \"Component Utilities\",\r\n      description: \"Component inputs, outputs & object\",\r\n      type: \"component\",\r\n      subCategories: [\r\n        {\r\n          name: \"\",\r\n          items: [\r\n            \"Component Inputs\",\r\n            \"Component Outputs\",\r\n            \"Component Children\",\r\n            \"net.noodl.ComponentObject\",\r\n            \"net.noodl.ParentComponentObject\",\r\n            \"net.noodl.SetComponentObjectProperties\",\r\n            \"net.noodl.SetParentComponentObjectProperties\",\r\n          ],\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      name: \"Read & Write Data\",\r\n      description: \"Arrays, objects, cloud data\",\r\n      type: \"data\",\r\n      subCategories: [\r\n        {\r\n          name: \"\",\r\n          items: [\r\n            \"RunTasks\",\r\n            \"For Each\",\r\n            \"For Each Actions\",\r\n            \"Model2\",\r\n            \"SetModelProperties\",\r\n            \"NewModel\",\r\n            \"Set Variable\",\r\n            \"Variable2\",\r\n          ],\r\n        },\r\n        {\r\n          name: \"Array\",\r\n          items: [\r\n            \"Collection2\",\r\n            \"CollectionNew\",\r\n            \"CollectionRemove\",\r\n            \"CollectionClear\",\r\n            \"CollectionInsert\",\r\n            \"Filter Collection\",\r\n            \"Map Collection\",\r\n            \"Static Data\",\r\n          ],\r\n        },\r\n        {\r\n          name: \"Cloud Data\",\r\n          items: [\r\n            \"DbModel2\",\r\n            \"NewDbModelProperties\",\r\n            \"FilterDBModels\",\r\n            \"SetDbModelProperties\",\r\n            \"DbCollection2\",\r\n            \"DeleteDbModelProperties\",\r\n            \"AddDbModelRelation\",\r\n            \"RemoveDbModelRelation\",\r\n            \"Cloud File\",\r\n            \"Upload File\",\r\n            \"CloudFunction2\",\r\n            \"DbConfig\",\r\n          ],\r\n        },\r\n        {\r\n          name: \"User\",\r\n          items: [\r\n            \"net.noodl.user.LogIn\",\r\n            \"net.noodl.user.LogOut\",\r\n            \"net.noodl.user.SignUp\",\r\n            \"net.noodl.user.User\",\r\n            \"net.noodl.user.SetUserProperties\",\r\n            \"net.noodl.user.VerifyEmail\",\r\n            \"net.noodl.user.SendEmailVerification\",\r\n            \"net.noodl.user.ResetPassword\",\r\n            \"net.noodl.user.RequestPasswordReset\",\r\n          ],\r\n        },\r\n        {\r\n          name: \"External Data\",\r\n          items: [\"REST2\"],\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      name: \"Custom Code\",\r\n      description: \"Custom JavaScript and CSS\",\r\n      type: \"javascript\",\r\n      subCategories: [\r\n        {\r\n          name: \"\",\r\n          items: [\r\n            \"Expression\",\r\n            \"JavaScriptFunction\",\r\n            \"Javascript2\",\r\n            \"CSS Definition\",\r\n          ],\r\n        },\r\n      ],\r\n    },\r\n    {\r\n      name: \"Cloud Functions\",\r\n      description: \"Nodes to be used in cloud functions\",\r\n      type: \"data\",\r\n      subCategories: [\r\n        {\r\n          name: \"\",\r\n          items: [\"noodl.cloud.request\", \"noodl.cloud.response\"],\r\n        },\r\n        {\r\n          name: \"Cloud Data\",\r\n          items: [\"noodl.cloud.aggregate\"],\r\n        },\r\n      ],\r\n    },\r\n  ];\r\n\r\n  obj.nodeIndex = {\r\n    coreNodes,\r\n  };\r\n\r\n  const moduleNodes: string[] = [];\r\n\r\n  nodeTypes.forEach((type) => {\r\n    const nodeMetadata = (nodeRegister as any)._constructors[type].metadata;\r\n    if (nodeMetadata.module) {\r\n      moduleNodes.push(type);\r\n    }\r\n  });\r\n\r\n  if (moduleNodes.length) {\r\n    obj.nodeIndex.moduleNodes = [\r\n      {\r\n        name: \"\",\r\n        items: moduleNodes,\r\n      },\r\n    ];\r\n  }\r\n\r\n  return obj;\r\n}\r\n","import { EventSender } from \"../eventsender\";\r\nimport { Variant } from \"../variants\";\r\nimport type { ComponentModel, Port } from \"./componentmodel\";\r\n\r\n// TODO: What is this? Node?\r\nexport interface NodeData {\r\n  id: string;\r\n  type: string;\r\n  parameters?: Record<string, any>;\r\n  stateParameters?: Record<string, Record<string, any>>;\r\n  stateTransitions?: Record<string, Record<string, any>>;\r\n  defaultStateTransitions?: Record<string, any>;\r\n  ports?: Port[];\r\n  variant?: string;\r\n  name?: string;\r\n  children?: NodeData[];\r\n  metadata?: Record<string, any>;\r\n}\r\n\r\nexport class NodeModel extends EventSender {\r\n  id: string;\r\n  type: string;\r\n  inputs: any[];\r\n  outputs: any[];\r\n  children: NodeModel[];\r\n  parameters: Record<string, any>;\r\n  stateParameters?: Record<string, Record<string, any>>;\r\n  stateTransitions?: Record<string, Record<string, any>>;\r\n  defaultStateTransitions?: Record<string, any>;\r\n  inputPorts: Record<string, Port>;\r\n  outputPorts: Record<string, Port>;\r\n  parent?: NodeModel;\r\n  variant?: Variant | string;\r\n  component?: ComponentModel;\r\n\r\n  // removeListenersWithRef: (ref: any) => void;\r\n\r\n  constructor(id: string, type: string) {\r\n    super();\r\n\r\n    this.id = id;\r\n    this.type = type;\r\n\r\n    this.inputs = [];\r\n    this.outputs = [];\r\n    this.children = [];\r\n    this.parameters = {};\r\n    this.inputPorts = {};\r\n    this.outputPorts = {};\r\n  }\r\n\r\n  setParameter(name: string, value: any, state?: string): void {\r\n    if (state) {\r\n      if (!this.stateParameters) this.stateParameters = {};\r\n      if (!this.stateParameters[state]) this.stateParameters[state] = {};\r\n\r\n      if (value === undefined) {\r\n        delete this.stateParameters[state][name];\r\n      } else {\r\n        this.stateParameters[state][name] = value;\r\n      }\r\n    } else {\r\n      if (value === undefined) {\r\n        delete this.parameters[name];\r\n      } else {\r\n        this.parameters[name] = value;\r\n      }\r\n    }\r\n\r\n    this.emit(\"parameterUpdated\", { name, value, state });\r\n  }\r\n\r\n  setParameters(parameters: Record<string, any>): void {\r\n    Object.keys(parameters).forEach((name) => {\r\n      this.setParameter(name, parameters[name]);\r\n    });\r\n  }\r\n\r\n  setStateParameters(parameters: Record<string, Record<string, any>>): void {\r\n    this.stateParameters = parameters;\r\n  }\r\n\r\n  setStateTransitions(\r\n    stateTransitions: Record<string, Record<string, any>>\r\n  ): void {\r\n    this.stateTransitions = stateTransitions;\r\n  }\r\n\r\n  setStateTransitionParamter(\r\n    parameter: string,\r\n    curve: any,\r\n    state: string\r\n  ): void {\r\n    if (!this.stateTransitions) {\r\n      this.stateTransitions = {};\r\n    }\r\n\r\n    if (curve) {\r\n      this.stateTransitions[state][parameter] = curve;\r\n    } else {\r\n      delete this.stateTransitions[state][parameter];\r\n    }\r\n  }\r\n\r\n  setDefaultStateTransition(stateTransition: any, state: string): void {\r\n    if (!this.defaultStateTransitions) {\r\n      this.defaultStateTransitions = {};\r\n    }\r\n    this.defaultStateTransitions[state] = stateTransition;\r\n  }\r\n\r\n  addInputPort(port: Port): void {\r\n    this.inputPorts[port.name] = port;\r\n    this.emit(\"inputPortAdded\", port);\r\n  }\r\n\r\n  getInputPort(portName: string): Port | undefined {\r\n    return this.inputPorts[portName];\r\n  }\r\n\r\n  getInputPorts(): Record<string, Port> {\r\n    return this.inputPorts;\r\n  }\r\n\r\n  removeInputPortWithName(portName: string): void {\r\n    if (this.inputPorts.hasOwnProperty(portName)) {\r\n      const port = this.inputPorts[portName];\r\n      delete this.inputPorts[portName];\r\n      this.emit(\"inputPortRemoved\", port);\r\n    }\r\n  }\r\n\r\n  updateInputPortTypes(ports: Record<string, Port>): void {\r\n    let changed = false;\r\n    for (const key in ports) {\r\n      if (this.inputPorts[key] !== undefined) {\r\n        this.inputPorts[key].type = ports[key].type;\r\n        changed = true;\r\n      }\r\n    }\r\n    changed && this.emit(\"inputPortTypesUpdated\");\r\n  }\r\n\r\n  addOutputPort(port: Port): void {\r\n    this.outputPorts[port.name] = port;\r\n    this.emit(\"outputPortAdded\", port);\r\n  }\r\n\r\n  getOutputPort(portName: string): Port | undefined {\r\n    return this.outputPorts[portName];\r\n  }\r\n\r\n  getOutputPorts(): Record<string, Port> {\r\n    return this.outputPorts;\r\n  }\r\n\r\n  removeOutputPortWithName(portName: string): void {\r\n    if (this.outputPorts.hasOwnProperty(portName)) {\r\n      const port = this.outputPorts[portName];\r\n      delete this.outputPorts[portName];\r\n      this.emit(\"outputPortRemoved\", port);\r\n    }\r\n  }\r\n\r\n  updateOutputPortTypes(ports: Record<string, Port>): void {\r\n    let changed = false;\r\n    for (const key in ports) {\r\n      if (this.outputPorts[key] !== undefined) {\r\n        this.outputPorts[key].type = ports[key].type;\r\n        changed = true;\r\n      }\r\n    }\r\n    changed && this.emit(\"outputPortTypesUpdated\");\r\n  }\r\n\r\n  addChild(child: NodeModel, index?: number): void {\r\n    child.parent = this;\r\n    if (index === undefined) {\r\n      this.children.push(child);\r\n    } else {\r\n      this.children.splice(index, 0, child);\r\n    }\r\n    this.emit(\"childAdded\", child);\r\n  }\r\n\r\n  removeChild(child: NodeModel): void {\r\n    child.parent = undefined;\r\n    const index = this.children.indexOf(child);\r\n    this.children.splice(index, 1);\r\n    this.emit(\"childRemoved\", child);\r\n  }\r\n\r\n  reset(): void {\r\n    this.removeAllListeners();\r\n  }\r\n\r\n  setVariant(variant: Variant | string): void {\r\n    this.variant = variant;\r\n    this.emit(\"variantUpdated\", variant);\r\n  }\r\n\r\n  static createFromExportData(nodeData: NodeData): NodeModel {\r\n    const node = new NodeModel(nodeData.id, nodeData.type);\r\n    nodeData.parameters && node.setParameters(nodeData.parameters);\r\n    nodeData.stateParameters &&\r\n      node.setStateParameters(nodeData.stateParameters);\r\n    nodeData.stateTransitions &&\r\n      node.setStateTransitions(nodeData.stateTransitions);\r\n\r\n    if (nodeData.defaultStateTransitions) {\r\n      for (const state in nodeData.defaultStateTransitions) {\r\n        node.setDefaultStateTransition(\r\n          nodeData.defaultStateTransitions[state],\r\n          state\r\n        );\r\n      }\r\n    }\r\n\r\n    nodeData.ports &&\r\n      nodeData.ports.forEach((port) => {\r\n        //some ports are incorrectly named outputs instead of output, patch it here so\r\n        //the rest of the code doesn't need to care\r\n        // TODO: WTF...\r\n        // if (port.plug === \"outputs\") {\r\n        //   port.plug = \"output\";\r\n        // }\r\n\r\n        if (port.plug === \"input\" || port.plug === \"input/output\") {\r\n          node.addInputPort(port);\r\n        }\r\n        if (port.plug === \"output\" || port.plug === \"input/output\") {\r\n          node.addOutputPort(port);\r\n        }\r\n      });\r\n\r\n    nodeData.variant && node.setVariant(nodeData.variant);\r\n\r\n    return node;\r\n  }\r\n}\r\n","import type { Connection } from \"../nodescope\";\r\nimport { NodeData, NodeModel } from \"./nodemodel\";\r\nimport { EventSender } from \"../eventsender\";\r\n\r\nexport type PortType =\r\n  | string\r\n  | {\r\n      name: string;\r\n      enums?: Array<{ value: string; label: string }>;\r\n      allowEditOnly?: boolean;\r\n      codeeditor?: string;\r\n      allowConnectionsOnly?: boolean;\r\n      schema?: any;\r\n    };\r\n\r\nexport interface Port {\r\n  name: string;\r\n  plug: \"input\" | \"output\" | \"input/output\";\r\n  type?: PortType;\r\n  group?: string;\r\n  index?: number;\r\n  displayName?: string;\r\n  editorName?: string;\r\n  description?: string;\r\n  tooltip?: string;\r\n  tab?: string;\r\n  popout?: boolean;\r\n  allowVisualStates?: boolean;\r\n  default?: unknown;\r\n  parent?: string;\r\n  parentItemId?: string;\r\n  set?: (value: any) => void;\r\n  getter?: () => any;\r\n}\r\n\r\ninterface ComponentData {\r\n  name: string;\r\n  metadata?: Record<string, any>;\r\n  ports?: Port[];\r\n  nodes?: NodeData[];\r\n  connections?: Connection[];\r\n  roots?: string[];\r\n}\r\n\r\nexport class ComponentModel extends EventSender {\r\n  name: string;\r\n  nodes: Record<string, NodeModel>;\r\n  connections: Connection[];\r\n  roots: string[];\r\n  inputPorts: Record<string, Port>;\r\n  outputPorts: Record<string, Port>;\r\n  metadata: Record<string, any>;\r\n\r\n  constructor(name: string) {\r\n    super();\r\n\r\n    this.name = name;\r\n    this.nodes = {};\r\n    this.connections = [];\r\n    this.roots = [];\r\n    this.inputPorts = {};\r\n    this.outputPorts = {};\r\n    this.metadata = {};\r\n  }\r\n\r\n  async addNode(node: NodeModel): Promise<void> {\r\n    node.component = this;\r\n    this.nodes[node.id] = node;\r\n    await this.emit(\"nodeAdded\", node);\r\n  }\r\n\r\n  hasNodeWithId(id: string): boolean {\r\n    return this.getNodeWithId(id) !== undefined;\r\n  }\r\n\r\n  getNodeWithId(id: string | undefined): NodeModel | undefined {\r\n    if (!id) {\r\n      return undefined;\r\n    }\r\n    return this.nodes[id];\r\n  }\r\n\r\n  getAllNodes(): NodeModel[] {\r\n    return Object.values(this.nodes);\r\n  }\r\n\r\n  getNodesWithType(type: string): NodeModel[] {\r\n    const nodes: NodeModel[] = [];\r\n    Object.keys(this.nodes).forEach((id) => {\r\n      const node = this.nodes[id];\r\n      if (node.type === type) {\r\n        nodes.push(node);\r\n      }\r\n    });\r\n\r\n    return nodes;\r\n  }\r\n\r\n  addConnection(connection: Connection): void {\r\n    this.connections.push(connection);\r\n    this.emit(\"connectionAdded\", connection);\r\n\r\n    //emit an event on the target node model\r\n    //used by numbered inputs\r\n    if (connection.targetId) {\r\n      const node = this.getNodeWithId(connection.targetId);\r\n      if (node) {\r\n        node.emit(\"inputConnectionAdded\", connection);\r\n      }\r\n    }\r\n  }\r\n\r\n  removeConnection(connection: Connection): void {\r\n    const index = this.connections.findIndex((con) => {\r\n      return (\r\n        con.sourceId === connection.sourceId &&\r\n        con.sourcePort === connection.sourcePort &&\r\n        con.targetId === connection.targetId &&\r\n        con.targetPort === connection.targetPort\r\n      );\r\n    });\r\n\r\n    if (index === -1) {\r\n      // TODO: Setup a better logging system\r\n      // console.log(\"Connection doesn't exist\", connection);\r\n      return;\r\n    }\r\n\r\n    this.connections.splice(index, 1);\r\n    this.emit(\"connectionRemoved\", connection);\r\n\r\n    //emit an event on the target node model\r\n    //used by numbered inputs\r\n    if (connection.targetId) {\r\n      const node = this.getNodeWithId(connection.targetId);\r\n      if (node) {\r\n        node.emit(\"inputConnectionRemoved\", connection);\r\n      }\r\n    }\r\n  }\r\n\r\n  getConnectionsFromPort(nodeId: string, sourcePortName: string): Connection[] {\r\n    return this.connections.filter((connection) => {\r\n      return (\r\n        connection.sourceId === nodeId &&\r\n        connection.sourcePort === sourcePortName\r\n      );\r\n    });\r\n  }\r\n\r\n  getConnectionsToPort(nodeId: string, targetPortName: string): Connection[] {\r\n    return this.connections.filter((connection) => {\r\n      return (\r\n        connection.targetId === nodeId &&\r\n        connection.targetPort === targetPortName\r\n      );\r\n    });\r\n  }\r\n\r\n  getConnectionsFrom(nodeId: string): Connection[] {\r\n    return this.connections.filter((connection) => {\r\n      return connection.sourceId === nodeId;\r\n    });\r\n  }\r\n\r\n  getConnectionsTo(nodeId: string): Connection[] {\r\n    return this.connections.filter((connection) => {\r\n      return connection.targetId === nodeId;\r\n    });\r\n  }\r\n\r\n  addRootId(rootId: string | undefined): void {\r\n    if (!rootId) {\r\n      return;\r\n    }\r\n\r\n    if (this.roots.indexOf(rootId) !== -1) {\r\n      return;\r\n    }\r\n    this.roots.push(rootId);\r\n    this.emit(\"rootAdded\", rootId);\r\n  }\r\n\r\n  removeRootId(rootId: string): void {\r\n    const index = this.roots.indexOf(rootId);\r\n    if (index !== -1) {\r\n      this.roots.splice(index, 1);\r\n      this.emit(\"rootRemoved\", rootId);\r\n    }\r\n  }\r\n\r\n  getRoots(): string[] {\r\n    return this.roots;\r\n  }\r\n\r\n  async removeNodeWithId(id: string): Promise<boolean> {\r\n    const node = this.getNodeWithId(id);\r\n\r\n    if (!node) {\r\n      console.warn(\"ERROR: Attempted to remove non-existing node with ID:\", id);\r\n      return false;\r\n    }\r\n\r\n    //remove children first\r\n    while (node.children.length > 0) {\r\n      const child = node.children[0];\r\n      const childRemoved = await this.removeNodeWithId(child.id);\r\n      if (!childRemoved) {\r\n        // Workaround for corrupt node trees, should never happen, a remove should always be successful\r\n        node.children.shift();\r\n      }\r\n    }\r\n\r\n    const connections = this.getConnectionsTo(id).concat(\r\n      this.getConnectionsFrom(id)\r\n    );\r\n\r\n    for (let i = 0; i < connections.length; i++) {\r\n      this.removeConnection(connections[i]);\r\n    }\r\n\r\n    this.setNodeParent(node, undefined);\r\n\r\n    if (this.roots.indexOf(node.id) !== -1) {\r\n      this.removeRootId(node.id);\r\n    }\r\n\r\n    await this.emit(\"nodeRemoved\", node);\r\n\r\n    node.removeAllListeners();\r\n    delete this.nodes[id];\r\n\r\n    await this.emit(\"nodeWasRemoved\", node);\r\n    return true;\r\n  }\r\n\r\n  getAllConnections(): Connection[] {\r\n    return this.connections;\r\n  }\r\n\r\n  getInputPorts(): Record<string, Port> {\r\n    return this.inputPorts;\r\n  }\r\n\r\n  getOutputPorts(): Record<string, Port> {\r\n    return this.outputPorts;\r\n  }\r\n\r\n  addInputPort(port: Port): void {\r\n    this.inputPorts[port.name] = port;\r\n    this.emit(\"inputPortAdded\", port);\r\n  }\r\n\r\n  addOutputPort(port: Port): void {\r\n    this.outputPorts[port.name] = port;\r\n    this.emit(\"outputPortAdded\", port);\r\n  }\r\n\r\n  removeOutputPortWithName(portName: string): void {\r\n    if (this.outputPorts.hasOwnProperty(portName)) {\r\n      const port = this.outputPorts[portName];\r\n      delete this.outputPorts[portName];\r\n      this.emit(\"outputPortRemoved\", port);\r\n    }\r\n  }\r\n\r\n  removeInputPortWithName(portName: string): void {\r\n    if (this.inputPorts.hasOwnProperty(portName)) {\r\n      const port = this.inputPorts[portName];\r\n      delete this.inputPorts[portName];\r\n      this.emit(\"inputPortRemoved\", port);\r\n    }\r\n  }\r\n\r\n  updateInputPortTypes(ports: Record<string, Port>): void {\r\n    let changed = false;\r\n    for (const key in ports) {\r\n      if (this.inputPorts[key] !== undefined) {\r\n        this.inputPorts[key].type = ports[key].type;\r\n        changed = true;\r\n      }\r\n    }\r\n    changed && this.emit(\"inputPortTypesUpdated\");\r\n  }\r\n\r\n  updateOutputPortTypes(ports: Record<string, Port>): void {\r\n    let changed = false;\r\n    for (const key in ports) {\r\n      if (this.outputPorts[key] !== undefined) {\r\n        this.outputPorts[key].type = ports[key].type;\r\n        changed = true;\r\n      }\r\n    }\r\n    changed && this.emit(\"outputPortTypesUpdated\");\r\n  }\r\n\r\n  renameInputPortOnNodeWithId(\r\n    id: string,\r\n    oldName: string,\r\n    newName: string\r\n  ): void {\r\n    //remove connections\r\n    const connections = this.getConnectionsToPort(id, oldName);\r\n    connections.forEach(this.removeConnection.bind(this));\r\n\r\n    //get port before deleting it\r\n    const nodeModel = this.getNodeWithId(id);\r\n    if (!nodeModel) return;\r\n\r\n    // @ts-expect-error TODO: What is this?\r\n    const port: Port = { ...nodeModel.getInputPort(oldName) };\r\n\r\n    //remove old port\r\n    if (port) {\r\n      nodeModel.removeInputPortWithName(oldName);\r\n\r\n      //rename and add new port\r\n      port.name = newName;\r\n      nodeModel.addInputPort(port);\r\n    }\r\n\r\n    //add new connection\r\n    connections.forEach((connection) => {\r\n      connection.targetPort = newName;\r\n    });\r\n\r\n    connections.forEach(this.addConnection.bind(this));\r\n  }\r\n\r\n  renameOutputPortOnNodeWithId(\r\n    id: string,\r\n    oldName: string,\r\n    newName: string\r\n  ): void {\r\n    //remove connections\r\n    const connections = this.getConnectionsFromPort(id, oldName);\r\n    connections.forEach(this.removeConnection.bind(this));\r\n\r\n    //get port before deleting it\r\n    const nodeModel = this.getNodeWithId(id);\r\n    if (!nodeModel) return;\r\n\r\n    // @ts-expect-error TODO: What is this?\r\n    const port: Port = { ...nodeModel.getOutputPort(oldName) };\r\n\r\n    //remove old port\r\n    nodeModel.removeOutputPortWithName(oldName);\r\n\r\n    //rename and add new port\r\n    port.name = newName;\r\n    nodeModel.addOutputPort(port);\r\n\r\n    //add new connection\r\n    connections.forEach((connection) => {\r\n      connection.sourcePort = newName;\r\n    });\r\n\r\n    connections.forEach(this.addConnection.bind(this));\r\n  }\r\n\r\n  setNodeParent(\r\n    childModel: NodeModel | undefined,\r\n    newParentModel: NodeModel | null | undefined,\r\n    index?: number\r\n  ): void {\r\n    if (!childModel) {\r\n      return;\r\n    }\r\n\r\n    if (this.roots.indexOf(childModel.id) !== -1) {\r\n      this.removeRootId(childModel.id);\r\n    }\r\n\r\n    if (childModel.parent) {\r\n      this.emit(\"nodeParentWillBeRemoved\", childModel);\r\n      childModel.parent.removeChild(childModel);\r\n    }\r\n    childModel.emit(\"parentUpdated\", newParentModel);\r\n    if (newParentModel) {\r\n      newParentModel.addChild(childModel, index);\r\n      this.emit(\"nodeParentUpdated\", childModel);\r\n    }\r\n  }\r\n\r\n  async importEditorNodeData(\r\n    nodeData: NodeData,\r\n    parentId?: string,\r\n    childIndex?: number\r\n  ): Promise<void> {\r\n    const nodeModel = NodeModel.createFromExportData(nodeData);\r\n    await this.addNode(nodeModel);\r\n\r\n    if (parentId) {\r\n      this.setNodeParent(nodeModel, this.getNodeWithId(parentId), childIndex);\r\n    }\r\n\r\n    if (nodeData.children) {\r\n      for (let i = 0; i < nodeData.children.length; i++) {\r\n        const child = nodeData.children[i];\r\n        await this.importEditorNodeData(child, nodeModel.id, i);\r\n      }\r\n    }\r\n  }\r\n\r\n  async reset(): Promise<void> {\r\n    while (this.roots.length) {\r\n      await this.removeNodeWithId(this.roots[0]);\r\n    }\r\n\r\n    for (const id of Object.keys(this.nodes)) {\r\n      //note: with an incomplete library there will be no roots\r\n      //so some of the nodes will have children, which will be recursively removed by\r\n      //removeNodeWithId(), so some IDs from the Object.keys(this.nodes) that runs this loop\r\n      //will already have been removed, so check if they exist before removing\r\n      if (this.hasNodeWithId(id)) {\r\n        await this.removeNodeWithId(id);\r\n      }\r\n    }\r\n\r\n    if (Object.keys(this.nodes).length > 0) {\r\n      throw new Error(\"Not all nodes were removed during a reset\");\r\n    }\r\n\r\n    if (this.connections.length > 0) {\r\n      throw new Error(\"Not all connections were removed during a reset\");\r\n    }\r\n  }\r\n\r\n  rename(newName: string): void {\r\n    const oldName = this.name;\r\n    this.name = newName;\r\n    this.emit(\"renamed\", { oldName, newName });\r\n  }\r\n\r\n  setMetadata(key: string, data: any): void {\r\n    this.metadata[key] = data;\r\n  }\r\n\r\n  getMetadata(key?: string): any {\r\n    if (!key) return this.metadata;\r\n    return this.metadata[key];\r\n  }\r\n\r\n  static async createFromExportData(\r\n    componentData: ComponentData\r\n  ): Promise<ComponentModel> {\r\n    const componentModel = new ComponentModel(componentData.name);\r\n\r\n    if (componentData.metadata) {\r\n      for (const key in componentData.metadata) {\r\n        componentModel.setMetadata(key, componentData.metadata[key]);\r\n      }\r\n    }\r\n\r\n    componentData.ports &&\r\n      componentData.ports.forEach((port) => {\r\n        if (port.plug === \"input\" || port.plug === \"input/output\") {\r\n          componentModel.addInputPort(port);\r\n        }\r\n        if (port.plug === \"output\" || port.plug === \"input/output\") {\r\n          componentModel.addOutputPort(port);\r\n        }\r\n      });\r\n\r\n    if (componentData.nodes) {\r\n      for (const node of componentData.nodes) {\r\n        await componentModel.importEditorNodeData(node);\r\n      }\r\n    }\r\n\r\n    componentData.connections &&\r\n      componentData.connections.forEach((connection) =>\r\n        componentModel.addConnection(connection)\r\n      );\r\n    componentData.roots &&\r\n      componentData.roots.forEach((root) => componentModel.addRootId(root));\r\n\r\n    return componentModel;\r\n  }\r\n}\r\n","\"use strict\";\r\n\r\nimport { ComponentModel } from \"./componentmodel\";\r\nimport { EventSender } from \"../eventsender\";\r\nimport { Event } from \"../editormodeleventshandler\";\r\nimport { Variant } from \"../variants\";\r\n\r\ninterface Settings {\r\n  [key: string]: any;\r\n}\r\n\r\ninterface Metadata {\r\n  [key: string]: any;\r\n}\r\n\r\ninterface ComponentIndex {\r\n  [key: string]: {\r\n    components: string[];\r\n    dependencies: string[];\r\n  };\r\n}\r\n\r\nexport interface RouterIndex {\r\n  [key: string]: any;\r\n}\r\n\r\ninterface ExportData {\r\n  componentIndex: ComponentIndex;\r\n  routerIndex: RouterIndex;\r\n  variants?: Variant[];\r\n  settings?: Settings;\r\n  metadata?: Metadata;\r\n  components: any[];\r\n  rootComponent: string;\r\n}\r\n\r\nclass GraphModel extends EventSender {\r\n  private components: { [key: string]: ComponentModel };\r\n  private settings: Settings;\r\n  private metadata: Metadata;\r\n  private componentIndex: ComponentIndex | undefined;\r\n  routerIndex: RouterIndex | undefined;\r\n  private componentToBundleMap: Map<string, string> = new Map();\r\n  private variants: Variant[] = [];\r\n  rootComponent: string | undefined;\r\n\r\n  constructor() {\r\n    super();\r\n    this.components = {};\r\n    this.settings = {};\r\n    this.metadata = {};\r\n  }\r\n\r\n  async importComponentFromEditorData(componentData: any): Promise<void> {\r\n    const componentModel = await ComponentModel.createFromExportData(\r\n      componentData\r\n    );\r\n    this.addComponent(componentModel);\r\n  }\r\n\r\n  getBundleContainingComponent(name: string): string | undefined {\r\n    return this.componentToBundleMap.get(name);\r\n  }\r\n\r\n  getBundlesContainingSheet(sheetName: string): string[] {\r\n    const bundles = new Set<string>();\r\n    for (const name of this.componentToBundleMap.keys()) {\r\n      const isOnDefaultSheet = name.indexOf(\"/#\") !== 0;\r\n\r\n      const isMatch =\r\n        (isOnDefaultSheet && sheetName === \"Default\") ||\r\n        (!isOnDefaultSheet && name.indexOf(\"/#\" + sheetName) === 0);\r\n\r\n      if (isMatch) {\r\n        bundles.add(this.componentToBundleMap.get(name)!);\r\n      }\r\n    }\r\n    return Array.from(bundles);\r\n  }\r\n\r\n  getBundleDependencies(bundleName: string): string[] {\r\n    const result = new Set<string>();\r\n\r\n    const recurse = (name: string) => {\r\n      const bundle = this.componentIndex?.[name];\r\n      if (bundle) {\r\n        for (const dep of bundle.dependencies) {\r\n          if (!result.has(dep)) {\r\n            result.add(dep);\r\n            recurse(dep);\r\n          }\r\n        }\r\n      }\r\n    };\r\n\r\n    recurse(bundleName);\r\n\r\n    return Array.from(result);\r\n  }\r\n\r\n  async importEditorData(exportData: ExportData): Promise<void> {\r\n    this.componentIndex = exportData.componentIndex;\r\n    this.routerIndex = exportData.routerIndex;\r\n\r\n    this.componentToBundleMap = new Map();\r\n\r\n    for (const bundleName in exportData.componentIndex) {\r\n      const bundle = exportData.componentIndex[bundleName];\r\n\r\n      for (const componentName of bundle.components) {\r\n        this.componentToBundleMap.set(componentName, bundleName);\r\n      }\r\n    }\r\n\r\n    this.variants = exportData.variants || [];\r\n\r\n    exportData.settings && this.setSettings(exportData.settings);\r\n\r\n    exportData.metadata && this.setAllMetaData(exportData.metadata);\r\n\r\n    for (const component of exportData.components) {\r\n      await this.importComponentFromEditorData(component);\r\n    }\r\n\r\n    this.setRootComponentName(exportData.rootComponent);\r\n  }\r\n\r\n  setRootComponentName(componentName: string): void {\r\n    this.rootComponent = componentName;\r\n    this.emit(\"rootComponentNameUpdated\", componentName);\r\n  }\r\n\r\n  getNodesWithType(type: string): any[] {\r\n    let nodes: any[] = [];\r\n\r\n    const componentNames = Object.keys(this.components);\r\n    for (let i = 0; i < componentNames.length; i++) {\r\n      const component = this.components[componentNames[i]];\r\n      nodes = nodes.concat(component.getNodesWithType(type));\r\n    }\r\n    return nodes;\r\n  }\r\n\r\n  getComponentWithName(type: string): ComponentModel | undefined {\r\n    return this.components[type];\r\n  }\r\n\r\n  hasComponentWithName(type: string): boolean {\r\n    return this.components[type] ? true : false;\r\n  }\r\n\r\n  getAllComponents(): ComponentModel[] {\r\n    return Object.keys(this.components).map((name) => {\r\n      return this.components[name];\r\n    });\r\n  }\r\n\r\n  getAllNodes(): any[] {\r\n    let nodes: any[] = [];\r\n\r\n    const componentNames = Object.keys(this.components);\r\n    for (let i = 0; i < componentNames.length; i++) {\r\n      const component = this.components[componentNames[i]];\r\n      nodes = nodes.concat(component.getAllNodes());\r\n    }\r\n\r\n    return nodes;\r\n  }\r\n\r\n  addComponent(component: ComponentModel): void {\r\n    this.components[component.name] = component;\r\n\r\n    this.getNodesWithType(component.name).forEach(\r\n      this._addComponentPorts.bind(this)\r\n    );\r\n\r\n    component.getAllNodes().forEach(this._onNodeAdded.bind(this));\r\n\r\n    component.on(\"nodeAdded\", this._onNodeAdded.bind(this), this);\r\n\r\n    component.on(\"nodeRemoved\", this._onNodeRemoved.bind(this), this);\r\n    component.on(\"nodeWasRemoved\", this._onNodeWasRemoved.bind(this), this);\r\n\r\n    this.emit(\"componentAdded\", component);\r\n  }\r\n\r\n  async removeComponentWithName(\r\n    componentName: string | undefined\r\n  ): Promise<void> {\r\n    if (!componentName) {\r\n      return;\r\n    }\r\n\r\n    if (this.components.hasOwnProperty(componentName) === false) {\r\n      console.error(\r\n        \"GraphModel: Component with name \" + componentName + \" not in graph\"\r\n      );\r\n      return;\r\n    }\r\n\r\n    const component = this.components[componentName];\r\n    await component.reset();\r\n\r\n    component.removeAllListeners();\r\n    delete this.components[component.name];\r\n\r\n    this.emit(\"componentRemoved\", component);\r\n  }\r\n\r\n  renameComponent(componentName: string, newName: string): void {\r\n    if (this.components.hasOwnProperty(componentName) === false) {\r\n      console.error(\r\n        \"GraphModel: Component with name \" + componentName + \" not in graph\"\r\n      );\r\n      return;\r\n    }\r\n\r\n    this.getNodesWithType(componentName).forEach(function (nodeModel) {\r\n      nodeModel.type = newName;\r\n    });\r\n\r\n    const component = this.components[componentName];\r\n    component.rename(newName);\r\n\r\n    delete this.components[componentName];\r\n    this.components[newName] = component;\r\n\r\n    this.emit(\"componentRenamed\", component);\r\n  }\r\n\r\n  private _addComponentPorts(node: any): void {\r\n    if (this.components.hasOwnProperty(node.type)) {\r\n      const component = this.components[node.type];\r\n\r\n      const inputPorts = component.getInputPorts();\r\n      const outputPorts = component.getOutputPorts();\r\n\r\n      Object.keys(inputPorts).forEach((portName) => {\r\n        node.addInputPort(inputPorts[portName]);\r\n      });\r\n\r\n      Object.keys(outputPorts).forEach((portName) => {\r\n        node.addOutputPort(outputPorts[portName]);\r\n      });\r\n    }\r\n  }\r\n\r\n  private _onNodeAdded(node: any): void {\r\n    this._addComponentPorts(node);\r\n\r\n    this.emit(\"nodeAdded\", node);\r\n    this.emit(\"nodeAdded.\" + node.type, node);\r\n  }\r\n\r\n  private _onNodeRemoved(node: any): void {\r\n    this.emit(\"nodeRemoved\", node);\r\n    this.emit(\"nodeRemoved.\" + node.type, node);\r\n  }\r\n\r\n  private _onNodeWasRemoved(node: any): void {\r\n    this.emit(\"nodeWasRemoved\", node);\r\n    this.emit(\"nodeWasRemoved.\" + node.type, node);\r\n  }\r\n\r\n  async reset(): Promise<void> {\r\n    for (const componentName of Object.keys(this.components)) {\r\n      await this.removeComponentWithName(componentName);\r\n    }\r\n    this.setSettings({});\r\n  }\r\n\r\n  isEmpty(): boolean {\r\n    return Object.keys(this.components).length === 0;\r\n  }\r\n\r\n  setSettings(settings: Settings): void {\r\n    this.settings = settings;\r\n    this.emit(\"projectSettingsChanged\", settings);\r\n  }\r\n\r\n  getSettings(): Settings {\r\n    return this.settings;\r\n  }\r\n\r\n  setAllMetaData(metadata: Metadata): void {\r\n    for (const p in metadata) {\r\n      this.setMetaData(p, metadata[p]);\r\n    }\r\n  }\r\n\r\n  setMetaData(key: string, data: any): void {\r\n    if (\r\n      this.metadata[key] &&\r\n      JSON.stringify(this.metadata[key]) === JSON.stringify(data)\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    this.metadata[key] = data;\r\n    this.emit(\"metadataChanged\", { key, data });\r\n    this.emit(\"metadataChanged.\" + key, data);\r\n  }\r\n\r\n  getMetaData(key?: string): any {\r\n    if (key) return this.metadata[key];\r\n    return this.metadata;\r\n  }\r\n\r\n  getVariants(): Variant[] {\r\n    return this.variants || [];\r\n  }\r\n\r\n  getVariant(typename: string, name: string): Variant | undefined {\r\n    return this.variants.find(\r\n      (v) => v.name === name && v.typename === typename\r\n    );\r\n  }\r\n\r\n  updateVariant(variant: Variant): void {\r\n    const i = this.variants.findIndex(\r\n      (v) => v.name === variant.name && v.typename === variant.typename\r\n    );\r\n    if (i !== -1) this.variants.splice(i, 1);\r\n    this.variants.push(variant);\r\n\r\n    this.emit(\"variantUpdated\", variant);\r\n  }\r\n\r\n  updateVariantParameter(\r\n    variantName: string,\r\n    variantTypeName: string,\r\n    parameterName: string,\r\n    parameterValue: any,\r\n    state?: string\r\n  ): void {\r\n    const variant = this.getVariant(variantTypeName, variantName);\r\n    if (!variant) {\r\n      console.log(\r\n        \"updateVariantParameter: can't find variant\",\r\n        variantName,\r\n        variantTypeName\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (!state) {\r\n      if (parameterValue === undefined) {\r\n        delete variant.parameters[parameterName];\r\n      } else {\r\n        variant.parameters[parameterName] = parameterValue;\r\n      }\r\n    } else {\r\n      if (!variant.stateParameters.hasOwnProperty(state)) {\r\n        variant.stateParameters[state] = {};\r\n      }\r\n\r\n      if (parameterValue === undefined) {\r\n        delete variant.stateParameters[state][parameterName];\r\n      } else {\r\n        variant.stateParameters[state][parameterName] = parameterValue;\r\n      }\r\n    }\r\n\r\n    this.emit(\"variantUpdated\", variant);\r\n  }\r\n\r\n  updateVariantDefaultStateTransition(\r\n    variantName: string,\r\n    variantTypeName: string,\r\n    transition: any,\r\n    state: string\r\n  ): void {\r\n    const variant = this.getVariant(variantTypeName, variantName);\r\n    if (!variant) return;\r\n\r\n    variant.defaultStateTransitions[state] = transition;\r\n    this.emit(\"variantUpdated\", variant);\r\n  }\r\n\r\n  updateVariantStateTransition(args: Event): void {\r\n    const { variantTypeName, variantName, state, parameterName, curve } = args;\r\n\r\n    const variant = this.getVariant(variantTypeName!, variantName!);\r\n    if (!variant) return;\r\n\r\n    if (!variant.stateTransitions[state]) {\r\n      variant.stateTransitions[state] = {};\r\n    }\r\n\r\n    variant.stateTransitions[state][parameterName!] = curve;\r\n  }\r\n\r\n  deleteVariant(typename: string, name: string): void {\r\n    const i = this.variants.findIndex(\r\n      (v) => v.name === name && v.typename === typename\r\n    );\r\n    if (i !== -1) this.variants.splice(i, 1);\r\n  }\r\n}\r\n\r\nexport { GraphModel };\r\n","import { NodeContext } from \"./nodecontext\";\r\nimport { GraphModel, RouterIndex } from \"./models/graphmodel\";\r\nimport { ComponentModel, Port } from \"./models/componentmodel\";\r\nimport { NodeModel } from \"./models/nodemodel\";\r\nimport { NodeScope } from \"./nodescope\";\r\n\r\nexport interface Event {\r\n  type: string;\r\n  componentName?: string;\r\n  model?: any;\r\n  nodeId?: string;\r\n  parentId?: string;\r\n  childIndex?: number;\r\n  port?: Port;\r\n  parameters?: Record<string, any>;\r\n  oldParameters?: Record<string, any>;\r\n  parameterName?: string;\r\n  parameterValue?: any;\r\n  state?: any;\r\n  ports?: Port[];\r\n  oldName?: string;\r\n  newName?: string;\r\n  settings?: any;\r\n  key?: string;\r\n  data?: any;\r\n  variant?: any;\r\n  variantName?: string;\r\n  variantTypeName?: string;\r\n  oldVariantName?: string;\r\n  curve?: any;\r\n  name?: string;\r\n}\r\n\r\nfunction difference(array1: string[], array2: string[]): string[] {\r\n  const valueSet = new Set(array2);\r\n  return array1.filter((e) => !valueSet.has(e));\r\n}\r\n\r\nasync function handleEvent(\r\n  context: NodeContext,\r\n  graphModel: GraphModel,\r\n  event: Event\r\n): Promise<void> {\r\n  function applyPortDelta(\r\n    nodeModel: ComponentModel | NodeModel,\r\n    newPorts: Port[]\r\n  ): void {\r\n    const inputPorts: Record<string, Port> = {};\r\n    const outputPorts: Record<string, Port> = {};\r\n\r\n    newPorts.forEach((port: Port) => {\r\n      // TODO: WTF...\r\n      // if (port && port.plug === \"outputs\") {\r\n      //   port.plug = \"output\";\r\n      // }\r\n\r\n      if (port.plug === \"input\" || port.plug === \"input/output\") {\r\n        inputPorts[port.name] = port;\r\n      }\r\n      if (port.plug === \"output\" || port.plug === \"input/output\") {\r\n        outputPorts[port.name] = port;\r\n      }\r\n    });\r\n\r\n    const existingInputs = Object.keys(nodeModel.getInputPorts());\r\n\r\n    const inputPortsToRemove = difference(\r\n      existingInputs,\r\n      Object.keys(inputPorts)\r\n    );\r\n    const inputPortsToAdd = difference(Object.keys(inputPorts), existingInputs);\r\n\r\n    nodeModel.updateInputPortTypes(inputPorts);\r\n\r\n    inputPortsToRemove.forEach(\r\n      nodeModel.removeInputPortWithName.bind(nodeModel)\r\n    );\r\n    inputPortsToAdd.forEach((portName: string) => {\r\n      nodeModel.addInputPort(inputPorts[portName]);\r\n      if (nodeModel instanceof NodeModel) {\r\n        if (nodeModel.parameters?.hasOwnProperty(portName)) {\r\n          setInputValueOnNodeInstancesWithModel(\r\n            context.rootComponent!.nodeScope,\r\n            nodeModel,\r\n            portName,\r\n            nodeModel.parameters[portName]\r\n          );\r\n        }\r\n      }\r\n    });\r\n\r\n    nodeModel.updateOutputPortTypes(outputPorts);\r\n\r\n    const existingOutputs = Object.keys(nodeModel.getOutputPorts());\r\n\r\n    const outputPortsToRemove = difference(\r\n      existingOutputs,\r\n      Object.keys(outputPorts)\r\n    );\r\n    const outputPortsToAdd = difference(\r\n      Object.keys(outputPorts),\r\n      existingOutputs\r\n    );\r\n\r\n    outputPortsToRemove.forEach(\r\n      nodeModel.removeOutputPortWithName.bind(nodeModel)\r\n    );\r\n    outputPortsToAdd.forEach((portName: string) => {\r\n      nodeModel.addOutputPort(outputPorts[portName]);\r\n    });\r\n  }\r\n\r\n  function setInputValueOnNodeInstancesWithModel(\r\n    nodeScope: NodeScope,\r\n    nodeModel: NodeModel,\r\n    port: string,\r\n    value: any\r\n  ): void {\r\n    const nodes = nodeScope.getNodesWithIdRecursive(nodeModel.id);\r\n    nodes.forEach((node) => {\r\n      node.queueInput(port, value);\r\n    });\r\n  }\r\n\r\n  let componentModel: ComponentModel | undefined;\r\n  if (event.componentName) {\r\n    componentModel = graphModel.getComponentWithName(event.componentName);\r\n  }\r\n\r\n  if (!componentModel) {\r\n    return;\r\n  }\r\n\r\n  // TODO: WTF...\r\n  // if (event.port && event.port.plug === \"outputs\") {\r\n  //   event.port.plug = \"output\";\r\n  // }\r\n\r\n  const eventHandlers: Record<string, (event: Event) => Promise<void> | void> =\r\n    {\r\n      nodeAdded: (event: Event): void => {\r\n        componentModel?.importEditorNodeData(\r\n          event.model,\r\n          event.parentId,\r\n          event.childIndex\r\n        );\r\n      },\r\n      nodeRemoved: async (event: Event): Promise<void> => {\r\n        if (componentModel?.hasNodeWithId(event.model.id)) {\r\n          await componentModel.removeNodeWithId(event.model.id);\r\n        }\r\n      },\r\n      connectionAdded: (event: Event): void => {\r\n        componentModel?.addConnection(event.model);\r\n      },\r\n      connectionRemoved: (event: Event): void => {\r\n        if (!componentModel) {\r\n          return;\r\n        }\r\n\r\n        componentModel.removeConnection(event.model);\r\n\r\n        const targetNodeModel = componentModel.getNodeWithId(\r\n          event.model.targetId\r\n        )!;\r\n        if (\r\n          componentModel.getConnectionsToPort(\r\n            targetNodeModel.id,\r\n            event.model.targetId\r\n          ).length === 0\r\n        ) {\r\n          let value = targetNodeModel.parameters[event.model.targetPort];\r\n          if (value === undefined) {\r\n            value = context.getDefaultValueForInput(\r\n              targetNodeModel.type,\r\n              event.model.targetPort\r\n            );\r\n          }\r\n\r\n          setInputValueOnNodeInstancesWithModel(\r\n            context.rootComponent!.nodeScope,\r\n            targetNodeModel,\r\n            event.model.targetPort,\r\n            value\r\n          );\r\n        }\r\n      },\r\n      parameterChanged: (event: Event): void => {\r\n        if (!componentModel) {\r\n          return;\r\n        }\r\n\r\n        const nodeModel = componentModel.getNodeWithId(event.nodeId!);\r\n        if (nodeModel === undefined) {\r\n          console.log(\"parameterChanged: Unknown node id\", event);\r\n          return;\r\n        }\r\n\r\n        if (event.parameters) {\r\n          const allParams = new Set([\r\n            ...Object.keys(event.parameters),\r\n            ...Object.keys(event.oldParameters!),\r\n          ]);\r\n          for (const param of allParams) {\r\n            nodeModel.setParameter(param, event.parameters[param]);\r\n          }\r\n        }\r\n\r\n        if (event.parameterName) {\r\n          nodeModel.setParameter(\r\n            event.parameterName,\r\n            event.parameterValue,\r\n            event.state\r\n          );\r\n        }\r\n      },\r\n      nodeAttached: (event: Event): void => {\r\n        if (!componentModel) {\r\n          return;\r\n        }\r\n\r\n        componentModel.setNodeParent(\r\n          componentModel.getNodeWithId(event.nodeId),\r\n          componentModel.getNodeWithId(event.parentId),\r\n          event.childIndex\r\n        );\r\n      },\r\n      nodeDetached: (event: Event): void => {\r\n        if (!componentModel) {\r\n          return;\r\n        }\r\n\r\n        componentModel.setNodeParent(\r\n          componentModel.getNodeWithId(event.nodeId!),\r\n          null\r\n        );\r\n        componentModel.addRootId(event.nodeId!);\r\n      },\r\n      componentAdded: (event: Event): void => {\r\n        graphModel.importComponentFromEditorData(event.model);\r\n      },\r\n      componentRemoved: async (event: Event): Promise<void> => {\r\n        await graphModel.removeComponentWithName(event.componentName);\r\n      },\r\n      rootAdded: (event: Event): void => {\r\n        componentModel?.addRootId(event.nodeId);\r\n      },\r\n      portAdded: (event: Event): void => {\r\n        if (!componentModel) {\r\n          return;\r\n        }\r\n\r\n        const nodeModel = componentModel.getNodeWithId(event.nodeId);\r\n        if (!event.port || !nodeModel) {\r\n          return;\r\n        }\r\n\r\n        if (event.port.plug === \"input\" || event.port.plug === \"input/output\") {\r\n          nodeModel.addInputPort(event.port);\r\n\r\n          // TODO: Was here a bug before?\r\n          if (nodeModel.parameters.hasOwnProperty(event.port.name)) {\r\n            setInputValueOnNodeInstancesWithModel(\r\n              context.rootComponent!.nodeScope,\r\n              nodeModel,\r\n              event.port.name,\r\n              nodeModel.parameters[event.port.name]\r\n            );\r\n          }\r\n        }\r\n        if (\r\n          event.port.plug === \"output\" ||\r\n          event.port.plug === \"input/output\"\r\n        ) {\r\n          nodeModel.addOutputPort(event.port);\r\n        }\r\n      },\r\n      portRemoved: (event: Event): void => {\r\n        if (!componentModel) {\r\n          return;\r\n        }\r\n\r\n        const nodeModel = componentModel.getNodeWithId(event.nodeId);\r\n        if (!event.port || !nodeModel) {\r\n          return;\r\n        }\r\n\r\n        if (event.port.plug === \"input\" || event.port.plug === \"input/output\") {\r\n          nodeModel.removeInputPortWithName(event.port.name);\r\n        }\r\n        if (\r\n          event.port.plug === \"output\" ||\r\n          event.port.plug === \"input/output\"\r\n        ) {\r\n          nodeModel.removeOutputPortWithName(event.port.name);\r\n        }\r\n      },\r\n      nodePortRenamed: (event: Event): void => {\r\n        if (!event.port || !componentModel) {\r\n          return;\r\n        }\r\n\r\n        if (event.port.plug === \"input\" || event.port.plug === \"input/output\") {\r\n          if (event.nodeId && event.oldName) {\r\n            componentModel.renameInputPortOnNodeWithId(\r\n              event.nodeId,\r\n              event.oldName,\r\n              event.port.name\r\n            );\r\n          }\r\n        }\r\n        if (\r\n          event.nodeId &&\r\n          event.oldName &&\r\n          (event.port.plug === \"output\" || event.port.plug === \"input/output\")\r\n        ) {\r\n          componentModel.renameOutputPortOnNodeWithId(\r\n            event.nodeId,\r\n            event.oldName,\r\n            event.port.name\r\n          );\r\n        }\r\n        const node = componentModel.getNodeWithId(event.nodeId);\r\n        if (node?.type === \"Component Inputs\") {\r\n          componentModel.addInputPort(event.port);\r\n          graphModel\r\n            .getNodesWithType(componentModel.name)\r\n            .forEach((componentInstance) => {\r\n              componentInstance.component.renameInputPortOnNodeWithId(\r\n                componentInstance.id,\r\n                event.oldName,\r\n                event.port?.name\r\n              );\r\n            });\r\n          componentModel.removeInputPortWithName(event.oldName!);\r\n        } else if (node?.type === \"Component Outputs\") {\r\n          componentModel.addOutputPort(event.port);\r\n          graphModel\r\n            .getNodesWithType(componentModel!.name)\r\n            .forEach((componentInstance) => {\r\n              componentInstance.component.renameOutputPortOnNodeWithId(\r\n                componentInstance.id,\r\n                event.oldName,\r\n                event.port?.name\r\n              );\r\n            });\r\n          componentModel.removeOutputPortWithName(event.oldName!);\r\n        }\r\n      },\r\n      componentPortsUpdated: (event: Event): void => {\r\n        if (componentModel) {\r\n          applyPortDelta(componentModel, event.ports!);\r\n        }\r\n      },\r\n      instancePortsChanged: (event: Event): void => {\r\n        if (!componentModel!.hasNodeWithId(event.nodeId!)) return;\r\n        const nodeModel = componentModel!.getNodeWithId(event.nodeId!);\r\n        if (nodeModel) {\r\n          applyPortDelta(nodeModel, event.ports!);\r\n        }\r\n      },\r\n      componentRenamed: (event: Event): void => {\r\n        graphModel.renameComponent(event.oldName!, event.newName!);\r\n      },\r\n      settingsChanged: (event: Event): void => {\r\n        graphModel.setSettings(event.settings);\r\n      },\r\n      metadataChanged: (event: Event): void => {\r\n        graphModel.setMetaData(event.key!, event.data);\r\n      },\r\n      componentMetadataChanged: (event: Event): void => {\r\n        const c = graphModel.getComponentWithName(event.componentName!);\r\n        if (!c) return;\r\n        c.setMetadata(event.key!, event.data);\r\n      },\r\n      variantParametersChanged: (event: Event): void => {\r\n        if (event.variant) {\r\n          graphModel.updateVariant(event.variant);\r\n        } else {\r\n          graphModel.updateVariantParameter(\r\n            event.variantName!,\r\n            event.variantTypeName!,\r\n            event.parameterName!,\r\n            event.parameterValue,\r\n            event.state\r\n          );\r\n\r\n          if (event.parameterValue === undefined) {\r\n            const variant = graphModel.getVariant(\r\n              event.variantTypeName!,\r\n              event.variantName!\r\n            );\r\n            const nodes =\r\n              context.rootComponent!.nodeScope.getAllNodesWithVariantRecursive(\r\n                variant!\r\n              );\r\n            nodes.forEach((node) => {\r\n              node.queueInput(\r\n                event.parameterName,\r\n                node.getParameter(event.parameterName)\r\n              );\r\n            });\r\n          }\r\n        }\r\n      },\r\n      variantDeleted: (event: Event): void => {\r\n        graphModel.deleteVariant(event.variantTypeName!, event.variantName!);\r\n      },\r\n      variantChanged: (event: Event): void => {\r\n        const nodeModel = componentModel!.getNodeWithId(event.nodeId);\r\n        if (nodeModel) {\r\n          const variant = graphModel.getVariant(\r\n            nodeModel.type,\r\n            event.variantName!\r\n          );\r\n\r\n          nodeModel.setVariant(variant!);\r\n        }\r\n      },\r\n      variantRenamed: (event: Event): void => {\r\n        const variant = graphModel.getVariant(\r\n          event.variantTypeName!,\r\n          event.oldVariantName!\r\n        );\r\n        if (variant?.variantName) {\r\n          variant.name = variant.variantName;\r\n        }\r\n      },\r\n      defaultStateTransitionChanged: (event: Event): void => {\r\n        const nodeModel = componentModel!.getNodeWithId(event.nodeId);\r\n        nodeModel?.setDefaultStateTransition(event.curve, event.state);\r\n      },\r\n      stateTransitionsChanged: (event: Event): void => {\r\n        const nodeModel = componentModel!.getNodeWithId(event.nodeId);\r\n        if (nodeModel && event.parameterName) {\r\n          nodeModel.setStateTransitionParamter(\r\n            event.parameterName!,\r\n            event.curve,\r\n            event.state\r\n          );\r\n        }\r\n      },\r\n      variantDefaultStateTransitionChanged: (event: Event): void => {\r\n        graphModel.updateVariantDefaultStateTransition(\r\n          event.variantName!,\r\n          event.variantTypeName!,\r\n          event.curve,\r\n          event.state\r\n        );\r\n      },\r\n      variantStateTransitionsChanged: (event: Event): void => {\r\n        graphModel.updateVariantStateTransition(event);\r\n      },\r\n      routerIndexChanged: (event: Event): void => {\r\n        graphModel.routerIndex = event.data as RouterIndex;\r\n      },\r\n    };\r\n\r\n  if (eventHandlers.hasOwnProperty(event.type)) {\r\n    await eventHandlers[event.type](event);\r\n    context.scheduleUpdate();\r\n  } else {\r\n    console.log(\"Unknown event\", event);\r\n  }\r\n}\r\n\r\nexport { handleEvent };\r\n","import { EventEmitter } from \"eventemitter3\";\r\n\r\nexport class Services {\r\n  static events: EventEmitter = new EventEmitter();\r\n}\r\n","import { Node } from \"./node\";\r\nimport { createSetter } from \"./edgetriggeredinput\";\r\nimport type { Port } from \"./models/componentmodel\";\r\nimport { NodeSetup } from \"./noderegister\";\r\nimport { NodeContext } from \"./nodecontext\";\r\nimport { GraphModel } from \"./models/graphmodel\";\r\n\r\nexport interface InputDefinition<\r\n  TInternal extends Record<string, any> = {},\r\n  TSelf = unknown\r\n> {\r\n  set?: (this: Node<TInternal> & TSelf, value: any) => void;\r\n  valueChangedToTrue?: (this: Node<TInternal> & TSelf) => void;\r\n  setUnitType?: string;\r\n  displayName?: string;\r\n  editorName?: string;\r\n  group?: string;\r\n  type?: any;\r\n  default?: any;\r\n  index?: number;\r\n  exportToEditor?: boolean;\r\n  description?: string;\r\n  inputPriority?: number;\r\n  tooltip?: string;\r\n  tab?: string;\r\n  popout?: boolean;\r\n  allowVisualStates?: boolean;\r\n  nodeDoubleClickAction?: any;\r\n  createSetter?: (index: number) => (value: any) => void;\r\n}\r\n\r\nexport interface OutputDefinition<\r\n  TInternal extends Record<string, any> = {},\r\n  TSelf = unknown\r\n> {\r\n  displayName?: string;\r\n  editorName?: string;\r\n  group?: string;\r\n  type?: any;\r\n  index?: number;\r\n  exportToEditor?: boolean;\r\n  description?: string;\r\n  default?: unknown;\r\n  tooltip?: string;\r\n  tab?: string;\r\n  popout?: boolean;\r\n  allowVisualStates?: boolean;\r\n  get?: (this: Node<TInternal> & TSelf) => any;\r\n  getter?: (this: Node<TInternal> & TSelf) => any;\r\n}\r\n\r\ninterface Panel {\r\n  name: string;\r\n  context?: string[];\r\n  title?: string;\r\n  plug?: string;\r\n  type?: {\r\n    name: string;\r\n  };\r\n  canArrangeInGroups?: boolean;\r\n  hidden?: boolean;\r\n}\r\n\r\nexport type DynamicPort = {\r\n  name?: string;\r\n  condition?: string;\r\n  ports?: any[];\r\n  template?: string;\r\n  port?: any;\r\n  channelPort?: any;\r\n  inputs?: string[];\r\n  outputs?: string[];\r\n};\r\n\r\nexport interface NodeDefinition<\r\n  TInternal extends Record<string, any> = {},\r\n  TSelf = unknown\r\n> {\r\n  _internal?: any;\r\n  displayName?: string;\r\n  inputs?: Record<string, InputDefinition<TInternal, TSelf>>;\r\n  outputs?: Record<string, OutputDefinition<TInternal, TSelf>>;\r\n  category: string;\r\n  dynamicports?: DynamicPort[];\r\n  exportDynamicPorts?: any;\r\n  useVariants?: any;\r\n  allowChildren?: boolean;\r\n  allowChildrenWithCategory?: string[];\r\n  singleton?: boolean;\r\n  connectionPanel?: any;\r\n  allowAsChild?: boolean;\r\n  visualStates?: any;\r\n  panels?: Panel[];\r\n  color?: string;\r\n  usePortAsLabel?: any;\r\n  portLabelTruncationMode?: any;\r\n  name: string;\r\n  displayNodeName?: string;\r\n  deprecated?: boolean;\r\n  haveComponentPorts?: boolean;\r\n  version?: string;\r\n  module?: string;\r\n  docs?: string;\r\n  shortDocs?: string;\r\n  shortDesc?: string;\r\n  allowAsExportRoot?: boolean;\r\n  nodeDoubleClickAction?: any;\r\n  searchTags?: string[];\r\n  ports?: Port[];\r\n  numberedInputs?: Record<\r\n    string,\r\n    {\r\n      type: string;\r\n      displayPrefix: string;\r\n      group?: string;\r\n      index?: number;\r\n      createSetter: (\r\n        index: number\r\n      ) => (this: Node<TInternal> & TSelf, value: any) => void;\r\n    }\r\n  >;\r\n  nodeScopeDidInitialize?: () => void;\r\n\r\n  /**\r\n   * deprecated Use methods instead.\r\n   */\r\n  prototypeExtensions?: Record<\r\n    string,\r\n    (\r\n      this: Node<TInternal>,\r\n      ...args: any[]\r\n    ) => void | {\r\n      value: (this: Node<TInternal> & TSelf, ...args: any[]) => void;\r\n    }\r\n  > & {\r\n    registerOutputIfNeeded?: (\r\n      this: Node<TInternal> & TSelf,\r\n      name: string\r\n    ) => void;\r\n  };\r\n\r\n  methods?: Record<\r\n    string,\r\n    (this: Node<TInternal> & TSelf, ...args: any[]) => void\r\n  > & {\r\n    registerOutputIfNeeded?: (\r\n      this: Node<TInternal> & TSelf,\r\n      name: string\r\n    ) => void;\r\n  };\r\n\r\n  initialize?: (this: Node<TInternal> & TSelf) => void;\r\n\r\n  // TODO: getInspectInfo, what more return types are supported?\r\n  getInspectInfo?: (this: Node<TInternal> & TSelf) =>\r\n    | {\r\n        type: string;\r\n        value: unknown;\r\n      }\r\n    | {\r\n        type: string;\r\n        value: unknown;\r\n      }[]\r\n    | string\r\n    | number\r\n    | boolean\r\n    | undefined;\r\n}\r\n\r\nfunction registerInput(\r\n  object: any,\r\n  metadata: NodeDefinition,\r\n  name: string,\r\n  input: InputDefinition\r\n): void {\r\n  if (object.hasOwnProperty(name)) {\r\n    throw new Error(\"Input property \" + name + \" already registered\");\r\n  }\r\n\r\n  if (!input.set && !input.valueChangedToTrue) {\r\n    input.set = () => {};\r\n  }\r\n\r\n  if (input.set) {\r\n    object[name] = {\r\n      set: input.set,\r\n    };\r\n\r\n    //types to keep in the input on the node instances\r\n    //color and textStyles are used for style updates\r\n    //array is for supporting eval:ing strings\r\n    const typesToSaveInInput = [\"color\", \"textStyle\", \"array\"];\r\n\r\n    typesToSaveInInput.forEach((type) => {\r\n      if (input.type && (input.type === type || input.type.name === type)) {\r\n        object[name].type = type;\r\n      }\r\n    });\r\n  }\r\n\r\n  if (input.setUnitType) {\r\n    object[name].setUnitType = input.setUnitType;\r\n  }\r\n\r\n  metadata.inputs = metadata.inputs || {};\r\n  metadata.inputs[name] = {\r\n    displayName: input.displayName,\r\n    editorName: input.editorName,\r\n    group: input.group,\r\n    type: input.type,\r\n    default: input.default,\r\n    index: input.index,\r\n    exportToEditor: input.hasOwnProperty(\"exportToEditor\")\r\n      ? input.exportToEditor\r\n      : true,\r\n    inputPriority: input.inputPriority || 0,\r\n    tooltip: input.tooltip,\r\n    tab: input.tab,\r\n    popout: input.popout,\r\n    allowVisualStates: input.allowVisualStates,\r\n    nodeDoubleClickAction: input.nodeDoubleClickAction,\r\n  };\r\n\r\n  if (input.valueChangedToTrue) {\r\n    metadata.inputs[name].type = {\r\n      name: \"signal\",\r\n      allowConnectionsOnly: true,\r\n    };\r\n  }\r\n}\r\n\r\nfunction registerInputs(\r\n  object: any,\r\n  metadata: NodeDefinition,\r\n  inputs: Record<string, InputDefinition>\r\n): void {\r\n  Object.keys(inputs).forEach(function (inputName) {\r\n    registerInput(object, metadata, inputName, inputs[inputName]);\r\n  });\r\n}\r\n\r\nfunction registerNumberedInputs(\r\n  node: any,\r\n  numberedInputs: Record<string, any>\r\n): void {\r\n  for (const inputName of Object.keys(numberedInputs)) {\r\n    registerNumberedInput(node, inputName, numberedInputs[inputName]);\r\n  }\r\n}\r\n\r\nfunction registerNumberedInput(node: any, name: string, input: any): void {\r\n  const oldRegisterInputIfNeeded = node.registerInputIfNeeded;\r\n\r\n  node.registerInputIfNeeded = function (inputName: string): void {\r\n    if (oldRegisterInputIfNeeded) {\r\n      oldRegisterInputIfNeeded.call(node, inputName);\r\n    }\r\n\r\n    if (node.hasInput(inputName) || !inputName.startsWith(name)) {\r\n      return;\r\n    }\r\n\r\n    const index = Number(inputName.slice(name.length + 1)); // inputName is \"nameOfInput xxx\" where xxx is the index\r\n\r\n    node.registerInput(inputName, {\r\n      type: input.type,\r\n      set: input.createSetter.call(node, index),\r\n    });\r\n  };\r\n}\r\n\r\nfunction registerOutputsMetadata(\r\n  metadata: NodeDefinition,\r\n  outputs: Record<string, OutputDefinition>\r\n): void {\r\n  Object.keys(outputs).forEach(function (name) {\r\n    const output = outputs[name];\r\n\r\n    metadata.outputs = metadata.outputs || {};\r\n    metadata.outputs[name] = {\r\n      displayName: output.displayName,\r\n      editorName: output.editorName,\r\n      group: output.group,\r\n      type: output.type,\r\n      index: output.index,\r\n      exportToEditor: output.hasOwnProperty(\"exportToEditor\")\r\n        ? output.exportToEditor\r\n        : true,\r\n    };\r\n  });\r\n}\r\n\r\nfunction initializeDefaultValues(\r\n  defaultValues: Record<string, any>,\r\n  inputsMetadata: Record<string, any>\r\n): void {\r\n  Object.keys(inputsMetadata).forEach((name) => {\r\n    const defaultValue = inputsMetadata[name].default;\r\n    if (defaultValue === undefined) return;\r\n\r\n    if (inputsMetadata[name].type.defaultUnit) {\r\n      defaultValues[name] = {\r\n        unit: inputsMetadata[name].type.defaultUnit,\r\n        value: defaultValue,\r\n      };\r\n    } else {\r\n      defaultValues[name] = defaultValue;\r\n    }\r\n  });\r\n}\r\n\r\nexport function defineNode(opts: NodeDefinition): NodeSetup {\r\n  if (!opts.category) {\r\n    throw new Error(\"Node must have a category\");\r\n  }\r\n\r\n  if (!opts.name) {\r\n    throw new Error(\"Node must have a name\");\r\n  }\r\n\r\n  const metadata: NodeDefinition = {\r\n    inputs: {},\r\n    outputs: {},\r\n    category: opts.category,\r\n    dynamicports: opts.dynamicports,\r\n    exportDynamicPorts: opts.exportDynamicPorts,\r\n    useVariants: opts.useVariants,\r\n    allowChildren: opts.allowChildren,\r\n    allowChildrenWithCategory: opts.allowChildrenWithCategory,\r\n    singleton: opts.singleton,\r\n    connectionPanel: opts.connectionPanel,\r\n    allowAsChild: opts.allowAsChild,\r\n    visualStates: opts.visualStates,\r\n    panels: opts.panels,\r\n    color: opts.color,\r\n    usePortAsLabel: opts.usePortAsLabel,\r\n    portLabelTruncationMode: opts.portLabelTruncationMode,\r\n    name: opts.name,\r\n    displayNodeName: opts.displayNodeName || opts.displayName,\r\n    deprecated: opts.deprecated,\r\n    haveComponentPorts: opts.haveComponentPorts,\r\n    version: opts.version,\r\n    module: opts.module,\r\n    docs: opts.docs,\r\n    allowAsExportRoot: opts.allowAsExportRoot,\r\n    nodeDoubleClickAction: opts.nodeDoubleClickAction,\r\n    searchTags: opts.searchTags,\r\n  };\r\n\r\n  opts._internal = opts._internal || {};\r\n\r\n  //prototypeExtensions - old API\r\n  //methods - new API\r\n  opts.prototypeExtensions = opts.methods || opts.prototypeExtensions || {};\r\n  opts.inputs = opts.inputs || {};\r\n  opts.outputs = opts.outputs || {};\r\n  opts.initialize = opts.initialize || function () {};\r\n\r\n  const inputs: Record<string, any> = {};\r\n\r\n  registerInputs(inputs, metadata, opts.inputs);\r\n  registerOutputsMetadata(metadata, opts.outputs);\r\n\r\n  class NodeConstructor extends Node {\r\n    constructor(context: any, id: string) {\r\n      super(context, id);\r\n    }\r\n  }\r\n\r\n  if (opts.prototypeExtensions) {\r\n    Object.keys(opts.prototypeExtensions).forEach(function (propName) {\r\n      // TODO: WTF is this junk?!\r\n      // @ts-expect-error\r\n      if (!opts.prototypeExtensions![propName].value) {\r\n        // @ts-expect-error\r\n        opts.prototypeExtensions[propName] = {\r\n          // @ts-expect-error\r\n          value: opts.prototypeExtensions[propName],\r\n        };\r\n      }\r\n    });\r\n  }\r\n\r\n  // @ts-ignore\r\n  Object.defineProperties(NodeConstructor.prototype, opts.prototypeExtensions);\r\n  Object.defineProperty(NodeConstructor.prototype, \"name\", {\r\n    value: opts.name,\r\n  });\r\n\r\n  if (opts.getInspectInfo)\r\n    NodeConstructor.prototype.getInspectInfo = opts.getInspectInfo;\r\n  if (opts.nodeScopeDidInitialize)\r\n    NodeConstructor.prototype.nodeScopeDidInitialize =\r\n      opts.nodeScopeDidInitialize;\r\n\r\n  const nodeDefinition = function (\r\n    context: any,\r\n    id: string,\r\n    nodeScope: any\r\n  ): NodeSetup | NodeConstructor | undefined {\r\n    const node = new NodeConstructor(context, id);\r\n\r\n    //create all inputs. Use the inputs object for setters that don't have state and can be shared\r\n    node._inputs = Object.create(inputs);\r\n\r\n    //all inputs that use the valueChangedToTrue have state and need to be instanced\r\n    if (opts.inputs) {\r\n      Object.keys(opts.inputs).forEach(function (name) {\r\n        const input = opts.inputs![name];\r\n        if (input.valueChangedToTrue) {\r\n          node._inputs[name] = {\r\n            set: createSetter({\r\n              valueChangedToTrue: input.valueChangedToTrue,\r\n            }),\r\n          };\r\n        }\r\n      });\r\n\r\n      if (opts.outputs) {\r\n        Object.keys(opts.outputs).forEach(function (name) {\r\n          const output = opts.outputs![name];\r\n          if (output.type === \"signal\") {\r\n            node.registerOutput(name, {\r\n              getter() {\r\n                //signals are always emitted as a sequence of false, true, so this getter is never used\r\n                return undefined;\r\n              },\r\n            });\r\n          } else {\r\n            node.registerOutput(name, output);\r\n          }\r\n        });\r\n\r\n        opts.numberedInputs &&\r\n          registerNumberedInputs(node, opts.numberedInputs);\r\n\r\n        node.nodeScope = nodeScope;\r\n        initializeDefaultValues(node._inputValues, metadata.inputs || {});\r\n\r\n        opts.initialize?.call(node);\r\n\r\n        return node;\r\n      }\r\n\r\n      Object.assign(nodeDefinition, { metadata });\r\n\r\n      if (opts.numberedInputs)\r\n        registerSetupFunctionForNumberedInputs(\r\n          nodeDefinition,\r\n          opts.name,\r\n          opts.numberedInputs\r\n        );\r\n\r\n      return nodeDefinition;\r\n    }\r\n  };\r\n  nodeDefinition.metadata = metadata;\r\n\r\n  return nodeDefinition;\r\n}\r\n\r\nfunction registerSetupFunctionForNumberedInputs(\r\n  nodeDefinition: NodeSetup,\r\n  nodeType: string,\r\n  numberedInputs: Record<string, any>\r\n): void {\r\n  const inputNames = Object.keys(numberedInputs);\r\n\r\n  if (!inputNames.length) return;\r\n\r\n  nodeDefinition.setupNumberedInputDynamicPorts = function (\r\n    context: NodeContext,\r\n    graphModel: GraphModel\r\n  ): void {\r\n    const editorConnection = context.editorConnection;\r\n\r\n    if (!editorConnection || !editorConnection.isRunningLocally()) {\r\n      return;\r\n    }\r\n\r\n    function collectPorts(node: any, inputName: string, input: any): any[] {\r\n      const connections = node.component\r\n        .getConnectionsTo(node.id)\r\n        .map((c: any) => c.targetPort);\r\n\r\n      const allPortNames = Object.keys(node.parameters).concat(connections);\r\n      const portNames = allPortNames.filter((p) =>\r\n        p.startsWith(inputName + \" \")\r\n      );\r\n\r\n      //Figure out how many we need to create\r\n      //It needs to be the highest index + 1\r\n      //Only parameters with values are present, e.g. input 3 can be missing even if input 4 is defined\r\n      const maxIndex = portNames.length\r\n        ? 1 +\r\n          Math.max(\r\n            ...portNames.map((p) => Number(p.slice(inputName.length + 1)))\r\n          )\r\n        : 0;\r\n      const numPorts = maxIndex + 1;\r\n\r\n      const ports: Port[] = [];\r\n\r\n      for (let i = 0; i < numPorts; i++) {\r\n        const port: Port = {\r\n          name: inputName + \" \" + i,\r\n          displayName: (input.displayPrefix || inputName) + \" \" + i,\r\n          type: input.type,\r\n          plug: \"input\",\r\n          group: input.group,\r\n        };\r\n\r\n        if (input.hasOwnProperty(\"index\")) {\r\n          port.index = input.index + i;\r\n        }\r\n\r\n        ports.push(port);\r\n      }\r\n\r\n      return ports;\r\n    }\r\n\r\n    function updatePorts(node: any): void {\r\n      const ports = inputNames\r\n        .map((inputName) =>\r\n          collectPorts(node, inputName, numberedInputs[inputName])\r\n        )\r\n        .flat();\r\n      editorConnection?.sendDynamicPorts(node.id, ports);\r\n    }\r\n\r\n    graphModel.on(\"nodeAdded.\" + nodeType, (node: any) => {\r\n      updatePorts(node);\r\n      node.on(\"parameterUpdated\", () => {\r\n        updatePorts(node);\r\n      });\r\n\r\n      node.on(\"inputConnectionAdded\", () => {\r\n        updatePorts(node);\r\n      });\r\n\r\n      node.on(\"inputConnectionRemoved\", () => {\r\n        updatePorts(node);\r\n      });\r\n    });\r\n  };\r\n}\r\n\r\nexport function extend<T extends object, U extends object>(\r\n  obj1: T,\r\n  obj2: U\r\n): T & U {\r\n  for (const p in obj2) {\r\n    if (p === \"initialize\" && (obj1 as any).initialize) {\r\n      const oldInit = (obj1 as any).initialize;\r\n      (obj1 as any).initialize = function () {\r\n        oldInit.call(this);\r\n        (obj2 as any).initialize.call(this);\r\n      };\r\n      // @ts-ignore\r\n    } else if (obj2[p] && obj2[p].constructor === Object) {\r\n      // @ts-ignore\r\n      (obj1 as any)[p] = extend((obj1 as any)[p] || {}, obj2[p]);\r\n    } else if (\r\n      obj2[p] &&\r\n      // @ts-ignore\r\n      obj2[p].constructor === Array &&\r\n      (obj1 as any)[p] &&\r\n      // @ts-ignore\r\n      (obj1 as any)[p].constructor == Array\r\n    ) {\r\n      (obj1 as any)[p] = (obj1 as any)[p].concat(obj2[p]);\r\n    } else {\r\n      (obj1 as any)[p] = obj2[p];\r\n    }\r\n  }\r\n  return obj1 as T & U;\r\n}\r\n","import type { NodeDefinition } from \"../nodedefinition\";\r\n\r\nexport const node: NodeDefinition = {\r\n  name: \"Component Inputs\",\r\n  shortDesc: \"This node is used to define the inputs of a component.\",\r\n  docs: \"https://docs.noodl.net/nodes/component-utilities/component-inputs\",\r\n  panels: [\r\n    {\r\n      name: \"PortEditor\",\r\n      context: [\"select\", \"connectFrom\"],\r\n      title: \"Inputs\",\r\n      plug: \"output\",\r\n      type: {\r\n        name: \"*\",\r\n      },\r\n      canArrangeInGroups: true,\r\n    },\r\n    {\r\n      name: \"PropertyEditor\",\r\n      hidden: true,\r\n    },\r\n  ],\r\n  getInspectInfo() {\r\n    return {\r\n      type: \"value\",\r\n      value: this.nodeScope?.componentOwner._internal.inputValues,\r\n    };\r\n  },\r\n  color: \"component\",\r\n  haveComponentPorts: true,\r\n  category: \"Component Utilities\",\r\n  methods: {\r\n    registerOutputIfNeeded(name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      this.registerOutput(name, {\r\n        getter() {\r\n          return this.nodeScope?.componentOwner._internal.inputValues[name];\r\n        },\r\n      });\r\n    },\r\n    _updateDependencies() {\r\n      this.nodeScope?.componentOwner?.update();\r\n    },\r\n  },\r\n};\r\n","import type { NodeDefinition } from \"../nodedefinition\";\r\n\r\nexport const node: NodeDefinition = {\r\n  category: \"Component Utilities\",\r\n  name: \"Component Outputs\",\r\n  shortDesc: \"This node is used to define the outputs of a component.\",\r\n  docs: \"https://docs.noodl.net/nodes/component-utilities/component-outputs\",\r\n  panels: [\r\n    {\r\n      name: \"PortEditor\",\r\n      context: [\"select\", \"connectTo\"],\r\n      title: \"Outputs\",\r\n      plug: \"input\",\r\n      type: {\r\n        name: \"*\",\r\n      },\r\n      canArrangeInGroups: true,\r\n    },\r\n    {\r\n      name: \"PropertyEditor\",\r\n      hidden: true,\r\n    },\r\n  ],\r\n  color: \"component\",\r\n  haveComponentPorts: true,\r\n  prototypeExtensions: {\r\n    registerInputIfNeeded: function (name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      this.registerInput(name, {\r\n        set(value: string) {\r\n          this.nodeScope?.componentOwner?.setOutputFromComponentOutput(\r\n            name,\r\n            value\r\n          );\r\n        },\r\n      });\r\n    },\r\n  },\r\n};\r\n","import { Node } from \"../../node\";\r\nimport { guid } from \"../../utils\";\r\nimport { Model } from \"../../model\";\r\nimport { NodeDefinition } from \"../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  queuedOperations: Function[];\r\n  state: \"idle\" | \"running\" | \"aborted\";\r\n  maxRunningTasks: number;\r\n  activeTasks: Map<string, any>;\r\n  hasScheduledRun?: boolean;\r\n  hasScheduledAbort?: boolean;\r\n  template?: any;\r\n  items?: any[];\r\n  stopOnFailure?: boolean;\r\n  numTasks?: number;\r\n  failedTasks?: number;\r\n  completedTasks?: number;\r\n  queuedTasks?: any[];\r\n  runningTasks?: number;\r\n}\r\n\r\nfunction sendSignalOnInput(itemNode: any, name: string): void {\r\n  itemNode.queueInput(name, true); // send signal\r\n  itemNode.queueInput(name, false);\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"RunTasks\",\r\n  displayNodeName: \"Run Tasks\",\r\n  docs: \"https://docs.noodl.net/nodes/data/run-tasks\",\r\n  color: \"data\",\r\n  category: \"Data\",\r\n  initialize(): void {\r\n    this._internal = {\r\n      queuedOperations: [],\r\n      state: \"idle\",\r\n      maxRunningTasks: 10,\r\n      activeTasks: new Map(), //id => ComponentInstanceNode\r\n    } as Internal;\r\n  },\r\n  inputs: {\r\n    items: {\r\n      group: \"Data\",\r\n      displayName: \"Items\",\r\n      type: \"array\",\r\n      set(value: any[]): void {\r\n        if (!value) return;\r\n        if (value === this._internal.items) return;\r\n\r\n        this._internal.items = value;\r\n      },\r\n    },\r\n    stopOnFailure: {\r\n      group: \"General\",\r\n      displayName: \"Stop On Failure\",\r\n      type: \"boolean\",\r\n      default: false,\r\n      set(value: boolean): void {\r\n        this._internal.stopOnFailure = value;\r\n      },\r\n    },\r\n    maxRunningTasks: {\r\n      group: \"General\",\r\n      displayName: \"Max Running Tasks\",\r\n      type: \"number\",\r\n      default: 10,\r\n      set(value: number): void {\r\n        this._internal.maxRunningTasks = value;\r\n      },\r\n    },\r\n    taskTemplate: {\r\n      type: \"component\",\r\n      displayName: \"Template\",\r\n      group: \"General\",\r\n      set(value: any): void {\r\n        this._internal.template = value;\r\n      },\r\n    },\r\n    run: {\r\n      group: \"General\",\r\n      displayName: \"Do\",\r\n      type: \"signal\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleRun();\r\n      },\r\n    },\r\n    abort: {\r\n      group: \"General\",\r\n      displayName: \"Abort\",\r\n      type: \"signal\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleAbort();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    success: {\r\n      type: \"signal\",\r\n      group: \"Events\",\r\n      displayName: \"Success\",\r\n    },\r\n    failure: {\r\n      type: \"signal\",\r\n      group: \"Events\",\r\n      displayName: \"Failure\",\r\n    },\r\n    done: {\r\n      type: \"signal\",\r\n      group: \"Events\",\r\n      displayName: \"Done\",\r\n    },\r\n    aborted: {\r\n      type: \"signal\",\r\n      group: \"Events\",\r\n      displayName: \"Aborted\",\r\n    },\r\n  },\r\n  methods: {\r\n    scheduleRun(): void {\r\n      const internal = this._internal;\r\n      if (!internal.hasScheduledRun) {\r\n        internal.hasScheduledRun = true;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          // @ts-expect-error\r\n          this._queueOperation(() => {\r\n            internal.hasScheduledRun = false;\r\n            // @ts-expect-error\r\n            this.run();\r\n          });\r\n        });\r\n      }\r\n    },\r\n    scheduleAbort(): void {\r\n      const internal = this._internal;\r\n      if (!internal.hasScheduledAbort) {\r\n        internal.hasScheduledAbort = true;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          // @ts-expect-error\r\n          this._queueOperation(() => {\r\n            internal.hasScheduledAbort = false;\r\n            // @ts-expect-error\r\n            this.abort();\r\n          });\r\n        });\r\n      }\r\n    },\r\n    async createTaskComponent(item: any): Promise<any> {\r\n      const internal = this._internal;\r\n\r\n      const modelScope = this.nodeScope!.modelScope || Model;\r\n      const model = modelScope.create(item);\r\n\r\n      const itemNode = await this.nodeScope!.createNode(\r\n        internal.template,\r\n        guid(),\r\n        {\r\n          _forEachModel: model,\r\n          _forEachNode: this,\r\n        }\r\n      );\r\n\r\n      // This is needed to make sure any action connected to \"Do\"\r\n      // is not run directly\r\n      const _isInputConnected = itemNode.isInputConnected.bind(itemNode);\r\n      itemNode.isInputConnected = (name: string): boolean => {\r\n        if (name === \"Do\") return true;\r\n        return _isInputConnected(name);\r\n      };\r\n\r\n      // Set the Id as an input\r\n      if (itemNode.hasInput(\"Id\")) {\r\n        itemNode.setInputValue(\"Id\", model.getId());\r\n      }\r\n      if (itemNode.hasInput(\"id\")) {\r\n        itemNode.setInputValue(\"id\", model.getId());\r\n      }\r\n\r\n      // Push all other values also as inputs\r\n      // if they exist as component inputs\r\n      for (const inputKey in itemNode._inputs) {\r\n        if (model.data[inputKey] !== undefined)\r\n          itemNode.setInputValue(inputKey, model.data[inputKey]);\r\n      }\r\n\r\n      // capture signals\r\n      itemNode._internal.creatorCallbacks = {\r\n        onOutputChanged: (\r\n          name: string,\r\n          value: boolean,\r\n          oldValue: boolean | undefined\r\n        ) => {\r\n          if (\r\n            (oldValue === false || oldValue === undefined) &&\r\n            value === true\r\n          ) {\r\n            // @ts-expect-error\r\n            this.itemOutputSignalTriggered(name, model, itemNode);\r\n          }\r\n        },\r\n      };\r\n\r\n      return itemNode;\r\n    },\r\n    async startTask(task: any): Promise<void> {\r\n      const internal = this._internal;\r\n\r\n      try {\r\n        // @ts-expect-error\r\n        const taskComponent = await this.createTaskComponent(task);\r\n        // @ts-expect-error\r\n        internal.runningTasks++;\r\n        sendSignalOnInput(taskComponent, \"Do\");\r\n        internal.activeTasks.set(taskComponent.id, taskComponent);\r\n      } catch (e) {\r\n        // Something went wrong starting the task\r\n        console.log(e);\r\n      }\r\n    },\r\n    async run(): Promise<void> {\r\n      const internal = this._internal;\r\n\r\n      if (this.context.editorConnection) {\r\n        if (internal.state !== \"idle\") {\r\n          this.context.editorConnection.sendWarning(\r\n            this.nodeScope!.componentOwner.name,\r\n            this.id,\r\n            \"run-tasks\",\r\n            {\r\n              message: \"Cannot start when not in idle mode\",\r\n            }\r\n          );\r\n        } else if (!internal.template) {\r\n          this.context.editorConnection.sendWarning(\r\n            this.nodeScope!.componentOwner.name,\r\n            this.id,\r\n            \"run-tasks\",\r\n            {\r\n              message: \"No task template specified.\",\r\n            }\r\n          );\r\n        } else if (!internal.items) {\r\n          this.context.editorConnection.sendWarning(\r\n            this.nodeScope!.componentOwner.name,\r\n            this.id,\r\n            \"run-tasks\",\r\n            {\r\n              message: \"No items array provided.\",\r\n            }\r\n          );\r\n        } else {\r\n          this.context.editorConnection.clearWarning(\r\n            this.nodeScope!.componentOwner.name,\r\n            this.id,\r\n            \"run-tasks\"\r\n          );\r\n        }\r\n      }\r\n\r\n      if (internal.state !== \"idle\") {\r\n        return;\r\n      }\r\n\r\n      if (!internal.template) {\r\n        return;\r\n      }\r\n\r\n      if (!internal.items) {\r\n        return;\r\n      }\r\n\r\n      internal.state = \"running\";\r\n      internal.numTasks = internal.items.length;\r\n      internal.failedTasks = 0;\r\n      internal.completedTasks = 0;\r\n      // @ts-expect-error\r\n      internal.queuedTasks = [].concat(internal.items);\r\n      internal.runningTasks = 0;\r\n\r\n      // No tasks\r\n      if (internal.items.length === 0) {\r\n        this.sendSignalOnOutput(\"success\");\r\n        internal.state = \"idle\";\r\n      }\r\n\r\n      // Start tasks\r\n      for (\r\n        let i = 0;\r\n        i < Math.min(internal.maxRunningTasks, internal.queuedTasks.length);\r\n        i++\r\n      ) {\r\n        const task = internal.queuedTasks.shift();\r\n        if (!task) break;\r\n\r\n        // @ts-expect-error\r\n        this.startTask(task);\r\n      }\r\n    },\r\n    abort(): void {\r\n      const internal = this._internal;\r\n      internal.state = \"aborted\";\r\n    },\r\n    itemOutputSignalTriggered(name: string, model: any, itemNode: any): void {\r\n      const internal = this._internal;\r\n\r\n      if (internal.state === \"idle\") {\r\n        // Signal while we are not running is ignored\r\n        return;\r\n      }\r\n\r\n      const checkDone = () => {\r\n        if (internal.state === \"aborted\") {\r\n          this.sendSignalOnOutput(\"aborted\");\r\n          internal.state = \"idle\";\r\n          return;\r\n        }\r\n\r\n        if (internal.completedTasks === internal.numTasks) {\r\n          if (internal.failedTasks === 0) this.sendSignalOnOutput(\"success\");\r\n          else this.sendSignalOnOutput(\"failure\");\r\n          this.sendSignalOnOutput(\"done\");\r\n          internal.state = \"idle\";\r\n        } else {\r\n          if (internal.stopOnFailure) {\r\n            // Only continue if there are no failed tasks, otherwise aborted\r\n            if (internal.failedTasks === 0) {\r\n              // @ts-expect-error\r\n              internal.runningTasks++;\r\n              // @ts-expect-error\r\n              const task = internal.queuedTasks.shift();\r\n              // @ts-expect-error\r\n              if (task) this.startTask(task);\r\n            } else {\r\n              this.sendSignalOnOutput(\"failure\");\r\n              this.sendSignalOnOutput(\"aborted\");\r\n            }\r\n          } else {\r\n            // @ts-expect-error\r\n            internal.runningTasks++;\r\n            // @ts-expect-error\r\n            const task = internal.queuedTasks.shift();\r\n            // @ts-expect-error\r\n            if (task) this.startTask(task);\r\n          }\r\n        }\r\n      };\r\n\r\n      if (name === \"Success\") {\r\n        // @ts-expect-error\r\n        internal.completedTasks++;\r\n        // @ts-expect-error\r\n        internal.runningTasks--;\r\n        checkDone();\r\n      } else if (name === \"Failure\") {\r\n        // @ts-expect-error\r\n        internal.completedTasks++;\r\n        // @ts-expect-error\r\n        internal.failedTasks++;\r\n        // @ts-expect-error\r\n        internal.runningTasks--;\r\n        checkDone();\r\n      }\r\n\r\n      internal.activeTasks.delete(itemNode.id);\r\n      this.nodeScope!.deleteNode(itemNode);\r\n    },\r\n    _queueOperation(op: Function): void {\r\n      this._internal.queuedOperations.push(op);\r\n      // @ts-expect-error\r\n      this._runQueueOperations();\r\n    },\r\n    async _runQueueOperations(): Promise<void> {\r\n      // @ts-expect-error\r\n      if (this.runningOperations) {\r\n        return;\r\n      }\r\n      // @ts-expect-error\r\n      this.runningOperations = true;\r\n\r\n      while (this._internal.queuedOperations.length) {\r\n        const op = this._internal.queuedOperations.shift();\r\n        // @ts-expect-error\r\n        await op();\r\n      }\r\n\r\n      // @ts-expect-error\r\n      this.runningOperations = false;\r\n    },\r\n  },\r\n  // @ts-expect-error\r\n  _deleteAllTasks(): void {\r\n    for (const taskComponent of this._internal.activeTasks) {\r\n      // @ts-expect-error\r\n      this.nodeScope.deleteNode(taskComponent);\r\n    }\r\n    this._internal.activeTasks.clear();\r\n  },\r\n  _onNodeDeleted(): void {\r\n    Node.prototype._onNodeDeleted.call(this);\r\n    // @ts-expect-error\r\n    this._deleteAllTasks();\r\n  },\r\n};\r\n","import { NodeDefinition } from \"../../../nodedefinition\";\r\nimport { NodeContext } from \"../../../nodecontext\";\r\nimport { GraphModel } from \"../../../models/graphmodel\";\r\nimport { Port } from \"../../../models/componentmodel\";\r\n\r\nconst defaultRequestScript =\r\n  \"\" +\r\n  \"//Add custom code to setup the request object before the request\\n\" +\r\n  \"//is made.\\n\" +\r\n  \"//\\n\" +\r\n  \"//*Request.resource     contains the resource path of the request.\\n\" +\r\n  \"//*Request.method       contains the method, GET, POST, PUT or DELETE.\\n\" +\r\n  \"//*Request.headers      is a map where you can add additional headers.\\n\" +\r\n  \"//*Request.parameters   is a map the parameters that will be appended\\n\" +\r\n  \"//                      to the url.\\n\" +\r\n  \"//*Request.content      contains the content of the request as a javascript\\n\" +\r\n  \"//                      object.\\n\" +\r\n  \"//\\n\" +\r\n  \"//*Inputs and *Outputs contain the inputs and outputs of the node.\\n\";\r\n\r\nconst defaultResponseScript =\r\n  \"\" +\r\n  \"// Add custom code to convert the response content to outputs\\n\" +\r\n  \"//\\n\" +\r\n  \"//*Response.status    The status code of the response\\n\" +\r\n  \"//*Response.content   The content of the response as a javascript\\n\" +\r\n  \"//                    object.\\n\" +\r\n  \"//*Response.request   The request object that resulted in the response.\\n\" +\r\n  \"//\\n\" +\r\n  \"//*Inputs and *Outputs contain the inputs and outputs of the node.\\n\";\r\n\r\ninterface Request {\r\n  resource: string;\r\n  method: string;\r\n  headers: Record<string, string>;\r\n  parameters: Record<string, string>;\r\n  content?: any;\r\n}\r\n\r\ninterface Response {\r\n  status: number;\r\n  content: any;\r\n  request: Request;\r\n}\r\n\r\ninterface Internal {\r\n  inputValues: Record<string, any>;\r\n  outputValues: Record<string, any>;\r\n  outputValuesProxy: any;\r\n  self: any;\r\n  resource?: string;\r\n  method?: string;\r\n  requestFunc?: Function;\r\n  responseFunc?: Function;\r\n  hasScheduledFetch?: boolean;\r\n  inspectData?: any;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"REST2\",\r\n  displayNodeName: \"REST\",\r\n  docs: \"https://docs.noodl.net/nodes/data/rest\",\r\n  category: \"Data\",\r\n  color: \"data\",\r\n  searchTags: [\"http\", \"request\", \"fetch\"],\r\n  initialize() {\r\n    this._internal.inputValues = {};\r\n    this._internal.outputValues = {};\r\n\r\n    this._internal.outputValuesProxy = new Proxy(this._internal.outputValues, {\r\n      set: (obj, prop: string, value) => {\r\n        if (value !== this._internal.outputValues[prop]) {\r\n          // @ts-expect-error\r\n          this.registerOutputIfNeeded(\"out-\" + prop);\r\n\r\n          this._internal.outputValues[prop] = value;\r\n          this.flagOutputDirty(\"out-\" + prop);\r\n        }\r\n        return true;\r\n      },\r\n    });\r\n\r\n    this._internal.self = {};\r\n  },\r\n  getInspectInfo() {\r\n    return this._internal.inspectData\r\n      ? { type: \"value\", value: this._internal.inspectData }\r\n      : { type: \"text\", value: \"[Not executed yet]\" };\r\n  },\r\n  inputs: {\r\n    resource: {\r\n      type: \"string\",\r\n      displayName: \"Resource\",\r\n      group: \"Request\",\r\n      default: \"/\",\r\n      set(value: string) {\r\n        this._internal.resource = value;\r\n      },\r\n    },\r\n    method: {\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"GET\", value: \"GET\" },\r\n          { label: \"POST\", value: \"POST\" },\r\n          { label: \"PUT\", value: \"PUT\" },\r\n          { label: \"PATCH\", value: \"PATCH\" },\r\n          { label: \"DELETE\", value: \"DELETE\" },\r\n        ],\r\n      },\r\n      displayName: \"Method\",\r\n      group: \"Request\",\r\n      default: \"GET\",\r\n      set(value: string) {\r\n        this._internal.method = value;\r\n      },\r\n    },\r\n    requestScript: {\r\n      type: {\r\n        name: \"string\",\r\n        allowEditOnly: true,\r\n        codeeditor: \"javascript\",\r\n      },\r\n      displayName: \"Request\",\r\n      default: defaultRequestScript,\r\n      group: \"Scripts\",\r\n      set(script: string) {\r\n        try {\r\n          this._internal.requestFunc = new Function(\r\n            \"Inputs\",\r\n            \"Outputs\",\r\n            \"Request\",\r\n            script\r\n          );\r\n        } catch (e) {\r\n          console.log(e);\r\n        }\r\n      },\r\n    },\r\n    responseScript: {\r\n      type: {\r\n        name: \"string\",\r\n        allowEditOnly: true,\r\n        codeeditor: \"javascript\",\r\n      },\r\n      displayName: \"Response\",\r\n      default: defaultResponseScript,\r\n      group: \"Scripts\",\r\n      set(script: string) {\r\n        try {\r\n          this._internal.responseFunc = new Function(\r\n            \"Inputs\",\r\n            \"Outputs\",\r\n            \"Response\",\r\n            script\r\n          );\r\n        } catch (e) {\r\n          console.log(e);\r\n        }\r\n      },\r\n    },\r\n    fetch: {\r\n      type: \"signal\",\r\n      displayName: \"Fetch\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleFetch();\r\n      },\r\n    },\r\n    cancel: {\r\n      type: \"signal\",\r\n      displayName: \"Cancel\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.cancelFetch();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    failure: {\r\n      type: \"signal\",\r\n      displayName: \"Failure\",\r\n      group: \"Events\",\r\n    },\r\n    success: {\r\n      type: \"signal\",\r\n      displayName: \"Success\",\r\n      group: \"Events\",\r\n    },\r\n    canceled: {\r\n      type: \"signal\",\r\n      displayName: \"Canceled\",\r\n      group: \"Events\",\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    getScriptOutputValue(name: string) {\r\n      return this._internal.outputValues[name];\r\n    },\r\n    setScriptInputValue(name: string, value: any) {\r\n      return (this._internal.inputValues[name] = value);\r\n    },\r\n    registerOutputIfNeeded(name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"out-\"))\r\n        return this.registerOutput(name, {\r\n          // @ts-expect-error\r\n          getter: this.getScriptOutputValue.bind(\r\n            this,\r\n            name.substring(\"out-\".length)\r\n          ),\r\n        });\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"in-\"))\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setScriptInputValue.bind(\r\n            this,\r\n            name.substring(\"in-\".length)\r\n          ),\r\n        });\r\n    },\r\n    scheduleFetch() {\r\n      const internal = this._internal;\r\n      if (!internal.hasScheduledFetch) {\r\n        internal.hasScheduledFetch = true;\r\n        // @ts-expect-error\r\n        this.scheduleAfterInputsHaveUpdated(this.doFetch.bind(this));\r\n      }\r\n    },\r\n    doResponse(status: number, response: any, request: Request) {\r\n      if (this._internal.responseFunc) {\r\n        this._internal.responseFunc.apply(this._internal.self, [\r\n          this._internal.inputValues,\r\n          this._internal.outputValuesProxy,\r\n          { status, content: response, request },\r\n        ]);\r\n      }\r\n\r\n      this._internal.inspectData = { status, content: response };\r\n\r\n      if (status >= 200 && status < 300) {\r\n        this.sendSignalOnOutput(\"success\");\r\n      } else {\r\n        this.sendSignalOnOutput(\"failure\");\r\n      }\r\n    },\r\n    doExternalFetch(request: Request) {\r\n      let url = request.resource;\r\n\r\n      if (Object.keys(request.parameters).length > 0) {\r\n        const parameters = Object.keys(request.parameters).map((p) => {\r\n          return p + \"=\" + encodeURIComponent(request.parameters[p]);\r\n        });\r\n        url += \"?\" + parameters.join(\"&\");\r\n      }\r\n\r\n      // @ts-expect-error\r\n      if (typeof _noodl_cloud_runtime_version === \"undefined\") {\r\n        const xhr = new XMLHttpRequest();\r\n        // @ts-expect-error\r\n        this._xhr = xhr;\r\n\r\n        xhr.open(request.method, url, true);\r\n        for (const header in request.headers) {\r\n          xhr.setRequestHeader(header, request.headers[header]);\r\n        }\r\n        xhr.onreadystatechange = () => {\r\n          let sentResponse = false;\r\n\r\n          if (xhr.readyState === 4) {\r\n            const statusCode = xhr.status;\r\n            const responseType = xhr.getResponseHeader(\"content-type\");\r\n            const rawResponse = xhr.response;\r\n            // @ts-expect-error\r\n            delete this._xhr;\r\n\r\n            if (responseType) {\r\n              // @ts-expect-error\r\n              responseType = responseType.toLowerCase();\r\n              const responseData =\r\n                responseType.indexOf(\"json\") !== -1\r\n                  ? JSON.parse(rawResponse)\r\n                  : rawResponse;\r\n\r\n              // @ts-expect-error\r\n              this.doResponse(statusCode, responseData, request);\r\n              sentResponse = true;\r\n            }\r\n\r\n            if (sentResponse === false) {\r\n              // @ts-expect-error\r\n              this.doResponse(statusCode, rawResponse, request);\r\n            }\r\n          }\r\n        };\r\n        xhr.onerror = () => {\r\n          // @ts-expect-error\r\n          delete this._xhr;\r\n          this.sendSignalOnOutput(\"failure\");\r\n        };\r\n\r\n        xhr.onabort = () => {\r\n          // @ts-expect-error\r\n          delete this._xhr;\r\n          this.sendSignalOnOutput(\"canceled\");\r\n        };\r\n\r\n        if (request.content) {\r\n          xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n          xhr.send(JSON.stringify(request.content));\r\n        } else {\r\n          xhr.send();\r\n        }\r\n      } else {\r\n        const headers = {\r\n          ...request.headers,\r\n          ...(request.content ? { \"Content-Type\": \"application/json\" } : {}),\r\n        };\r\n\r\n        fetch(url, {\r\n          method: request.method,\r\n          headers,\r\n          body: request.content ? JSON.stringify(request.content) : undefined,\r\n        })\r\n          .then((response) => {\r\n            const responseType = response.headers.get(\"content-type\");\r\n            if (responseType) {\r\n              if (responseType.indexOf(\"/json\") !== -1) {\r\n                response.json().then((json) => {\r\n                  // @ts-expect-error\r\n                  this.doResponse(response.status, json, request);\r\n                });\r\n              } else {\r\n                if (this.context.editorConnection) {\r\n                  this.context.editorConnection.sendWarning(\r\n                    this.nodeScope!.componentOwner.name,\r\n                    this.id,\r\n                    \"rest-run-waring-\",\r\n                    {\r\n                      message:\r\n                        \"REST only supports json content type in response.\",\r\n                    }\r\n                  );\r\n                }\r\n              }\r\n            } else {\r\n              response.text().then((raw) => {\r\n                // @ts-expect-error\r\n                this.doResponse(response.status, raw, request);\r\n              });\r\n            }\r\n          })\r\n          .catch((e) => {\r\n            console.log(\"REST: Failed to request\", url);\r\n            console.log(e);\r\n            this.sendSignalOnOutput(\"failure\");\r\n          });\r\n      }\r\n    },\r\n    doFetch() {\r\n      this._internal.hasScheduledFetch = false;\r\n\r\n      let resource = this._internal.resource;\r\n      if (resource) {\r\n        for (const key in this._internal.inputValues) {\r\n          resource = resource.replace(\r\n            \"{\" + key + \"}\",\r\n            this._internal.inputValues[key]\r\n          );\r\n        }\r\n      }\r\n\r\n      const request: Request = {\r\n        // @ts-expect-error\r\n        resource,\r\n        headers: {},\r\n        method:\r\n          this._internal.method !== undefined ? this._internal.method : \"GET\",\r\n        parameters: {},\r\n      };\r\n\r\n      if (this._internal.requestFunc) {\r\n        this._internal.requestFunc.apply(this._internal.self, [\r\n          this._internal.inputValues,\r\n          this._internal.outputValuesProxy,\r\n          request,\r\n        ]);\r\n      }\r\n\r\n      // @ts-expect-error\r\n      this.doExternalFetch(request);\r\n    },\r\n    cancelFetch() {\r\n      // @ts-expect-error\r\n      if (typeof _noodl_cloud_runtime_version === \"undefined\") {\r\n        // @ts-expect-error\r\n        this._xhr && this._xhr.abort();\r\n      } else {\r\n        if (this.context.editorConnection) {\r\n          this.context.editorConnection.sendWarning(\r\n            this.nodeScope!.componentOwner.name,\r\n            this.id,\r\n            \"rest-run-waring-\",\r\n            {\r\n              message: \"REST doesn't support cancel in cloud functions.\",\r\n            }\r\n          );\r\n        }\r\n      }\r\n    },\r\n  },\r\n};\r\n\r\nfunction parseScriptForErrors(\r\n  script: string | undefined,\r\n  args: string[],\r\n  name: string,\r\n  node: any,\r\n  context: NodeContext,\r\n  ports: Port[]\r\n) {\r\n  if (!context.editorConnection) {\r\n    return;\r\n  }\r\n\r\n  context.editorConnection.clearWarning(\r\n    node.component.name,\r\n    node.id,\r\n    \"rest-run-waring-\" + name\r\n  );\r\n\r\n  if (script === undefined) {\r\n    context.editorConnection.clearWarning(\r\n      node.component.name,\r\n      node.id,\r\n      \"rest-parse-waring-\" + name\r\n    );\r\n    return;\r\n  }\r\n\r\n  try {\r\n    new Function(...args, script);\r\n    context.editorConnection.clearWarning(\r\n      node.component.name,\r\n      node.id,\r\n      \"rest-parse-waring-\" + name\r\n    );\r\n  } catch (e: any) {\r\n    context.editorConnection.sendWarning(\r\n      node.component.name,\r\n      node.id,\r\n      \"rest-parse-waring-\" + name,\r\n      {\r\n        message: \"<strong>\" + name + \"</strong>: \" + e.message,\r\n        showGlobally: true,\r\n      }\r\n    );\r\n  }\r\n\r\n  function exists(port: string): boolean {\r\n    return ports.find((p) => p.name === port) !== undefined;\r\n  }\r\n\r\n  const scriptWithoutComments = script.replace(/\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/g, \"\");\r\n  const inputs = scriptWithoutComments.match(/Inputs\\.[A-Za-z0-9]+/g);\r\n  if (inputs) {\r\n    const unique: Record<string, boolean> = {};\r\n    inputs.forEach((v) => {\r\n      unique[v.substring(\"Inputs.\".length)] = true;\r\n    });\r\n\r\n    Object.keys(unique).forEach((p) => {\r\n      if (exists(\"in-\" + p)) return;\r\n\r\n      ports.push({\r\n        name: \"in-\" + p,\r\n        displayName: p,\r\n        plug: \"input\",\r\n        type: \"*\",\r\n        group: \"Inputs\",\r\n      });\r\n    });\r\n  }\r\n\r\n  const outputs = scriptWithoutComments.match(/Outputs\\.[A-Za-z0-9]+/g);\r\n  if (outputs) {\r\n    const unique: Record<string, boolean> = {};\r\n    outputs.forEach((v) => {\r\n      unique[v.substring(\"Outputs.\".length)] = true;\r\n    });\r\n\r\n    Object.keys(unique).forEach((p) => {\r\n      if (exists(\"out-\" + p)) return;\r\n\r\n      ports.push({\r\n        name: \"out-\" + p,\r\n        displayName: p,\r\n        plug: \"output\",\r\n        type: \"*\",\r\n        group: \"Outputs\",\r\n      });\r\n    });\r\n  }\r\n}\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (!context.editorConnection) {\r\n    return;\r\n  }\r\n\r\n  function managePortsForNode(node: any) {\r\n    function updatePorts() {\r\n      if (!node.parameters) {\r\n        return;\r\n      }\r\n\r\n      const ports: Port[] = [];\r\n      function exists(name: string): boolean {\r\n        for (let i = 0; i < ports.length; i++)\r\n          if (ports[i].name === name && ports[i].plug === \"input\") return true;\r\n        return false;\r\n      }\r\n\r\n      if (node.parameters.resource) {\r\n        const inputs = node.parameters.resource.match(/\\{[A-Za-z0-9_]*\\}/g);\r\n        if (inputs) {\r\n          for (const def of inputs) {\r\n            const name = def.replace(\"{\", \"\").replace(\"}\", \"\");\r\n            if (exists(\"in-\" + name)) continue;\r\n\r\n            ports.push({\r\n              name: \"in-\" + name,\r\n              displayName: name,\r\n              type: \"string\",\r\n              plug: \"input\",\r\n              group: \"Inputs\",\r\n            });\r\n          }\r\n        }\r\n      }\r\n\r\n      if (node.parameters[\"requestScript\"]) {\r\n        parseScriptForErrors(\r\n          node.parameters[\"requestScript\"],\r\n          [\"Inputs\", \"Outputs\", \"Request\"],\r\n          \"Request script\",\r\n          node,\r\n          context,\r\n          ports\r\n        );\r\n      }\r\n\r\n      if (node.parameters[\"responseScript\"]) {\r\n        parseScriptForErrors(\r\n          node.parameters[\"responseScript\"],\r\n          [\"Inputs\", \"Outputs\", \"Response\"],\r\n          \"Response script\",\r\n          node,\r\n          context,\r\n          ports\r\n        );\r\n      }\r\n\r\n      context.editorConnection!.sendDynamicPorts(node.id, ports);\r\n    }\r\n\r\n    updatePorts();\r\n    node.on(\"parameterUpdated\", () => {\r\n      updatePorts();\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.REST2\", (node: any) => {\r\n      managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"REST2\")) {\r\n      managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","import difference from \"lodash.difference\";\r\nimport { NodeDefinition } from \"../../nodedefinition\";\r\nimport type { NodeContext } from \"../../nodecontext\";\r\nimport type { Node } from \"../../node\";\r\nimport type { EditorConnection } from \"../../editorconnection\";\r\nimport type { GraphModel } from \"../../models/graphmodel\";\r\nimport type { Event } from \"../../editormodeleventshandler\";\r\nimport type { NodeModel } from \"../../models/nodemodel\";\r\n\r\ninterface Internal {\r\n  scope: Record<string, any>;\r\n  hasScheduledEvaluation: boolean;\r\n  code?: string;\r\n  cachedValue: number;\r\n  currentExpression: string;\r\n  compiledFunction?: Function;\r\n  inputNames: string[];\r\n  inputValues: any[];\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Expression\",\r\n  docs: \"https://docs.noodl.net/nodes/math/expression\",\r\n  usePortAsLabel: \"expression\",\r\n  category: \"CustomCode\",\r\n  color: \"javascript\",\r\n  nodeDoubleClickAction: {\r\n    focusPort: \"Expression\",\r\n  },\r\n  searchTags: [\"javascript\"],\r\n  initialize() {\r\n    const internal = this._internal;\r\n\r\n    internal.scope = {};\r\n    internal.hasScheduledEvaluation = false;\r\n\r\n    internal.code = undefined;\r\n    internal.cachedValue = 0;\r\n    internal.currentExpression = \"\";\r\n    internal.compiledFunction = undefined;\r\n    internal.inputNames = [];\r\n    internal.inputValues = [];\r\n  },\r\n  getInspectInfo() {\r\n    return this._internal.cachedValue;\r\n  },\r\n  inputs: {\r\n    expression: {\r\n      group: \"General\",\r\n      inputPriority: 1,\r\n      type: {\r\n        name: \"string\",\r\n        allowEditOnly: true,\r\n        codeeditor: \"javascript\",\r\n      },\r\n      displayName: \"Expression\",\r\n      set(value: string) {\r\n        const internal = this._internal;\r\n        internal.currentExpression =\r\n          functionPreamble + \"return (\" + value + \");\";\r\n        internal.compiledFunction = undefined;\r\n\r\n        const newInputs = parsePorts(value);\r\n\r\n        const inputsToAdd = difference(newInputs, internal.inputNames);\r\n        const inputsToRemove = difference(internal.inputNames, newInputs);\r\n\r\n        const self = this;\r\n        inputsToRemove.forEach(function (name: string) {\r\n          self.deregisterInput(name);\r\n          delete internal.scope[name];\r\n        });\r\n\r\n        inputsToAdd.forEach(function (name: string) {\r\n          if (self.hasInput(name)) {\r\n            return;\r\n          }\r\n\r\n          self.registerInput(name, {\r\n            set(value: any) {\r\n              internal.scope[name] = value;\r\n              if (!this.isInputConnected(\"run\")) {\r\n                // @ts-expect-error\r\n                this._scheduleEvaluateExpression();\r\n              }\r\n            },\r\n          });\r\n\r\n          internal.scope[name] = 0;\r\n          (self as any)._inputValues[name] = 0;\r\n        });\r\n\r\n        internal.inputNames = Object.keys(internal.scope);\r\n        if (!this.isInputConnected(\"run\"))\r\n          (this as any)._scheduleEvaluateExpression();\r\n      },\r\n    },\r\n    run: {\r\n      group: \"Actions\",\r\n      displayName: \"Run\",\r\n      type: \"signal\",\r\n      valueChangedToTrue() {\r\n        (this as any)._scheduleEvaluateExpression();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    result: {\r\n      group: \"Result\",\r\n      type: \"*\",\r\n      displayName: \"Result\",\r\n      getter() {\r\n        if (!this._internal.currentExpression) {\r\n          return 0;\r\n        }\r\n\r\n        return this._internal.cachedValue;\r\n      },\r\n    },\r\n    isTrue: {\r\n      group: \"Result\",\r\n      type: \"boolean\",\r\n      displayName: \"Is True\",\r\n      getter() {\r\n        if (!this._internal.currentExpression) {\r\n          return false;\r\n        }\r\n\r\n        return !!this._internal.cachedValue;\r\n      },\r\n    },\r\n    isFalse: {\r\n      group: \"Result\",\r\n      type: \"boolean\",\r\n      displayName: \"Is False\",\r\n      getter() {\r\n        if (!this._internal.currentExpression) {\r\n          return true;\r\n        }\r\n\r\n        return !this._internal.cachedValue;\r\n      },\r\n    },\r\n    isTrueEv: {\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n      displayName: \"On True\",\r\n    },\r\n    isFalseEv: {\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n      displayName: \"On False\",\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      this._internal.scope[name] = 0;\r\n      (this as any)._inputValues[name] = 0;\r\n\r\n      this.registerInput(name, {\r\n        set(value: any) {\r\n          this._internal.scope[name] = value;\r\n          if (!this.isInputConnected(\"run\"))\r\n            (this as any)._scheduleEvaluateExpression();\r\n        },\r\n      });\r\n    },\r\n    _scheduleEvaluateExpression() {\r\n      const internal = this._internal;\r\n      if (internal.hasScheduledEvaluation !== false) {\r\n        return;\r\n      }\r\n\r\n      internal.hasScheduledEvaluation = true;\r\n\r\n      this.flagDirty();\r\n      this.scheduleAfterInputsHaveUpdated(function () {\r\n        const lastValue = internal.cachedValue;\r\n        internal.cachedValue = (this as any)._calculateExpression();\r\n        if (lastValue !== internal.cachedValue) {\r\n          this.flagOutputDirty(\"result\");\r\n          this.flagOutputDirty(\"isTrue\");\r\n          this.flagOutputDirty(\"isFalse\");\r\n        }\r\n        if (internal.cachedValue) this.sendSignalOnOutput(\"isTrueEv\");\r\n        else this.sendSignalOnOutput(\"isFalseEv\");\r\n        internal.hasScheduledEvaluation = false;\r\n      });\r\n    },\r\n    _calculateExpression() {\r\n      const internal = this._internal;\r\n\r\n      if (!internal.compiledFunction) {\r\n        internal.compiledFunction = (this as any)._compileFunction();\r\n      }\r\n      for (let i = 0; i < internal.inputNames.length; ++i) {\r\n        const inputValue = internal.scope[internal.inputNames[i]];\r\n        internal.inputValues[i] = inputValue;\r\n      }\r\n      try {\r\n        if (!internal.compiledFunction) {\r\n          throw new Error(\"Compiled function is undefined\");\r\n        }\r\n        return internal.compiledFunction.apply(null, internal.inputValues);\r\n      } catch (e) {\r\n        if (e instanceof Error) {\r\n          console.error(\"Error in expression:\", e.message);\r\n        }\r\n      }\r\n      return undefined;\r\n    },\r\n    // @ts-expect-error\r\n    _compileFunction() {\r\n      const expression = this._internal.currentExpression;\r\n      const args = Object.keys(this._internal.scope);\r\n\r\n      const key = expression + args.join(\" \");\r\n\r\n      if (!compiledFunctionsCache[key]) {\r\n        args.push(expression);\r\n\r\n        try {\r\n          compiledFunctionsCache[key] = construct(Function, args);\r\n        } catch (e) {\r\n          if (e instanceof Error) {\r\n            console.error(\"Failed to compile JS function\", e.message);\r\n          }\r\n        }\r\n      }\r\n      return compiledFunctionsCache[key];\r\n    },\r\n  },\r\n};\r\n\r\nconst functionPreamble = [\r\n  \"var min = Math.min,\" +\r\n    \"    max = Math.max,\" +\r\n    \"    cos = Math.cos,\" +\r\n    \"    sin = Math.sin,\" +\r\n    \"    tan = Math.tan,\" +\r\n    \"    sqrt = Math.sqrt,\" +\r\n    \"    pi = Math.PI,\" +\r\n    \"    round = Math.round,\" +\r\n    \"    floor = Math.floor,\" +\r\n    \"    ceil = Math.ceil,\" +\r\n    \"    abs = Math.abs,\" +\r\n    \"    random = Math.random;\",\r\n].join(\"\");\r\n\r\nfunction construct(\r\n  constructor: Function,\r\n  args: any[]\r\n): (this: Node<Internal>, ...args: any[]) => void {\r\n  function F(this: any) {\r\n    return constructor.apply(this, args);\r\n  }\r\n  F.prototype = constructor.prototype;\r\n  // @ts-expect-error\r\n  return new F();\r\n}\r\n\r\nconst compiledFunctionsCache: Record<\r\n  string,\r\n  (this: Node<Internal>, ...args: any[]) => void\r\n> = {};\r\n\r\nconst portsToIgnore = [\r\n  \"min\",\r\n  \"max\",\r\n  \"cos\",\r\n  \"sin\",\r\n  \"tan\",\r\n  \"sqrt\",\r\n  \"pi\",\r\n  \"round\",\r\n  \"floor\",\r\n  \"ceil\",\r\n  \"abs\",\r\n  \"random\",\r\n  \"Math\",\r\n  \"window\",\r\n  \"document\",\r\n  \"undefined\",\r\n  \"Vars\",\r\n  \"true\",\r\n  \"false\",\r\n  \"null\",\r\n  \"Boolean\",\r\n];\r\n\r\nfunction parsePorts(expression: string): string[] {\r\n  const ports: string[] = [];\r\n\r\n  function addPort(name: string): void {\r\n    if (portsToIgnore.indexOf(name) !== -1) return;\r\n    if (ports.some((p) => p === name)) return;\r\n\r\n    ports.push(name);\r\n  }\r\n\r\n  // First remove all strings\r\n  expression = expression\r\n    .replace(/\\\"([^\\\"]*)\\\"/g, \"\")\r\n    .replace(/\\'([^\\']*)\\'/g, \"\");\r\n\r\n  // Extract identifiers\r\n  const identifiers = expression.matchAll(/[a-zA-Z\\_\\$][a-zA-Z0-9\\.\\_\\$]*/g);\r\n  for (const _id of identifiers) {\r\n    let name = _id[0];\r\n    if (name.indexOf(\".\") !== -1) {\r\n      name = name.split(\".\")[0]; // Take first symbol on \".\" sequence\r\n    }\r\n\r\n    addPort(name);\r\n  }\r\n\r\n  return ports;\r\n}\r\n\r\nfunction updatePorts(\r\n  nodeId: string,\r\n  expression: string,\r\n  editorConnection: EditorConnection\r\n): void {\r\n  const portNames = parsePorts(expression);\r\n\r\n  const ports = portNames.map((name) => ({\r\n    group: \"Parameters\",\r\n    name,\r\n    type: {\r\n      name: \"*\",\r\n      editAsType: \"string\",\r\n    },\r\n    plug: \"input\",\r\n  }));\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nfunction evalCompileWarnings(\r\n  editorConnection: EditorConnection,\r\n  node: NodeModel\r\n): void {\r\n  try {\r\n    new Function(node.parameters.expression);\r\n    editorConnection.clearWarning(\r\n      node.component!.name,\r\n      node.id,\r\n      \"expression-compile-error\"\r\n    );\r\n  } catch (e) {\r\n    if (e instanceof Error) {\r\n      editorConnection.sendWarning(\r\n        node.component!.name,\r\n        node.id,\r\n        \"expression-compile-error\",\r\n        {\r\n          message: e.message,\r\n        }\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport function setup(\r\n  context: { editorConnection?: EditorConnection },\r\n  graphModel: GraphModel\r\n): void {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  graphModel.on(\"nodeAdded.Expression\", (node) => {\r\n    if (node.parameters.expression) {\r\n      updatePorts(\r\n        node.id,\r\n        node.parameters.expression,\r\n        context.editorConnection!\r\n      );\r\n      evalCompileWarnings(context.editorConnection!, node);\r\n    }\r\n    node.on(\"parameterUpdated\", (event: Event) => {\r\n      if (event.name === \"expression\") {\r\n        updatePorts(\r\n          node.id,\r\n          node.parameters.expression,\r\n          context.editorConnection!\r\n        );\r\n        evalCompileWarnings(context.editorConnection!, node);\r\n      }\r\n    });\r\n  });\r\n}\r\n","import { Model } from \"./model\";\r\nimport { Port, PortType } from \"./models/componentmodel\";\r\nimport { getAbsoluteUrl } from \"./utils\";\r\n\r\ninterface UserObject {\r\n  inputs?: Record<string, any>;\r\n  outputs?: Record<string, any>;\r\n  setup?: Function;\r\n  run?: Function;\r\n  change?: Function;\r\n  destroy?: Function;\r\n  methods?: Record<string, Function>;\r\n  signals?: Record<string, Function>;\r\n  changed?: Record<string, Function>;\r\n}\r\n\r\ninterface NodeAPI {\r\n  Inputs: Record<string, any>;\r\n  Outputs: Record<string, any>;\r\n  Signals: Record<string, Function>;\r\n  Setters: Record<string, Function>;\r\n  OnInit?: Function;\r\n  OnDestroy?: Function;\r\n  OnInputsChanged?: Function;\r\n  setOutputs?: (outputs: Record<string, any>) => void;\r\n}\r\n\r\ninterface ParserOptions {\r\n  node?: any;\r\n}\r\n\r\ninterface PortOptions {\r\n  skipInputs?: boolean;\r\n  skipOutputs?: boolean;\r\n  skipOutputSignals?: boolean;\r\n  skipRegularOutputs?: boolean;\r\n  inputType?: PortType;\r\n  inputGroup?: string;\r\n  inputPrefix?: string;\r\n  outputPrefix?: string;\r\n}\r\n\r\nconst userFunctionsCache: Record<string, Function> = {};\r\n\r\nexport class JavascriptNodeParser {\r\n  inputs: Record<string, any>;\r\n  outputs: Record<string, any>;\r\n  error?: string;\r\n  code: string;\r\n  // @ts-ignore\r\n  apis: {\r\n    Node: NodeAPI;\r\n  };\r\n  setup?: Function;\r\n  change?: Function;\r\n  destroy?: Function;\r\n  definedObject?: any;\r\n\r\n  constructor(code: string, options?: ParserOptions) {\r\n    this.inputs = {};\r\n    this.outputs = {};\r\n    this.code = code;\r\n\r\n    const node = options ? options.node : undefined;\r\n    this._initializeAPIs();\r\n\r\n    let userCode = userFunctionsCache[code];\r\n    if (!userCode) {\r\n      try {\r\n        userCode = new Function(\r\n          // @ts-ignore\r\n          [\"define\", \"script\", \"Node\", \"Component\"],\r\n          JavascriptNodeParser.getCodePrefix() + code\r\n        );\r\n        userFunctionsCache[code] = userCode;\r\n      } catch (e: unknown) {\r\n        this.error = e instanceof Error ? e.message : String(e);\r\n        console.error(e);\r\n      }\r\n    }\r\n    if (userCode) {\r\n      try {\r\n        userCode(\r\n          this.define.bind(this),\r\n          this.script.bind(this),\r\n          // @ts-expect-error\r\n          this.apis.Node,\r\n          node ? JavascriptNodeParser.getComponentScopeForNode(node) : {}\r\n        );\r\n\r\n        this._afterSourced();\r\n      } catch (e: unknown) {\r\n        this.error = e instanceof Error ? e.message : String(e);\r\n        console.error(e);\r\n      }\r\n    }\r\n  }\r\n\r\n  define(userObject: UserObject): void {\r\n    this.inputs = userObject.inputs || {};\r\n    this.outputs = userObject.outputs || {};\r\n    this.setup = userObject.setup;\r\n    this.change = userObject.run || userObject.change;\r\n    this.destroy = userObject.destroy;\r\n\r\n    this.definedObject = userObject;\r\n  }\r\n\r\n  script(userObject: UserObject): void {\r\n    const _userObjectExtended = _scriptExtend(userObject);\r\n    this.inputs = _userObjectExtended.inputs || {};\r\n    this.outputs = _userObjectExtended.outputs || {};\r\n    this.setup = _userObjectExtended.setup;\r\n    this.change = _userObjectExtended.run || _userObjectExtended.change;\r\n    this.destroy = _userObjectExtended.destroy;\r\n\r\n    this.definedObject = _userObjectExtended;\r\n  }\r\n\r\n  _initializeAPIs(): void {\r\n    this.apis = {\r\n      Node: {\r\n        Inputs: {},\r\n        Outputs: {},\r\n        Signals: {},\r\n        Setters: {},\r\n      },\r\n    };\r\n  }\r\n\r\n  _afterSourced(): void {\r\n    if (this.definedObject !== undefined) return;\r\n\r\n    const _Node = this.apis.Node;\r\n\r\n    this.inputs = Object.assign({}, _Node.Inputs || {});\r\n    this.outputs = Object.assign({}, _Node.Outputs || {});\r\n\r\n    this.setup = function (\r\n      inputs: Record<string, any>,\r\n      outputs: Record<string, any>\r\n    ) {\r\n      const _this = this;\r\n\r\n      _Node.setOutputs = function (_outputs: Record<string, any>) {\r\n        for (const key in _outputs) {\r\n          outputs[key] = _outputs[key];\r\n          // @ts-ignore\r\n          _this.flagOutputDirty(key);\r\n        }\r\n      };\r\n\r\n      _Node.OnInit && _Node.OnInit.apply(this);\r\n    };\r\n\r\n    this.destroy = _Node.OnDestroy || this.destroy;\r\n    this.change = (\r\n      inputs: Record<string, any>,\r\n      outputs: Record<string, any>,\r\n      changedInputs: Record<string, any>\r\n    ) => {\r\n      for (const key in changedInputs) {\r\n        if (typeof _Node.Setters[key] === \"function\") {\r\n          _Node.Setters[key](inputs[key]);\r\n        }\r\n      }\r\n\r\n      if (typeof _Node.OnInputsChanged === \"function\") {\r\n        _Node.OnInputsChanged();\r\n      }\r\n    };\r\n\r\n    this.definedObject = {\r\n      inputs: this.inputs,\r\n      outputs: this.outputs,\r\n      setup: this.setup,\r\n      destroy: this.destroy,\r\n      change: this.change,\r\n    };\r\n\r\n    if (_Node.Signals !== undefined) {\r\n      for (const key in _Node.Signals) {\r\n        if (typeof _Node.Signals[key] === \"function\") {\r\n          this.inputs[key] = \"signal\";\r\n          this.definedObject[key] = _Node.Signals[key];\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  getPorts(): Port[] {\r\n    const ports: Port[] = [];\r\n\r\n    Object.keys(this.inputs).forEach((name) => {\r\n      const inputPort = this.inputs[name];\r\n\r\n      const port: Port = {\r\n        name,\r\n        plug: \"input\",\r\n        type: undefined,\r\n        group: \"Inputs\",\r\n      };\r\n\r\n      if (typeof inputPort === \"string\") {\r\n        port.type = {\r\n          name: inputPort,\r\n        };\r\n      } else {\r\n        Object.assign(port, inputPort);\r\n      }\r\n\r\n      ports.push(port);\r\n    });\r\n\r\n    Object.keys(this.outputs).forEach((name) => {\r\n      ports.push({\r\n        name,\r\n        type: {\r\n          name: this.outputs[name],\r\n        },\r\n        plug: \"output\",\r\n        group: \"Outputs\",\r\n      });\r\n    });\r\n\r\n    JavascriptNodeParser.parseAndAddPortsFromScript(this.code, ports, {});\r\n\r\n    return ports;\r\n  }\r\n\r\n  static createFromCode(\r\n    code: string,\r\n    options?: ParserOptions\r\n  ): JavascriptNodeParser {\r\n    return new JavascriptNodeParser(code, options);\r\n  }\r\n\r\n  static createFromURL(\r\n    url: string,\r\n    callback: (parser: JavascriptNodeParser) => void,\r\n    options?: ParserOptions\r\n  ): void {\r\n    url = getAbsoluteUrl(url);\r\n\r\n    const xhr = new XMLHttpRequest();\r\n    xhr.open(\"GET\", url, true);\r\n    xhr.onreadystatechange = function () {\r\n      if (this.readyState === 4 || this.readyState === XMLHttpRequest.DONE) {\r\n        callback(new JavascriptNodeParser(this.response));\r\n      }\r\n    };\r\n    xhr.onerror = function () {\r\n      console.log(\"Failed to request\", url);\r\n    };\r\n    xhr.send();\r\n  }\r\n\r\n  static parseAndAddPortsFromScript(\r\n    script: string,\r\n    ports: Port[],\r\n    options: PortOptions\r\n  ): void {\r\n    function _exists(port: string | { name: string; plug: string }): boolean {\r\n      if (typeof port === \"string\")\r\n        return ports.find((p) => p.name === port) !== undefined;\r\n      else\r\n        return (\r\n          ports.find((p) => p.name === port.name && p.plug === port.plug) !==\r\n          undefined\r\n        );\r\n    }\r\n\r\n    function _addPortsFromMatch(\r\n      match: IterableIterator<RegExpMatchArray>,\r\n      options: {\r\n        type: PortType;\r\n        plug: Port[\"plug\"];\r\n        group: string;\r\n        prefix: string;\r\n      }\r\n    ): void {\r\n      if (match === undefined || match === null) return;\r\n\r\n      const unique: Record<string, boolean> = {};\r\n      for (const _s of match) {\r\n        let name = _s[1];\r\n        if (name === undefined) continue;\r\n\r\n        unique[name] = true;\r\n      }\r\n\r\n      Object.keys(unique).forEach((p) => {\r\n        if (\r\n          _exists({\r\n            name: options.prefix + p,\r\n            plug: options.plug,\r\n          })\r\n        )\r\n          return;\r\n\r\n        ports.push({\r\n          name: options.prefix + p,\r\n          displayName: p,\r\n          plug: options.plug,\r\n          type: options.type,\r\n          group: options.group,\r\n        });\r\n      });\r\n    }\r\n\r\n    if (!options.skipInputs) {\r\n      _addPortsFromMatch(script.matchAll(/Inputs\\.([A-Za-z0-9_]+)/g), {\r\n        type: options.inputType || \"*\",\r\n        plug: \"input\",\r\n        group: options.inputGroup || \"Inputs\",\r\n        prefix: options.inputPrefix || \"\",\r\n      });\r\n\r\n      _addPortsFromMatch(\r\n        script.matchAll(/Inputs\\s*\\[\\s*(?:'|\")(.*)(?:'|\")\\s*\\]/g),\r\n        {\r\n          type: options.inputType || \"*\",\r\n          plug: \"input\",\r\n          group: options.inputGroup || \"Inputs\",\r\n          prefix: options.inputPrefix || \"\",\r\n        }\r\n      );\r\n    }\r\n\r\n    if (!options.skipOutputs) {\r\n      if (!options.skipOutputSignals) {\r\n        _addPortsFromMatch(\r\n          script.matchAll(/Outputs\\.([A-Za-z0-9]+)\\s*\\(\\s*\\)/g),\r\n          {\r\n            type: \"signal\",\r\n            plug: \"output\",\r\n            group: \"Outputs\",\r\n            prefix: options.outputPrefix || \"\",\r\n          }\r\n        );\r\n\r\n        _addPortsFromMatch(\r\n          script.matchAll(/Outputs\\s*\\[\\s*(?:'|\")(.*)(?:'|\")\\s*\\]\\(\\s*\\)/g),\r\n          {\r\n            type: \"signal\",\r\n            plug: \"output\",\r\n            group: \"Outputs\",\r\n            prefix: options.outputPrefix || \"\",\r\n          }\r\n        );\r\n      }\r\n\r\n      if (!options.skipRegularOutputs) {\r\n        _addPortsFromMatch(script.matchAll(/Outputs\\.([A-Za-z0-9_]+)/g), {\r\n          type: \"*\",\r\n          plug: \"output\",\r\n          group: \"Outputs\",\r\n          prefix: options.outputPrefix || \"\",\r\n        });\r\n\r\n        _addPortsFromMatch(\r\n          script.matchAll(/Outputs\\s*\\[\\s*\\\"([^\\\"]*)\\\"\\s*\\]/g),\r\n          {\r\n            type: \"*\",\r\n            plug: \"output\",\r\n            group: \"Outputs\",\r\n            prefix: options.outputPrefix || \"\",\r\n          }\r\n        );\r\n      }\r\n    }\r\n  }\r\n\r\n  static getCodePrefix(): string {\r\n    return \"const Script = (typeof Node !== 'undefined')?Node:undefined;\\n\";\r\n  }\r\n\r\n  static createNoodlAPI(): any {\r\n    return typeof window !== \"undefined\" && (window as any).Noodl !== undefined\r\n      ? (window as any).Noodl\r\n      : {};\r\n  }\r\n\r\n  static getComponentScopeForNode(node: any): any {\r\n    const componentId = node.nodeScope.componentOwner.getInstanceId();\r\n\r\n    if (_componentScopes[componentId] === undefined) {\r\n      _componentScopes[componentId] = {};\r\n\r\n      const componentObject = (node.nodeScope.modelScope || Model).get(\r\n        \"componentState\" + componentId\r\n      );\r\n\r\n      _componentScopes[componentId].Object = componentObject;\r\n    }\r\n\r\n    const parentComponentObjectId = _findParentComponentStateModelId(node);\r\n    const parentComponentObject =\r\n      parentComponentObjectId !== undefined\r\n        ? (node.nodeScope.modelScope || Model).get(parentComponentObjectId)\r\n        : undefined;\r\n\r\n    _componentScopes[componentId].ParentObject = parentComponentObject;\r\n\r\n    _componentScopes[componentId].RepeaterObject = _findForEachModel(node);\r\n\r\n    return _componentScopes[componentId];\r\n  }\r\n}\r\n\r\nfunction _scriptExtend(userObject: UserObject): any {\r\n  const _extended = {\r\n    inputs: userObject.inputs || {},\r\n    outputs: userObject.outputs || {},\r\n\r\n    setup: function (\r\n      inputs: Record<string, any>,\r\n      outputs: Record<string, any>\r\n    ) {\r\n      this.inputs = inputs;\r\n      this.outputs = outputs;\r\n\r\n      // @ts-expect-error\r\n      this.setOutputs = function (states: Record<string, any>) {\r\n        for (const key in states) {\r\n          this.outputs[key] = states[key];\r\n          // @ts-ignore\r\n          this.flagOutputDirty(key);\r\n        }\r\n      };\r\n\r\n      if (userObject.methods) {\r\n        for (const key in userObject.methods) {\r\n          // @ts-ignore\r\n          this[key] = userObject.methods[key];\r\n        }\r\n      }\r\n\r\n      userObject.setup && userObject.setup.apply(this);\r\n    },\r\n\r\n    destroy: function (\r\n      inputs: Record<string, any>,\r\n      outputs: Record<string, any>\r\n    ) {\r\n      this.inputs = inputs;\r\n      this.outputs = outputs;\r\n\r\n      userObject.destroy && userObject.destroy.apply(this);\r\n    },\r\n\r\n    change: function (\r\n      inputs: Record<string, any>,\r\n      outputs: Record<string, any>\r\n    ) {\r\n      this.inputs = inputs;\r\n      this.outputs = outputs;\r\n\r\n      // @ts-ignore\r\n      const old = this._oldInputs || {};\r\n\r\n      if (userObject.changed) {\r\n        for (const key in inputs) {\r\n          if (inputs[key] !== old[key]) {\r\n            const changedFunction = userObject.changed[key];\r\n            if (typeof changedFunction === \"function\")\r\n              changedFunction.apply(this, [inputs[key], old[key]]);\r\n          }\r\n        }\r\n      }\r\n\r\n      // @ts-ignore\r\n      this._oldInputs = Object.assign({}, inputs);\r\n    },\r\n  };\r\n\r\n  if (userObject.signals) {\r\n    for (const key in userObject.signals) {\r\n      // @ts-ignore\r\n      _extended[key] = userObject.signals[key];\r\n      _extended.inputs[key] = \"signal\";\r\n    }\r\n  }\r\n\r\n  return _extended;\r\n}\r\n\r\nconst _componentScopes: Record<string, any> = {};\r\n\r\nfunction _findParentComponentStateModelId(node: any): string | undefined {\r\n  function getParentComponent(component: any): any {\r\n    let parent;\r\n    if (component.getRoots().length > 0) {\r\n      const root = component.getRoots()[0];\r\n\r\n      if (root.getVisualParentNode) {\r\n        if (root.getVisualParentNode()) {\r\n          parent = root.getVisualParentNode().nodeScope.componentOwner;\r\n        }\r\n      } else if (root.parentNodeScope) {\r\n        parent = component.parentNodeScope.componentOwner;\r\n      }\r\n    } else if (component.parentNodeScope) {\r\n      parent = component.parentNodeScope.componentOwner;\r\n    }\r\n\r\n    if (\r\n      parent &&\r\n      parent.nodeScope &&\r\n      parent.nodeScope.componentOwner !== component\r\n    ) {\r\n      if (\r\n        parent.nodeScope.getNodesWithType(\"net.noodl.ComponentObject\").length >\r\n        0\r\n      ) {\r\n        return parent;\r\n      }\r\n\r\n      if (parent.nodeScope.getNodesWithType(\"Component State\").length > 0) {\r\n        return parent;\r\n      }\r\n\r\n      return getParentComponent(parent);\r\n    }\r\n  }\r\n\r\n  const parent = getParentComponent(node.nodeScope.componentOwner);\r\n  if (!parent) return;\r\n\r\n  return \"componentState\" + parent.getInstanceId();\r\n}\r\n\r\nfunction _findForEachModel(node: any): any {\r\n  let component = node.nodeScope.componentOwner;\r\n  while (\r\n    component !== undefined &&\r\n    component._forEachModel === undefined &&\r\n    component.parentNodeScope\r\n  ) {\r\n    component = component.parentNodeScope.componentOwner;\r\n  }\r\n  return component !== undefined ? component._forEachModel : undefined;\r\n}\r\n","import { JavascriptNodeParser } from \"../../javascriptnodeparser\";\r\nimport { Port } from \"../../models/componentmodel\";\r\nimport { GraphModel } from \"../../models/graphmodel\";\r\nimport { NodeContext } from \"../../nodecontext\";\r\nimport { NodeDefinition } from \"../../nodedefinition\";\r\nimport { logJavaScriptNodeError } from \"../../utils\";\r\n\r\ninterface InputValues {\r\n  [key: string]: any;\r\n}\r\n\r\ninterface OutputValues {\r\n  [key: string]: any;\r\n}\r\n\r\ninterface Internal {\r\n  inputValues: InputValues;\r\n  outputValues: OutputValues;\r\n  outputValuesProxy: OutputValues;\r\n  _this: any;\r\n  func?: Function;\r\n  inputTypes: { [key: string]: string };\r\n  outputTypes: { [key: string]: string };\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"JavaScriptFunction\",\r\n  displayNodeName: \"Function\",\r\n  docs: \"https://docs.noodl.net/nodes/javascript/function\",\r\n  category: \"CustomCode\",\r\n  color: \"javascript\",\r\n  nodeDoubleClickAction: {\r\n    focusPort: \"Script\",\r\n  },\r\n  searchTags: [\"javascript\"],\r\n  exportDynamicPorts: true,\r\n  initialize: function (this: any) {\r\n    this._internal = {}; // TODO: Is this needed?\r\n    this._internal.inputValues = {};\r\n    this._internal.outputValues = {};\r\n    this._internal.inputTypes = {};\r\n    this._internal.outputTypes = {};\r\n\r\n    this._internal.outputValuesProxy = new Proxy(this._internal.outputValues, {\r\n      set: (obj: OutputValues, prop: string, value: any) => {\r\n        //a function node can continue running after it has been deleted. E.g. with timeouts or event listeners that hasn't been removed.\r\n        //if the node is deleted, just do nothing\r\n        if (this._deleted) {\r\n          return true;\r\n        }\r\n\r\n        //only send outputs when they change.\r\n        //Some Noodl projects rely on this behavior, so changing it breaks backwards compability\r\n        if (value !== this._internal.outputValues[prop]) {\r\n          this.registerOutputIfNeeded(\"out-\" + prop);\r\n\r\n          this._internal.outputValues[prop] = value;\r\n          this.flagOutputDirty(\"out-\" + prop);\r\n        }\r\n        return true;\r\n      },\r\n    });\r\n\r\n    this._internal._this = {};\r\n  },\r\n  getInspectInfo() {\r\n    return [\r\n      {\r\n        type: \"value\",\r\n        value: {\r\n          inputs: this._internal.inputValues,\r\n          outputs: this._internal.outputValues,\r\n        },\r\n      },\r\n    ];\r\n  },\r\n  inputs: {\r\n    scriptInputs: {\r\n      type: {\r\n        name: \"proplist\",\r\n        allowEditOnly: true,\r\n      },\r\n      group: \"Script Inputs\",\r\n      set(value: any) {\r\n        //  ignore\r\n      },\r\n    },\r\n    scriptOutputs: {\r\n      type: {\r\n        name: \"proplist\",\r\n        allowEditOnly: true,\r\n      },\r\n      group: \"Script Outputs\",\r\n      set(value: any) {\r\n        //  ignore\r\n      },\r\n    },\r\n    functionScript: {\r\n      displayName: \"Script\",\r\n      // @ts-expect-error TODO: What is this... ???\r\n      plug: \"input\",\r\n      type: {\r\n        name: \"string\",\r\n        allowEditOnly: true,\r\n        codeeditor: \"javascript\",\r\n      },\r\n      group: \"General\",\r\n      set(this: any, script?: string) {\r\n        if (script === undefined) {\r\n          this._internal.func = undefined;\r\n          return;\r\n        }\r\n\r\n        this._internal.func = this.parseScript(script);\r\n\r\n        if (!this.isInputConnected(\"run\")) this.scheduleRun();\r\n      },\r\n    },\r\n    run: {\r\n      type: \"signal\",\r\n      displayName: \"Run\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue: function (this: any) {\r\n        this.scheduleRun();\r\n      },\r\n    },\r\n  },\r\n  outputs: {},\r\n  methods: {\r\n    scheduleRun() {\r\n      // @ts-expect-error\r\n      if (this.runScheduled) return;\r\n      // @ts-expect-error\r\n      this.runScheduled = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.runScheduled = false;\r\n\r\n        if (!this._deleted) {\r\n          // @ts-expect-error\r\n          this.runScript();\r\n        }\r\n      });\r\n    },\r\n    async runScript() {\r\n      const func = this._internal.func;\r\n\r\n      if (func === undefined) return;\r\n\r\n      const inputs = this._internal.inputValues;\r\n      const outputs = this._internal.outputValuesProxy;\r\n\r\n      // Prepare send signal functions\r\n      for (const key in this.model!.outputPorts) {\r\n        // @ts-expect-error\r\n        if (this._isSignalType(key)) {\r\n          const _sendSignal = () => {\r\n            if (this.hasOutput(key)) this.sendSignalOnOutput(key);\r\n          };\r\n          this._internal.outputValues[key.substring(\"out-\".length)] =\r\n            _sendSignal;\r\n          this._internal.outputValues[key.substring(\"out-\".length)].send =\r\n            _sendSignal;\r\n        }\r\n      }\r\n\r\n      try {\r\n        await func.apply(this._internal._this, [\r\n          inputs,\r\n          outputs,\r\n          // @ts-expect-error\r\n          JavascriptNodeParser.createNoodlAPI(this.nodeScope!.modelScope),\r\n          JavascriptNodeParser.getComponentScopeForNode(this),\r\n        ]);\r\n      } catch (e: any) {\r\n        logJavaScriptNodeError(e);\r\n\r\n        if (\r\n          this.context.editorConnection &&\r\n          this.context.isWarningTypeEnabled(\"javascriptExecution\")\r\n        ) {\r\n          this.context.editorConnection.sendWarning(\r\n            this.nodeScope!.componentOwner.name,\r\n            this.id,\r\n            \"js-function-run-waring\",\r\n            {\r\n              showGlobally: true,\r\n              message: e.message,\r\n              stack: e.stack,\r\n            }\r\n          );\r\n        }\r\n      }\r\n    },\r\n    setScriptInputValue(name: string, value: any) {\r\n      this._internal.inputValues[name] = value;\r\n\r\n      if (!this.isInputConnected(\"run\")) {\r\n        // @ts-expect-error\r\n        this.scheduleRun();\r\n      }\r\n    },\r\n    getScriptOutputValue(name: string) {\r\n      // @ts-expect-error\r\n      if (this._isSignalType(name)) {\r\n        return undefined;\r\n      }\r\n      return this._internal.outputValues[name];\r\n    },\r\n    setScriptInputType(name: string, type: string) {\r\n      this._internal.inputTypes[name] = type;\r\n    },\r\n    setScriptOutputType(name: string, type: string) {\r\n      this._internal.outputTypes[name] = type;\r\n    },\r\n    parseScript(script: string) {\r\n      let func;\r\n      try {\r\n        const AsyncFunction = Object.getPrototypeOf(\r\n          async function () {}\r\n        ).constructor;\r\n        func = new AsyncFunction(\r\n          \"Inputs\",\r\n          \"Outputs\",\r\n          \"Noodl\",\r\n          \"Component\",\r\n          JavascriptNodeParser.getCodePrefix() + script\r\n        );\r\n      } catch (e) {\r\n        console.log(\"Error while parsing action script: \" + e);\r\n      }\r\n\r\n      return func;\r\n    },\r\n    _isSignalType(name: string): boolean {\r\n      // This will catch signals in script that may not have been delivered by the editor yet\r\n      return (\r\n        this.model!.outputPorts[name] &&\r\n        // @ts-expect-error\r\n        this.model.outputPorts[name].type === \"signal\"\r\n      );\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"in-\")) {\r\n        const n = name.substring(\"in-\".length);\r\n\r\n        const input = {\r\n          // @ts-expect-error\r\n          set: this.setScriptInputValue.bind(this, n),\r\n        };\r\n\r\n        //make sure we register the type as well, so Noodl resolves types like color styles to an actual color\r\n        if (this.model && this.model.parameters[\"intype-\" + n]) {\r\n          // @ts-expect-error\r\n          input.type = this.model.parameters[\"intype-\" + n];\r\n        }\r\n\r\n        this.registerInput(name, input);\r\n      }\r\n\r\n      if (name.startsWith(\"intype-\")) {\r\n        const n = name.substring(\"intype-\".length);\r\n\r\n        this.registerInput(name, {\r\n          set(value: any) {\r\n            //make sure we register the type as well, so Noodl resolves types like color styles to an actual color\r\n            if (this.hasInput(\"in\" + n)) {\r\n              // @ts-expect-error\r\n              this.getInput(\"in\" + n).type = value;\r\n            }\r\n          },\r\n        });\r\n      }\r\n\r\n      if (name.startsWith(\"outtype-\")) {\r\n        this.registerInput(name, {\r\n          set() {}, // Ignore\r\n        });\r\n      }\r\n    },\r\n    registerOutputIfNeeded(name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"out-\"))\r\n        return this.registerOutput(name, {\r\n          // @ts-expect-error\r\n          getter: this.getScriptOutputValue.bind(\r\n            this,\r\n            name.substring(\"out-\".length)\r\n          ),\r\n        });\r\n    },\r\n  },\r\n};\r\n\r\nfunction _parseScriptForErrorsAndPorts(\r\n  script: string | undefined,\r\n  name: string,\r\n  node: any,\r\n  context: any,\r\n  ports: Port[]\r\n) {\r\n  // Clear run warnings if the script is edited\r\n  context.editorConnection.clearWarning(\r\n    node.component.name,\r\n    node.id,\r\n    \"js-function-run-waring\"\r\n  );\r\n\r\n  if (script === undefined) {\r\n    context.editorConnection.clearWarning(\r\n      node.component.name,\r\n      node.id,\r\n      \"js-function-parse-waring\"\r\n    );\r\n    return;\r\n  }\r\n\r\n  try {\r\n    const AsyncFunction = Object.getPrototypeOf(\r\n      async function () {}\r\n    ).constructor;\r\n    new AsyncFunction(\"Inputs\", \"Outputs\", \"Noodl\", \"Component\", script);\r\n\r\n    context.editorConnection.clearWarning(\r\n      node.component.name,\r\n      node.id,\r\n      \"js-function-parse-waring\"\r\n    );\r\n  } catch (e: any) {\r\n    context.editorConnection.sendWarning(\r\n      node.component.name,\r\n      node.id,\r\n      \"js-function-parse-waring\",\r\n      {\r\n        showGlobally: true,\r\n        message: e.message,\r\n      }\r\n    );\r\n  }\r\n\r\n  JavascriptNodeParser.parseAndAddPortsFromScript(script, ports, {\r\n    inputPrefix: \"in-\",\r\n    outputPrefix: \"out-\",\r\n  });\r\n}\r\n\r\nconst inputTypeEnums = [\r\n  {\r\n    value: \"string\",\r\n    label: \"String\",\r\n  },\r\n  {\r\n    value: \"boolean\",\r\n    label: \"Boolean\",\r\n  },\r\n  {\r\n    value: \"number\",\r\n    label: \"Number\",\r\n  },\r\n  {\r\n    value: \"object\",\r\n    label: \"Object\",\r\n  },\r\n  {\r\n    value: \"date\",\r\n    label: \"Date\",\r\n  },\r\n  {\r\n    value: \"array\",\r\n    label: \"Array\",\r\n  },\r\n  {\r\n    value: \"color\",\r\n    label: \"Color\",\r\n  },\r\n];\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    function _updatePorts() {\r\n      const ports: Port[] = [];\r\n\r\n      const _outputTypeEnums = inputTypeEnums.concat([\r\n        {\r\n          value: \"signal\",\r\n          label: \"Signal\",\r\n        },\r\n      ]);\r\n\r\n      // Outputs\r\n      if (\r\n        node.parameters[\"scriptOutputs\"] !== undefined &&\r\n        node.parameters[\"scriptOutputs\"].length > 0\r\n      ) {\r\n        node.parameters[\"scriptOutputs\"].forEach(\r\n          (p: { label: string; id: string }) => {\r\n            // Type for output\r\n            ports.push({\r\n              name: \"outtype-\" + p.label,\r\n              displayName: \"Type\",\r\n              editorName: p.label + \" | Type\",\r\n              plug: \"input\",\r\n              type: {\r\n                name: \"enum\",\r\n                enums: _outputTypeEnums,\r\n                allowEditOnly: true,\r\n              },\r\n              default: \"string\",\r\n              parent: \"scriptOutputs\",\r\n              parentItemId: p.id,\r\n            });\r\n\r\n            // Value for output\r\n            ports.push({\r\n              name: \"out-\" + p.label,\r\n              displayName: p.label,\r\n              plug: \"output\",\r\n              type: node.parameters[\"outtype-\" + p.label] || \"*\",\r\n              group: \"Outputs\",\r\n            });\r\n          }\r\n        );\r\n      }\r\n\r\n      // Inputs\r\n      if (\r\n        node.parameters[\"scriptInputs\"] !== undefined &&\r\n        node.parameters[\"scriptInputs\"].length > 0\r\n      ) {\r\n        node.parameters[\"scriptInputs\"].forEach(\r\n          (p: { label: string; id: string }) => {\r\n            // Type for input\r\n            ports.push({\r\n              name: \"intype-\" + p.label,\r\n              displayName: \"Type\",\r\n              editorName: p.label + \" | Type\",\r\n              plug: \"input\",\r\n              type: {\r\n                name: \"enum\",\r\n                enums: inputTypeEnums,\r\n                allowEditOnly: true,\r\n              },\r\n              default: \"string\",\r\n              parent: \"scriptInputs\",\r\n              parentItemId: p.id,\r\n            });\r\n\r\n            // Default Value for input\r\n            ports.push({\r\n              name: \"in-\" + p.label,\r\n              displayName: p.label,\r\n              plug: \"input\",\r\n              type: node.parameters[\"intype-\" + p.label] || \"string\",\r\n              group: \"Inputs\",\r\n            });\r\n          }\r\n        );\r\n      }\r\n\r\n      _parseScriptForErrorsAndPorts(\r\n        node.parameters[\"functionScript\"],\r\n        \"Script \",\r\n        node,\r\n        context,\r\n        ports\r\n      );\r\n\r\n      // Push output ports that are signals directly to the model, it's needed by the initial run of\r\n      // the script function\r\n      ports.forEach((p) => {\r\n        if (p.type === \"signal\" && p.plug === \"output\") {\r\n          node.outputPorts[p.name] = p;\r\n        }\r\n      });\r\n\r\n      context.editorConnection?.sendDynamicPorts(node.id, ports);\r\n    }\r\n\r\n    _updatePorts();\r\n    node.on(\"parameterUpdated\", function () {\r\n      _updatePorts();\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.JavaScriptFunction\", function (node: any) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"JavaScriptFunction\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","import { CloudStore } from \"./cloudstore\";\r\nimport { Model } from \"../model\";\r\n\r\ninterface QueryRule {\r\n  combinator?: string;\r\n  rules?: QueryRule[];\r\n  operator?: string;\r\n  input?: string;\r\n  value?: any;\r\n  property?: string;\r\n  relatedTo?: string;\r\n  relationProperty?: string;\r\n}\r\n\r\ninterface QueryParameters {\r\n  [key: string]: any;\r\n}\r\n\r\ninterface QueryOptions {\r\n  queryParameters?: QueryParameters;\r\n  collectionName?: string;\r\n  modelScope?: typeof Model;\r\n  error?: (error: string) => void;\r\n}\r\n\r\ninterface SortRule {\r\n  order: \"ascending\" | \"descending\";\r\n  property: string;\r\n}\r\n\r\ninterface RelatedToFilter {\r\n  id: string;\r\n  key: string;\r\n  className?: string;\r\n}\r\n\r\ninterface FilterOperators {\r\n  equalTo?: any;\r\n  notEqualTo?: any;\r\n  lessThan?: any;\r\n  greaterThan?: any;\r\n  lessThanOrEqualTo?: any;\r\n  greaterThanOrEqualTo?: any;\r\n  exists?: boolean;\r\n  containedIn?: any[];\r\n  notContainedIn?: any[];\r\n  pointsTo?: string | string[];\r\n  matchesRegex?: string;\r\n  options?: string;\r\n  text?: {\r\n    search:\r\n      | string\r\n      | {\r\n          term: string;\r\n          language?: string;\r\n          caseSensitive?: boolean;\r\n          diacriticSensitive?: boolean;\r\n        };\r\n  };\r\n  nearSphere?: {\r\n    latitude: number;\r\n    longitude: number;\r\n    maxDistanceInMiles?: number;\r\n    maxDistanceInKilometers?: number;\r\n    maxDistanceInRadians?: number;\r\n  };\r\n  withinBox?: Array<{\r\n    latitude: number;\r\n    longitude: number;\r\n  }>;\r\n  withinPolygon?: Array<{\r\n    latitude: number;\r\n    longitude: number;\r\n  }>;\r\n}\r\n\r\ninterface Filter {\r\n  and?: Filter[];\r\n  or?: Filter[];\r\n  idEqualTo?: string;\r\n  idContainedIn?: string[];\r\n  relatedTo?: RelatedToFilter;\r\n  [key: string]: any;\r\n}\r\n\r\nfunction convertVisualFilter(query: QueryRule, options: QueryOptions): any {\r\n  const inputs = options.queryParameters;\r\n\r\n  if (query.combinator !== undefined && query.rules !== undefined) {\r\n    if (query.rules.length === 0) return;\r\n    else if (query.rules.length === 1)\r\n      return convertVisualFilter(query.rules[0], options);\r\n    else {\r\n      const _res: any = {};\r\n      const _op = \"$\" + query.combinator;\r\n      _res[_op] = [];\r\n      query.rules.forEach((r) => {\r\n        const cond = convertVisualFilter(r, options);\r\n        if (cond !== undefined) _res[_op].push(cond);\r\n      });\r\n\r\n      return _res;\r\n    }\r\n  } else if (query.operator === \"related to\") {\r\n    // @ts-expect-error\r\n    const value = query.input !== undefined ? inputs[query.input] : undefined;\r\n    if (value === undefined) return;\r\n\r\n    return {\r\n      $relatedTo: {\r\n        object: {\r\n          __type: \"Pointer\",\r\n          objectId: value,\r\n          className: query.relatedTo,\r\n        },\r\n        key: query.relationProperty,\r\n      },\r\n    };\r\n  } else {\r\n    const _res: any = {};\r\n    let cond: any;\r\n    // @ts-expect-error\r\n    let value = query.input !== undefined ? inputs[query.input] : query.value;\r\n\r\n    if (query.operator === \"exist\") {\r\n      _res[query.property!] = { $exists: true };\r\n      return _res;\r\n    } else if (query.operator === \"not exist\") {\r\n      _res[query.property!] = { $exists: false };\r\n      return _res;\r\n    }\r\n\r\n    if (value === undefined) return;\r\n\r\n    let schema;\r\n    // @ts-expect-error\r\n    if (CloudStore._collections[options.collectionName!]) {\r\n      // @ts-expect-error\r\n      schema = CloudStore._collections[options.collectionName!].schema;\r\n    }\r\n\r\n    const propertyType =\r\n      schema && schema.properties && schema.properties[query.property!]\r\n        ? schema.properties[query.property!].type\r\n        : undefined;\r\n\r\n    if (propertyType === \"Date\") {\r\n      if (!(value instanceof Date)) value = new Date(value.toString());\r\n      value = { __type: \"Date\", iso: value.toISOString() };\r\n    }\r\n\r\n    if (query.operator === \"greater than\") cond = { $gt: value };\r\n    else if (query.operator === \"greater than or equal to\")\r\n      cond = { $gte: value };\r\n    else if (query.operator === \"less than\") cond = { $lt: value };\r\n    else if (query.operator === \"less than or equal to\") cond = { $lte: value };\r\n    else if (query.operator === \"equal to\") cond = { $eq: value };\r\n    else if (query.operator === \"not equal to\") cond = { $ne: value };\r\n    else if (query.operator === \"points to\") {\r\n      const targetClass =\r\n        schema && schema.properties && schema.properties[query.property!]\r\n          ? schema.properties[query.property!].targetClass\r\n          : undefined;\r\n\r\n      cond = {\r\n        $eq: { __type: \"Pointer\", objectId: value, className: targetClass },\r\n      };\r\n    } else if (query.operator === \"contain\") {\r\n      cond = { $regex: value, $options: \"i\" };\r\n    }\r\n\r\n    _res[query.property!] = cond;\r\n\r\n    return _res;\r\n  }\r\n}\r\n\r\nfunction matchesQuery(model: any, query: any): boolean {\r\n  let match = true;\r\n\r\n  if (query === undefined) return true;\r\n\r\n  if (query[\"$and\"] !== undefined) {\r\n    query[\"$and\"].forEach((q: any) => {\r\n      match = match && matchesQuery(model, q);\r\n    });\r\n  } else if (query[\"$or\"] !== undefined) {\r\n    match = false;\r\n    query[\"$or\"].forEach((q: any) => {\r\n      match = match || matchesQuery(model, q);\r\n    });\r\n  } else {\r\n    const keys = Object.keys(query);\r\n    keys.forEach((k) => {\r\n      if (k === \"objectId\") {\r\n        if (query[k][\"$eq\"] !== undefined)\r\n          match = match && model.getId() === query[k][\"$eq\"];\r\n        else if (query[k][\"$in\"] !== undefined)\r\n          match = match && query[k][\"$in\"].indexOf(model.getId()) !== -1;\r\n      } else if (k === \"$relatedTo\") {\r\n        match = false; // cannot resolve relation queries locally\r\n      } else {\r\n        const value = model.get(k);\r\n        if (\r\n          query[k][\"$eq\"] !== undefined &&\r\n          query[k][\"$eq\"].__type === \"Pointer\"\r\n        )\r\n          match = match && value === query[k][\"$eq\"].objectId;\r\n        else if (query[k][\"$eq\"] !== undefined)\r\n          match = match && value == query[k][\"$eq\"];\r\n        else if (query[k][\"$ne\"] !== undefined)\r\n          match = match && value != query[k][\"$ne\"];\r\n        else if (query[k][\"$lt\"] !== undefined)\r\n          match = match && value < query[k][\"$lt\"];\r\n        else if (query[k][\"$lte\"] !== undefined)\r\n          match = match && value <= query[k][\"$lt\"];\r\n        else if (query[k][\"$gt\"] !== undefined)\r\n          match = match && value > query[k][\"$gt\"];\r\n        else if (query[k][\"$gte\"] !== undefined)\r\n          match = match && value >= query[k][\"$gte\"];\r\n        else if (query[k][\"$exists\"] !== undefined)\r\n          match = match && value !== undefined;\r\n        else if (query[k][\"$in\"] !== undefined)\r\n          match = match && query[k][\"$in\"].indexOf(value) !== -1;\r\n        else if (query[k][\"$nin\"] !== undefined)\r\n          match = match && query[k][\"$in\"].indexOf(value) === -1;\r\n        else if (query[k][\"$regex\"] !== undefined)\r\n          match =\r\n            match &&\r\n            new RegExp(query[k][\"$regex\"], query[k][\"$options\"]).test(value);\r\n      }\r\n    });\r\n  }\r\n  return match;\r\n}\r\n\r\nfunction compareObjects(sort: string[], a: any, b: any): number {\r\n  for (let i = 0; i < sort.length; i++) {\r\n    let _s = sort[i];\r\n    if (_s[0] === \"-\") {\r\n      // Descending\r\n      let prop = _s.substring(1);\r\n      if (a.get(prop) > b.get(prop)) return -1;\r\n      else if (a.get(prop) < b.get(prop)) return 1;\r\n    } else {\r\n      // Ascending\r\n      if (a.get(_s) > b.get(_s)) return 1;\r\n      else if (a.get(_s) < b.get(_s)) return -1;\r\n    }\r\n  }\r\n  return 0;\r\n}\r\n\r\nfunction convertVisualSorting(sorting: SortRule[]): string[] {\r\n  return sorting.map((s) => {\r\n    return (s.order === \"descending\" ? \"-\" : \"\") + s.property;\r\n  });\r\n}\r\n\r\nfunction _value(v: any): any {\r\n  if (v instanceof Date && typeof v.toISOString === \"function\") {\r\n    return {\r\n      __type: \"Date\",\r\n      iso: v.toISOString(),\r\n    };\r\n  }\r\n  return v;\r\n}\r\n\r\nfunction convertFilterOp(filter: Filter, options: QueryOptions): any {\r\n  const keys = Object.keys(filter);\r\n  if (keys.length === 0) return {};\r\n  if (keys.length !== 1) {\r\n    return options?.error?.(\r\n      \"Filter must only have one key found \" + keys.join(\",\")\r\n    );\r\n  }\r\n\r\n  const res: any = {};\r\n  const key = keys[0];\r\n  if (filter[\"and\"] !== undefined && Array.isArray(filter[\"and\"])) {\r\n    res[\"$and\"] = filter[\"and\"].map((f) => convertFilterOp(f, options));\r\n  } else if (filter[\"or\"] !== undefined && Array.isArray(filter[\"or\"])) {\r\n    res[\"$or\"] = filter[\"or\"].map((f) => convertFilterOp(f, options));\r\n  } else if (filter[\"idEqualTo\"] !== undefined) {\r\n    res[\"objectId\"] = { $eq: filter[\"idEqualTo\"] };\r\n  } else if (filter[\"idContainedIn\"] !== undefined) {\r\n    res[\"objectId\"] = { $in: filter[\"idContainedIn\"] };\r\n  } else if (filter[\"relatedTo\"] !== undefined) {\r\n    const modelId = filter[\"relatedTo\"][\"id\"];\r\n    if (modelId === undefined) {\r\n      return options?.error?.(\"Must provide id in relatedTo filter\");\r\n    }\r\n\r\n    const relationKey = filter[\"relatedTo\"][\"key\"];\r\n    if (relationKey === undefined) {\r\n      return options?.error?.(\"Must provide key in relatedTo filter\");\r\n    }\r\n\r\n    const className =\r\n      filter[\"relatedTo\"][\"className\"] ||\r\n      (options.modelScope || Model).get(modelId)?._class;\r\n    if (typeof className === \"undefined\") {\r\n      // Either the pointer is loaded as an object or we allow passing in the className.\r\n      return options?.error?.(\"Must preload the Pointer or include className\");\r\n    }\r\n\r\n    res[\"$relatedTo\"] = {\r\n      object: {\r\n        __type: \"Pointer\",\r\n        objectId: modelId,\r\n        className,\r\n      },\r\n      key: relationKey,\r\n    };\r\n  } else if (typeof filter[key] === \"object\") {\r\n    const opAndValue = filter[key] as FilterOperators;\r\n    if (opAndValue[\"equalTo\"] !== undefined)\r\n      res[key] = { $eq: _value(opAndValue[\"equalTo\"]) };\r\n    else if (opAndValue[\"notEqualTo\"] !== undefined)\r\n      res[key] = { $ne: _value(opAndValue[\"notEqualTo\"]) };\r\n    else if (opAndValue[\"lessThan\"] !== undefined)\r\n      res[key] = { $lt: _value(opAndValue[\"lessThan\"]) };\r\n    else if (opAndValue[\"greaterThan\"] !== undefined)\r\n      res[key] = { $gt: _value(opAndValue[\"greaterThan\"]) };\r\n    else if (opAndValue[\"lessThanOrEqualTo\"] !== undefined)\r\n      res[key] = { $lte: _value(opAndValue[\"lessThanOrEqualTo\"]) };\r\n    else if (opAndValue[\"greaterThanOrEqualTo\"] !== undefined)\r\n      res[key] = { $gte: _value(opAndValue[\"greaterThanOrEqualTo\"]) };\r\n    else if (opAndValue[\"exists\"] !== undefined)\r\n      res[key] = { $exists: opAndValue[\"exists\"] };\r\n    else if (opAndValue[\"containedIn\"] !== undefined)\r\n      res[key] = { $in: opAndValue[\"containedIn\"] };\r\n    else if (opAndValue[\"notContainedIn\"] !== undefined)\r\n      res[key] = { $nin: opAndValue[\"notContainedIn\"] };\r\n    else if (opAndValue[\"pointsTo\"] !== undefined) {\r\n      let schema = null;\r\n      // @ts-expect-error\r\n      if (CloudStore._collections[options.collectionName!]) {\r\n        // @ts-expect-error\r\n        schema = CloudStore._collections[options.collectionName!].schema;\r\n      }\r\n\r\n      const targetClass =\r\n        // @ts-expect-error\r\n        schema && schema.properties && schema.properties[key]\r\n          ? // @ts-expect-error\r\n            schema.properties[key].targetClass\r\n          : undefined;\r\n      const type =\r\n        // @ts-expect-error\r\n        schema && schema.properties && schema.properties[key]\r\n          ? // @ts-expect-error\r\n            schema.properties[key].type\r\n          : undefined;\r\n\r\n      if (type === \"Relation\") {\r\n        res[key] = {\r\n          __type: \"Pointer\",\r\n          objectId: opAndValue[\"pointsTo\"],\r\n          className: targetClass,\r\n        };\r\n      } else {\r\n        if (Array.isArray(opAndValue[\"pointsTo\"])) {\r\n          res[key] = {\r\n            $in: opAndValue[\"pointsTo\"].map((v) => {\r\n              return { __type: \"Pointer\", objectId: v, className: targetClass };\r\n            }),\r\n          };\r\n        } else {\r\n          res[key] = {\r\n            $eq: {\r\n              __type: \"Pointer\",\r\n              objectId: opAndValue[\"pointsTo\"],\r\n              className: targetClass,\r\n            },\r\n          };\r\n        }\r\n      }\r\n    } else if (opAndValue[\"matchesRegex\"] !== undefined) {\r\n      res[key] = {\r\n        $regex: opAndValue[\"matchesRegex\"],\r\n        $options: opAndValue[\"options\"],\r\n      };\r\n    } else if (\r\n      opAndValue[\"text\"] !== undefined &&\r\n      opAndValue[\"text\"][\"search\"] !== undefined\r\n    ) {\r\n      const _v = opAndValue[\"text\"][\"search\"];\r\n      if (typeof _v === \"string\")\r\n        res[key] = { $text: { $search: { $term: _v, $caseSensitive: false } } };\r\n      else\r\n        res[key] = {\r\n          $text: {\r\n            $search: {\r\n              $term: _v.term,\r\n              $language: _v.language,\r\n              $caseSensitive: _v.caseSensitive,\r\n              $diacriticSensitive: _v.diacriticSensitive,\r\n            },\r\n          },\r\n        };\r\n      // Geo points\r\n    } else if (opAndValue[\"nearSphere\"] !== undefined) {\r\n      const _v = opAndValue[\"nearSphere\"];\r\n      res[key] = {\r\n        $nearSphere: {\r\n          __type: \"GeoPoint\",\r\n          latitude: _v.latitude,\r\n          longitude: _v.longitude,\r\n        },\r\n        $maxDistanceInMiles: _v.maxDistanceInMiles,\r\n        $maxDistanceInKilometers: _v.maxDistanceInKilometers,\r\n        $maxDistanceInRadians: _v.maxDistanceInRadians,\r\n      };\r\n    } else if (opAndValue[\"withinBox\"] !== undefined) {\r\n      const _v = opAndValue[\"withinBox\"];\r\n      res[key] = {\r\n        $within: {\r\n          $box: _v.map((gp) => ({\r\n            __type: \"GeoPoint\",\r\n            latitude: gp.latitude,\r\n            longitude: gp.longitude,\r\n          })),\r\n        },\r\n      };\r\n    } else if (opAndValue[\"withinPolygon\"] !== undefined) {\r\n      const _v = opAndValue[\"withinPolygon\"];\r\n      res[key] = {\r\n        $geoWithin: {\r\n          $polygon: _v.map((gp) => ({\r\n            __type: \"GeoPoint\",\r\n            latitude: gp.latitude,\r\n            longitude: gp.longitude,\r\n          })),\r\n        },\r\n      };\r\n    }\r\n  } else {\r\n    options?.error?.(\"Unrecognized filter keys \" + keys.join(\",\"));\r\n  }\r\n\r\n  return res;\r\n}\r\n\r\nexport {\r\n  convertVisualFilter,\r\n  compareObjects,\r\n  matchesQuery,\r\n  convertVisualSorting,\r\n  convertFilterOp,\r\n};\r\n","import { Collection } from \"../../../collection\";\r\nimport { NodeDefinition } from \"../../../nodedefinition\";\r\nimport { Port } from \"../../../models/componentmodel\";\r\nimport { createSetter } from \"../../../edgetriggeredinput\";\r\nimport { Model } from \"../../../model\";\r\nimport * as QueryUtils from \"../../../api/queryutils\";\r\nimport { CloudStore } from \"../../../api/cloudstore\";\r\nimport { JavascriptNodeParser } from \"../../../javascriptnodeparser\";\r\nimport { NodeContext } from \"../../../nodecontext\";\r\nimport { GraphModel } from \"../../../models/graphmodel\";\r\nimport { Node } from \"../../../node\";\r\n\r\ninterface Internal {\r\n  queryParameters: Record<string, any>;\r\n  collectionChangedCallback: () => void;\r\n  cloudStoreEvents: (args: any) => void;\r\n  name?: string;\r\n  collection?: any;\r\n  currentQuery?: {\r\n    where: any;\r\n    sort: any;\r\n    limit: number;\r\n    skip: number;\r\n  };\r\n  fetchScheduled?: boolean;\r\n  err?: string;\r\n  error?: string;\r\n  visualFilter?: any;\r\n  visualSorting?: any;\r\n  filterFunc?: Function;\r\n  filterVariables?: string[];\r\n  storageSettings: Record<string, any>;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"DbCollection2\",\r\n  docs: \"https://docs.noodl.net/nodes/data/cloud-data/query-records\",\r\n  displayName: \"Query Records\",\r\n  /* shortDesc: \"A database collection.\",*/\r\n  category: \"Cloud Services\",\r\n  usePortAsLabel: \"collectionName\",\r\n  color: \"data\",\r\n  initialize() {\r\n    const _this = this;\r\n    this._internal.queryParameters = {};\r\n\r\n    let collectionChangedScheduled = false;\r\n    this._internal.collectionChangedCallback = function () {\r\n      //this can be called multiple times when adding/removing more than one item\r\n      //so optimize by only updating outputs once\r\n      if (collectionChangedScheduled) return;\r\n      collectionChangedScheduled = true;\r\n\r\n      _this.scheduleAfterInputsHaveUpdated(function () {\r\n        _this.flagOutputDirty(\"count\");\r\n        _this.flagOutputDirty(\"firstItemId\");\r\n        _this.flagOutputDirty(\"isEmpty\");\r\n        collectionChangedScheduled = false;\r\n      });\r\n    };\r\n\r\n    this._internal.cloudStoreEvents = function (args: any) {\r\n      if (_this.isInputConnected(\"storageFetch\") === true) return;\r\n\r\n      if (_this._internal.collection === undefined) return;\r\n      if (args.collection !== _this._internal.name) return;\r\n\r\n      function _addModelAtCorrectIndex(m: any) {\r\n        if (_this._internal.currentQuery?.sort !== undefined) {\r\n          // We need to add it at the right index\r\n          for (let i = 0; i < _this._internal.collection.size(); i++)\r\n            if (\r\n              QueryUtils.compareObjects(\r\n                _this._internal.currentQuery.sort,\r\n                _this._internal.collection.get(i),\r\n                m\r\n              ) > 0\r\n            )\r\n              break;\r\n\r\n          // @ts-expect-error\r\n          _this._internal.collection.addAtIndex(m, i);\r\n        } else {\r\n          _this._internal.collection.add(m);\r\n        }\r\n\r\n        // Make sure we don't exceed limit\r\n        let size = _this._internal.collection.size();\r\n        if (\r\n          _this._internal.currentQuery?.limit !== undefined &&\r\n          size > _this._internal.currentQuery.limit\r\n        )\r\n          _this._internal.collection.remove(\r\n            _this._internal.collection.get(\r\n              _this._internal.currentQuery.sort !== undefined &&\r\n                _this._internal.currentQuery.sort[0][0] === \"-\"\r\n                ? size - 1\r\n                : 0\r\n            )\r\n          );\r\n\r\n        //Send the array again over the items output to trigger function nodes etc that might be connected\r\n        _this.flagOutputDirty(\"items\");\r\n\r\n        _this.flagOutputDirty(\"count\");\r\n        _this.flagOutputDirty(\"firstItemId\");\r\n        _this.flagOutputDirty(\"isEmpty\");\r\n      }\r\n\r\n      if (args.type === \"create\") {\r\n        const m = Model.get(args.object.objectId);\r\n        if (m !== undefined) {\r\n          // Check if the object matches the current query\r\n          if (QueryUtils.matchesQuery(m, _this._internal.currentQuery?.where)) {\r\n            // If matches the query, add the item to results\r\n            _addModelAtCorrectIndex(m);\r\n          }\r\n        }\r\n      } else if (args.type === \"save\") {\r\n        const m = Model.get(args.objectId);\r\n        if (m !== undefined) {\r\n          const matchesQuery = QueryUtils.matchesQuery(\r\n            m,\r\n            _this._internal.currentQuery?.where\r\n          );\r\n\r\n          if (!matchesQuery && _this._internal.collection.contains(m)) {\r\n            // The record no longer matches the filter, remove it\r\n            _this._internal.collection.remove(m);\r\n\r\n            //Send the array again over the items output to trigger function nodes etc that might be connected\r\n            _this.flagOutputDirty(\"items\");\r\n\r\n            _this.flagOutputDirty(\"count\");\r\n            _this.flagOutputDirty(\"firstItemId\");\r\n            _this.flagOutputDirty(\"isEmpty\");\r\n          } else if (matchesQuery && !_this._internal.collection.contains(m)) {\r\n            // It's not part of the result collection but now matches they query, add it and resort\r\n            _addModelAtCorrectIndex(m);\r\n          }\r\n        }\r\n      } else if (args.type === \"delete\") {\r\n        const m = Model.get(args.objectId);\r\n        if (m !== undefined) {\r\n          _this._internal.collection.remove(m);\r\n\r\n          //Send the array again over the items output to trigger function nodes etc that might be connected\r\n          _this.flagOutputDirty(\"items\");\r\n\r\n          _this.flagOutputDirty(\"count\");\r\n          _this.flagOutputDirty(\"firstItemId\");\r\n          _this.flagOutputDirty(\"isEmpty\");\r\n        }\r\n      }\r\n    };\r\n\r\n    // Listening to cloud store events is only for the global model scope, only valid in browser\r\n    // in cloud runtime its a nop\r\n    // @ts-expect-error\r\n    const cloudstore = CloudStore.forScope(this.nodeScope.modelScope);\r\n    cloudstore.on(\"save\", this._internal.cloudStoreEvents);\r\n    cloudstore.on(\"create\", this._internal.cloudStoreEvents);\r\n    cloudstore.on(\"delete\", this._internal.cloudStoreEvents);\r\n\r\n    this._internal.storageSettings = {};\r\n  },\r\n  getInspectInfo() {\r\n    const collection = this._internal.collection;\r\n    if (!collection) {\r\n      return { type: \"text\", value: \"[Not executed yet]\" };\r\n    }\r\n\r\n    return [\r\n      {\r\n        type: \"value\",\r\n        value: collection.items,\r\n      },\r\n    ];\r\n  },\r\n  inputs: {},\r\n  outputs: {\r\n    items: {\r\n      type: \"array\",\r\n      displayName: \"Items\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.collection;\r\n      },\r\n    },\r\n    firstItemId: {\r\n      type: \"string\",\r\n      displayName: \"First Record Id\",\r\n      group: \"General\",\r\n      getter() {\r\n        if (this._internal.collection) {\r\n          const firstItem = this._internal.collection.get(0);\r\n          if (firstItem !== undefined) return firstItem.getId();\r\n        }\r\n      },\r\n    },\r\n    isEmpty: {\r\n      type: \"boolean\",\r\n      displayName: \"Is Empty\",\r\n      group: \"General\",\r\n      getter() {\r\n        if (this._internal.collection) {\r\n          return this._internal.collection.size() === 0;\r\n        }\r\n        return true;\r\n      },\r\n    },\r\n    count: {\r\n      type: \"number\",\r\n      displayName: \"Count\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.collection ? this._internal.collection.size() : 0;\r\n      },\r\n    },\r\n    fetched: {\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n      displayName: \"Success\",\r\n    },\r\n    failure: {\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n      displayName: \"Failure\",\r\n    },\r\n    error: {\r\n      type: \"string\",\r\n      displayName: \"Error\",\r\n      group: \"Error\",\r\n      getter() {\r\n        return this._internal.error;\r\n      },\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    setCollectionName(name: string) {\r\n      this._internal.name = name;\r\n\r\n      // @ts-expect-error\r\n      if (this.isInputConnected(\"storageFetch\") === false) this.scheduleFetch();\r\n    },\r\n    setCollection(collection: any) {\r\n      // @ts-expect-error\r\n      this.bindCollection(collection);\r\n      this.flagOutputDirty(\"firstItemId\");\r\n      this.flagOutputDirty(\"isEmpty\");\r\n      this.flagOutputDirty(\"items\");\r\n      this.flagOutputDirty(\"count\");\r\n    },\r\n    unbindCurrentCollection() {\r\n      const collection = this._internal.collection;\r\n      if (!collection) return;\r\n      collection.off(\"change\", this._internal.collectionChangedCallback);\r\n      this._internal.collection = undefined;\r\n    },\r\n    bindCollection(collection: any) {\r\n      // @ts-expect-error\r\n      this.unbindCurrentCollection();\r\n      this._internal.collection = collection;\r\n      collection &&\r\n        collection.on(\"change\", this._internal.collectionChangedCallback);\r\n    },\r\n    _onNodeDeleted() {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      // @ts-expect-error\r\n      this.unbindCurrentCollection();\r\n\r\n      // @ts-expect-error\r\n      const cloudstore = CloudStore.forScope(this.nodeScope.modelScope);\r\n      cloudstore.off(\"insert\", this._internal.cloudStoreEvents);\r\n      cloudstore.off(\"delete\", this._internal.cloudStoreEvents);\r\n      cloudstore.off(\"save\", this._internal.cloudStoreEvents);\r\n    },\r\n    setError(err: string) {\r\n      this._internal.err = err;\r\n      this.flagOutputDirty(\"error\");\r\n      this.sendSignalOnOutput(\"failure\");\r\n    },\r\n    scheduleFetch() {\r\n      const internal = this._internal;\r\n\r\n      if (internal.fetchScheduled) return;\r\n      internal.fetchScheduled = true;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        internal.fetchScheduled = false;\r\n\r\n        // @ts-expect-error\r\n        this.fetch();\r\n      });\r\n    },\r\n    fetch() {\r\n      if (this.context.editorConnection) {\r\n        if (this._internal.name === undefined) {\r\n          this.context.editorConnection.sendWarning(\r\n            this.nodeScope!.componentOwner.name,\r\n            this.id,\r\n            \"query-collection\",\r\n            {\r\n              message: \"No collection specified for query\",\r\n            }\r\n          );\r\n        } else {\r\n          this.context.editorConnection.clearWarning(\r\n            this.nodeScope!.componentOwner.name,\r\n            this.id,\r\n            \"query-collection\"\r\n          );\r\n        }\r\n      }\r\n\r\n      const _c = Collection.get();\r\n      // @ts-expect-error\r\n      const f = this.getStorageFilter();\r\n      // @ts-expect-error\r\n      const limit = this.getStorageLimit();\r\n      // @ts-expect-error\r\n      const skip = this.getStorageSkip();\r\n      // @ts-expect-error\r\n      const count = this.getStorageFetchTotalCount();\r\n      this._internal.currentQuery = {\r\n        where: f.where,\r\n        sort: f.sort,\r\n        limit,\r\n        skip,\r\n      };\r\n      CloudStore.forScope(this.nodeScope!.modelScope).query({\r\n        // @ts-expect-error\r\n        collection: this._internal.name,\r\n        where: f.where,\r\n        sort: f.sort,\r\n        limit,\r\n        skip,\r\n        count,\r\n        success: (results: any[], count?: number) => {\r\n          if (results !== undefined) {\r\n            _c.set(\r\n              results.map((i) => {\r\n                const m = CloudStore._fromJSON(\r\n                  i,\r\n                  // @ts-expect-error\r\n                  this._internal.name,\r\n                  // @ts-expect-error\r\n                  this.nodeScope.modelScope\r\n                );\r\n                return m;\r\n              })\r\n            );\r\n          }\r\n          if (count !== undefined) {\r\n            this._internal.storageSettings.storageTotalCount = count;\r\n            if (this.hasOutput(\"storageTotalCount\"))\r\n              this.flagOutputDirty(\"storageTotalCount\");\r\n          }\r\n          // @ts-expect-error\r\n          this.setCollection(_c);\r\n          this.sendSignalOnOutput(\"fetched\");\r\n        },\r\n        error: (err?: string) => {\r\n          // @ts-expect-error\r\n          this.setCollection(_c);\r\n          // @ts-expect-error\r\n          this.setError(err || \"Failed to fetch.\");\r\n        },\r\n      });\r\n    },\r\n    // @ts-expect-error\r\n    getStorageFilter() {\r\n      const storageSettings = this._internal.storageSettings;\r\n      if (\r\n        storageSettings[\"storageFilterType\"] === undefined ||\r\n        storageSettings[\"storageFilterType\"] === \"simple\"\r\n      ) {\r\n        // Create simple filter\r\n        const _where =\r\n          this._internal.visualFilter !== undefined\r\n            ? QueryUtils.convertVisualFilter(this._internal.visualFilter, {\r\n                queryParameters: this._internal.queryParameters,\r\n                collectionName: this._internal.name,\r\n              })\r\n            : undefined;\r\n\r\n        const _sort =\r\n          this._internal.visualSorting !== undefined\r\n            ? QueryUtils.convertVisualSorting(this._internal.visualSorting)\r\n            : undefined;\r\n\r\n        return {\r\n          where: _where,\r\n          sort: _sort,\r\n        };\r\n      } else if (storageSettings[\"storageFilterType\"] === \"json\") {\r\n        // JSON filter\r\n        if (!this._internal.filterFunc) {\r\n          try {\r\n            let filterCode = storageSettings[\"storageJSONFilter\"];\r\n\r\n            // Parse out variables\r\n            filterCode = filterCode.replace(/\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/g, \"\"); // Remove comments\r\n            this._internal.filterVariables =\r\n              filterCode.match(/\\$[A-Za-z0-9]+/g) || [];\r\n\r\n            const args = [\"filter\", \"where\", \"sort\", \"Inputs\"]\r\n              // @ts-expect-error\r\n              .concat(this._internal.filterVariables)\r\n              .concat([filterCode]);\r\n            this._internal.filterFunc = Function.apply(null, args);\r\n          } catch (e) {\r\n            this._internal.filterFunc = undefined;\r\n            console.log(\"Error while parsing filter script: \" + e);\r\n          }\r\n        }\r\n\r\n        if (!this._internal.filterFunc) return;\r\n\r\n        let _filter = {},\r\n          _sort: any[] = [];\r\n        const _this = this;\r\n\r\n        // Collect filter variables\r\n        const _filterCb = function (f: any) {\r\n          _filter = QueryUtils.convertFilterOp(f, {\r\n            collectionName: _this._internal.name,\r\n            error(err: string) {\r\n              // @ts-expect-error\r\n              _this.context.editorConnection.sendWarning(\r\n                // @ts-expect-error\r\n                _this.nodeScope.componentOwner.name,\r\n                _this.id,\r\n                \"query-collection-filter\",\r\n                {\r\n                  message: err,\r\n                }\r\n              );\r\n            },\r\n          });\r\n        };\r\n        const _sortCb = function (s: any[]) {\r\n          _sort = s;\r\n        };\r\n\r\n        // Extract inputs\r\n        const inputs: Record<string, any> = {};\r\n        for (const key in storageSettings) {\r\n          if (key.startsWith(\"storageFilterValue-\"))\r\n            inputs[key.substring(\"storageFilterValue-\".length)] =\r\n              storageSettings[key];\r\n        }\r\n\r\n        const filterFuncArgs = [_filterCb, _filterCb, _sortCb, inputs]; // One for filter, one for where\r\n\r\n        this._internal.filterVariables?.forEach((v) => {\r\n          filterFuncArgs.push(\r\n            storageSettings[\"storageFilterValue-\" + v.substring(1)]\r\n          );\r\n        });\r\n\r\n        // Run the code to get the filter\r\n        try {\r\n          this._internal.filterFunc.apply(this, filterFuncArgs);\r\n        } catch (e) {\r\n          console.log(\"Error while running filter script: \" + e);\r\n        }\r\n\r\n        return { where: _filter, sort: _sort };\r\n      }\r\n    },\r\n    // @ts-expect-error\r\n    getStorageLimit(): number | undefined {\r\n      const storageSettings = this._internal.storageSettings;\r\n\r\n      if (!storageSettings[\"storageEnableLimit\"]) return undefined;\r\n      else return storageSettings[\"storageLimit\"] || 10;\r\n    },\r\n    // @ts-expect-error\r\n    getStorageSkip(): number | undefined {\r\n      const storageSettings = this._internal.storageSettings;\r\n\r\n      if (!storageSettings[\"storageEnableLimit\"]) return undefined;\r\n      else return storageSettings[\"storageSkip\"] || 0;\r\n    },\r\n    // @ts-expect-error\r\n    getStorageFetchTotalCount(): boolean {\r\n      const storageSettings = this._internal.storageSettings;\r\n\r\n      return !!storageSettings[\"storageEnableCount\"];\r\n    },\r\n    registerOutputIfNeeded(name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      this.registerOutput(name, {\r\n        getter() {\r\n          return this._internal.storageSettings[name];\r\n        },\r\n      });\r\n    },\r\n    setVisualFilter(value: any) {\r\n      this._internal.visualFilter = value;\r\n\r\n      // @ts-expect-error\r\n      if (this.isInputConnected(\"storageFetch\") === false) this.scheduleFetch();\r\n    },\r\n    setVisualSorting(value: any) {\r\n      this._internal.visualSorting = value;\r\n\r\n      // @ts-expect-error\r\n      if (this.isInputConnected(\"storageFetch\") === false) this.scheduleFetch();\r\n    },\r\n    setQueryParameter(name: string, value: any) {\r\n      this._internal.queryParameters[name] = value;\r\n\r\n      // @ts-expect-error\r\n      if (this.isInputConnected(\"storageFetch\") === false) this.scheduleFetch();\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      const _this = this;\r\n\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"qp-\"))\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setQueryParameter.bind(this, name.substring(\"qp-\".length)),\r\n        });\r\n\r\n      const dynamicSignals: Record<string, () => void> = {\r\n        // @ts-expect-error\r\n        storageFetch: this.scheduleFetch.bind(this),\r\n      };\r\n\r\n      if (dynamicSignals[name])\r\n        return this.registerInput(name, {\r\n          set: createSetter({\r\n            valueChangedToTrue: dynamicSignals[name],\r\n          }),\r\n        });\r\n\r\n      const dynamicSetters: Record<string, (value: any) => void> = {\r\n        // @ts-expect-error\r\n        collectionName: this.setCollectionName.bind(this),\r\n        // @ts-expect-error\r\n        visualFilter: this.setVisualFilter.bind(this),\r\n        // @ts-expect-error\r\n        visualSort: this.setVisualSorting.bind(this),\r\n      };\r\n\r\n      if (dynamicSetters[name])\r\n        return this.registerInput(name, {\r\n          set: dynamicSetters[name],\r\n        });\r\n\r\n      this.registerInput(name, {\r\n        set(value: any) {\r\n          this._internal.storageSettings[name] = value;\r\n\r\n          if (this.isInputConnected(\"storageFetch\") === false) {\r\n            // @ts-expect-error\r\n            this.scheduleFetch();\r\n          }\r\n        },\r\n      });\r\n    },\r\n  },\r\n};\r\n\r\nconst _defaultJSONQuery =\r\n  \"// Write your query script here, check out the reference documentation for examples\\n\" +\r\n  \"where({ })\\n\";\r\n\r\nfunction updatePorts(\r\n  nodeId: string,\r\n  parameters: any,\r\n  editorConnection: any,\r\n  graphModel: any\r\n) {\r\n  const ports: Port[] = [];\r\n\r\n  const dbCollections = graphModel.getMetaData(\"dbCollections\");\r\n  const systemCollections = graphModel.getMetaData(\"systemCollections\");\r\n\r\n  const _systemClasses = [\r\n    { label: \"User\", value: \"_User\" },\r\n    { label: \"Role\", value: \"_Role\" },\r\n  ];\r\n  ports.push({\r\n    name: \"collectionName\",\r\n    type: {\r\n      name: \"enum\",\r\n      enums: _systemClasses.concat(\r\n        dbCollections !== undefined\r\n          ? dbCollections.map((c: any) => {\r\n              return { value: c.name, label: c.name };\r\n            })\r\n          : []\r\n      ),\r\n      allowEditOnly: true,\r\n    },\r\n    displayName: \"Class\",\r\n    plug: \"input\",\r\n    group: \"General\",\r\n  });\r\n\r\n  ports.push({\r\n    name: \"storageFilterType\",\r\n    type: {\r\n      name: \"enum\",\r\n      allowEditOnly: true,\r\n      enums: [\r\n        { value: \"simple\", label: \"Visual\" },\r\n        { value: \"json\", label: \"Javascript\" },\r\n      ],\r\n    },\r\n    displayName: \"Filter\",\r\n    default: \"simple\",\r\n    plug: \"input\",\r\n    group: \"General\",\r\n  });\r\n\r\n  // Limit\r\n  ports.push({\r\n    type: { name: \"boolean\" },\r\n    plug: \"input\",\r\n    group: \"Limit\",\r\n    name: \"storageEnableLimit\",\r\n    displayName: \"Use limit\",\r\n  });\r\n\r\n  if (parameters[\"storageEnableLimit\"]) {\r\n    ports.push({\r\n      type: { name: \"number\" },\r\n      default: 10,\r\n      plug: \"input\",\r\n      group: \"Limit\",\r\n      name: \"storageLimit\",\r\n      displayName: \"Limit\",\r\n    });\r\n\r\n    ports.push({\r\n      type: { name: \"number\" },\r\n      default: 0,\r\n      plug: \"input\",\r\n      group: \"Limit\",\r\n      name: \"storageSkip\",\r\n      displayName: \"Skip\",\r\n    });\r\n  }\r\n\r\n  ports.push({\r\n    type: { name: \"signal\" },\r\n    plug: \"input\",\r\n    group: \"Actions\",\r\n    name: \"storageFetch\",\r\n    displayName: \"Do\",\r\n  });\r\n\r\n  // Total Count\r\n  ports.push({\r\n    type: { name: \"boolean\" },\r\n    plug: \"input\",\r\n    group: \"Total Count\",\r\n    name: \"storageEnableCount\",\r\n    displayName: \"Fetch total count\",\r\n  });\r\n\r\n  if (parameters[\"storageEnableCount\"]) {\r\n    ports.push({\r\n      type: { name: \"number\" },\r\n      plug: \"output\",\r\n      group: \"General\",\r\n      name: \"storageTotalCount\",\r\n      displayName: \"Total Count\",\r\n    });\r\n  }\r\n\r\n  // Simple query\r\n  if (\r\n    parameters[\"storageFilterType\"] === undefined ||\r\n    parameters[\"storageFilterType\"] === \"simple\"\r\n  ) {\r\n    if (parameters.collectionName !== undefined) {\r\n      let c =\r\n        dbCollections &&\r\n        dbCollections.find((c: any) => c.name === parameters.collectionName);\r\n      if (c === undefined && systemCollections)\r\n        c = systemCollections.find(\r\n          (c: any) => c.name === parameters.collectionName\r\n        );\r\n      if (c && c.schema && c.schema.properties) {\r\n        const schema = JSON.parse(JSON.stringify(c.schema));\r\n\r\n        dbCollections?.forEach(_findRelations.bind(null, parameters, schema));\r\n        systemCollections?.forEach(\r\n          _findRelations.bind(null, parameters, schema)\r\n        );\r\n\r\n        ports.push({\r\n          name: \"visualFilter\",\r\n          plug: \"input\",\r\n          type: { name: \"query-filter\", schema: schema, allowEditOnly: true },\r\n          displayName: \"Filter\",\r\n          group: \"Filter\",\r\n        });\r\n\r\n        ports.push({\r\n          name: \"visualSort\",\r\n          plug: \"input\",\r\n          type: { name: \"query-sorting\", schema: schema, allowEditOnly: true },\r\n          displayName: \"Sort\",\r\n          group: \"Sorting\",\r\n        });\r\n      }\r\n\r\n      if (parameters.visualFilter !== undefined) {\r\n        // Find all input ports\r\n        const uniqueInputs: Record<string, boolean> = {};\r\n        _collectInputs(uniqueInputs, parameters.visualFilter);\r\n\r\n        Object.keys(uniqueInputs).forEach((input) => {\r\n          ports.push({\r\n            name: \"qp-\" + input,\r\n            plug: \"input\",\r\n            type: { name: \"*\" },\r\n            displayName: input,\r\n            group: \"Query Parameters\",\r\n          });\r\n        });\r\n      }\r\n    }\r\n  }\r\n  // JSON query\r\n  else if (parameters[\"storageFilterType\"] === \"json\") {\r\n    ports.push({\r\n      type: { name: \"string\", allowEditOnly: true, codeeditor: \"javascript\" },\r\n      plug: \"input\",\r\n      group: \"Filter\",\r\n      name: \"storageJSONFilter\",\r\n      default: _defaultJSONQuery,\r\n      displayName: \"Filter\",\r\n    });\r\n\r\n    let filter = String(parameters[\"storageJSONFilter\"]);\r\n    if (filter) {\r\n      filter = filter.replace(/\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/g, \"\"); // Remove comments\r\n      const variables = filter.match(/\\$[A-Za-z0-9]+/g);\r\n\r\n      if (variables) {\r\n        const unique: Record<string, boolean> = {};\r\n        variables.forEach((v) => {\r\n          unique[v] = true;\r\n        });\r\n\r\n        Object.keys(unique).forEach((p) => {\r\n          ports.push({\r\n            name: \"storageFilterValue-\" + p.substring(1),\r\n            displayName: p.substring(1),\r\n            group: \"Filter Values\",\r\n            plug: \"input\",\r\n            type: { name: \"*\", allowConnectionsOnly: true },\r\n          });\r\n        });\r\n      }\r\n\r\n      // Support variables with the \"Inputs.\"\" syntax\r\n      JavascriptNodeParser.parseAndAddPortsFromScript(filter, ports, {\r\n        inputPrefix: \"storageFilterValue-\",\r\n        inputGroup: \"Filter Values\",\r\n        inputType: { name: \"*\", allowConnectionsOnly: true },\r\n        skipOutputs: true,\r\n      });\r\n    }\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n\r\n    node.on(\"parameterUpdated\", function (event: { name: string }) {\r\n      if (\r\n        event.name.startsWith(\"storage\") ||\r\n        event.name === \"visualFilter\" ||\r\n        event.name === \"collectionName\"\r\n      ) {\r\n        updatePorts(\r\n          node.id,\r\n          node.parameters,\r\n          context.editorConnection,\r\n          graphModel\r\n        );\r\n      }\r\n    });\r\n\r\n    graphModel.on(\"metadataChanged.dbCollections\", function () {\r\n      CloudStore.invalidateCollections();\r\n      updatePorts(\r\n        node.id,\r\n        node.parameters,\r\n        context.editorConnection,\r\n        graphModel\r\n      );\r\n    });\r\n\r\n    graphModel.on(\"metadataChanged.systemCollections\", function () {\r\n      CloudStore.invalidateCollections();\r\n      updatePorts(\r\n        node.id,\r\n        node.parameters,\r\n        context.editorConnection,\r\n        graphModel\r\n      );\r\n    });\r\n\r\n    graphModel.on(\"metadataChanged.cloudservices\", function () {\r\n      CloudStore.instance._initCloudServices();\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.DbCollection2\", function (node: any) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"DbCollection2\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n\r\ninterface QueryRule {\r\n  rules?: QueryRule[];\r\n  input?: string;\r\n}\r\n\r\nfunction _collectInputs(\r\n  uniqueInputs: Record<string, boolean>,\r\n  query: QueryRule | undefined\r\n) {\r\n  if (query === undefined) {\r\n    return;\r\n  }\r\n\r\n  if (query.rules !== undefined) {\r\n    query.rules.forEach((r: QueryRule) => _collectInputs(uniqueInputs, r));\r\n  } else if (query.input !== undefined) {\r\n    uniqueInputs[query.input] = true;\r\n  }\r\n}\r\n\r\n// Find all records that have a relation with this type\r\nfunction _findRelations(\r\n  parameters: any,\r\n  schema: any,\r\n  c: {\r\n    name: string;\r\n    schema?: {\r\n      properties?: {\r\n        [key: string]: {\r\n          type: string;\r\n          targetClass?: string;\r\n        };\r\n      };\r\n    };\r\n  }\r\n) {\r\n  if (c.schema !== undefined && c.schema.properties !== undefined) {\r\n    for (const key in c.schema.properties) {\r\n      const p = c.schema.properties[key];\r\n      if (\r\n        p.type === \"Relation\" &&\r\n        p.targetClass === parameters.collectionName\r\n      ) {\r\n        if (schema.relations === undefined) schema.relations = {};\r\n        if (schema.relations[c.name] === undefined)\r\n          schema.relations[c.name] = [];\r\n\r\n        schema.relations[c.name].push({ property: key });\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Model } from \"../../../model\";\r\nimport { CloudStore } from \"../../../api/cloudstore\";\r\nimport { NodeDefinition } from \"../../../nodedefinition\";\r\nimport { createSetter } from \"../../../edgetriggeredinput\";\r\nimport { NodeContext } from \"../../../nodecontext\";\r\nimport { GraphModel } from \"../../../models/graphmodel\";\r\nimport { Port } from \"../../../models/componentmodel\";\r\nimport { Node } from \"../../../node\";\r\n\r\ninterface Internal {\r\n  inputValues: Record<string, any>;\r\n  relationModelIds: Record<string, any>;\r\n  onModelChangedCallback?: (args: { name: string }) => void;\r\n  model?: Model;\r\n  modelId?: string;\r\n  collectionId?: string;\r\n  error?: string;\r\n  [key: string]: any;\r\n}\r\n\r\ninterface Parameters {\r\n  collectionName?: string;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"DbModel2\",\r\n  docs: \"https://docs.noodl.net/nodes/data/cloud-data/record\",\r\n  displayNodeName: \"Record\",\r\n  shortDesc: \"Database model\",\r\n  category: \"Cloud Services\",\r\n  usePortAsLabel: \"collectionName\",\r\n  color: \"data\",\r\n  dynamicports: [\r\n    {\r\n      name: \"conditionalports/extended\",\r\n      condition: \"idSource = explicit OR idSource NOT SET\",\r\n      inputs: [\"modelId\"],\r\n    },\r\n  ],\r\n  initialize: function () {\r\n    const internal = this._internal;\r\n    internal.inputValues = {};\r\n    internal.relationModelIds = {};\r\n\r\n    const _this = this;\r\n    this._internal.onModelChangedCallback = function (args) {\r\n      if (_this.isInputConnected(\"fetch\")) return;\r\n\r\n      if (_this.hasOutput(\"prop-\" + args.name))\r\n        _this.flagOutputDirty(\"prop-\" + args.name);\r\n\r\n      if (_this.hasOutput(\"changed-\" + args.name))\r\n        _this.sendSignalOnOutput(\"changed-\" + args.name);\r\n\r\n      _this.sendSignalOnOutput(\"changed\");\r\n    };\r\n  },\r\n  getInspectInfo() {\r\n    const model = this._internal.model;\r\n    if (!model) return \"[No Record]\";\r\n\r\n    return [\r\n      { type: \"text\", value: \"Id: \" + model.getId() },\r\n      { type: \"value\", value: model.data },\r\n    ];\r\n  },\r\n  outputs: {\r\n    id: {\r\n      type: \"string\",\r\n      displayName: \"Id\",\r\n      group: \"General\",\r\n      getter: function () {\r\n        return this._internal.model\r\n          ? this._internal.model.getId()\r\n          : this._internal.modelId;\r\n      },\r\n    },\r\n    fetched: {\r\n      type: \"signal\",\r\n      displayName: \"Fetched\",\r\n      group: \"Events\",\r\n    },\r\n    changed: {\r\n      type: \"signal\",\r\n      displayName: \"Changed\",\r\n      group: \"Events\",\r\n    },\r\n    failure: {\r\n      type: \"signal\",\r\n      displayName: \"Failure\",\r\n      group: \"Events\",\r\n    },\r\n    error: {\r\n      type: \"string\",\r\n      displayName: \"Error\",\r\n      group: \"Error\",\r\n      getter: function () {\r\n        return this._internal.error;\r\n      },\r\n    },\r\n  },\r\n  inputs: {\r\n    idSource: {\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"Specify explicitly\", value: \"explicit\" },\r\n          { label: \"From repeater\", value: \"foreach\" },\r\n        ],\r\n        allowEditOnly: true,\r\n      },\r\n      default: \"explicit\",\r\n      displayName: \"Id Source\",\r\n      group: \"General\",\r\n      set(value) {\r\n        if (value === \"foreach\") {\r\n          this.scheduleAfterInputsHaveUpdated(() => {\r\n            // Find closest nodescope that have a _forEachModel\r\n            let component = this.nodeScope!.componentOwner;\r\n            while (\r\n              component !== undefined &&\r\n              component._forEachModel === undefined &&\r\n              component.parentNodeScope\r\n            ) {\r\n              component = component.parentNodeScope.componentOwner;\r\n            }\r\n            // @ts-expect-error\r\n            this.setModel(\r\n              component !== undefined ? component._forEachModel : undefined\r\n            );\r\n          });\r\n        }\r\n      },\r\n    },\r\n    modelId: {\r\n      type: { name: \"string\", allowConnectionsOnly: true },\r\n      displayName: \"Id\",\r\n      group: \"General\",\r\n      set(value: string | Model | object) {\r\n        if (value instanceof Model) {\r\n          // Can be passed as model as well\r\n          value = value.getId();\r\n        } else if (typeof value === \"object\") {\r\n          // If this is an js object, dereference it\r\n          value = Model.create(value).getId();\r\n        }\r\n\r\n        this._internal.modelId = value; // Wait to fetch data\r\n        if (this.isInputConnected(\"fetch\") === false) {\r\n          // @ts-expect-error\r\n          this.setModelID(value);\r\n        } else {\r\n          this.flagOutputDirty(\"id\");\r\n        }\r\n      },\r\n    },\r\n    fetch: {\r\n      displayName: \"Fetch\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleFetch();\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    setCollectionID(id: string) {\r\n      this._internal.collectionId = id;\r\n    },\r\n    setModelID(id: string) {\r\n      const model = (this.nodeScope!.modelScope || Model).get(id);\r\n      // @ts-expect-error\r\n      this.setModel(model);\r\n    },\r\n    setModel(model: Model) {\r\n      if (this._internal.model) {\r\n        // Remove old listener if existing\r\n        this._internal.model.off(\r\n          \"change\",\r\n          // @ts-expect-error\r\n          this._internal.onModelChangedCallback\r\n        );\r\n      }\r\n\r\n      this._internal.model = model;\r\n      this.flagOutputDirty(\"id\");\r\n      // @ts-expect-error\r\n      model.on(\"change\", this._internal.onModelChangedCallback);\r\n\r\n      // We have a new model, mark all outputs as dirty\r\n      for (const key in model.data) {\r\n        if (this.hasOutput(\"prop-\" + key)) {\r\n          this.flagOutputDirty(\"prop-\" + key);\r\n        }\r\n      }\r\n      this.sendSignalOnOutput(\"fetched\");\r\n    },\r\n    _onNodeDeleted() {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      if (this._internal.model)\r\n        this._internal.model.off(\r\n          \"change\",\r\n          // @ts-expect-error\r\n          this._internal.onModelChangedCallback\r\n        );\r\n    },\r\n    scheduleOnce(type: string, cb: () => void) {\r\n      const _this = this;\r\n      const _type = \"hasScheduled\" + type;\r\n      if (this._internal[_type]) return;\r\n      this._internal[_type] = true;\r\n      this.scheduleAfterInputsHaveUpdated(function () {\r\n        _this._internal[_type] = false;\r\n        cb();\r\n      });\r\n    },\r\n    setError(err: string) {\r\n      this._internal.error = err;\r\n      this.flagOutputDirty(\"error\");\r\n      this.sendSignalOnOutput(\"failure\");\r\n\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.sendWarning(\r\n          this.nodeScope!.componentOwner.name,\r\n          this.id,\r\n          \"storage-op-warning\",\r\n          {\r\n            message: err,\r\n            showGlobally: true,\r\n          }\r\n        );\r\n      }\r\n    },\r\n    clearWarnings() {\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.clearWarning(\r\n          this.nodeScope!.componentOwner.name,\r\n          this.id,\r\n          \"storage-op-warning\"\r\n        );\r\n      }\r\n    },\r\n    scheduleFetch() {\r\n      const _this = this;\r\n      const internal = this._internal;\r\n\r\n      // @ts-expect-error\r\n      this.scheduleOnce(\"Fetch\", function () {\r\n        // Don't do fetch if no id\r\n        if (internal.modelId === undefined || internal.modelId === \"\") {\r\n          // @ts-expect-error\r\n          _this.setError(\"Missing Id.\");\r\n          return;\r\n        }\r\n\r\n        // @ts-expect-error\r\n        const cloudstore = CloudStore.forScope(_this.nodeScope.modelScope);\r\n        cloudstore.fetch({\r\n          // @ts-expect-error\r\n          collection: internal.collectionId,\r\n          objectId: internal.modelId, // Get the objectId part of the model id\r\n          success: function (response: any) {\r\n            // @ts-expect-error\r\n            const model = cloudstore._fromJSON(response, internal.collectionId);\r\n            if (internal.model !== model) {\r\n              // Check if we need to change model\r\n              if (internal.model) {\r\n                // Remove old listener if existing\r\n                // @ts-expect-error\r\n                internal.model.off(\"change\", internal.onModelChangedCallback);\r\n              }\r\n\r\n              internal.model = model;\r\n              model.on(\"change\", internal.onModelChangedCallback);\r\n            }\r\n            _this.flagOutputDirty(\"id\");\r\n\r\n            delete response.objectId;\r\n\r\n            for (const key in response) {\r\n              if (_this.hasOutput(\"prop-\" + key)) {\r\n                _this.flagOutputDirty(\"prop-\" + key);\r\n              }\r\n            }\r\n\r\n            _this.sendSignalOnOutput(\"fetched\");\r\n          },\r\n          error: function (err: string) {\r\n            // @ts-expect-error\r\n            _this.setError(err || \"Failed to fetch.\");\r\n          },\r\n        });\r\n      });\r\n    },\r\n    scheduleStore: function () {\r\n      const internal = this._internal;\r\n      if (!internal.model) return;\r\n\r\n      // @ts-expect-error\r\n      this.scheduleOnce(\"Store\", function () {\r\n        for (const i in internal.inputValues) {\r\n          // @ts-expect-error\r\n          internal.model.set(i, internal.inputValues[i], { resolve: true });\r\n        }\r\n      });\r\n    },\r\n    registerOutputIfNeeded: function (name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"prop-\"))\r\n        this.registerOutput(name, {\r\n          getter: userOutputGetter.bind(this, name.substring(\"prop-\".length)),\r\n        });\r\n    },\r\n    registerInputIfNeeded: function (name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      const dynamicSignals: Record<string, () => void> = {};\r\n\r\n      if (dynamicSignals[name])\r\n        return this.registerInput(name, {\r\n          set: createSetter({\r\n            valueChangedToTrue: dynamicSignals[name],\r\n          }),\r\n        });\r\n\r\n      const dynamicSetters: Record<string, (value: any) => void> = {\r\n        // @ts-expect-error\r\n        collectionName: this.setCollectionID.bind(this),\r\n      };\r\n\r\n      if (dynamicSetters[name])\r\n        return this.registerInput(name, {\r\n          set: dynamicSetters[name],\r\n        });\r\n\r\n      if (name.startsWith(\"prop-\"))\r\n        this.registerInput(name, {\r\n          set: userInputSetter.bind(this, name.substring(\"prop-\".length)),\r\n        });\r\n    },\r\n  },\r\n};\r\n\r\nfunction userOutputGetter(name: string) {\r\n  // @ts-expect-error\r\n  return this._internal.model\r\n    ? // @ts-expect-error\r\n      this._internal.model.get(name, { resolve: true })\r\n    : undefined;\r\n}\r\n\r\nfunction userInputSetter(name: string, value: any) {\r\n  // @ts-expect-error\r\n  this._internal.inputValues[name] = value;\r\n}\r\n\r\nfunction updatePorts(\r\n  nodeId: string,\r\n  parameters: Parameters,\r\n  editorConnection: any,\r\n  graphModel: any\r\n) {\r\n  const ports: Port[] = [];\r\n\r\n  const dbCollections = graphModel.getMetaData(\"dbCollections\");\r\n  const systemCollections = graphModel.getMetaData(\"systemCollections\");\r\n\r\n  const _systemClasses = [\r\n    { label: \"User\", value: \"_User\" },\r\n    { label: \"Role\", value: \"_Role\" },\r\n  ];\r\n  ports.push({\r\n    name: \"collectionName\",\r\n    displayName: \"Class\",\r\n    group: \"General\",\r\n    type: {\r\n      name: \"enum\",\r\n      enums: _systemClasses.concat(\r\n        dbCollections !== undefined\r\n          ? dbCollections.map((c) => {\r\n              return { value: c.name, label: c.name };\r\n            })\r\n          : []\r\n      ),\r\n      allowEditOnly: true,\r\n    },\r\n    plug: \"input\",\r\n  });\r\n\r\n  if (parameters.collectionName && dbCollections) {\r\n    // Fetch ports from collection keys\r\n    let c = dbCollections.find((c) => c.name === parameters.collectionName);\r\n    if (c === undefined && systemCollections)\r\n      c = systemCollections.find((c) => c.name === parameters.collectionName);\r\n    if (c && c.schema && c.schema.properties) {\r\n      const props = c.schema.properties;\r\n      for (const key in props) {\r\n        const p = props[key];\r\n        if (ports.find((_p) => _p.name === key)) continue;\r\n\r\n        if (p.type !== \"Relation\") {\r\n          // Other schema type ports\r\n          const _typeMap: Record<string, string> = {\r\n            String: \"string\",\r\n            Boolean: \"boolean\",\r\n            Number: \"number\",\r\n            Date: \"date\",\r\n          };\r\n\r\n          ports.push({\r\n            type: {\r\n              name: _typeMap[p.type] ? _typeMap[p.type] : \"*\",\r\n            },\r\n            plug: \"output\",\r\n            group: \"Properties\",\r\n            name: \"prop-\" + key,\r\n            displayName: key,\r\n          });\r\n\r\n          ports.push({\r\n            type: \"signal\",\r\n            plug: \"output\",\r\n            group: \"Changed Events\",\r\n            displayName: key + \" Changed\",\r\n            name: \"changed-\" + key,\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    updatePorts(node.id, node.parameters, context.editorConnection, graphModel);\r\n\r\n    node.on(\"parameterUpdated\", function () {\r\n      updatePorts(\r\n        node.id,\r\n        node.parameters,\r\n        context.editorConnection,\r\n        graphModel\r\n      );\r\n    });\r\n\r\n    graphModel.on(\"metadataChanged.dbCollections\", function () {\r\n      CloudStore.invalidateCollections();\r\n      updatePorts(\r\n        node.id,\r\n        node.parameters,\r\n        context.editorConnection,\r\n        graphModel\r\n      );\r\n    });\r\n\r\n    graphModel.on(\"metadataChanged.systemCollections\", function () {\r\n      CloudStore.invalidateCollections();\r\n      updatePorts(\r\n        node.id,\r\n        node.parameters,\r\n        context.editorConnection,\r\n        graphModel\r\n      );\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.DbModel2\", function (node: any) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"DbModel2\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","import { Model, ModelScope } from \"../../../model\";\r\nimport { CloudStore } from \"../../../api/cloudstore\";\r\nimport { NodeDefinition } from \"../../../nodedefinition\";\r\nimport type { NodeModule } from \"../../../runtime\";\r\n\r\ninterface BaseOptions {\r\n  includeInputProperties?: boolean;\r\n  includeRelations?: boolean;\r\n  includeInputs?: boolean;\r\n  includeOutputs?: boolean;\r\n}\r\n\r\nfunction _addBaseInfo<TInternal extends Record<string, any> = {}>(\r\n  def: NodeModule<TInternal>,\r\n  opts?: BaseOptions\r\n): void {\r\n  const _includeInputProperties =\r\n    opts === undefined || opts.includeInputProperties;\r\n  const _includeRelations = opts !== undefined && opts.includeRelations;\r\n\r\n  Object.assign(def.node, {\r\n    category: \"Data\",\r\n    color: \"data\",\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {},\r\n  });\r\n\r\n  // Outputs\r\n  // @ts-expect-error\r\n  Object.assign(def.node.outputs, {\r\n    failure: {\r\n      type: \"signal\",\r\n      displayName: \"Failure\",\r\n      group: \"Events\",\r\n    },\r\n    error: {\r\n      type: \"string\",\r\n      displayName: \"Error\",\r\n      group: \"Error\",\r\n      getter: function () {\r\n        // @ts-expect-error\r\n        return this._internal.error;\r\n      },\r\n    },\r\n  });\r\n\r\n  // Methods\r\n  // @ts-expect-error\r\n  Object.assign(def.node.methods, {\r\n    scheduleOnce: function (type: string, cb: () => void) {\r\n      const _this = this;\r\n      const _type = \"hasScheduled\" + type;\r\n      // @ts-expect-error\r\n      if (this._internal[_type]) return;\r\n      // @ts-expect-error\r\n      this._internal[_type] = true;\r\n      // @ts-expect-error\r\n      this.scheduleAfterInputsHaveUpdated(function () {\r\n        // @ts-expect-error\r\n        _this._internal[_type] = false;\r\n        cb();\r\n      });\r\n    },\r\n    checkWarningsBeforeCloudOp() {\r\n      //clear all errors first\r\n      // @ts-expect-error\r\n      this.clearWarnings();\r\n\r\n      // @ts-expect-error\r\n      if (!this._internal.collectionId) {\r\n        // @ts-expect-error\r\n        this.setError(\"No class name specified\");\r\n        return false;\r\n      }\r\n\r\n      return true;\r\n    },\r\n    setError: function (err: string) {\r\n      // @ts-expect-error\r\n      this._internal.error = err;\r\n      // @ts-expect-error\r\n      this.flagOutputDirty(\"error\");\r\n      // @ts-expect-error\r\n      this.sendSignalOnOutput(\"failure\");\r\n\r\n      // @ts-expect-error\r\n      if (this.context.editorConnection) {\r\n        // @ts-expect-error\r\n        this.context.editorConnection.sendWarning(\r\n          // @ts-expect-error\r\n          this.nodeScope.componentOwner.name,\r\n          // @ts-expect-error\r\n          this.id,\r\n          \"storage-op-warning\",\r\n          {\r\n            message: err,\r\n            showGlobally: true,\r\n          }\r\n        );\r\n      }\r\n    },\r\n    clearWarnings() {\r\n      // @ts-expect-error\r\n      if (this.context.editorConnection) {\r\n        // @ts-expect-error\r\n        this.context.editorConnection.clearWarning(\r\n          // @ts-expect-error\r\n          this.nodeScope.componentOwner.name,\r\n          // @ts-expect-error\r\n          this.id,\r\n          \"storage-op-warning\"\r\n        );\r\n      }\r\n    },\r\n  });\r\n\r\n  // Setup\r\n  Object.assign(def, {\r\n    setup: function (context: any, graphModel: any) {\r\n      if (\r\n        !context.editorConnection ||\r\n        !context.editorConnection.isRunningLocally()\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      function _managePortsForNode(node: any) {\r\n        function _updatePorts() {\r\n          const ports: any[] = [];\r\n\r\n          const dbCollections = graphModel.getMetaData(\"dbCollections\");\r\n          const systemCollections = graphModel.getMetaData(\"systemCollections\");\r\n\r\n          const _systemClasses = [\r\n            { label: \"User\", value: \"_User\" },\r\n            { label: \"Role\", value: \"_Role\" },\r\n          ];\r\n\r\n          const parameters = node.parameters;\r\n\r\n          ports.push({\r\n            name: \"collectionName\",\r\n            displayName: \"Class\",\r\n            group: \"General\",\r\n            type: {\r\n              name: \"enum\",\r\n              enums: _systemClasses.concat(\r\n                dbCollections !== undefined\r\n                  ? dbCollections.map((c: any) => {\r\n                      return { value: c.name, label: c.name };\r\n                    })\r\n                  : []\r\n              ),\r\n              allowEditOnly: true,\r\n            },\r\n            plug: \"input\",\r\n          });\r\n\r\n          if (_includeRelations && parameters.collectionName && dbCollections) {\r\n            // Fetch ports from collection keys\r\n            let c = dbCollections.find(\r\n              (c: any) => c.name === parameters.collectionName\r\n            );\r\n            if (c === undefined && systemCollections)\r\n              c = systemCollections.find(\r\n                (c: any) => c.name === parameters.collectionName\r\n              );\r\n            if (c && c.schema && c.schema.properties) {\r\n              const props = c.schema.properties;\r\n              const enums = Object.keys(props)\r\n                .filter((key) => props[key].type === \"Relation\")\r\n                .map((key) => ({ label: key, value: key }));\r\n\r\n              ports.push({\r\n                name: \"relationProperty\",\r\n                displayName: \"Relation\",\r\n                group: \"General\",\r\n                type: { name: \"enum\", enums: enums, allowEditOnly: true },\r\n                plug: \"input\",\r\n              });\r\n            }\r\n          }\r\n\r\n          if (\r\n            _includeInputProperties &&\r\n            parameters.collectionName &&\r\n            dbCollections\r\n          ) {\r\n            const _typeMap: { [key: string]: string } = {\r\n              String: \"string\",\r\n              Boolean: \"boolean\",\r\n              Number: \"number\",\r\n              Date: \"date\",\r\n            };\r\n\r\n            // Fetch ports from collection keys\r\n            let c = dbCollections.find(\r\n              (c: any) => c.name === parameters.collectionName\r\n            );\r\n            if (c === undefined && systemCollections)\r\n              c = systemCollections.find(\r\n                (c: any) => c.name === parameters.collectionName\r\n              );\r\n            if (c && c.schema && c.schema.properties) {\r\n              const props = c.schema.properties;\r\n              for (const key in props) {\r\n                const p = props[key];\r\n                if (ports.find((_p) => _p.name === key)) continue;\r\n\r\n                ports.push({\r\n                  type: {\r\n                    name: _typeMap[p.type] ? _typeMap[p.type] : \"*\",\r\n                  },\r\n                  plug: \"input\",\r\n                  group: \"Properties\",\r\n                  name: \"prop-\" + key,\r\n                  displayName: key,\r\n                });\r\n              }\r\n            }\r\n          }\r\n\r\n          // @ts-expect-error\r\n          def._additionalDynamicPorts?.(node, ports, graphModel);\r\n\r\n          context.editorConnection.sendDynamicPorts(node.id, ports);\r\n        }\r\n\r\n        _updatePorts();\r\n\r\n        node.on(\"parameterUpdated\", function () {\r\n          _updatePorts();\r\n        });\r\n\r\n        graphModel.on(\"metadataChanged.dbCollections\", function () {\r\n          CloudStore.invalidateCollections();\r\n          _updatePorts();\r\n        });\r\n\r\n        graphModel.on(\"metadataChanged.systemCollections\", function () {\r\n          CloudStore.invalidateCollections();\r\n          _updatePorts();\r\n        });\r\n      }\r\n\r\n      graphModel.on(\"editorImportComplete\", () => {\r\n        graphModel.on(\"nodeAdded.\" + def.node.name, function (node: any) {\r\n          _managePortsForNode(node);\r\n        });\r\n\r\n        for (const node of graphModel.getNodesWithType(def.node.name)) {\r\n          _managePortsForNode(node);\r\n        }\r\n      });\r\n    },\r\n  });\r\n}\r\n\r\nfunction _addModelId(\r\n  def: {\r\n    node: NodeDefinition<any>;\r\n  },\r\n  opts?: BaseOptions\r\n) {\r\n  const _methods = Object.assign({}, def.node.methods);\r\n\r\n  const _includeInputs = opts === undefined || opts.includeInputs;\r\n  const _includeOutputs = opts === undefined || opts.includeOutputs;\r\n\r\n  Object.assign(def.node, {\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {},\r\n  });\r\n\r\n  if (_includeInputs) {\r\n    Object.assign(def.node, {\r\n      usePortAsLabel: \"collectionName\",\r\n    });\r\n\r\n    def.node.dynamicports = (def.node.dynamicports || []).concat([\r\n      {\r\n        name: \"conditionalports/extended\",\r\n        condition: \"idSource = explicit OR idSource NOT SET\",\r\n        inputs: [\"modelId\"],\r\n      },\r\n    ]);\r\n\r\n    // Inputs\r\n    // @ts-expect-error\r\n    Object.assign(def.node.inputs, {\r\n      idSource: {\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { label: \"Specify explicitly\", value: \"explicit\" },\r\n            { label: \"From repeater\", value: \"foreach\" },\r\n          ],\r\n          allowEditOnly: true,\r\n        },\r\n        default: \"explicit\",\r\n        displayName: \"Id Source\",\r\n        group: \"General\",\r\n        tooltip:\r\n          \"Choose if you want to specify the Id explicitly, \\n or if you want it to be that of the current record in a repeater.\",\r\n        set: function (value: string) {\r\n          if (value === \"foreach\") {\r\n            // @ts-expect-error\r\n            this.scheduleAfterInputsHaveUpdated(() => {\r\n              // Find closest nodescope that have a _forEachModel\r\n              // @ts-expect-error\r\n              let component = this.nodeScope.componentOwner;\r\n              while (\r\n                component !== undefined &&\r\n                component._forEachModel === undefined &&\r\n                component.parentNodeScope\r\n              ) {\r\n                component = component.parentNodeScope.componentOwner;\r\n              }\r\n              // @ts-expect-error\r\n              this.setModel(\r\n                component !== undefined ? component._forEachModel : undefined\r\n              );\r\n            });\r\n          }\r\n        },\r\n      },\r\n      modelId: {\r\n        type: {\r\n          name: \"string\",\r\n          identifierOf: \"ModelName\",\r\n          identifierDisplayName: \"Object Ids\",\r\n        },\r\n        displayName: \"Id\",\r\n        group: \"General\",\r\n        set: function (value: any) {\r\n          if (value instanceof Model) value = value.getId(); // Can be passed as model as well\r\n          // @ts-expect-error\r\n          this._internal.modelId = value; // Wait to fetch data\r\n          // @ts-expect-error\r\n          this.setModelID(value);\r\n        },\r\n      },\r\n    });\r\n  }\r\n\r\n  // Outputs\r\n  if (_includeOutputs) {\r\n    // @ts-expect-error\r\n    Object.assign(def.node.outputs, {\r\n      id: {\r\n        type: \"string\",\r\n        displayName: \"Id\",\r\n        group: \"General\",\r\n        getter: function () {\r\n          // @ts-expect-error\r\n          return this._internal.model\r\n            ? // @ts-expect-error\r\n              this._internal.model.getId()\r\n            : // @ts-expect-error\r\n              this._internal.modelId;\r\n        },\r\n      },\r\n    });\r\n  }\r\n\r\n  // Methods\r\n  // @ts-expect-error\r\n  Object.assign(def.node.methods, {\r\n    setCollectionID: function (id: string) {\r\n      // @ts-expect-error\r\n      this._internal.collectionId = id;\r\n      // @ts-expect-error\r\n      this.clearWarnings();\r\n    },\r\n    setModelID: function (id: string) {\r\n      // @ts-expect-error\r\n      const model = (this.nodeScope.modelScope || Model).get(id);\r\n      // @ts-expect-error\r\n      this.setModel(model);\r\n    },\r\n    setModel: function (model: any) {\r\n      // @ts-expect-error\r\n      this._internal.model = model;\r\n      // @ts-expect-error\r\n      this.flagOutputDirty(\"id\");\r\n    },\r\n    registerInputIfNeeded: function (name: string) {\r\n      // @ts-expect-error\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === \"collectionName\")\r\n        // @ts-expect-error\r\n        this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setCollectionID.bind(this),\r\n        });\r\n\r\n      _methods &&\r\n        _methods.registerInputIfNeeded &&\r\n        // @ts-expect-error\r\n        _methods.registerInputIfNeeded.call(this, name);\r\n    },\r\n  });\r\n}\r\n\r\nfunction _addInputProperties<TInternal extends Record<string, any> = {}>(\r\n  def: NodeModule<TInternal>\r\n) {\r\n  const _def = { node: Object.assign({}, def.node), setup: def.setup };\r\n  const _methods = Object.assign({}, def.node.methods);\r\n\r\n  Object.assign(def.node, {\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {},\r\n  });\r\n\r\n  Object.assign(def.node, {\r\n    initialize: function () {\r\n      // @ts-expect-error\r\n      const internal = this._internal;\r\n      internal.inputValues = {};\r\n\r\n      // @ts-expect-error\r\n      _def.node.initialize && _def.node.initialize.call(this);\r\n    },\r\n  });\r\n\r\n  // Outputs\r\n  // @ts-expect-error\r\n  Object.assign(def.node.outputs, {});\r\n\r\n  // Inputs\r\n  // @ts-expect-error\r\n  Object.assign(def.node.inputs, {});\r\n\r\n  // Methods\r\n  // @ts-expect-error\r\n  Object.assign(def.node.methods, {\r\n    registerInputIfNeeded: function (name: string) {\r\n      // @ts-expect-error\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"prop-\"))\r\n        // @ts-expect-error\r\n        this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this._setInputValue.bind(this, name.substring(\"prop-\".length)),\r\n        });\r\n\r\n      _methods &&\r\n        _methods.registerInputIfNeeded &&\r\n        // @ts-expect-error\r\n        _methods.registerInputIfNeeded.call(this, name);\r\n    },\r\n    _setInputValue: function (name: string, value: any) {\r\n      // @ts-expect-error\r\n      this._internal.inputValues[name] = value;\r\n    },\r\n  });\r\n}\r\n\r\nfunction _addRelationProperty(def: NodeModule) {\r\n  const _methods = Object.assign({}, def.node.methods);\r\n\r\n  Object.assign(def.node, {\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {},\r\n  });\r\n\r\n  // Inputs\r\n  // @ts-expect-error\r\n  Object.assign(def.node.inputs, {\r\n    targetId: {\r\n      type: { name: \"string\", allowConnectionsOnly: true },\r\n      displayName: \"Target Record Id\",\r\n      group: \"General\",\r\n      set: function (value: string) {\r\n        // @ts-expect-error\r\n        this._internal.targetModelId = value;\r\n      },\r\n    },\r\n  });\r\n\r\n  // Methods\r\n  // @ts-expect-error\r\n  Object.assign(def.node.methods, {\r\n    registerInputIfNeeded: function (name: string) {\r\n      // @ts-expect-error\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === \"relationProperty\")\r\n        // @ts-expect-error\r\n        this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setRelationProperty.bind(this),\r\n        });\r\n\r\n      _methods &&\r\n        _methods.registerInputIfNeeded &&\r\n        // @ts-expect-error\r\n        _methods.registerInputIfNeeded.call(this, name);\r\n    },\r\n    setRelationProperty: function (value: string) {\r\n      // @ts-expect-error\r\n      this._internal.relationProperty = value;\r\n    },\r\n  });\r\n}\r\n\r\nfunction _getCurrentUser(modelScope: ModelScope): string | undefined {\r\n  // @ts-expect-error _noodl_cloud_runtime_version\r\n  if (typeof _noodl_cloud_runtime_version === \"undefined\") {\r\n    // We are running in browser, try to find the current user\r\n\r\n    const _cu =\r\n      localStorage[\"Parse/\" + CloudStore.instance.appId + \"/currentUser\"];\r\n    if (_cu !== undefined) {\r\n      let cu;\r\n      try {\r\n        cu = JSON.parse(_cu);\r\n      } catch (e) {}\r\n\r\n      return cu !== undefined ? cu.objectId : undefined;\r\n    }\r\n  } else {\r\n    // Assume we are running in cloud runtime\r\n    const request = modelScope.get(\"Request\");\r\n    // @ts-expect-error\r\n    return request.UserId;\r\n  }\r\n}\r\n\r\ninterface AccessControlRule {\r\n  id: string;\r\n  label: string;\r\n}\r\n\r\nfunction _addAccessControl<TInternal extends Record<string, any> = {}>(\r\n  def: NodeModule<TInternal>\r\n) {\r\n  const _def = { node: Object.assign({}, def.node), setup: def.setup };\r\n  const _methods = Object.assign({}, def.node.methods);\r\n\r\n  Object.assign(def.node, {\r\n    inputs: def.node.inputs || {},\r\n    outputs: def.node.outputs || {},\r\n    methods: def.node.methods || {},\r\n  });\r\n\r\n  Object.assign(def.node, {\r\n    initialize() {\r\n      // @ts-expect-error\r\n      const internal = this._internal;\r\n      internal.accessControl = {};\r\n\r\n      // @ts-expect-error\r\n      _def.node.initialize && _def.node.initialize.call(this);\r\n    },\r\n  });\r\n\r\n  // Inputs\r\n  // @ts-expect-error\r\n  Object.assign(def.node.inputs, {\r\n    accessControl: {\r\n      type: { name: \"proplist\", autoName: \"Rule\", allowEditOnly: true },\r\n      index: 1000,\r\n      displayName: \"Access Control Rules\",\r\n      group: \"Access Control Rules\",\r\n      set(value: AccessControlRule[]) {\r\n        // @ts-expect-error\r\n        this._internal.accessControlRules = value;\r\n      },\r\n    },\r\n  });\r\n\r\n  // Dynamic ports\r\n  // @ts-expect-error\r\n  const _super = def._additionalDynamicPorts;\r\n  // @ts-expect-error\r\n  def._additionalDynamicPorts = function (\r\n    node: any,\r\n    ports: any[],\r\n    graphModel: any\r\n  ) {\r\n    if (\r\n      node.parameters[\"accessControl\"] !== undefined &&\r\n      node.parameters[\"accessControl\"].length > 0\r\n    ) {\r\n      node.parameters[\"accessControl\"].forEach((ac: AccessControlRule) => {\r\n        const prefix = \"acl-\" + ac.id;\r\n        // User or role?\r\n        ports.push({\r\n          name: prefix + \"-target\",\r\n          displayName: \"Target\",\r\n          editorName: ac.label + \" | Target\",\r\n          plug: \"input\",\r\n          type: {\r\n            name: \"enum\",\r\n            enums: [\r\n              { value: \"user\", label: \"User\" },\r\n              { value: \"everyone\", label: \"Everyone\" },\r\n              { value: \"role\", label: \"Role\" },\r\n            ],\r\n            allowEditOnly: true,\r\n          },\r\n          group: ac.label + \" Access Rule\",\r\n          default: \"user\",\r\n          parent: \"accessControl\",\r\n          parentItemId: ac.id,\r\n        });\r\n\r\n        if (node.parameters[prefix + \"-target\"] === \"role\") {\r\n          ports.push({\r\n            name: prefix + \"-role\",\r\n            displayName: \"Role\",\r\n            editorName: ac.label + \" | Role\",\r\n            group: ac.label + \" Access Rule\",\r\n            plug: \"input\",\r\n            type: \"string\",\r\n            parent: \"accessControl\",\r\n            parentItemId: ac.id,\r\n          });\r\n        } else if (\r\n          node.parameters[prefix + \"-target\"] === undefined ||\r\n          node.parameters[prefix + \"-target\"] === \"user\"\r\n        ) {\r\n          ports.push({\r\n            name: prefix + \"-userid\",\r\n            displayName: \"User Id\",\r\n            group: ac.label + \" Access Rule\",\r\n            editorName: ac.label + \" | User Id\",\r\n            plug: \"input\",\r\n            type: { name: \"string\", allowConnectionsOnly: true },\r\n            parent: \"accessControl\",\r\n            parentItemId: ac.id,\r\n          });\r\n        }\r\n\r\n        // Read\r\n        ports.push({\r\n          name: prefix + \"-read\",\r\n          displayName: \"Read\",\r\n          editorName: ac.label + \" | Read\",\r\n          group: ac.label + \" Access Rule\",\r\n          plug: \"input\",\r\n          type: { name: \"boolean\" },\r\n          default: true,\r\n          parent: \"accessControl\",\r\n          parentItemId: ac.id,\r\n        });\r\n\r\n        // Write\r\n        ports.push({\r\n          name: prefix + \"-write\",\r\n          displayName: \"Write\",\r\n          editorName: ac.label + \" | Write\",\r\n          group: ac.label + \" Access Rule\",\r\n          plug: \"input\",\r\n          type: { name: \"boolean\" },\r\n          default: true,\r\n          parent: \"accessControl\",\r\n          parentItemId: ac.id,\r\n        });\r\n      });\r\n    }\r\n\r\n    _super && _super(node, ports, graphModel);\r\n  };\r\n\r\n  // Methods\r\n  // @ts-expect-error\r\n  Object.assign(def.node.methods, {\r\n    registerInputIfNeeded: function (name: string) {\r\n      // @ts-expect-error\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"acl-\"))\r\n        // @ts-expect-error\r\n        this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setAccessControl.bind(this, name),\r\n        });\r\n\r\n      _methods &&\r\n        _methods.registerInputIfNeeded &&\r\n        // @ts-expect-error\r\n        _methods.registerInputIfNeeded.call(this, name);\r\n    },\r\n    _getACL: function () {\r\n      let acl: { [key: string]: { read: boolean; write: boolean } } = {};\r\n\r\n      function _rule(rule: any) {\r\n        return {\r\n          read: rule.read === undefined ? true : rule.read,\r\n          write: rule.write === undefined ? true : rule.write,\r\n        };\r\n      }\r\n\r\n      // @ts-expect-error\r\n      const currentUserId = _getCurrentUser(this.nodeScope.modelScope);\r\n\r\n      // @ts-expect-error\r\n      if (this._internal.accessControlRules !== undefined) {\r\n        // @ts-expect-error\r\n        this._internal.accessControlRules.forEach((r: AccessControlRule) => {\r\n          // @ts-expect-error\r\n          const rule = this._internal.accessControl[r.id];\r\n\r\n          if (rule === undefined) {\r\n            const userId = currentUserId;\r\n            if (userId !== undefined) acl[userId] = { write: true, read: true };\r\n          } else if (rule.target === \"everyone\") {\r\n            acl[\"*\"] = _rule(rule);\r\n          } else if (rule.target === \"user\") {\r\n            const userId = rule.userid || currentUserId;\r\n            acl[userId] = _rule(rule);\r\n          } else if (rule.target === \"role\") {\r\n            acl[\"role:\" + rule.role] = _rule(rule);\r\n          }\r\n        });\r\n      }\r\n\r\n      return Object.keys(acl).length > 0 ? acl : undefined;\r\n    },\r\n    setAccessControl: function (name: string, value: any) {\r\n      const _parts = name.split(\"-\");\r\n\r\n      // @ts-expect-error\r\n      if (this._internal.accessControl[_parts[1]] === undefined)\r\n        // @ts-expect-error\r\n        this._internal.accessControl[_parts[1]] = {};\r\n      // @ts-expect-error\r\n      this._internal.accessControl[_parts[1]][_parts[2]] = value;\r\n    },\r\n  });\r\n}\r\n\r\nexport {\r\n  _addInputProperties as addInputProperties,\r\n  _addModelId as addModelId,\r\n  _addBaseInfo as addBaseInfo,\r\n  _addRelationProperty as addRelationProperty,\r\n  _addAccessControl as addAccessControl,\r\n};\r\n","import * as DbModelCRUDBase from \"./dbmodelcrudbase\";\r\nimport { CloudStore } from \"../../../api/cloudstore\";\r\nimport { NodeDefinition } from \"../../../nodedefinition\";\r\nimport { Model } from \"../../../model\";\r\n\r\ninterface Internal {\r\n  storeType?: \"cloud\" | \"local\";\r\n  storeProperties?: \"specified\" | \"all\";\r\n  model?: Model;\r\n  collectionId?: string;\r\n  inputValues: Record<string, any>;\r\n}\r\n\r\nconst SetDbModelPropertiedNodeDefinition: { node: NodeDefinition<Internal> } = {\r\n  node: {\r\n    name: \"SetDbModelProperties\",\r\n    category: \"\",\r\n    docs: \"https://docs.noodl.net/nodes/data/cloud-data/set-record-properties\",\r\n    displayNodeName: \"Set Record Properties\",\r\n    usePortAsLabel: \"collectionName\",\r\n    dynamicports: [\r\n      {\r\n        name: \"conditionalports/extended\",\r\n        condition: \"storeType = cloud OR storeType NOT SET\",\r\n        inputs: [\"storeProperties\"],\r\n      },\r\n    ],\r\n    inputs: {\r\n      store: {\r\n        displayName: \"Do\",\r\n        group: \"Actions\",\r\n        valueChangedToTrue() {\r\n          if (\r\n            this._internal.storeType === undefined ||\r\n            this._internal.storeType === \"cloud\"\r\n          ) {\r\n            // @ts-expect-error\r\n            this.scheduleSave();\r\n          } else {\r\n            // @ts-expect-error\r\n            this.scheduleStore();\r\n          }\r\n        },\r\n      },\r\n      storeProperties: {\r\n        displayName: \"Properties to  store\",\r\n        group: \"General\",\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { label: \"Only specified\", value: \"specified\" },\r\n            { label: \"All\", value: \"all\" },\r\n          ],\r\n        },\r\n        default: \"specified\",\r\n        set: function (this: any, value: \"specified\" | \"all\") {\r\n          this._internal.storeProperties = value;\r\n        },\r\n      },\r\n      storeType: {\r\n        displayName: \"Store to\",\r\n        group: \"General\",\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { label: \"Cloud and local\", value: \"cloud\" },\r\n            { label: \"Local only\", value: \"local\" },\r\n          ],\r\n        },\r\n        default: \"cloud\",\r\n        set: function (this: any, value: \"cloud\" | \"local\") {\r\n          this._internal.storeType = value;\r\n        },\r\n      },\r\n    },\r\n    outputs: {\r\n      stored: {\r\n        type: \"signal\",\r\n        displayName: \"Success\",\r\n        group: \"Events\",\r\n      },\r\n    },\r\n    methods: {\r\n      scheduleSave() {\r\n        const _this = this;\r\n        const internal = this._internal;\r\n\r\n        // @ts-expect-error\r\n        if (!this.checkWarningsBeforeCloudOp()) return;\r\n\r\n        // @ts-expect-error\r\n        this.scheduleOnce(\"StorageSave\", function () {\r\n          if (!internal.model) {\r\n            // @ts-expect-error\r\n            _this.setError(\"Missing Record Id\");\r\n            return;\r\n          }\r\n\r\n          const model = internal.model;\r\n          for (const key in internal.inputValues) {\r\n            model.set(key, internal.inputValues[key], { resolve: true });\r\n          }\r\n\r\n          // @ts-expect-error\r\n          CloudStore.forScope(_this.nodeScope.modelScope).save({\r\n            // @ts-expect-error\r\n            collection: internal.collectionId,\r\n            objectId: model.getId(), // Get the objectId part of the model id\r\n            data:\r\n              internal.storeProperties === \"all\"\r\n                ? model.data\r\n                : internal.inputValues, // Only store input values by default, if not explicitly specified\r\n            // @ts-expect-error\r\n            acl: _this._getACL(),\r\n            success: function (response: Record<string, any>) {\r\n              for (const key in response) {\r\n                model.set(key, response[key]);\r\n              }\r\n\r\n              _this.sendSignalOnOutput(\"stored\");\r\n            },\r\n            error: function (err: string) {\r\n              // @ts-expect-error\r\n              _this.setError(err || \"Failed to save.\");\r\n            },\r\n          });\r\n        });\r\n      },\r\n      scheduleStore() {\r\n        // @ts-expect-error\r\n        if (this.hasScheduledStore) return;\r\n        // @ts-expect-error\r\n        this.hasScheduledStore = true;\r\n\r\n        const internal = this._internal;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          // @ts-expect-error\r\n          this.hasScheduledStore = false;\r\n          if (!internal.model) return;\r\n\r\n          for (const i in internal.inputValues) {\r\n            internal.model.set(i, internal.inputValues[i], { resolve: true });\r\n          }\r\n          this.sendSignalOnOutput(\"stored\");\r\n        });\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\nDbModelCRUDBase.addBaseInfo(SetDbModelPropertiedNodeDefinition);\r\nDbModelCRUDBase.addModelId(SetDbModelPropertiedNodeDefinition);\r\nDbModelCRUDBase.addInputProperties(SetDbModelPropertiedNodeDefinition);\r\nDbModelCRUDBase.addAccessControl(SetDbModelPropertiedNodeDefinition);\r\n\r\nexport const node = SetDbModelPropertiedNodeDefinition.node;\r\n","import * as DbModelCRUDBase from \"./dbmodelcrudbase\";\r\nimport { CloudStore } from \"../../../api/cloudstore\";\r\nimport { NodeDefinition } from \"../../../nodedefinition\";\r\nimport { Model } from \"../../../model\";\r\n\r\ninterface Internal {\r\n  model?: Model;\r\n  collectionId?: string;\r\n  nodeScope: {\r\n    ModelScope?: typeof Model;\r\n  };\r\n}\r\n\r\nconst DeleteDbModelPropertiedNodeDefinition: {\r\n  node: NodeDefinition<Internal>;\r\n} = {\r\n  node: {\r\n    name: \"DeleteDbModelProperties\",\r\n    category: \"\",\r\n    docs: \"https://docs.noodl.net/nodes/data/cloud-data/delete-record\",\r\n    displayNodeName: \"Delete Record\",\r\n    shortDesc:\r\n      \"Stores any amount of properties and can be used standalone or together with Collections and For Each nodes.\",\r\n    inputs: {\r\n      store: {\r\n        displayName: \"Do\",\r\n        group: \"Actions\",\r\n        valueChangedToTrue() {\r\n          // @ts-expect-error\r\n          this.storageDelete();\r\n        },\r\n      },\r\n    },\r\n    outputs: {\r\n      deleted: {\r\n        type: \"signal\",\r\n        displayName: \"Success\",\r\n        group: \"Events\",\r\n      },\r\n    },\r\n    methods: {\r\n      storageDelete() {\r\n        const internal = this._internal;\r\n\r\n        // @ts-expect-error\r\n        if (!this.checkWarningsBeforeCloudOp()) return;\r\n\r\n        // @ts-expect-error\r\n        this.scheduleOnce(\"StorageDelete\", () => {\r\n          if (!internal.model) {\r\n            // @ts-expect-error\r\n            this.setError(\"Missing Record Id\");\r\n            return;\r\n          }\r\n\r\n          // @ts-expect-error\r\n          CloudStore.forScope(this.nodeScope.ModelScope).delete({\r\n            // @ts-expect-error\r\n            collection: internal.collectionId,\r\n            objectId: internal.model.getId(), // Get the objectId part of the model id,\r\n            success: () => {\r\n              // @ts-expect-error\r\n              internal.model!.notify(\"delete\"); // Notify that this model has been deleted\r\n              this.sendSignalOnOutput(\"deleted\");\r\n            },\r\n            error: (err: string) => {\r\n              // @ts-expect-error\r\n              this.setError(err || \"Failed to delete.\");\r\n            },\r\n          });\r\n        });\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\nDbModelCRUDBase.addBaseInfo(DeleteDbModelPropertiedNodeDefinition, {\r\n  includeInputProperties: false,\r\n});\r\nDbModelCRUDBase.addModelId(DeleteDbModelPropertiedNodeDefinition);\r\n\r\nexport const node = DeleteDbModelPropertiedNodeDefinition.node;\r\n","import { Model } from \"../../../model\";\r\nimport * as DbModelCRUDBase from \"./dbmodelcrudbase\";\r\nimport { CloudStore } from \"../../../api/cloudstore\";\r\nimport { NodeDefinition } from \"../../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  sourceObjectId?: string;\r\n  collectionId?: string;\r\n  inputValues: Record<string, any>;\r\n  nodeScope: {\r\n    modelScope?: typeof Model;\r\n  };\r\n  [key: string]: any;\r\n}\r\n\r\nconst NewDbModelPropertiedNodeDefinition: {\r\n  node: NodeDefinition<Internal>;\r\n} = {\r\n  node: {\r\n    name: \"NewDbModelProperties\",\r\n    category: \"\",\r\n    docs: \"https://docs.noodl.net/nodes/data/cloud-data/create-new-record\",\r\n    displayName: \"Create New Record\",\r\n    usePortAsLabel: \"collectionName\",\r\n    inputs: {\r\n      store: {\r\n        displayName: \"Do\",\r\n        group: \"Actions\",\r\n        valueChangedToTrue() {\r\n          // @ts-expect-error\r\n          this.storageInsert();\r\n        },\r\n      },\r\n      sourceObjectId: {\r\n        type: { name: \"string\", allowConnectionsOnly: true },\r\n        displayName: \"Source Object Id\",\r\n        group: \"General\",\r\n        set(value: string | Model) {\r\n          if (value instanceof Model) value = value.getId(); // Can be passed as model as well\r\n          this._internal.sourceObjectId = value; // Wait to fetch data\r\n        },\r\n      },\r\n    },\r\n    outputs: {\r\n      created: {\r\n        type: \"signal\",\r\n        displayName: \"Success\",\r\n        group: \"Events\",\r\n      },\r\n    },\r\n    methods: {\r\n      storageInsert() {\r\n        const internal = this._internal;\r\n\r\n        // @ts-expect-error\r\n        if (!this.checkWarningsBeforeCloudOp()) return;\r\n\r\n        // @ts-expect-error\r\n        this.scheduleOnce(\"StorageInsert\", () => {\r\n          const initValues = Object.assign(\r\n            {},\r\n            internal.sourceObjectId\r\n              ? (this.nodeScope!.modelScope || Model).get(\r\n                  internal.sourceObjectId\r\n                ).data\r\n              : {},\r\n            internal.inputValues\r\n          );\r\n\r\n          const cloudstore = CloudStore.forScope(this.nodeScope!.modelScope);\r\n          cloudstore.create({\r\n            // @ts-expect-error\r\n            collection: internal.collectionId,\r\n            data: initValues,\r\n            // @ts-expect-error\r\n            acl: this._getACL(),\r\n            success: (data: any) => {\r\n              // Successfully created\r\n              // @ts-expect-error\r\n              const m = cloudstore._fromJSON(data, internal.collectionId);\r\n              // @ts-expect-error\r\n              this.setModel(m);\r\n              this.sendSignalOnOutput(\"created\");\r\n            },\r\n            error: (err: string) => {\r\n              // @ts-expect-error\r\n              this.setError(err || \"Failed to insert.\");\r\n            },\r\n          });\r\n        });\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\nDbModelCRUDBase.addBaseInfo(NewDbModelPropertiedNodeDefinition);\r\nDbModelCRUDBase.addModelId(NewDbModelPropertiedNodeDefinition, {\r\n  includeOutputs: true,\r\n});\r\nDbModelCRUDBase.addInputProperties(NewDbModelPropertiedNodeDefinition);\r\nDbModelCRUDBase.addAccessControl(NewDbModelPropertiedNodeDefinition);\r\n\r\nexport const node = NewDbModelPropertiedNodeDefinition.node;\r\n","import { Model } from \"../../../model\";\r\nimport * as DbModelCRUDBase from \"./dbmodelcrudbase\";\r\nimport { CloudStore } from \"../../../api/cloudstore\";\r\nimport { NodeDefinition } from \"../../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  collectionId?: string;\r\n  relationProperty?: string;\r\n  targetModelId?: string;\r\n  model?: any;\r\n}\r\n\r\nconst AddDbModelRelationNodeDefinition: {\r\n  node: NodeDefinition<Internal>;\r\n} = {\r\n  node: {\r\n    name: \"AddDbModelRelation\",\r\n    category: \"Data\",\r\n    docs: \"https://docs.noodl.net/nodes/data/cloud-data/add-record-relation\",\r\n    displayNodeName: \"Add Record Relation\",\r\n    usePortAsLabel: \"collectionName\",\r\n    inputs: {\r\n      store: {\r\n        displayName: \"Do\",\r\n        group: \"Actions\",\r\n        valueChangedToTrue() {\r\n          // @ts-expect-error\r\n          this.scheduleAddRelation();\r\n        },\r\n      },\r\n    },\r\n    outputs: {\r\n      relationAdded: {\r\n        type: \"signal\",\r\n        displayName: \"Success\",\r\n        group: \"Events\",\r\n      },\r\n    },\r\n    methods: {\r\n      validateInputs() {\r\n        if (!this.context.editorConnection) return;\r\n\r\n        const _warning = (message: string) => {\r\n          this.context.editorConnection!.sendWarning(\r\n            this.nodeScope!.componentOwner.name,\r\n            this.id,\r\n            \"add-relation\",\r\n            {\r\n              message,\r\n            }\r\n          );\r\n        };\r\n\r\n        if (this._internal.collectionId === undefined) {\r\n          _warning(\"No class specified\");\r\n        } else if (this._internal.relationProperty === undefined) {\r\n          _warning(\"No relation property specified\");\r\n        } else if (this._internal.targetModelId === undefined) {\r\n          _warning(\r\n            \"No target record Id (the record to add a relation to) specified\"\r\n          );\r\n        } else if (this._internal.model === undefined) {\r\n          _warning(\r\n            \"No record Id specified (the record that should get the relation)\"\r\n          );\r\n        } else {\r\n          this.context.editorConnection.clearWarning(\r\n            this.nodeScope!.componentOwner.name,\r\n            this.id,\r\n            \"add-relation\"\r\n          );\r\n        }\r\n      },\r\n      scheduleAddRelation() {\r\n        const _this = this;\r\n        const internal = this._internal;\r\n\r\n        // @ts-expect-error\r\n        this.scheduleOnce(\"StorageAddRelation\", function () {\r\n          // @ts-expect-error\r\n          _this.validateInputs();\r\n\r\n          if (!internal.model) return;\r\n          const model = internal.model;\r\n\r\n          const targetModelId = internal.targetModelId;\r\n          if (targetModelId === undefined) return;\r\n\r\n          // @ts-expect-error\r\n          CloudStore.forScope(_this.nodeScope.modelScope).addRelation({\r\n            collection: internal.collectionId!,\r\n            objectId: model.getId(),\r\n            key: internal.relationProperty!,\r\n            targetObjectId: targetModelId,\r\n            // @ts-expect-error\r\n            targetClass: (_this.nodeScope.modelScope || Model).get(\r\n              targetModelId\r\n            )._class,\r\n            success: function (response: any) {\r\n              for (const key in response) {\r\n                model.set(key, response[key]);\r\n              }\r\n\r\n              // Successfully added relation\r\n              _this.sendSignalOnOutput(\"relationAdded\");\r\n            },\r\n            error: function (err?: string) {\r\n              // @ts-expect-error\r\n              _this.setError(err || \"Failed to add relation.\");\r\n            },\r\n          });\r\n        });\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\nDbModelCRUDBase.addBaseInfo(AddDbModelRelationNodeDefinition, {\r\n  includeRelations: true,\r\n});\r\nDbModelCRUDBase.addModelId(AddDbModelRelationNodeDefinition);\r\nDbModelCRUDBase.addRelationProperty(AddDbModelRelationNodeDefinition);\r\n\r\nexport const node = AddDbModelRelationNodeDefinition.node;\r\n","import { Model } from \"../../../model\";\r\nimport { CloudStore } from \"../../../api/cloudstore\";\r\nimport { NodeDefinition } from \"../../../nodedefinition\";\r\nimport * as DbModelCRUDBase from \"./dbmodelcrudbase\";\r\n\r\ninterface RemoveDbModelRelationInternal {\r\n  collectionId?: string;\r\n  relationProperty?: string;\r\n  targetModelId?: string;\r\n  model?: any;\r\n  error?: string;\r\n}\r\n\r\nconst AddDbModelRelationNodeDefinition: {\r\n  node: NodeDefinition<RemoveDbModelRelationInternal>;\r\n} = {\r\n  node: {\r\n    name: \"RemoveDbModelRelation\",\r\n    category: \"\",\r\n    docs: \"https://docs.noodl.net/nodes/data/cloud-data/remove-record-relation\",\r\n    displayName: \"Remove Record Relation\",\r\n    usePortAsLabel: \"collectionName\",\r\n    inputs: {\r\n      store: {\r\n        displayName: \"Do\",\r\n        group: \"Actions\",\r\n        valueChangedToTrue() {\r\n          // @ts-expect-error\r\n          this.scheduleRemoveRelation();\r\n        },\r\n      },\r\n    },\r\n    outputs: {\r\n      relationRemoved: {\r\n        type: \"signal\",\r\n        displayName: \"Success\",\r\n        group: \"Events\",\r\n      },\r\n    },\r\n    methods: {\r\n      validateInputs() {\r\n        if (!this.context.editorConnection) return;\r\n\r\n        const _warning = (message: string) => {\r\n          this.context.editorConnection!.sendWarning(\r\n            this.nodeScope!.componentOwner.name,\r\n            this.id,\r\n            \"add-relation\",\r\n            {\r\n              message,\r\n            }\r\n          );\r\n        };\r\n\r\n        if (this._internal.collectionId === undefined) {\r\n          _warning(\"No class specified\");\r\n        } else if (this._internal.relationProperty === undefined) {\r\n          _warning(\"No relation property specified\");\r\n        } else if (this._internal.targetModelId === undefined) {\r\n          _warning(\r\n            \"No target record Id (the record to add a relation to) specified\"\r\n          );\r\n        } else if (this._internal.model === undefined) {\r\n          _warning(\r\n            \"No record Id specified (the record that should get the relation)\"\r\n          );\r\n        } else {\r\n          this.context.editorConnection.clearWarning(\r\n            this.nodeScope!.componentOwner.name,\r\n            this.id,\r\n            \"add-relation\"\r\n          );\r\n        }\r\n      },\r\n      scheduleRemoveRelation() {\r\n        const _this = this;\r\n        const internal = this._internal;\r\n\r\n        // @ts-expect-error\r\n        this.scheduleOnce(\"StorageRemoveRelation\", function () {\r\n          // @ts-expect-error\r\n          _this.validateInputs();\r\n\r\n          if (!internal.model) return;\r\n          const model = internal.model;\r\n\r\n          const targetModelId = internal.targetModelId;\r\n          if (targetModelId === undefined) return;\r\n\r\n          // @ts-expect-error\r\n          CloudStore.forScope(_this.nodeScope.modelScope).removeRelation({\r\n            // @ts-expect-error\r\n            collection: internal.collectionId,\r\n            objectId: model.getId(),\r\n            key: internal.relationProperty,\r\n            targetObjectId: targetModelId,\r\n            // @ts-expect-error\r\n            targetClass: (_this.nodeScope.modelScope || Model).get(\r\n              targetModelId\r\n            )._class,\r\n            success: function (response: Record<string, any>) {\r\n              for (const _key in response) {\r\n                model.set(_key, response[_key]);\r\n              }\r\n\r\n              // Successfully removed relation\r\n              _this.sendSignalOnOutput(\"relationRemoved\");\r\n            },\r\n            error: function (err?: string) {\r\n              // @ts-expect-error\r\n              _this.setError(err || \"Failed to remove relation.\");\r\n            },\r\n          });\r\n        });\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\nDbModelCRUDBase.addBaseInfo(AddDbModelRelationNodeDefinition, {\r\n  includeRelations: true,\r\n});\r\nDbModelCRUDBase.addModelId(AddDbModelRelationNodeDefinition);\r\nDbModelCRUDBase.addRelationProperty(AddDbModelRelationNodeDefinition);\r\n\r\nexport const node = AddDbModelRelationNodeDefinition.node;\r\n","import { Collection } from \"../../../collection\";\r\nimport { Model } from \"../../../model\";\r\nimport { CloudStore } from \"../../../api/cloudstore\";\r\nimport * as QueryUtils from \"../../../api/queryutils\";\r\nimport { NodeContext } from \"../../../nodecontext\";\r\nimport { EditorConnection } from \"../../../editorconnection\";\r\nimport { NodeDefinition } from \"../../../nodedefinition\";\r\nimport { GraphModel } from \"../../../models/graphmodel\";\r\nimport { Port } from \"../../../models/componentmodel\";\r\nimport { Node } from \"../../../node\";\r\n\r\ninterface Internal {\r\n  collectionChangedCallback: () => void;\r\n  cloudStoreEvents: (args: any) => void;\r\n  enabled: boolean;\r\n  filterSettings: Record<string, any>;\r\n  filterParameters: Record<string, any>;\r\n  collection?: any;\r\n  collectionName?: string;\r\n  visualFilter?: any;\r\n  visualSorting?: any;\r\n  filteredCollection?: any;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"FilterDBModels\",\r\n  docs: \"https://docs.noodl.net/nodes/data/cloud-data/filter-records\",\r\n  displayNodeName: \"Filter Records\",\r\n  shortDesc: \"Filter, sort and limit array\",\r\n  category: \"Data\",\r\n  color: \"data\",\r\n  initialize() {\r\n    const _this = this;\r\n\r\n    this._internal.collectionChangedCallback = function () {\r\n      if (_this.isInputConnected(\"filter\") === true) return;\r\n\r\n      // @ts-expect-error\r\n      _this.scheduleFilter();\r\n    };\r\n\r\n    this._internal.cloudStoreEvents = function (args: any) {\r\n      if (_this.isInputConnected(\"filter\") === true) return;\r\n\r\n      if (_this._internal.visualFilter === undefined) return;\r\n      if (_this._internal.collection === undefined) return;\r\n      if (args.collection !== _this._internal.collectionName) return;\r\n\r\n      if (\r\n        args.objectId !== undefined &&\r\n        _this._internal.collection.contains(Model.get(args.objectId))\r\n      )\r\n        // @ts-expect-error\r\n        _this.scheduleFilter();\r\n    };\r\n\r\n    CloudStore.instance.on(\"save\", this._internal.cloudStoreEvents);\r\n\r\n    this._internal.enabled = true;\r\n    this._internal.filterSettings = {};\r\n    this._internal.filterParameters = {};\r\n  },\r\n  getInspectInfo() {\r\n    const collection = this._internal.filteredCollection;\r\n\r\n    if (!collection) {\r\n      return { type: \"text\", value: \"[Not executed yet]\" };\r\n    }\r\n\r\n    return [\r\n      {\r\n        type: \"text\",\r\n        value: \"Id: \" + collection.getId(),\r\n      },\r\n      {\r\n        type: \"value\",\r\n        value: collection.items,\r\n      },\r\n    ];\r\n  },\r\n  inputs: {\r\n    items: {\r\n      type: \"array\",\r\n      displayName: \"Items\",\r\n      group: \"General\",\r\n      set(value: any) {\r\n        // @ts-expect-error\r\n        this.bindCollection(value);\r\n        // @ts-expect-error\r\n        if (this.isInputConnected(\"filter\") === false) this.scheduleFilter();\r\n      },\r\n    },\r\n    enabled: {\r\n      type: \"boolean\",\r\n      group: \"General\",\r\n      displayName: \"Enabled\",\r\n      default: true,\r\n      set(value: boolean) {\r\n        this._internal.enabled = value;\r\n        // @ts-expect-error\r\n        if (this.isInputConnected(\"filter\") === false) this.scheduleFilter();\r\n      },\r\n    },\r\n    filter: {\r\n      type: \"signal\",\r\n      group: \"Actions\",\r\n      displayName: \"Filter\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleFilter();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    items: {\r\n      type: \"array\",\r\n      displayName: \"Items\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.filteredCollection;\r\n      },\r\n    },\r\n    firstItemId: {\r\n      type: \"string\",\r\n      displayName: \"First Record Id\",\r\n      group: \"General\",\r\n      getter() {\r\n        if (this._internal.filteredCollection !== undefined) {\r\n          const firstItem = this._internal.filteredCollection.get(0);\r\n          if (firstItem !== undefined) return firstItem.getId();\r\n        }\r\n      },\r\n    },\r\n    count: {\r\n      type: \"number\",\r\n      displayName: \"Count\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.filteredCollection\r\n          ? this._internal.filteredCollection.size()\r\n          : 0;\r\n      },\r\n    },\r\n    modified: {\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n      displayName: \"Filtered\",\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    unbindCurrentCollection() {\r\n      const collection = this._internal.collection;\r\n      if (!collection) return;\r\n      collection.off(\"change\", this._internal.collectionChangedCallback);\r\n      this._internal.collection = undefined;\r\n    },\r\n    bindCollection(collection: any) {\r\n      // @ts-expect-error\r\n      this.unbindCurrentCollection();\r\n      this._internal.collection = collection;\r\n      collection &&\r\n        collection.on(\"change\", this._internal.collectionChangedCallback);\r\n    },\r\n    _onNodeDeleted() {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      // @ts-expect-error\r\n      this.unbindCurrentCollection();\r\n\r\n      CloudStore.instance.off(\"save\", this._internal.cloudStoreEvents);\r\n    },\r\n    getLimit() {\r\n      const filterSettings = this._internal.filterSettings;\r\n\r\n      if (!filterSettings[\"filterEnableLimit\"]) return;\r\n      else return filterSettings[\"filterLimit\"] || 10;\r\n    },\r\n    getSkip() {\r\n      const filterSettings = this._internal.filterSettings;\r\n\r\n      if (!filterSettings[\"filterEnableLimit\"]) return;\r\n      else return filterSettings[\"filterSkip\"] || 0;\r\n    },\r\n    scheduleFilter() {\r\n      // @ts-expect-error\r\n      if (this.collectionChangedScheduled) return;\r\n      // @ts-expect-error\r\n      this.collectionChangedScheduled = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.collectionChangedScheduled = false;\r\n        if (!this._internal.collection) return;\r\n\r\n        // Apply filter and write to output collection\r\n        let filtered = [].concat(this._internal.collection.items);\r\n\r\n        if (this._internal.enabled) {\r\n          const _filter = this._internal.visualFilter;\r\n          if (_filter !== undefined) {\r\n            const filter = QueryUtils.convertVisualFilter(_filter, {\r\n              queryParameters: this._internal.filterParameters,\r\n              collectionName: this._internal.collectionName,\r\n            });\r\n            if (filter)\r\n              filtered = filtered.filter((m) =>\r\n                QueryUtils.matchesQuery(m, filter)\r\n              );\r\n          }\r\n\r\n          const _sort = this._internal.visualSorting;\r\n          if (_sort !== undefined && _sort.length > 0) {\r\n            const sort = QueryUtils.convertVisualSorting(_sort);\r\n            if (sort) filtered.sort(QueryUtils.compareObjects.bind(this, sort));\r\n          }\r\n\r\n          // @ts-expect-error\r\n          const skip = this.getSkip();\r\n          if (skip) filtered = filtered.slice(skip, filtered.length);\r\n\r\n          // @ts-expect-error\r\n          const limit = this.getLimit();\r\n          if (limit) filtered = filtered.slice(0, limit);\r\n        }\r\n\r\n        this._internal.filteredCollection = Collection.create(filtered);\r\n\r\n        this.sendSignalOnOutput(\"modified\");\r\n        this.flagOutputDirty(\"firstItemId\");\r\n        this.flagOutputDirty(\"items\");\r\n        this.flagOutputDirty(\"count\");\r\n      });\r\n    },\r\n    setCollectionName(name: string) {\r\n      this._internal.collectionName = name;\r\n    },\r\n    setVisualFilter(value: any) {\r\n      this._internal.visualFilter = value;\r\n\r\n      // @ts-expect-error\r\n      if (this.isInputConnected(\"filter\") === false) this.scheduleFilter();\r\n    },\r\n    setVisualSorting(value: any) {\r\n      this._internal.visualSorting = value;\r\n\r\n      // @ts-expect-error\r\n      if (this.isInputConnected(\"filter\") === false) this.scheduleFilter();\r\n    },\r\n    setFilterParameter: function (\r\n      // @ts-expect-error\r\n      this: FilterDBModelsNode,\r\n      name: string,\r\n      value: any\r\n    ) {\r\n      this._internal.filterParameters[name] = value;\r\n\r\n      if (this.isInputConnected(\"filter\") === false) this.scheduleFilter();\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === \"collectionName\")\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setCollectionName.bind(this),\r\n        });\r\n\r\n      if (name === \"visualFilter\")\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setVisualFilter.bind(this),\r\n        });\r\n\r\n      if (name === \"visualSorting\")\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setVisualSorting.bind(this),\r\n        });\r\n\r\n      if (name.startsWith(\"fp-\"))\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setFilterParameter.bind(this, name.substring(\"fp-\".length)),\r\n        });\r\n\r\n      this.registerInput(name, {\r\n        set(value: any) {\r\n          this._internal.filterSettings[name] = value;\r\n          // @ts-expect-error\r\n          if (this.isInputConnected(\"filter\") === false) this.scheduleFilter();\r\n        },\r\n      });\r\n    },\r\n  },\r\n};\r\n\r\nfunction updatePorts(\r\n  nodeId: string,\r\n  parameters: any,\r\n  editorConnection: EditorConnection,\r\n  dbCollections: any[]\r\n) {\r\n  const ports: Port[] = [];\r\n\r\n  ports.push({\r\n    name: \"collectionName\",\r\n    type: {\r\n      name: \"enum\",\r\n      enums:\r\n        dbCollections !== undefined\r\n          ? dbCollections.map((c) => {\r\n              return { value: c.name, label: c.name };\r\n            })\r\n          : [],\r\n      allowEditOnly: true,\r\n    },\r\n    displayName: \"Class\",\r\n    plug: \"input\",\r\n    group: \"General\",\r\n  });\r\n\r\n  ports.push({\r\n    type: \"boolean\",\r\n    plug: \"input\",\r\n    group: \"Limit\",\r\n    name: \"filterEnableLimit\",\r\n    displayName: \"Use limit\",\r\n  });\r\n\r\n  if (parameters[\"filterEnableLimit\"]) {\r\n    ports.push({\r\n      type: \"number\",\r\n      default: 10,\r\n      plug: \"input\",\r\n      group: \"Limit\",\r\n      name: \"filterLimit\",\r\n      displayName: \"Limit\",\r\n    });\r\n\r\n    ports.push({\r\n      type: \"number\",\r\n      default: 0,\r\n      plug: \"input\",\r\n      group: \"Limit\",\r\n      name: \"filterSkip\",\r\n      displayName: \"Skip\",\r\n    });\r\n  }\r\n\r\n  if (parameters.collectionName !== undefined) {\r\n    const c = dbCollections.find((c) => c.name === parameters.collectionName);\r\n    if (c && c.schema && c.schema.properties) {\r\n      const schema = JSON.parse(JSON.stringify(c.schema));\r\n\r\n      const _supportedTypes = {\r\n        Boolean: true,\r\n        String: true,\r\n        Date: true,\r\n        Number: true,\r\n        Pointer: true,\r\n      };\r\n      for (const key in schema.properties) {\r\n        if (!_supportedTypes[schema.properties[key].type]) {\r\n          delete schema.properties[key];\r\n        }\r\n      }\r\n\r\n      ports.push({\r\n        name: \"visualFilter\",\r\n        plug: \"input\",\r\n        type: { name: \"query-filter\", schema: schema, allowEditOnly: true },\r\n        displayName: \"Filter\",\r\n        group: \"Filter\",\r\n      });\r\n\r\n      ports.push({\r\n        name: \"visualSorting\",\r\n        plug: \"input\",\r\n        type: { name: \"query-sorting\", schema: schema, allowEditOnly: true },\r\n        displayName: \"Sorting\",\r\n        group: \"Sorting\",\r\n      });\r\n    }\r\n\r\n    if (parameters.visualFilter !== undefined) {\r\n      // Find all input ports\r\n      const uniqueInputs: Record<string, boolean> = {};\r\n      _collectInputs(uniqueInputs, parameters.visualFilter);\r\n\r\n      Object.keys(uniqueInputs).forEach((input) => {\r\n        ports.push({\r\n          name: \"fp-\" + input,\r\n          plug: \"input\",\r\n          type: \"*\",\r\n          displayName: input,\r\n          group: \"Filter Parameters\",\r\n        });\r\n      });\r\n    }\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  graphModel.on(\"nodeAdded.FilterDBModels\", function (node: any) {\r\n    updatePorts(\r\n      node.id,\r\n      node.parameters,\r\n      // @ts-expect-error\r\n      context.editorConnection,\r\n      graphModel.getMetaData(\"dbCollections\")\r\n    );\r\n\r\n    node.on(\"parameterUpdated\", function () {\r\n      updatePorts(\r\n        node.id,\r\n        node.parameters,\r\n        // @ts-expect-error\r\n        context.editorConnection,\r\n        graphModel.getMetaData(\"dbCollections\")\r\n      );\r\n    });\r\n\r\n    graphModel.on(\"metadataChanged.dbCollections\", function (data: any) {\r\n      CloudStore.invalidateCollections();\r\n      // @ts-expect-error\r\n      updatePorts(node.id, node.parameters, context.editorConnection, data);\r\n    });\r\n\r\n    graphModel.on(\"metadataChanged.systemCollections\", function (data: any) {\r\n      CloudStore.invalidateCollections();\r\n      // @ts-expect-error\r\n      updatePorts(node.id, node.parameters, context.editorConnection, data);\r\n    });\r\n  });\r\n}\r\n\r\ninterface QueryRule {\r\n  rules?: QueryRule[];\r\n  input?: string;\r\n}\r\n\r\nfunction _collectInputs(\r\n  uniqueInputs: Record<string, boolean>,\r\n  query: QueryRule | undefined\r\n) {\r\n  if (query === undefined) {\r\n    return;\r\n  }\r\n\r\n  if (query.rules !== undefined) {\r\n    query.rules.forEach((r: QueryRule) => _collectInputs(uniqueInputs, r));\r\n  } else if (query.input !== undefined) {\r\n    uniqueInputs[query.input] = true;\r\n  }\r\n}\r\n","import { NodeDefinition } from \"../../../nodedefinition\";\r\nimport { NodeContext } from \"../../../nodecontext\";\r\nimport { GraphModel } from \"../../../models/graphmodel\";\r\nimport { Port } from \"../../../models/componentmodel\";\r\nimport { Model } from \"../../../model\";\r\n\r\ninterface Internal {\r\n  inputValues: Record<string, any>;\r\n  dirtyValues: Record<string, any>;\r\n  model?: Model;\r\n  modelId?: string;\r\n  onModelChangedCallback: (args: { name: string }) => void;\r\n}\r\n\r\ninterface Parameters {\r\n  properties?: string;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Model2\",\r\n  docs: \"https://docs.noodl.net/nodes/data/object/object-node\",\r\n  displayNodeName: \"Object\",\r\n  shortDesc:\r\n    \"Stores any amount of properties and can be used standalone or together with Collections and For Each nodes.\",\r\n  category: \"Data\",\r\n  usePortAsLabel: \"modelId\",\r\n  color: \"data\",\r\n  dynamicports: [\r\n    {\r\n      name: \"conditionalports/extended\",\r\n      condition: \"idSource = explicit OR idSource NOT SET\",\r\n      inputs: [\"modelId\"],\r\n    },\r\n  ],\r\n  initialize() {\r\n    const internal = this._internal;\r\n    internal.inputValues = {};\r\n    internal.dirtyValues = {};\r\n\r\n    internal.onModelChangedCallback = (args) => {\r\n      if (this.isInputConnected(\"fetch\") === true) return;\r\n\r\n      if (this.hasOutput(\"prop-\" + args.name))\r\n        this.flagOutputDirty(\"prop-\" + args.name);\r\n\r\n      if (this.hasOutput(\"changed-\" + args.name))\r\n        this.sendSignalOnOutput(\"changed-\" + args.name);\r\n\r\n      this.sendSignalOnOutput(\"changed\");\r\n    };\r\n  },\r\n  getInspectInfo() {\r\n    const model = this._internal.model;\r\n    if (!model) return \"[No Object]\";\r\n\r\n    return [\r\n      { type: \"text\", value: \"Id: \" + model.getId() },\r\n      { type: \"value\", value: model.data },\r\n    ];\r\n  },\r\n  outputs: {\r\n    id: {\r\n      type: \"string\",\r\n      displayName: \"Id\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.model\r\n          ? this._internal.model.getId()\r\n          : this._internal.modelId;\r\n      },\r\n    },\r\n    changed: {\r\n      type: \"signal\",\r\n      displayName: \"Changed\",\r\n      group: \"Events\",\r\n    },\r\n    fetched: {\r\n      type: \"signal\",\r\n      displayName: \"Fetched\",\r\n      group: \"Events\",\r\n    },\r\n  },\r\n  inputs: {\r\n    idSource: {\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"Specify explicitly\", value: \"explicit\" },\r\n          { label: \"From repeater\", value: \"foreach\" },\r\n        ],\r\n        allowEditOnly: true,\r\n      },\r\n      default: \"explicit\",\r\n      displayName: \"Get Id from\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        if (value === \"foreach\") {\r\n          this.scheduleAfterInputsHaveUpdated(() => {\r\n            // Find closest nodescope that have a _forEachModel\r\n            let component = this.nodeScope!.componentOwner;\r\n            while (\r\n              component !== undefined &&\r\n              (component as any)._forEachModel === undefined &&\r\n              component.parentNodeScope\r\n            ) {\r\n              component = component.parentNodeScope.componentOwner;\r\n            }\r\n            // @ts-expect-error\r\n            this.setModel(\r\n              component !== undefined\r\n                ? (component as any)._forEachModel\r\n                : undefined\r\n            );\r\n          });\r\n        }\r\n      },\r\n    },\r\n    modelId: {\r\n      type: {\r\n        name: \"string\",\r\n        identifierOf: \"ModelName\",\r\n        identifierDisplayName: \"Object Ids\",\r\n      },\r\n      displayName: \"Id\",\r\n      group: \"General\",\r\n      set(value: string | Model | Record<string, any>) {\r\n        if (value instanceof Model) value = value.getId();\r\n        // Can be passed as model as well\r\n        else if (typeof value === \"object\") value = Model.create(value).getId(); // If this is an js object, dereference it\r\n\r\n        this._internal.modelId = value; // Wait to fetch data\r\n        // @ts-expect-error\r\n        if (this.isInputConnected(\"fetch\") === false) this.setModelID(value);\r\n        else {\r\n          this.flagOutputDirty(\"id\");\r\n        }\r\n      },\r\n    },\r\n    properties: {\r\n      type: { name: \"stringlist\", allowEditOnly: true },\r\n      displayName: \"Properties\",\r\n      group: \"Properties\",\r\n      set(value: string) {},\r\n    },\r\n    fetch: {\r\n      displayName: \"Fetch\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleSetModel();\r\n      },\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    scheduleStore() {\r\n      if ((this as any).hasScheduledStore) return;\r\n      (this as any).hasScheduledStore = true;\r\n\r\n      const internal = this._internal;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        (this as any).hasScheduledStore = false;\r\n        if (!internal.model) return;\r\n\r\n        for (const i in internal.dirtyValues) {\r\n          internal.model.set(i, internal.inputValues[i], { resolve: true });\r\n        }\r\n        internal.dirtyValues = {}; // Reset dirty values\r\n      });\r\n    },\r\n    scheduleSetModel() {\r\n      if ((this as any).hasScheduledSetModel) return;\r\n      (this as any).hasScheduledSetModel = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        (this as any).hasScheduledSetModel = false;\r\n        // @ts-expect-error\r\n        this.setModelID(this._internal.modelId);\r\n      });\r\n    },\r\n    setModelID(id: string) {\r\n      const model = (this.nodeScope!.modelScope || Model).get(id);\r\n      // @ts-expect-error\r\n      this.setModel(model);\r\n      this.sendSignalOnOutput(\"fetched\");\r\n    },\r\n    setModel(model?: Model) {\r\n      if (this._internal.model)\r\n        // Remove old listener if existing\r\n        this._internal.model.off(\r\n          \"change\",\r\n          this._internal.onModelChangedCallback\r\n        );\r\n\r\n      this._internal.model = model;\r\n      this.flagOutputDirty(\"id\");\r\n\r\n      // In set idSource, we are calling setModel with undefined\r\n      if (model) {\r\n        model.on(\"change\", this._internal.onModelChangedCallback);\r\n\r\n        // We have a new model, mark all outputs as dirty\r\n        for (const key in model.data) {\r\n          if (this.hasOutput(\"prop-\" + key))\r\n            this.flagOutputDirty(\"prop-\" + key);\r\n        }\r\n      }\r\n    },\r\n    _onNodeDeleted() {\r\n      if (this._internal.model)\r\n        this._internal.model.off(\r\n          \"change\",\r\n          this._internal.onModelChangedCallback\r\n        );\r\n    },\r\n    registerOutputIfNeeded(name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"prop-\"))\r\n        this.registerOutput(name, {\r\n          getter: userOutputGetter.bind(this, name.substring(\"prop-\".length)),\r\n        });\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"prop-\"))\r\n        this.registerInput(name, {\r\n          set: userInputSetter.bind(this, name.substring(\"prop-\".length)),\r\n        });\r\n    },\r\n  },\r\n};\r\n\r\nfunction userOutputGetter(this: any, name: string) {\r\n  return this._internal.model\r\n    ? this._internal.model.get(name, { resolve: true })\r\n    : undefined;\r\n}\r\n\r\nfunction userInputSetter(this: any, name: string, value: any) {\r\n  this._internal.inputValues[name] = value;\r\n\r\n  // Store on change if no connection to store or new\r\n  const model = this._internal.model;\r\n  const valueChanged = model ? model.get(name) !== value : true;\r\n  if (valueChanged) {\r\n    this._internal.dirtyValues[name] = true;\r\n    this.scheduleStore();\r\n  }\r\n}\r\n\r\nfunction updatePorts(\r\n  nodeId: string,\r\n  parameters: Parameters,\r\n  editorConnection: any\r\n) {\r\n  const ports: Port[] = [];\r\n\r\n  // Add value outputs\r\n  const properties = parameters.properties;\r\n  if (properties) {\r\n    const propArray = properties ? properties.split(\",\") : undefined;\r\n    if (propArray) {\r\n      for (const p of propArray) {\r\n        ports.push({\r\n          type: {\r\n            name: \"*\",\r\n            allowConnectionsOnly: true,\r\n          },\r\n          plug: \"input/output\",\r\n          group: \"Properties\",\r\n          name: \"prop-\" + p,\r\n          displayName: p,\r\n        });\r\n\r\n        ports.push({\r\n          type: \"signal\",\r\n          plug: \"output\",\r\n          group: \"Changed Events\",\r\n          displayName: p + \" Changed\",\r\n          name: \"changed-\" + p,\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports, {\r\n    detectRenamed: {\r\n      plug: \"input/output\",\r\n    },\r\n  });\r\n}\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  graphModel.on(\"nodeAdded.Model2\", function (node) {\r\n    updatePorts(node.id, node.parameters, context.editorConnection);\r\n\r\n    node.on(\"parameterUpdated\", function () {\r\n      updatePorts(node.id, node.parameters, context.editorConnection);\r\n    });\r\n  });\r\n}\r\n","import { NodeDefinition } from \"../../../nodedefinition\";\r\nimport * as ModelCRUDBase from \"./modelcrudbase\";\r\n\r\nconst SetModelPropertiedNodeDefinition: { node: NodeDefinition } = {\r\n  node: {\r\n    name: \"SetModelProperties\",\r\n    category: \"\",\r\n    docs: \"https://docs.noodl.net/nodes/data/object/set-object-properties\",\r\n    displayNodeName: \"Set Object Properties\",\r\n    inputs: {\r\n      store: {\r\n        displayName: \"Do\",\r\n        group: \"Actions\",\r\n        valueChangedToTrue: function (this: any) {\r\n          this.scheduleStore();\r\n        },\r\n      },\r\n    },\r\n    outputs: {\r\n      stored: {\r\n        type: \"signal\",\r\n        displayName: \"Done\",\r\n        group: \"Events\",\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\nModelCRUDBase.addBaseInfo(SetModelPropertiedNodeDefinition);\r\nModelCRUDBase.addModelId(SetModelPropertiedNodeDefinition);\r\nModelCRUDBase.addInputProperties(SetModelPropertiedNodeDefinition);\r\n\r\nexport const node = SetModelPropertiedNodeDefinition.node;\r\n","import { Model } from \"../../../model\";\r\nimport * as ModelCRUDBase from \"./modelcrudbase\";\r\nimport { NodeDefinition } from \"../../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  hasScheduledNew?: boolean;\r\n  nodeScope: {\r\n    modelScope?: typeof Model;\r\n  };\r\n  _pushInputValues: (model: any) => void;\r\n  setModel: (model: any) => void;\r\n  scheduleAfterInputsHaveUpdated: (callback: () => void) => void;\r\n  sendSignalOnOutput: (name: string) => void;\r\n}\r\n\r\nconst NewModelNodeDefinition: {\r\n  node: NodeDefinition<Internal>;\r\n} = {\r\n  node: {\r\n    name: \"NewModel\",\r\n    category: \"\",\r\n    docs: \"https://docs.noodl.net/nodes/data/object/create-new-object\",\r\n    displayNodeName: \"Create New Object\",\r\n    inputs: {\r\n      new: {\r\n        displayName: \"Do\",\r\n        group: \"Actions\",\r\n        valueChangedToTrue() {\r\n          // @ts-expect-error\r\n          this.scheduleNew();\r\n        },\r\n      },\r\n    },\r\n    outputs: {\r\n      created: {\r\n        type: \"signal\",\r\n        displayName: \"Done\",\r\n        group: \"Events\",\r\n      },\r\n    },\r\n    methods: {\r\n      scheduleNew() {\r\n        // @ts-expect-error\r\n        if (this.hasScheduledNew) return;\r\n        // @ts-expect-error\r\n        this.hasScheduledNew = true;\r\n\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          // @ts-expect-error\r\n          this.hasScheduledNew = false;\r\n          const newModel = (this.nodeScope!.modelScope || Model).get();\r\n\r\n          // @ts-expect-error\r\n          this._pushInputValues(newModel);\r\n\r\n          // @ts-expect-error\r\n          this.setModel(newModel);\r\n\r\n          this.sendSignalOnOutput(\"created\");\r\n        });\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\nModelCRUDBase.addBaseInfo(NewModelNodeDefinition);\r\nModelCRUDBase.addModelId(NewModelNodeDefinition, { includeOutputs: true });\r\nModelCRUDBase.addInputProperties(NewModelNodeDefinition);\r\n\r\nexport const node = NewModelNodeDefinition.node;\r\n","import { CloudFile } from \"../../../api/cloudfile\";\r\nimport { NodeDefinition } from \"../../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  cloudFile?: CloudFile;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Cloud File\",\r\n  docs: \"https://docs.noodl.net/nodes/data/cloud-data/cloud-file\",\r\n  category: \"Cloud Services\",\r\n  color: \"data\",\r\n  getInspectInfo(): string | undefined {\r\n    return this._internal.cloudFile?.getUrl();\r\n  },\r\n  outputs: {\r\n    url: {\r\n      type: \"string\",\r\n      displayName: \"URL\",\r\n      group: \"General\",\r\n      getter(): string | undefined {\r\n        return this._internal.cloudFile?.getUrl();\r\n      },\r\n    },\r\n    name: {\r\n      type: \"string\",\r\n      displayName: \"Name\",\r\n      group: \"General\",\r\n      getter(): string | undefined {\r\n        if (!this._internal.cloudFile) return undefined;\r\n\r\n        //parse prefixes the file with a guid_\r\n        //remove it so the name is the same as the original file name\r\n        const n = this._internal.cloudFile.getName().split(\"_\");\r\n        return n.length === 1 ? n[0] : n.slice(1).join(\"_\");\r\n      },\r\n    },\r\n  },\r\n  inputs: {\r\n    file: {\r\n      type: \"cloudfile\",\r\n      displayName: \"Cloud File\",\r\n      group: \"General\",\r\n      set(value: unknown): void {\r\n        if (!(value instanceof CloudFile)) {\r\n          return;\r\n        }\r\n        this._internal.cloudFile = value;\r\n        this.flagOutputDirty(\"name\");\r\n        this.flagOutputDirty(\"url\");\r\n      },\r\n    },\r\n  },\r\n};\r\n","import NoodlRuntime from \"../runtime\";\r\n\r\ninterface RequestOptions {\r\n  success: (data: any) => void;\r\n  error: (error: any) => void;\r\n}\r\n\r\ninterface CloudServices {\r\n  appId: string;\r\n  endpoint: string;\r\n  masterKey?: string;\r\n}\r\n\r\ndeclare const _noodl_cloud_runtime_version: string | undefined;\r\ndeclare const _noodl_cloudservices: CloudServices | undefined;\r\n\r\nexport class ConfigService {\r\n  private cacheDuration: number;\r\n  private configCache?: Record<string, any>;\r\n  private configCachePending?: Promise<Record<string, any>>;\r\n  private ttl?: number;\r\n  private endpoint?: string;\r\n  private appId?: string;\r\n\r\n  constructor() {\r\n    this.cacheDuration = 15 * 60 * 1000; // 15 min cache\r\n  }\r\n\r\n  private _makeRequest(path: string, options: RequestOptions): void {\r\n    if (typeof _noodl_cloud_runtime_version === \"undefined\") {\r\n      // Running in browser\r\n      const xhr = new XMLHttpRequest();\r\n\r\n      xhr.onreadystatechange = function () {\r\n        if (xhr.readyState === 4) {\r\n          let json;\r\n          try {\r\n            json = JSON.parse(xhr.response);\r\n          } catch (e) {}\r\n\r\n          if (xhr.status === 200 || xhr.status === 201) {\r\n            options.success(json);\r\n          } else\r\n            options.error(\r\n              json || { error: xhr.responseText, status: xhr.status }\r\n            );\r\n        }\r\n      };\r\n\r\n      const cloudServices = NoodlRuntime.instance.getMetaData(\r\n        \"cloudservices\"\r\n      ) as CloudServices;\r\n      const appId = cloudServices.appId;\r\n      const endpoint = cloudServices.endpoint;\r\n      xhr.open(\"GET\", endpoint + path, true);\r\n\r\n      xhr.setRequestHeader(\"X-Parse-Application-Id\", appId);\r\n\r\n      xhr.send();\r\n    } else {\r\n      // Running in cloud runtime\r\n      const endpoint =\r\n        typeof _noodl_cloudservices !== \"undefined\"\r\n          ? _noodl_cloudservices.endpoint\r\n          : this.endpoint;\r\n      const appId =\r\n        typeof _noodl_cloudservices !== \"undefined\"\r\n          ? _noodl_cloudservices.appId\r\n          : this.appId;\r\n      const masterKey =\r\n        typeof _noodl_cloudservices !== \"undefined\"\r\n          ? _noodl_cloudservices.masterKey\r\n          : undefined;\r\n\r\n      fetch(endpoint + path, {\r\n        method: \"GET\",\r\n        // @ts-expect-error\r\n        headers: {\r\n          \"X-Parse-Application-Id\": appId,\r\n          \"X-Parse-Master-Key\": masterKey,\r\n        },\r\n      })\r\n        .then((r) => {\r\n          if (r.status === 200 || r.status === 201) {\r\n            r.json()\r\n              .then((json) => options.success(json))\r\n              .catch((e) =>\r\n                options.error({\r\n                  error: \"Config: Failed to get json result.\",\r\n                })\r\n              );\r\n          } else {\r\n            r.json()\r\n              .then((json) => options.error(json))\r\n              .catch((e) => options.error({ error: \"Failed to fetch.\" }));\r\n          }\r\n        })\r\n        .catch((e) => {\r\n          options.error({ error: e.message });\r\n        });\r\n    }\r\n  }\r\n\r\n  private _getConfig(): Promise<Record<string, any>> {\r\n    return new Promise((resolve, reject) => {\r\n      this._makeRequest(\"/config\", {\r\n        success: (config) => {\r\n          resolve(config.params || {});\r\n        },\r\n        error: (err) => {\r\n          reject(err);\r\n        },\r\n      });\r\n    });\r\n  }\r\n\r\n  async getConfig(): Promise<Record<string, any>> {\r\n    if (this.configCachePending) return this.configCachePending;\r\n\r\n    if (!this.configCache) {\r\n      this.configCachePending = this._getConfig();\r\n\r\n      this.configCache = await this.configCachePending;\r\n      delete this.configCachePending;\r\n      this.ttl = Date.now() + this.cacheDuration;\r\n      return this.configCache;\r\n    } else {\r\n      // Update cache if ttl has passed\r\n      if (this.ttl && Date.now() > this.ttl) {\r\n        this._getConfig().then((config) => {\r\n          this.configCache = config;\r\n          this.ttl = Date.now() + this.cacheDuration;\r\n        });\r\n      }\r\n\r\n      // But return currently cached\r\n      return this.configCache;\r\n    }\r\n  }\r\n\r\n  clearCache(): void {\r\n    delete this.configCache;\r\n  }\r\n\r\n  static instance = new ConfigService();\r\n}\r\n","import { ConfigService } from \"../../../api/configservice\";\r\n\r\ninterface ConfigNodeDefinition {\r\n  name: string;\r\n  docs: string;\r\n  displayNodeName: string;\r\n  category: string;\r\n  usePortAsLabel: string;\r\n  color: string;\r\n  initialize: () => void;\r\n  getInspectInfo: () => string | { type: string; value: any }[];\r\n  inputs?: Record<string, any>;\r\n  outputs?: Record<string, any>;\r\n  methods: {\r\n    getValue: () => any;\r\n    setInternal: (key: string, value: any) => void;\r\n    registerOutputIfNeeded: (name: string) => void;\r\n    registerInputIfNeeded: (name: string) => void;\r\n  };\r\n}\r\n\r\ninterface ConfigNode {\r\n  _internal: {\r\n    config?: Record<string, any>;\r\n    configKey?: string;\r\n    useDevValue?: boolean;\r\n    devValue?: any;\r\n  };\r\n  context: {\r\n    editorConnection?: {\r\n      isRunningLocally: () => boolean;\r\n    };\r\n  };\r\n  hasOutput: (name: string) => boolean;\r\n  flagOutputDirty: (name: string) => void;\r\n  hasInput: (name: string) => boolean;\r\n  registerOutput: (name: string, options: { getter: () => any }) => void;\r\n  registerInput: (name: string, options: { set: (value: any) => void }) => void;\r\n}\r\n\r\nconst ConfigNodeDefinition: ConfigNodeDefinition = {\r\n  name: \"DbConfig\",\r\n  docs: \"https://docs.noodl.net/nodes/data/cloud-data/config\",\r\n  displayNodeName: \"Config\",\r\n  category: \"Cloud Services\",\r\n  usePortAsLabel: \"configKey\",\r\n  color: \"data\",\r\n  initialize: function (this: ConfigNode) {\r\n    const internal = this._internal;\r\n\r\n    ConfigService.instance.getConfig().then((config) => {\r\n      internal.config = config;\r\n      if (this.hasOutput(\"value\")) this.flagOutputDirty(\"value\");\r\n    });\r\n  },\r\n  getInspectInfo() {\r\n    // @ts-expect-error\r\n    const value = this.getValue();\r\n\r\n    if (value === undefined) return \"[No Value]\";\r\n\r\n    return [{ type: \"value\", value: value }];\r\n  },\r\n  methods: {\r\n    getValue: function (this: ConfigNode) {\r\n      const internal = this._internal;\r\n      if (\r\n        internal.useDevValue &&\r\n        this.context.editorConnection &&\r\n        this.context.editorConnection.isRunningLocally()\r\n      ) {\r\n        return internal.devValue;\r\n      } else if (\r\n        internal.config !== undefined &&\r\n        internal.configKey !== undefined\r\n      ) {\r\n        return internal.config[internal.configKey];\r\n      }\r\n    },\r\n    setInternal: function (this: ConfigNode, key: string, value: any) {\r\n      this._internal[key] = value;\r\n      if (this.hasOutput(\"value\")) this.flagOutputDirty(\"value\");\r\n    },\r\n    registerOutputIfNeeded: function (this: ConfigNode, name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === \"value\")\r\n        return this.registerOutput(name, {\r\n          // @ts-expect-error\r\n          getter: this.getValue.bind(this),\r\n        });\r\n    },\r\n    registerInputIfNeeded: function (this: ConfigNode, name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === \"configKey\" || name === \"useDevValue\" || name === \"devValue\")\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setInternal.bind(this, name),\r\n        });\r\n    },\r\n  },\r\n};\r\n\r\ninterface GraphModel {\r\n  getMetaData: (key: string) => any;\r\n  getNodesWithType: (type: string) => any[];\r\n  on: (event: string, callback: (data?: any) => void) => void;\r\n}\r\n\r\ninterface SetupContext {\r\n  editorConnection?: {\r\n    isRunningLocally: () => boolean;\r\n    clearWarning: (componentName: string, id: string, type: string) => void;\r\n    sendWarning: (\r\n      componentName: string,\r\n      id: string,\r\n      type: string,\r\n      options: { showGlobally: boolean; message: string }\r\n    ) => void;\r\n    sendDynamicPorts: (id: string, ports: any[]) => void;\r\n  };\r\n}\r\n\r\nexport const node = ConfigNodeDefinition;\r\nexport function setup(context: SetupContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function updatePorts(node: any) {\r\n    const ports: any[] = [];\r\n\r\n    context.editorConnection!.clearWarning(\r\n      node.component.name,\r\n      node.id,\r\n      \"dbconfig-warning\"\r\n    );\r\n\r\n    const configSchema = graphModel.getMetaData(\"dbConfigSchema\");\r\n    let valueType;\r\n\r\n    if (configSchema) {\r\n      const isCloud =\r\n        typeof (global as any)._noodl_cloud_runtime_version !== \"undefined\";\r\n      ports.push({\r\n        name: \"configKey\",\r\n        displayName: \"Parameter\",\r\n        group: \"General\",\r\n        type: {\r\n          name: \"enum\",\r\n          enums: Object.keys(configSchema)\r\n            .filter((k) => isCloud || !configSchema[k].masterKeyOnly)\r\n            .map((k) => ({ value: k, label: k })),\r\n          allowEditOnly: true,\r\n        },\r\n        plug: \"input\",\r\n      });\r\n\r\n      if (\r\n        node.parameters[\"configKey\"] !== undefined &&\r\n        configSchema &&\r\n        configSchema[node.parameters[\"configKey\"]]\r\n      ) {\r\n        valueType = configSchema[node.parameters[\"configKey\"]].type;\r\n\r\n        if (\r\n          valueType === \"string\" ||\r\n          valueType === \"boolean\" ||\r\n          valueType === \"number\" ||\r\n          valueType === \"object\" ||\r\n          valueType === \"array\"\r\n        ) {\r\n          ports.push({\r\n            name: \"useDevValue\",\r\n            displayName: \"Enable\",\r\n            group: \"Local Override\",\r\n            type: \"boolean\",\r\n            default: false,\r\n            plug: \"input\",\r\n          });\r\n\r\n          if (node.parameters[\"useDevValue\"] === true) {\r\n            ports.push({\r\n              name: \"devValue\",\r\n              displayName: \"Value\",\r\n              group: \"Local Override\",\r\n              type: valueType,\r\n              plug: \"input\",\r\n            });\r\n          }\r\n        }\r\n      } else if (node.parameters[\"configKey\"] !== undefined) {\r\n        context.editorConnection!.sendWarning(\r\n          node.component.name,\r\n          node.id,\r\n          \"dbconfig-warning\",\r\n          {\r\n            showGlobally: true,\r\n            message:\r\n              node.parameters[\"configKey\"] +\r\n              \" config parameter is missing, add it to your cloud service.\",\r\n          }\r\n        );\r\n      }\r\n    } else {\r\n      context.editorConnection!.sendWarning(\r\n        node.component.name,\r\n        node.id,\r\n        \"dbconfig-warning\",\r\n        {\r\n          showGlobally: true,\r\n          message: \"You need an active cloud service.\",\r\n        }\r\n      );\r\n    }\r\n\r\n    ports.push({\r\n      name: \"value\",\r\n      displayName: \"Value\",\r\n      group: \"General\",\r\n      type: valueType || \"*\",\r\n      plug: \"output\",\r\n    });\r\n\r\n    context.editorConnection!.sendDynamicPorts(node.id, ports);\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    updatePorts(node);\r\n\r\n    node.on(\"parameterUpdated\", function () {\r\n      updatePorts(node);\r\n    });\r\n\r\n    graphModel.on(\"metadataChanged.dbConfigSchema\", function () {\r\n      ConfigService.instance.clearCache();\r\n      updatePorts(node);\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.DbConfig\", function (node) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"DbConfig\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","import { NodeDefinition } from \"../../../nodedefinition\";\r\n\r\ninterface NodeArgs {\r\n  name: string;\r\n  docs?: string;\r\n  shortDesc?: string;\r\n  nodeDoubleClickAction?:\r\n    | string\r\n    | {\r\n        focusPort: string;\r\n      };\r\n  type: { name: string };\r\n  startValue: any;\r\n  cast: (value: any) => any;\r\n  onChanged?: () => void;\r\n}\r\n\r\nexport interface Internal {\r\n  currentValue: any;\r\n  latestValue: any;\r\n}\r\n\r\nexport function createDefinition(args: NodeArgs): NodeDefinition<Internal> {\r\n  return {\r\n    name: args.name,\r\n    docs: args.docs,\r\n    shortDesc: args.shortDesc,\r\n    nodeDoubleClickAction: args.nodeDoubleClickAction,\r\n    category: \"Variables\",\r\n    initialize() {\r\n      this._internal.currentValue = args.startValue;\r\n      this._internal.latestValue = 0;\r\n    },\r\n    getInspectInfo() {\r\n      const type = args.type.name === \"color\" ? \"color\" : \"text\";\r\n      return [{ type, value: this._internal.currentValue }];\r\n    },\r\n    inputs: {\r\n      value: {\r\n        type: args.type,\r\n        displayName: \"Value\",\r\n        default: args.startValue,\r\n        set(value: any) {\r\n          if (this.isInputConnected(\"saveValue\") === false) {\r\n            // @ts-expect-error\r\n            this.setValueTo(value);\r\n          } else {\r\n            this._internal.latestValue = value;\r\n          }\r\n        },\r\n      },\r\n      saveValue: {\r\n        displayName: \"Set\",\r\n        valueChangedToTrue() {\r\n          this.scheduleAfterInputsHaveUpdated(function () {\r\n            // @ts-expect-error\r\n            this.setValueTo(this._internal.latestValue);\r\n            this.sendSignalOnOutput(\"stored\");\r\n          });\r\n        },\r\n      },\r\n    },\r\n    outputs: {\r\n      savedValue: {\r\n        type: args.type.name,\r\n        displayName: \"Value\",\r\n        getter() {\r\n          return this._internal.currentValue;\r\n        },\r\n      },\r\n      changed: {\r\n        type: \"signal\",\r\n        displayName: \"Changed\",\r\n      },\r\n      stored: {\r\n        type: \"signal\",\r\n        displayName: \"Stored\",\r\n      },\r\n    },\r\n    prototypeExtensions: {\r\n      setValueTo(value: any) {\r\n        value = args.cast(value);\r\n        const changed = this._internal.currentValue !== value;\r\n        this._internal.currentValue = value;\r\n\r\n        if (changed) {\r\n          this.flagOutputDirty(\"savedValue\");\r\n          this.sendSignalOnOutput(\"changed\");\r\n          args.onChanged && args.onChanged.call(this);\r\n        }\r\n      },\r\n    },\r\n  };\r\n}\r\n","import { createDefinition } from \"./variablebase\";\r\n\r\nexport const node = createDefinition({\r\n  name: \"Number\",\r\n  docs: \"https://docs.noodl.net/nodes/data/number\",\r\n  startValue: 0,\r\n  nodeDoubleClickAction: {\r\n    focusPort: \"value\",\r\n  },\r\n  type: {\r\n    name: \"number\",\r\n  },\r\n  cast(value: any): number {\r\n    return Number(value);\r\n  },\r\n});\r\n","import { extend } from \"../../../nodedefinition\";\r\nimport { createDefinition } from \"./variablebase\";\r\n\r\ninterface NodeInstance {\r\n  _internal: {\r\n    currentValue: string;\r\n  };\r\n  flagOutputDirty: (name: string) => void;\r\n}\r\n\r\nconst StringNode = createDefinition({\r\n  name: \"String\",\r\n  docs: \"https://docs.noodl.net/nodes/data/string\",\r\n  shortDesc: \"Contains a string (text).\",\r\n  startValue: \"\",\r\n  nodeDoubleClickAction: {\r\n    focusPort: \"value\",\r\n  },\r\n  type: {\r\n    name: \"string\",\r\n  },\r\n  cast(value: any): string {\r\n    return String(value);\r\n  },\r\n  onChanged: function (this: NodeInstance) {\r\n    this.flagOutputDirty(\"length\");\r\n  },\r\n});\r\n\r\nextend(StringNode, {\r\n  usePortAsLabel: \"value\",\r\n  portLabelTruncationMode: \"length\",\r\n  outputs: {\r\n    length: {\r\n      type: \"number\",\r\n      displayName: \"Length\",\r\n      getter: function (this: NodeInstance): number {\r\n        return this._internal.currentValue.length;\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nexport const node = StringNode;\r\n","import { createDefinition } from \"./variablebase\";\r\n\r\nexport const node = createDefinition({\r\n  name: \"Boolean\",\r\n  docs: \"https://docs.noodl.net/nodes/data/boolean\",\r\n  startValue: false,\r\n  type: {\r\n    name: \"boolean\",\r\n  },\r\n  cast(value: any): boolean {\r\n    return Boolean(value);\r\n  },\r\n});\r\n","import type { NodeDefinition } from \"../../nodedefinition\";\r\n\r\ninterface Internal {}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Condition\",\r\n  docs: \"https://docs.noodl.net/nodes/utilities/logic/condition\",\r\n  category: \"Logic\",\r\n  initialize() {},\r\n  getInspectInfo() {\r\n    const condition = this.getInputValue(\"condition\");\r\n    let value: unknown;\r\n    if (condition === undefined) {\r\n      value = \"[No input]\";\r\n    } else {\r\n      value = condition;\r\n    }\r\n    return [\r\n      {\r\n        type: \"value\",\r\n        value,\r\n      },\r\n    ];\r\n  },\r\n  inputs: {\r\n    condition: {\r\n      type: \"boolean\",\r\n      displayName: \"Condition\",\r\n      group: \"General\",\r\n      set(_value: boolean) {\r\n        if (!this.isInputConnected(\"eval\")) {\r\n          // Evaluate right away\r\n          // @ts-expect-error\r\n          this.scheduleEvaluate();\r\n        }\r\n      },\r\n    },\r\n    eval: {\r\n      type: \"signal\",\r\n      displayName: \"Evaluate\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleEvaluate();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    ontrue: {\r\n      type: \"signal\",\r\n      displayName: \"On True\",\r\n      group: \"Events\",\r\n    },\r\n    onfalse: {\r\n      type: \"signal\",\r\n      displayName: \"On False\",\r\n      group: \"Events\",\r\n    },\r\n    result: {\r\n      type: \"boolean\",\r\n      displayName: \"Is True\",\r\n      group: \"Booleans\",\r\n      getter() {\r\n        return !!this.getInputValue(\"condition\");\r\n      },\r\n    },\r\n    isfalse: {\r\n      type: \"boolean\",\r\n      displayName: \"Is False\",\r\n      group: \"Booleans\",\r\n      getter() {\r\n        return !this.getInputValue(\"condition\");\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    scheduleEvaluate() {\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        this.flagOutputDirty(\"result\");\r\n        this.flagOutputDirty(\"isfalse\");\r\n\r\n        const condition = this.getInputValue(\"condition\");\r\n        this.sendSignalOnOutput(condition ? \"ontrue\" : \"onfalse\");\r\n      });\r\n    },\r\n  },\r\n};\r\n","import type { NodeDefinition } from \"../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  inputs: boolean[];\r\n  result?: boolean;\r\n}\r\n\r\nfunction and(values: boolean[]): boolean {\r\n  //if none are false, then return true\r\n  return values.length > 0 && values.some((v) => !v) === false;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"And\",\r\n  docs: \"https://docs.noodl.net/nodes/logic/and\",\r\n  category: \"Logic\",\r\n  initialize() {\r\n    this._internal = {\r\n      inputs: [],\r\n    };\r\n  },\r\n  getInspectInfo() {\r\n    return and(this._internal.inputs);\r\n  },\r\n  numberedInputs: {\r\n    input: {\r\n      displayPrefix: \"Input\",\r\n      type: \"boolean\",\r\n      createSetter(index: number) {\r\n        return function (\r\n          this: {\r\n            _internal: Internal;\r\n            flagOutputDirty: (name: string) => void;\r\n          },\r\n          value: unknown\r\n        ) {\r\n          const boolValue = value ? true : false;\r\n\r\n          if (this._internal.inputs[index] === boolValue) {\r\n            return;\r\n          }\r\n\r\n          this._internal.inputs[index] = boolValue;\r\n          const result = and(this._internal.inputs);\r\n\r\n          if (this._internal.result !== result) {\r\n            this._internal.result = result;\r\n            this.flagOutputDirty(\"result\");\r\n          }\r\n        };\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    result: {\r\n      type: \"boolean\",\r\n      displayName: \"Result\",\r\n      get() {\r\n        return this._internal.result;\r\n      },\r\n    },\r\n  },\r\n};\r\n","import type { NodeDefinition } from \"../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  inputs: boolean[];\r\n}\r\n\r\nfunction isTrue(value: boolean): boolean {\r\n  return value ? true : false;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Or\",\r\n  docs: \"https://docs.noodl.net/nodes/logic/or\",\r\n  category: \"Logic\",\r\n  initialize() {\r\n    this._internal.inputs = [];\r\n  },\r\n  getInspectInfo(): boolean {\r\n    return this._internal.inputs.some(isTrue);\r\n  },\r\n  numberedInputs: {\r\n    input: {\r\n      type: \"boolean\",\r\n      displayPrefix: \"Input\",\r\n      createSetter(index: number) {\r\n        return function (value: boolean): void {\r\n          if (this._internal.inputs[index] === value) {\r\n            return;\r\n          }\r\n\r\n          this._internal.inputs[index] = value;\r\n          this.flagOutputDirty(\"result\");\r\n        };\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    result: {\r\n      type: \"boolean\",\r\n      displayName: \"Result\",\r\n      getter: function (): boolean {\r\n        return this._internal.inputs.some(isTrue);\r\n      },\r\n    },\r\n  },\r\n};\r\n","import type { NodeDefinition } from \"../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  inputs: any[];\r\n  currentSelectedIndex: number;\r\n  indexChanged: boolean;\r\n  trueString: string;\r\n  falseString: string;\r\n  currentInput?: boolean;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Boolean To String\",\r\n  docs: \"https://docs.noodl.net/nodes/utilities/boolean-to-string\",\r\n  category: \"Utilities\",\r\n  initialize() {\r\n    this._internal.inputs = [];\r\n    this._internal.currentSelectedIndex = 0;\r\n    this._internal.indexChanged = false;\r\n\r\n    this._internal.trueString = \"\";\r\n    this._internal.falseString = \"\";\r\n  },\r\n  inputs: {\r\n    trueString: {\r\n      displayName: \"String for true\",\r\n      type: \"string\",\r\n      set(value: string) {\r\n        if (this._internal.trueString === value) return;\r\n        this._internal.trueString = value;\r\n\r\n        if (this._internal.currentInput) {\r\n          this.flagOutputDirty(\"currentValue\");\r\n        }\r\n      },\r\n    },\r\n    falseString: {\r\n      displayName: \"String for false\",\r\n      type: \"string\",\r\n      set(value: string) {\r\n        if (this._internal.falseString === value) return;\r\n        this._internal.falseString = value;\r\n\r\n        if (!this._internal.currentInput) {\r\n          this.flagOutputDirty(\"currentValue\");\r\n        }\r\n      },\r\n    },\r\n    input: {\r\n      type: { name: \"boolean\" },\r\n      displayName: \"Selector\",\r\n      set(value: boolean) {\r\n        if (this._internal.currentInput === value) return;\r\n\r\n        this._internal.currentInput = value;\r\n        this.flagOutputDirty(\"currentValue\");\r\n        this.sendSignalOnOutput(\"inputChanged\");\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    currentValue: {\r\n      type: \"string\",\r\n      displayName: \"Current Value\",\r\n      group: \"Value\",\r\n      getter(): string {\r\n        return this._internal.currentInput\r\n          ? this._internal.trueString\r\n          : this._internal.falseString;\r\n      },\r\n    },\r\n    inputChanged: {\r\n      type: \"signal\",\r\n      displayName: \"Selector Changed\",\r\n      group: \"Signals\",\r\n    },\r\n  },\r\n};\r\n","import type { NodeDefinition } from \"../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  formatString: string;\r\n  currentInput?: Date;\r\n  dateString?: string;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Date To String\",\r\n  docs: \"https://docs.noodl.net/nodes/utilities/date-to-string\",\r\n  category: \"Utilities\",\r\n  initialize() {\r\n    this._internal.formatString = \"{year}-{month}-{date}\";\r\n  },\r\n  inputs: {\r\n    formatString: {\r\n      displayName: \"Format\",\r\n      type: \"string\",\r\n      default: \"{year}-{month}-{date}\",\r\n      set(value: string) {\r\n        if (this._internal.formatString === value) return;\r\n        this._internal.formatString = value;\r\n\r\n        if (this._internal.currentInput !== undefined) {\r\n          // @ts-expect-error\r\n          this._format();\r\n          this.flagOutputDirty(\"currentValue\");\r\n        }\r\n      },\r\n    },\r\n    input: {\r\n      type: {\r\n        name: \"date\",\r\n      },\r\n      displayName: \"Date\",\r\n      set(value: Date | string) {\r\n        const _value = typeof value === \"string\" ? new Date(value) : value;\r\n        if (this._internal.currentInput === _value) return;\r\n\r\n        this._internal.currentInput = _value;\r\n        // @ts-expect-error\r\n        this._format();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    currentValue: {\r\n      type: \"string\",\r\n      displayName: \"Date String\",\r\n      group: \"Value\",\r\n      getter() {\r\n        return this._internal.dateString;\r\n      },\r\n    },\r\n    inputChanged: {\r\n      type: \"signal\",\r\n      displayName: \"Date Changed\",\r\n      group: \"Signals\",\r\n    },\r\n    onError: {\r\n      type: \"signal\",\r\n      displayName: \"Invalid Date\",\r\n      group: \"Signals\",\r\n    },\r\n  },\r\n  methods: {\r\n    _format() {\r\n      try {\r\n        const t = this._internal.currentInput!;\r\n        const format = this._internal.formatString;\r\n        const date = (\"0\" + t.getDate()).slice(-2);\r\n        const month = (\"0\" + (t.getMonth() + 1)).slice(-2);\r\n        const monthShort = new Intl.DateTimeFormat(\"en-US\", {\r\n          month: \"short\",\r\n        }).format(t);\r\n        const year = t.getFullYear();\r\n        const yearShort = year.toString().substring(2);\r\n        const hours = (\"0\" + t.getHours()).slice(-2);\r\n        const minutes = (\"0\" + t.getMinutes()).slice(-2);\r\n        const seconds = (\"0\" + t.getSeconds()).slice(-2);\r\n\r\n        this._internal.dateString = format\r\n          .replace(/\\{date\\}/g, date)\r\n          .replace(/\\{month\\}/g, String(month))\r\n          .replace(/\\{monthShort\\}/g, monthShort)\r\n          .replace(/\\{year\\}/g, String(year))\r\n          .replace(/\\{yearShort\\}/g, String(yearShort))\r\n          .replace(/\\{hours\\}/g, String(hours))\r\n          .replace(/\\{minutes\\}/g, String(minutes))\r\n          .replace(/\\{seconds\\}/g, String(seconds));\r\n      } catch (error) {\r\n        // Set the output to be blank, makes it easier to handle.\r\n        this._internal.dateString = \"\";\r\n        this.flagOutputDirty(\"onError\");\r\n      }\r\n\r\n      // Flag that the value have changed\r\n      this.flagOutputDirty(\"currentValue\");\r\n      this.sendSignalOnOutput(\"inputChanged\");\r\n    },\r\n  },\r\n};\r\n","import type { NodeDefinition } from \"../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  inputs: string[];\r\n  mappings: string[];\r\n  currentInputString?: string;\r\n  defaultMapping?: string;\r\n  mappedString?: string;\r\n  hasScheduledFetch?: boolean;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"String Mapper\",\r\n  docs: \"https://docs.noodl.net/nodes/string-manipulation/string-mapper\",\r\n  category: \"Utilities\",\r\n  initialize() {\r\n    this._internal = {\r\n      inputs: [],\r\n      mappings: [],\r\n    };\r\n  },\r\n  getInspectInfo() {\r\n    return this._internal.mappedString;\r\n  },\r\n  numberedInputs: {\r\n    input: {\r\n      type: \"string\",\r\n      displayPrefix: \"Input\",\r\n      group: \"Inputs\",\r\n      index: 10,\r\n      createSetter(index: number) {\r\n        return function (value: string) {\r\n          value = value === undefined ? \"\" : String(value);\r\n          this._internal.inputs[index] = value;\r\n          // @ts-expect-error\r\n          this.scheduleMapping();\r\n        };\r\n      },\r\n    },\r\n    output: {\r\n      type: \"string\",\r\n      displayPrefix: \"Mapping\",\r\n      index: 1001,\r\n      group: \"Mappings\",\r\n      createSetter(index: number) {\r\n        return function (value: string) {\r\n          value = value === undefined ? \"\" : String(value);\r\n          this._internal.mappings[index] = value;\r\n          // @ts-expect-error\r\n          this.scheduleMapping();\r\n        };\r\n      },\r\n    },\r\n  },\r\n  inputs: {\r\n    inputString: {\r\n      type: {\r\n        name: \"string\",\r\n      },\r\n      index: 1,\r\n      displayName: \"Input String\",\r\n      set(value: unknown) {\r\n        this._internal.currentInputString =\r\n          value !== undefined ? String(value) : undefined;\r\n        // @ts-expect-error\r\n        this.scheduleMapping();\r\n      },\r\n    },\r\n    defaultMapping: {\r\n      type: \"string\",\r\n      displayName: \"Default\",\r\n      index: 1000,\r\n      group: \"Mappings\",\r\n      set(value: string) {\r\n        this._internal.defaultMapping = value;\r\n        // @ts-expect-error\r\n        this.scheduleMapping();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    mappedString: {\r\n      type: \"string\",\r\n      displayName: \"Mapped String\",\r\n      group: \"Value\",\r\n      getter() {\r\n        return this._internal.mappedString;\r\n      },\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    doMapping() {\r\n      this._internal.hasScheduledFetch = false;\r\n      const idx = this._internal.inputs.indexOf(\r\n        this._internal.currentInputString!\r\n      );\r\n      if (idx !== -1)\r\n        this._internal.mappedString = this._internal.mappings[idx];\r\n      else this._internal.mappedString = this._internal.defaultMapping;\r\n\r\n      this.flagOutputDirty(\"mappedString\");\r\n    },\r\n    scheduleMapping() {\r\n      const internal = this._internal;\r\n      if (!internal.hasScheduledFetch) {\r\n        internal.hasScheduledFetch = true;\r\n        // @ts-expect-error\r\n        this.scheduleAfterInputsHaveUpdated(this.doMapping.bind(this));\r\n      }\r\n    },\r\n  },\r\n};\r\n","import type { NodeDefinition } from \"../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  currentValue?: boolean;\r\n}\r\n\r\nfunction invert(value?: boolean): boolean | undefined {\r\n  if (value === undefined) {\r\n    return undefined;\r\n  }\r\n  return !value;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Inverter\",\r\n  docs: \"https://docs.noodl.net/nodes/logic/inverter\",\r\n  category: \"Logic\",\r\n  initialize() {\r\n    this._internal.currentValue = undefined;\r\n  },\r\n  getInspectInfo() {\r\n    return String(invert(this._internal.currentValue));\r\n  },\r\n  inputs: {\r\n    value: {\r\n      type: {\r\n        name: \"boolean\",\r\n      },\r\n      displayName: \"Value\",\r\n      set(value: boolean) {\r\n        this._internal.currentValue = value;\r\n        this.flagOutputDirty(\"result\");\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    result: {\r\n      type: \"boolean\",\r\n      displayName: \"Result\",\r\n      getter() {\r\n        return invert(this._internal.currentValue);\r\n      },\r\n    },\r\n  },\r\n};\r\n","import type { NodeDefinition } from \"../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  startIndex: number;\r\n  endIndex: number;\r\n  cachedResult: string;\r\n  inputString: string;\r\n  resultDirty: boolean;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Substring\",\r\n  docs: \"https://docs.noodl.net/nodes/string-manipulation/substring\",\r\n  category: \"String Manipulation\",\r\n  initialize() {\r\n    var internal = this._internal;\r\n    internal.startIndex = 0;\r\n    internal.endIndex = -1;\r\n    internal.cachedResult = \"\";\r\n    internal.inputString = \"\";\r\n    internal.resultDirty = false;\r\n  },\r\n  inputs: {\r\n    start: {\r\n      type: \"number\",\r\n      displayName: \"Start\",\r\n      default: 0,\r\n      set(value: number) {\r\n        this._internal.startIndex = value;\r\n        this._internal.resultDirty = true;\r\n        this.flagOutputDirty(\"result\");\r\n      },\r\n    },\r\n    end: {\r\n      type: \"number\",\r\n      displayName: \"End\",\r\n      default: 0,\r\n      set(value: number) {\r\n        this._internal.endIndex = value;\r\n        this._internal.resultDirty = true;\r\n        this.flagOutputDirty(\"result\");\r\n      },\r\n    },\r\n    string: {\r\n      type: {\r\n        name: \"string\",\r\n      },\r\n      displayName: \"String\",\r\n      default: \"\",\r\n      set(value: unknown) {\r\n        const stringValue = String(value);\r\n        this._internal.inputString = stringValue;\r\n        this._internal.resultDirty = true;\r\n        this.flagOutputDirty(\"result\");\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    result: {\r\n      type: \"string\",\r\n      displayName: \"Result\",\r\n      getter() {\r\n        var internal = this._internal;\r\n\r\n        if (internal.resultDirty) {\r\n          if (internal.endIndex === -1) {\r\n            internal.cachedResult = internal.inputString.substr(\r\n              internal.startIndex\r\n            );\r\n          } else {\r\n            internal.cachedResult = internal.inputString.substr(\r\n              internal.startIndex,\r\n              internal.endIndex - internal.startIndex\r\n            );\r\n          }\r\n          internal.resultDirty = false;\r\n        }\r\n        return internal.cachedResult;\r\n      },\r\n    },\r\n  },\r\n};\r\n","import { NodeDefinition } from \"../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  format: string;\r\n  cachedResult: string;\r\n  resultDirty: boolean;\r\n  inputValues: Record<string, any>;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"String Format\",\r\n  docs: \"https://docs.noodl.net/nodes/string-manipulation/string-format\",\r\n  category: \"String Manipulation\",\r\n  usePortAsLabel: \"format\",\r\n  portLabelTruncationMode: \"length\" as const,\r\n  initialize() {\r\n    const internal = this._internal;\r\n    internal.format = \"\";\r\n    internal.cachedResult = \"\";\r\n    internal.resultDirty = false;\r\n    internal.inputValues = {};\r\n  },\r\n  getInspectInfo() {\r\n    // @ts-expect-error\r\n    return this.formatValue();\r\n  },\r\n  inputs: {\r\n    format: {\r\n      type: { name: \"string\", multiline: true },\r\n      displayName: \"Format\",\r\n      set(value: string): void {\r\n        if (this._internal.format === value) return;\r\n\r\n        this._internal.format = value;\r\n        this._internal.resultDirty = true;\r\n        // @ts-expect-error\r\n        this.scheduleFormat();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    formatted: {\r\n      type: \"string\",\r\n      displayName: \"Formatted\",\r\n      get() {\r\n        // @ts-expect-error\r\n        return this.formatValue();\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    formatValue(): string {\r\n      const internal = this._internal;\r\n\r\n      if (internal.resultDirty) {\r\n        let formatted = internal.format;\r\n\r\n        const matches = internal.format.match(/\\{[A-Za-z0-9_]*\\}/g);\r\n        let inputs: string[] = [];\r\n        if (matches) {\r\n          inputs = matches.map((name) => {\r\n            return name.replace(\"{\", \"\").replace(\"}\", \"\");\r\n          });\r\n        }\r\n\r\n        inputs.forEach((name) => {\r\n          const v = internal.inputValues[name];\r\n          formatted = formatted.replace(\r\n            \"{\" + name + \"}\",\r\n            v !== undefined ? v : \"\"\r\n          );\r\n        });\r\n\r\n        internal.cachedResult = formatted;\r\n        internal.resultDirty = false;\r\n      }\r\n\r\n      return internal.cachedResult;\r\n    },\r\n    registerInputIfNeeded(name: string): void {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      this.registerInput(name, {\r\n        set(value) {\r\n          if (this._internal.inputValues[name] === value) return;\r\n\r\n          this._internal.inputValues[name] = value;\r\n          this._internal.resultDirty = true;\r\n          // @ts-expect-error\r\n          this.scheduleFormat();\r\n        },\r\n      });\r\n    },\r\n    scheduleFormat(): void {\r\n      // @ts-expect-error\r\n      if (this.formatScheduled) return;\r\n\r\n      // @ts-expect-error\r\n      this.formatScheduled = true;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.formatValue();\r\n        this.flagOutputDirty(\"formatted\");\r\n        // @ts-expect-error\r\n        this.formatScheduled = false;\r\n      });\r\n    },\r\n  },\r\n};\r\n\r\ninterface EditorConnection {\r\n  isRunningLocally: () => boolean;\r\n  sendDynamicPorts: (id: string, ports: Port[]) => void;\r\n}\r\n\r\ninterface Port {\r\n  name: string;\r\n  type: string;\r\n  plug: string;\r\n}\r\n\r\ninterface GraphNode {\r\n  id: string;\r\n  parameters: {\r\n    format?: string;\r\n  };\r\n  on: (event: string, callback: (event: any) => void) => void;\r\n}\r\n\r\ninterface GraphModel {\r\n  on: (event: string, callback: (node: GraphNode) => void) => void;\r\n}\r\n\r\ninterface Context {\r\n  editorConnection?: EditorConnection;\r\n}\r\n\r\nfunction updatePorts(\r\n  id: string,\r\n  format: string,\r\n  editorConnection: EditorConnection\r\n): void {\r\n  const inputs = format.match(/\\{[A-Za-z0-9_]*\\}/g) || [];\r\n  const portsNames = inputs.map((def) => {\r\n    return def.replace(\"{\", \"\").replace(\"}\", \"\");\r\n  });\r\n\r\n  const ports = portsNames\r\n    //get unique names\r\n    .filter((value, index, self) => {\r\n      return self.indexOf(value) === index;\r\n    })\r\n    //and map names to ports\r\n    .map((name) => {\r\n      return {\r\n        name: name,\r\n        type: \"string\",\r\n        plug: \"input\",\r\n      };\r\n    });\r\n\r\n  editorConnection.sendDynamicPorts(id, ports);\r\n}\r\n\r\nexport function setup(context: Context, graphModel: GraphModel): void {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  graphModel.on(\"nodeAdded.String Format\", (node: GraphNode) => {\r\n    if (node.parameters.format) {\r\n      updatePorts(node.id, node.parameters.format, context.editorConnection!);\r\n    }\r\n    node.on(\"parameterUpdated\", (event: { name: string }) => {\r\n      if (event.name === \"format\") {\r\n        updatePorts(\r\n          node.id,\r\n          node.parameters.format!,\r\n          context.editorConnection!\r\n        );\r\n      }\r\n    });\r\n  });\r\n}\r\n","import type { NodeDefinition } from \"../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  currentValue: number;\r\n  startValue: number;\r\n  startValueSet: boolean;\r\n  limitsEnabled: boolean;\r\n  limitsMin: number;\r\n  limitsMax: number;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Counter\",\r\n  docs: \"https://docs.noodl.net/nodes/math/counter\",\r\n  category: \"Math\",\r\n  initialize() {\r\n    this._internal.currentValue = 0;\r\n    this._internal.startValue = 0;\r\n    this._internal.startValueSet = false;\r\n\r\n    this._internal.limitsEnabled = false;\r\n    this._internal.limitsMin = 0;\r\n    this._internal.limitsMax = 0;\r\n  },\r\n  getInspectInfo() {\r\n    return \"Count: \" + this._internal.currentValue;\r\n  },\r\n  inputs: {\r\n    increase: {\r\n      group: \"Actions\",\r\n      displayName: \"Increase Count\",\r\n      valueChangedToTrue() {\r\n        if (\r\n          this._internal.limitsEnabled &&\r\n          this._internal.currentValue >= this._internal.limitsMax\r\n        ) {\r\n          return;\r\n        }\r\n\r\n        this._internal.currentValue++;\r\n        this.flagOutputDirty(\"currentCount\");\r\n        this.sendSignalOnOutput(\"countChanged\");\r\n      },\r\n    },\r\n    decrease: {\r\n      group: \"Actions\",\r\n      displayName: \"Decrease Count\",\r\n      valueChangedToTrue() {\r\n        if (\r\n          this._internal.limitsEnabled &&\r\n          this._internal.currentValue <= this._internal.limitsMin\r\n        ) {\r\n          return;\r\n        }\r\n\r\n        this._internal.currentValue--;\r\n        this.flagOutputDirty(\"currentCount\");\r\n        this.sendSignalOnOutput(\"countChanged\");\r\n      },\r\n    },\r\n    reset: {\r\n      group: \"Actions\",\r\n      displayName: \"Reset To Start\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        if (this.currentValue === 0) {\r\n          return;\r\n        }\r\n        this._internal.currentValue = this._internal.startValue;\r\n        this.flagOutputDirty(\"currentCount\");\r\n        this.sendSignalOnOutput(\"countChanged\");\r\n      },\r\n    },\r\n    startValue: {\r\n      type: \"number\",\r\n      displayName: \"Start Value\",\r\n      default: 0,\r\n      set(value: number) {\r\n        this._internal.startValue = Number(value);\r\n\r\n        if (this._internal.startValueSet === false) {\r\n          this._internal.startValueSet = true;\r\n          this._internal.currentValue = this._internal.startValue;\r\n          this.flagOutputDirty(\"currentCount\");\r\n          this.sendSignalOnOutput(\"countChanged\");\r\n        }\r\n      },\r\n    },\r\n    limitsMin: {\r\n      type: {\r\n        name: \"number\",\r\n      },\r\n      displayName: \"Min Value\",\r\n      group: \"Limits\",\r\n      default: 0,\r\n      set(value: number) {\r\n        this._internal.limitsMin = Number(value);\r\n      },\r\n    },\r\n    limitsMax: {\r\n      type: {\r\n        name: \"number\",\r\n      },\r\n      displayName: \"Max Value\",\r\n      group: \"Limits\",\r\n      default: 0,\r\n      set(value: number) {\r\n        this._internal.limitsMax = Number(value);\r\n      },\r\n    },\r\n    limitsEnabled: {\r\n      type: {\r\n        name: \"boolean\",\r\n      },\r\n      displayName: \"Limits Enabled\",\r\n      group: \"Limits\",\r\n      default: false,\r\n      set(value: boolean) {\r\n        this._internal.limitsEnabled = value ? true : false;\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    currentCount: {\r\n      displayName: \"Current Count\",\r\n      type: \"number\",\r\n      getter() {\r\n        return this._internal.currentValue;\r\n      },\r\n    },\r\n    countChanged: {\r\n      displayName: \"Count Changed\",\r\n      type: \"signal\",\r\n    },\r\n  },\r\n};\r\n","import { NodeDefinition } from \"../../nodedefinition\";\r\nimport { guid } from \"../../utils\";\r\n\r\ninterface Internal {\r\n  guid: string;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Unique Id\",\r\n  docs: \"https://docs.noodl.net/nodes/utilities/unique-id\",\r\n  category: \"String Manipulation\",\r\n  initialize() {\r\n    const internal = this._internal;\r\n    internal.guid = guid();\r\n  },\r\n  getInspectInfo() {\r\n    return this._internal.guid;\r\n  },\r\n  inputs: {\r\n    new: {\r\n      displayName: \"New\",\r\n      valueChangedToTrue: function () {\r\n        const internal = this._internal;\r\n        internal.guid = guid();\r\n        this.flagOutputDirty(\"guid\");\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    guid: {\r\n      type: \"string\",\r\n      displayName: \"Id\",\r\n      getter: function () {\r\n        const internal = this._internal;\r\n        return internal.guid;\r\n      },\r\n    },\r\n  },\r\n  prototypeExtensions: {},\r\n};\r\n","import type { NodeContext } from \"../../../nodecontext\";\r\nimport type { GraphModel } from \"../../../models/graphmodel\";\r\nimport type { Port } from \"../../../models/componentmodel\";\r\nimport { NodeDefinition } from \"../../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  userProperties: { [key: string]: any };\r\n  error?: string;\r\n  email?: string;\r\n  username?: string;\r\n}\r\n\r\ninterface SchemaProperty {\r\n  type: string;\r\n}\r\n\r\ninterface Collection {\r\n  name: string;\r\n  schema?: {\r\n    properties: {\r\n      [key: string]: SchemaProperty;\r\n    };\r\n  };\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"net.noodl.user.SetUserProperties\",\r\n  docs: \"https://docs.noodl.net/nodes/data/user/set-user-properties\",\r\n  displayNodeName: \"Set User Properties\",\r\n  category: \"Cloud Services\",\r\n  color: \"data\",\r\n  initialize() {\r\n    const internal = this._internal;\r\n    internal.userProperties = {};\r\n  },\r\n  outputs: {\r\n    success: {\r\n      type: \"signal\",\r\n      displayName: \"Success\",\r\n      group: \"Events\",\r\n    },\r\n    failure: {\r\n      type: \"signal\",\r\n      displayName: \"Failure\",\r\n      group: \"Events\",\r\n    },\r\n    error: {\r\n      type: \"string\",\r\n      displayName: \"Error\",\r\n      group: \"Error\",\r\n      getter() {\r\n        return this._internal.error;\r\n      },\r\n    },\r\n  },\r\n  inputs: {\r\n    store: {\r\n      displayName: \"Do\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleStore();\r\n      },\r\n    },\r\n    email: {\r\n      displayName: \"Email\",\r\n      type: \"string\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        this._internal.email = value;\r\n      },\r\n    },\r\n    username: {\r\n      displayName: \"Username\",\r\n      type: \"string\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        this._internal.username = value;\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    setError(err: string) {\r\n      this._internal.error = err;\r\n      this.flagOutputDirty(\"error\");\r\n      this.sendSignalOnOutput(\"failure\");\r\n\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.sendWarning(\r\n          this.nodeScope!.componentOwner.name,\r\n          this.id,\r\n          \"user-set-warning\",\r\n          {\r\n            message: err,\r\n            showGlobally: true,\r\n          }\r\n        );\r\n      }\r\n    },\r\n    clearWarnings() {\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.clearWarning(\r\n          this.nodeScope!.componentOwner.name,\r\n          this.id,\r\n          \"user-set-warning\"\r\n        );\r\n      }\r\n    },\r\n    scheduleStore() {\r\n      const internal = this._internal;\r\n\r\n      // @ts-expect-error\r\n      if (this.storeScheduled === true) return;\r\n      // @ts-expect-error\r\n      this.storeScheduled = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.storeScheduled = false;\r\n\r\n        // @ts-expect-error\r\n        const UserService = NoodlRuntime.Services.UserService;\r\n        UserService.forScope(this.nodeScope!.modelScope).setUserProperties({\r\n          email: this._internal.email,\r\n          username: this._internal.username,\r\n          properties: internal.userProperties,\r\n          success: () => {\r\n            this.sendSignalOnOutput(\"success\");\r\n          },\r\n          error: (e: string) => {\r\n            // @ts-expect-error\r\n            this.setError(e);\r\n          },\r\n        });\r\n      });\r\n    },\r\n    setUserProperty(name: string, value: any) {\r\n      this._internal.userProperties[name] = value;\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"prop-\"))\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setUserProperty.bind(this, name.substring(\"prop-\".length)),\r\n        });\r\n    },\r\n  },\r\n};\r\n\r\nfunction updatePorts(\r\n  nodeId: string,\r\n  parameters: any,\r\n  editorConnection: any,\r\n  systemCollections: Collection[]\r\n) {\r\n  const ports: Port[] = [];\r\n\r\n  if (systemCollections) {\r\n    // Fetch ports from collection keys\r\n    const c = systemCollections.find((c) => c.name === \"_User\");\r\n    if (c && c.schema && c.schema.properties) {\r\n      const props = c.schema.properties;\r\n\r\n      const _ignoreKeys =\r\n        // @ts-expect-error\r\n        typeof _noodl_cloud_runtime_version === \"undefined\"\r\n          ? [\r\n              \"authData\",\r\n              \"createdAt\",\r\n              \"updatedAt\",\r\n              \"email\",\r\n              \"username\",\r\n              \"emailVerified\",\r\n              \"password\",\r\n            ]\r\n          : [\"authData\", \"createdAt\", \"updatedAt\", \"email\", \"username\"];\r\n\r\n      for (const key in props) {\r\n        if (_ignoreKeys.indexOf(key) !== -1) continue;\r\n\r\n        const p = props[key];\r\n        if (ports.find((_p) => _p.name === key)) continue;\r\n\r\n        if (p.type === \"Relation\") {\r\n        } else {\r\n          // Other schema type ports\r\n          const _typeMap: { [key: string]: string } = {\r\n            String: \"string\",\r\n            Boolean: \"boolean\",\r\n            Number: \"number\",\r\n            Date: \"date\",\r\n          };\r\n\r\n          ports.push({\r\n            type: {\r\n              name: _typeMap[p.type] ? _typeMap[p.type] : \"*\",\r\n            },\r\n            plug: \"input\",\r\n            group: \"Properties\",\r\n            name: \"prop-\" + key,\r\n            displayName: key,\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    updatePorts(\r\n      node.id,\r\n      node.parameters,\r\n      context.editorConnection,\r\n      graphModel.getMetaData(\"systemCollections\")\r\n    );\r\n\r\n    node.on(\"parameterUpdated\", function (event: any) {\r\n      updatePorts(\r\n        node.id,\r\n        node.parameters,\r\n        context.editorConnection,\r\n        graphModel.getMetaData(\"systemCollections\")\r\n      );\r\n    });\r\n\r\n    graphModel.on(\"metadataChanged.systemCollections\", function (data: any) {\r\n      updatePorts(node.id, node.parameters, context.editorConnection, data);\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\r\n      \"nodeAdded.net.noodl.user.SetUserProperties\",\r\n      function (node: any) {\r\n        _managePortsForNode(node);\r\n      }\r\n    );\r\n\r\n    for (const node of graphModel.getNodesWithType(\r\n      \"net.noodl.user.SetUserProperties\"\r\n    )) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","import type { GraphModel } from \"../../../models/graphmodel\";\r\nimport { Node } from \"../../../node\";\r\nimport type { NodeContext } from \"../../../nodecontext\";\r\nimport { NodeDefinition } from \"../../../nodedefinition\";\r\n\r\ninterface Internal {\r\n  onModelChangedCallback?: (args: { name: string }) => void;\r\n  model?: any;\r\n  error?: string;\r\n  [key: string]: any;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"net.noodl.user.User\",\r\n  docs: \"https://docs.noodl.net/nodes/data/user/user-node\",\r\n  displayNodeName: \"User\",\r\n  category: \"Cloud Services\",\r\n  color: \"data\",\r\n  initialize() {\r\n    const _this = this;\r\n    this._internal.onModelChangedCallback = function (args) {\r\n      if (_this.isInputConnected(\"fetch\")) return;\r\n\r\n      if (_this.hasOutput(\"prop-\" + args.name))\r\n        _this.flagOutputDirty(\"prop-\" + args.name);\r\n\r\n      if (_this.hasOutput(\"changed-\" + args.name))\r\n        _this.sendSignalOnOutput(\"changed-\" + args.name);\r\n\r\n      _this.sendSignalOnOutput(\"changed\");\r\n    };\r\n\r\n    // @ts-expect-error\r\n    const userService = NoodlRuntime.Services.UserService.forScope(\r\n      // @ts-expect-error\r\n      this.nodeScope.modelScope\r\n    );\r\n\r\n    // @ts-expect-error\r\n    this.setUserModel(userService.current);\r\n    userService.on(\"loggedIn\", () => {\r\n      // @ts-expect-error\r\n      this.setUserModel(userService.current);\r\n\r\n      if (this.hasOutput(\"loggedIn\")) this.sendSignalOnOutput(\"loggedIn\");\r\n    });\r\n\r\n    userService.on(\"sessionGained\", () => {\r\n      // @ts-expect-error\r\n      this.setUserModel(userService.current);\r\n    });\r\n\r\n    userService.on(\"loggedOut\", () => {\r\n      // @ts-expect-error\r\n      this.setUserModel(undefined);\r\n      if (this.hasOutput(\"loggedOut\")) this.sendSignalOnOutput(\"loggedOut\");\r\n    });\r\n\r\n    userService.on(\"sessionLost\", () => {\r\n      // @ts-expect-error\r\n      this.setUserModel(undefined);\r\n      if (this.hasOutput(\"sessionLost\")) this.sendSignalOnOutput(\"sessionLost\");\r\n    });\r\n  },\r\n  getInspectInfo() {\r\n    const model = this._internal.model;\r\n    if (!model) return \"[No Model]\";\r\n\r\n    return [\r\n      { type: \"text\", value: \"Id: \" + model.getId() },\r\n      { type: \"value\", value: this._internal.model.data },\r\n    ];\r\n  },\r\n  outputs: {\r\n    id: {\r\n      type: \"string\",\r\n      displayName: \"Id\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.model !== undefined\r\n          ? this._internal.model.getId()\r\n          : undefined;\r\n      },\r\n    },\r\n    fetched: {\r\n      type: \"signal\",\r\n      displayName: \"Fetched\",\r\n      group: \"Events\",\r\n    },\r\n    changed: {\r\n      type: \"signal\",\r\n      displayName: \"Changed\",\r\n      group: \"Events\",\r\n    },\r\n    failure: {\r\n      type: \"signal\",\r\n      displayName: \"Failure\",\r\n      group: \"Events\",\r\n    },\r\n    error: {\r\n      type: \"string\",\r\n      displayName: \"Error\",\r\n      group: \"Error\",\r\n      getter() {\r\n        return this._internal.error;\r\n      },\r\n    },\r\n    username: {\r\n      type: \"string\",\r\n      displayName: \"Username\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.model !== undefined\r\n          ? this._internal.model.get(\"username\")\r\n          : undefined;\r\n      },\r\n    },\r\n    email: {\r\n      type: \"string\",\r\n      displayName: \"Email\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.model !== undefined\r\n          ? this._internal.model.get(\"email\")\r\n          : undefined;\r\n      },\r\n    },\r\n    authenticated: {\r\n      type: \"boolean\",\r\n      displayName: \"Authenticated\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.model !== undefined;\r\n      },\r\n    },\r\n  },\r\n  inputs: {\r\n    fetch: {\r\n      displayName: \"Fetch\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleFetch();\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    _onNodeDeleted() {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      if (this._internal.model)\r\n        this._internal.model.off(\r\n          \"change\",\r\n          this._internal.onModelChangedCallback\r\n        );\r\n    },\r\n    scheduleOnce(type: string, cb: () => void) {\r\n      const _this = this;\r\n      const _type = \"hasScheduled\" + type;\r\n      if (this._internal[_type]) return;\r\n      this._internal[_type] = true;\r\n      this.scheduleAfterInputsHaveUpdated(function () {\r\n        _this._internal[_type] = false;\r\n        cb();\r\n      });\r\n    },\r\n    setError(err: string) {\r\n      this._internal.error = err;\r\n      this.flagOutputDirty(\"error\");\r\n      this.sendSignalOnOutput(\"failure\");\r\n\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.sendWarning(\r\n          this.nodeScope!.componentOwner.name,\r\n          this.id,\r\n          \"user-warning\",\r\n          {\r\n            message: err,\r\n            showGlobally: true,\r\n          }\r\n        );\r\n      }\r\n    },\r\n    clearWarnings() {\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.clearWarning(\r\n          this.nodeScope!.componentOwner.name,\r\n          this.id,\r\n          \"user-warning\"\r\n        );\r\n      }\r\n    },\r\n    setUserModel(model: any) {\r\n      const internal = this._internal;\r\n\r\n      if (internal.model !== model) {\r\n        // Check if we need to change model\r\n        if (internal.model)\r\n          // Remove old listener if existing\r\n          internal.model.off(\"change\", internal.onModelChangedCallback);\r\n\r\n        internal.model = model;\r\n        if (model) model.on(\"change\", internal.onModelChangedCallback);\r\n      }\r\n      this.flagOutputDirty(\"id\");\r\n      this.flagOutputDirty(\"authenticated\");\r\n      this.flagOutputDirty(\"email\");\r\n      this.flagOutputDirty(\"username\");\r\n\r\n      // Notify all properties changed\r\n      if (model)\r\n        for (const key in model.data) {\r\n          if (this.hasOutput(\"prop-\" + key))\r\n            this.flagOutputDirty(\"prop-\" + key);\r\n        }\r\n    },\r\n    scheduleFetch() {\r\n      const internal = this._internal;\r\n\r\n      // @ts-expect-error\r\n      this.scheduleOnce(\"Fetch\", () => {\r\n        // @ts-expect-error\r\n        const userService = NoodlRuntime.Services.UserService.forScope(\r\n          this.nodeScope!.modelScope\r\n        );\r\n        userService.fetchCurrentUser({\r\n          success: (response: any) => {\r\n            // @ts-expect-error\r\n            this.setUserModel(userService.current);\r\n\r\n            this.sendSignalOnOutput(\"fetched\");\r\n          },\r\n          error: (err: string) => {\r\n            // @ts-expect-error\r\n            this.setError(err || \"Failed to fetch.\");\r\n          },\r\n        });\r\n      });\r\n    },\r\n    registerOutputIfNeeded(name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (\r\n        name === \"loggedOut\" ||\r\n        name === \"loggedIn\" ||\r\n        name === \"sessionLost\"\r\n      ) {\r\n        this.registerOutput(name, {\r\n          getter: () => {} /* No getter needed, signal */,\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"prop-\"))\r\n        this.registerOutput(name, {\r\n          // @ts-expect-error\r\n          getter: this.getUserProperty.bind(\r\n            this,\r\n            name.substring(\"prop-\".length)\r\n          ),\r\n        });\r\n    },\r\n    getUserProperty(name: string) {\r\n      return this._internal.model !== undefined\r\n        ? this._internal.model.get(name)\r\n        : undefined;\r\n    },\r\n  },\r\n};\r\n\r\ninterface Port {\r\n  type:\r\n    | {\r\n        name: string;\r\n      }\r\n    | string;\r\n  plug: string;\r\n  group: string;\r\n  name: string;\r\n  displayName: string;\r\n}\r\n\r\ninterface SchemaProperty {\r\n  type: string;\r\n}\r\n\r\ninterface Collection {\r\n  name: string;\r\n  schema?: {\r\n    properties: {\r\n      [key: string]: SchemaProperty;\r\n    };\r\n  };\r\n}\r\n\r\nfunction updatePorts(\r\n  nodeId: string,\r\n  parameters: any,\r\n  editorConnection: any,\r\n  systemCollections: Collection[]\r\n) {\r\n  const ports: Port[] = [];\r\n\r\n  if (systemCollections) {\r\n    // Fetch ports from collection keys\r\n    const c = systemCollections.find((c) => c.name === \"_User\");\r\n    if (c && c.schema && c.schema.properties) {\r\n      const props = c.schema.properties;\r\n      const _ignoreKeys = [\"authData\", \"password\", \"username\", \"email\"];\r\n      for (const key in props) {\r\n        if (_ignoreKeys.indexOf(key) !== -1) continue;\r\n\r\n        const p = props[key];\r\n        if (ports.find((_p) => _p.name === key)) continue;\r\n\r\n        if (p.type === \"Relation\") {\r\n        } else {\r\n          // Other schema type ports\r\n          const _typeMap: { [key: string]: string } = {\r\n            String: \"string\",\r\n            Boolean: \"boolean\",\r\n            Number: \"number\",\r\n            Date: \"date\",\r\n          };\r\n\r\n          ports.push({\r\n            type: {\r\n              name: _typeMap[p.type] ? _typeMap[p.type] : \"*\",\r\n            },\r\n            plug: \"output\",\r\n            group: \"Properties\",\r\n            name: \"prop-\" + key,\r\n            displayName: key,\r\n          });\r\n\r\n          ports.push({\r\n            type: \"signal\",\r\n            plug: \"output\",\r\n            group: \"Changed Events\",\r\n            displayName: key + \" Changed\",\r\n            name: \"changed-\" + key,\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  // @ts-expect-error\r\n  if (typeof _noodl_cloud_runtime_version === \"undefined\") {\r\n    // On the client we have some extra outputs\r\n    ports.push({\r\n      plug: \"output\",\r\n      name: \"loggedIn\",\r\n      type: \"signal\",\r\n      displayName: \"Logged In\",\r\n      group: \"Events\",\r\n    });\r\n\r\n    ports.push({\r\n      plug: \"output\",\r\n      name: \"loggedOut\",\r\n      type: \"signal\",\r\n      displayName: \"Logged Out\",\r\n      group: \"Events\",\r\n    });\r\n\r\n    ports.push({\r\n      plug: \"output\",\r\n      name: \"sessionLost\",\r\n      type: \"signal\",\r\n      displayName: \"Session Lost\",\r\n      group: \"Events\",\r\n    });\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    updatePorts(\r\n      node.id,\r\n      node.parameters,\r\n      context.editorConnection,\r\n      graphModel.getMetaData(\"systemCollections\")\r\n    );\r\n\r\n    node.on(\"parameterUpdated\", function (event: any) {\r\n      updatePorts(\r\n        node.id,\r\n        node.parameters,\r\n        context.editorConnection,\r\n        graphModel.getMetaData(\"systemCollections\")\r\n      );\r\n    });\r\n\r\n    graphModel.on(\"metadataChanged.systemCollections\", function (data: any) {\r\n      updatePorts(node.id, node.parameters, context.editorConnection, data);\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.net.noodl.user.User\", function (node: any) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"net.noodl.user.User\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","import { NodeContext } from \"./nodecontext\";\r\nimport { EditorConnection, Platform } from \"./editorconnection\";\r\nimport { generateNodeLibrary } from \"./nodelibraryexport\";\r\nimport { Module, generateProjectSettings } from \"./projectsettings\";\r\nimport { GraphModel } from \"./models/graphmodel\";\r\nimport { Node } from \"./node\";\r\nimport { handleEvent } from \"./editormodeleventshandler\";\r\nimport { Services } from \"./services\";\r\nimport { createSetter } from \"./edgetriggeredinput\";\r\nimport { EventEmitter } from \"eventemitter3\";\r\nimport { asyncPool } from \"./async-pool\";\r\nimport { defineNode, NodeDefinition } from \"./nodedefinition\";\r\nimport { registerNodes } from \"./runtime.nodes\";\r\n\r\ninterface RuntimeArgs {\r\n  type?: string;\r\n  platform: Platform;\r\n  runDeployed?: boolean;\r\n  dontCreateRootComponent?: boolean;\r\n  componentFilter?: (component: any) => boolean;\r\n  editorConnection?: any;\r\n}\r\n\r\n/**\r\n * Defines a node which contains a node definition and a setup function.\r\n */\r\nexport type NodeModule<TInternal extends Record<string, any> = {}> = {\r\n  node: NodeDefinition<TInternal>;\r\n  setup?: (context: NodeContext, graphModel: GraphModel) => void;\r\n};\r\n\r\nexport default class NoodlRuntime {\r\n  static instance: NoodlRuntime;\r\n  static Services = Services;\r\n  static Node = Node;\r\n  static NodeDefinition = { defineNode };\r\n  static EdgeTriggeredInput = createSetter;\r\n\r\n  private type: string;\r\n  private noodlModules: Module[];\r\n  eventEmitter: EventEmitter;\r\n  private updateScheduled: boolean;\r\n  rootComponent: any;\r\n  private _currentLoadedData: any;\r\n  private isWaitingForExport: boolean;\r\n  graphModel: GraphModel;\r\n  private errorHandlers: ((message: string) => void)[];\r\n  private frameNumber: number;\r\n  private dontCreateRootComponent: boolean;\r\n  private componentFilter?: (component: any) => boolean;\r\n  private runningInEditor: boolean;\r\n  private platform: Platform;\r\n  editorConnection: EditorConnection;\r\n  context: NodeContext;\r\n  private projectSettings?: any;\r\n  private lastSentNodeLibrary?: string;\r\n  private _disableLoad?: boolean;\r\n\r\n  constructor(args: RuntimeArgs) {\r\n    args.platform = args.platform || {};\r\n    NoodlRuntime.instance = this;\r\n\r\n    this.type = args.type || \"browser\";\r\n    this.noodlModules = [];\r\n    this.eventEmitter = new EventEmitter();\r\n    this.updateScheduled = false;\r\n    this.rootComponent = null;\r\n    this._currentLoadedData = null;\r\n    this.isWaitingForExport = true;\r\n    this.graphModel = new GraphModel();\r\n    this.errorHandlers = [];\r\n    this.frameNumber = 0;\r\n    this.dontCreateRootComponent = !!args.dontCreateRootComponent;\r\n    this.componentFilter = args.componentFilter;\r\n\r\n    this.runningInEditor = args.runDeployed ? false : true;\r\n\r\n    this.platform = {\r\n      requestUpdate: args.platform.requestUpdate,\r\n      getCurrentTime: args.platform.getCurrentTime,\r\n      webSocketOptions: args.platform.webSocketOptions,\r\n      objectToString: args.platform.objectToString,\r\n    };\r\n\r\n    if (!args.platform.requestUpdate) {\r\n      throw new Error(\"platform.requestUpdate must be set\");\r\n    }\r\n\r\n    if (!args.platform.getCurrentTime) {\r\n      throw new Error(\"platform.getCurrentTime must be set\");\r\n    }\r\n\r\n    this.editorConnection = new EditorConnection({\r\n      platform: args.platform,\r\n      runtimeType: this.type,\r\n    });\r\n\r\n    this.context = new NodeContext({\r\n      runningInEditor: args.runDeployed ? false : true,\r\n      editorConnection: this.editorConnection,\r\n      platform: this.platform,\r\n      graphModel: this.graphModel,\r\n    });\r\n\r\n    this.context.eventEmitter.on(\r\n      \"scheduleUpdate\",\r\n      this.scheduleUpdate.bind(this)\r\n    );\r\n\r\n    if (!args.runDeployed) {\r\n      this._setupEditorCommunication(args);\r\n    }\r\n\r\n    this.registerGraphModelListeners();\r\n\r\n    registerNodes(this);\r\n  }\r\n\r\n  async prefetchBundles(\r\n    bundleNames: string[],\r\n    numParallelFetches: number\r\n  ): Promise<void> {\r\n    await asyncPool(numParallelFetches, bundleNames, async (name) => {\r\n      await this.context.fetchComponentBundle(name);\r\n    });\r\n  }\r\n\r\n  private _setupEditorCommunication(args: RuntimeArgs): void {\r\n    function objectEquals(x: any, y: any): boolean {\r\n      if (x === null || x === undefined || y === null || y === undefined) {\r\n        return x === y;\r\n      }\r\n      if (x === y) {\r\n        return true;\r\n      }\r\n      if (Array.isArray(x) && x.length !== y.length) {\r\n        return false;\r\n      }\r\n\r\n      if (!(x instanceof Object)) {\r\n        return false;\r\n      }\r\n      if (!(y instanceof Object)) {\r\n        return false;\r\n      }\r\n\r\n      const p = Object.keys(x);\r\n      return (\r\n        Object.keys(y).every((i) => p.indexOf(i) !== -1) &&\r\n        p.every((i) => objectEquals(x[i], y[i]))\r\n      );\r\n    }\r\n\r\n    this.editorConnection.on(\"exportDataFull\", async (exportData: any) => {\r\n      if (this.graphModel.isEmpty() === false) {\r\n        this.reload();\r\n        return;\r\n      }\r\n\r\n      this.isWaitingForExport = false;\r\n      if (objectEquals(this._currentLoadedData, exportData) === false) {\r\n        if (this.componentFilter) {\r\n          exportData.components = exportData.components.filter((c: any) =>\r\n            this.componentFilter!(c)\r\n          );\r\n        }\r\n\r\n        await this.setData(exportData);\r\n\r\n        if (exportData.componentIndex) {\r\n          const allBundles = Object.keys(exportData.componentIndex);\r\n          await this.prefetchBundles(allBundles, 2);\r\n        }\r\n\r\n        this.graphModel.emit(\"editorImportComplete\");\r\n      }\r\n    });\r\n\r\n    this.editorConnection.on(\"reload\", this.reload.bind(this));\r\n    this.editorConnection.on(\r\n      \"modelUpdate\",\r\n      this.onModelUpdateReceived.bind(this)\r\n    );\r\n    this.editorConnection.on(\r\n      \"metadataUpdate\",\r\n      this.onMetaDataUpdateReceived.bind(this)\r\n    );\r\n\r\n    this.editorConnection.on(\"connected\", () => {\r\n      this.sendNodeLibrary();\r\n    });\r\n  }\r\n\r\n  setDebugInspectorsEnabled(enabled: boolean): void {\r\n    this.context.setDebugInspectorsEnabled(enabled);\r\n  }\r\n\r\n  registerModule(module: Module): void {\r\n    if (module.nodes) {\r\n      for (let nodeDefinition of module.nodes) {\r\n        if (!nodeDefinition.node) nodeDefinition = { node: nodeDefinition };\r\n        nodeDefinition.node.module = module.name || \"Unknown Module\";\r\n        this.registerNode(nodeDefinition);\r\n      }\r\n    }\r\n\r\n    this.noodlModules.push(module);\r\n  }\r\n\r\n  private registerGraphModelListeners(): void {\r\n    this.graphModel.on(\r\n      \"componentAdded\",\r\n      (component: any) => {\r\n        this.context.registerComponentModel(component);\r\n      },\r\n      this\r\n    );\r\n\r\n    this.graphModel.on(\r\n      \"componentRemoved\",\r\n      (component: any) => {\r\n        this.context.deregisterComponentModel(component);\r\n      },\r\n      this\r\n    );\r\n  }\r\n\r\n  reload(): void {\r\n    location.reload();\r\n  }\r\n\r\n  registerNode(nodeDefinition: NodeModule): void {\r\n    if (nodeDefinition.node) {\r\n      const definedNode = defineNode(nodeDefinition.node);\r\n      this.context.nodeRegister.register(definedNode);\r\n\r\n      definedNode.setupNumberedInputDynamicPorts &&\r\n        definedNode.setupNumberedInputDynamicPorts(\r\n          this.context,\r\n          this.graphModel\r\n        );\r\n    } else {\r\n      // TODO: Should this just be nodeDefinition?\r\n      this.context.nodeRegister.register(nodeDefinition.node);\r\n    }\r\n\r\n    nodeDefinition.setup && nodeDefinition.setup(this.context, this.graphModel);\r\n  }\r\n\r\n  private async _setRootComponent(\r\n    rootComponentName: string | null\r\n  ): Promise<void> {\r\n    if (this.rootComponent && this.rootComponent.name === rootComponentName)\r\n      return;\r\n\r\n    if (this.rootComponent) {\r\n      this.rootComponent.model &&\r\n        this.rootComponent.model.removeListenersWithRef(this);\r\n      this.rootComponent = undefined;\r\n    }\r\n\r\n    if (rootComponentName) {\r\n      this.rootComponent = await this.context.createComponentInstanceNode(\r\n        rootComponentName,\r\n        \"rootComponent\",\r\n        null\r\n      );\r\n\r\n      this.rootComponent.componentModel.on(\r\n        \"rootAdded\",\r\n        () => this.eventEmitter.emit(\"rootComponentUpdated\"),\r\n        this\r\n      );\r\n      this.rootComponent.componentModel.on(\r\n        \"rootRemoved\",\r\n        () => this.eventEmitter.emit(\"rootComponentUpdated\"),\r\n        this\r\n      );\r\n\r\n      this.context.setRootComponent(this.rootComponent);\r\n    }\r\n\r\n    this.eventEmitter.emit(\"rootComponentUpdated\");\r\n  }\r\n\r\n  async setData(graphData: any): Promise<void> {\r\n    if (this._disableLoad) return;\r\n\r\n    this._currentLoadedData = graphData;\r\n    await this.graphModel.importEditorData(graphData);\r\n\r\n    for (const module of this.noodlModules) {\r\n      typeof module.setup === \"function\" && module.setup();\r\n    }\r\n\r\n    if (this.dontCreateRootComponent !== true) {\r\n      await this._setRootComponent(this.graphModel.rootComponent || null);\r\n\r\n      this.graphModel.on(\"rootComponentNameUpdated\", (name: string) => {\r\n        this._setRootComponent(name);\r\n      });\r\n\r\n      this.graphModel.on(\"componentRemoved\", (componentModel: any) => {\r\n        if (\r\n          this.rootComponent &&\r\n          this.rootComponent.name === componentModel.name\r\n        ) {\r\n          this._setRootComponent(null);\r\n        }\r\n      });\r\n\r\n      this.graphModel.on(\"componentAdded\", (componentModel: any) => {\r\n        setTimeout(() => {\r\n          if (\r\n            !this.rootComponent &&\r\n            this.graphModel.rootComponent === componentModel.name\r\n          ) {\r\n            this._setRootComponent(componentModel.name);\r\n          }\r\n        }, 1);\r\n      });\r\n    }\r\n\r\n    this.scheduleUpdate();\r\n  }\r\n\r\n  scheduleUpdate(): void {\r\n    if (this.updateScheduled) {\r\n      return;\r\n    }\r\n\r\n    this.updateScheduled = true;\r\n    this.platform.requestUpdate?.(this._doUpdate.bind(this));\r\n  }\r\n\r\n  private _doUpdate(): void {\r\n    this.updateScheduled = false;\r\n\r\n    this.context.currentFrameTime = this.platform.getCurrentTime();\r\n\r\n    this.context.eventEmitter.emit(\"frameStart\");\r\n\r\n    this.context.update();\r\n\r\n    this.context.eventEmitter.emit(\"frameEnd\");\r\n\r\n    this.frameNumber++;\r\n  }\r\n\r\n  setProjectSettings(settings: any): void {\r\n    this.projectSettings = settings;\r\n  }\r\n\r\n  getNodeLibrary(): string {\r\n    const projectSettings = generateProjectSettings(\r\n      this.graphModel.getSettings(),\r\n      this.noodlModules\r\n    );\r\n\r\n    if (this.projectSettings) {\r\n      this.projectSettings.ports &&\r\n        (projectSettings.ports = projectSettings.ports.concat(\r\n          this.projectSettings.ports\r\n        ));\r\n      this.projectSettings.dynamicports &&\r\n        (projectSettings.dynamicports = projectSettings.ports.concat(\r\n          this.projectSettings.dynamicports\r\n        ));\r\n    }\r\n\r\n    const nodeLibrary = generateNodeLibrary(this.context.nodeRegister);\r\n    nodeLibrary.projectsettings = projectSettings;\r\n    return JSON.stringify(nodeLibrary, null, 3);\r\n  }\r\n\r\n  sendNodeLibrary(): void {\r\n    const nodeLibrary = this.getNodeLibrary();\r\n    if (this.lastSentNodeLibrary !== nodeLibrary) {\r\n      this.lastSentNodeLibrary = nodeLibrary;\r\n      this.editorConnection.sendNodeLibrary(nodeLibrary);\r\n    }\r\n  }\r\n\r\n  connectToEditor(address: string): void {\r\n    this.editorConnection.connect(address);\r\n  }\r\n\r\n  onMetaDataUpdateReceived(event: any): void {\r\n    if (!this.graphModel.isEmpty()) {\r\n      handleEvent(this.context, this.graphModel, event);\r\n    }\r\n  }\r\n\r\n  async onModelUpdateReceived(event: any): Promise<void> {\r\n    if (this.isWaitingForExport) {\r\n      return;\r\n    }\r\n\r\n    if (event.type === \"projectInstanceChanged\") {\r\n      this.reload();\r\n    } else if (this.graphModel.isEmpty() === false) {\r\n      await handleEvent(this.context, this.graphModel, event);\r\n    }\r\n  }\r\n\r\n  addErrorHandler(callback: (message: string) => void): void {\r\n    this.errorHandlers.push(callback);\r\n  }\r\n\r\n  reportError(message: string): void {\r\n    this.errorHandlers.forEach((eh) => {\r\n      eh(message);\r\n    });\r\n  }\r\n\r\n  getProjectSettings(): any {\r\n    return this.graphModel.getSettings();\r\n  }\r\n\r\n  getMetaData(key: string): any {\r\n    return this.graphModel.getMetaData(key);\r\n  }\r\n}\r\n","import type NoodlRuntime from \"./runtime\";\r\n\r\nimport * as componentinputs from \"./nodes/componentinputs\";\r\nimport * as componentoutputs from \"./nodes/componentoutputs\";\r\n\r\nimport * as runtasks from \"./nodes/std-library/runtasks\";\r\n\r\n// Data\r\nimport * as restnode from \"./nodes/std-library/data/restnode\";\r\n\r\n// Custom code\r\nimport * as expression from \"./nodes/std-library/expression\";\r\nimport * as simplejavascript from \"./nodes/std-library/simplejavascript\";\r\n\r\n// Records\r\nimport * as dbcollectionnode2 from \"./nodes/std-library/data/dbcollectionnode2\";\r\nimport * as dbmodelnode2 from \"./nodes/std-library/data/dbmodelnode2\";\r\nimport * as setdbmodelpropertiesnode from \"./nodes/std-library/data/setdbmodelpropertiesnode\";\r\nimport * as deletedbmodelpropertiesnode from \"./nodes/std-library/data/deletedbmodelpropertiesnode\";\r\nimport * as newdbmodelpropertiesnode from \"./nodes/std-library/data/newdbmodelpropertiesnode\";\r\nimport * as dbmodelnodeAddrelation from \"./nodes/std-library/data/dbmodelnode-addrelation\";\r\nimport * as dbmodelnodeRemoverelation from \"./nodes/std-library/data/dbmodelnode-removerelation\";\r\nimport * as filterdbmodelsnode from \"./nodes/std-library/data/filterdbmodelsnode\";\r\n\r\n// Object\r\nimport * as modelnode2 from \"./nodes/std-library/data/modelnode2\";\r\nimport * as setmodelpropertiesnode from \"./nodes/std-library/data/setmodelpropertiesnode\";\r\nimport * as newmodelnode from \"./nodes/std-library/data/newmodelnode\";\r\n\r\n// Cloud\r\nimport * as cloudfilenode from \"./nodes/std-library/data/cloudfilenode\";\r\nimport * as dbconfig from \"./nodes/std-library/data/dbconfig\";\r\n\r\n// Variables\r\nimport * as number from \"./nodes/std-library/variables/number\";\r\nimport * as string from \"./nodes/std-library/variables/string\";\r\nimport * as boolean from \"./nodes/std-library/variables/boolean\";\r\n\r\n// Utils\r\nimport * as condition from \"./nodes/std-library/condition\";\r\nimport * as and from \"./nodes/std-library/and\";\r\nimport * as or from \"./nodes/std-library/or\";\r\nimport * as booleantostring from \"./nodes/std-library/booleantostring\";\r\nimport * as datetostring from \"./nodes/std-library/datetostring\";\r\nimport * as stringmapper from \"./nodes/std-library/stringmapper\";\r\nimport * as inverter from \"./nodes/std-library/inverter\";\r\nimport * as substring from \"./nodes/std-library/substring\";\r\nimport * as stringformat from \"./nodes/std-library/stringformat\";\r\nimport * as counter from \"./nodes/std-library/counter\";\r\nimport * as uniqueid from \"./nodes/std-library/uniqueid\";\r\n\r\n// User\r\nimport * as setuserproperties from \"./nodes/std-library/user/setuserproperties\";\r\nimport * as user from \"./nodes/std-library/user/user\";\r\n\r\nexport function registerNodes(noodlRuntime: NoodlRuntime): void {\r\n  [\r\n    componentinputs,\r\n    componentoutputs,\r\n\r\n    runtasks,\r\n\r\n    // Data\r\n    restnode,\r\n\r\n    // Custom code\r\n    expression,\r\n    simplejavascript,\r\n\r\n    // Records\r\n    dbcollectionnode2,\r\n    dbmodelnode2,\r\n    setdbmodelpropertiesnode,\r\n    deletedbmodelpropertiesnode,\r\n    newdbmodelpropertiesnode,\r\n    dbmodelnodeAddrelation,\r\n    dbmodelnodeRemoverelation,\r\n    filterdbmodelsnode,\r\n\r\n    // Object\r\n    modelnode2,\r\n    setmodelpropertiesnode,\r\n    newmodelnode,\r\n\r\n    // Cloud\r\n    cloudfilenode,\r\n    dbconfig,\r\n\r\n    // Variables\r\n    number,\r\n    string,\r\n    boolean,\r\n\r\n    // Utils\r\n    condition,\r\n    and,\r\n    or,\r\n    booleantostring,\r\n    datetostring,\r\n    stringmapper,\r\n    inverter,\r\n    substring,\r\n    stringformat,\r\n    counter,\r\n    uniqueid,\r\n\r\n    // User\r\n    setuserproperties,\r\n    user,\r\n\r\n    // @ts-expect-error\r\n  ].forEach((node) => noodlRuntime.registerNode(node));\r\n}\r\n","/**\r\n * Executes async functions with a concurrency limit\r\n * @param poolLimit Maximum number of concurrent executions\r\n * @param values Array of input values to process\r\n * @param iteratorFn Function to execute for each value\r\n * @returns Promise that resolves with array of results\r\n */\r\nexport async function asyncPool<T, R>(\r\n  poolLimit: number,\r\n  values: T[],\r\n  iteratorFn: (item: T, array: T[]) => Promise<R>\r\n): Promise<R[]> {\r\n  const ret: Promise<R>[] = [];\r\n  const executing: Promise<void>[] = [];\r\n\r\n  for (const item of values) {\r\n    const p = Promise.resolve().then(() => iteratorFn(item, values));\r\n    ret.push(p);\r\n\r\n    if (poolLimit <= values.length) {\r\n      const e = p.then((): void => {\r\n        executing.splice(executing.indexOf(e), 1);\r\n      });\r\n      executing.push(e);\r\n      if (executing.length >= poolLimit) {\r\n        await Promise.race(executing);\r\n      }\r\n    }\r\n  }\r\n\r\n  return Promise.all(ret);\r\n}\r\n","interface Port {\r\n  [key: string]: any;\r\n}\r\n\r\nexport interface Module {\r\n  settings?: Port[];\r\n  name?: string;\r\n  nodes?: any[];\r\n  setup?: () => void;\r\n}\r\n\r\ninterface ProjectSettings {\r\n  [key: string]: any;\r\n}\r\n\r\ninterface ProjectSettingsResult {\r\n  dynamicports: any[];\r\n  ports: Port[];\r\n}\r\n\r\nfunction addModuleSettings(\r\n  result: ProjectSettingsResult,\r\n  modules: Module[]\r\n): void {\r\n  // Add module settings\r\n  for (let i = 0; i < modules.length; i++) {\r\n    const m = modules[i];\r\n    if (m.settings) {\r\n      m.settings.forEach((p: Port) => {\r\n        result.ports.push(p);\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nexport function generateProjectSettings(\r\n  // TODO: What is this?\r\n  projectSettings: ProjectSettings,\r\n  modules: Module[]\r\n): ProjectSettingsResult {\r\n  const result: ProjectSettingsResult = {\r\n    dynamicports: [],\r\n    ports: [],\r\n  };\r\n\r\n  addModuleSettings(result, modules);\r\n\r\n  return result;\r\n}\r\n","declare global {\r\n  interface Window {\r\n    Noodl: {\r\n      baseUrl?: string;\r\n    };\r\n  }\r\n}\r\n\r\n//this just assumes the base url is '/' always\r\nexport function getAbsoluteUrl(_url: unknown): string {\r\n  if (_url === null || _url === undefined || _url === \"\") {\r\n    return window.Noodl.baseUrl || \"/\";\r\n  }\r\n\r\n  //convert to string in case the _url is a Cloud File (which is an object with a custom toString())\r\n  const url = String(_url);\r\n\r\n  //only add a the base url if this is a local URL (e.g. not a https url or  base64 string)\r\n  if (\r\n    !url ||\r\n    url[0] === \"/\" ||\r\n    url.includes(\"://\") ||\r\n    url.startsWith(\"data:\")\r\n  ) {\r\n    return url;\r\n  }\r\n\r\n  return (window.Noodl.baseUrl || \"/\") + url;\r\n}\r\n\r\n/**\r\n * Log an error thrown by the JavaScript nodes.\r\n */\r\nexport function logJavaScriptNodeError(error: unknown): void {\r\n  if (typeof error === \"string\") {\r\n    console.log(\"Error in JS node run code.\", error);\r\n  } else if (error instanceof Error) {\r\n    console.log(\r\n      \"Error in JS node run code.\",\r\n      Object.getPrototypeOf(error).constructor.name + \": \" + error.message,\r\n      error.stack\r\n    );\r\n  }\r\n}\r\n\r\n//adapted from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\r\nexport function guid(): string {\r\n  function s4(): string {\r\n    return Math.floor((1 + Math.random()) * 0x10000)\r\n      .toString(16)\r\n      .substring(1);\r\n  }\r\n  return (\r\n    s4() +\r\n    s4() +\r\n    \"-\" +\r\n    s4() +\r\n    \"-\" +\r\n    s4() +\r\n    \"-\" +\r\n    s4() +\r\n    \"-\" +\r\n    s4() +\r\n    s4() +\r\n    s4()\r\n  );\r\n}\r\n\r\nexport function randomString(size: number): string {\r\n  if (size === 0) {\r\n    throw new Error(\"Zero-length randomString is useless.\");\r\n  }\r\n  const chars =\r\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" + \"abcdefghijklmnopqrstuvwxyz\" + \"0123456789\";\r\n  let objectId = \"\";\r\n  for (let i = 0; i < size; ++i) {\r\n    objectId += chars[Math.floor((1 + Math.random()) * 0x10000) % chars.length];\r\n  }\r\n  return objectId;\r\n}\r\n","interface EaseCurves {\r\n  easeOutQuartic(start: number, end: number, t: number): number;\r\n  easeInQuartic(start: number, end: number, t: number): number;\r\n  easeInOutQuartic(start: number, end: number, t: number): number;\r\n  easeOutCubic(start: number, end: number, t: number): number;\r\n  easeInCubic(start: number, end: number, t: number): number;\r\n  easeInOutCubic(start: number, end: number, t: number): number;\r\n  easeOutQuadratic(start: number, end: number, t: number): number;\r\n  easeInQuadratic(start: number, end: number, t: number): number;\r\n  easeInOutQuadratic(start: number, end: number, t: number): number;\r\n  linear(start: number, end: number, t: number): number;\r\n\r\n  easeIn: (start: number, end: number, t: number) => number;\r\n  easeOut: (start: number, end: number, t: number) => number;\r\n  easeInOut: (start: number, end: number, t: number) => number;\r\n}\r\n\r\nconst easeCurves: EaseCurves = {\r\n  easeOutQuartic: function (start, end, t) {\r\n    t--;\r\n    return -(end - start) * (t * t * t * t - 1.0) + start;\r\n  },\r\n  easeInQuartic: function (start, end, t) {\r\n    return (end - start) * (t * t * t * t) + start;\r\n  },\r\n  easeInOutQuartic: function (start, end, t) {\r\n    t *= 2.0;\r\n    if (t < 1.0) {\r\n      return ((end - start) / 2.0) * t * t * t * t + start;\r\n    }\r\n    t -= 2.0;\r\n    return (-(end - start) / 2.0) * (t * t * t * t - 2.0) + start;\r\n  },\r\n  easeOutCubic: function (start, end, t) {\r\n    t--;\r\n    return (end - start) * (t * t * t + 1.0) + start;\r\n  },\r\n  easeInCubic: function (start, end, t) {\r\n    return (end - start) * (t * t * t) + start;\r\n  },\r\n  easeInOutCubic: function (start, end, t) {\r\n    t *= 2.0;\r\n    if (t < 1.0) {\r\n      return ((end - start) / 2.0) * t * t * t + start;\r\n    }\r\n    t -= 2.0;\r\n    return ((end - start) / 2.0) * (t * t * t + 2.0) + start;\r\n  },\r\n  easeOutQuadratic: function (start, end, t) {\r\n    return -(end - start) * t * (t - 2.0) + start;\r\n  },\r\n  easeInQuadratic: function (start, end, t) {\r\n    return (end - start) * (t * t) + start;\r\n  },\r\n  easeInOutQuadratic: function (start, end, t) {\r\n    t *= 2.0;\r\n    if (t < 1.0) {\r\n      return ((end - start) / 2.0) * t * t + start;\r\n    }\r\n    t -= 1.0;\r\n    return (-(end - start) / 2.0) * (t * (t - 2) - 1.0) + start;\r\n  },\r\n  linear: function (start, end, t) {\r\n    return start + (end - start) * t;\r\n  },\r\n  easeIn: () => 0,\r\n  easeOut: () => 0,\r\n  easeInOut: () => 0,\r\n};\r\n\r\n//default interpolation curves\r\neaseCurves.easeIn = easeCurves.easeInCubic;\r\neaseCurves.easeOut = easeCurves.easeOutCubic;\r\neaseCurves.easeInOut = easeCurves.easeInOutCubic;\r\n\r\nexport default easeCurves;\r\n","import { createSetter } from \"@fluxscape/runtime/src/edgetriggeredinput\";\r\nimport { GraphModel } from \"@fluxscape/runtime\";\r\nimport { NodeContext } from \"@fluxscape/runtime/src/nodecontext\";\r\nimport { NodeDefinition } from \"@fluxscape/runtime/src/nodedefinition\";\r\n\r\ninterface ClosePopupNodeInternal {\r\n  resultValues: Record<string, any>;\r\n  results?: string[];\r\n  closeActions?: string[];\r\n  closeCallback?: (action: string, resultValues: Record<string, any>) => void;\r\n  closeAction?: string;\r\n  hasScheduledClose?: boolean;\r\n}\r\n\r\nexport const node: NodeDefinition<ClosePopupNodeInternal> = {\r\n  name: \"NavigationClosePopup\",\r\n  displayNodeName: \"Close Popup\",\r\n  category: \"Navigation\",\r\n  docs: \"https://docs.noodl.net/nodes/popups/close-popup\",\r\n  _internal: {\r\n    resultValues: {},\r\n  },\r\n  inputs: {\r\n    results: {\r\n      type: { name: \"stringlist\", allowEditOnly: true },\r\n      group: \"Results\",\r\n      set(value: string[]) {\r\n        this._internal.results = value;\r\n      },\r\n    },\r\n    closeActions: {\r\n      type: { name: \"stringlist\", allowEditOnly: true },\r\n      group: \"Close Actions\",\r\n      set(value: string[]) {\r\n        this._internal.closeActions = value;\r\n      },\r\n    },\r\n    close: {\r\n      type: \"Signal\",\r\n      displayName: \"Close\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleClose();\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    setResultValue(key: string, value: any) {\r\n      this._internal.resultValues[key] = value;\r\n    },\r\n    _setCloseCallback(\r\n      cb: (action: string, resultValues: Record<string, any>) => void\r\n    ) {\r\n      this._internal.closeCallback = cb;\r\n    },\r\n    scheduleClose() {\r\n      const _this = this;\r\n      const internal = this._internal;\r\n      if (!internal.hasScheduledClose) {\r\n        internal.hasScheduledClose = true;\r\n        this.scheduleAfterInputsHaveUpdated(function () {\r\n          internal.hasScheduledClose = false;\r\n          // @ts-expect-error\r\n          _this.close();\r\n        });\r\n      }\r\n    },\r\n    close() {\r\n      if (this._internal.closeCallback) {\r\n        this._internal.closeCallback(\r\n          this._internal.closeAction || \"\",\r\n          this._internal.resultValues\r\n        );\r\n      }\r\n    },\r\n    closeActionTriggered(name: string) {\r\n      this._internal.closeAction = name;\r\n      // @ts-expect-error\r\n      this.scheduleClose();\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"result-\"))\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setResultValue.bind(this, name.substring(\"result-\".length)),\r\n        });\r\n\r\n      if (name.startsWith(\"closeAction-\"))\r\n        return this.registerInput(name, {\r\n          set: createSetter({\r\n            // @ts-expect-error\r\n            valueChangedToTrue: this.closeActionTriggered.bind(this, name),\r\n          }),\r\n        });\r\n    },\r\n  },\r\n};\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    function _updatePorts() {\r\n      const ports: any[] = [];\r\n\r\n      // Add results inputs\r\n      const results = node.parameters[\"results\"];\r\n      if (results) {\r\n        const resultsArray = results ? results.split(\",\") : undefined;\r\n        for (const p of resultsArray) {\r\n          ports.push({\r\n            type: {\r\n              name: \"*\",\r\n            },\r\n            plug: \"input\",\r\n            group: \"Results\",\r\n            name: \"result-\" + p,\r\n            displayName: p,\r\n          });\r\n        }\r\n      }\r\n\r\n      // Add close actions\r\n      const closeActions = node.parameters[\"closeActions\"];\r\n      if (closeActions) {\r\n        const closeActionsArray = closeActions\r\n          ? closeActions.split(\",\")\r\n          : undefined;\r\n        for (const p of closeActionsArray) {\r\n          ports.push({\r\n            type: \"signal\",\r\n            plug: \"input\",\r\n            group: \"Close Actions\",\r\n            name: \"closeAction-\" + p,\r\n            displayName: p,\r\n          });\r\n        }\r\n      }\r\n\r\n      context.editorConnection?.sendDynamicPorts(node.id, ports);\r\n    }\r\n\r\n    _updatePorts();\r\n    node.on(\"parameterUpdated\", function (event: any) {\r\n      if (event.name === \"results\" || event.name === \"closeActions\") {\r\n        _updatePorts();\r\n      }\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.NavigationClosePopup\", function (node: any) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"NavigationClosePopup\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","import { GraphModel } from \"@fluxscape/runtime\";\r\nimport { NodeContext } from \"@fluxscape/runtime/src/nodecontext\";\r\nimport { NodeDefinition } from \"@fluxscape/runtime/src/nodedefinition\";\r\n\r\ninterface Internal {\r\n  resultValues: Record<string, any>;\r\n  results?: string[];\r\n  backActions?: string[];\r\n  backCallback?: (args: any) => void;\r\n  backAction?: string;\r\n  hasScheduledNavigate?: boolean;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"PageStackNavigateBack\",\r\n  displayNodeName: \"Pop Component Stack\",\r\n  category: \"Navigation\",\r\n  docs: \"https://docs.noodl.net/nodes/component-stack/pop-component\",\r\n  inputs: {\r\n    navigate: {\r\n      displayName: \"Navigate\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleNavigate();\r\n      },\r\n    },\r\n    results: {\r\n      type: { name: \"stringlist\", allowEditOnly: true },\r\n      group: \"Results\",\r\n      set(value) {\r\n        this._internal.results = value;\r\n      },\r\n    },\r\n    backActions: {\r\n      type: { name: \"stringlist\", allowEditOnly: true },\r\n      group: \"Back Actions\",\r\n      set(value) {\r\n        this._internal.backActions = value;\r\n      },\r\n    },\r\n  },\r\n  initialize() {\r\n    this._internal.resultValues = {};\r\n  },\r\n  methods: {\r\n    scheduleNavigate() {\r\n      var _this = this;\r\n      var internal = this._internal;\r\n      if (!internal.hasScheduledNavigate) {\r\n        internal.hasScheduledNavigate = true;\r\n        this.scheduleAfterInputsHaveUpdated(function () {\r\n          internal.hasScheduledNavigate = false;\r\n          // @ts-expect-error\r\n          _this.navigate();\r\n        });\r\n      }\r\n    },\r\n    _setBackCallback(cb) {\r\n      this._internal.backCallback = cb;\r\n    },\r\n    navigate() {\r\n      if (this._internal.backCallback === undefined) return;\r\n\r\n      this._internal.backCallback({\r\n        backAction: this._internal.backAction,\r\n        results: this._internal.resultValues,\r\n      });\r\n    },\r\n    setResultValue(key: string, value: any) {\r\n      this._internal.resultValues[key] = value;\r\n    },\r\n    backActionTriggered(name: string) {\r\n      this._internal.backAction = name;\r\n      // @ts-expect-error\r\n      this.scheduleNavigate();\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"result-\")) {\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setResultValue.bind(this, name.substring(\"result-\".length)),\r\n        });\r\n      }\r\n\r\n      if (name.startsWith(\"backAction-\")) {\r\n        return this.registerInput(name, {\r\n          set: (value) => {\r\n            // @ts-expect-error\r\n            value && this.backActionTriggered(name);\r\n          },\r\n        });\r\n      }\r\n    },\r\n  },\r\n};\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    function _updatePorts() {\r\n      var ports: any[] = [];\r\n\r\n      // Add results inputs\r\n      var results = node.parameters.results;\r\n      if (results) {\r\n        results = results ? results.split(\",\") : undefined;\r\n        for (var i in results) {\r\n          var p = results[i];\r\n\r\n          ports.push({\r\n            type: {\r\n              name: \"*\",\r\n            },\r\n            plug: \"input\",\r\n            group: \"Results\",\r\n            name: \"result-\" + p,\r\n            displayName: p,\r\n          });\r\n        }\r\n      }\r\n\r\n      // Add back actions\r\n      var backActions = node.parameters.backActions;\r\n      if (backActions) {\r\n        backActions = backActions ? backActions.split(\",\") : undefined;\r\n        for (var i in backActions) {\r\n          var p = backActions[i];\r\n\r\n          ports.push({\r\n            type: \"signal\",\r\n            plug: \"input\",\r\n            group: \"Back Actions\",\r\n            name: \"backAction-\" + p,\r\n            displayName: p,\r\n          });\r\n        }\r\n      }\r\n\r\n      context.editorConnection?.sendDynamicPorts(node.id, ports);\r\n    }\r\n\r\n    _updatePorts();\r\n    node.on(\"parameterUpdated\", function (event: any) {\r\n      if (event.name === \"results\" || event.name === \"backActions\") {\r\n        _updatePorts();\r\n      }\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.PageStackNavigateBack\", function (node: any) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"PageStackNavigateBack\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","import NoodlRuntime from \"@fluxscape/runtime\";\r\nimport { GraphModel } from \"@fluxscape/runtime\";\r\nimport { NodeContext } from \"@fluxscape/runtime/src/nodecontext\";\r\nimport { NodeDefinition } from \"@fluxscape/runtime/src/nodedefinition\";\r\n\r\ninterface Internal {\r\n  params: Record<string, any>;\r\n  query: Record<string, any>;\r\n  openInNewTab: boolean;\r\n  path?: string;\r\n  queryNames?: string;\r\n  hasScheduledNavigate?: boolean;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"PageStackNavigateToPath\",\r\n  displayNodeName: \"Navigate To Path\",\r\n  category: \"Navigation\",\r\n  docs: \"https://docs.noodl.net/nodes/navigation/navigate-to-path\",\r\n  initialize() {\r\n    const internal = this._internal;\r\n    internal.params = {};\r\n    internal.query = {};\r\n    internal.openInNewTab = false;\r\n  },\r\n  inputs: {\r\n    path: {\r\n      type: { name: \"string\" },\r\n      displayName: \"Path\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        this._internal.path = value;\r\n      },\r\n    },\r\n    queryNames: {\r\n      type: { name: \"stringlist\", allowEditOnly: true },\r\n      displayName: \"Query\",\r\n      group: \"Query\",\r\n      set(value: string) {\r\n        this._internal.queryNames = value;\r\n      },\r\n    },\r\n    openInNewTab: {\r\n      index: 10,\r\n      displayName: \"Open in new tab\",\r\n      group: \"General\",\r\n      default: false,\r\n      type: \"boolean\",\r\n      set(value: boolean) {\r\n        this._internal.openInNewTab = !!value;\r\n      },\r\n    },\r\n    navigate: {\r\n      displayName: \"Navigate\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleNavigate();\r\n      },\r\n    },\r\n  },\r\n  outputs: {},\r\n  methods: {\r\n    scheduleNavigate() {\r\n      const internal = this._internal;\r\n\r\n      if (!internal.hasScheduledNavigate) {\r\n        internal.hasScheduledNavigate = true;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          internal.hasScheduledNavigate = false;\r\n          // @ts-expect-error\r\n          this.navigate();\r\n        });\r\n      }\r\n    },\r\n    navigate() {\r\n      const internal = this._internal;\r\n\r\n      let formattedPath = internal.path;\r\n      if (formattedPath === undefined) return;\r\n\r\n      const matches = internal.path?.match(/\\{[A-Za-z0-9_]*\\}/g);\r\n      let inputs: string[] = [];\r\n      if (matches) {\r\n        inputs = matches.map((name) => name.replace(\"{\", \"\").replace(\"}\", \"\"));\r\n      }\r\n\r\n      inputs.forEach((name) => {\r\n        const v = internal.params[name];\r\n        formattedPath = formattedPath!.replace(\r\n          \"{\" + name + \"}\",\r\n          v !== undefined ? v : \"\"\r\n        );\r\n      });\r\n\r\n      let urlPath: string | undefined, hashPath: string | undefined;\r\n      const navigationPathType =\r\n        NoodlRuntime.instance.getProjectSettings()[\"navigationPathType\"];\r\n      if (navigationPathType === undefined || navigationPathType === \"hash\")\r\n        hashPath = formattedPath;\r\n      else urlPath = formattedPath;\r\n\r\n      const query: string[] = [];\r\n      if (internal.queryNames !== undefined) {\r\n        internal.queryNames.split(\",\").forEach((q) => {\r\n          if (internal.query[q] !== undefined) {\r\n            query.push(q + \"=\" + internal.query[q]);\r\n          }\r\n        });\r\n      }\r\n\r\n      const compiledUrl =\r\n        (urlPath !== undefined ? urlPath : \"\") +\r\n        (query.length >= 1 ? \"?\" + query.join(\"&\") : \"\") +\r\n        (hashPath !== undefined ? \"#\" + hashPath : \"\");\r\n\r\n      if (this._internal.openInNewTab) {\r\n        window.open(compiledUrl, \"_blank\");\r\n      } else {\r\n        window.history.pushState({}, \"\", compiledUrl);\r\n        dispatchEvent(new PopStateEvent(\"popstate\", {}));\r\n      }\r\n    },\r\n    setParam(name: string, value: any) {\r\n      this._internal.params[name] = value;\r\n    },\r\n    setQuery(name: string, value: any) {\r\n      this._internal.query[name] = value;\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"p-\"))\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setParam.bind(this, name.substring(\"p-\".length)),\r\n        });\r\n\r\n      if (name.startsWith(\"q-\"))\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setQuery.bind(this, name.substring(\"q-\".length)),\r\n        });\r\n    },\r\n  },\r\n};\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    function _updatePorts() {\r\n      const ports: any[] = [];\r\n\r\n      if (node.parameters[\"path\"] !== undefined) {\r\n        const inputs =\r\n          node.parameters[\"path\"].match(/\\{[A-Za-z0-9_]*\\}/g) || [];\r\n        const portsNames = inputs.map((def) =>\r\n          def.replace(\"{\", \"\").replace(\"}\", \"\")\r\n        );\r\n\r\n        const uniquePorts = portsNames\r\n          //get unique names\r\n          .filter((value, index, self) => self.indexOf(value) === index)\r\n          //and map names to ports\r\n          .map((name) => ({\r\n            name: \"p-\" + name,\r\n            displayName: name,\r\n            group: \"Parameter\",\r\n            type: \"*\",\r\n            plug: \"input\",\r\n          }));\r\n\r\n        ports.push(...uniquePorts);\r\n      }\r\n\r\n      if (node.parameters[\"queryNames\"] !== undefined) {\r\n        node.parameters[\"queryNames\"].split(\",\").forEach((q) => {\r\n          ports.push({\r\n            name: \"q-\" + q,\r\n            displayName: q,\r\n            group: \"Query\",\r\n            plug: \"input\",\r\n            type: \"*\",\r\n          });\r\n        });\r\n      }\r\n\r\n      context.editorConnection?.sendDynamicPorts(node.id, ports);\r\n    }\r\n\r\n    _updatePorts();\r\n    node.on(\"parameterUpdated\", function (event: any) {\r\n      _updatePorts();\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.PageStackNavigateToPath\", function (node: any) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"PageStackNavigateToPath\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","import { NodeDefinition } from \"@fluxscape/runtime/src/nodedefinition\";\r\nimport { GraphModel } from \"@fluxscape/runtime\";\r\nimport { NodeContext } from \"@fluxscape/runtime/src/nodecontext\";\r\nimport { Transitions } from \"./transitions\";\r\nimport NavigationHandler from \"./navigation-handler\";\r\n\r\ninterface Internal {\r\n  transitionParams: Record<string, any>;\r\n  pageParams: Record<string, any>;\r\n  backResults: Record<string, any>;\r\n  stack: string;\r\n  navigationMode: \"push\" | \"replace\" | undefined;\r\n  target: string;\r\n  transition: string;\r\n  hasScheduledNavigate?: boolean;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"PageStackNavigate\",\r\n  displayNodeName: \"Push Component To Stack\",\r\n  category: \"Navigation\",\r\n  docs: \"https://docs.noodl.net/nodes/component-stack/push-component\",\r\n  initialize() {\r\n    this._internal.transitionParams = {};\r\n    this._internal.pageParams = {};\r\n    this._internal.backResults = {};\r\n  },\r\n  inputs: {\r\n    stack: {\r\n      type: { name: \"string\", identifierOf: \"PackStack\" },\r\n      displayName: \"Stack\",\r\n      group: \"General\",\r\n      default: \"Main\",\r\n      set(value: string) {\r\n        this._internal.stack = value;\r\n      },\r\n    },\r\n    mode: {\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"Push\", value: \"push\" },\r\n          { label: \"Replace\", value: \"replace\" },\r\n        ],\r\n      },\r\n      displayName: \"Mode\",\r\n      default: \"push\",\r\n      group: \"General\",\r\n      set(value: \"push\" | \"replace\") {\r\n        this._internal.navigationMode = value;\r\n      },\r\n    },\r\n    navigate: {\r\n      displayName: \"Navigate\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleNavigate();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    navigated: {\r\n      type: \"signal\",\r\n      displayName: \"Navigated\",\r\n      group: \"Events\",\r\n    },\r\n  },\r\n  methods: {\r\n    scheduleNavigate() {\r\n      const internal = this._internal;\r\n      if (!internal.hasScheduledNavigate) {\r\n        internal.hasScheduledNavigate = true;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          internal.hasScheduledNavigate = false;\r\n          // @ts-expect-error\r\n          this.navigate();\r\n        });\r\n      }\r\n    },\r\n    navigate() {\r\n      if (\r\n        this._internal.navigationMode === \"push\" ||\r\n        this._internal.navigationMode === undefined\r\n      ) {\r\n        NavigationHandler.instance.navigate(this._internal.stack, {\r\n          target: this._internal.target,\r\n          transition: {\r\n            ...{ type: this._internal.transition },\r\n            ...this._internal.transitionParams,\r\n          },\r\n          params: this._internal.pageParams,\r\n          backCallback: (action, results) => {\r\n            this._internal.backResults = results;\r\n\r\n            for (const key in results) {\r\n              if (this.hasOutput(\"backResult-\" + key)) {\r\n                this.flagOutputDirty(\"backResult-\" + key);\r\n              }\r\n            }\r\n\r\n            if (action !== undefined) this.sendSignalOnOutput(action);\r\n          },\r\n          hasNavigated: () => {\r\n            this.sendSignalOnOutput(\"navigated\");\r\n          },\r\n        });\r\n      } else if (this._internal.navigationMode === \"replace\") {\r\n        NavigationHandler.instance.replace(this._internal.stack, {\r\n          target: this._internal.target,\r\n          params: this._internal.pageParams,\r\n          hasNavigated: () => {\r\n            this.scheduleAfterInputsHaveUpdated(() => {\r\n              this.sendSignalOnOutput(\"navigated\");\r\n            });\r\n          },\r\n        });\r\n      }\r\n    },\r\n    setTransitionParam(param: string, value: any) {\r\n      this._internal.transitionParams[param] = value;\r\n    },\r\n    setPageParam(param: string, value: any) {\r\n      this._internal.pageParams[param] = value;\r\n    },\r\n    getBackResult(param: string) {\r\n      return this._internal.backResults[param];\r\n    },\r\n    setTargetPageId(pageId: string) {\r\n      this._internal.target = pageId;\r\n    },\r\n    setTransition(value: string) {\r\n      this._internal.transition = value;\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === \"target\") {\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setTargetPageId.bind(this),\r\n        });\r\n      } else if (name === \"transition\") {\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setTransition.bind(this),\r\n        });\r\n      } else if (name.startsWith(\"tr-\")) {\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setTransitionParam.bind(this, name.substring(\"tr-\".length)),\r\n        });\r\n      } else if (name.startsWith(\"pm-\")) {\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setPageParam.bind(this, name.substring(\"pm-\".length)),\r\n        });\r\n      }\r\n    },\r\n    registerOutputIfNeeded(name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"backResult-\"))\r\n        return this.registerOutput(name, {\r\n          // @ts-expect-error\r\n          getter: this.getBackResult.bind(\r\n            this,\r\n            name.substring(\"backResult-\".length)\r\n          ),\r\n        });\r\n      else if (name.startsWith(\"backAction-\"))\r\n        return this.registerOutput(name, {\r\n          getter() {\r\n            /** No needed for signals */\r\n          },\r\n        });\r\n    },\r\n  },\r\n};\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    function _updatePorts() {\r\n      const ports: any[] = [];\r\n\r\n      // Only push mode have transition\r\n      if (\r\n        node.parameters[\"mode\"] === \"push\" ||\r\n        node.parameters[\"mode\"] === undefined\r\n      ) {\r\n        ports.push({\r\n          name: \"transition\",\r\n          plug: \"input\",\r\n          type: { name: \"enum\", enums: Object.keys(Transitions) },\r\n          default: \"Push\",\r\n          displayName: \"Transition\",\r\n          group: \"Transition\",\r\n        });\r\n\r\n        const transition = node.parameters[\"transition\"] || \"Push\";\r\n        if (Transitions[transition])\r\n          ports.push(...Transitions[transition].ports(node.parameters));\r\n      }\r\n\r\n      const pageStacks = graphModel.getNodesWithType(\"Page Stack\");\r\n      const pageStack = pageStacks.find(\r\n        (ps) =>\r\n          (ps.parameters[\"name\"] || \"Main\") ===\r\n          (node.parameters[\"stack\"] || \"Main\")\r\n      );\r\n\r\n      if (pageStack !== undefined) {\r\n        const pages = pageStack.parameters[\"pages\"];\r\n        if (pages !== undefined && pages.length > 0) {\r\n          ports.push({\r\n            plug: \"input\",\r\n            type: {\r\n              name: \"enum\",\r\n              enums: pages.map((p: any) => ({\r\n                label: p.label,\r\n                value: p.id,\r\n              })),\r\n            },\r\n            group: \"General\",\r\n            displayName: \"Target Page\",\r\n            name: \"target\",\r\n            default: pages[0].id,\r\n          });\r\n\r\n          // See if there is a target page with component\r\n          const targetPageId = node.parameters[\"target\"] || pages[0].id;\r\n          const targetComponentName =\r\n            pageStack.parameters[\"pageComp-\" + targetPageId];\r\n          if (targetComponentName !== undefined) {\r\n            // @ts-expect-error\r\n            const component = graphModel.components[targetComponentName];\r\n\r\n            if (component !== undefined) {\r\n              // Make all inputs of the component to inputs of this navigation node\r\n              for (const inputName in component.inputPorts) {\r\n                ports.push({\r\n                  name: \"pm-\" + inputName,\r\n                  displayName: inputName,\r\n                  type: \"*\",\r\n                  plug: \"input\",\r\n                  group: \"Parameters\",\r\n                });\r\n              }\r\n\r\n              // Find all navigate back nodes and compile the back actions as\r\n              // outputs of this node\r\n              for (const backNode of component.getNodesWithType(\r\n                \"PageStackNavigateBack\"\r\n              )) {\r\n                if (backNode.parameters[\"backActions\"] !== undefined) {\r\n                  backNode.parameters[\"backActions\"]\r\n                    .split(\",\")\r\n                    .forEach((a: string) => {\r\n                      if (\r\n                        ports.find((_p: any) => _p.name === \"backAction-\" + a)\r\n                      )\r\n                        return;\r\n\r\n                      ports.push({\r\n                        name: \"backAction-\" + a,\r\n                        displayName: a,\r\n                        type: \"signal\",\r\n                        plug: \"output\",\r\n                        group: \"Back Actions\",\r\n                      });\r\n                    });\r\n                }\r\n\r\n                if (backNode.parameters[\"results\"]) {\r\n                  backNode.parameters[\"results\"]\r\n                    .split(\",\")\r\n                    .forEach((p: string) => {\r\n                      if (\r\n                        ports.find((_p: any) => _p.name === \"backResult-\" + p)\r\n                      )\r\n                        return;\r\n\r\n                      ports.push({\r\n                        name: \"backResult-\" + p,\r\n                        displayName: p,\r\n                        type: \"*\",\r\n                        plug: \"output\",\r\n                        group: \"Back Results\",\r\n                      });\r\n                    });\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      context.editorConnection?.sendDynamicPorts(node.id, ports);\r\n    }\r\n\r\n    function _trackTargetComponent() {\r\n      const pageStacks = graphModel.getNodesWithType(\"Page Stack\");\r\n      const pageStack = pageStacks.find(\r\n        (ps) => ps.parameters[\"name\"] === node.parameters[\"stack\"]\r\n      );\r\n      if (pageStack === undefined) return;\r\n\r\n      const pages = pageStack.parameters[\"pages\"];\r\n      if (pages === undefined || pages.length === 0) return;\r\n\r\n      const targetComponent =\r\n        pageStack.parameters[\r\n          \"pageComp-\" + (node.parameters[\"target\"] || pages[0].id)\r\n        ];\r\n      if (targetComponent === undefined) return;\r\n      // @ts-expect-error\r\n      const c = graphModel.components[targetComponent];\r\n      if (c === undefined) return;\r\n\r\n      c.on(\"inputPortAdded\", _updatePorts);\r\n      c.on(\"inputPortRemoved\", _updatePorts);\r\n\r\n      // Also track all back navigate for changes\r\n      for (const _n of c.getNodesWithType(\"PageStackNavigateBack\")) {\r\n        _n.on(\"parameterUpdated\", _updatePorts);\r\n      }\r\n\r\n      // Track back navigate added and removed\r\n      c.on(\"nodeAdded\", (_n: any) => {\r\n        if (_n.type === \"PageStackNavigateBack\") {\r\n          _n.on(\"parameterUpdated\", _updatePorts);\r\n          _updatePorts();\r\n        }\r\n      });\r\n\r\n      c.on(\"nodeWasRemoved\", (_n: any) => {\r\n        if (_n.type === \"PageStackNavigateBack\") _updatePorts();\r\n      });\r\n    }\r\n\r\n    _updatePorts();\r\n    _trackTargetComponent();\r\n    node.on(\"parameterUpdated\", function (ev: any) {\r\n      if (ev.name === \"target\") {\r\n        _trackTargetComponent();\r\n        _updatePorts();\r\n      } else if (ev.name === \"stack\" || ev.name === \"mode\" || ev.name === \"transition\" || ev.name.startsWith(\"tr-\")) _updatePorts();\r\n    });\r\n\r\n    // Track all page stacks for changes (if there are any changes to the pages of the name of a stack we might have to update)\r\n    function _trackPageStack(node: any) {\r\n      node.on(\"parameterUpdated\", function (ev: any) {\r\n        if (ev.name === \"pages\" || ev.name === \"name\") _updatePorts();\r\n      });\r\n    }\r\n    graphModel.on(\"nodeAdded.Page Stack\", _trackPageStack);\r\n    graphModel.on(\"nodeWasRemoved.Page Stack\", _updatePorts);\r\n\r\n    for (const node of graphModel.getNodesWithType(\"Page Stack\")) {\r\n      _trackPageStack(node);\r\n    }\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.PageStackNavigate\", function (node: any) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"PageStackNavigate\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","export default class NavigationHandler {\r\n  public static instance = new NavigationHandler();\r\n\r\n  private _pageStacks: Record<string, any[]> = {};\r\n  private _navigationQueue: { name: string; args: any; type: string }[] = [];\r\n\r\n  private _performNavigation(\r\n    name: string = \"Main\",\r\n    args: any,\r\n    type: \"navigate\" | \"replace\"\r\n  ): void {\r\n    if (this._pageStacks[name]) {\r\n      for (const pageStack of this._pageStacks[name]) {\r\n        type === \"navigate\"\r\n          ? pageStack.navigate(args)\r\n          : pageStack.replace(args);\r\n      }\r\n    } else {\r\n      this._navigationQueue.push({ name, args, type });\r\n    }\r\n  }\r\n\r\n  public navigate(name: string = \"Main\", args: any): void {\r\n    this._performNavigation(name, args, \"navigate\");\r\n  }\r\n\r\n  public replace(name: string = \"Main\", args: any): void {\r\n    this._performNavigation(name, args, \"replace\");\r\n  }\r\n\r\n  public registerPageStack(name: string = \"Main\", pageStack: any): void {\r\n    if (!this._pageStacks[name]) {\r\n      this._pageStacks[name] = [];\r\n    }\r\n\r\n    this._pageStacks[name].push(pageStack);\r\n\r\n    let hasReset = false;\r\n    let hasNavigated = false;\r\n\r\n    let i = 0;\r\n    while (i < this._navigationQueue.length) {\r\n      const e = this._navigationQueue[i];\r\n      if (e.name === name) {\r\n        if (e.type === \"navigate\") {\r\n          if (!hasReset) {\r\n            // we need to reset to the start page before doing the first navigation\r\n            pageStack.reset();\r\n            hasReset = true;\r\n          }\r\n          pageStack.navigate(e.args);\r\n        } else {\r\n          pageStack.replace(e.args);\r\n        }\r\n\r\n        hasNavigated = true;\r\n        this._navigationQueue.splice(i, 1);\r\n      } else {\r\n        i++;\r\n      }\r\n    }\r\n\r\n    if (!hasNavigated) {\r\n      pageStack.reset(); // no navigation has happened, call reset() so the start page is created\r\n    }\r\n  }\r\n\r\n  public deregisterPageStack(name: string = \"Main\", pageStack: any): void {\r\n    if (!this._pageStacks[name]) {\r\n      return;\r\n    }\r\n\r\n    const index = this._pageStacks[name].indexOf(pageStack);\r\n    if (index === -1) {\r\n      return;\r\n    }\r\n\r\n    this._pageStacks[name].splice(index, 1);\r\n    if (this._pageStacks[name].length === 0) {\r\n      delete this._pageStacks[name];\r\n    }\r\n  }\r\n}\r\n","import { NodeDefinition } from \"@fluxscape/runtime/src/nodedefinition\";\r\nimport { NodeContext } from \"@fluxscape/runtime/src/nodecontext\";\r\nimport { GraphModel } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  params: Record<string, any>;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"PageInputs\",\r\n  displayNodeName: \"Page Inputs\",\r\n  category: \"Navigation\",\r\n  docs: \"https://docs.noodl.net/nodes/navigation/page-inputs\",\r\n  color: \"component\",\r\n  initialize() {\r\n    this._internal.params = {};\r\n  },\r\n  inputs: {\r\n    pathParams: {\r\n      type: { name: \"stringlist\", allowEditOnly: true },\r\n      group: \"Path Parameters\",\r\n    },\r\n    queryParams: {\r\n      type: { name: \"stringlist\", allowEditOnly: true },\r\n      group: \"Query Parameters\",\r\n    },\r\n  },\r\n  outputs: {},\r\n  methods: {\r\n    _setPageParams(params: Record<string, any>) {\r\n      for (const key in params) {\r\n        this._internal.params[key] = params[key];\r\n        if (this.hasOutput(\"pm-\" + key)) this.flagOutputDirty(\"pm-\" + key);\r\n      }\r\n    },\r\n    getPageParam(name: string) {\r\n      return this._internal.params[name];\r\n    },\r\n    registerOutputIfNeeded(name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"pm-\"))\r\n        return this.registerOutput(name, {\r\n          // @ts-expect-error\r\n          getter: this.getPageParam.bind(this, name.substring(\"pm-\".length)),\r\n        });\r\n    },\r\n  },\r\n};\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    function _updatePorts() {\r\n      const ports: any[] = [];\r\n      const uniqueNames: Record<string, boolean> = {};\r\n\r\n      if (node.parameters[\"pathParams\"] !== undefined) {\r\n        node.parameters[\"pathParams\"].split(\",\").forEach((p: string) => {\r\n          uniqueNames[p] = true;\r\n        });\r\n      }\r\n\r\n      if (node.parameters[\"queryParams\"] !== undefined) {\r\n        node.parameters[\"queryParams\"].split(\",\").forEach((p: string) => {\r\n          uniqueNames[p] = true;\r\n        });\r\n      }\r\n\r\n      Object.keys(uniqueNames).forEach((outputName) => {\r\n        ports.push({\r\n          name: \"pm-\" + outputName,\r\n          displayName: outputName,\r\n          type: \"*\",\r\n          plug: \"output\",\r\n          group: \"Parameters\",\r\n        });\r\n      });\r\n\r\n      context.editorConnection?.sendDynamicPorts(node.id, ports);\r\n    }\r\n\r\n    // Track page node in this component, update if there are any changes\r\n    _updatePorts();\r\n    node.on(\"parameterUpdated\", function () {\r\n      _updatePorts();\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.PageInputs\", function (node: any) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"PageInputs\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","import NoodlRuntime from \"@fluxscape/runtime\";\r\nimport type { NodeConstructor } from \"../../../typings/global\";\r\n\r\nexport type NavigateArgs = {\r\n  target: string;\r\n  params: Record<string, string | number | boolean>;\r\n  openInNewTab?: boolean;\r\n  hasNavigated?: () => void;\r\n};\r\n\r\nexport type ComponentPageInfo = {\r\n  path: string;\r\n  title: string;\r\n  component: string;\r\n};\r\n\r\nexport class RouterHandler {\r\n  static instance = new RouterHandler();\r\n\r\n  _routers: Record<string, any>;\r\n  _navigationQueue: any[];\r\n\r\n  constructor() {\r\n    this._routers = {};\r\n    this._navigationQueue = [];\r\n  }\r\n\r\n  navigate(name: string, args: NavigateArgs) {\r\n    //add a 1ms timeout so other nodes have a chance to run before the page is destroyed.\r\n    setTimeout(() => {\r\n      const routerNames = Object.keys(this._routers);\r\n      if (routerNames.length === 1) {\r\n        name = routerNames[0];\r\n      }\r\n\r\n      if (this._routers[name]) {\r\n        for (const router of this._routers[name]) {\r\n          router.navigate(args);\r\n        }\r\n      } else {\r\n        this._navigationQueue.push({ name, args });\r\n      }\r\n    }, 1);\r\n  }\r\n\r\n  registerRouter(name: string, router: NodeConstructor) {\r\n    name = name || \"Main\";\r\n    if (!this._routers[name]) {\r\n      this._routers[name] = [];\r\n    }\r\n\r\n    this._routers[name].push(router);\r\n\r\n    let hasNavigated = false;\r\n\r\n    let i = 0;\r\n    while (i < this._navigationQueue.length) {\r\n      const e = this._navigationQueue[i];\r\n      if (e.name === name) {\r\n        router.navigate(e.args);\r\n        hasNavigated = true;\r\n        this._navigationQueue.splice(i, 1);\r\n      } else {\r\n        i++;\r\n      }\r\n    }\r\n\r\n    if (!hasNavigated) {\r\n      router.reset(); //no navigation has happened, call reset() so the start page is created\r\n    }\r\n  }\r\n\r\n  deregisterRouter(name: string, router: NodeConstructor) {\r\n    name = name || \"Main\";\r\n\r\n    if (!this._routers[name]) {\r\n      return;\r\n    }\r\n\r\n    const index = this._routers[name].indexOf(router);\r\n    if (index === -1) {\r\n      return;\r\n    }\r\n\r\n    this._routers[name].splice(index, 1);\r\n    if (this._routers[name].length === 0) {\r\n      delete this._routers[name];\r\n    }\r\n  }\r\n\r\n  getPagesForRouter(name: string) {\r\n    const routerIndex = NoodlRuntime.instance.graphModel.routerIndex;\r\n    const routers = routerIndex!.routers;\r\n\r\n    if (routers === undefined || routers.length === 0) return [];\r\n\r\n    const matchingRouters =\r\n      name === undefined\r\n        ? [routers[0]]\r\n        : routers.filter((r) => r.name === name);\r\n\r\n    const pageComponents = new Set();\r\n    matchingRouters.forEach((r) => {\r\n      const pages = r.pages;\r\n      if (pages !== undefined && pages.routes !== undefined) {\r\n        pages.routes.forEach((r) => {\r\n          pageComponents.add(r);\r\n        });\r\n      }\r\n    });\r\n\r\n    return Array.from(pageComponents)\r\n      .map((c) => this.getPageInfoForComponent(String(c)))\r\n      .filter((item) => !!item);\r\n  }\r\n\r\n  getPageInfoForComponent(\r\n    componentName: string\r\n  ): ComponentPageInfo | undefined {\r\n    const routerIndex = NoodlRuntime.instance.graphModel.routerIndex;\r\n    const page = routerIndex!.pages.find((p) => p.component === componentName);\r\n    return page;\r\n  }\r\n\r\n  /**\r\n   * Occurs when the Router navigates to a new page.\r\n   *\r\n   * @param routerName\r\n   * @param page\r\n   */\r\n  onNavigated(routerName: string, page: ComponentPageInfo) {\r\n    // @ts-expect-error window.Noodl is not defined\r\n    window.Noodl.Events.emit(\"NoodlApp_Navigated\", {\r\n      routerName,\r\n      ...page,\r\n    });\r\n  }\r\n}\r\n","import { NodeDefinition } from \"@fluxscape/runtime/src/nodedefinition\";\r\nimport { RouterHandler } from \"./router-handler\";\r\n\r\ninterface Internal {\r\n  pageParams: any;\r\n  openInNewTab: boolean;\r\n  hasScheduledNavigate: boolean;\r\n  target: string;\r\n  router: string;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"RouterNavigate\",\r\n  displayNodeName: \"Navigate\",\r\n  category: \"Navigation\",\r\n  docs: \"https://docs.noodl.net/nodes/navigation/navigate\",\r\n  initialize() {\r\n    this._internal.pageParams = {};\r\n    this._internal.openInNewTab = false;\r\n  },\r\n  inputs: {\r\n    navigate: {\r\n      displayName: \"Navigate\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleNavigate();\r\n      },\r\n    },\r\n    openInNewTab: {\r\n      index: 10,\r\n      displayName: \"Open in new tab\",\r\n      group: \"General\",\r\n      default: false,\r\n      type: \"boolean\",\r\n      set(value: boolean) {\r\n        this._internal.openInNewTab = !!value;\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    navigated: {\r\n      type: \"signal\",\r\n      displayName: \"Navigated\",\r\n      group: \"Events\",\r\n    },\r\n  },\r\n  methods: {\r\n    scheduleNavigate() {\r\n      const internal = this._internal;\r\n      if (!internal.hasScheduledNavigate) {\r\n        internal.hasScheduledNavigate = true;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          internal.hasScheduledNavigate = false;\r\n          // @ts-expect-error\r\n          this.navigate();\r\n        });\r\n      }\r\n    },\r\n    navigate() {\r\n      RouterHandler.instance.navigate(this._internal.router, {\r\n        target: this._internal.target,\r\n        params: this._internal.pageParams,\r\n        openInNewTab: this._internal.openInNewTab,\r\n        hasNavigated: () => {\r\n          this.scheduleAfterInputsHaveUpdated(() => {\r\n            this.sendSignalOnOutput(\"navigated\");\r\n          });\r\n        },\r\n      });\r\n    },\r\n    setPageParam(param: string, value: any) {\r\n      this._internal.pageParams[param] = value;\r\n    },\r\n    setTargetPage(page: string) {\r\n      this._internal.target = page;\r\n    },\r\n    setRouter(value: any) {\r\n      this._internal.router = value;\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === \"target\") {\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setTargetPage.bind(this),\r\n        });\r\n      } else if (name === \"router\") {\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setRouter.bind(this),\r\n        });\r\n      } else if (name.startsWith(\"pm-\")) {\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setPageParam.bind(this, name.substring(\"pm-\".length)),\r\n        });\r\n      }\r\n    },\r\n  },\r\n};\r\n","import { GraphModel } from \"@fluxscape/runtime\";\r\nimport { NodeContext } from \"@fluxscape/runtime/src/nodecontext\";\r\nimport { NodeDefinition } from \"@fluxscape/runtime/src/nodedefinition\";\r\n\r\ninterface Internal {\r\n  popupParams: any;\r\n  closeResults: any;\r\n  hasScheduledShow: boolean;\r\n  target: string;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"NavigationShowPopup\",\r\n  displayNodeName: \"Show Popup\",\r\n  category: \"Navigation\",\r\n  docs: \"https://docs.noodl.net/nodes/popups/show-popup\",\r\n  initialize() {\r\n    this._internal.popupParams = {};\r\n    this._internal.closeResults = {};\r\n  },\r\n  inputs: {\r\n    target: {\r\n      type: \"component\",\r\n      displayName: \"Target\",\r\n      group: \"General\",\r\n      set(value: any) {\r\n        this._internal.target = value;\r\n      },\r\n    },\r\n    show: {\r\n      type: \"signal\",\r\n      displayName: \"Show\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleShow();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    Closed: {\r\n      type: \"signal\",\r\n    },\r\n  },\r\n  methods: {\r\n    setPopupParam(param: string, value: any) {\r\n      this._internal.popupParams[param] = value;\r\n    },\r\n    getCloseResult(param: string) {\r\n      return this._internal.closeResults[param];\r\n    },\r\n    scheduleShow() {\r\n      const internal = this._internal;\r\n      if (!internal.hasScheduledShow) {\r\n        internal.hasScheduledShow = true;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          internal.hasScheduledShow = false;\r\n          // @ts-expect-error\r\n          this.show();\r\n        });\r\n      }\r\n    },\r\n    show() {\r\n      if (this._internal.target === undefined) return;\r\n\r\n      this.context.showPopup(\r\n        this._internal.target,\r\n        this._internal.popupParams,\r\n        {\r\n          // @ts-expect-error\r\n          senderNode: this.nodeScope.componentOwner,\r\n          onClosePopup: (action: string | undefined, results: any) => {\r\n            this._internal.closeResults = results;\r\n\r\n            for (const key in results) {\r\n              if (this.hasOutput(\"closeResult-\" + key)) {\r\n                this.flagOutputDirty(\"closeResult-\" + key);\r\n              }\r\n            }\r\n\r\n            if (!action) {\r\n              this.sendSignalOnOutput(\"Closed\");\r\n            } else {\r\n              this.sendSignalOnOutput(action);\r\n            }\r\n          },\r\n        }\r\n      );\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"popupParam-\"))\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setPopupParam.bind(\r\n            this,\r\n            name.substring(\"popupParam-\".length)\r\n          ),\r\n        });\r\n    },\r\n    registerOutputIfNeeded(name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"closeResult-\"))\r\n        return this.registerOutput(name, {\r\n          // @ts-expect-error\r\n          getter: this.getCloseResult.bind(\r\n            this,\r\n            name.substring(\"closeResult-\".length)\r\n          ),\r\n        });\r\n\r\n      if (name.startsWith(\"closeAction-\"))\r\n        return this.registerOutput(name, {\r\n          getter() {\r\n            /** No needed for signals */\r\n          },\r\n        });\r\n    },\r\n  },\r\n};\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    function _updatePorts() {\r\n      const ports: any[] = [];\r\n\r\n      const targetComponentName = node.parameters[\"target\"];\r\n      if (targetComponentName !== undefined) {\r\n        // @ts-expect-error\r\n        const c = graphModel.components[targetComponentName];\r\n        if (c) {\r\n          for (const inputName in c.inputPorts) {\r\n            const o = c.inputPorts[inputName];\r\n            ports.push({\r\n              name: \"popupParam-\" + inputName,\r\n              displayName: inputName,\r\n              type: o.type || \"*\",\r\n              plug: \"input\",\r\n              group: \"Params\",\r\n            });\r\n          }\r\n\r\n          for (const _n of c.getNodesWithType(\"NavigationClosePopup\")) {\r\n            if (_n.parameters[\"closeActions\"] !== undefined) {\r\n              _n.parameters[\"closeActions\"].split(\",\").forEach((a: string) => {\r\n                if (ports.find((p) => p.name === a)) return;\r\n\r\n                ports.push({\r\n                  name: \"closeAction-\" + a,\r\n                  displayName: a,\r\n                  type: \"signal\",\r\n                  plug: \"output\",\r\n                  group: \"Close Actions\",\r\n                });\r\n              });\r\n            }\r\n\r\n            if (_n.parameters[\"results\"] !== undefined) {\r\n              _n.parameters[\"results\"].split(\",\").forEach((p: string) => {\r\n                ports.push({\r\n                  name: \"closeResult-\" + p,\r\n                  displayName: p,\r\n                  type: \"*\",\r\n                  plug: \"output\",\r\n                  group: \"Close Results\",\r\n                });\r\n              });\r\n            }\r\n          }\r\n        }\r\n      }\r\n      context.editorConnection?.sendDynamicPorts(node.id, ports);\r\n    }\r\n\r\n    function _trackTargetComponent(name: string | undefined) {\r\n      if (name === undefined) return;\r\n      // @ts-expect-error\r\n      const c = graphModel.components[name];\r\n      if (c === undefined) return;\r\n\r\n      c.on(\"inputPortAdded\", _updatePorts);\r\n      c.on(\"inputPortRemoved\", _updatePorts);\r\n\r\n      for (const _n of c.getNodesWithType(\"NavigationClosePopup\")) {\r\n        _n.on(\"parameterUpdated\", _updatePorts);\r\n      }\r\n\r\n      c.on(\"nodeAdded\", (_n: any) => {\r\n        if (_n.type === \"NavigationClosePopup\") {\r\n          _n.on(\"parameterUpdated\", _updatePorts);\r\n          _updatePorts();\r\n        }\r\n      });\r\n\r\n      c.on(\"nodeWasRemoved\", (_n: any) => {\r\n        if (_n.type === \"NavigationClosePopup\") _updatePorts();\r\n      });\r\n    }\r\n\r\n    _updatePorts();\r\n    _trackTargetComponent(node.parameters[\"target\"]);\r\n\r\n    node.on(\"parameterUpdated\", function (event: { name: string }) {\r\n      if (event.name === \"target\") {\r\n        _updatePorts();\r\n        _trackTargetComponent(node.parameters[\"target\"]);\r\n      }\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.NavigationShowPopup\", function (node: any) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"NavigationShowPopup\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","export class Transition {\r\n  private _frame: () => void;\r\n  private cb?: () => void;\r\n  private transitionForward: boolean = false;\r\n  private startTime: number = 0;\r\n\r\n  timing: { delay: number; dur: number } = { delay: 0, dur: 0 };\r\n\r\n  constructor() {\r\n    this._frame = this.frame.bind(this);\r\n    this.timing = { delay: 0, dur: 0 }; // Initialize timing with default values\r\n  }\r\n\r\n  start(args: { end: () => void; back: boolean }) {\r\n    this.cb = args.end;\r\n\r\n    if (this.timing.delay + this.timing.dur === 0) {\r\n      this.end();\r\n    } else {\r\n      this.transitionForward = !args.back;\r\n      this.startTime = window.performance.now();\r\n      requestAnimationFrame(this._frame);\r\n    }\r\n  }\r\n\r\n  frame() {\r\n    const t =\r\n      (window.performance.now() - (this.startTime + this.timing.delay)) /\r\n      this.timing.dur;\r\n    const _t = Math.max(0, Math.min(t, 1));\r\n\r\n    this.transitionForward ? this.forward(_t) : this.back(_t);\r\n\r\n    if (\r\n      window.performance.now() <=\r\n      this.startTime + this.timing.dur + this.timing.delay\r\n    ) {\r\n      requestAnimationFrame(this._frame);\r\n    } else {\r\n      this.end();\r\n    }\r\n  }\r\n\r\n  end() {\r\n    this.cb && this.cb();\r\n  }\r\n\r\n  forward(t: number) {\r\n    // Implementation of forward transition\r\n  }\r\n\r\n  back(t: number) {\r\n    // Implementation of back transition\r\n  }\r\n}\r\n","import { NoneTransition } from \"./transitions/none-transition\";\r\nimport { PushTransition } from \"./transitions/push-transition\";\r\nimport { PopupTransition } from \"./transitions/popup-transition\";\r\n\r\nexport const Transitions = {\r\n  None: NoneTransition,\r\n  Push: PushTransition,\r\n  Popup: PopupTransition,\r\n};\r\n","import { Transition } from \"./transition\";\r\n\r\nexport class NoneTransition extends Transition {\r\n  from: any;\r\n  to: any;\r\n\r\n  constructor(from: any, to: any, params: any) {\r\n    super();\r\n\r\n    this.from = from;\r\n    this.to = to;\r\n\r\n    this.timing = { dur: 0, delay: 0 };\r\n  }\r\n\r\n  update(t: number): void {}\r\n\r\n  forward(t: number): void {}\r\n\r\n  back(t: number): void {}\r\n\r\n  static ports(): any[] {\r\n    return [];\r\n  }\r\n}\r\n","import { Transition } from \"./transition\";\r\nimport BezierEasing from \"bezier-easing\";\r\n\r\ninterface Params {\r\n  timing?: { curve: number[]; dur: number; delay: number };\r\n  shift?: number | { value: number; unit: string };\r\n  direction?: \"Right\" | \"Left\" | \"Up\" | \"Down\" | \"In\" | \"Out\";\r\n  crossfade?: boolean;\r\n  darkoverlay?: boolean;\r\n  darkoverlayamount?: number;\r\n  zoom?: number | { value: number; unit: string };\r\n}\r\n\r\nexport class PushTransition extends Transition {\r\n  from: any;\r\n  to: any;\r\n  timing: { curve: number[]; dur: number; delay: number };\r\n  distance: { value: number; unit: string };\r\n  direction: \"Right\" | \"Left\" | \"Up\" | \"Down\" | \"In\" | \"Out\";\r\n  ease: (t: number) => number;\r\n  crossfade: boolean;\r\n  darkOverlay: any;\r\n  darkOverlayAmount: number;\r\n  zoom: { value: number; unit: string };\r\n\r\n  constructor(from: any, to: any, params: Params) {\r\n    super();\r\n\r\n    this.from = from;\r\n    this.to = to;\r\n\r\n    this.timing = params.timing || {\r\n      curve: [0.0, 0.0, 0.58, 1.0],\r\n      dur: 300,\r\n      delay: 0,\r\n    };\r\n    // @ts-expect-error\r\n    this.distance = params.shift || { value: 25, unit: \"%\" };\r\n    if (typeof this.distance === \"number\")\r\n      this.distance = { value: this.distance, unit: \"%\" };\r\n    this.direction = params.direction || \"Left\";\r\n\r\n    this.timing.curve[0] = Math.min(1, Math.max(0, this.timing.curve[0]));\r\n    this.timing.curve[2] = Math.min(1, Math.max(0, this.timing.curve[2]));\r\n    this.ease = BezierEasing.apply(null, this.timing.curve).get;\r\n\r\n    this.crossfade = params.crossfade === undefined ? false : params.crossfade;\r\n    this.darkOverlay =\r\n      params.darkoverlay === undefined ? true : params.darkoverlay;\r\n    this.darkOverlayAmount =\r\n      params.darkoverlayamount === undefined ? 0.5 : params.darkoverlayamount;\r\n\r\n    // @ts-expect-error\r\n    this.zoom = params.zoom || { value: 25, unit: \"%\" };\r\n    if (typeof this.zoom === \"number\")\r\n      this.zoom = { value: this.zoom, unit: \"%\" };\r\n\r\n    if (this.darkOverlay) {\r\n      this.darkOverlay = from.nodeScope.createPrimitiveNode(\"Group\");\r\n      this.darkOverlay.setInputValue(\"position\", \"absolute\");\r\n      this.darkOverlay.setInputValue(\"sizeMode\", \"explicit\");\r\n      this.darkOverlay.setInputValue(\"width\", { value: 100, unit: \"%\" });\r\n      this.darkOverlay.setInputValue(\"height\", { value: 100, unit: \"%\" });\r\n      this.darkOverlay.setInputValue(\"backgroundColor\", \"#000000\");\r\n      this.darkOverlay.setInputValue(\"opacity\", 0);\r\n    }\r\n  }\r\n\r\n  update(t: number) {\r\n    if (this.direction === \"In\" || this.direction === \"Out\") {\r\n      let zoom = this.zoom.value / 100;\r\n\r\n      zoom = this.direction === \"Out\" ? -zoom : zoom;\r\n\r\n      this.from.setStyle({\r\n        transform: \"scale(\" + (1 + zoom * t) + \")\",\r\n        opacity: this.crossfade ? 1 - t : 1,\r\n      });\r\n\r\n      this.to.setStyle({\r\n        transform: \"scale(\" + (1 - zoom * (1 - t)) + \")\",\r\n        opacity: this.crossfade ? t : 1,\r\n      });\r\n    } else {\r\n      const dist = this.distance.value;\r\n      const unit = this.distance.unit;\r\n\r\n      const targets = {\r\n        Up: { x: 0, y: -1 },\r\n        Down: { x: 0, y: 1 },\r\n        Left: { x: -1, y: 0 },\r\n        Right: { x: 1, y: 0 },\r\n      };\r\n\r\n      const from = {\r\n        x: targets[this.direction].x * dist,\r\n        y: targets[this.direction].y * dist,\r\n      };\r\n\r\n      const target = {\r\n        x: targets[this.direction].x * 100,\r\n        y: targets[this.direction].y * 100,\r\n      };\r\n\r\n      this.from.setStyle({\r\n        transform:\r\n          \"translate(\" + from.x * t + unit + \",\" + from.y * t + unit + \")\",\r\n        opacity: this.crossfade ? 1 - t : 1,\r\n      });\r\n\r\n      this.to.setStyle({\r\n        transform:\r\n          \"translate(\" +\r\n          target.x * (t - 1) +\r\n          unit +\r\n          \",\" +\r\n          target.y * (t - 1) +\r\n          \"%)\",\r\n        opacity: this.crossfade ? t : 1,\r\n      });\r\n    }\r\n\r\n    if (this.darkOverlay) {\r\n      this.darkOverlay.setStyle({\r\n        opacity: t * this.darkOverlayAmount,\r\n      });\r\n    }\r\n  }\r\n\r\n  forward(t: number) {\r\n    const _t = this.ease(t);\r\n    this.update(_t);\r\n  }\r\n\r\n  back(t: number) {\r\n    const _t = this.ease(t);\r\n    this.update(1 - _t);\r\n  }\r\n\r\n  start(args: any) {\r\n    super.start(args);\r\n    if (this.darkOverlay) {\r\n      this.from.addChild(this.darkOverlay);\r\n    }\r\n  }\r\n\r\n  end() {\r\n    if (this.darkOverlay) {\r\n      this.from.removeChild(this.darkOverlay);\r\n    }\r\n    super.end();\r\n  }\r\n\r\n  static ports(parameters: any) {\r\n    const ports: any[] = [];\r\n\r\n    ports.push({\r\n      name: \"tr-direction\",\r\n      displayName: \"Direction\",\r\n      group: \"Transition\",\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\"Right\", \"Left\", \"Up\", \"Down\", \"In\", \"Out\"],\r\n      },\r\n      default: \"Left\",\r\n      plug: \"input\",\r\n    });\r\n\r\n    if (\r\n      parameters[\"tr-direction\"] === \"In\" ||\r\n      parameters[\"tr-direction\"] === \"Out\"\r\n    ) {\r\n      ports.push({\r\n        name: \"tr-zoom\",\r\n        displayName: \"Zoom\",\r\n        group: \"Transition\",\r\n        type: { name: \"number\", units: [\"%\"] },\r\n        default: { value: 25, unit: \"%\" },\r\n        plug: \"input\",\r\n      });\r\n    } else {\r\n      ports.push({\r\n        name: \"tr-shift\",\r\n        displayName: \"Shift Distance\",\r\n        group: \"Transition\",\r\n        type: { name: \"number\", units: [\"%\", \"px\"] },\r\n        default: { value: 25, unit: \"%\" },\r\n        plug: \"input\",\r\n      });\r\n    }\r\n\r\n    ports.push({\r\n      name: \"tr-crossfade\",\r\n      displayName: \"Crossfade\",\r\n      group: \"Transition\",\r\n      type: \"boolean\",\r\n      default: false,\r\n      plug: \"input\",\r\n    });\r\n\r\n    ports.push({\r\n      name: \"tr-darkoverlay\",\r\n      displayName: \"Dark Overlay\",\r\n      group: \"Transition\",\r\n      type: \"boolean\",\r\n      default: true,\r\n      plug: \"input\",\r\n    });\r\n\r\n    ports.push({\r\n      name: \"tr-darkoverlayamount\",\r\n      displayName: \"Dark Overlay Amount\",\r\n      group: \"Transition\",\r\n      type: \"number\",\r\n      default: 0.5,\r\n      plug: \"input\",\r\n    });\r\n\r\n    ports.push({\r\n      name: \"tr-timing\",\r\n      displayName: \"Timing\",\r\n      group: \"Transition\",\r\n      type: \"curve\",\r\n      plug: \"input\",\r\n    });\r\n\r\n    return ports;\r\n  }\r\n}\r\n","import { Transition } from \"./transition\";\r\nimport BezierEasing from \"bezier-easing\";\r\n\r\ninterface Params {\r\n  timing?: { curve: number[]; dur: number; delay: number };\r\n  shift?: number | { value: number; unit: string };\r\n  direction?: \"Right\" | \"Left\" | \"Up\" | \"Down\" | \"In\" | \"Out\";\r\n  fadein?: boolean;\r\n  zoom?: number | { value: number; unit: string };\r\n}\r\n\r\nexport class PopupTransition extends Transition {\r\n  from: any;\r\n  to: any;\r\n  timing: { curve: number[]; dur: number; delay: number };\r\n  distance: { value: number; unit: string };\r\n  direction: \"Right\" | \"Left\" | \"Up\" | \"Down\" | \"In\" | \"Out\";\r\n  ease: (t: number) => number;\r\n  fadein: boolean;\r\n  zoom: { value: number; unit: string };\r\n\r\n  constructor(from: any, to: any, params: Params) {\r\n    super();\r\n\r\n    this.from = from;\r\n    this.to = to;\r\n\r\n    this.timing = params.timing || {\r\n      curve: [0.0, 0.0, 0.58, 1.0],\r\n      dur: 300,\r\n      delay: 0,\r\n    };\r\n    // @ts-expect-error\r\n    this.distance = params.shift || { value: 25, unit: \"%\" };\r\n    if (typeof this.distance === \"number\")\r\n      this.distance = { value: this.distance, unit: \"%\" };\r\n    this.direction = params.direction || \"Right\";\r\n\r\n    this.timing.curve[0] = Math.min(1, Math.max(0, this.timing.curve[0]));\r\n    this.timing.curve[2] = Math.min(1, Math.max(0, this.timing.curve[2]));\r\n    this.ease = BezierEasing.apply(null, this.timing.curve).get;\r\n\r\n    this.fadein = params.fadein === undefined ? false : params.fadein;\r\n\r\n    // @ts-expect-error\r\n    this.zoom = params.zoom || { value: 25, unit: \"%\" };\r\n    if (typeof this.zoom === \"number\")\r\n      this.zoom = { value: this.zoom, unit: \"%\" };\r\n  }\r\n\r\n  update(t: number) {\r\n    if (this.direction === \"In\" || this.direction === \"Out\") {\r\n      let zoom = this.zoom.value / 100;\r\n\r\n      zoom = this.direction === \"Out\" ? -zoom : zoom;\r\n\r\n      this.to.setStyle({\r\n        transform: \"scale(\" + (1 - zoom * (1 - t)) + \")\",\r\n        // @ts-expect-error\r\n        opacity: this.crossfade ? t : 1,\r\n      });\r\n    } else {\r\n      const dist = this.distance.value;\r\n      const unit = this.distance.unit;\r\n\r\n      const targets: { [key: string]: { x: number; y: number } } = {\r\n        Up: { x: 0, y: -1 },\r\n        Down: { x: 0, y: 1 },\r\n        Left: { x: -1, y: 0 },\r\n        Right: { x: 1, y: 0 },\r\n      };\r\n      const target = {\r\n        x: targets[this.direction].x * dist,\r\n        y: targets[this.direction].y * dist,\r\n      };\r\n\r\n      this.to.setStyle({\r\n        transform:\r\n          \"translate(\" +\r\n          target.x * (t - 1) +\r\n          unit +\r\n          \",\" +\r\n          target.y * (t - 1) +\r\n          unit +\r\n          \")\",\r\n        opacity: this.fadein ? t : 1,\r\n      });\r\n    }\r\n  }\r\n\r\n  forward(t: number) {\r\n    const _t = this.ease(t);\r\n    this.update(_t);\r\n  }\r\n\r\n  back(t: number) {\r\n    const _t = this.ease(t);\r\n    this.update(1 - _t);\r\n  }\r\n\r\n  static ports(parameters: any) {\r\n    const ports: any[] = [];\r\n\r\n    ports.push({\r\n      name: \"tr-direction\",\r\n      displayName: \"Direction\",\r\n      group: \"Transition\",\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\"Right\", \"Left\", \"Up\", \"Down\", \"In\", \"Out\"],\r\n      },\r\n      default: \"Right\",\r\n      plug: \"input\",\r\n    });\r\n\r\n    if (\r\n      parameters[\"tr-direction\"] === \"In\" ||\r\n      parameters[\"tr-direction\"] === \"Out\"\r\n    ) {\r\n      ports.push({\r\n        name: \"tr-zoom\",\r\n        displayName: \"Zoom\",\r\n        group: \"Transition\",\r\n        type: { name: \"number\", units: [\"%\"] },\r\n        default: { value: 25, unit: \"%\" },\r\n        plug: \"input\",\r\n      });\r\n    } else {\r\n      ports.push({\r\n        name: \"tr-shift\",\r\n        displayName: \"Shift Distance\",\r\n        group: \"Transition\",\r\n        type: { name: \"number\", units: [\"%\", \"px\"] },\r\n        default: { value: 25, unit: \"%\" },\r\n        plug: \"input\",\r\n      });\r\n    }\r\n\r\n    ports.push({\r\n      name: \"tr-fadein\",\r\n      displayName: \"Fade In\",\r\n      group: \"Transition\",\r\n      type: \"boolean\",\r\n      default: false,\r\n      plug: \"input\",\r\n    });\r\n\r\n    ports.push({\r\n      name: \"tr-timing\",\r\n      displayName: \"Timing\",\r\n      group: \"Transition\",\r\n      type: \"curve\",\r\n      plug: \"input\",\r\n    });\r\n\r\n    return ports;\r\n  }\r\n}\r\n","import { NodeDefinition } from \"@fluxscape/runtime\";\r\nimport EaseCurves from \"../../easecurves\";\r\n\r\nconst defaultDuration = 300;\r\n\r\ninterface Internal {\r\n  currentNumber: number;\r\n  numberInitialized: boolean;\r\n  animationStarted: boolean;\r\n  setCurrentNumberEnabled: boolean;\r\n  overrideValue: number;\r\n  _animation: any;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"net.noodl.animatetovalue\",\r\n  docs: \"https://docs.noodl.net/nodes/logic/animate-to-value\",\r\n  displayName: \"Animate To Value\",\r\n  shortDesc:\r\n    \"This node can interpolate smoothly from the current value to a target value.\",\r\n  category: \"Animation\",\r\n  initialize() {\r\n    const _internal = this._internal;\r\n\r\n    _internal.currentNumber = 0;\r\n    _internal.numberInitialized = false;\r\n    _internal.animationStarted = false;\r\n    _internal.setCurrentNumberEnabled = false;\r\n    _internal.overrideValue = 0;\r\n\r\n    _internal._animation = this.context.timerScheduler.createTimer({\r\n      duration: defaultDuration,\r\n      startValue: 0,\r\n      endValue: 0,\r\n      ease: EaseCurves.easeOut,\r\n      onStart: () => {\r\n        _internal.animationStarted = true;\r\n      },\r\n      onRunning: (t) => {\r\n        // @ts-expect-error\r\n        _internal.currentNumber = this.ease(this.startValue, this.endValue, t);\r\n        this.flagOutputDirty(\"currentValue\");\r\n      },\r\n      onFinish: () => {\r\n        this.sendSignalOnOutput(\"atTargetValue\");\r\n      },\r\n    });\r\n  },\r\n  getInspectInfo() {\r\n    return this._internal.currentNumber;\r\n  },\r\n  inputs: {\r\n    targetValue: {\r\n      type: { name: \"number\" },\r\n      displayName: \"Target Value\",\r\n      group: \"Target Value\",\r\n      default: undefined,\r\n      set(value) {\r\n        if (value === true) {\r\n          value = 1;\r\n        } else if (value === false) {\r\n          value = 0;\r\n        }\r\n\r\n        value = Number(value);\r\n\r\n        if (isNaN(value)) {\r\n          return;\r\n        }\r\n\r\n        const internal = this._internal;\r\n\r\n        if (!internal.numberInitialized) {\r\n          internal.currentNumber = value;\r\n          internal.numberInitialized = true;\r\n          internal._animation.endValue = value;\r\n          this.flagOutputDirty(\"currentValue\");\r\n          return;\r\n        } else if (value === internal._animation.endValue) {\r\n          return;\r\n        }\r\n\r\n        internal._animation.startValue = internal.currentNumber;\r\n        internal._animation.endValue = value;\r\n        internal._animation.start();\r\n      },\r\n    },\r\n    duration: {\r\n      type: \"number\",\r\n      group: \"Parameters\",\r\n      displayName: \"Duration\",\r\n      default: defaultDuration,\r\n      set(value) {\r\n        this._internal._animation.duration = value;\r\n      },\r\n    },\r\n    delay: {\r\n      type: \"number\",\r\n      group: \"Parameters\",\r\n      displayName: \"Delay\",\r\n      default: 0,\r\n      set(value) {\r\n        this._internal._animation.delay = value;\r\n      },\r\n    },\r\n    easingCurve: {\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { value: \"easeOut\", label: \"Ease Out\" },\r\n          { value: \"easeIn\", label: \"Ease In\" },\r\n          { value: \"linear\", label: \"Linear\" },\r\n          { value: \"easeInOut\", label: \"Ease In Out\" },\r\n        ],\r\n      },\r\n      default: \"easeOut\",\r\n      displayName: \"Easing Curve\",\r\n      group: \"Parameters\",\r\n      set(value) {\r\n        this._internal._animation.ease = EaseCurves[value];\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    currentValue: {\r\n      type: \"number\",\r\n      displayName: \"Current Value\",\r\n      group: \"Current State\",\r\n      getter() {\r\n        return this._internal.currentNumber;\r\n      },\r\n    },\r\n    atTargetValue: {\r\n      type: \"signal\",\r\n      displayName: \"At Target Value\",\r\n      group: \"Signals\",\r\n    },\r\n  },\r\n};\r\n","import { NodeDefinition } from \"@fluxscape/runtime\";\r\nimport EaseCurves from \"../../easecurves\";\r\n\r\nfunction clamp(min: number, max: number, value: number): number {\r\n  return Math.max(min, Math.min(max, value));\r\n}\r\n\r\nfunction setRGB(result: number[], hex: string): void {\r\n  for (let i = 0; i < 3; ++i) {\r\n    const index = 1 + i * 2;\r\n    result[i] = parseInt(hex.substring(index, index + 2), 16);\r\n  }\r\n}\r\n\r\nfunction componentToHex(c: number): string {\r\n  const hex = c.toString(16);\r\n  return hex.length === 1 ? \"0\" + hex : hex;\r\n}\r\n\r\nfunction rgbToHex(rgb: number[]): string {\r\n  return (\r\n    \"#\" +\r\n    componentToHex(rgb[0]) +\r\n    componentToHex(rgb[1]) +\r\n    componentToHex(rgb[2])\r\n  );\r\n}\r\n\r\n// Reusing these to reduce GC pressure\r\nlet rgb0: number[] = [0, 0, 0];\r\nlet rgb1: number[] = [0, 0, 0];\r\nlet rgb2: number[] = [0, 0, 0];\r\n\r\ninterface Internal {\r\n  resultColor: string;\r\n  blendValue: number;\r\n  colors: string[];\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Color Blend\",\r\n  docs: \"https://docs.noodl.net/nodes/utilities/color-blend\",\r\n  shortDesc:\r\n    \"Given any number of input colors this node can interpolate between these and give the result color as output.\",\r\n  category: \"Interpolation\",\r\n  getInspectInfo() {\r\n    return [{ type: \"color\", value: this._internal.resultColor }];\r\n  },\r\n  initialize() {\r\n    const internal = this._internal;\r\n\r\n    internal.resultColor = \"#000000\";\r\n    internal.blendValue = 0;\r\n    internal.colors = [];\r\n  },\r\n  numberedInputs: {\r\n    color: {\r\n      type: \"color\",\r\n      displayPrefix: \"Color\",\r\n      createSetter(index: number) {\r\n        return (value: string) => {\r\n          // @ts-expect-error\r\n          this._internal.colors[index] = value;\r\n          // @ts-expect-error\r\n          this.updateColor();\r\n        };\r\n      },\r\n    },\r\n  },\r\n  inputs: {\r\n    blendValue: {\r\n      type: \"number\",\r\n      displayName: \"Blend Value\",\r\n      default: 0,\r\n      set(value: number) {\r\n        this._internal.blendValue = value;\r\n        // @ts-expect-error\r\n        this.updateColor();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    result: {\r\n      type: \"color\",\r\n      displayName: \"Result\",\r\n      getter() {\r\n        return this._internal.resultColor;\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    updateColor() {\r\n      const colors = this._internal.colors;\r\n      if (colors.length === 0) {\r\n        return;\r\n      }\r\n\r\n      const getColor = (index: number): string => {\r\n        return colors[index] ? colors[index] : \"#000000\";\r\n      };\r\n\r\n      const clampedBlendValue = clamp(\r\n        0,\r\n        colors.length - 1,\r\n        this._internal.blendValue\r\n      );\r\n      const index = Math.floor(clampedBlendValue);\r\n      const t = clampedBlendValue - index;\r\n\r\n      if (t === 0) {\r\n        this._internal.resultColor = getColor(index);\r\n      } else {\r\n        setRGB(rgb0, getColor(index));\r\n        setRGB(rgb1, getColor(index + 1));\r\n\r\n        rgb2[0] = Math.floor(EaseCurves.linear(rgb0[0], rgb1[0], t));\r\n        rgb2[1] = Math.floor(EaseCurves.linear(rgb0[1], rgb1[1], t));\r\n        rgb2[2] = Math.floor(EaseCurves.linear(rgb0[2], rgb1[2], t));\r\n        this._internal.resultColor = rgbToHex(rgb2);\r\n      }\r\n\r\n      this.flagOutputDirty(\"result\");\r\n    },\r\n  },\r\n};\r\n","import {\r\n  EditorConnection,\r\n  GraphModel,\r\n  Model,\r\n  NodeContext,\r\n  NodeDefinition,\r\n} from \"@fluxscape/runtime\";\r\n\r\nexport interface SetComponentObjectState {\r\n  inputValues: Record<string, any>;\r\n  hasScheduledStore: boolean;\r\n}\r\n\r\nexport function extendSetComponentObjectProperties(\r\n  def: NodeDefinition<SetComponentObjectState> & {\r\n    getComponentObjectId: () => string | undefined;\r\n  }\r\n) {\r\n  const SetComponentObjectProperties: NodeDefinition<SetComponentObjectState> =\r\n    {\r\n      name: def.name,\r\n      displayNodeName: def.displayName,\r\n      category: \"Component Utilities\",\r\n      color: \"component\",\r\n      docs: def.docs,\r\n      initialize: function () {\r\n        this._internal.inputValues = {};\r\n      },\r\n      inputs: {\r\n        properties: {\r\n          type: {\r\n            name: \"stringlist\",\r\n            allowEditOnly: true,\r\n          },\r\n          displayName: \"Properties\",\r\n          group: \"Properties\",\r\n          set(value) {},\r\n        },\r\n        store: {\r\n          type: \"signal\",\r\n          group: \"Actions\",\r\n          displayName: \"Do\",\r\n          valueChangedToTrue() {\r\n            // @ts-expect-error\r\n            this.scheduleStore();\r\n          },\r\n        },\r\n      },\r\n      outputs: {\r\n        stored: {\r\n          type: \"signal\",\r\n          group: \"Events\",\r\n          displayName: \"Done\",\r\n        },\r\n      },\r\n      methods: {\r\n        getComponentObjectId: def.getComponentObjectId,\r\n        scheduleStore() {\r\n          // @ts-expect-error\r\n          if (this.hasScheduledStore) return;\r\n          // @ts-expect-error\r\n          this.hasScheduledStore = true;\r\n\r\n          const internal = this._internal;\r\n          this.scheduleAfterInputsHaveUpdated(() => {\r\n            // @ts-expect-error\r\n            const model = Model.get(this.getComponentObjectId());\r\n            // @ts-expect-error\r\n            this.hasScheduledStore = false;\r\n\r\n            // @ts-expect-error\r\n            const properties = this.model.parameters.properties || \"\";\r\n            const validProperties = properties.split(\",\");\r\n\r\n            const keysToSet = Object.keys(internal.inputValues).filter(\r\n              (key) => validProperties.indexOf(key) !== -1\r\n            );\r\n\r\n            for (const i of keysToSet) {\r\n              model.set(i, internal.inputValues[i], { resolve: true });\r\n            }\r\n            this.sendSignalOnOutput(\"stored\");\r\n          });\r\n        },\r\n        registerInputIfNeeded: function (name: string) {\r\n          if (this.hasInput(name)) {\r\n            return;\r\n          }\r\n\r\n          if (name.startsWith(\"prop-\")) {\r\n            const propertyName = name.substring(\"prop-\".length);\r\n            this.registerInput(name, {\r\n              set(value) {\r\n                this._internal.inputValues[propertyName] = value;\r\n              },\r\n            });\r\n          } else if (name.startsWith(\"type-\")) {\r\n            this.registerInput(name, {\r\n              set(value) {},\r\n            });\r\n          }\r\n        },\r\n      },\r\n    };\r\n\r\n  function updatePorts(\r\n    nodeId: string,\r\n    parameters: any,\r\n    editorConnection: EditorConnection\r\n  ) {\r\n    const ports: any[] = [];\r\n\r\n    const _types = [\r\n      { label: \"String\", value: \"string\" },\r\n      { label: \"Boolean\", value: \"boolean\" },\r\n      { label: \"Number\", value: \"number\" },\r\n      { label: \"Date\", value: \"date\" },\r\n      { label: \"Array\", value: \"array\" },\r\n      { label: \"Object\", value: \"object\" },\r\n      { label: \"Any\", value: \"*\" },\r\n    ];\r\n\r\n    // Add value outputs\r\n    let properties = parameters.properties;\r\n    if (properties) {\r\n      properties = properties ? properties.split(\",\") : undefined;\r\n      for (const p of properties) {\r\n        // Property input\r\n        ports.push({\r\n          type: {\r\n            name:\r\n              parameters[\"type-\" + p] === undefined\r\n                ? \"*\"\r\n                : parameters[\"type-\" + p],\r\n          },\r\n          plug: \"input\",\r\n          group: \"Property Values\",\r\n          displayName: p,\r\n          name: \"prop-\" + p,\r\n        });\r\n\r\n        // Property type\r\n        ports.push({\r\n          type: {\r\n            name: \"enum\",\r\n            enums: _types,\r\n            allowEditOnly: true,\r\n          },\r\n          plug: \"input\",\r\n          group: \"Property Types\",\r\n          displayName: p,\r\n          default: \"*\",\r\n          name: \"type-\" + p,\r\n        });\r\n      }\r\n    }\r\n\r\n    editorConnection.sendDynamicPorts(nodeId, ports, {\r\n      detectRenamed: {\r\n        plug: \"input\",\r\n      },\r\n    });\r\n  }\r\n\r\n  return {\r\n    node: SetComponentObjectProperties,\r\n    setup(context: NodeContext, graphModel: GraphModel) {\r\n      if (\r\n        !context.editorConnection ||\r\n        !context.editorConnection.isRunningLocally()\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      graphModel.on(\"nodeAdded.\" + def.name, (node: any) => {\r\n        updatePorts(node.id, node.parameters, context.editorConnection!);\r\n\r\n        node.on(\"parameterUpdated\", (event: any) => {\r\n          if (event.name === \"properties\" || event.name.startsWith(\"type-\")) {\r\n            updatePorts(node.id, node.parameters, context.editorConnection!);\r\n          }\r\n        });\r\n      });\r\n    },\r\n  };\r\n}\r\n","import {\r\n  GraphModel,\r\n  Node,\r\n  NodeContext,\r\n  NodeDefinition,\r\n  Model,\r\n  EditorConnection,\r\n} from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  inputValues: Record<string, any>;\r\n  dirtyValues: Record<string, boolean>;\r\n  model: any;\r\n  onModelChangedCallback: (args: { name: string }) => void;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"net.noodl.ComponentObject\",\r\n  displayNodeName: \"Component Object\",\r\n  category: \"Component Utilities\",\r\n  color: \"component\",\r\n  docs: \"https://docs.noodl.net/nodes/component-utilities/component-object\",\r\n  initialize() {\r\n    // @ts-expect-error\r\n    this._internal = {\r\n      inputValues: {},\r\n      dirtyValues: {},\r\n      onModelChangedCallback: (args) => {\r\n        if (this.isInputConnected(\"fetch\") !== false) return;\r\n\r\n        if (this.hasOutput(\"value-\" + args.name)) {\r\n          this.flagOutputDirty(\"value-\" + args.name);\r\n        }\r\n\r\n        if (this.hasOutput(\"changed-\" + args.name)) {\r\n          this.sendSignalOnOutput(\"changed-\" + args.name);\r\n        }\r\n\r\n        this.sendSignalOnOutput(\"changed\");\r\n      },\r\n    };\r\n\r\n    const model = Model.get(\r\n      // @ts-expect-error\r\n      \"componentState\" + this.nodeScope.componentOwner.getInstanceId()\r\n    );\r\n    this._internal.model = model;\r\n\r\n    model.on(\"change\", this._internal.onModelChangedCallback);\r\n  },\r\n  getInspectInfo() {\r\n    return {\r\n      type: \"value\",\r\n      value: this._internal.model.data,\r\n    };\r\n  },\r\n  inputs: {\r\n    properties: {\r\n      type: {\r\n        name: \"stringlist\",\r\n        allowEditOnly: true,\r\n      },\r\n      displayName: \"Properties\",\r\n      group: \"Properties\",\r\n      set(value: any) {},\r\n    },\r\n    fetch: {\r\n      displayName: \"Fetch\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleFetch();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    changed: {\r\n      type: \"signal\",\r\n      displayName: \"Changed\",\r\n      group: \"Events\",\r\n    },\r\n    fetched: {\r\n      type: \"signal\",\r\n      displayName: \"Fetched\",\r\n      group: \"Events\",\r\n    },\r\n  },\r\n  methods: {\r\n    scheduleStore() {\r\n      // @ts-expect-error\r\n      if (this.hasScheduledStore) return;\r\n      // @ts-expect-error\r\n      this.hasScheduledStore = true;\r\n\r\n      const internal = this._internal;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.hasScheduledStore = false;\r\n        for (const i in internal.dirtyValues) {\r\n          internal.model.set(i, internal.inputValues[i], { resolve: true });\r\n        }\r\n        internal.dirtyValues = {};\r\n      });\r\n    },\r\n    scheduleFetch() {\r\n      // @ts-expect-error\r\n      if (this.hasScheduledFetch) return;\r\n      // @ts-expect-error\r\n      this.hasScheduledFetch = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.hasScheduledFetch = false;\r\n        // @ts-expect-error\r\n        this.fetch();\r\n      });\r\n    },\r\n    fetch() {\r\n      for (const key in this._internal.model.data) {\r\n        if (this.hasOutput(\"value-\" + key)) {\r\n          this.flagOutputDirty(\"value-\" + key);\r\n          if (this.hasOutput(\"changed-\" + key)) {\r\n            this.sendSignalOnOutput(\"changed-\" + key);\r\n          }\r\n        }\r\n      }\r\n      this.sendSignalOnOutput(\"fetched\");\r\n    },\r\n    _onNodeDeleted() {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      this._internal.model.off(\"change\", this._internal.onModelChangedCallback);\r\n    },\r\n    registerOutputIfNeeded(name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      const split = name.split(\"-\");\r\n      const propertyName = split[split.length - 1];\r\n\r\n      this.registerOutput(name, {\r\n        get() {\r\n          return this._internal.model.get(propertyName, { resolve: true });\r\n        },\r\n      });\r\n    },\r\n    registerInputIfNeeded: function (name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"value-\")) {\r\n        const propertyName = name.substring(\"value-\".length);\r\n        this.registerInput(name, {\r\n          set(value: any) {\r\n            this._internal.inputValues[propertyName] = value;\r\n            this._internal.dirtyValues[propertyName] = true;\r\n\r\n            // @ts-expect-error\r\n            this.scheduleStore();\r\n          },\r\n        });\r\n      }\r\n    },\r\n  },\r\n};\r\n\r\nfunction updatePorts(\r\n  nodeId: string,\r\n  parameters: any,\r\n  editorConnection: EditorConnection\r\n) {\r\n  const ports: any[] = [];\r\n\r\n  // Add value outputs\r\n  if (parameters.properties) {\r\n    const properties = parameters.properties.split(\",\");\r\n    for (const p of properties) {\r\n      ports.push({\r\n        type: {\r\n          name: \"*\",\r\n          allowConnectionsOnly: true,\r\n        },\r\n        plug: \"input/output\",\r\n        group: \"Properties\",\r\n        name: \"value-\" + p,\r\n        displayName: p,\r\n      });\r\n\r\n      ports.push({\r\n        type: \"signal\",\r\n        plug: \"output\",\r\n        group: \"Changed Events\",\r\n        displayName: p + \" Changed\",\r\n        name: \"changed-\" + p,\r\n      });\r\n    }\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports, {\r\n    detectRenamed: {\r\n      plug: \"input/output\",\r\n    },\r\n  });\r\n}\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  graphModel.on(\"nodeAdded.net.noodl.ComponentObject\", (node: any) => {\r\n    updatePorts(node.id, node.parameters, context.editorConnection!);\r\n\r\n    node.on(\"parameterUpdated\", (event: any) => {\r\n      if (event.name === \"properties\") {\r\n        updatePorts(node.id, node.parameters, context.editorConnection!);\r\n      }\r\n    });\r\n  });\r\n}\r\n","import {\r\n  Node,\r\n  NodeDefinition,\r\n  Model,\r\n  NodeContext,\r\n  GraphModel,\r\n} from \"@fluxscape/runtime\";\r\nimport { EventEmitter } from \"events\";\r\n\r\nconst graphEventEmitter = new EventEmitter();\r\ngraphEventEmitter.setMaxListeners(1000000);\r\n\r\ninterface Internal {\r\n  inputValues: Record<string, any>;\r\n  modelId?: string;\r\n  parentComponentName?: string;\r\n  model?: any;\r\n  hasScheduledStore?: boolean;\r\n  onModelChangedCallback?: (args: { name: string }) => void;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"net.noodl.ParentComponentObject\",\r\n  displayNodeName: \"Parent Component Object\",\r\n  category: \"Component Utilities\",\r\n  color: \"component\",\r\n  docs: \"https://docs.noodl.net/nodes/component-utilities/parent-component-object\",\r\n  initialize() {\r\n    this._internal.inputValues = {};\r\n\r\n    this._internal.onModelChangedCallback = (args) => {\r\n      if (this.isInputConnected(\"fetch\") !== false) return;\r\n\r\n      if (this.hasOutput(\"value-\" + args.name)) {\r\n        this.flagOutputDirty(\"value-\" + args.name);\r\n      }\r\n\r\n      if (this.hasOutput(\"changed-\" + args.name)) {\r\n        this.sendSignalOnOutput(\"changed-\" + args.name);\r\n      }\r\n\r\n      this.sendSignalOnOutput(\"changed\");\r\n    };\r\n\r\n    //TODO: don't listen for delta updates when running deployed\r\n    // @ts-expect-error\r\n    this.onComponentStateNodesChanged = () => {\r\n      // @ts-expect-error\r\n      const id = this.findParentComponentStateModelId();\r\n\r\n      if (this._internal.modelId !== id) {\r\n        this._internal.modelId = id;\r\n\r\n        if (this.isInputConnected(\"fetch\") === false) {\r\n          // @ts-expect-error\r\n          this.setModelId(this._internal.modelId);\r\n        }\r\n      }\r\n    };\r\n\r\n    graphEventEmitter.on(\r\n      \"componentStateNodesChanged\",\r\n      // @ts-expect-error\r\n      this.onComponentStateNodesChanged\r\n    );\r\n\r\n    // @ts-expect-error\r\n    this.updateComponentState();\r\n  },\r\n\r\n  nodeScopeDidInitialize() {\r\n    if (!this._internal.modelId) {\r\n      // @ts-expect-error\r\n      this.context.scheduleAfterUpdate(() => {\r\n        // @ts-expect-error\r\n        this.updateComponentState();\r\n      });\r\n    }\r\n  },\r\n\r\n  getInspectInfo() {\r\n    const model = this._internal.model;\r\n    if (!model) return \"No parent component state found\";\r\n\r\n    const modelInfo = [\r\n      { type: \"text\", value: this._internal.parentComponentName },\r\n    ];\r\n\r\n    const data = this._internal.model.data;\r\n    return modelInfo.concat(\r\n      Object.keys(data).map((key) => {\r\n        return { type: \"text\", value: key + \": \" + data[key] };\r\n      })\r\n    );\r\n  },\r\n\r\n  inputs: {\r\n    properties: {\r\n      type: {\r\n        name: \"stringlist\",\r\n        allowEditOnly: true,\r\n      },\r\n      displayName: \"Properties\",\r\n      group: \"Properties\",\r\n      set(value) {},\r\n    },\r\n    fetch: {\r\n      displayName: \"Fetch\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue: function () {\r\n        // @ts-expect-error\r\n        this.setModelId(this._internal.modelId);\r\n      },\r\n    },\r\n  },\r\n\r\n  outputs: {\r\n    changed: {\r\n      type: \"signal\",\r\n      displayName: \"Changed\",\r\n      group: \"Events\",\r\n    },\r\n    fetched: {\r\n      type: \"signal\",\r\n      displayName: \"Fetched\",\r\n      group: \"Events\",\r\n    },\r\n  },\r\n\r\n  methods: {\r\n    updateComponentState() {\r\n      // @ts-expect-error\r\n      this._internal.modelId = this.findParentComponentStateModelId();\r\n      if (this.isInputConnected(\"fetch\") === false) {\r\n        // @ts-expect-error\r\n        this.setModelId(this._internal.modelId);\r\n      }\r\n    },\r\n\r\n    findParentComponentStateModelId() {\r\n      function getParentComponent(component: any) {\r\n        let parent;\r\n        if (component.getRoots().length > 0) {\r\n          const root = component.getRoots()[0];\r\n\r\n          if (root.getVisualParentNode) {\r\n            if (root.getVisualParentNode()) {\r\n              parent = root.getVisualParentNode().nodeScope.componentOwner;\r\n            }\r\n          } else if (root.parentNodeScope) {\r\n            parent = component.parentNodeScope.componentOwner;\r\n          }\r\n        } else if (component.parentNodeScope) {\r\n          parent = component.parentNodeScope.componentOwner;\r\n        }\r\n\r\n        if (\r\n          parent &&\r\n          parent.nodeScope &&\r\n          parent.nodeScope.componentOwner !== component\r\n        ) {\r\n          if (\r\n            parent.nodeScope.getNodesWithType(\"net.noodl.ComponentObject\")\r\n              .length > 0\r\n          ) {\r\n            return parent;\r\n          }\r\n\r\n          return getParentComponent(parent);\r\n        }\r\n      }\r\n\r\n      // @ts-expect-error\r\n      const parent = getParentComponent(this.nodeScope.componentOwner);\r\n      if (!parent) return;\r\n\r\n      this._internal.parentComponentName = parent.name;\r\n\r\n      return \"componentState\" + parent.getInstanceId();\r\n    },\r\n\r\n    setModelId(id: string) {\r\n      this._internal.model &&\r\n        this._internal.model.off(\r\n          \"change\",\r\n          this._internal.onModelChangedCallback\r\n        );\r\n      this._internal.model = undefined;\r\n\r\n      if (!id) return;\r\n\r\n      const model = Model.get(id);\r\n      this._internal.model = model;\r\n\r\n      // @ts-expect-error\r\n      model.on(\"change\", this._internal.onModelChangedCallback);\r\n\r\n      for (const key in model.data) {\r\n        if (this.hasOutput(\"value-\" + key)) {\r\n          this.flagOutputDirty(\"value-\" + key);\r\n        }\r\n        if (this.hasOutput(\"changed-\" + key)) {\r\n          this.sendSignalOnOutput(\"changed-\" + key);\r\n        }\r\n      }\r\n\r\n      this.sendSignalOnOutput(\"changed\");\r\n      this.sendSignalOnOutput(\"fetched\");\r\n    },\r\n\r\n    scheduleStore() {\r\n      // @ts-expect-error\r\n      if (this.hasScheduledStore) return;\r\n      // @ts-expect-error\r\n      this.hasScheduledStore = true;\r\n\r\n      const internal = this._internal;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.hasScheduledStore = false;\r\n        if (!internal.model) return;\r\n        for (const i in internal.inputValues) {\r\n          internal.model.set(i, internal.inputValues[i], { resolve: true });\r\n        }\r\n      });\r\n    },\r\n\r\n    _onNodeDeleted() {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n\r\n      graphEventEmitter.off(\r\n        \"componentStateNodesChanged\",\r\n        // @ts-expect-error\r\n        this.onComponentStateNodesChanged\r\n      );\r\n      this._internal.model &&\r\n        this._internal.model.off(\r\n          \"change\",\r\n          this._internal.onModelChangedCallback\r\n        );\r\n    },\r\n\r\n    registerOutputIfNeeded(name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      const propertyName = name.substring(\"value-\".length);\r\n\r\n      this.registerOutput(name, {\r\n        get() {\r\n          if (!this._internal.model) return undefined;\r\n          return this._internal.model.get(propertyName, { resolve: true });\r\n        },\r\n      });\r\n    },\r\n\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"value-\")) {\r\n        const propertyName = name.substring(\"value-\".length);\r\n        this.registerInput(name, {\r\n          set(value) {\r\n            this._internal.inputValues[propertyName] = value;\r\n\r\n            // @ts-expect-error\r\n            this.scheduleStore();\r\n          },\r\n        });\r\n      }\r\n    },\r\n  },\r\n};\r\n\r\nfunction updatePorts(nodeId: string, parameters: any, editorConnection: any) {\r\n  const ports = [];\r\n\r\n  const properties = parameters.properties && parameters.properties.split(\",\");\r\n  for (const p of properties) {\r\n    // @ts-expect-error\r\n    ports.push({\r\n      type: {\r\n        name: \"*\",\r\n        allowConnectionsOnly: true,\r\n      },\r\n      plug: \"input/output\",\r\n      group: \"Properties\",\r\n      name: \"value-\" + p,\r\n      displayName: p,\r\n    });\r\n\r\n    // @ts-expect-error\r\n    ports.push({\r\n      type: \"signal\",\r\n      plug: \"output\",\r\n      group: \"Changed Events\",\r\n      displayName: p + \" Changed\",\r\n      name: \"changed-\" + p,\r\n    });\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports, {\r\n    detectRenamed: {\r\n      plug: \"input/output\",\r\n    },\r\n  });\r\n}\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  graphModel.on(\"nodeAdded.net.noodl.ParentComponentObject\", (node) => {\r\n    updatePorts(node.id, node.parameters, context.editorConnection);\r\n\r\n    node.on(\"parameterUpdated\", (event) => {\r\n      updatePorts(node.id, node.parameters, context.editorConnection);\r\n    });\r\n  });\r\n\r\n  graphModel.on(\"nodeAdded.net.noodl.ComponentObject\", (node) => {\r\n    setTimeout(() => {\r\n      graphEventEmitter.emit(\"componentStateNodesChanged\");\r\n    }, 0);\r\n  });\r\n  graphModel.on(\"nodeRemoved.net.noodl.ComponentObject\", (node) => {\r\n    setTimeout(() => {\r\n      graphEventEmitter.emit(\"componentStateNodesChanged\");\r\n    });\r\n  });\r\n}\r\n","import { extendSetComponentObjectProperties } from \"./base\";\r\n\r\nexport default extendSetComponentObjectProperties({\r\n  name: \"net.noodl.SetComponentObjectProperties\",\r\n  category: \"Component Utilities\",\r\n  displayName: \"Set Component Object Properties\",\r\n  docs: \"https://docs.noodl.net/nodes/component-utilities/set-component-object-properties\",\r\n  getComponentObjectId(): string {\r\n    // @ts-expect-error\r\n    return \"componentState\" + this.nodeScope.componentOwner.getInstanceId();\r\n  },\r\n});\r\n","import { extendSetComponentObjectProperties } from \"./base\";\r\n\r\nexport default extendSetComponentObjectProperties({\r\n  name: \"net.noodl.SetParentComponentObjectProperties\",\r\n  category: \"Component Utilities\",\r\n  displayName: \"Set Parent Component Object Properties\",\r\n  docs: \"https://docs.noodl.net/nodes/component-utilities/set-parent-component-object-properties\",\r\n  getComponentObjectId(): string | undefined {\r\n    function getParentComponent(component: any): any {\r\n      let parent;\r\n      if (component.getRoots().length > 0) {\r\n        // visual\r\n        const root = component.getRoots()[0];\r\n\r\n        if (root.getVisualParentNode) {\r\n          // regular visual node\r\n          if (root.getVisualParentNode()) {\r\n            parent = root.getVisualParentNode().nodeScope.componentOwner;\r\n          }\r\n        } else if (root.parentNodeScope) {\r\n          // component instance node\r\n          parent = component.parentNodeScope.componentOwner;\r\n        }\r\n      } else if (component.parentNodeScope) {\r\n        parent = component.parentNodeScope.componentOwner;\r\n      }\r\n\r\n      // check that a parent exists and that the component is different\r\n      if (\r\n        parent &&\r\n        parent.nodeScope &&\r\n        parent.nodeScope.componentOwner !== component\r\n      ) {\r\n        // check if parent has a Component State node\r\n        if (\r\n          parent.nodeScope.getNodesWithType(\"net.noodl.ComponentObject\")\r\n            .length > 0\r\n        ) {\r\n          return parent;\r\n        }\r\n\r\n        // if not, continue searching up the tree\r\n        return getParentComponent(parent);\r\n      }\r\n    }\r\n\r\n    // @ts-expect-error\r\n    const parent = getParentComponent(this.nodeScope.componentOwner);\r\n    if (!parent) return;\r\n\r\n    this._internal.parentComponentName = parent.name;\r\n\r\n    return \"componentState\" + parent.getInstanceId();\r\n  },\r\n});\r\n","import NoodlRuntime, { NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  paramsValues: Record<string, any>;\r\n  resultsValues: Record<string, any>;\r\n  lastCallResult?: any;\r\n  error?: string;\r\n  functionName?: string;\r\n  hasScheduledCall?: boolean;\r\n}\r\n\r\nfunction _makeRequest(\r\n  path: string,\r\n  options: {\r\n    method?: string;\r\n    endpoint: string;\r\n    appId: string;\r\n    content: any;\r\n    success: (res: any) => void;\r\n    error: (err: any) => void;\r\n  }\r\n) {\r\n  const xhr = new XMLHttpRequest();\r\n\r\n  xhr.onreadystatechange = function () {\r\n    if (xhr.readyState === 4) {\r\n      let json;\r\n      try {\r\n        json = JSON.parse(xhr.response);\r\n      } catch (e) {}\r\n\r\n      if (xhr.status === 200 || xhr.status === 201) {\r\n        options.success(json);\r\n      } else {\r\n        options.error(json);\r\n      }\r\n    }\r\n  };\r\n\r\n  xhr.open(options.method || \"GET\", options.endpoint + path, true);\r\n\r\n  xhr.setRequestHeader(\"X-Parse-Application-Id\", options.appId);\r\n  xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n\r\n  const cloudServices = NoodlRuntime.instance.getMetaData(\"cloudservices\");\r\n  if (cloudServices && cloudServices.deployVersion) {\r\n    xhr.setRequestHeader(\"x-noodl-cloud-version\", cloudServices.deployVersion);\r\n  }\r\n\r\n  // Check for current users\r\n  const _cu = localStorage[\"Parse/\" + options.appId + \"/currentUser\"];\r\n  if (_cu !== undefined) {\r\n    try {\r\n      const currentUser = JSON.parse(_cu);\r\n      xhr.setRequestHeader(\"X-Parse-Session-Token\", currentUser.sessionToken);\r\n    } catch (e) {\r\n      // Failed to extract session token\r\n    }\r\n  }\r\n\r\n  xhr.send(JSON.stringify(options.content));\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"CloudFunction2\",\r\n  displayName: \"Cloud Function\",\r\n  category: \"Cloud Services\",\r\n  color: \"data\",\r\n  usePortAsLabel: \"function\",\r\n  docs: \"https://docs.noodl.net/nodes/data/cloud-data/cloud-function\",\r\n  _internal: {\r\n    paramsValues: {},\r\n    resultsValues: {},\r\n  },\r\n  initialize: function () {\r\n    this._internal.paramsValues = {};\r\n    this._internal.resultsValues = {};\r\n  },\r\n  getInspectInfo() {\r\n    const result = this._internal.lastCallResult;\r\n    if (!result) return \"[Not executed yet]\";\r\n\r\n    return [{ type: \"value\", value: result }];\r\n  },\r\n  inputs: {\r\n    call: {\r\n      type: \"signal\",\r\n      displayName: \"Call\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue: function () {\r\n        // @ts-expect-error\r\n        this.scheduleCall();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    success: {\r\n      type: \"signal\",\r\n      displayName: \"Success\",\r\n      group: \"Signals\",\r\n    },\r\n    failure: {\r\n      type: \"signal\",\r\n      displayName: \"Failure\",\r\n      group: \"Signals\",\r\n    },\r\n    error: {\r\n      type: \"string\",\r\n      displayName: \"Error\",\r\n      group: \"Error\",\r\n      getter: function () {\r\n        return this._internal.error;\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    setError: function (err: string) {\r\n      this._internal.error = err;\r\n      this.flagOutputDirty(\"error\");\r\n      this.sendSignalOnOutput(\"failure\");\r\n    },\r\n    getResultsValue: function (name: string) {\r\n      return this._internal.resultsValues[name];\r\n    },\r\n    registerOutputIfNeeded: function (name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"out-\"))\r\n        this.registerOutput(name, {\r\n          // @ts-expect-error\r\n          getter: this.getResultsValue.bind(\r\n            this,\r\n            name.substring(\"out-\".length)\r\n          ),\r\n        });\r\n    },\r\n    setParamsValue: function (name: string, value: any) {\r\n      this._internal.paramsValues[name] = value;\r\n    },\r\n    setFunctionName: function (value: string) {\r\n      this._internal.functionName = value;\r\n    },\r\n    registerInputIfNeeded: function (name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === \"function\")\r\n        this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setFunctionName.bind(this),\r\n        });\r\n\r\n      if (name.startsWith(\"in-\"))\r\n        this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setParamsValue.bind(this, name.substring(\"in-\".length)),\r\n        });\r\n    },\r\n    scheduleCall: function () {\r\n      const internal = this._internal;\r\n      if (!internal.hasScheduledCall) {\r\n        internal.hasScheduledCall = true;\r\n        // @ts-expect-error\r\n        this.scheduleAfterInputsHaveUpdated(this.doCall.bind(this));\r\n      }\r\n    },\r\n    doCall: function () {\r\n      this._internal.hasScheduledCall = false;\r\n\r\n      const cloudServices = NoodlRuntime.instance.getMetaData(\"cloudservices\");\r\n      if (this.context.editorConnection) {\r\n        if (\r\n          cloudServices === undefined ||\r\n          cloudServices.endpoint === undefined\r\n        ) {\r\n          this.context.editorConnection.sendWarning(\r\n            // @ts-expect-error\r\n            this.nodeScope.componentOwner.name,\r\n            this.id,\r\n            \"cloud-function-2\",\r\n            {\r\n              message: \"No cloud services defined in this project.\",\r\n            }\r\n          );\r\n        } else if (this._internal.functionName === undefined) {\r\n          this.context.editorConnection.sendWarning(\r\n            // @ts-expect-error\r\n            this.nodeScope.componentOwner.name,\r\n            this.id,\r\n            \"cloud-function-2\",\r\n            {\r\n              message: \"No function specified\",\r\n            }\r\n          );\r\n        } else {\r\n          this.context.editorConnection.clearWarning(\r\n            // @ts-expect-error\r\n            this.nodeScope.componentOwner.name,\r\n            this.id,\r\n            \"cloud-function-2\"\r\n          );\r\n        }\r\n      }\r\n\r\n      const appId = cloudServices.appId;\r\n      // @ts-expect-error\r\n      const endpoint = this.context.editorConnection.isRunningLocally()\r\n        ? `http://${window.location.hostname}:8577`\r\n        : cloudServices.endpoint;\r\n\r\n      _makeRequest(\r\n        // @ts-expect-error\r\n        \"/functions/\" + encodeURIComponent(this._internal.functionName),\r\n        {\r\n          appId,\r\n          endpoint,\r\n          content: this._internal.paramsValues,\r\n          method: \"POST\",\r\n          success: (res) => {\r\n            if (res === undefined) {\r\n              // No result, still success\r\n\r\n              this._internal.lastCallResult = {\r\n                status: \"success\",\r\n                parameters: this._internal.paramsValues,\r\n                results: \"empty\",\r\n              };\r\n            } else {\r\n              const results = res.result || {};\r\n              for (let key in results) {\r\n                this._internal.resultsValues[key] = results[key];\r\n                if (this.hasOutput(\"out-\" + key))\r\n                  this.flagOutputDirty(\"out-\" + key);\r\n              }\r\n\r\n              this._internal.lastCallResult = {\r\n                status: \"success\",\r\n                parameters: this._internal.paramsValues,\r\n                results: this._internal.resultsValues,\r\n              };\r\n            }\r\n\r\n            this.sendSignalOnOutput(\"success\");\r\n          },\r\n          error: (e) => {\r\n            const error =\r\n              typeof e === \"string\"\r\n                ? e\r\n                : e.error || \"Failed running cloud function.\";\r\n            this._internal.lastCallResult = {\r\n              status: \"failure\",\r\n              error,\r\n            };\r\n\r\n            // @ts-expect-error\r\n            this.setError(error);\r\n          },\r\n        }\r\n      );\r\n    },\r\n  },\r\n};\r\n","import { Collection, Model, NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  collection: Collection<Model>;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"CollectionClear\",\r\n  docs: \"https://docs.noodl.net/nodes/data/array/clear-array\",\r\n  displayNodeName: \"Clear Array\",\r\n  category: \"Data\",\r\n  usePortAsLabel: \"collectionId\",\r\n  color: \"data\",\r\n  inputs: {\r\n    collectionId: {\r\n      type: {\r\n        name: \"string\",\r\n        identifierOf: \"CollectionName\",\r\n        identifierDisplayName: \"Array Ids\",\r\n      },\r\n      displayName: \"Array Id\",\r\n      group: \"General\",\r\n      set: function (value) {\r\n        if (value instanceof Collection) value = value.getId();\r\n        // Can be passed as collection as well\r\n        // @ts-expect-error\r\n        this.setCollectionID(value);\r\n      },\r\n    },\r\n    clear: {\r\n      displayName: \"Do\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue: function () {\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          const collection = this._internal.collection;\r\n\r\n          collection.set([]);\r\n          this.sendSignalOnOutput(\"modified\");\r\n        });\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    modified: {\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n      displayName: \"Done\",\r\n    },\r\n  },\r\n  methods: {\r\n    setCollectionID: function (id: string) {\r\n      // @ts-expect-error\r\n      this.setCollection(Collection.get(id));\r\n    },\r\n    setCollection: function (collection: Collection<Model>) {\r\n      this._internal.collection = collection;\r\n    },\r\n  },\r\n};\r\n","import { Collection, Model, NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  modifyId: string;\r\n  collection: Collection<Model>;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"CollectionInsert\",\r\n  docs: \"https://docs.noodl.net/nodes/data/array/insert-into-array\",\r\n  displayNodeName: \"Insert Object Into Array\",\r\n  shortDesc:\r\n    \"A collection of models, mainly used together with a For Each Node.\",\r\n  category: \"Data\",\r\n  usePortAsLabel: \"collectionId\",\r\n  color: \"data\",\r\n  inputs: {\r\n    collectionId: {\r\n      type: {\r\n        name: \"string\",\r\n        identifierOf: \"CollectionName\",\r\n        identifierDisplayName: \"Array Ids\",\r\n      },\r\n      displayName: \"Array Id\",\r\n      group: \"General\",\r\n      set(value: string | Collection<Model>) {\r\n        if (value instanceof Collection) value = value.getId();\r\n        // Can be passed as collection as well\r\n        // @ts-expect-error\r\n        this.setCollectionID(value);\r\n      },\r\n    },\r\n    modifyId: {\r\n      type: { name: \"string\", allowConnectionsOnly: true },\r\n      displayName: \"Object Id\",\r\n      group: \"Modify\",\r\n      set(value: string) {\r\n        this._internal.modifyId = value;\r\n      },\r\n    },\r\n    add: {\r\n      displayName: \"Do\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue: function () {\r\n        const internal = this._internal;\r\n\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          if (this.context.editorConnection) {\r\n            this.context.editorConnection.clearWarning(\r\n              // @ts-expect-error\r\n              this.nodeScope.componentOwner.name,\r\n              this.id,\r\n              \"insert-warning\"\r\n            );\r\n          }\r\n\r\n          if (internal.modifyId === undefined) {\r\n            if (this.context.editorConnection) {\r\n              this.context.editorConnection.sendWarning(\r\n                // @ts-expect-error\r\n                this.nodeScope.componentOwner.name,\r\n                this.id,\r\n                \"insert-warning\",\r\n                {\r\n                  showGlobally: true,\r\n                  message: \"No Object Id specified\",\r\n                }\r\n              );\r\n            }\r\n            return;\r\n          }\r\n\r\n          if (internal.collection === undefined) {\r\n            if (this.context.editorConnection) {\r\n              this.context.editorConnection.sendWarning(\r\n                // @ts-expect-error\r\n                this.nodeScope.componentOwner.name,\r\n                this.id,\r\n                \"insert-warning\",\r\n                {\r\n                  showGlobally: true,\r\n                  message: \"No Array Id specified\",\r\n                }\r\n              );\r\n            }\r\n            return;\r\n          }\r\n\r\n          const model = Model.get(internal.modifyId);\r\n          internal.collection.add(model);\r\n          this.sendSignalOnOutput(\"modified\");\r\n        });\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    modified: {\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n      displayName: \"Done\",\r\n    },\r\n  },\r\n  methods: {\r\n    setCollectionID(id: string) {\r\n      // @ts-expect-error\r\n      this.setCollection(Collection.get(id));\r\n    },\r\n    setCollection(collection: Collection<Model>) {\r\n      this._internal.collection = collection;\r\n    },\r\n  },\r\n};\r\n","import { Collection, NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  sourceCollection: any[];\r\n  collection?: Collection<any>;\r\n  collectionId?: string;\r\n  hasScheduledNew: boolean;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"CollectionNew\",\r\n  docs: \"https://docs.noodl.net/nodes/data/array/create-new-array\",\r\n  displayNodeName: \"Create New Array\",\r\n  shortDesc:\r\n    \"A collection of models, mainly used together with a For Each Node.\",\r\n  category: \"Data\",\r\n  color: \"data\",\r\n  initialize() {},\r\n  inputs: {\r\n    new: {\r\n      displayName: \"Do\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleNew();\r\n      },\r\n    },\r\n    items: {\r\n      type: \"array\",\r\n      group: \"General\",\r\n      displayName: \"Items\",\r\n      set(value: any[]) {\r\n        this._internal.sourceCollection = value;\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    id: {\r\n      type: \"string\",\r\n      displayName: \"Id\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.collection\r\n          ? this._internal.collection.getId()\r\n          : this._internal.collectionId;\r\n      },\r\n    },\r\n    created: {\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n      displayName: \"Done\",\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    setCollectionID(id: string) {\r\n      // @ts-expect-error\r\n      this.setCollection(Collection.get(id));\r\n    },\r\n    setCollection(collection: Collection<any>) {\r\n      this._internal.collection = collection;\r\n      this.flagOutputDirty(\"id\");\r\n    },\r\n    scheduleNew() {\r\n      // @ts-expect-error\r\n      if (this.hasScheduledNew) return;\r\n      // @ts-expect-error\r\n      this.hasScheduledNew = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.hasScheduledNew = false;\r\n\r\n        const collection = Collection.get();\r\n        if (this._internal.sourceCollection !== undefined)\r\n          collection.set(this._internal.sourceCollection);\r\n\r\n        // @ts-expect-error\r\n        this.setCollection(collection);\r\n\r\n        this.sendSignalOnOutput(\"created\");\r\n      });\r\n    },\r\n  },\r\n};\r\n","import { Model, Collection, NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  modifyId?: string;\r\n  collection?: Collection<Model>;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"CollectionRemove\",\r\n  docs: \"https://docs.noodl.net/nodes/data/array/remove-from-array\",\r\n  displayNodeName: \"Remove Object From Array\",\r\n  shortDesc:\r\n    \"A collection of models, mainly used together with a For Each Node.\",\r\n  category: \"Data\",\r\n  usePortAsLabel: \"collectionId\",\r\n  color: \"data\",\r\n  initialize: function () {},\r\n  inputs: {\r\n    collectionId: {\r\n      type: {\r\n        name: \"string\",\r\n        identifierOf: \"CollectionName\",\r\n        identifierDisplayName: \"Array Ids\",\r\n      },\r\n      displayName: \"Array Id\",\r\n      group: \"General\",\r\n      set: function (value: string | Collection<Model>) {\r\n        if (value instanceof Collection) value = value.getId();\r\n        // Can be passed as collection as well\r\n        // @ts-expect-error\r\n        this.setCollectionID(value);\r\n      },\r\n    },\r\n    modifyId: {\r\n      type: { name: \"string\", allowConnectionsOnly: true },\r\n      displayName: \"Object Id\",\r\n      group: \"Modify\",\r\n      set: function (value: string) {\r\n        this._internal.modifyId = value;\r\n      },\r\n    },\r\n    remove: {\r\n      displayName: \"Do\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue: function () {\r\n        const _this = this;\r\n        const internal = this._internal;\r\n\r\n        this.scheduleAfterInputsHaveUpdated(function () {\r\n          if (internal.modifyId === undefined) return;\r\n          if (internal.collection === undefined) return;\r\n\r\n          const model = Model.get(internal.modifyId);\r\n          internal.collection.remove(model);\r\n          _this.sendSignalOnOutput(\"modified\");\r\n        });\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    modified: {\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n      displayName: \"Done\",\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    setCollectionID: function (id: string) {\r\n      // @ts-expect-error\r\n      this.setCollection(Collection.get(id));\r\n    },\r\n    setCollection: function (collection: Collection<Model>) {\r\n      this._internal.collection = collection;\r\n    },\r\n  },\r\n};\r\n","import { Model, Collection, NodeDefinition, Node } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  collectionChangedCallback: () => void;\r\n  sourceCollectionChangedCallback: () => void;\r\n  collection: Collection<Model> | undefined;\r\n  collectionId: string;\r\n  pendingSourceCollection: Collection<Model> | undefined;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Collection2\",\r\n  docs: \"https://docs.noodl.net/nodes/data/array/array-node\",\r\n  displayNodeName: \"Array\",\r\n  shortDesc:\r\n    \"A collection of models, mainly used together with a For Each Node.\",\r\n  category: \"Data\",\r\n  usePortAsLabel: \"collectionId\",\r\n  color: \"data\",\r\n  initialize() {\r\n    let collectionChangedScheduled = false;\r\n    this._internal.collectionChangedCallback = () => {\r\n      if (this.isInputConnected(\"fetch\")) return; // Ignore if we have explicit fetch connection\r\n\r\n      // Optimize by only updating outputs once\r\n      if (collectionChangedScheduled) return;\r\n      collectionChangedScheduled = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        this.sendSignalOnOutput(\"changed\");\r\n        this.flagOutputDirty(\"firstItemId\");\r\n        this.flagOutputDirty(\"count\");\r\n        collectionChangedScheduled = false;\r\n      });\r\n    };\r\n\r\n    // When the source collection has changed, copy items into this collection\r\n    this._internal.sourceCollectionChangedCallback = () => {\r\n      if (this.isInputConnected(\"store\")) return; // Ignore if we have explicit store connection\r\n\r\n      // @ts-expect-error\r\n      this.scheduleCopyItems();\r\n    };\r\n  },\r\n  getInspectInfo() {\r\n    const collection = this._internal.collection;\r\n    if (!collection) {\r\n      return { type: \"text\", value: \"[No Array]\" };\r\n    }\r\n\r\n    return [\r\n      {\r\n        type: \"text\",\r\n        value: \"Id: \" + collection.getId(),\r\n      },\r\n      {\r\n        type: \"value\",\r\n        value: collection.items,\r\n      },\r\n    ];\r\n  },\r\n  inputs: {\r\n    collectionId: {\r\n      type: {\r\n        name: \"string\",\r\n        identifierOf: \"CollectionName\",\r\n        identifierDisplayName: \"Array Ids\",\r\n      },\r\n      displayName: \"Id\",\r\n      group: \"General\",\r\n      set(value) {\r\n        if (value instanceof Collection) value = value.getId(); // Can be passed as collection as well\r\n        this._internal.collectionId = value; // Wait to fetch data\r\n        if (!this.isInputConnected(\"fetch\")) {\r\n          // @ts-expect-error\r\n          this.setCollectionID(value);\r\n        } else {\r\n          this.flagOutputDirty(\"id\");\r\n        }\r\n      },\r\n    },\r\n    items: {\r\n      type: \"array\",\r\n      group: \"General\",\r\n      displayName: \"Items\",\r\n      set(value) {\r\n        if (value === undefined) return;\r\n        if (value === this._internal.collection) return;\r\n\r\n        this._internal.pendingSourceCollection = value;\r\n        if (!this.isInputConnected(\"store\")) {\r\n          // Don't auto copy if we have connections to store\r\n          this.scheduleAfterInputsHaveUpdated(() => {\r\n            // @ts-expect-error\r\n            this.setSourceCollection(value);\r\n          });\r\n        }\r\n      },\r\n    },\r\n    fetch: {\r\n      displayName: \"Fetch\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleSetCollection();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    id: {\r\n      type: \"string\",\r\n      displayName: \"Id\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.collection\r\n          ? this._internal.collection.getId()\r\n          : this._internal.collectionId;\r\n      },\r\n    },\r\n    items: {\r\n      type: \"array\",\r\n      displayName: \"Items\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.collection;\r\n      },\r\n    },\r\n    firstItemId: {\r\n      type: \"string\",\r\n      displayName: \"First Item Id\",\r\n      group: \"General\",\r\n      getter() {\r\n        if (this._internal.collection) {\r\n          const firstItem = this._internal.collection.get(0);\r\n          if (firstItem !== undefined) return firstItem.getId();\r\n        }\r\n      },\r\n    },\r\n    count: {\r\n      type: \"number\",\r\n      displayName: \"Count\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.collection ? this._internal.collection.size() : 0;\r\n      },\r\n    },\r\n    changed: {\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n      displayName: \"Changed\",\r\n    },\r\n    fetched: {\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n      displayName: \"Fetched\",\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    setCollectionID(id: string) {\r\n      // @ts-expect-error\r\n      this.setCollection(Collection.get(id));\r\n    },\r\n    setCollection(collection: Collection<Model>) {\r\n      if (this._internal.collection) {\r\n        // Remove old listener if existing\r\n        this._internal.collection.off(\r\n          \"change\",\r\n          // @ts-expect-error\r\n          this._internal.collectionChangedCallback\r\n        );\r\n      }\r\n\r\n      this._internal.collection = collection;\r\n      this.flagOutputDirty(\"id\");\r\n      // @ts-expect-error\r\n      collection.on(\"change\", this._internal.collectionChangedCallback);\r\n\r\n      this.flagOutputDirty(\"items\");\r\n      this.flagOutputDirty(\"firstItemId\");\r\n      this.flagOutputDirty(\"count\");\r\n    },\r\n    setSourceCollection(collection: Collection<Model>) {\r\n      const internal = this._internal;\r\n\r\n      if (\r\n        // @ts-expect-error\r\n        internal.sourceCollection &&\r\n        // @ts-expect-error\r\n        internal.sourceCollection instanceof Collection\r\n      ) {\r\n        // Remove old listener if existing\r\n        // @ts-expect-error\r\n        internal.sourceCollection.off(\r\n          \"change\",\r\n          internal.sourceCollectionChangedCallback\r\n        );\r\n      }\r\n\r\n      // @ts-expect-error\r\n      internal.sourceCollection = collection;\r\n      // @ts-expect-error\r\n      if (internal.sourceCollection instanceof Collection) {\r\n        // @ts-expect-error\r\n        internal.sourceCollection.on(\r\n          \"change\",\r\n          internal.sourceCollectionChangedCallback\r\n        );\r\n      }\r\n\r\n      // @ts-expect-error\r\n      this._copySourceItems();\r\n    },\r\n    scheduleSetCollection() {\r\n      // @ts-expect-error\r\n      if (this.hasScheduledSetCollection) return;\r\n      // @ts-expect-error\r\n      this.hasScheduledSetCollection = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.hasScheduledSetCollection = false;\r\n        // @ts-expect-error\r\n        this.setCollectionID(this._internal.collectionId);\r\n        this.sendSignalOnOutput(\"fetched\");\r\n      });\r\n    },\r\n    scheduleStore() {\r\n      // @ts-expect-error\r\n      if (this.hasScheduledStore) return;\r\n      // @ts-expect-error\r\n      this.hasScheduledStore = true;\r\n\r\n      const internal = this._internal;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.hasScheduledStore = false;\r\n        // @ts-expect-error\r\n        this.setSourceCollection(internal.pendingSourceCollection);\r\n      });\r\n    },\r\n    _copySourceItems() {\r\n      const internal = this._internal;\r\n\r\n      if (\r\n        internal.collection === undefined &&\r\n        !this.isInputConnected(\"fetch\")\r\n      ) {\r\n        // @ts-expect-error\r\n        this.setCollection(Collection.get());\r\n      }\r\n      // @ts-expect-error\r\n      internal.collection && internal.collection.set(internal.sourceCollection);\r\n    },\r\n    scheduleCopyItems() {\r\n      // @ts-expect-error\r\n      if (this.hasScheduledCopyItems) return;\r\n      // @ts-expect-error\r\n      this.hasScheduledCopyItems = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.hasScheduledCopyItems = false;\r\n        // @ts-expect-error\r\n        this._copySourceItems();\r\n      });\r\n    },\r\n    _onNodeDeleted() {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n\r\n      if (this._internal.collection) {\r\n        // Remove old listener if existing\r\n        this._internal.collection.off(\r\n          \"change\",\r\n          // @ts-expect-error\r\n          this._internal.collectionChangedCallback\r\n        );\r\n      }\r\n    },\r\n  },\r\n};\r\n","import {\r\n  Node,\r\n  Model,\r\n  createSetter,\r\n  Collection,\r\n  NodeDefinition,\r\n} from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  collectionChangedCallback: () => void;\r\n  enabled: boolean;\r\n  filterSettings: Record<string, any>;\r\n  filteredCollection?: Collection<Model>;\r\n  collection?: Collection<Model>;\r\n  collectionChangedScheduled?: boolean;\r\n}\r\n\r\nconst applyFilter = (\r\n  item: Record<string, any>,\r\n  filter: Record<string, any>\r\n): boolean => {\r\n  for (const key in filter) {\r\n    const op = filter[key];\r\n\r\n    if (op[\"$neq\"] !== undefined) {\r\n      if (!(item[key] != op[\"$neq\"])) return false;\r\n    } else if (item[key] === undefined) return false;\r\n    else if (op[\"$eq\"] !== undefined && !(item[key] == op[\"$eq\"])) return false;\r\n    else if (op[\"$gt\"] !== undefined && !(item[key] > op[\"$gt\"])) return false;\r\n    else if (op[\"$lt\"] !== undefined && !(item[key] < op[\"$lt\"])) return false;\r\n    else if (op[\"$gte\"] !== undefined && !(item[key] >= op[\"$gte\"]))\r\n      return false;\r\n    else if (op[\"$lte\"] !== undefined && !(item[key] <= op[\"$lte\"]))\r\n      return false;\r\n    else if (op[\"$regex\"] !== undefined) {\r\n      const a = item[key] + \"\"; // Convert to string\r\n      const regex = new RegExp(\r\n        op[\"$regex\"],\r\n        op[\"$case\"] !== true ? \"i\" : undefined\r\n      );\r\n      if (!regex.test(a)) return false;\r\n    }\r\n  }\r\n  return true;\r\n};\r\n\r\nconst sorter = function (this: Record<string, number>, a: any, b: any): number {\r\n  if (a instanceof Model) a = a.data;\r\n  if (b instanceof Model) b = b.data;\r\n\r\n  for (const key in this) {\r\n    const _a = a[key];\r\n    const _b = b[key];\r\n    if (_a !== _b) {\r\n      if (typeof _a === \"string\" && typeof _b === \"string\") {\r\n        return this[key] === 1 ? (_a > _b ? 1 : -1) : _a > _b ? -1 : 1;\r\n      } else if (typeof _a === \"number\" && typeof _b === \"number\") {\r\n        return this[key] === 1 ? _a - _b : _b - _a;\r\n      } else {\r\n        return this[key] === 1 ? (_a > _b ? 1 : -1) : _a > _b ? -1 : 1;\r\n      }\r\n    }\r\n  }\r\n  return 0;\r\n};\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Filter Collection\",\r\n  docs: \"https://docs.noodl.net/nodes/data/array/array-filter\",\r\n  displayNodeName: \"Array Filter\",\r\n  shortDesc: \"Filter, sort and limit array\",\r\n  category: \"Data\",\r\n  color: \"data\",\r\n  initialize: function () {\r\n    this._internal.collectionChangedCallback = () => {\r\n      if (this.isInputConnected(\"filter\") === true) return;\r\n      // @ts-expect-error\r\n      this.scheduleFilter();\r\n    };\r\n\r\n    this._internal.enabled = true;\r\n    this._internal.filterSettings = {};\r\n  },\r\n  getInspectInfo() {\r\n    const collection = this._internal.filteredCollection;\r\n\r\n    if (!collection) {\r\n      return { type: \"text\", value: \"[Not executed yet]\" };\r\n    }\r\n\r\n    return [\r\n      {\r\n        type: \"text\",\r\n        value: \"Id: \" + collection.getId(),\r\n      },\r\n      {\r\n        type: \"value\",\r\n        value: collection.items,\r\n      },\r\n    ];\r\n  },\r\n  inputs: {\r\n    items: {\r\n      type: \"array\",\r\n      displayName: \"Items\",\r\n      group: \"General\",\r\n      set(value) {\r\n        // @ts-expect-error\r\n        this.bindCollection(value);\r\n        // @ts-expect-error\r\n        if (!this.isInputConnected(\"filter\")) this.scheduleFilter();\r\n      },\r\n    },\r\n    enabled: {\r\n      type: \"boolean\",\r\n      group: \"General\",\r\n      displayName: \"Enabled\",\r\n      default: true,\r\n      set: function (value) {\r\n        this._internal.enabled = value;\r\n        // @ts-expect-error\r\n        if (!this.isInputConnected(\"filter\")) this.scheduleFilter();\r\n      },\r\n    },\r\n    filter: {\r\n      type: \"signal\",\r\n      group: \"Actions\",\r\n      displayName: \"Filter\",\r\n      valueChangedToTrue: function () {\r\n        // @ts-expect-error\r\n        this.scheduleFilter();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    items: {\r\n      type: \"array\",\r\n      displayName: \"Items\",\r\n      group: \"General\",\r\n      getter: function () {\r\n        return this._internal.filteredCollection;\r\n      },\r\n    },\r\n    firstItemId: {\r\n      type: \"string\",\r\n      displayName: \"First Item Id\",\r\n      group: \"General\",\r\n      getter: function () {\r\n        if (this._internal.filteredCollection !== undefined) {\r\n          const firstItem = this._internal.filteredCollection.get(0);\r\n          if (firstItem !== undefined) return firstItem.getId();\r\n        }\r\n      },\r\n    },\r\n    count: {\r\n      type: \"number\",\r\n      displayName: \"Count\",\r\n      group: \"General\",\r\n      getter: function () {\r\n        return this._internal.filteredCollection\r\n          ? this._internal.filteredCollection.size()\r\n          : 0;\r\n      },\r\n    },\r\n    modified: {\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n      displayName: \"Filtered\",\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    unbindCurrentCollection: function () {\r\n      const collection = this._internal.collection;\r\n      if (!collection) return;\r\n      // @ts-expect-error\r\n      collection.off(\"change\", this._internal.collectionChangedCallback);\r\n      this._internal.collection = undefined;\r\n    },\r\n    bindCollection: function (collection: Collection<Model>) {\r\n      // @ts-expect-error\r\n      this.unbindCurrentCollection();\r\n      this._internal.collection = collection;\r\n      collection &&\r\n        // @ts-expect-error\r\n        collection.on(\"change\", this._internal.collectionChangedCallback);\r\n    },\r\n    _onNodeDeleted: function () {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      // @ts-expect-error\r\n      this.unbindCurrentCollection();\r\n    },\r\n    // @ts-expect-error\r\n    getFilter: function () {\r\n      const filterSettings = this._internal.filterSettings;\r\n      const options = [\"case\"];\r\n\r\n      if (filterSettings[\"filterFilter\"]) {\r\n        const filters = filterSettings[\"filterFilter\"].split(\",\");\r\n        const _filter: Record<string, any> = {};\r\n        filters.forEach((f) => {\r\n          const op = \"$\" + (filterSettings[\"filterFilterOp-\" + f] || \"eq\");\r\n          _filter[f] = {};\r\n          _filter[f][op] = filterSettings[\"filterFilterValue-\" + f];\r\n\r\n          options.forEach((o) => {\r\n            const option = filterSettings[\"filterFilterOption-\" + o + \"-\" + f];\r\n            if (option) _filter[f][\"$\" + o] = option;\r\n          });\r\n        });\r\n        return _filter;\r\n      }\r\n    },\r\n    // @ts-expect-error\r\n    getSort: function () {\r\n      const filterSettings = this._internal.filterSettings;\r\n\r\n      if (filterSettings[\"filterSort\"]) {\r\n        const sort = filterSettings[\"filterSort\"].split(\",\");\r\n        const _sort: Record<string, number> = {};\r\n        sort.forEach((s) => {\r\n          _sort[s] =\r\n            filterSettings[\"filterSort-\" + s] === \"descending\" ? -1 : 1;\r\n        });\r\n        return _sort;\r\n      }\r\n    },\r\n    getLimit: function () {\r\n      const filterSettings = this._internal.filterSettings;\r\n\r\n      if (!filterSettings[\"filterEnableLimit\"]) return;\r\n      return filterSettings[\"filterLimit\"] || 10;\r\n    },\r\n    getSkip: function () {\r\n      const filterSettings = this._internal.filterSettings;\r\n\r\n      if (!filterSettings[\"filterEnableLimit\"]) return;\r\n      return filterSettings[\"filterSkip\"] || 0;\r\n    },\r\n    scheduleFilter: function () {\r\n      // @ts-expect-error\r\n      if (this.collectionChangedScheduled) return;\r\n      // @ts-expect-error\r\n      this.collectionChangedScheduled = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.collectionChangedScheduled = false;\r\n        if (!this._internal.collection) return;\r\n\r\n        // @ts-expect-error\r\n        let filtered = [].concat(this._internal.collection.items);\r\n\r\n        if (this._internal.enabled) {\r\n          // @ts-expect-error\r\n          const filter = this.getFilter();\r\n          if (filter)\r\n            // @ts-expect-error\r\n            filtered = filtered.filter((m) => applyFilter(m.data, filter));\r\n\r\n          // @ts-expect-error\r\n          const sort = this.getSort();\r\n          if (sort) filtered.sort(sorter.bind(sort));\r\n\r\n          // @ts-expect-error\r\n          const skip = this.getSkip();\r\n          if (skip) filtered = filtered.slice(skip, filtered.length);\r\n\r\n          // @ts-expect-error\r\n          const limit = this.getLimit();\r\n          if (limit) filtered = filtered.slice(0, limit);\r\n        }\r\n\r\n        this._internal.filteredCollection = Collection.create(filtered);\r\n\r\n        this.sendSignalOnOutput(\"modified\");\r\n        this.flagOutputDirty(\"firstItemId\");\r\n        this.flagOutputDirty(\"items\");\r\n        this.flagOutputDirty(\"count\");\r\n      });\r\n    },\r\n    registerInputIfNeeded: function (name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      this.registerInput(name, {\r\n        set: userInputSetter.bind(this, name),\r\n      });\r\n    },\r\n  },\r\n};\r\n\r\nfunction userInputSetter(name: string, value: any) {\r\n  // @ts-expect-error\r\n  this._internal.filterSettings[name] = value;\r\n  // @ts-expect-error\r\n  if (!this.isInputConnected(\"filter\")) this.scheduleFilter();\r\n}\r\n\r\nfunction updatePorts(\r\n  nodeId: string,\r\n  parameters: Record<string, any>,\r\n  editorConnection: any,\r\n  dbCollections: any\r\n) {\r\n  const ports: any[] = [];\r\n\r\n  ports.push({\r\n    type: \"boolean\",\r\n    plug: \"input\",\r\n    group: \"Limit\",\r\n    name: \"filterEnableLimit\",\r\n    displayName: \"Use limit\",\r\n  });\r\n\r\n  if (parameters[\"filterEnableLimit\"]) {\r\n    ports.push({\r\n      type: \"number\",\r\n      default: 10,\r\n      plug: \"input\",\r\n      group: \"Limit\",\r\n      name: \"filterLimit\",\r\n      displayName: \"Limit\",\r\n    });\r\n\r\n    ports.push({\r\n      type: \"number\",\r\n      default: 0,\r\n      plug: \"input\",\r\n      group: \"Limit\",\r\n      name: \"filterSkip\",\r\n      displayName: \"Skip\",\r\n    });\r\n  }\r\n\r\n  ports.push({\r\n    type: { name: \"stringlist\", allowEditOnly: true },\r\n    plug: \"input\",\r\n    group: \"Filter\",\r\n    name: \"filterFilter\",\r\n    displayName: \"Filter\",\r\n  });\r\n\r\n  ports.push({\r\n    type: { name: \"stringlist\", allowEditOnly: true },\r\n    plug: \"input\",\r\n    group: \"Sort\",\r\n    name: \"filterSort\",\r\n    displayName: \"Sort\",\r\n  });\r\n\r\n  const filterOps = {\r\n    string: [\r\n      { value: \"eq\", label: \"Equals\" },\r\n      { value: \"neq\", label: \"Not Equals\" },\r\n      { value: \"regex\", label: \"Matches RegEx\" },\r\n    ],\r\n    boolean: [\r\n      { value: \"eq\", label: \"Equals\" },\r\n      { value: \"neq\", label: \"Not Equals\" },\r\n    ],\r\n    number: [\r\n      { value: \"eq\", label: \"Equals\" },\r\n      { value: \"neq\", label: \"Not Equals\" },\r\n      { value: \"lt\", label: \"Less than\" },\r\n      { value: \"gt\", label: \"Greater than\" },\r\n      { value: \"gte\", label: \"Greater than or equal\" },\r\n      { value: \"lte\", label: \"Less than or equal\" },\r\n    ],\r\n  };\r\n\r\n  if (parameters[\"filterFilter\"]) {\r\n    const filters = parameters[\"filterFilter\"].split(\",\");\r\n    filters.forEach((f) => {\r\n      ports.push({\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { value: \"string\", label: \"String\" },\r\n            { value: \"number\", label: \"Number\" },\r\n            { value: \"boolean\", label: \"Boolean\" },\r\n          ],\r\n        },\r\n        default: \"string\",\r\n        plug: \"input\",\r\n        group: f + \" filter\",\r\n        displayName: \"Type\",\r\n        editorName: f + \" filter | Type\",\r\n        name: \"filterFilterType-\" + f,\r\n      });\r\n\r\n      const type = parameters[\"filterFilterType-\" + f];\r\n\r\n      ports.push({\r\n        type: { name: \"enum\", enums: filterOps[type || \"string\"] },\r\n        default: \"eq\",\r\n        plug: \"input\",\r\n        group: f + \" filter\",\r\n        displayName: \"Op\",\r\n        editorName: f + \" filter| Op\",\r\n        name: \"filterFilterOp-\" + f,\r\n      });\r\n\r\n      if (parameters[\"filterFilterOp-\" + f] === \"regex\") {\r\n        ports.push({\r\n          type: \"boolean\",\r\n          default: false,\r\n          plug: \"input\",\r\n          group: f + \" filter\",\r\n          displayName: \"Case sensitive\",\r\n          editorName: f + \" filter| Case\",\r\n          name: \"filterFilterOption-case-\" + f,\r\n        });\r\n      }\r\n\r\n      ports.push({\r\n        type: type || \"string\",\r\n        plug: \"input\",\r\n        group: f + \" filter\",\r\n        displayName: \"Value\",\r\n        editorName: f + \" Filter Value\",\r\n        name: \"filterFilterValue-\" + f,\r\n      });\r\n    });\r\n  }\r\n\r\n  if (parameters[\"filterSort\"]) {\r\n    const filters = parameters[\"filterSort\"].split(\",\");\r\n    filters.forEach((f) => {\r\n      ports.push({\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { value: \"ascending\", label: \"Ascending\" },\r\n            { value: \"descending\", label: \"Descending\" },\r\n          ],\r\n        },\r\n        default: \"ascending\",\r\n        plug: \"input\",\r\n        group: f + \" sort\",\r\n        displayName: \"Sort\",\r\n        editorName: f + \" sorting\",\r\n        name: \"filterSort-\" + f,\r\n      });\r\n    });\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nexport function setup(context: any, graphModel: any) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  graphModel.on(\"nodeAdded.Filter Collection\", function (node: any) {\r\n    updatePorts(\r\n      node.id,\r\n      node.parameters,\r\n      context.editorConnection,\r\n      graphModel.getMetaData(\"dbCollections\")\r\n    );\r\n\r\n    node.on(\"parameterUpdated\", function (event: any) {\r\n      if (event.name.startsWith(\"filter\")) {\r\n        updatePorts(\r\n          node.id,\r\n          node.parameters,\r\n          context.editorConnection,\r\n          graphModel.getMetaData(\"dbCollections\")\r\n        );\r\n      }\r\n    });\r\n\r\n    graphModel.on(\"metadataChanged.dbCollections\", function (data: any) {\r\n      updatePorts(node.id, node.parameters, context.editorConnection, data);\r\n    });\r\n  });\r\n}\r\n","import React, { useEffect } from \"react\";\r\nimport NoodlRuntime, {\r\n  Model,\r\n  NodeModel,\r\n  Node,\r\n  Collection,\r\n  guid,\r\n} from \"@fluxscape/runtime\";\r\nimport { ReactNodeDefinition } from \"../../../ReactNodeDefinition\";\r\n\r\nconst ForEachComponent: React.FC<{\r\n  didMount: () => void;\r\n  willUnmount: () => void;\r\n}> = (props) => {\r\n  const { didMount, willUnmount } = props;\r\n\r\n  useEffect(() => {\r\n    didMount();\r\n    return () => {\r\n      willUnmount();\r\n    };\r\n  }, [didMount, willUnmount]);\r\n\r\n  return null;\r\n};\r\n\r\nconst defaultDynamicScript =\r\n  \"// Set the 'component' variable to the name of the desired component for this item.\\n\" +\r\n  \"// Component name must start with a '/'.\\n\" +\r\n  \"// A component in a sheet is referred to by '/#Sheet Name/Comopnent Name'.\\n\" +\r\n  \"// The data for each item is available in a variable called 'item'\\n\" +\r\n  \"component = '/MyComponent';\";\r\n\r\ninterface Internal {\r\n  itemNodes: any[];\r\n  itemOutputSignals: any;\r\n  itemOutputs: any;\r\n  collection: Collection<Model>;\r\n  queuedOperations: any[];\r\n  mountedOperations: any[];\r\n  target?: any;\r\n  items?: any;\r\n  templateType?: any;\r\n  template?: any;\r\n  templateFunction?: any;\r\n  itemActionItemId?: any;\r\n  hasScheduledRefresh?: any;\r\n  onItemsCollectionChanged?: any;\r\n  inputMapFunc?: any;\r\n  itemActionParameters?: any;\r\n  hasScheduledCopyItems?: any;\r\n  itemActionSignal?: any;\r\n  hasScheduledTriggerItemOutputSignal?: any;\r\n  inputMappingScript?: any;\r\n}\r\n\r\nconst ForEachDefinition: ReactNodeDefinition<Internal> = {\r\n  name: \"For Each\",\r\n  displayNodeName: \"Repeater\",\r\n  docs: \"https://docs.noodl.net/nodes/ui-controls/repeater\",\r\n  color: \"visual\",\r\n  category: \"Visual\",\r\n  dynamicports: [\r\n    {\r\n      name: \"conditionalports/extended\",\r\n      condition: \"templateType = explicit OR templateType NOT SET\",\r\n      inputs: [\"template\"],\r\n    },\r\n    {\r\n      name: \"conditionalports/extended\",\r\n      condition: \"templateType = dynamic\",\r\n      inputs: [\"templateScript\"],\r\n    },\r\n  ],\r\n  initialize() {\r\n    this._internal.itemNodes = [];\r\n    this._internal.itemOutputSignals = {};\r\n    this._internal.itemOutputs = {};\r\n    this._internal.collection = Collection.get(); // We keep an internal collection so we don't have to refresh all content if the input items collection changes\r\n    this._internal.queuedOperations = [];\r\n    this._internal.mountedOperations = [];\r\n\r\n    // Add an item\r\n    this._internal.collection.on(\"add\", async (args) => {\r\n      if (!this._internal.target) return;\r\n\r\n      // @ts-expect-error\r\n      this._queueOperation(async () => {\r\n        const baseIndex = this._internal.target.getChildren().indexOf(this) + 1;\r\n        // @ts-expect-error\r\n        await this.addItem(args.item, baseIndex + args.index);\r\n      });\r\n    });\r\n\r\n    // Remove an item\r\n    // @ts-expect-error\r\n    this._internal.collection.on(\"remove\", (args) => {\r\n      // @ts-expect-error\r\n      this._queueOperation(() => {\r\n        // @ts-expect-error\r\n        this.removeItem(args.item);\r\n      });\r\n    });\r\n\r\n    // On collection changed\r\n    this._internal.onItemsCollectionChanged = () => {\r\n      const repeaterDisabledWhenUnmounted =\r\n        NoodlRuntime.instance.getProjectSettings()\r\n          .repeaterDisabledWhenUnmounted;\r\n\r\n      // @ts-expect-error\r\n      if (repeaterDisabledWhenUnmounted && !this.isMounted) {\r\n        this._internal.mountedOperations.push(() => {\r\n          this._internal.collection.set(this._internal.items);\r\n        });\r\n      } else {\r\n        // @ts-expect-error\r\n        this._queueOperation(() => {\r\n          this._internal.collection.set(this._internal.items);\r\n        });\r\n      }\r\n    };\r\n\r\n    this.addDeleteListener(() => {\r\n      // @ts-expect-error\r\n      this._deleteAllItemNodes();\r\n    });\r\n  },\r\n  inputs: {\r\n    items: {\r\n      group: \"Data\",\r\n      displayName: \"Items\",\r\n      type: \"array\",\r\n      set(value) {\r\n        if (!value) return;\r\n        if (value === this._internal.items) return;\r\n        // @ts-expect-error\r\n        this.bindCollection(value);\r\n        //this.scheduleRefresh();\r\n      },\r\n    },\r\n    templateType: {\r\n      group: \"Appearance\",\r\n      displayName: \"Template Type\",\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"Explicit\", value: \"explicit\" },\r\n          { label: \"Dynamic\", value: \"dynamic\" },\r\n        ],\r\n      },\r\n      default: \"explicit\",\r\n      set(value) {\r\n        this._internal.templateType = value;\r\n        // @ts-expect-error\r\n        this.scheduleRefresh();\r\n      },\r\n    },\r\n    template: {\r\n      type: \"component\",\r\n      displayName: \"Template\",\r\n      group: \"Appearance\",\r\n      set(value) {\r\n        this._internal.template = value;\r\n        // @ts-expect-error\r\n        this.scheduleRefresh();\r\n      },\r\n    },\r\n    templateScript: {\r\n      type: { name: \"string\", codeeditor: \"javascript\", allowEditOnly: true },\r\n      displayName: \"Script\",\r\n      group: \"Appearance\",\r\n      default: defaultDynamicScript,\r\n      set(value) {\r\n        try {\r\n          this._internal.templateFunction = new Function(\r\n            \"item\",\r\n            \"var component;\" + value + \";return component;\"\r\n          );\r\n        } catch (e) {\r\n          console.log(e);\r\n          if (this.context.editorConnection) {\r\n            this.context.editorConnection.sendWarning(\r\n              // @ts-expect-error\r\n              this.nodeScope.componentOwner.name,\r\n              this.id,\r\n              \"foreach-syntax-warning\",\r\n              // @ts-expect-error\r\n              { message: \"<strong>Syntax</strong>: \" + e.message }\r\n            );\r\n          }\r\n        }\r\n        // @ts-expect-error\r\n        this.scheduleRefresh();\r\n      },\r\n    },\r\n    refresh: {\r\n      group: \"Appearance\",\r\n      displayName: \"Refresh\",\r\n      type: \"signal\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleRefresh();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    itemActionItemId: {\r\n      type: \"string\",\r\n      group: \"Actions\",\r\n      displayName: \"Item Id\",\r\n      getter() {\r\n        return this._internal.itemActionItemId;\r\n      },\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    updateTarget(targetId) {\r\n      this._internal.target = targetId\r\n        ? // @ts-expect-error\r\n          this.nodeScope.getNodeWithId(targetId)\r\n        : undefined;\r\n      // @ts-expect-error\r\n      this.scheduleRefresh();\r\n    },\r\n    setNodeModel(nodeModel: NodeModel) {\r\n      Node.prototype.setNodeModel.call(this, nodeModel);\r\n      if (nodeModel.parent) {\r\n        // @ts-expect-error\r\n        this.updateTarget(nodeModel.parent.id);\r\n      }\r\n      var self = this;\r\n      nodeModel.on(\r\n        \"parentUpdated\",\r\n        function (newParent) {\r\n          // @ts-expect-error\r\n          self.updateTarget(newParent ? newParent.id : undefined);\r\n        },\r\n        this\r\n      );\r\n    },\r\n    scheduleRefresh() {\r\n      var _this = this;\r\n      var internal = this._internal;\r\n      if (!internal.hasScheduledRefresh) {\r\n        internal.hasScheduledRefresh = true;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          // @ts-expect-error\r\n          this._queueOperation(() => {\r\n            // @ts-expect-error\r\n            this.refresh();\r\n          });\r\n        });\r\n      }\r\n    },\r\n    unbindCurrentCollection() {\r\n      var collection = this._internal.items;\r\n      if (!collection) return;\r\n\r\n      Collection.instanceOf(collection) &&\r\n        collection.off(\"change\", this._internal.onItemsCollectionChanged);\r\n      this._internal.items = undefined;\r\n    },\r\n    bindCollection(collection) {\r\n      var internal = this._internal;\r\n\r\n      // @ts-expect-error\r\n      this.unbindCurrentCollection();\r\n\r\n      Collection.instanceOf(collection) &&\r\n        collection.on(\"change\", this._internal.onItemsCollectionChanged);\r\n\r\n      internal.items = collection;\r\n      // @ts-expect-error\r\n      this.scheduleCopyItems();\r\n    },\r\n    getTemplateForModel(model) {\r\n      var internal = this._internal;\r\n      if (\r\n        internal.templateType === undefined ||\r\n        internal.templateType === \"explicit\"\r\n      )\r\n        return internal.template;\r\n\r\n      if (!internal.templateFunction) return;\r\n      try {\r\n        var template = internal.templateFunction(model);\r\n      } catch (e) {\r\n        console.log(e);\r\n        if (this.context.editorConnection) {\r\n          this.context.editorConnection.sendWarning(\r\n            // @ts-expect-error\r\n            this.nodeScope.componentOwner.name,\r\n            this.id,\r\n            \"foreach-dynamic-warning\",\r\n            // @ts-expect-error\r\n            { message: \"<strong>Dynamic template</strong>: \" + e.message }\r\n          );\r\n        }\r\n      }\r\n\r\n      //simple (and limited) way to support ./ and ../ at the start of component template names\r\n      if (template) {\r\n        if (template.startsWith(\"./\")) {\r\n          // @ts-expect-error\r\n          template = this.model.component.name + template.substring(1);\r\n        }\r\n\r\n        if (template.startsWith(\"../\")) {\r\n          // @ts-expect-error\r\n          const pathParts = this.model.component.name.split(\"/\");\r\n          const parentPath = pathParts.slice(0, pathParts.length - 1).join(\"/\");\r\n          template = parentPath + template.substring(2);\r\n        }\r\n      }\r\n\r\n      return template;\r\n    },\r\n    _mapInputs(itemNode, model) {\r\n      if (this._internal.inputMapFunc !== undefined) {\r\n        // We have a mapping function, run the function and use the mapped values\r\n        // as inputs\r\n        this._internal.inputMapFunc(function (mappings) {\r\n          for (var key in mappings) {\r\n            if (itemNode.hasInput(key)) {\r\n              if (typeof mappings[key] === \"function\") {\r\n                itemNode.setInputValue(key, mappings[key](model));\r\n              } else if (typeof mappings[key] === \"string\") {\r\n                itemNode.setInputValue(key, model.get(mappings[key]));\r\n              }\r\n            }\r\n          }\r\n        }, model);\r\n      }\r\n    },\r\n    // @ts-expect-error\r\n    addItem: async function (model, index) {\r\n      var internal = this._internal;\r\n\r\n      // Create a new component for this item\r\n      // @ts-expect-error\r\n      var template = this.getTemplateForModel(model);\r\n      if (!template) return;\r\n\r\n      // @ts-expect-error\r\n      var itemNode = await this.nodeScope.createNode(template, guid(), {\r\n        _forEachModel: model,\r\n        _forEachNode: this,\r\n      });\r\n\r\n      // Set input values for all model data, and track changes\r\n      if (this._internal.inputMapFunc === undefined) {\r\n        //set component inputs with values from model\r\n        if (itemNode.hasInput(\"Id\")) {\r\n          itemNode.setInputValue(\"Id\", model.getId());\r\n        }\r\n        if (itemNode.hasInput(\"id\")) {\r\n          itemNode.setInputValue(\"id\", model.getId());\r\n        }\r\n\r\n        for (var inputKey in itemNode._inputs) {\r\n          if (model.data[inputKey] !== undefined)\r\n            itemNode.setInputValue(inputKey, model.data[inputKey]);\r\n        }\r\n\r\n        //listen to changes on model\r\n        itemNode._forEachModelChangeListener = function (ev) {\r\n          if (itemNode._inputs[ev.name])\r\n            itemNode.setInputValue(ev.name, ev.value);\r\n        };\r\n        model.on(\"change\", itemNode._forEachModelChangeListener);\r\n\r\n        //listen to changes to the component inputs\r\n        itemNode.componentModel.on(\r\n          \"inputPortAdded\",\r\n          (port) => {\r\n            if (port.name === \"id\") itemNode.setInputValue(\"id\", model.getId());\r\n            if (port.name === \"Id\") itemNode.setInputValue(\"Id\", model.getId());\r\n\r\n            if (model.data[port.name] !== undefined) {\r\n              itemNode.setInputValue(port.name, model.data[port.name]);\r\n            }\r\n          },\r\n          this\r\n        );\r\n      } else {\r\n        // If there is a map script, then use it\r\n        // @ts-expect-error\r\n        this._mapInputs(itemNode, model);\r\n        itemNode._forEachModelChangeListener = () =>\r\n          // @ts-expect-error\r\n          this._mapInputs(itemNode, model);\r\n        model.on(\"change\", itemNode._forEachModelChangeListener);\r\n      }\r\n\r\n      // Create connections for all item output signals that we should forward\r\n      itemNode._internal.creatorCallbacks = {\r\n        onOutputChanged: (name, value, oldValue) => {\r\n          if (\r\n            (oldValue === false || oldValue === undefined) &&\r\n            value === true &&\r\n            internal.itemOutputSignals[name]\r\n          ) {\r\n            // @ts-expect-error\r\n            this.itemOutputSignalTriggered(name, model, itemNode);\r\n          }\r\n        },\r\n      };\r\n\r\n      // Connect all model nodes of the component that have id type = instance\r\n      /*var itemScopes = itemNode.nodeScope.getNodesWithType('Model')\r\n      if(itemScopes && itemScopes.length>0) {\r\n        for(var j = 0; j < itemScopes.length; j++) {\r\n          itemScopes[j].hasInstanceIDType()&&itemScopes[j].setModel(model);\r\n        }\r\n      }*/\r\n\r\n      // If there is a for each actions node, signal that the item has been added\r\n      var forEachActions =\r\n        itemNode.nodeScope.getNodesWithType(\"For Each Actions\");\r\n      for (var j = 0; j < forEachActions.length; j++) {\r\n        forEachActions[j].signalAdded();\r\n      }\r\n\r\n      internal.itemNodes.push(itemNode);\r\n      internal.target.addChild(itemNode, index);\r\n    },\r\n    removeItem(model) {\r\n      var internal = this._internal;\r\n      if (!internal.target) return;\r\n\r\n      function findChild() {\r\n        var children = internal.target.getChildren();\r\n        for (var i in children) {\r\n          var c = children[i];\r\n          if (c._forEachModel === model && !c._forEachRemoveInProgress)\r\n            return c;\r\n        }\r\n      }\r\n      var child = findChild();\r\n      if (!child) return;\r\n\r\n      var forEachActions = child.nodeScope.getNodesWithType(\"For Each Actions\");\r\n      if (forEachActions && forEachActions.length > 0) {\r\n        // Run a try remove on the for each actions, remove the child when completed\r\n        child._forEachRemoveInProgress = true;\r\n        // @ts-expect-error\r\n        forEachActions[0].tryRemove(() => this._deleteItem(child));\r\n      } else {\r\n        // There are no for each actions, just remove the item\r\n        // @ts-expect-error\r\n        this._deleteItem(child);\r\n      }\r\n\r\n      var idx = internal.itemNodes.indexOf(child);\r\n      idx !== -1 && internal.itemNodes.splice(idx, 1);\r\n    },\r\n    _deleteItem(item) {\r\n      item._forEachModel.off(\"change\", item._forEachModelChangeListener);\r\n\r\n      item.model && item.model.removeListenersWithRef(this);\r\n      item.componentModel && item.componentModel.removeListenersWithRef(this);\r\n\r\n      const parent = item.parent;\r\n      if (item._deleted || !parent) return;\r\n\r\n      parent.removeChild(item);\r\n      // @ts-expect-error\r\n      this.nodeScope.deleteNode(item);\r\n    },\r\n    _deleteAllItemNodes() {\r\n      if (!this._internal.itemNodes) return;\r\n\r\n      for (const itemNode of this._internal.itemNodes) {\r\n        // @ts-expect-error\r\n        this._deleteItem(itemNode);\r\n      }\r\n\r\n      this._internal.itemNodes = [];\r\n    },\r\n    // @ts-expect-error\r\n    refresh: async function () {\r\n      var internal = this._internal;\r\n      internal.hasScheduledRefresh = false;\r\n      if (!(internal.template || internal.templateFunction) || !internal.items)\r\n        return;\r\n\r\n      // @ts-expect-error\r\n      this._deleteAllItemNodes();\r\n\r\n      //check if we have a target to add nodes to\r\n      if (!internal.target) return;\r\n\r\n      // figure out our index in our target\r\n      const baseIndex = this._internal.target.getChildren().indexOf(this) + 1;\r\n\r\n      // Iterate over all models and create items\r\n      for (var i = 0; i < internal.collection.size(); i++) {\r\n        var model = internal.collection.get(i);\r\n\r\n        // @ts-expect-error\r\n        await this.addItem(model, baseIndex + i);\r\n      }\r\n    },\r\n    _queueOperation(op) {\r\n      this._internal.queuedOperations.push(op);\r\n      // @ts-expect-error\r\n      this._runQueueOperations();\r\n    },\r\n    // @ts-expect-error\r\n    async _runQueueOperations() {\r\n      // @ts-expect-error\r\n      if (this.runningOperations) {\r\n        return;\r\n      }\r\n      // @ts-expect-error\r\n      this.runningOperations = true;\r\n\r\n      const repeaterCreateComponentsAsync =\r\n        NoodlRuntime.instance.getProjectSettings()\r\n          .repeaterCreateComponentsAsync;\r\n\r\n      if (repeaterCreateComponentsAsync) {\r\n        //create items in chunks of roughly 25ms at a time\r\n        //so basically trying to keep ~30 fps\r\n        const runOps = async () => {\r\n          const start = performance.now();\r\n\r\n          while (\r\n            this._internal.queuedOperations.length &&\r\n            performance.now() - start < 25\r\n          ) {\r\n            const op = this._internal.queuedOperations.shift();\r\n            await op();\r\n          }\r\n\r\n          if (this._internal.queuedOperations.length) {\r\n            setTimeout(runOps, 0);\r\n          } else {\r\n            // @ts-expect-error\r\n            this.runningOperations = false;\r\n          }\r\n        };\r\n\r\n        runOps();\r\n      } else {\r\n        while (this._internal.queuedOperations.length) {\r\n          const op = this._internal.queuedOperations.shift();\r\n          await op();\r\n        }\r\n\r\n        // @ts-expect-error\r\n        this.runningOperations = false;\r\n      }\r\n    },\r\n    _onNodeDeleted() {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      this._internal.queuedOperations.length = 0; //delete all queued operations\r\n      // @ts-expect-error\r\n      this.unbindCurrentCollection();\r\n    },\r\n    // @ts-expect-error\r\n    render() {\r\n      return (\r\n        <ForEachComponent\r\n          key={this.id}\r\n          // @ts-expect-error\r\n          didMount={() => this.didMount()}\r\n          // @ts-expect-error\r\n          willUnmount={() => this.willUnmount()}\r\n        />\r\n      );\r\n    },\r\n    didMount() {\r\n      // @ts-expect-error\r\n      this.isMounted = true;\r\n\r\n      for (const op of this._internal.mountedOperations) {\r\n        // @ts-expect-error\r\n        this._queueOperation(op);\r\n      }\r\n      this._internal.mountedOperations = [];\r\n    },\r\n    willUnmount() {\r\n      // @ts-expect-error\r\n      this.isMounted = false;\r\n    },\r\n    getItemActionParameter(name) {\r\n      if (!this._internal.itemActionParameters) return;\r\n      return this._internal.itemActionParameters[name];\r\n    },\r\n    scheduleCopyItems() {\r\n      if (this._internal.hasScheduledCopyItems) return;\r\n      this._internal.hasScheduledCopyItems = true;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        this._internal.hasScheduledCopyItems = false;\r\n\r\n        if (this._internal.items === undefined) return;\r\n\r\n        const repeaterDisabledWhenUnmounted =\r\n          NoodlRuntime.instance.getProjectSettings()\r\n            .repeaterDisabledWhenUnmounted;\r\n\r\n        // @ts-expect-error\r\n        if (repeaterDisabledWhenUnmounted && !this.isMounted) {\r\n          this._internal.mountedOperations.push(() => {\r\n            this._internal.collection.set(this._internal.items);\r\n          });\r\n        } else {\r\n          this._internal.collection.set(this._internal.items);\r\n        }\r\n      });\r\n    },\r\n    itemOutputSignalTriggered(name, model, itemNode) {\r\n      this._internal.itemActionItemId = model.getId();\r\n      this._internal.itemActionSignal = name;\r\n      this.flagOutputDirty(\"itemActionItemId\");\r\n\r\n      // Send signal and update item outputs after they have been correctly updated\r\n      if (!this._internal.hasScheduledTriggerItemOutputSignal) {\r\n        this._internal.hasScheduledTriggerItemOutputSignal = true;\r\n        this.context.scheduleAfterUpdate(() => {\r\n          this._internal.hasScheduledTriggerItemOutputSignal = false;\r\n          for (var key in itemNode._outputs) {\r\n            var _output = \"itemOutput-\" + key;\r\n            if (this.hasOutput(_output)) {\r\n              this._internal.itemOutputs[key] = itemNode._outputs[key].value;\r\n              this.flagOutputDirty(_output);\r\n            }\r\n          }\r\n          this.sendSignalOnOutput(\r\n            \"itemOutputSignal-\" + this._internal.itemActionSignal\r\n          );\r\n        });\r\n      }\r\n    },\r\n    getItemOutput(name) {\r\n      return this._internal.itemOutputs[name];\r\n    },\r\n    registerOutputIfNeeded(name) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"itemOutputSignal-\")) {\r\n        this._internal.itemOutputSignals[\r\n          name.substring(\"itemOutputSignal-\".length)\r\n        ] = true;\r\n        this.registerOutput(name, {\r\n          getter() {\r\n            /** No needed for signals */\r\n          },\r\n        });\r\n      } else if (name.startsWith(\"itemOutput-\"))\r\n        this.registerOutput(name, {\r\n          // @ts-expect-error\r\n          getter: this.getItemOutput.bind(\r\n            this,\r\n            name.substring(\"itemOutput-\".length)\r\n          ),\r\n        });\r\n    },\r\n    setInputMappingScript(value) {\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.clearWarning(\r\n          // @ts-expect-error\r\n          this.nodeScope.componentOwner.name,\r\n          this.id,\r\n          \"foreach-inputmapping-warning\"\r\n        );\r\n      }\r\n\r\n      this._internal.inputMappingScript = value;\r\n\r\n      if (this._internal.inputMappingScript) {\r\n        try {\r\n          this._internal.inputMapFunc = new Function(\r\n            \"map\",\r\n            \"object\",\r\n            this._internal.inputMappingScript\r\n          );\r\n        } catch (e) {\r\n          this._internal.inputMapFunc = undefined;\r\n          if (this.context.editorConnection) {\r\n            this.context.editorConnection.sendWarning(\r\n              // @ts-expect-error\r\n              this.nodeScope.componentOwner.name,\r\n              this.id,\r\n              \"foreach-inputmapping-warning\",\r\n              // @ts-expect-error\r\n              { message: \"<strong>Input mapping</strong>: \" + e.message }\r\n            );\r\n          }\r\n        }\r\n      } else {\r\n        this._internal.inputMapFunc = undefined;\r\n      }\r\n\r\n      // @ts-expect-error\r\n      this.scheduleRefresh();\r\n    },\r\n    registerInputIfNeeded(name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === \"inputMappingScript\")\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setInputMappingScript.bind(this),\r\n        });\r\n    },\r\n  },\r\n};\r\n\r\nfunction _typeName(t) {\r\n  if (typeof t === \"object\") return t.name;\r\n  else return t;\r\n}\r\n\r\nconst defaultMapCode =\r\n  \"// Here you add mappings between the properties of the item objects and the inputs of the components.\\n\" +\r\n  \"// 'myComponentInput': 'myObjectProperty',\\n\" +\r\n  \"// 'anotherComponentInput'() { return object.get('someProperty') + ' ' + object.get('otherProp') }\\n\" +\r\n  \"// These are the default mappings based on the selected template component.\\n\" +\r\n  \"map({\\n\" +\r\n  \"{{#mappings}}\" +\r\n  \"})\\n\";\r\n\r\nexport const node = ForEachDefinition;\r\nexport const setup = function (context, graphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node) {\r\n    function _collectPortsInTemplateComponent() {\r\n      var templateComponentName = node.parameters.template;\r\n      if (templateComponentName === undefined) return;\r\n\r\n      var ports = [];\r\n      var c = graphModel.components[templateComponentName];\r\n      if (c === undefined) return;\r\n\r\n      // Collect item outputs and signals\r\n      for (var outputName in c.outputPorts) {\r\n        var o = c.outputPorts[outputName];\r\n        if (_typeName(o.type) === \"signal\") {\r\n          // @ts-expect-error\r\n          ports.push({\r\n            name: \"itemOutputSignal-\" + outputName,\r\n            displayName: outputName,\r\n            type: \"signal\",\r\n            plug: \"output\",\r\n            group: \"Item Signals\",\r\n          });\r\n        } else {\r\n          // @ts-expect-error\r\n          ports.push({\r\n            name: \"itemOutput-\" + outputName,\r\n            displayName: outputName,\r\n            type: o.type,\r\n            plug: \"output\",\r\n            group: \"Item Outputs\",\r\n          });\r\n        }\r\n      }\r\n\r\n      // Collect default mappings for template component inputs\r\n      var defaultMappings = \"\";\r\n      for (var inputName in c.inputPorts) {\r\n        var o = c.inputPorts[inputName];\r\n        if (_typeName(o.type) !== \"signal\") {\r\n          defaultMappings += \"\\t'\" + inputName + \"': '\" + inputName + \"',\\n\";\r\n        }\r\n      }\r\n\r\n      // @ts-expect-error\r\n      ports.push({\r\n        name: \"inputMappingScript\",\r\n        type: { name: \"string\", codeeditor: \"javascript\" },\r\n        displayName: \"Script\",\r\n        group: \"Input Mapping\",\r\n        default: defaultMapCode.replace(\"{{#mappings}}\", defaultMappings),\r\n        plug: \"input\",\r\n      });\r\n\r\n      context.editorConnection.sendDynamicPorts(node.id, ports, {\r\n        detectRenamed: {\r\n          plug: \"output\",\r\n          prefix: \"itemOutput\",\r\n        },\r\n      });\r\n    }\r\n\r\n    function _trackComponentOutputs(componentName) {\r\n      if (componentName === undefined) return;\r\n      var c = graphModel.components[componentName];\r\n      if (c === undefined) return;\r\n\r\n      c.on(\"outputPortAdded\", _collectPortsInTemplateComponent);\r\n      c.on(\"outputPortRemoved\", _collectPortsInTemplateComponent);\r\n      c.on(\"outputPortTypesUpdated\", _collectPortsInTemplateComponent);\r\n\r\n      c.on(\"inputPortTypesUpdated\", _collectPortsInTemplateComponent);\r\n      c.on(\"inputPortAdded\", _collectPortsInTemplateComponent);\r\n      c.on(\"inputPortRemoved\", _collectPortsInTemplateComponent);\r\n    }\r\n\r\n    _collectPortsInTemplateComponent();\r\n    _trackComponentOutputs(node.parameters.template);\r\n    node.on(\"parameterUpdated\", function (event) {\r\n      if (event.name === \"template\") {\r\n        _collectPortsInTemplateComponent();\r\n        _trackComponentOutputs(node.parameters.template);\r\n      }\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.For Each\", function (node) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"For Each\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n};\r\n","import { createSetter, NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  removeCompletedCallback?: () => void;\r\n  actionParameters?: Record<string, any>;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"For Each Actions\",\r\n  docs: \"https://docs.noodl.net/nodes/ui-controls/repeater-item\",\r\n  displayNodeName: \"Repeater Item\",\r\n  category: \"Data\",\r\n  color: \"data\",\r\n  inputs: {\r\n    removeCompleted: {\r\n      type: { name: \"boolean\", allowConnectionsOnly: true },\r\n      displayName: \"Remove Completed\",\r\n      group: \"Events\",\r\n      valueChangedToTrue: function () {\r\n        this._internal.removeCompletedCallback &&\r\n          this._internal.removeCompletedCallback();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    added: {\r\n      type: \"signal\",\r\n      displayName: \"Added\",\r\n      group: \"Events\",\r\n    },\r\n    tryRemove: {\r\n      type: \"signal\",\r\n      displayName: \"Try Remove\",\r\n      group: \"Events\",\r\n    },\r\n    itemId: {\r\n      type: \"string\",\r\n      displayName: \"Item Id\",\r\n      group: \"General\",\r\n      get() {\r\n        // @ts-expect-error\r\n        return this.getItemId();\r\n      },\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    getItemId() {\r\n      // @ts-expect-error\r\n      const model = this.nodeScope.componentOwner._forEachModel;\r\n      return model && model.getId();\r\n    },\r\n    signalAdded: function () {\r\n      this.sendSignalOnOutput(\"added\");\r\n    },\r\n    tryRemove: function (callback) {\r\n      if (this.getOutput(\"tryRemove\").hasConnections()) {\r\n        this._internal.removeCompletedCallback = callback;\r\n        this.sendSignalOnOutput(\"tryRemove\");\r\n      } else {\r\n        // Schedule for later in this frame so any collection nodes\r\n        // being delete can complete data persistence before being\r\n        // deleted\r\n        this.scheduleAfterInputsHaveUpdated(function () {\r\n          callback();\r\n        });\r\n      }\r\n    },\r\n    itemActionTriggered(name) {\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        const itemId = this.getItemId();\r\n        // @ts-expect-error\r\n        const parentForEach = this.nodeScope.componentOwner._forEachNode;\r\n        parentForEach.signalItemAction(\r\n          name,\r\n          itemId,\r\n          this._internal.actionParameters || {}\r\n        );\r\n      });\r\n    },\r\n    setItemActionParameter(name: string) {\r\n      if (!this._internal.actionParameters)\r\n        this._internal.actionParameters = {};\r\n      this._internal.actionParameters[name] = name;\r\n    },\r\n    registerInputIfNeeded: function (name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"itemAction-\"))\r\n        return this.registerInput(name, {\r\n          set: createSetter({\r\n            // @ts-expect-error\r\n            valueChangedToTrue: this.itemActionTriggered.bind(this, name),\r\n          }),\r\n        });\r\n\r\n      if (name.startsWith(\"itemActionParameter-\"))\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setItemActionParameter.bind(this, name),\r\n        });\r\n    },\r\n  },\r\n};\r\n","import { Node, NodeDefinition, Model, Collection } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  collectionChangedCallback: () => void;\r\n  mappedCollection?: Collection<Model>;\r\n  mapCode?: string;\r\n  mapFunc?: (map: any, object: any) => void;\r\n  collection?: Collection<Model>;\r\n  collectionChangedScheduled?: boolean;\r\n}\r\n\r\nconst defaultMapCode =\r\n  \"map({\\n\" +\r\n  \"\\t// Here you add mappings between the input object and the mapped output object.\\n\" +\r\n  \"\\t//myOutputProp: 'inputProp',\\n\" +\r\n  \"\\t//anotherProperty: function(object) { return object.get('someProperty') + ' ' + object.get('otherProp') }\\n\" +\r\n  \"})\\n\";\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Map Collection\",\r\n  docs: \"https://docs.noodl.net/nodes/data/array/array-map\",\r\n  displayNodeName: \"Array Map\",\r\n  shortDesc: \"Map array fields\",\r\n  category: \"Data\",\r\n  color: \"data\",\r\n  initialize: function () {\r\n    this._internal.collectionChangedCallback = () => {\r\n      // @ts-expect-error\r\n      this.scheduleMap();\r\n    };\r\n  },\r\n  inputs: {\r\n    items: {\r\n      type: \"array\",\r\n      displayName: \"Items\",\r\n      group: \"General\",\r\n      set: function (value) {\r\n        // @ts-expect-error\r\n        this.setCollection(value);\r\n        // @ts-expect-error\r\n        this.scheduleMap();\r\n      },\r\n    },\r\n    mapScript: {\r\n      type: {\r\n        name: \"string\",\r\n        allowEditOnly: true,\r\n        codeeditor: \"javascript\",\r\n      },\r\n      displayName: \"Script\",\r\n      default: defaultMapCode,\r\n      set: function (value) {\r\n        this._internal.mapCode = value;\r\n        try {\r\n          // @ts-expect-error\r\n          this._internal.mapFunc = new Function(\r\n            \"map\",\r\n            \"object\",\r\n            // @ts-expect-error\r\n            this._internal.mapCode\r\n          );\r\n        } catch (e) {\r\n          this._internal.mapFunc = undefined;\r\n          console.log(\"Error while parsing map script: \" + e);\r\n        }\r\n        // @ts-expect-error\r\n        this.scheduleMap();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    items: {\r\n      type: \"array\",\r\n      displayName: \"Items\",\r\n      group: \"General\",\r\n      getter: function () {\r\n        return this._internal.mappedCollection;\r\n      },\r\n    },\r\n    count: {\r\n      type: \"number\",\r\n      displayName: \"Count\",\r\n      group: \"General\",\r\n      getter: function () {\r\n        return this._internal.mappedCollection\r\n          ? this._internal.mappedCollection.size()\r\n          : 0;\r\n      },\r\n    },\r\n    modified: {\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n      displayName: \"Changed\",\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    setCollection: function (collection) {\r\n      // @ts-expect-error\r\n      this.bindCollection(collection);\r\n      this.flagOutputDirty(\"items\");\r\n      this.flagOutputDirty(\"count\");\r\n    },\r\n    unbindCurrentCollection: function () {\r\n      const collection = this._internal.collection;\r\n      if (!collection) return;\r\n      // @ts-expect-error\r\n      collection.off(\"change\", this._internal.collectionChangedCallback);\r\n      this._internal.collection = undefined;\r\n    },\r\n    bindCollection: function (collection) {\r\n      // @ts-expect-error\r\n      this.unbindCurrentCollection();\r\n      this._internal.collection = collection;\r\n      collection &&\r\n        collection.on(\"change\", this._internal.collectionChangedCallback);\r\n    },\r\n    _onNodeDeleted: function () {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      // @ts-expect-error\r\n      this.unbindCurrentCollection();\r\n    },\r\n    scheduleMap: function () {\r\n      // @ts-expect-error\r\n      if (this.collectionChangedScheduled) return;\r\n      // @ts-expect-error\r\n      this.collectionChangedScheduled = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.collectionChangedScheduled = false;\r\n        if (this._internal.collection === undefined) return;\r\n\r\n        const mappedModels = this._internal.collection.map((model) => {\r\n          const m = Model.create();\r\n          // @ts-expect-error\r\n          this._internal.mapFunc(function (mappings) {\r\n            for (const key in mappings) {\r\n              if (typeof mappings[key] === \"function\") {\r\n                m.set(key, mappings[key](model));\r\n              } else if (typeof mappings[key] === \"string\") {\r\n                m.set(key, model.get(mappings[key]));\r\n              }\r\n            }\r\n          }, model);\r\n          return m;\r\n        });\r\n\r\n        this._internal.mappedCollection = Collection.create(mappedModels);\r\n\r\n        this.sendSignalOnOutput(\"modified\");\r\n        this.flagOutputDirty(\"items\");\r\n        this.flagOutputDirty(\"count\");\r\n      });\r\n    },\r\n  },\r\n};\r\n","import {\r\n  Model,\r\n  Collection,\r\n  NodeDefinition,\r\n  NodeContext,\r\n  GraphModel,\r\n} from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  name?: string;\r\n  setWith?: string;\r\n  value?: any;\r\n  variablesModel: any; // Adjust type as necessary\r\n  hasScheduledStore?: boolean;\r\n}\r\n\r\nconst SetVariableNodeDefinition: NodeDefinition<Internal> = {\r\n  name: \"Set Variable\",\r\n  docs: \"https://docs.noodl.net/nodes/data/variable/set-variable\",\r\n  category: \"Data\",\r\n  usePortAsLabel: \"name\",\r\n  color: \"data\",\r\n  initialize() {\r\n    const internal = this._internal;\r\n    internal.variablesModel = Model.get(\"--ndl--global-variables\");\r\n  },\r\n  getInspectInfo() {\r\n    if (this._internal.name) {\r\n      return this._internal.variablesModel.get(this._internal.name);\r\n    }\r\n    return \"[No value set]\";\r\n  },\r\n  outputs: {\r\n    done: {\r\n      type: \"signal\",\r\n      displayName: \"Done\",\r\n      group: \"Events\",\r\n    },\r\n  },\r\n  inputs: {\r\n    name: {\r\n      type: {\r\n        name: \"string\",\r\n        identifierOf: \"VariableName\",\r\n        identifierDisplayName: \"Variable names\",\r\n      },\r\n      displayName: \"Name\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        this._internal.name = value;\r\n      },\r\n    },\r\n    setWith: {\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"String\", value: \"string\" },\r\n          { label: \"Boolean\", value: \"boolean\" },\r\n          { label: \"Number\", value: \"number\" },\r\n          { label: \"Empty string\", value: \"emptyString\" },\r\n          { label: \"Date\", value: \"date\" },\r\n          { label: \"Object\", value: \"object\" },\r\n          { label: \"Array\", value: \"array\" },\r\n          { label: \"Any\", value: \"*\" },\r\n        ],\r\n        allowEditOnly: true,\r\n      },\r\n      displayName: \"Set as\",\r\n      default: \"*\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        this._internal.setWith = value;\r\n      },\r\n    },\r\n    do: {\r\n      displayName: \"Do\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleStore();\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    setValue(value: any) {\r\n      this._internal.value = value;\r\n    },\r\n    scheduleStore() {\r\n      // @ts-expect-error\r\n      if (this.hasScheduledStore) return;\r\n      // @ts-expect-error\r\n      this.hasScheduledStore = true;\r\n\r\n      const internal = this._internal;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.hasScheduledStore = false;\r\n\r\n        let value = internal.setWith === \"emptyString\" ? \"\" : internal.value;\r\n\r\n        if (internal.setWith === \"object\" && typeof value === \"string\") {\r\n          value = Model.get(value);\r\n        }\r\n\r\n        if (internal.setWith === \"array\" && typeof value === \"string\") {\r\n          value = Collection.get(value);\r\n        }\r\n\r\n        if (internal.setWith === \"boolean\") value = !!value;\r\n\r\n        internal.variablesModel.set(internal.name, value, {\r\n          forceChange: true,\r\n        });\r\n        this.sendSignalOnOutput(\"done\");\r\n      });\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === \"value\") {\r\n        this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setValue.bind(this),\r\n        });\r\n      }\r\n    },\r\n  },\r\n};\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  graphModel.on(\"nodeAdded.Set Variable\", (node: any) => {\r\n    const _updatePorts = () => {\r\n      const ports: any[] = [];\r\n\r\n      if (node.parameters.setWith !== \"emptyString\") {\r\n        ports.push({\r\n          type:\r\n            node.parameters.setWith !== undefined\r\n              ? node.parameters.setWith\r\n              : \"*\",\r\n          plug: \"input\",\r\n          group: \"General\",\r\n          name: \"value\",\r\n          displayName: \"Value\",\r\n        });\r\n      }\r\n\r\n      context.editorConnection?.sendDynamicPorts(node.id, ports);\r\n    };\r\n\r\n    _updatePorts();\r\n\r\n    node.on(\"parameterUpdated\", () => {\r\n      _updatePorts();\r\n    });\r\n  });\r\n}\r\n\r\nexport { SetVariableNodeDefinition as node };\r\n","import { NodeDefinition, Collection } from \"@fluxscape/runtime\";\r\n\r\nfunction CSVToArray(strData: string, strDelimiter: string = \",\"): string[][] {\r\n  const objPattern = new RegExp(\r\n    \"(\\\\\" +\r\n      strDelimiter +\r\n      \"|\\\\r?\\\\n|\\\\r|^)\" +\r\n      '(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|' +\r\n      '([^\"\\\\' +\r\n      strDelimiter +\r\n      \"\\\\r\\\\n]*))\",\r\n    \"gi\"\r\n  );\r\n\r\n  const arrData: string[][] = [[]];\r\n  let arrMatches: RegExpExecArray | null;\r\n  let prevLastIndex: number;\r\n\r\n  while (\r\n    (arrMatches = objPattern.exec(strData)) &&\r\n    // @ts-expect-error\r\n    prevLastIndex !== objPattern.lastIndex\r\n  ) {\r\n    prevLastIndex = objPattern.lastIndex;\r\n    const strMatchedDelimiter = arrMatches[1];\r\n\r\n    if (strMatchedDelimiter.length && strMatchedDelimiter !== strDelimiter) {\r\n      arrData.push([]);\r\n    }\r\n\r\n    let strMatchedValue: string;\r\n\r\n    if (arrMatches[2]) {\r\n      strMatchedValue = arrMatches[2].replace(new RegExp('\"\"', \"g\"), '\"');\r\n    } else {\r\n      strMatchedValue = arrMatches[3];\r\n    }\r\n\r\n    arrData[arrData.length - 1].push(strMatchedValue);\r\n  }\r\n\r\n  return arrData;\r\n}\r\n\r\ninterface Internal {\r\n  collection: Collection<any>;\r\n  type?: string;\r\n  csv?: string;\r\n  json?: string;\r\n  hasScheduledParseData?: boolean;\r\n}\r\n\r\nconst CSVNode: NodeDefinition<Internal> = {\r\n  name: \"Static Data\",\r\n  docs: \"https://docs.noodl.net/nodes/data/array/static-array\",\r\n  displayNodeName: \"Static Array\",\r\n  shortDesc: \"Store static data to populate a Collection with items.\",\r\n  category: \"Data\",\r\n  color: \"data\",\r\n  nodeDoubleClickAction: [{ focusPort: \"JSON\" }, { focusPort: \"CSV\" }],\r\n  getInspectInfo() {\r\n    if (this._internal.collection) {\r\n      return [{ type: \"value\", value: this._internal.collection.items }];\r\n    }\r\n  },\r\n  dynamicports: [\r\n    {\r\n      name: \"conditionalports/extended\",\r\n      condition: \"type = csv OR type NOT SET\",\r\n      inputs: [\"csv\"],\r\n    },\r\n    {\r\n      name: \"conditionalports/extended\",\r\n      condition: \"type = json\",\r\n      inputs: [\"json\"],\r\n    },\r\n  ],\r\n  inputs: {\r\n    type: {\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"CSV\", value: \"csv\" },\r\n          { label: \"JSON\", value: \"json\" },\r\n        ],\r\n        allowEditOnly: true,\r\n      },\r\n      displayName: \"Type\",\r\n      group: \"General\",\r\n      default: \"csv\",\r\n      set(value: string) {\r\n        this._internal.type = value;\r\n      },\r\n    },\r\n    csv: {\r\n      type: { name: \"string\", codeeditor: \"text\", allowEditOnly: true },\r\n      displayName: \"CSV\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        this._internal.csv = value;\r\n        // @ts-expect-error\r\n        this.scheduleParseData();\r\n      },\r\n    },\r\n    json: {\r\n      type: { name: \"string\", codeeditor: \"json\", allowEditOnly: true },\r\n      displayName: \"JSON\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        this._internal.json = value;\r\n        // @ts-expect-error\r\n        this.scheduleParseData();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    items: {\r\n      type: \"array\",\r\n      displayName: \"Items\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.collection;\r\n      },\r\n    },\r\n    count: {\r\n      type: \"number\",\r\n      displayName: \"Count\",\r\n      group: \"General\",\r\n      get() {\r\n        return this._internal.collection ? this._internal.collection.size() : 0;\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    scheduleParseData() {\r\n      const internal = this._internal;\r\n      if (!internal.hasScheduledParseData) {\r\n        internal.hasScheduledParseData = true;\r\n        // @ts-expect-error\r\n        this.scheduleAfterInputsHaveUpdated(this.parseData.bind(this));\r\n      }\r\n    },\r\n    parseData() {\r\n      const internal = this._internal;\r\n      internal.hasScheduledParseData = false;\r\n      internal.collection = Collection.get();\r\n\r\n      if (internal.type === undefined || internal.type === \"csv\") {\r\n        // @ts-expect-error\r\n        const data = CSVToArray(internal.csv);\r\n        const json: any[] = [];\r\n        const fields = data[0];\r\n        for (let i = 1; i < data.length; i++) {\r\n          const row = data[i];\r\n          const obj: any = {};\r\n          for (let j = 0; j < fields.length; j++) {\r\n            obj[fields[j]] = row[j];\r\n          }\r\n          json.push(obj);\r\n        }\r\n\r\n        internal.collection.set(json);\r\n        this.flagOutputDirty(\"items\");\r\n        this.flagOutputDirty(\"count\");\r\n      } else if (internal.type === \"json\") {\r\n        if (this.context.editorConnection) {\r\n          this.context.editorConnection.clearWarning(\r\n            // @ts-expect-error\r\n            this.nodeScope.componentOwner.name,\r\n            this.id,\r\n            \"json-parse-warning\"\r\n          );\r\n        }\r\n\r\n        try {\r\n          // @ts-expect-error\r\n          const json = JSON.parse(internal.json);\r\n          internal.collection.set(json);\r\n          this.flagOutputDirty(\"items\");\r\n          this.flagOutputDirty(\"count\");\r\n        } catch (e) {\r\n          if (this.context.editorConnection) {\r\n            this.context.editorConnection.sendWarning(\r\n              // @ts-expect-error\r\n              this.nodeScope.componentOwner.name,\r\n              this.id,\r\n              \"json-parse-warning\",\r\n              {\r\n                showGlobally: true,\r\n                // @ts-expect-error\r\n                message: e.message,\r\n              }\r\n            );\r\n          }\r\n        }\r\n      }\r\n    },\r\n  },\r\n};\r\n\r\nexport const node = CSVNode;\r\nexport function setup() {\r\n  // Setup logic if needed\r\n}\r\n","import { NodeDefinition, Model, Node } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  name: string;\r\n  value: any;\r\n  variablesModel: any;\r\n  onModelChangedCallback: (args: { name: string }) => void;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Variable2\",\r\n  displayNodeName: \"Variable\",\r\n  docs: \"https://docs.noodl.net/nodes/data/variable/variable-node\",\r\n  category: \"Data\",\r\n  usePortAsLabel: \"name\",\r\n  color: \"data\",\r\n  initialize() {\r\n    const internal = this._internal;\r\n\r\n    this._internal.onModelChangedCallback = (args) => {\r\n      if (!this.isInputConnected(\"fetch\") && args.name === internal.name) {\r\n        this.sendSignalOnOutput(\"changed\");\r\n        this.flagOutputDirty(\"value\");\r\n      }\r\n    };\r\n\r\n    internal.variablesModel = Model.get(\"--ndl--global-variables\");\r\n    internal.variablesModel.on(\"change\", this._internal.onModelChangedCallback);\r\n  },\r\n  getInspectInfo() {\r\n    if (this._internal.name) {\r\n      return this._internal.variablesModel.get(this._internal.name);\r\n    }\r\n    return \"[No value set]\";\r\n  },\r\n  outputs: {\r\n    name: {\r\n      type: \"string\",\r\n      displayName: \"Name\",\r\n      group: \"General\",\r\n      getter() {\r\n        return this._internal.name;\r\n      },\r\n    },\r\n    changed: {\r\n      type: \"signal\",\r\n      displayName: \"Changed\",\r\n      group: \"Events\",\r\n    },\r\n    fetched: {\r\n      type: \"signal\",\r\n      displayName: \"Fetched\",\r\n      group: \"Events\",\r\n    },\r\n    value: {\r\n      type: \"*\",\r\n      displayName: \"Value\",\r\n      group: \"General\",\r\n      getter() {\r\n        const internal = this._internal;\r\n        if (!internal.name) return;\r\n        return internal.variablesModel.get(internal.name);\r\n      },\r\n    },\r\n  },\r\n  inputs: {\r\n    name: {\r\n      type: {\r\n        name: \"string\",\r\n        identifierOf: \"VariableName\",\r\n        identifierDisplayName: \"Variable names\",\r\n      },\r\n      displayName: \"Name\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        if (!this.isInputConnected(\"fetch\")) {\r\n          // @ts-expect-error\r\n          this.setVariableName(value);\r\n        } else {\r\n          this._internal.name = value; // Wait to fetch data\r\n          this.flagOutputDirty(\"name\");\r\n        }\r\n      },\r\n    },\r\n    fetch: {\r\n      displayName: \"Fetch\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.setVariableName(this._internal.name);\r\n      },\r\n    },\r\n    value: {\r\n      type: \"*\",\r\n      displayName: \"Value\",\r\n      group: \"General\",\r\n      set(value: any) {\r\n        this._internal.value = value;\r\n        // @ts-expect-error\r\n        this.scheduleStore();\r\n      },\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    scheduleStore() {\r\n      // @ts-expect-error\r\n      if (this.hasScheduledStore) return;\r\n      // @ts-expect-error\r\n      this.hasScheduledStore = true;\r\n\r\n      const internal = this._internal;\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.hasScheduledStore = false;\r\n        internal.variablesModel.set(internal.name, internal.value);\r\n      });\r\n    },\r\n    setVariableName(name: string) {\r\n      this._internal.name = name;\r\n      this.flagOutputDirty(\"name\");\r\n      this.flagOutputDirty(\"value\");\r\n      this.sendSignalOnOutput(\"fetched\");\r\n    },\r\n    _onNodeDeleted() {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      this._internal.variablesModel.off(\r\n        \"change\",\r\n        this._internal.onModelChangedCallback\r\n      );\r\n    },\r\n  },\r\n};\r\n","import {\r\n  GraphModel,\r\n  Node,\r\n  NodeContext,\r\n  NodeDefinition,\r\n} from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  outputValues: Record<string, any>;\r\n  outputNames: string[];\r\n  eventReceived: boolean;\r\n  _isEnabled: boolean;\r\n  channelName: string;\r\n  consume: string;\r\n  onEventReceivedCallback?: (eventData: any) => void | null;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Event Receiver\",\r\n  docs: \"https://docs.noodl.net/nodes/events/receive-event\",\r\n  displayNodeName: \"Receive Event\",\r\n  category: \"Events\",\r\n  usePortAsLabel: \"channelName\",\r\n  color: \"component\",\r\n  initialize() {\r\n    this._internal.outputValues = {};\r\n    this._internal.outputNames = [];\r\n    this._internal.eventReceived = false;\r\n    this._internal._isEnabled = true;\r\n    this._internal.channelName = \"\";\r\n  },\r\n  inputs: {\r\n    enabled: {\r\n      displayName: \"Enabled\",\r\n      type: \"boolean\",\r\n      default: true,\r\n      set(value) {\r\n        this._internal._isEnabled = value;\r\n      },\r\n    },\r\n    consume: {\r\n      displayName: \"Consume\",\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"Never\", value: \"never\" },\r\n          { label: \"Always\", value: \"always\" },\r\n        ],\r\n      },\r\n      default: \"never\",\r\n      set(value) {\r\n        this._internal.consume = value;\r\n      },\r\n    },\r\n    channelName: {\r\n      type: { name: \"string\", identifierOf: \"EventChannelName\" },\r\n      displayName: \"Channel\",\r\n      set(value) {\r\n        if (this._internal.onEventReceivedCallback) {\r\n          //remove old listener\r\n          this.context.eventSenderEmitter.removeListener(\r\n            this._internal.channelName,\r\n            this._internal.onEventReceivedCallback\r\n          );\r\n          // @ts-expect-error\r\n          this._internal.onEventReceivedCallback = null;\r\n        }\r\n\r\n        this._internal.channelName = value;\r\n        // @ts-expect-error\r\n        this.registerListenersForChannel(value);\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    eventReceived: {\r\n      displayName: \"Received\",\r\n      type: \"signal\",\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    registerOutputIfNeeded(name) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      this._internal.outputNames.push(name);\r\n      this.registerOutput(name, {\r\n        getter: () => this._internal.outputValues[name],\r\n      });\r\n    },\r\n    // @ts-expect-error\r\n    handleEvent(eventData) {\r\n      if (!this._internal._isEnabled) {\r\n        return;\r\n      }\r\n      this.sendSignalOnOutput(\"eventReceived\");\r\n\r\n      for (const name in eventData) {\r\n        if (this.hasOutput(name)) {\r\n          this._internal.outputValues[name] = eventData[name];\r\n          this.flagOutputDirty(name);\r\n        }\r\n      }\r\n\r\n      return this._internal.consume === \"always\";\r\n    },\r\n    onEventReceived(eventData) {\r\n      // @ts-expect-error\r\n      this.handleEvent(eventData);\r\n    },\r\n    _onNodeDeleted() {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      if (this._internal.onEventReceivedCallback) {\r\n        const eventEmitter = this.context.eventSenderEmitter;\r\n        eventEmitter.removeListener(\r\n          this._internal.channelName,\r\n          this._internal.onEventReceivedCallback\r\n        );\r\n      }\r\n    },\r\n    registerListenersForChannel(channelName) {\r\n      const eventEmitter = this.context.eventSenderEmitter;\r\n      // @ts-expect-error\r\n      this._internal.onEventReceivedCallback = this.onEventReceived.bind(this);\r\n      // @ts-expect-error\r\n      eventEmitter.on(channelName, this._internal.onEventReceivedCallback);\r\n\r\n      this.context.eventEmitter.once(\"applicationDataReloaded\", () => {\r\n        if (this._internal.onEventReceivedCallback) {\r\n          eventEmitter.removeListener(\r\n            channelName,\r\n            this._internal.onEventReceivedCallback\r\n          );\r\n        }\r\n      });\r\n    },\r\n    // @ts-expect-error\r\n    getChannelName() {\r\n      return this._internal.channelName;\r\n    },\r\n  },\r\n};\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function onEventReceiver(node) {\r\n    let channelName = node.parameters.channelName;\r\n\r\n    function _collectPayloadPorts() {\r\n      const eventSenders = graphModel.getNodesWithType(\"Event Sender\");\r\n      const matching = eventSenders.filter(\r\n        (node) => node.parameters.channelName === channelName\r\n      );\r\n\r\n      const portKeys: Record<string, boolean> = {};\r\n      matching.forEach((node) => {\r\n        const ports = node.parameters.payload\r\n          ? node.parameters.payload.split(\",\")\r\n          : [];\r\n        for (const key of ports) {\r\n          portKeys[key] = true;\r\n        }\r\n      });\r\n\r\n      const ports = Object.keys(portKeys).map((key) => ({\r\n        name: key,\r\n        type: \"*\",\r\n        plug: \"output\",\r\n        displayName: key,\r\n      }));\r\n\r\n      context.editorConnection?.sendDynamicPorts(node.id, ports, {\r\n        detectRenamed: {\r\n          plug: \"output\",\r\n        },\r\n      });\r\n    }\r\n\r\n    _collectPayloadPorts();\r\n    node.on(\"parameterUpdated\", function (event) {\r\n      if (event.name === \"channelName\") {\r\n        channelName = event.value;\r\n        _collectPayloadPorts();\r\n      }\r\n    });\r\n\r\n    function _trackEventSender(node) {\r\n      node.on(\"inputPortAdded\", _collectPayloadPorts);\r\n      node.on(\"inputPortRemoved\", _collectPayloadPorts);\r\n      node.on(\"parameterUpdated\", function (event) {\r\n        if (event.name === \"channelName\") {\r\n          _collectPayloadPorts();\r\n        }\r\n      });\r\n    }\r\n\r\n    graphModel.getNodesWithType(\"Event Sender\").forEach(_trackEventSender);\r\n    graphModel.on(\"nodeAdded.Event Sender\", _trackEventSender);\r\n    graphModel.on(\"nodeRemoved.Event Sender\", _collectPayloadPorts);\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.Event Receiver\", onEventReceiver);\r\n    graphModel.getNodesWithType(\"Event Receiver\").forEach(onEventReceiver);\r\n  });\r\n}\r\n","import { GraphModel, NodeContext, NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  inputValues: Record<string, any>;\r\n  channelName: string;\r\n  propagation: string;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Event Sender\",\r\n  docs: \"https://docs.noodl.net/nodes/events/send-event\",\r\n  displayNodeName: \"Send Event\",\r\n  category: \"Events\",\r\n  usePortAsLabel: \"channelName\",\r\n  color: \"component\",\r\n  exportDynamicPorts: true,\r\n  initialize: function () {\r\n    this._internal.inputValues = {};\r\n    this._internal.channelName = \"\";\r\n    this._internal.propagation = \"global\";\r\n  },\r\n  inputs: {\r\n    sendEvent: {\r\n      displayName: \"Send\",\r\n      valueChangedToTrue: function () {\r\n        const self = this;\r\n\r\n        //wait for all other inputs to update before sending\r\n        this.scheduleAfterInputsHaveUpdated(function () {\r\n          if (self._internal.propagation === \"global\") {\r\n            self.context.sendGlobalEventFromEventSender(\r\n              self._internal.channelName,\r\n              self._internal.inputValues\r\n            );\r\n          } else {\r\n            self.nodeScope!.sendEventFromThisScope(\r\n              self._internal.channelName,\r\n              self._internal.inputValues,\r\n              self._internal.propagation\r\n            );\r\n          }\r\n        });\r\n      },\r\n    },\r\n    channelName: {\r\n      type: {\r\n        name: \"string\",\r\n        allowEditOnly: true,\r\n        identifierOf: \"EventChannelName\",\r\n        identifierDisplayName: \"Event Channels\",\r\n      },\r\n      default: \"\",\r\n      group: \"Settings\",\r\n      displayName: \"Channel Name\",\r\n      set: function (value) {\r\n        this._internal.channelName = value;\r\n        this._internal.inputValues._channelName = value;\r\n      },\r\n    },\r\n    propagation: {\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { value: \"global\", label: \"Global\" },\r\n          { value: \"parent\", label: \"Parent\" },\r\n          { value: \"children\", label: \"Children\" },\r\n          { value: \"siblings\", label: \"Siblings\" },\r\n        ],\r\n      },\r\n      default: \"global\",\r\n      group: \"Settings\",\r\n      displayName: \"Send to\",\r\n      set: function (value) {\r\n        this._internal.propagation = value;\r\n      },\r\n    },\r\n    payload: {\r\n      type: {\r\n        name: \"stringlist\",\r\n        allowEditOnly: true,\r\n      },\r\n      group: \"Payload\",\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    registerInputIfNeeded(name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n      const self = this;\r\n      this.registerInput(name, {\r\n        set: function (value) {\r\n          self._internal.inputValues[name] = value;\r\n        },\r\n      });\r\n    },\r\n  },\r\n};\r\n\r\nfunction updatePorts(nodeId: string, parameters: any, editorConnection: any) {\r\n  const ports: any[] = [];\r\n\r\n  // Add payload inputs\r\n  let payload = parameters.payload;\r\n  if (payload) {\r\n    payload = payload.split(\",\");\r\n    for (const p of payload) {\r\n      ports.push({\r\n        type: {\r\n          name: \"*\",\r\n          allowConnectionsOnly: true,\r\n        },\r\n        plug: \"input\",\r\n        group: \"Payload\",\r\n        name: p,\r\n        displayName: p,\r\n      });\r\n    }\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports, {\r\n    detectRenamed: {\r\n      plug: \"input\",\r\n    },\r\n  });\r\n}\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  graphModel.on(\"nodeAdded.Event Sender\", function (node: any) {\r\n    updatePorts(node.id, node.parameters, context.editorConnection);\r\n\r\n    node.on(\"parameterUpdated\", function (event: any) {\r\n      updatePorts(node.id, node.parameters, context.editorConnection);\r\n    });\r\n  });\r\n}\r\n","import {\r\n  Node,\r\n  NodeDefinition,\r\n  logJavaScriptNodeError,\r\n  guid,\r\n  NodeContext,\r\n  GraphModel,\r\n  JavascriptNodeParser,\r\n} from \"@fluxscape/runtime\";\r\n\r\nconst defaultCode = \"\";\r\n\r\ninterface Internal {\r\n  inputValues: Record<string, any>;\r\n  outputValues: Record<string, any>;\r\n  outputProperties: Record<string, any>;\r\n  runScheduled: boolean;\r\n  setupScheduled: boolean;\r\n  runNextFrameScheduled: boolean;\r\n  isWaitingForExternalFileToLoad: boolean;\r\n  useExternalFile: boolean;\r\n  runFunction?: Function;\r\n  destroyFunction?: Function;\r\n  setupFunction?: Function;\r\n  hasParsedCode: boolean;\r\n  changedInputs: Record<string, any>;\r\n  signalScheduled: Record<string, boolean>;\r\n  killed: boolean;\r\n  inputQueue: Array<{ name: string; value: any }>;\r\n  userFunctionScope: {\r\n    createComponent: (componentName: string) => any;\r\n    deleteComponent: (component: any) => void;\r\n    flagOutputDirty: (name: string) => void;\r\n    runNextFrame: () => void;\r\n    sendSignalOnOutput: (name: string) => void;\r\n  };\r\n  onFrameStart: () => void;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Javascript2\",\r\n  docs: \"https://docs.noodl.net/nodes/javascript/script\",\r\n  displayNodeName: \"Script\",\r\n  category: \"CustomCode\",\r\n  color: \"javascript\",\r\n  nodeDoubleClickAction: {\r\n    focusPort: \"Code\",\r\n  },\r\n  searchTags: [\"javascript\"],\r\n  exportDynamicPorts: true,\r\n  initialize: function () {\r\n    const internal: Internal = this._internal;\r\n    internal.inputValues = {};\r\n    internal.outputValues = {};\r\n    internal.outputProperties = {};\r\n    internal.runScheduled = false;\r\n    internal.setupScheduled = false;\r\n    internal.runNextFrameScheduled = false;\r\n    internal.isWaitingForExternalFileToLoad = false;\r\n    internal.useExternalFile = false;\r\n    internal.runFunction = undefined;\r\n    internal.destroyFunction = undefined;\r\n    internal.setupFunction = undefined;\r\n    internal.hasParsedCode = false;\r\n    internal.changedInputs = {};\r\n    internal.signalScheduled = {};\r\n    internal.killed = false;\r\n    internal.inputQueue = [];\r\n\r\n    const self = this;\r\n    internal.userFunctionScope = {\r\n      createComponent(componentName: string) {\r\n        if (\r\n          componentName &&\r\n          componentName.length > 0 &&\r\n          componentName[0] !== \"/\"\r\n        ) {\r\n          componentName = \"/\" + componentName;\r\n        }\r\n        // @ts-expect-error\r\n        return self.nodeScope.createNode(componentName, guid());\r\n      },\r\n      deleteComponent(component) {\r\n        // @ts-expect-error\r\n        self.nodeScope.deleteNode(component);\r\n      },\r\n      flagOutputDirty(name: string) {\r\n        if (!name) {\r\n          throw new Error(\"Output port name must be specified\");\r\n        }\r\n        self.flagOutputDirty(name);\r\n      },\r\n      runNextFrame() {\r\n        if (internal.runNextFrameScheduled) {\r\n          return;\r\n        }\r\n        internal.runNextFrameScheduled = true;\r\n        self.context.scheduleNextFrame(function () {\r\n          internal.runNextFrameScheduled = false;\r\n          if (!internal.killed) {\r\n            scheduleRun.call(self);\r\n          }\r\n        });\r\n      },\r\n      sendSignalOnOutput(name: string) {\r\n        self.sendSignalOnOutput(name);\r\n      },\r\n    };\r\n\r\n    internal.onFrameStart = onFrameStart.bind(this);\r\n  },\r\n  dynamicports: [\r\n    {\r\n      condition: \"useExternalFile = no OR useExternalFile NOT SET\",\r\n      inputs: [\"code\"],\r\n    },\r\n    {\r\n      condition: \"useExternalFile = yes\",\r\n      inputs: [\"externalFile\"],\r\n    },\r\n  ],\r\n  inputs: {\r\n    scriptInputs: {\r\n      type: {\r\n        name: \"proplist\",\r\n        allowEditOnly: true,\r\n      },\r\n      group: \"Script Inputs\",\r\n      set(value: any) {\r\n        // ignore\r\n      },\r\n    },\r\n    scriptOutputs: {\r\n      type: {\r\n        name: \"proplist\",\r\n        allowEditOnly: true,\r\n      },\r\n      group: \"Script Outputs\",\r\n      set(value: any) {\r\n        // ignore\r\n      },\r\n    },\r\n    useExternalFile: {\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          {\r\n            value: \"yes\",\r\n            label: \"Yes\",\r\n          },\r\n          {\r\n            value: \"no\",\r\n            label: \"No\",\r\n          },\r\n        ],\r\n        allowEditOnly: true,\r\n      },\r\n      default: \"no\",\r\n      displayName: \"Use External File\",\r\n      group: \"Code\",\r\n      set(value: string) {\r\n        this._internal.isWaitingForExternalFileToLoad = value === \"yes\";\r\n        this._internal.useExternalFile = value === \"yes\";\r\n      },\r\n    },\r\n    code: {\r\n      displayName: \"Code\",\r\n      group: \"Code\",\r\n      type: {\r\n        name: \"string\",\r\n        allowEditOnly: true,\r\n        codeeditor: \"javascript\",\r\n      },\r\n      default: defaultCode,\r\n      set(value: string) {\r\n        if (!value) {\r\n          return;\r\n        }\r\n        const self = this;\r\n        this.scheduleAfterInputsHaveUpdated(function () {\r\n          if (this._internal.useExternalFile === false) {\r\n            // @ts-expect-error\r\n            this._callDestroyFunction();\r\n            const parser = JavascriptNodeParser.createFromCode(value, {\r\n              node: this,\r\n            });\r\n            // @ts-expect-error\r\n            self._onCodeParsed(parser);\r\n          }\r\n        });\r\n      },\r\n    },\r\n    externalFile: {\r\n      displayName: \"File Path\",\r\n      group: \"Code\",\r\n      type: {\r\n        name: \"source\",\r\n        allowEditOnly: true,\r\n      },\r\n      set(url: string) {\r\n        if (this._internal.useExternalFile === false) {\r\n          return;\r\n        }\r\n\r\n        const self = this;\r\n        JavascriptNodeParser.createFromURL(\r\n          url,\r\n          function (parser) {\r\n            self._internal.isWaitingForExternalFileToLoad = false;\r\n            // @ts-expect-error\r\n            self._onCodeParsed(parser);\r\n          },\r\n          {\r\n            node: this,\r\n          }\r\n        );\r\n      },\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    _onNodeDeleted() {\r\n      Node.prototype._onNodeDeleted.call(this);\r\n      this._internal.killed = true;\r\n      // @ts-expect-error\r\n      this._callDestroyFunction();\r\n    },\r\n    update() {\r\n      if (this._internal.isWaitingForExternalFileToLoad === true) {\r\n        // @ts-expect-error\r\n        this._dirty = false;\r\n      } else {\r\n        Node.prototype.update.call(this);\r\n      }\r\n    },\r\n    _onCodeParsed(parser: any) {\r\n      const editorConnection = this.context.editorConnection;\r\n\r\n      if (editorConnection) {\r\n        for (const w of [\r\n          \"js-destroy-waring\",\r\n          \"js-run-waring\",\r\n          \"js-setup-waring\",\r\n        ]) {\r\n          editorConnection.clearWarning(\r\n            // @ts-expect-error\r\n            this.nodeScope.componentOwner.name,\r\n            this.id,\r\n            w\r\n          );\r\n        }\r\n      }\r\n\r\n      if (parser.error) {\r\n        return;\r\n      }\r\n\r\n      // register all color inputs with type 'color' to enable color resolving\r\n      // @ts-expect-error\r\n      Object.keys(this.model.inputPorts).forEach((name) => {\r\n        // @ts-expect-error\r\n        const type = this.model.inputPorts[name].type;\r\n        // @ts-expect-error\r\n        if (type === \"color\" || type.name === \"color\") {\r\n          this._internal.inputValues[name] = undefined;\r\n\r\n          if (!this.hasInput(name)) {\r\n            this.registerInput(name, {\r\n              type: \"color\",\r\n              set: userInputSetter.bind(this, name),\r\n            });\r\n          } else {\r\n            // input was registered before js was done parsing\r\n            // patch it instead of creating a new one\r\n            // @ts-expect-error\r\n            this.getInput(name).type = \"color\";\r\n          }\r\n        }\r\n      });\r\n\r\n      // @ts-expect-error\r\n      Object.keys(this.model.outputPorts).forEach((name) => {\r\n        // @ts-expect-error\r\n        this.registerOutputIfNeeded(name);\r\n      });\r\n\r\n      this._internal.setupFunction = parser.setup;\r\n      this._internal.runFunction = parser.change; // Run function is actually called change\r\n      this._internal.destroyFunction = parser.destroy;\r\n\r\n      // @ts-expect-error\r\n      this._internal.definedObject = parser.definedObject;\r\n\r\n      if (this._internal.setupFunction) {\r\n        scheduleSetup.call(this);\r\n      }\r\n\r\n      if (this._internal.runFunction) {\r\n        scheduleRun.call(this);\r\n      }\r\n\r\n      this._internal.hasParsedCode = true;\r\n\r\n      // set all the inputs that arrived before the code was parsed\r\n      if (this._internal.inputQueue) {\r\n        for (const { name, value } of this._internal.inputQueue) {\r\n          this.setInputValue(name, value);\r\n        }\r\n\r\n        // delete the queue, not needed anymore\r\n        // @ts-expect-error\r\n        this._internal.inputQueue = undefined;\r\n      }\r\n\r\n      // Node API\r\n      parser.apis.Node.Inputs = this._internal.inputValues;\r\n      parser.apis.Node.Outputs = this._internal.outputProperties;\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      this._internal.inputValues[name] = undefined;\r\n\r\n      this.registerInput(name, {\r\n        set: userInputSetter.bind(this, name),\r\n      });\r\n    },\r\n    registerOutputIfNeeded(name: string) {\r\n      if (this.hasOutput(name)) {\r\n        return;\r\n      }\r\n\r\n      const self = this;\r\n\r\n      const isSignal =\r\n        // @ts-expect-error\r\n        _typename(this.model.outputPorts[name].type) === \"signal\";\r\n\r\n      Object.defineProperty(this._internal.outputProperties, name, {\r\n        set(value) {\r\n          if (isSignal) return; // Cannot set signal functions\r\n\r\n          self._internal.outputValues[name] = value;\r\n          self.flagOutputDirty(name);\r\n        },\r\n        get() {\r\n          if (isSignal)\r\n            return () => {\r\n              if (self.hasOutput(name)) self.sendSignalOnOutput(name);\r\n            };\r\n          return self._internal.outputValues[name];\r\n        },\r\n      });\r\n\r\n      this.registerOutput(name, {\r\n        getter: userOutputGetter.bind(this, name),\r\n      });\r\n    },\r\n    _callRunFunction() {\r\n      const internal = this._internal;\r\n      if (!internal.runFunction || internal.killed) {\r\n        return;\r\n      }\r\n\r\n      try {\r\n        internal.runFunction.call(\r\n          internal.userFunctionScope,\r\n          internal.inputValues,\r\n          internal.outputProperties,\r\n          internal.changedInputs\r\n        );\r\n      } catch (e) {\r\n        logJavaScriptNodeError(e);\r\n\r\n        if (\r\n          this.context.editorConnection &&\r\n          this.context.isWarningTypeEnabled(\"javascriptExecution\")\r\n        ) {\r\n          this.context.editorConnection.sendWarning(\r\n            // @ts-expect-error\r\n            this.nodeScope.componentOwner.name,\r\n            this.id,\r\n            \"js-run-waring\",\r\n            {\r\n              showGlobally: true,\r\n              // @ts-expect-error\r\n              message: \"<strong>run</strong>: \" + e.message,\r\n            }\r\n          );\r\n        }\r\n      }\r\n    },\r\n    _callSignalFunction(name: string) {\r\n      const internal = this._internal;\r\n      // @ts-expect-error\r\n      if (!internal.definedObject || internal.killed) {\r\n        return;\r\n      }\r\n\r\n      if (\r\n        // @ts-expect-error\r\n        !internal.definedObject[name] ||\r\n        // @ts-expect-error\r\n        typeof internal.definedObject[name] !== \"function\"\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      try {\r\n        // @ts-expect-error\r\n        internal.definedObject[name].call(\r\n          internal.userFunctionScope,\r\n          internal.inputValues,\r\n          internal.outputProperties\r\n        );\r\n      } catch (e) {\r\n        console.log(\r\n          \"Error in JS node signal function code.\",\r\n          // @ts-expect-error\r\n          Object.getPrototypeOf(e).constructor.name + \": \" + e.message\r\n        );\r\n        if (\r\n          this.context.editorConnection &&\r\n          this.context.isWarningTypeEnabled(\"javascriptExecution\")\r\n        ) {\r\n          this.context.editorConnection.sendWarning(\r\n            // @ts-expect-error\r\n            this.nodeScope.componentOwner.name,\r\n            this.id,\r\n            \"js-run-waring\",\r\n            {\r\n              showGlobally: true,\r\n              // @ts-expect-error\r\n              message: \"<strong>run</strong>: \" + e.message,\r\n            }\r\n          );\r\n        }\r\n      }\r\n    },\r\n    _callDestroyFunction() {\r\n      const internal = this._internal;\r\n\r\n      if (!internal.destroyFunction) {\r\n        return;\r\n      }\r\n\r\n      try {\r\n        internal.destroyFunction.call(\r\n          internal.userFunctionScope,\r\n          internal.inputValues,\r\n          internal.outputProperties\r\n        );\r\n      } catch (e) {\r\n        console.log(\r\n          \"Error in JS node destroy code.\",\r\n          // @ts-expect-error\r\n          Object.getPrototypeOf(e).constructor.name + \": \" + e.message\r\n        );\r\n        if (\r\n          this.context.editorConnection &&\r\n          this.context.isWarningTypeEnabled(\"javascriptExecution\")\r\n        ) {\r\n          this.context.editorConnection.sendWarning(\r\n            // @ts-expect-error\r\n            this.nodeScope.componentOwner.name,\r\n            this.id,\r\n            \"js-destroy-waring\",\r\n            {\r\n              showGlobally: true,\r\n              // @ts-expect-error\r\n              message: \"<strong>setup</strong>: \" + e.message,\r\n            }\r\n          );\r\n        }\r\n      }\r\n    },\r\n    _callSetupFunction() {\r\n      const internal = this._internal;\r\n      if (!internal.setupFunction || internal.killed) {\r\n        return;\r\n      }\r\n\r\n      try {\r\n        internal.setupFunction.call(\r\n          internal.userFunctionScope,\r\n          internal.inputValues,\r\n          internal.outputProperties\r\n        );\r\n      } catch (e) {\r\n        console.log(\r\n          \"Error in JS node setup code.\",\r\n          // @ts-expect-error\r\n          Object.getPrototypeOf(e).constructor.name + \": \" + e.message\r\n        );\r\n        if (\r\n          this.context.editorConnection &&\r\n          this.context.isWarningTypeEnabled(\"javascriptExecution\")\r\n        ) {\r\n          this.context.editorConnection.sendWarning(\r\n            // @ts-expect-error\r\n            this.nodeScope.componentOwner.name,\r\n            this.id,\r\n            \"js-setup-waring\",\r\n            {\r\n              showGlobally: true,\r\n              // @ts-expect-error\r\n              message: \"<strong>setup</strong>: \" + e.message,\r\n            }\r\n          );\r\n        }\r\n      }\r\n    },\r\n  },\r\n};\r\n\r\nfunction scheduleSetup() {\r\n  // @ts-expect-error\r\n  if (this._internal.setupScheduled) {\r\n    return;\r\n  }\r\n\r\n  // @ts-expect-error\r\n  this._internal.setupScheduled = true;\r\n  // @ts-expect-error\r\n  this.scheduleAfterInputsHaveUpdated(function () {\r\n    // @ts-expect-error\r\n    if (!this._internal.killed) {\r\n      // @ts-expect-error\r\n      this._callSetupFunction();\r\n      // @ts-expect-error\r\n      this._internal.setupScheduled = false;\r\n    }\r\n  });\r\n}\r\n\r\nfunction scheduleRun() {\r\n  // @ts-expect-error\r\n  if (this._internal.runScheduled || this._internal.killed) {\r\n    return;\r\n  }\r\n\r\n  // @ts-expect-error\r\n  this._internal.runScheduled = true;\r\n  // @ts-expect-error\r\n  this.scheduleAfterInputsHaveUpdated(function () {\r\n    // @ts-expect-error\r\n    if (!this._internal.killed) {\r\n      // @ts-expect-error\r\n      this._callRunFunction();\r\n      // @ts-expect-error\r\n      this._internal.changedInputs = {};\r\n      // @ts-expect-error\r\n      this._internal.runScheduled = false;\r\n    }\r\n  });\r\n}\r\n\r\nfunction scheduleSignal(name: string) {\r\n  // @ts-expect-error\r\n  if (this._internal.signalScheduled[name] || this._internal.killed) {\r\n    return;\r\n  }\r\n\r\n  // @ts-expect-error\r\n  this._internal.signalScheduled[name] = true;\r\n  // @ts-expect-error\r\n  this.scheduleAfterInputsHaveUpdated(function () {\r\n    // @ts-expect-error\r\n    if (!this._internal.killed) {\r\n      // @ts-expect-error\r\n      this._callSignalFunction(name);\r\n      // @ts-expect-error\r\n      this._internal.signalScheduled[name] = false;\r\n    }\r\n  });\r\n}\r\n\r\nfunction onFrameStart() {\r\n  // @ts-expect-error\r\n  this._internal.runNextFrame = false;\r\n  // @ts-expect-error\r\n  scheduleRun.call(this);\r\n}\r\n\r\nfunction _typename(type: any) {\r\n  if (typeof type === \"string\") return type;\r\n  else return type.name;\r\n}\r\n\r\nfunction userInputSetter(name: string, value: any) {\r\n  // @ts-expect-error\r\n  if (this._internal.hasParsedCode === true) {\r\n    if (\r\n      // @ts-expect-error\r\n      this.model.inputPorts[name] !== undefined &&\r\n      // @ts-expect-error\r\n      _typename(this.model.inputPorts[name].type) === \"signal\"\r\n    ) {\r\n      // If this is a signal, call the signal function\r\n      if (\r\n        // @ts-expect-error\r\n        this._internal.definedObject &&\r\n        // @ts-expect-error\r\n        typeof this._internal.definedObject[name] === \"function\"\r\n      ) {\r\n        // This is a signal input, schedule a call to the signal function\r\n        // @ts-expect-error\r\n        if (value) scheduleSignal.call(this, name);\r\n      }\r\n    } else {\r\n      // @ts-expect-error\r\n      this._internal.inputValues[name] = value;\r\n      // @ts-expect-error\r\n      this._internal.changedInputs[name] = true;\r\n      // @ts-expect-error\r\n      scheduleRun.call(this);\r\n    }\r\n  } else {\r\n    // inputs are arriving before the code is parsed\r\n    // queue them up and set them later to make sure signals are\r\n    // properly recognized\r\n    // @ts-expect-error\r\n    this._internal.inputQueue.push({\r\n      name,\r\n      value,\r\n    });\r\n  }\r\n}\r\n\r\nfunction userOutputGetter(name: string) {\r\n  // @ts-expect-error\r\n  return this._internal.outputValues[name];\r\n}\r\n\r\nfunction _parseAndSourceJavascript(\r\n  nodeModel: any,\r\n  context: any,\r\n  fn: (ports: any) => void\r\n) {\r\n  const editorConnection = context.editorConnection;\r\n\r\n  if (!nodeModel.parameters) {\r\n    return;\r\n  }\r\n\r\n  function clearWarnings() {\r\n    for (const w of [\r\n      \"js-parse-waring\",\r\n      \"js-destroy-waring\",\r\n      \"js-run-waring\",\r\n      \"js-setup-waring\",\r\n    ]) {\r\n      editorConnection.clearWarning(nodeModel.component.name, nodeModel.id, w);\r\n    }\r\n  }\r\n\r\n  function onCodeParsed(parser: any) {\r\n    if (parser.error) {\r\n      editorConnection.sendWarning(\r\n        nodeModel.component.name,\r\n        nodeModel.id,\r\n        \"js-parse-waring\",\r\n        {\r\n          showGlobally: true,\r\n          message: parser.error,\r\n        }\r\n      );\r\n    } else {\r\n      clearWarnings();\r\n    }\r\n\r\n    fn(parser.getPorts());\r\n  }\r\n\r\n  if (\r\n    nodeModel.parameters.externalFile &&\r\n    nodeModel.parameters.useExternalFile === \"yes\"\r\n  ) {\r\n    const url = nodeModel.parameters.externalFile;\r\n    JavascriptNodeParser.createFromURL(url, onCodeParsed);\r\n  } else if (nodeModel.parameters.code) {\r\n    const parser = JavascriptNodeParser.createFromCode(\r\n      nodeModel.parameters.code\r\n    );\r\n    onCodeParsed(parser);\r\n  } else {\r\n    // no code, just send empty port list\r\n    clearWarnings();\r\n    fn([]);\r\n  }\r\n}\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    function _updatePorts() {\r\n      const ports: any[] = [];\r\n\r\n      const _inputTypeEnums = [\r\n        {\r\n          value: \"string\",\r\n          label: \"String\",\r\n        },\r\n        {\r\n          value: \"boolean\",\r\n          label: \"Boolean\",\r\n        },\r\n        {\r\n          value: \"number\",\r\n          label: \"Number\",\r\n        },\r\n        {\r\n          value: \"object\",\r\n          label: \"Object\",\r\n        },\r\n        {\r\n          value: \"array\",\r\n          label: \"Array\",\r\n        },\r\n      ];\r\n\r\n      const _outputTypeEnums = [\r\n        {\r\n          value: \"string\",\r\n          label: \"String\",\r\n        },\r\n        {\r\n          value: \"boolean\",\r\n          label: \"Boolean\",\r\n        },\r\n        {\r\n          value: \"number\",\r\n          label: \"Number\",\r\n        },\r\n        {\r\n          value: \"object\",\r\n          label: \"Object\",\r\n        },\r\n        {\r\n          value: \"array\",\r\n          label: \"Array\",\r\n        },\r\n        {\r\n          value: \"signal\",\r\n          label: \"Signal\",\r\n        },\r\n      ];\r\n\r\n      // Outputs\r\n      if (\r\n        node.parameters[\"scriptOutputs\"] !== undefined &&\r\n        node.parameters[\"scriptOutputs\"].length > 0\r\n      ) {\r\n        node.parameters[\"scriptOutputs\"].forEach((p: any) => {\r\n          // Type for output\r\n          ports.push({\r\n            name: \"outtype-\" + p.label,\r\n            displayName: \"Type\",\r\n            plug: \"input\",\r\n            type: {\r\n              name: \"enum\",\r\n              enums: _outputTypeEnums,\r\n              allowEditOnly: true,\r\n            },\r\n            default: \"string\",\r\n            parent: \"scriptOutputs\",\r\n            parentItemId: p.id,\r\n          });\r\n\r\n          // Value for output\r\n          ports.push({\r\n            name: p.label,\r\n            plug: \"output\",\r\n            type: node.parameters[\"outtype-\" + p.label] || \"*\",\r\n            group: \"Outputs\",\r\n          });\r\n        });\r\n      }\r\n\r\n      // Inputs\r\n      if (\r\n        node.parameters[\"scriptInputs\"] !== undefined &&\r\n        node.parameters[\"scriptInputs\"].length > 0\r\n      ) {\r\n        node.parameters[\"scriptInputs\"].forEach((p: any) => {\r\n          // Type for input\r\n          ports.push({\r\n            name: \"intype-\" + p.label,\r\n            displayName: \"Type\",\r\n            plug: \"input\",\r\n            type: {\r\n              name: \"enum\",\r\n              enums: _inputTypeEnums,\r\n              allowEditOnly: true,\r\n            },\r\n            default: \"string\",\r\n            parent: \"scriptInputs\",\r\n            parentItemId: p.id,\r\n          });\r\n\r\n          // Default Value for input\r\n          ports.push({\r\n            name: p.label,\r\n            plug: \"input\",\r\n            type: node.parameters[\"intype-\" + p.label] || \"string\",\r\n            group: \"Inputs\",\r\n          });\r\n        });\r\n      }\r\n\r\n      _parseAndSourceJavascript(node, context, function (_ports: any) {\r\n        // Merge in ports from script\r\n        _ports.forEach((p: any) => {\r\n          if (ports.find((_p) => _p.name === p.name && _p.plug === p.plug))\r\n            return; // Port already exists\r\n\r\n          ports.push(p);\r\n        });\r\n\r\n        context.editorConnection?.sendDynamicPorts(node.id, ports);\r\n      });\r\n    }\r\n\r\n    _updatePorts();\r\n    node.on(\"parameterUpdated\", function () {\r\n      _updatePorts();\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.Javascript2\", function (node: any) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"Javascript2\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","import { NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  _currentInputValue: number;\r\n  _remappedValue: number;\r\n  _minInputValue: number;\r\n  _maxInputValue: number;\r\n  _minOutputValue: number;\r\n  _maxOutputValue: number;\r\n  _clampOutput: boolean;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Number Remapper\",\r\n  docs: \"https://docs.noodl.net/nodes/math/number-remapper\",\r\n  category: \"Math\",\r\n  initialize() {\r\n    const internal = this._internal;\r\n    internal._currentInputValue = 0;\r\n    internal._remappedValue = 0;\r\n    internal._minInputValue = 0;\r\n    internal._maxInputValue = 0;\r\n    internal._minOutputValue = 0;\r\n    internal._maxOutputValue = 1;\r\n    internal._clampOutput = true;\r\n  },\r\n  getInspectInfo() {\r\n    return this._internal._remappedValue;\r\n  },\r\n  inputs: {\r\n    inputValue: {\r\n      group: \"Value to Remap\",\r\n      type: {\r\n        name: \"number\",\r\n        allowConnectionOnly: true,\r\n      },\r\n      default: 0,\r\n      displayName: \"Input Value\",\r\n      set(value: number) {\r\n        this._internal._currentInputValue = value;\r\n        // @ts-expect-error\r\n        this._calculateNewOutputValue();\r\n      },\r\n    },\r\n    minInputValue: {\r\n      group: \"Input Parameters\",\r\n      type: {\r\n        name: \"number\",\r\n      },\r\n      default: 0,\r\n      displayName: \"Input Minimum\",\r\n      set(value: number) {\r\n        this._internal._minInputValue = value;\r\n        // @ts-expect-error\r\n        this._calculateNewOutputValue();\r\n      },\r\n    },\r\n    maxInputValue: {\r\n      group: \"Input Parameters\",\r\n      type: {\r\n        name: \"number\",\r\n      },\r\n      default: 0,\r\n      displayName: \"Input Maximum\",\r\n      set(value: number) {\r\n        this._internal._maxInputValue = value;\r\n        // @ts-expect-error\r\n        this._calculateNewOutputValue();\r\n      },\r\n    },\r\n    minOutputValue: {\r\n      group: \"Output Parameters\",\r\n      type: {\r\n        name: \"number\",\r\n      },\r\n      default: 0,\r\n      displayName: \"Output Minimum\",\r\n      set(value: number) {\r\n        this._internal._minOutputValue = value;\r\n        // @ts-expect-error\r\n        this._calculateNewOutputValue();\r\n      },\r\n    },\r\n    maxOutputValue: {\r\n      group: \"Output Parameters\",\r\n      type: {\r\n        name: \"number\",\r\n      },\r\n      default: 1,\r\n      displayName: \"Output Maximum\",\r\n      set(value: number) {\r\n        this._internal._maxOutputValue = value;\r\n        // @ts-expect-error\r\n        this._calculateNewOutputValue();\r\n      },\r\n    },\r\n    clamp: {\r\n      group: \"Output Parameters\",\r\n      type: {\r\n        name: \"boolean\",\r\n        allowEditOnly: true,\r\n      },\r\n      default: true,\r\n      displayName: \"Clamp Output\",\r\n      set(value: boolean) {\r\n        this._internal._clampOutput = value;\r\n        // @ts-expect-error\r\n        this._calculateNewOutputValue();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    remappedValue: {\r\n      type: \"number\",\r\n      displayName: \"Remapped Value\",\r\n      group: \"Outputs\",\r\n      getter() {\r\n        return this._internal._remappedValue;\r\n      },\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    _calculateNewOutputValue() {\r\n      let normalizedValue: number;\r\n      const internal = this._internal;\r\n\r\n      if (internal._maxInputValue === internal._minInputValue) {\r\n        normalizedValue = 0;\r\n      } else {\r\n        normalizedValue =\r\n          (internal._currentInputValue - internal._minInputValue) /\r\n          (internal._maxInputValue - internal._minInputValue);\r\n      }\r\n\r\n      if (internal._clampOutput) {\r\n        normalizedValue = Math.max(0, Math.min(1, normalizedValue));\r\n      }\r\n      internal._remappedValue =\r\n        internal._minOutputValue +\r\n        normalizedValue * (internal._maxOutputValue - internal._minOutputValue);\r\n      this.flagOutputDirty(\"remappedValue\");\r\n    },\r\n  },\r\n};\r\n","import { NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  file?: File;\r\n  inputElement: HTMLInputElement;\r\n  acceptedFileTypes?: string;\r\n  capture?: string;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Open File Picker\",\r\n  docs: \"https://docs.noodl.net/nodes/utilities/open-file-picker\",\r\n  category: \"Utilities\",\r\n  getInspectInfo() {\r\n    if (this._internal.file) {\r\n      // @ts-expect-error\r\n      return this._internal.file.path;\r\n    }\r\n  },\r\n  initialize() {\r\n    //for some reason the input element has to be created here, it doesn't\r\n    //work predictably in Safari when created in the open signal function.\r\n    //Creating it here and reusing it seems to work correctly in all browsers.\r\n    const input = document.createElement(\"input\");\r\n    input.type = \"file\";\r\n\r\n    this._internal.inputElement = input;\r\n  },\r\n  inputs: {\r\n    open: {\r\n      type: \"signal\",\r\n      displayName: \"Open\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        const input = this._internal.inputElement;\r\n\r\n        const onChange = (e: Event) => {\r\n          const target = e.target as HTMLInputElement;\r\n          this._internal.file = target.files ? target.files[0] : undefined;\r\n\r\n          this.flagOutputDirty(\"file\");\r\n          this.flagOutputDirty(\"path\");\r\n          this.flagOutputDirty(\"name\");\r\n          this.flagOutputDirty(\"sizeInBytes\");\r\n          this.flagOutputDirty(\"type\");\r\n\r\n          this.sendSignalOnOutput(\"success\");\r\n\r\n          input.onchange = null;\r\n          input.value = \"\"; //reset value so the same file can be picked again\r\n        };\r\n\r\n        input.accept = this._internal.acceptedFileTypes || \"\";\r\n\r\n        if (this._internal.capture) {\r\n          input.capture = this._internal.capture;\r\n        }\r\n\r\n        input.onchange = onChange;\r\n        input.click();\r\n      },\r\n    },\r\n    acceptedFileTypes: {\r\n      group: \"General\",\r\n      type: \"string\",\r\n      displayName: \"Accepted file types\",\r\n      set(value: string) {\r\n        this._internal.acceptedFileTypes = value;\r\n      },\r\n    },\r\n    capture: {\r\n      group: \"General\",\r\n      type: \"string\",\r\n      displayName: \"Capture\",\r\n      set(value: string) {\r\n        this._internal.capture = value;\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    file: {\r\n      type: \"*\",\r\n      displayName: \"File\",\r\n      group: \"General\",\r\n      get() {\r\n        return this._internal.file;\r\n      },\r\n    },\r\n    path: {\r\n      displayName: \"Path\",\r\n      group: \"Metadata\",\r\n      type: \"string\",\r\n      get() {\r\n        // @ts-expect-error\r\n        return this._internal.file && this._internal.file.path;\r\n      },\r\n    },\r\n    name: {\r\n      displayName: \"Name\",\r\n      group: \"Metadata\",\r\n      type: \"string\",\r\n      get() {\r\n        return this._internal.file && this._internal.file.name;\r\n      },\r\n    },\r\n    sizeInBytes: {\r\n      displayName: \"Size in bytes\",\r\n      group: \"Metadata\",\r\n      type: \"number\",\r\n      get() {\r\n        return this._internal.file && this._internal.file.size;\r\n      },\r\n    },\r\n    type: {\r\n      displayName: \"Type\",\r\n      group: \"Metadata\",\r\n      type: \"string\",\r\n      get() {\r\n        return this._internal.file && this._internal.file.type;\r\n      },\r\n    },\r\n    success: {\r\n      type: \"signal\",\r\n      group: \"Events\",\r\n      displayName: \"Success\",\r\n    },\r\n  },\r\n};\r\n","import { NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  width: number;\r\n  height: number;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Screen Resolution\",\r\n  docs: \"https://docs.noodl.net/nodes/utilities/screen-resolution\",\r\n  category: \"Utilities\",\r\n  initialize() {\r\n    // Add SSR Support\r\n    if (typeof window === \"undefined\") return;\r\n\r\n    window.addEventListener(\"resize\", () => {\r\n      // @ts-expect-error\r\n      this._viewportSizeChanged();\r\n    });\r\n    // @ts-expect-error\r\n    this._viewportSizeChanged();\r\n  },\r\n  getInspectInfo() {\r\n    return `${this._internal.width} x ${this._internal.height}`;\r\n  },\r\n  outputs: {\r\n    width: {\r\n      type: \"number\",\r\n      displayName: \"Width\",\r\n      get() {\r\n        return this._internal.width;\r\n      },\r\n    },\r\n    height: {\r\n      type: \"number\",\r\n      displayName: \"Height\",\r\n      get() {\r\n        return this._internal.height;\r\n      },\r\n    },\r\n    aspectRatio: {\r\n      type: \"number\",\r\n      displayName: \"Aspect Ratio\",\r\n      get() {\r\n        return this._internal.width / this._internal.height;\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    _viewportSizeChanged() {\r\n      this._internal.width = window.innerWidth;\r\n      this._internal.height = window.innerHeight;\r\n      this.flagAllOutputsDirty();\r\n    },\r\n  },\r\n};\r\n","import {\r\n  createSetter,\r\n  GraphModel,\r\n  NodeContext,\r\n  NodeDefinition,\r\n} from \"@fluxscape/runtime\";\r\nimport EaseCurves from \"../../easecurves\";\r\nimport BezierEasing from \"bezier-easing\";\r\n\r\nconst defaultDuration = 300;\r\nconst previousStates: Record<string, string[]> = {};\r\nconst previousValues: Record<string, string[]> = {};\r\n\r\nfunction setRGBA(result: number[], hex: string) {\r\n  if (hex === \"transparent\" || !hex) {\r\n    result[3] = 0;\r\n    return;\r\n  }\r\n\r\n  const numComponents = (hex.length - 1) / 2;\r\n\r\n  for (let i = 0; i < numComponents; ++i) {\r\n    const index = 1 + i * 2;\r\n    result[i] = parseInt(hex.substring(index, index + 2), 16);\r\n  }\r\n}\r\n\r\nfunction componentToHex(c: number): string {\r\n  const hex = c.toString(16);\r\n  return hex.length === 1 ? \"0\" + hex : hex;\r\n}\r\n\r\nfunction rgbaToHex(rgba: number[]): string {\r\n  return (\r\n    \"#\" +\r\n    componentToHex(rgba[0]) +\r\n    componentToHex(rgba[1]) +\r\n    componentToHex(rgba[2]) +\r\n    componentToHex(rgba[3])\r\n  );\r\n}\r\n\r\ninterface Internal {\r\n  useTransitions: boolean;\r\n  currentValues: Record<string, any>;\r\n  stateParameters: Record<string, any>;\r\n  stateParameterTypes: Record<string, any>;\r\n  startValues: Record<string, any>;\r\n  bezierEaseCurves: Record<string, any>;\r\n  transitionFuncs: Record<string, any>;\r\n  valuesAreInitialised: boolean;\r\n  animation: any; // Replace with actual type if known\r\n  states?: string[];\r\n  state?: string;\r\n  startState?: string;\r\n  goToState?: string;\r\n  values?: string[];\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"States\",\r\n  docs: \"https://docs.noodl.net/nodes/utilities/logic/states\",\r\n  shortDesc:\r\n    \"Define states with values and this node can interpolate between these values when the state is changed.\",\r\n  category: \"Animation\",\r\n  initialize() {\r\n    const _this = this;\r\n    const _internal = this._internal;\r\n\r\n    _internal.useTransitions = true;\r\n    _internal.currentValues = {};\r\n    _internal.stateParameters = {};\r\n    _internal.stateParameterTypes = {};\r\n    _internal.startValues = {};\r\n    _internal.bezierEaseCurves = {};\r\n    _internal.transitionFuncs = {};\r\n\r\n    _internal.valuesAreInitialised = false;\r\n    _internal.animation = this.context.timerScheduler.createTimer({\r\n      duration: defaultDuration,\r\n      ease: EaseCurves.easeOut,\r\n      onStart() {\r\n        const startValues = _internal.startValues;\r\n        const stateValues = _internal.stateParameters;\r\n        const valueTypes = _internal.stateParameterTypes;\r\n        const prefix = \"value-\" + _internal.state + \"-\";\r\n\r\n        this.targetValues = {};\r\n        this.startValues = {};\r\n        this.valueTypes = {};\r\n\r\n        for (const v in this.transitionCurves) {\r\n          if (\r\n            valueTypes[\"type-\" + v] === \"number\" ||\r\n            valueTypes[\"type-\" + v] === undefined\r\n          ) {\r\n            this.valueTypes[v] = \"number\";\r\n            this.startValues[v] = startValues[v];\r\n            this.targetValues[v] = stateValues[prefix + v] || 0;\r\n          } else if (valueTypes[\"type-\" + v] === \"color\") {\r\n            this.valueTypes[v] = \"color\";\r\n\r\n            this.startValues[v] = [0, 0, 0, 255];\r\n            setRGBA(\r\n              this.startValues[v],\r\n              _this.context.styles?.resolveColor(startValues[v] || \"#000000\")\r\n            );\r\n\r\n            this.targetValues[v] = [0, 0, 0, 255];\r\n            setRGBA(\r\n              this.targetValues[v],\r\n              _this.context.styles?.resolveColor(\r\n                stateValues[prefix + v] || \"#000000\"\r\n              )\r\n            );\r\n          }\r\n        }\r\n      },\r\n      onRunning(t) {\r\n        const ms = t * this.duration!;\r\n        const currentValues = _internal.currentValues;\r\n\r\n        const rgba2 = [0, 0, 0, 255];\r\n        for (const v in this.transitionCurves) {\r\n          const c = this.transitionCurves[v];\r\n\r\n          if (ms < c.delay) currentValues[v] = this.startValues[v];\r\n          else if (ms >= c.delay + c.dur)\r\n            currentValues[v] =\r\n              this.valueTypes[v] === \"color\"\r\n                ? rgbaToHex(this.targetValues[v])\r\n                : this.targetValues[v];\r\n          else {\r\n            const _t = _internal.transitionFuncs[v].get((ms - c.delay) / c.dur);\r\n            if (this.valueTypes[v] === \"number\") {\r\n              currentValues[v] = EaseCurves.linear(\r\n                Number(this.startValues[v]),\r\n                Number(this.targetValues[v]),\r\n                _t\r\n              );\r\n            } else if (this.valueTypes[v] === \"color\") {\r\n              const rgba0 = this.startValues[v];\r\n              const rgba1 = this.targetValues[v];\r\n              rgba2[0] = Math.floor(EaseCurves.linear(rgba0[0], rgba1[0], _t));\r\n              rgba2[1] = Math.floor(EaseCurves.linear(rgba0[1], rgba1[1], _t));\r\n              rgba2[2] = Math.floor(EaseCurves.linear(rgba0[2], rgba1[2], _t));\r\n              rgba2[3] = Math.floor(EaseCurves.linear(rgba0[3], rgba1[3], _t));\r\n\r\n              currentValues[v] = rgbaToHex(rgba2);\r\n            }\r\n          }\r\n          _this.flagOutputDirty(v);\r\n        }\r\n      },\r\n      onFinish() {\r\n        const port = \"reached-\" + _internal.state;\r\n        if (_this.hasOutput(port)) _this.sendSignalOnOutput(port);\r\n      },\r\n    });\r\n  },\r\n  getInspectInfo() {\r\n    return `Current state: ${this._internal.state}`;\r\n  },\r\n  inputs: {\r\n    states: {\r\n      type: { name: \"stringlist\", allowEditOnly: true },\r\n      displayName: \"States\",\r\n      group: \"States\",\r\n      set(value: string) {\r\n        this._internal.states = value ? value.split(\",\") : [];\r\n\r\n        if (this._internal.states.length > 0) {\r\n          const _this = this;\r\n          if (!_this._internal.state)\r\n            // @ts-expect-error\r\n            this.scheduleGoToState(\r\n              // @ts-expect-error\r\n              _this._internal.startState || _this._internal.states[0]\r\n            );\r\n        }\r\n      },\r\n    },\r\n    values: {\r\n      type: { name: \"stringlist\", allowEditOnly: true },\r\n      displayName: \"Values\",\r\n      group: \"Values\",\r\n      set(value: string) {\r\n        const internal = this._internal;\r\n        internal.values = value.split(\",\");\r\n\r\n        for (const i in internal.values) {\r\n          // @ts-expect-error\r\n          this.registerOutputIfNeeded(internal.values[i]);\r\n        }\r\n      },\r\n    },\r\n    toggle: {\r\n      group: \"Go to state\",\r\n      displayName: \"Toggle\",\r\n      valueChangedToTrue() {\r\n        const internal = this._internal;\r\n        const _this = this;\r\n\r\n        if (!internal.states) return;\r\n\r\n        // @ts-expect-error\r\n        const idx = internal.states.indexOf(internal.state);\r\n        const nextIdx = (idx + 1) % internal.states.length;\r\n\r\n        // @ts-expect-error\r\n        this.scheduleGoToState(internal.states[nextIdx]);\r\n      },\r\n    },\r\n    useTransitions: {\r\n      type: \"boolean\",\r\n      displayName: \"Use Transitions\",\r\n      group: \"General\",\r\n      default: true,\r\n      set(value: boolean) {\r\n        const internal = this._internal;\r\n        internal.useTransitions = value;\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    currentState: {\r\n      type: \"string\",\r\n      displayName: \"State\",\r\n      group: \"Current State\",\r\n      getter() {\r\n        return this._internal.state;\r\n      },\r\n    },\r\n    stateChanged: {\r\n      type: \"signal\",\r\n      displayName: \"State Changed\",\r\n      group: \"Current State\",\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    registerOutputIfNeeded(name: string) {\r\n      const internal = this._internal;\r\n\r\n      if (this.hasOutput(name)) return;\r\n\r\n      this.registerOutput(name, {\r\n        getter() {\r\n          return internal.currentValues[name];\r\n        },\r\n      });\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      const _this = this;\r\n      const internal = this._internal;\r\n\r\n      if (this.hasInput(name)) return;\r\n\r\n      if (name.indexOf(\"to-\") === 0) {\r\n        const state = name.substring(3);\r\n        this.registerInput(name, {\r\n          set: createSetter({\r\n            valueChangedToTrue() {\r\n              // @ts-expect-error\r\n              this.scheduleGoToState(state);\r\n            },\r\n          }),\r\n        });\r\n      } else if (name === \"startState\") {\r\n        this.registerInput(name, {\r\n          set(value: string) {\r\n            this._internal.startState = value;\r\n            // @ts-expect-error\r\n            this.scheduleGoToState(value);\r\n          },\r\n        });\r\n      } else if (name === \"currentState\") {\r\n        this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.scheduleGoToState.bind(this),\r\n        });\r\n      } else if (name.indexOf(\"type-\") === 0) {\r\n        this.registerInput(name, {\r\n          set(value: string) {\r\n            internal.stateParameterTypes[name] = value;\r\n          },\r\n        });\r\n      } else if (name.indexOf(\"value-\") === 0) {\r\n        const parts = name.split(\"-\");\r\n        const state = parts[1];\r\n        const valueName = parts[2];\r\n\r\n        this.registerInput(name, {\r\n          set(value: any) {\r\n            internal.stateParameters[name] = value;\r\n            if (internal.state === state) {\r\n              internal.currentValues[valueName] = value;\r\n              _this.flagOutputDirty(valueName);\r\n            }\r\n          },\r\n        });\r\n      } else if (name.search(/duration-/g) === 0) {\r\n        this.registerInput(name, {\r\n          set(value: any) {\r\n            internal.stateParameters[name] = value;\r\n          },\r\n        });\r\n      } else if (name.search(/transition/g) === 0) {\r\n        const state = name.substring(11);\r\n        this.registerInput(name, {\r\n          set(value: any) {\r\n            internal.stateParameters[name] = value;\r\n          },\r\n        });\r\n      }\r\n    },\r\n    setCurrentState(value: string) {\r\n      // @ts-expect-error\r\n      this.scheduleGoToState(value);\r\n    },\r\n    jumpToState(state: string) {\r\n      const internal = this._internal;\r\n      if (!internal.states) return;\r\n      if (!state) state = internal.states[0];\r\n      if (internal.state === state) return;\r\n\r\n      internal.animation.stop();\r\n\r\n      const prefix = \"value-\" + state + \"-\";\r\n      for (const i in internal.values) {\r\n        const v = internal.values[i];\r\n\r\n        internal.currentValues[v] = internal.stateParameters[prefix + v] || 0;\r\n\r\n        this.flagOutputDirty(v);\r\n      }\r\n\r\n      internal.state = state;\r\n      this.flagOutputDirty(\"currentState\");\r\n\r\n      if (internal.valuesAreInitialised) {\r\n        this.sendSignalOnOutput(\"stateChanged\");\r\n      }\r\n      internal.valuesAreInitialised = true;\r\n\r\n      // @ts-expect-error\r\n      this.updateAtStatePorts();\r\n    },\r\n    scheduleGoToState(state: string) {\r\n      const _this = this;\r\n\r\n      this._internal.goToState = state;\r\n\r\n      // @ts-expect-error\r\n      if (this.hasScheduledGoToState) return;\r\n      // @ts-expect-error\r\n      this.hasScheduledGoToState = true;\r\n      this.scheduleAfterInputsHaveUpdated(function () {\r\n        // @ts-expect-error\r\n        _this.hasScheduledGoToState = false;\r\n        // @ts-expect-error\r\n        _this.goToState(_this._internal.goToState);\r\n      });\r\n    },\r\n    goToState(state: string) {\r\n      const internal = this._internal;\r\n      if (!internal.states) return;\r\n      if (!state) state = internal.states[0];\r\n      if (internal.state === state) return;\r\n\r\n      if (!internal.valuesAreInitialised) {\r\n        // @ts-expect-error\r\n        this.jumpToState(state);\r\n      } else {\r\n        let delay = 0;\r\n        let dur = 0;\r\n        const transitionCurves: Record<string, any> = {};\r\n        for (const i in internal.values) {\r\n          const v = internal.values[i];\r\n\r\n          internal.startValues[v] = internal.currentValues[v];\r\n\r\n          const parameterType = internal.stateParameterTypes[\"type-\" + v];\r\n          if (parameterType === \"boolean\") {\r\n            const _b = internal.stateParameters[\"value-\" + state + \"-\" + v];\r\n            internal.currentValues[v] = _b === undefined ? false : !!_b;\r\n            this.flagOutputDirty(v);\r\n          } else if (\r\n            parameterType === \"string\" ||\r\n            parameterType === \"textStyle\"\r\n          ) {\r\n            internal.currentValues[v] =\r\n              internal.stateParameters[\"value-\" + state + \"-\" + v];\r\n            this.flagOutputDirty(v);\r\n          } else {\r\n            let transitionCurve =\r\n              internal.stateParameters[\"transition-\" + state + \"-\" + v];\r\n            if (!transitionCurve)\r\n              transitionCurve = internal.stateParameters[\r\n                \"transitiondef-\" + state\r\n              ] || {\r\n                curve: [0.0, 0.0, 0.58, 1.0],\r\n                dur: 300,\r\n                delay: 0,\r\n              };\r\n\r\n            if (\r\n              (transitionCurve.dur === 0 && transitionCurve.delay === 0) ||\r\n              !internal.useTransitions\r\n            ) {\r\n              internal.currentValues[v] =\r\n                internal.stateParameters[\"value-\" + state + \"-\" + v];\r\n              this.flagOutputDirty(v);\r\n            } else {\r\n              internal.transitionFuncs[v] = BezierEasing(transitionCurve.curve);\r\n              transitionCurves[v] = transitionCurve;\r\n              delay = Math.min(delay, transitionCurve.delay);\r\n              dur = Math.max(dur, transitionCurve.dur + transitionCurve.delay);\r\n            }\r\n          }\r\n        }\r\n\r\n        if (dur > 0 || delay > 0) {\r\n          internal.animation.transitionCurves = transitionCurves;\r\n          internal.animation.duration = dur;\r\n          internal.animation.delay = delay;\r\n          internal.animation.start();\r\n        }\r\n\r\n        internal.state = state;\r\n        this.flagOutputDirty(\"currentState\");\r\n\r\n        this.sendSignalOnOutput(\"stateChanged\");\r\n        // @ts-expect-error\r\n        this.updateAtStatePorts();\r\n\r\n        if (dur === 0 && delay === 0) {\r\n          const port = \"reached-\" + internal.state;\r\n          if (this.hasOutput(port)) this.sendSignalOnOutput(port);\r\n        }\r\n      }\r\n    },\r\n    updateAtStatePorts() {\r\n      const internal = this._internal;\r\n      const states = internal.states;\r\n      for (const i in states) {\r\n        const s = states[i];\r\n        const port = \"at-\" + s;\r\n\r\n        internal.currentValues[port] = internal.state === s;\r\n        if (this.hasOutput(port)) this.flagOutputDirty(port);\r\n      }\r\n    },\r\n  },\r\n};\r\n\r\nfunction detectRename(\r\n  before: string[],\r\n  after: string[]\r\n): { before?: string; after?: string } | undefined {\r\n  if (!before || !after) return;\r\n\r\n  if (before.length !== after.length) return;\r\n\r\n  const res: { before?: string; after?: string } = {};\r\n  for (let i = 0; i < before.length; i++) {\r\n    if (after.indexOf(before[i]) === -1) {\r\n      if (res.before) return;\r\n      res.before = before[i];\r\n    }\r\n\r\n    if (before.indexOf(after[i]) === -1) {\r\n      if (res.after) return;\r\n      res.after = after[i];\r\n    }\r\n  }\r\n\r\n  return res.before && res.after ? res : undefined;\r\n}\r\n\r\nfunction updatePorts(nodeId: string, parameters: any, editorConnection: any) {\r\n  const states = parameters.states;\r\n  const values = parameters.values;\r\n\r\n  const ports: any[] = [];\r\n\r\n  const valueArray = values ? values.split(\",\") : undefined;\r\n  for (const p of valueArray || []) {\r\n    ports.push({\r\n      type: {\r\n        name: parameters[\"type-\" + p] || \"number\",\r\n        allowConnectionsOnly: true,\r\n      },\r\n      plug: \"output\",\r\n      group: \"Values\",\r\n      name: p,\r\n    });\r\n\r\n    ports.push({\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"Number\", value: \"number\" },\r\n          { label: \"String\", value: \"string\" },\r\n          { label: \"Boolean\", value: \"boolean\" },\r\n          { label: \"Color\", value: \"color\" },\r\n          { label: \"Text Style\", value: \"textStyle\" },\r\n        ],\r\n        allowEditOnly: true,\r\n      },\r\n      default: \"number\",\r\n      plug: \"input\",\r\n      group: \"Types\",\r\n      displayName: p,\r\n      name: \"type-\" + p,\r\n    });\r\n  }\r\n\r\n  const stateArray = states ? states.split(\",\") : undefined;\r\n  stateArray &&\r\n    stateArray.forEach((state) => {\r\n      valueArray &&\r\n        valueArray.forEach((value) => {\r\n          ports.push({\r\n            plug: \"input\",\r\n            type: parameters[\"type-\" + value] || \"number\",\r\n            group: state + \" Values\",\r\n            name: \"value-\" + state + \"-\" + value,\r\n            displayName: value,\r\n            editorName: state + \"|\" + value,\r\n          });\r\n        });\r\n\r\n      if (valueArray && parameters[\"useTransitions\"] !== false) {\r\n        ports.push({\r\n          plug: \"input\",\r\n          type: \"curve\",\r\n          displayName: \"Default\",\r\n          default: { curve: [0.0, 0.0, 0.58, 1.0], dur: 300, delay: 0 },\r\n          group: state + \" Transitions\",\r\n          name: \"transitiondef-\" + state,\r\n        });\r\n\r\n        valueArray.forEach((value) => {\r\n          if (\r\n            parameters[\"type-\" + value] === undefined ||\r\n            parameters[\"type-\" + value] === \"number\" ||\r\n            parameters[\"type-\" + value] === \"color\"\r\n          ) {\r\n            ports.push({\r\n              plug: \"input\",\r\n              type: { name: \"curve\" },\r\n              default: parameters[\"transitiondef-\" + state] || {\r\n                curve: [0.0, 0.0, 0.58, 1.0],\r\n                dur: 300,\r\n                delay: 0,\r\n              },\r\n              group: state + \" Transitions\",\r\n              name: \"transition-\" + state + \"-\" + value,\r\n              displayName: value,\r\n              editorName: \"Transition \" + state + \"|\" + value,\r\n            });\r\n          }\r\n        });\r\n      }\r\n\r\n      ports.push({\r\n        plug: \"input\",\r\n        type: { name: \"signal\", allowConnectionsOnly: true },\r\n        displayName: \"To \" + state,\r\n        name: \"to-\" + state,\r\n        group: \"Go to state\",\r\n      });\r\n\r\n      ports.push({\r\n        plug: \"output\",\r\n        type: \"boolean\",\r\n        displayName: \"At \" + state,\r\n        name: \"at-\" + state,\r\n        group: \"Current state\",\r\n      });\r\n\r\n      ports.push({\r\n        plug: \"output\",\r\n        type: \"signal\",\r\n        displayName: \"Has Reached \" + state,\r\n        name: \"reached-\" + state,\r\n        group: \"Current state\",\r\n      });\r\n    });\r\n\r\n  if (states) {\r\n    ports.push({\r\n      plug: \"input\",\r\n      type: { name: \"enum\", enums: states },\r\n      group: \"States\",\r\n      displayName: \"State\",\r\n      name: \"currentState\",\r\n      default: parameters[\"startState\"] || states[0],\r\n    });\r\n  }\r\n\r\n  const stateRenamed = detectRename(previousStates[nodeId], states);\r\n  previousStates[nodeId] = states;\r\n\r\n  const valueRenamed = detectRename(previousValues[nodeId], values);\r\n  previousValues[nodeId] = values;\r\n\r\n  let renamed;\r\n  if (stateRenamed) {\r\n    renamed = {\r\n      plug: \"input\",\r\n      before: stateRenamed.before,\r\n      after: stateRenamed.after,\r\n      patterns: [\"transition-{{*}}\", \"to-{{*}}\", \"at-{{*}}\", \"reached-{{*}}\"],\r\n    };\r\n\r\n    valueArray &&\r\n      valueArray.forEach((value) => {\r\n        renamed.patterns.push(\"value-{{*}}-\" + value);\r\n      });\r\n  } else if (valueRenamed) {\r\n    renamed = [\r\n      {\r\n        plug: \"output\",\r\n        before: valueRenamed.before,\r\n        after: valueRenamed.after,\r\n        patterns: [\"{{*}}\"],\r\n      },\r\n      {\r\n        plug: \"input\",\r\n        before: valueRenamed.before,\r\n        after: valueRenamed.after,\r\n        patterns: [\"type-{{*}}\"],\r\n      },\r\n      {\r\n        plug: \"input\",\r\n        before: valueRenamed.before,\r\n        after: valueRenamed.after,\r\n        patterns: states\r\n          ? states.map((s) => {\r\n              return \"value-\" + s + \"-\" + \"{{*}}\";\r\n            })\r\n          : undefined,\r\n      },\r\n    ];\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports, { renamed: renamed });\r\n}\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  graphModel.on(\"nodeAdded.States\", function (node: any) {\r\n    if (node.parameters.states) {\r\n      updatePorts(node.id, node.parameters, context.editorConnection);\r\n    }\r\n    node.on(\"parameterUpdated\", function (event: any) {\r\n      if (\r\n        event.name === \"useTransitions\" ||\r\n        event.name === \"states\" ||\r\n        event.name === \"values\" ||\r\n        event.name.startsWith(\"transition\") ||\r\n        event.name.startsWith(\"type-\")\r\n      ) {\r\n        updatePorts(node.id, node.parameters, context.editorConnection);\r\n      }\r\n    });\r\n  });\r\n}\r\n","import { NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  state: boolean;\r\n  initialized: boolean;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Switch\",\r\n  docs: \"https://docs.noodl.net/nodes/logic/switch\",\r\n  category: \"Logic\",\r\n  initialize() {\r\n    this._internal.state = false;\r\n    this._internal.initialized = false;\r\n  },\r\n  getInspectInfo() {\r\n    return this._internal.state;\r\n  },\r\n  inputs: {\r\n    on: {\r\n      displayName: \"On\",\r\n      group: \"Change State\",\r\n      valueChangedToTrue() {\r\n        if (this._internal.state === true) {\r\n          return;\r\n        }\r\n        this._internal.state = true;\r\n        this.flagOutputDirty(\"state\");\r\n        // @ts-expect-error\r\n        this.emitSignals();\r\n      },\r\n    },\r\n    off: {\r\n      displayName: \"Off\",\r\n      group: \"Change State\",\r\n      valueChangedToTrue() {\r\n        if (this._internal.state === false) {\r\n          return;\r\n        }\r\n        this._internal.state = false;\r\n        this.flagOutputDirty(\"state\");\r\n        // @ts-expect-error\r\n        this.emitSignals();\r\n      },\r\n    },\r\n    flip: {\r\n      displayName: \"Flip\",\r\n      group: \"Change State\",\r\n      valueChangedToTrue() {\r\n        this._internal.state = !this._internal.state;\r\n        this.flagOutputDirty(\"state\");\r\n        // @ts-expect-error\r\n        this.emitSignals();\r\n      },\r\n    },\r\n    onFromStart: {\r\n      type: \"boolean\",\r\n      displayName: \"State\",\r\n      group: \"General\",\r\n      default: false,\r\n      set(value) {\r\n        this._internal.state = !!value;\r\n        this.flagOutputDirty(\"state\");\r\n        // @ts-expect-error\r\n        this.emitSignals();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    state: {\r\n      type: \"boolean\",\r\n      displayName: \"Current State\",\r\n      getter() {\r\n        return this._internal.state;\r\n      },\r\n    },\r\n    switched: {\r\n      displayName: \"Switched\",\r\n      type: \"signal\",\r\n      group: \"Signals\",\r\n    },\r\n    switchedToOn: {\r\n      displayName: \"Switched To On\",\r\n      type: \"signal\",\r\n      group: \"Signals\",\r\n    },\r\n    switchedToOff: {\r\n      displayName: \"Switched To Off\",\r\n      type: \"signal\",\r\n      group: \"Signals\",\r\n    },\r\n  },\r\n  prototypeExtensions: {\r\n    emitSignals() {\r\n      if (this._internal.state === true) {\r\n        this.sendSignalOnOutput(\"switchedToOn\");\r\n      } else {\r\n        this.sendSignalOnOutput(\"switchedToOff\");\r\n      }\r\n      this.sendSignalOnOutput(\"switched\");\r\n    },\r\n  },\r\n};\r\n","import { NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  _animation: any;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Timer\",\r\n  docs: \"https://docs.noodl.net/nodes/utilities/delay\",\r\n  displayName: \"Delay\",\r\n  category: \"Utilities\",\r\n  nodeDoubleClickAction: {\r\n    focusPort: \"duration\",\r\n  },\r\n  initialize() {\r\n    const self = this;\r\n    this._internal._animation = this.context.timerScheduler.createTimer({\r\n      duration: 0,\r\n      onStart() {\r\n        self.sendSignalOnOutput(\"timerStarted\");\r\n      },\r\n      onFinish() {\r\n        self.sendSignalOnOutput(\"timerFinished\");\r\n      },\r\n    });\r\n\r\n    this.addDeleteListener(() => {\r\n      this._internal._animation.stop();\r\n    });\r\n  },\r\n  getInspectInfo() {\r\n    if (this._internal._animation.isRunning()) {\r\n      return (\r\n        Math.floor(this._internal._animation.durationLeft() / 10) / 100 +\r\n        \" seconds\"\r\n      );\r\n    }\r\n    return \"Not running\";\r\n  },\r\n  inputs: {\r\n    start: {\r\n      displayName: \"Start\",\r\n      valueChangedToTrue() {\r\n        if (this._internal._animation._isRunning === false) {\r\n          this._internal._animation.start();\r\n        }\r\n      },\r\n    },\r\n    restart: {\r\n      displayName: \"Restart\",\r\n      valueChangedToTrue() {\r\n        this._internal._animation.start();\r\n      },\r\n    },\r\n    duration: {\r\n      type: \"number\",\r\n      displayName: \"Duration\",\r\n      default: 0,\r\n      set(value) {\r\n        this._internal._animation.duration = value;\r\n      },\r\n    },\r\n    startDelay: {\r\n      type: \"number\",\r\n      displayName: \"Start Delay\",\r\n      default: 0,\r\n      set(value) {\r\n        this._internal._animation.delay = value;\r\n      },\r\n    },\r\n    stop: {\r\n      displayName: \"Stop\",\r\n      valueChangedToTrue() {\r\n        this._internal._animation.stop();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    timerStarted: {\r\n      type: \"signal\",\r\n      displayName: \"Started\",\r\n    },\r\n    timerFinished: {\r\n      type: \"signal\",\r\n      displayName: \"Finished\",\r\n    },\r\n  },\r\n};\r\n","import { NodeDefinition } from \"@fluxscape/runtime\";\r\nimport { CloudFile } from \"@fluxscape/runtime/src/api/cloudfile\";\r\nimport { CloudStore } from \"@fluxscape/runtime/src/api/cloudstore\";\r\n\r\ninterface Internal {\r\n  file: any;\r\n  cloudFile: CloudFile | null;\r\n  error: string | null;\r\n  errorStatus: number;\r\n  progressTotal: number;\r\n  progressLoaded: number;\r\n  response: any;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Upload File\",\r\n  docs: \"https://docs.noodl.net/nodes/data/cloud-data/upload-file\",\r\n  category: \"Cloud Services\",\r\n  color: \"data\",\r\n  getInspectInfo() {\r\n    return this._internal.response;\r\n  },\r\n  inputs: {\r\n    file: {\r\n      group: \"General\",\r\n      displayName: \"File\",\r\n      type: \"*\",\r\n      set(file: any) {\r\n        this._internal.file = file;\r\n      },\r\n    },\r\n    upload: {\r\n      type: \"signal\",\r\n      displayName: \"Upload\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          const file = this._internal.file;\r\n\r\n          if (!file) {\r\n            // @ts-expect-error\r\n            this.setError(\"No file specified\");\r\n            return;\r\n          }\r\n\r\n          // @ts-expect-error\r\n          CloudStore.instance.uploadFile({\r\n            file,\r\n            onUploadProgress: (p: { total: number; loaded: number }) => {\r\n              this._internal.progressTotal = p.total;\r\n              this._internal.progressLoaded = p.loaded;\r\n\r\n              this.flagOutputDirty(\"progressTotalBytes\");\r\n              this.flagOutputDirty(\"progressLoadedBytes\");\r\n              this.flagOutputDirty(\"progressLoadedPercent\");\r\n              this.sendSignalOnOutput(\"progressChanged\");\r\n            },\r\n            success: (response: any) => {\r\n              this._internal.cloudFile = new CloudFile(response);\r\n              this.flagOutputDirty(\"cloudFile\");\r\n              this.sendSignalOnOutput(\"success\");\r\n            },\r\n            // @ts-expect-error\r\n            error: (e: any) => this.setError(e),\r\n          });\r\n        });\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    cloudFile: {\r\n      group: \"General\",\r\n      displayName: \"Cloud File\",\r\n      type: \"cloudfile\",\r\n      get() {\r\n        return this._internal.cloudFile;\r\n      },\r\n    },\r\n    success: {\r\n      group: \"Events\",\r\n      displayName: \"Success\",\r\n      type: \"signal\",\r\n    },\r\n    failure: {\r\n      group: \"Events\",\r\n      displayName: \"Failure\",\r\n      type: \"signal\",\r\n    },\r\n    error: {\r\n      type: \"string\",\r\n      displayName: \"Error\",\r\n      group: \"Error\",\r\n      get() {\r\n        return this._internal.error;\r\n      },\r\n    },\r\n    errorStatus: {\r\n      type: \"number\",\r\n      displayName: \"Error Status Code\",\r\n      group: \"Error\",\r\n      get() {\r\n        return this._internal.errorStatus;\r\n      },\r\n    },\r\n    progressChanged: {\r\n      type: \"signal\",\r\n      displayName: \"Progress Changed\",\r\n      group: \"Events\",\r\n    },\r\n    progressTotalBytes: {\r\n      type: \"number\",\r\n      displayName: \"Total Bytes\",\r\n      group: \"Progress\",\r\n      get() {\r\n        return this._internal.progressTotal;\r\n      },\r\n    },\r\n    progressLoadedBytes: {\r\n      type: \"number\",\r\n      displayName: \"Uploaded Bytes\",\r\n      group: \"Progress\",\r\n      get() {\r\n        return this._internal.progressLoaded;\r\n      },\r\n    },\r\n    progressLoadedPercent: {\r\n      type: \"number\",\r\n      displayName: \"Uploaded Percent\",\r\n      group: \"Progress\",\r\n      get() {\r\n        if (!this._internal.progressTotal) return 0;\r\n        return (\r\n          (this._internal.progressLoaded / this._internal.progressTotal) * 100\r\n        );\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    setError(err: any) {\r\n      this._internal.error = err.hasOwnProperty(\"error\") ? err.error : err;\r\n      this._internal.errorStatus = err.code || err.status || 0;\r\n      this.flagOutputDirty(\"error\");\r\n      this.flagOutputDirty(\"errorStatus\");\r\n      this.sendSignalOnOutput(\"failure\");\r\n    },\r\n  },\r\n};\r\n","import UserService from \"./userservice\";\r\nimport { NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  username: string;\r\n  password: string;\r\n  error: string;\r\n  logInScheduled: boolean;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"net.noodl.user.LogIn\",\r\n  docs: \"https://docs.noodl.net/nodes/data/user/log-in\",\r\n  displayNodeName: \"Log In\",\r\n  category: \"Cloud Services\",\r\n  color: \"data\",\r\n  outputs: {\r\n    success: {\r\n      type: \"signal\",\r\n      displayName: \"Success\",\r\n      group: \"Events\",\r\n    },\r\n    failure: {\r\n      type: \"signal\",\r\n      displayName: \"Failure\",\r\n      group: \"Events\",\r\n    },\r\n    error: {\r\n      type: \"string\",\r\n      displayName: \"Error\",\r\n      group: \"Error\",\r\n      getter() {\r\n        return this._internal.error;\r\n      },\r\n    },\r\n  },\r\n  inputs: {\r\n    login: {\r\n      displayName: \"Do\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleLogIn();\r\n      },\r\n    },\r\n    username: {\r\n      displayName: \"Username\",\r\n      type: \"string\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        this._internal.username = value;\r\n      },\r\n    },\r\n    password: {\r\n      displayName: \"Password\",\r\n      type: \"string\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        this._internal.password = value;\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    setError(err: string) {\r\n      this._internal.error = err;\r\n      this.flagOutputDirty(\"error\");\r\n      this.sendSignalOnOutput(\"failure\");\r\n\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.sendWarning(\r\n          // @ts-expect-error\r\n          this.nodeScope.componentOwner.name,\r\n          this.id,\r\n          \"user-login-warning\",\r\n          {\r\n            message: err,\r\n            showGlobally: true,\r\n          }\r\n        );\r\n      }\r\n    },\r\n    clearWarnings() {\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.clearWarning(\r\n          // @ts-expect-error\r\n          this.nodeScope.componentOwner.name,\r\n          this.id,\r\n          \"user-login-warning\"\r\n        );\r\n      }\r\n    },\r\n    scheduleLogIn() {\r\n      // @ts-expect-error\r\n      if (this.logInScheduled === true) return;\r\n      // @ts-expect-error\r\n      this.logInScheduled = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.logInScheduled = false;\r\n\r\n        UserService.instance.logIn({\r\n          username: this._internal.username,\r\n          password: this._internal.password,\r\n          success: () => {\r\n            this.sendSignalOnOutput(\"success\");\r\n          },\r\n          error: (e: string) => {\r\n            // @ts-expect-error\r\n            this.setError(e);\r\n          },\r\n        });\r\n      });\r\n    },\r\n  },\r\n};\r\n","import { NodeDefinition } from \"@fluxscape/runtime\";\r\nimport UserService from \"./userservice\";\r\n\r\ninterface Internal {\r\n  error: string;\r\n  logOutScheduled: boolean;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"net.noodl.user.LogOut\",\r\n  docs: \"https://docs.noodl.net/nodes/data/user/log-out\",\r\n  displayNodeName: \"Log Out\",\r\n  category: \"Cloud Services\",\r\n  color: \"data\",\r\n  outputs: {\r\n    success: {\r\n      type: \"signal\",\r\n      displayName: \"Success\",\r\n      group: \"Events\",\r\n    },\r\n    failure: {\r\n      type: \"signal\",\r\n      displayName: \"Failure\",\r\n      group: \"Events\",\r\n    },\r\n    error: {\r\n      type: \"string\",\r\n      displayName: \"Error\",\r\n      group: \"Error\",\r\n      getter() {\r\n        return this._internal.error;\r\n      },\r\n    },\r\n  },\r\n  inputs: {\r\n    login: {\r\n      displayName: \"Do\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleLogOut();\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    setError(err: string) {\r\n      this._internal.error = err;\r\n      this.flagOutputDirty(\"error\");\r\n      this.sendSignalOnOutput(\"failure\");\r\n\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.sendWarning(\r\n          // @ts-expect-error\r\n          this.nodeScope.componentOwner.name,\r\n          this.id,\r\n          \"user-login-warning\",\r\n          {\r\n            message: err,\r\n            showGlobally: true,\r\n          }\r\n        );\r\n      }\r\n    },\r\n    clearWarnings() {\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.clearWarning(\r\n          // @ts-expect-error\r\n          this.nodeScope.componentOwner.name,\r\n          this.id,\r\n          \"user-login-warning\"\r\n        );\r\n      }\r\n    },\r\n    scheduleLogOut() {\r\n      // @ts-expect-error\r\n      if (this.logOutScheduled === true) return;\r\n      // @ts-expect-error\r\n      this.logOutScheduled = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.logOutScheduled = false;\r\n\r\n        UserService.instance.logOut({\r\n          success: () => {\r\n            this.sendSignalOnOutput(\"success\");\r\n          },\r\n          error: (e: string) => {\r\n            // @ts-expect-error\r\n            this.setError(e);\r\n          },\r\n        });\r\n      });\r\n    },\r\n  },\r\n};\r\n","import UserService from \"./userservice\";\r\nimport { GraphModel, NodeContext, NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  userProperties: Record<string, any>;\r\n  username: string;\r\n  password: string;\r\n  email: string;\r\n  error: string;\r\n  signUpScheduled: boolean;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"net.noodl.user.SignUp\",\r\n  docs: \"https://docs.noodl.net/nodes/data/user/sign-up\",\r\n  displayNodeName: \"Sign Up\",\r\n  category: \"Cloud Services\",\r\n  color: \"data\",\r\n  initialize() {\r\n    const internal = this._internal;\r\n    internal.userProperties = {};\r\n    internal.signUpScheduled = false;\r\n  },\r\n  outputs: {\r\n    success: {\r\n      type: \"signal\",\r\n      displayName: \"Success\",\r\n      group: \"Events\",\r\n    },\r\n    failure: {\r\n      type: \"signal\",\r\n      displayName: \"Failure\",\r\n      group: \"Events\",\r\n    },\r\n    error: {\r\n      type: \"string\",\r\n      displayName: \"Error\",\r\n      group: \"Error\",\r\n      getter() {\r\n        return this._internal.error;\r\n      },\r\n    },\r\n  },\r\n  inputs: {\r\n    signup: {\r\n      displayName: \"Do\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleSignUp();\r\n      },\r\n    },\r\n    username: {\r\n      displayName: \"Username\",\r\n      type: \"string\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        this._internal.username = value;\r\n      },\r\n    },\r\n    password: {\r\n      displayName: \"Password\",\r\n      type: \"string\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        this._internal.password = value;\r\n      },\r\n    },\r\n    email: {\r\n      displayName: \"Email\",\r\n      type: \"string\",\r\n      group: \"General\",\r\n      set(value: string) {\r\n        this._internal.email = value;\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    setError(err: string) {\r\n      this._internal.error = err;\r\n      this.flagOutputDirty(\"error\");\r\n      this.sendSignalOnOutput(\"failure\");\r\n\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.sendWarning(\r\n          // @ts-expect-error\r\n          this.nodeScope.componentOwner.name,\r\n          this.id,\r\n          \"user-login-warning\",\r\n          {\r\n            message: err,\r\n            showGlobally: true,\r\n          }\r\n        );\r\n      }\r\n    },\r\n    clearWarnings() {\r\n      if (this.context.editorConnection) {\r\n        this.context.editorConnection.clearWarning(\r\n          // @ts-expect-error\r\n          this.nodeScope.componentOwner.name,\r\n          this.id,\r\n          \"user-login-warning\"\r\n        );\r\n      }\r\n    },\r\n    scheduleSignUp() {\r\n      const internal = this._internal;\r\n\r\n      // @ts-expect-error\r\n      if (this.signUpScheduled === true) return;\r\n      // @ts-expect-error\r\n      this.signUpScheduled = true;\r\n\r\n      this.scheduleAfterInputsHaveUpdated(() => {\r\n        // @ts-expect-error\r\n        this.signUpScheduled = false;\r\n\r\n        UserService.instance.signUp({\r\n          username: this._internal.username,\r\n          password: this._internal.password,\r\n          email: this._internal.email,\r\n          properties: internal.userProperties,\r\n          success: () => {\r\n            this.sendSignalOnOutput(\"success\");\r\n          },\r\n          error: (e: string) => {\r\n            // @ts-expect-error\r\n            this.setError(e);\r\n          },\r\n        });\r\n      });\r\n    },\r\n    setUserProperty(name: string, value: any) {\r\n      this._internal.userProperties[name] = value;\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"prop-\")) {\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setUserProperty.bind(this, name.substring(\"prop-\".length)),\r\n        });\r\n      }\r\n    },\r\n  },\r\n};\r\n\r\nfunction updatePorts(\r\n  nodeId: string,\r\n  _parameters: any,\r\n  editorConnection: any,\r\n  systemCollections: any\r\n) {\r\n  const ports: any[] = [];\r\n\r\n  if (systemCollections) {\r\n    // Fetch ports from collection keys\r\n    const c = systemCollections.find((c: any) => c.name === \"_User\");\r\n    if (c && c.schema && c.schema.properties) {\r\n      const props = c.schema.properties;\r\n      const _ignoreKeys = [\r\n        \"authData\",\r\n        \"password\",\r\n        \"username\",\r\n        \"createdAt\",\r\n        \"updatedAt\",\r\n        \"emailVerified\",\r\n        \"email\",\r\n      ];\r\n      for (const key in props) {\r\n        if (_ignoreKeys.indexOf(key) !== -1) continue;\r\n\r\n        const p = props[key];\r\n        if (ports.find((_p) => _p.name === key)) continue;\r\n\r\n        if (p.type === \"Relation\") {\r\n          // Handle Relation type if needed\r\n        } else {\r\n          // Other schema type ports\r\n          const _typeMap: Record<string, string> = {\r\n            String: \"string\",\r\n            Boolean: \"boolean\",\r\n            Number: \"number\",\r\n            Date: \"date\",\r\n          };\r\n\r\n          ports.push({\r\n            type: {\r\n              name: _typeMap[p.type] ? _typeMap[p.type] : \"*\",\r\n            },\r\n            plug: \"input\",\r\n            group: \"Properties\",\r\n            name: \"prop-\" + key,\r\n            displayName: key,\r\n          });\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  editorConnection.sendDynamicPorts(nodeId, ports);\r\n}\r\n\r\nexport function setup(context: NodeContext, graphModel: GraphModel) {\r\n  if (\r\n    !context.editorConnection ||\r\n    !context.editorConnection.isRunningLocally()\r\n  ) {\r\n    return;\r\n  }\r\n\r\n  function _managePortsForNode(node: any) {\r\n    updatePorts(\r\n      node.id,\r\n      node.parameters,\r\n      context.editorConnection,\r\n      graphModel.getMetaData(\"systemCollections\")\r\n    );\r\n\r\n    node.on(\"parameterUpdated\", function (_event: any) {\r\n      updatePorts(\r\n        node.id,\r\n        node.parameters,\r\n        context.editorConnection,\r\n        graphModel.getMetaData(\"systemCollections\")\r\n      );\r\n    });\r\n\r\n    graphModel.on(\"metadataChanged.systemCollections\", function (data: any) {\r\n      updatePorts(node.id, node.parameters, context.editorConnection, data);\r\n    });\r\n  }\r\n\r\n  graphModel.on(\"editorImportComplete\", () => {\r\n    graphModel.on(\"nodeAdded.net.noodl.user.SignUp\", function (node: any) {\r\n      _managePortsForNode(node);\r\n    });\r\n\r\n    for (const node of graphModel.getNodesWithType(\"net.noodl.user.SignUp\")) {\r\n      _managePortsForNode(node);\r\n    }\r\n  });\r\n}\r\n","import NoodlRuntime, { guid, ModelScope } from \"@fluxscape/runtime\";\r\nimport { EventEmitter } from \"events\";\r\nimport { CloudStore } from \"@fluxscape/runtime/src/api/cloudstore\";\r\n\r\ninterface UserServiceOptions {\r\n  username: string;\r\n  password: string;\r\n  email?: string;\r\n  properties?: Record<string, any>;\r\n  sessionToken?: string;\r\n  token?: string;\r\n  newPassword?: string;\r\n\r\n  success?: (response: any) => void;\r\n  error?: (error: any) => void;\r\n}\r\n\r\ninterface FetchCurrentUserOptions {\r\n  sessionToken?: string;\r\n  success: (response: any) => void;\r\n  error: (error: any) => void;\r\n}\r\n\r\nclass UserService {\r\n  static forScope(_modelScope: ModelScope) {\r\n    // On the viewer, always return main scope\r\n    return UserService.instance;\r\n  }\r\n\r\n  static _instance: UserService | undefined;\r\n  static get instance() {\r\n    if (UserService._instance === undefined)\r\n      UserService._instance = new UserService();\r\n    return UserService._instance;\r\n  }\r\n\r\n  private events: EventEmitter;\r\n  private appId?: string;\r\n  private endpoint?: string;\r\n  public current?: any;\r\n\r\n  constructor() {\r\n    this._initCloudServices();\r\n\r\n    this.events = new EventEmitter();\r\n    this.events.setMaxListeners(100000);\r\n\r\n    // Check for current user session, and validate if it exists\r\n    const currentUser = this.getUserFromLocalStorage();\r\n\r\n    if (currentUser) {\r\n      this.current = this.getUserModel();\r\n      this.fetchCurrentUser({\r\n        success: () => {},\r\n        error: () => {\r\n          // The session is no longer valid\r\n          delete localStorage[\"Parse/\" + this.appId + \"/currentUser\"];\r\n          delete this.current;\r\n          this.events.emit(\"sessionLost\");\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  private getUserFromLocalStorage(): any | undefined {\r\n    const currentUser = localStorage[\"Parse/\" + this.appId + \"/currentUser\"];\r\n    if (currentUser) {\r\n      try {\r\n        return JSON.parse(currentUser);\r\n      } catch (e) {\r\n        // do nothing\r\n      }\r\n    }\r\n    return undefined;\r\n  }\r\n\r\n  private _initCloudServices() {\r\n    const cloudServices = NoodlRuntime.instance.getMetaData(\"cloudservices\");\r\n\r\n    if (cloudServices) {\r\n      this.appId = cloudServices.appId;\r\n      this.endpoint = cloudServices.endpoint;\r\n    }\r\n  }\r\n\r\n  public on(...args: Parameters<EventEmitter[\"on\"]>) {\r\n    this.events.on(...args);\r\n  }\r\n\r\n  public off(...args: Parameters<EventEmitter[\"off\"]>) {\r\n    this.events.off(...args);\r\n  }\r\n\r\n  private _makeRequest(path: string, options: any) {\r\n    if (!this.endpoint) {\r\n      if (options.error) {\r\n        options.error({ error: \"No active cloud service\", status: 0 });\r\n      }\r\n      return;\r\n    }\r\n\r\n    const xhr = new XMLHttpRequest();\r\n\r\n    xhr.onreadystatechange = () => {\r\n      if (xhr.readyState === 4) {\r\n        let json;\r\n        try {\r\n          json = JSON.parse(xhr.response);\r\n        } catch (e) {}\r\n\r\n        if (xhr.status === 200 || xhr.status === 201) {\r\n          options.success(json || xhr.response);\r\n        } else {\r\n          options.error(\r\n            json || { error: xhr.responseText, status: xhr.status }\r\n          );\r\n        }\r\n      }\r\n    };\r\n\r\n    xhr.open(options.method || \"GET\", this.endpoint + path, true);\r\n\r\n    xhr.setRequestHeader(\"X-Parse-Application-Id\", this.appId!);\r\n\r\n    // Installation Id\r\n    let _iid = localStorage[\"Parse/\" + this.appId + \"/installationId\"];\r\n    if (_iid === undefined) {\r\n      _iid = localStorage[\"Parse/\" + this.appId + \"/installationId\"] = guid();\r\n    }\r\n    xhr.setRequestHeader(\"X-Parse-Installation-Id\", _iid);\r\n\r\n    // Check for current users\r\n    if (options.sessionToken) {\r\n      xhr.setRequestHeader(\"X-Parse-Session-Token\", options.sessionToken);\r\n    } else {\r\n      const currentUser = this.getUserFromLocalStorage();\r\n      if (currentUser !== undefined) {\r\n        xhr.setRequestHeader(\"X-Parse-Session-Token\", currentUser.sessionToken);\r\n      }\r\n    }\r\n\r\n    xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n    xhr.send(JSON.stringify(options.content));\r\n  }\r\n\r\n  public logIn(options: UserServiceOptions) {\r\n    this._makeRequest(\"/login\", {\r\n      method: \"POST\",\r\n      content: {\r\n        username: options.username,\r\n        password: options.password,\r\n        _method: \"GET\",\r\n      },\r\n      success: (response: any) => {\r\n        // Store current user\r\n        localStorage[\"Parse/\" + this.appId + \"/currentUser\"] =\r\n          JSON.stringify(response);\r\n        this.current = this.getUserModel(); // Make sure the user model is updated\r\n        options?.success?.(response);\r\n        this.events.emit(\"loggedIn\");\r\n      },\r\n      error: (e: any) => {\r\n        options?.error?.(e.error);\r\n      },\r\n    });\r\n  }\r\n\r\n  public logOut(options: { success: () => void; error: (error: any) => void }) {\r\n    this._makeRequest(\"/logout\", {\r\n      method: \"POST\",\r\n      content: {},\r\n      success: (response: any) => {\r\n        // Store current user\r\n        delete localStorage[\"Parse/\" + this.appId + \"/currentUser\"];\r\n        delete this.current;\r\n        options.success();\r\n        this.events.emit(\"loggedOut\");\r\n      },\r\n      error: (e: any) => {\r\n        options.error(e.error);\r\n      },\r\n    });\r\n  }\r\n\r\n  public signUp(options: UserServiceOptions) {\r\n    // make a shallow copy to feed through CloudStore._serializeObject, which will modify the object\r\n    const additionalUserProps = options.properties\r\n      ? CloudStore._serializeObject({ ...options.properties }, \"_User\")\r\n      : {};\r\n\r\n    this._makeRequest(\"/users\", {\r\n      method: \"POST\",\r\n      content: {\r\n        ...additionalUserProps,\r\n        username: options.username,\r\n        password: options.password,\r\n        email: options.email,\r\n      },\r\n      success: (response: any) => {\r\n        // Store current user\r\n        const _cu = {\r\n          ...response,\r\n          username: options.username,\r\n          ...options.properties,\r\n        };\r\n        localStorage[\"Parse/\" + this.appId + \"/currentUser\"] =\r\n          JSON.stringify(_cu);\r\n        this.current = this.getUserModel(); // Make sure the user model is updated\r\n        options?.success?.(response);\r\n        this.events.emit(\"loggedIn\");\r\n      },\r\n      error: (e: any) => {\r\n        options?.error?.(e.error);\r\n      },\r\n    });\r\n  }\r\n\r\n  public setUserProperties(options: {\r\n    properties: Record<string, any>;\r\n    email?: string;\r\n    username?: string;\r\n    success: (response: any) => void;\r\n    error: (error: any) => void;\r\n  }) {\r\n    const _cu = this.getCurrentUser();\r\n    if (_cu !== undefined) {\r\n      // make a shallow copy to feed through CloudStore._serializeObject, which will modify the object\r\n      const propsToSave = CloudStore._serializeObject(\r\n        { ...options.properties },\r\n        \"_User\"\r\n      );\r\n\r\n      const _content = {\r\n        email: options.email,\r\n        username: options.username,\r\n        ...propsToSave,\r\n      };\r\n\r\n      delete _content.emailVerified; // Remove props you cannot set\r\n      delete _content.createdAt;\r\n      delete _content.updatedAt;\r\n\r\n      this._makeRequest(\"/users/\" + _cu.objectId, {\r\n        method: \"PUT\",\r\n        content: _content,\r\n        success: (response: any) => {\r\n          // Store current user\r\n          Object.assign(_cu, _content);\r\n          localStorage[\"Parse/\" + this.appId + \"/currentUser\"] =\r\n            JSON.stringify(_cu);\r\n          this.current = this.getUserModel(); // Make sure the user model is updated\r\n          options.success(response);\r\n        },\r\n        error: (e: any) => {\r\n          options.error(e.error);\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  public fetchCurrentUser(options: FetchCurrentUserOptions) {\r\n    this._makeRequest(\"/users/me\", {\r\n      method: \"GET\",\r\n      sessionToken: options.sessionToken,\r\n      success: (response: any) => {\r\n        // Store current user\r\n        localStorage[\"Parse/\" + this.appId + \"/currentUser\"] =\r\n          JSON.stringify(response);\r\n        this.current = this.getUserModel(); // Make sure the user model is updated\r\n        this.events.emit(\"sessionGained\");\r\n        options.success(response);\r\n      },\r\n      error: (e: any) => {\r\n        if (e.code === 209) {\r\n          delete localStorage[\"Parse/\" + this.appId + \"/currentUser\"];\r\n          this.events.emit(\"sessionLost\");\r\n        }\r\n        options.error(e.error);\r\n      },\r\n    });\r\n  }\r\n\r\n  public verifyEmail(options: {\r\n    username: string;\r\n    token: string;\r\n    success: () => void;\r\n    error: (error: any) => void;\r\n  }) {\r\n    this._makeRequest(\r\n      \"/apps/\" +\r\n        this.appId +\r\n        \"/verify_email?username=\" +\r\n        options.username +\r\n        \"&token=\" +\r\n        options.token,\r\n      {\r\n        method: \"GET\",\r\n        success: (response: any) => {\r\n          if (response.indexOf(\"Successfully verified your email\") !== -1) {\r\n            options.success();\r\n          } else if (response.indexOf(\"Invalid Verification Link\")) {\r\n            options.error(\"Invalid verification token\");\r\n          } else {\r\n            options.error(\"Failed to verify email\");\r\n          }\r\n        },\r\n        error: (e: any) => {\r\n          options.error(e.error);\r\n        },\r\n      }\r\n    );\r\n  }\r\n\r\n  public sendEmailVerification(options: {\r\n    email: string;\r\n    success: () => void;\r\n    error: (error: any) => void;\r\n  }) {\r\n    this._makeRequest(\"/verificationEmailRequest\", {\r\n      method: \"POST\",\r\n      content: { email: options.email },\r\n      success: (response: any) => {\r\n        options.success();\r\n      },\r\n      error: (e: any) => {\r\n        options.error(e.error);\r\n      },\r\n    });\r\n  }\r\n\r\n  public resetPassword(options: {\r\n    username: string;\r\n    token: string;\r\n    newPassword: string;\r\n    success: () => void;\r\n    error: (error: any) => void;\r\n  }) {\r\n    this._makeRequest(\"/apps/\" + this.appId + \"/request_password_reset\", {\r\n      method: \"POST\",\r\n      content: {\r\n        username: options.username,\r\n        token: options.token,\r\n        new_password: options.newPassword,\r\n      },\r\n      success: (response: any) => {\r\n        if (\r\n          response.indexOf(\"Password successfully reset\") !== -1 ||\r\n          response.indexOf(\"Successfully updated your password\") !== -1\r\n        ) {\r\n          options.success();\r\n        } else if (response.indexOf(\"Invalid Link\")) {\r\n          options.error(\"Invalid verification token\");\r\n        } else {\r\n          options.error(\"Failed to verify email\");\r\n        }\r\n      },\r\n      error: (e: any) => {\r\n        options.error(e.error);\r\n      },\r\n    });\r\n  }\r\n\r\n  public requestPasswordReset(options: {\r\n    email: string;\r\n    success: () => void;\r\n    error: (error: any) => void;\r\n  }) {\r\n    this._makeRequest(\"/requestPasswordReset\", {\r\n      method: \"POST\",\r\n      content: { email: options.email },\r\n      success: (response: any) => {\r\n        options.success();\r\n      },\r\n      error: (e: any) => {\r\n        options.error(e.error);\r\n      },\r\n    });\r\n  }\r\n\r\n  public getCurrentUser(): any | undefined {\r\n    const _cu = localStorage[\"Parse/\" + this.appId + \"/currentUser\"];\r\n    if (_cu !== undefined) return JSON.parse(_cu);\r\n  }\r\n\r\n  public getUserModel(): any | undefined {\r\n    const _cu = this.getCurrentUser();\r\n    if (_cu !== undefined) {\r\n      delete _cu.sessionToken;\r\n      delete _cu.ACL;\r\n      delete _cu.className;\r\n      delete _cu.__type;\r\n      return CloudStore._fromJSON(_cu, \"_User\");\r\n    }\r\n  }\r\n}\r\n\r\n// @ts-expect-error\r\nNoodlRuntime.Services.UserService = UserService;\r\n\r\nexport default UserService;\r\n","import { NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  lastValue: any;\r\n  changeCount: number;\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"Value Changed\",\r\n  docs: \"https://docs.noodl.net/nodes/logic/value-changed\",\r\n  category: \"Logic\",\r\n  initialize: function () {\r\n    this._internal.lastValue = undefined;\r\n    this._internal.changeCount = 0;\r\n  },\r\n  getInspectInfo() {\r\n    if (this._internal.changeCount) {\r\n      return (\r\n        \"Triggered \" +\r\n        this._internal.changeCount +\r\n        (this._internal.changeCount === 1 ? \" time\" : \" times\")\r\n      );\r\n    }\r\n    return \"Not triggered\";\r\n  },\r\n  inputs: {\r\n    value: {\r\n      type: \"*\",\r\n      displayName: \"Input\",\r\n      set: function (value) {\r\n        if (this._internal.lastValue === value) {\r\n          return;\r\n        }\r\n\r\n        this._internal.changeCount++;\r\n        this.sendSignalOnOutput(\"valueChanged\");\r\n        this._internal.lastValue = value;\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    valueChanged: {\r\n      type: \"signal\",\r\n      displayName: \"Value Changed\",\r\n    },\r\n  },\r\n};\r\n","import { NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\nexport const node: NodeDefinition = {\r\n  name: \"Color\",\r\n  category: \"Variables\",\r\n  docs: \"https://docs.noodl.net/nodes/data/color\",\r\n  // @ts-expect-error What is this?\r\n  startValue: \"#f1f2f4\",\r\n  nodeDoubleClickAction: {\r\n    focusPort: \"value\",\r\n  },\r\n  type: {\r\n    name: \"color\",\r\n  },\r\n  cast(value: any): any {\r\n    return value;\r\n  },\r\n};\r\n","/* Web Font Loader v1.6.28 - (c) Adobe Systems, Google. License: Apache 2.0 */(function(){function aa(a,b,c){return a.call.apply(a.bind,arguments)}function ba(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}}function p(a,b,c){p=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf(\"native code\")?aa:ba;return p.apply(null,arguments)}var q=Date.now||function(){return+new Date};function ca(a,b){this.a=a;this.o=b||a;this.c=this.o.document}var da=!!window.FontFace;function t(a,b,c,d){b=a.c.createElement(b);if(c)for(var e in c)c.hasOwnProperty(e)&&(\"style\"==e?b.style.cssText=c[e]:b.setAttribute(e,c[e]));d&&b.appendChild(a.c.createTextNode(d));return b}function u(a,b,c){a=a.c.getElementsByTagName(b)[0];a||(a=document.documentElement);a.insertBefore(c,a.lastChild)}function v(a){a.parentNode&&a.parentNode.removeChild(a)}\nfunction w(a,b,c){b=b||[];c=c||[];for(var d=a.className.split(/\\s+/),e=0;e<b.length;e+=1){for(var f=!1,g=0;g<d.length;g+=1)if(b[e]===d[g]){f=!0;break}f||d.push(b[e])}b=[];for(e=0;e<d.length;e+=1){f=!1;for(g=0;g<c.length;g+=1)if(d[e]===c[g]){f=!0;break}f||b.push(d[e])}a.className=b.join(\" \").replace(/\\s+/g,\" \").replace(/^\\s+|\\s+$/,\"\")}function y(a,b){for(var c=a.className.split(/\\s+/),d=0,e=c.length;d<e;d++)if(c[d]==b)return!0;return!1}\nfunction ea(a){return a.o.location.hostname||a.a.location.hostname}function z(a,b,c){function d(){m&&e&&f&&(m(g),m=null)}b=t(a,\"link\",{rel:\"stylesheet\",href:b,media:\"all\"});var e=!1,f=!0,g=null,m=c||null;da?(b.onload=function(){e=!0;d()},b.onerror=function(){e=!0;g=Error(\"Stylesheet failed to load\");d()}):setTimeout(function(){e=!0;d()},0);u(a,\"head\",b)}\nfunction A(a,b,c,d){var e=a.c.getElementsByTagName(\"head\")[0];if(e){var f=t(a,\"script\",{src:b}),g=!1;f.onload=f.onreadystatechange=function(){g||this.readyState&&\"loaded\"!=this.readyState&&\"complete\"!=this.readyState||(g=!0,c&&c(null),f.onload=f.onreadystatechange=null,\"HEAD\"==f.parentNode.tagName&&e.removeChild(f))};e.appendChild(f);setTimeout(function(){g||(g=!0,c&&c(Error(\"Script load timeout\")))},d||5E3);return f}return null};function B(){this.a=0;this.c=null}function C(a){a.a++;return function(){a.a--;D(a)}}function E(a,b){a.c=b;D(a)}function D(a){0==a.a&&a.c&&(a.c(),a.c=null)};function F(a){this.a=a||\"-\"}F.prototype.c=function(a){for(var b=[],c=0;c<arguments.length;c++)b.push(arguments[c].replace(/[\\W_]+/g,\"\").toLowerCase());return b.join(this.a)};function G(a,b){this.c=a;this.f=4;this.a=\"n\";var c=(b||\"n4\").match(/^([nio])([1-9])$/i);c&&(this.a=c[1],this.f=parseInt(c[2],10))}function fa(a){return H(a)+\" \"+(a.f+\"00\")+\" 300px \"+I(a.c)}function I(a){var b=[];a=a.split(/,\\s*/);for(var c=0;c<a.length;c++){var d=a[c].replace(/['\"]/g,\"\");-1!=d.indexOf(\" \")||/^\\d/.test(d)?b.push(\"'\"+d+\"'\"):b.push(d)}return b.join(\",\")}function J(a){return a.a+a.f}function H(a){var b=\"normal\";\"o\"===a.a?b=\"oblique\":\"i\"===a.a&&(b=\"italic\");return b}\nfunction ga(a){var b=4,c=\"n\",d=null;a&&((d=a.match(/(normal|oblique|italic)/i))&&d[1]&&(c=d[1].substr(0,1).toLowerCase()),(d=a.match(/([1-9]00|normal|bold)/i))&&d[1]&&(/bold/i.test(d[1])?b=7:/[1-9]00/.test(d[1])&&(b=parseInt(d[1].substr(0,1),10))));return c+b};function ha(a,b){this.c=a;this.f=a.o.document.documentElement;this.h=b;this.a=new F(\"-\");this.j=!1!==b.events;this.g=!1!==b.classes}function ia(a){a.g&&w(a.f,[a.a.c(\"wf\",\"loading\")]);K(a,\"loading\")}function L(a){if(a.g){var b=y(a.f,a.a.c(\"wf\",\"active\")),c=[],d=[a.a.c(\"wf\",\"loading\")];b||c.push(a.a.c(\"wf\",\"inactive\"));w(a.f,c,d)}K(a,\"inactive\")}function K(a,b,c){if(a.j&&a.h[b])if(c)a.h[b](c.c,J(c));else a.h[b]()};function ja(){this.c={}}function ka(a,b,c){var d=[],e;for(e in b)if(b.hasOwnProperty(e)){var f=a.c[e];f&&d.push(f(b[e],c))}return d};function M(a,b){this.c=a;this.f=b;this.a=t(this.c,\"span\",{\"aria-hidden\":\"true\"},this.f)}function N(a){u(a.c,\"body\",a.a)}function O(a){return\"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:\"+I(a.c)+\";\"+(\"font-style:\"+H(a)+\";font-weight:\"+(a.f+\"00\")+\";\")};function P(a,b,c,d,e,f){this.g=a;this.j=b;this.a=d;this.c=c;this.f=e||3E3;this.h=f||void 0}P.prototype.start=function(){var a=this.c.o.document,b=this,c=q(),d=new Promise(function(d,e){function f(){q()-c>=b.f?e():a.fonts.load(fa(b.a),b.h).then(function(a){1<=a.length?d():setTimeout(f,25)},function(){e()})}f()}),e=null,f=new Promise(function(a,d){e=setTimeout(d,b.f)});Promise.race([f,d]).then(function(){e&&(clearTimeout(e),e=null);b.g(b.a)},function(){b.j(b.a)})};function Q(a,b,c,d,e,f,g){this.v=a;this.B=b;this.c=c;this.a=d;this.s=g||\"BESbswy\";this.f={};this.w=e||3E3;this.u=f||null;this.m=this.j=this.h=this.g=null;this.g=new M(this.c,this.s);this.h=new M(this.c,this.s);this.j=new M(this.c,this.s);this.m=new M(this.c,this.s);a=new G(this.a.c+\",serif\",J(this.a));a=O(a);this.g.a.style.cssText=a;a=new G(this.a.c+\",sans-serif\",J(this.a));a=O(a);this.h.a.style.cssText=a;a=new G(\"serif\",J(this.a));a=O(a);this.j.a.style.cssText=a;a=new G(\"sans-serif\",J(this.a));a=\nO(a);this.m.a.style.cssText=a;N(this.g);N(this.h);N(this.j);N(this.m)}var R={D:\"serif\",C:\"sans-serif\"},S=null;function T(){if(null===S){var a=/AppleWebKit\\/([0-9]+)(?:\\.([0-9]+))/.exec(window.navigator.userAgent);S=!!a&&(536>parseInt(a[1],10)||536===parseInt(a[1],10)&&11>=parseInt(a[2],10))}return S}Q.prototype.start=function(){this.f.serif=this.j.a.offsetWidth;this.f[\"sans-serif\"]=this.m.a.offsetWidth;this.A=q();U(this)};\nfunction la(a,b,c){for(var d in R)if(R.hasOwnProperty(d)&&b===a.f[R[d]]&&c===a.f[R[d]])return!0;return!1}function U(a){var b=a.g.a.offsetWidth,c=a.h.a.offsetWidth,d;(d=b===a.f.serif&&c===a.f[\"sans-serif\"])||(d=T()&&la(a,b,c));d?q()-a.A>=a.w?T()&&la(a,b,c)&&(null===a.u||a.u.hasOwnProperty(a.a.c))?V(a,a.v):V(a,a.B):ma(a):V(a,a.v)}function ma(a){setTimeout(p(function(){U(this)},a),50)}function V(a,b){setTimeout(p(function(){v(this.g.a);v(this.h.a);v(this.j.a);v(this.m.a);b(this.a)},a),0)};function W(a,b,c){this.c=a;this.a=b;this.f=0;this.m=this.j=!1;this.s=c}var X=null;W.prototype.g=function(a){var b=this.a;b.g&&w(b.f,[b.a.c(\"wf\",a.c,J(a).toString(),\"active\")],[b.a.c(\"wf\",a.c,J(a).toString(),\"loading\"),b.a.c(\"wf\",a.c,J(a).toString(),\"inactive\")]);K(b,\"fontactive\",a);this.m=!0;na(this)};\nW.prototype.h=function(a){var b=this.a;if(b.g){var c=y(b.f,b.a.c(\"wf\",a.c,J(a).toString(),\"active\")),d=[],e=[b.a.c(\"wf\",a.c,J(a).toString(),\"loading\")];c||d.push(b.a.c(\"wf\",a.c,J(a).toString(),\"inactive\"));w(b.f,d,e)}K(b,\"fontinactive\",a);na(this)};function na(a){0==--a.f&&a.j&&(a.m?(a=a.a,a.g&&w(a.f,[a.a.c(\"wf\",\"active\")],[a.a.c(\"wf\",\"loading\"),a.a.c(\"wf\",\"inactive\")]),K(a,\"active\")):L(a.a))};function oa(a){this.j=a;this.a=new ja;this.h=0;this.f=this.g=!0}oa.prototype.load=function(a){this.c=new ca(this.j,a.context||this.j);this.g=!1!==a.events;this.f=!1!==a.classes;pa(this,new ha(this.c,a),a)};\nfunction qa(a,b,c,d,e){var f=0==--a.h;(a.f||a.g)&&setTimeout(function(){var a=e||null,m=d||null||{};if(0===c.length&&f)L(b.a);else{b.f+=c.length;f&&(b.j=f);var h,l=[];for(h=0;h<c.length;h++){var k=c[h],n=m[k.c],r=b.a,x=k;r.g&&w(r.f,[r.a.c(\"wf\",x.c,J(x).toString(),\"loading\")]);K(r,\"fontloading\",x);r=null;if(null===X)if(window.FontFace){var x=/Gecko.*Firefox\\/(\\d+)/.exec(window.navigator.userAgent),xa=/OS X.*Version\\/10\\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);\nX=x?42<parseInt(x[1],10):xa?!1:!0}else X=!1;X?r=new P(p(b.g,b),p(b.h,b),b.c,k,b.s,n):r=new Q(p(b.g,b),p(b.h,b),b.c,k,b.s,a,n);l.push(r)}for(h=0;h<l.length;h++)l[h].start()}},0)}function pa(a,b,c){var d=[],e=c.timeout;ia(b);var d=ka(a.a,c,a.c),f=new W(a.c,b,e);a.h=d.length;b=0;for(c=d.length;b<c;b++)d[b].load(function(b,d,c){qa(a,f,b,d,c)})};function ra(a,b){this.c=a;this.a=b}\nra.prototype.load=function(a){function b(){if(f[\"__mti_fntLst\"+d]){var c=f[\"__mti_fntLst\"+d](),e=[],h;if(c)for(var l=0;l<c.length;l++){var k=c[l].fontfamily;void 0!=c[l].fontStyle&&void 0!=c[l].fontWeight?(h=c[l].fontStyle+c[l].fontWeight,e.push(new G(k,h))):e.push(new G(k))}a(e)}else setTimeout(function(){b()},50)}var c=this,d=c.a.projectId,e=c.a.version;if(d){var f=c.c.o;A(this.c,(c.a.api||\"https://fast.fonts.net/jsapi\")+\"/\"+d+\".js\"+(e?\"?v=\"+e:\"\"),function(e){e?a([]):(f[\"__MonotypeConfiguration__\"+\nd]=function(){return c.a},b())}).id=\"__MonotypeAPIScript__\"+d}else a([])};function sa(a,b){this.c=a;this.a=b}sa.prototype.load=function(a){var b,c,d=this.a.urls||[],e=this.a.families||[],f=this.a.testStrings||{},g=new B;b=0;for(c=d.length;b<c;b++)z(this.c,d[b],C(g));var m=[];b=0;for(c=e.length;b<c;b++)if(d=e[b].split(\":\"),d[1])for(var h=d[1].split(\",\"),l=0;l<h.length;l+=1)m.push(new G(d[0],h[l]));else m.push(new G(d[0]));E(g,function(){a(m,f)})};function ta(a,b){a?this.c=a:this.c=ua;this.a=[];this.f=[];this.g=b||\"\"}var ua=\"https://fonts.googleapis.com/css\";function va(a,b){for(var c=b.length,d=0;d<c;d++){var e=b[d].split(\":\");3==e.length&&a.f.push(e.pop());var f=\"\";2==e.length&&\"\"!=e[1]&&(f=\":\");a.a.push(e.join(f))}}\nfunction wa(a){if(0==a.a.length)throw Error(\"No fonts to load!\");if(-1!=a.c.indexOf(\"kit=\"))return a.c;for(var b=a.a.length,c=[],d=0;d<b;d++)c.push(a.a[d].replace(/ /g,\"+\"));b=a.c+\"?family=\"+c.join(\"%7C\");0<a.f.length&&(b+=\"&subset=\"+a.f.join(\",\"));0<a.g.length&&(b+=\"&text=\"+encodeURIComponent(a.g));return b};function ya(a){this.f=a;this.a=[];this.c={}}\nvar za={latin:\"BESbswy\",\"latin-ext\":\"\\u00e7\\u00f6\\u00fc\\u011f\\u015f\",cyrillic:\"\\u0439\\u044f\\u0416\",greek:\"\\u03b1\\u03b2\\u03a3\",khmer:\"\\u1780\\u1781\\u1782\",Hanuman:\"\\u1780\\u1781\\u1782\"},Aa={thin:\"1\",extralight:\"2\",\"extra-light\":\"2\",ultralight:\"2\",\"ultra-light\":\"2\",light:\"3\",regular:\"4\",book:\"4\",medium:\"5\",\"semi-bold\":\"6\",semibold:\"6\",\"demi-bold\":\"6\",demibold:\"6\",bold:\"7\",\"extra-bold\":\"8\",extrabold:\"8\",\"ultra-bold\":\"8\",ultrabold:\"8\",black:\"9\",heavy:\"9\",l:\"3\",r:\"4\",b:\"7\"},Ba={i:\"i\",italic:\"i\",n:\"n\",normal:\"n\"},\nCa=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;\nfunction Da(a){for(var b=a.f.length,c=0;c<b;c++){var d=a.f[c].split(\":\"),e=d[0].replace(/\\+/g,\" \"),f=[\"n4\"];if(2<=d.length){var g;var m=d[1];g=[];if(m)for(var m=m.split(\",\"),h=m.length,l=0;l<h;l++){var k;k=m[l];if(k.match(/^[\\w-]+$/)){var n=Ca.exec(k.toLowerCase());if(null==n)k=\"\";else{k=n[2];k=null==k||\"\"==k?\"n\":Ba[k];n=n[1];if(null==n||\"\"==n)n=\"4\";else var r=Aa[n],n=r?r:isNaN(n)?\"4\":n.substr(0,1);k=[k,n].join(\"\")}}else k=\"\";k&&g.push(k)}0<g.length&&(f=g);3==d.length&&(d=d[2],g=[],d=d?d.split(\",\"):\ng,0<d.length&&(d=za[d[0]])&&(a.c[e]=d))}a.c[e]||(d=za[e])&&(a.c[e]=d);for(d=0;d<f.length;d+=1)a.a.push(new G(e,f[d]))}};function Ea(a,b){this.c=a;this.a=b}var Fa={Arimo:!0,Cousine:!0,Tinos:!0};Ea.prototype.load=function(a){var b=new B,c=this.c,d=new ta(this.a.api,this.a.text),e=this.a.families;va(d,e);var f=new ya(e);Da(f);z(c,wa(d),C(b));E(b,function(){a(f.a,f.c,Fa)})};function Ga(a,b){this.c=a;this.a=b}Ga.prototype.load=function(a){var b=this.a.id,c=this.c.o;b?A(this.c,(this.a.api||\"https://use.typekit.net\")+\"/\"+b+\".js\",function(b){if(b)a([]);else if(c.Typekit&&c.Typekit.config&&c.Typekit.config.fn){b=c.Typekit.config.fn;for(var e=[],f=0;f<b.length;f+=2)for(var g=b[f],m=b[f+1],h=0;h<m.length;h++)e.push(new G(g,m[h]));try{c.Typekit.load({events:!1,classes:!1,async:!0})}catch(l){}a(e)}},2E3):a([])};function Ha(a,b){this.c=a;this.f=b;this.a=[]}Ha.prototype.load=function(a){var b=this.f.id,c=this.c.o,d=this;b?(c.__webfontfontdeckmodule__||(c.__webfontfontdeckmodule__={}),c.__webfontfontdeckmodule__[b]=function(b,c){for(var g=0,m=c.fonts.length;g<m;++g){var h=c.fonts[g];d.a.push(new G(h.name,ga(\"font-weight:\"+h.weight+\";font-style:\"+h.style)))}a(d.a)},A(this.c,(this.f.api||\"https://f.fontdeck.com/s/css/js/\")+ea(this.c)+\"/\"+b+\".js\",function(b){b&&a([])})):a([])};var Y=new oa(window);Y.a.c.custom=function(a,b){return new sa(b,a)};Y.a.c.fontdeck=function(a,b){return new Ha(b,a)};Y.a.c.monotype=function(a,b){return new ra(b,a)};Y.a.c.typekit=function(a,b){return new Ga(b,a)};Y.a.c.google=function(a,b){return new Ea(b,a)};var Z={load:p(Y.load,Y)};\"function\"===typeof define&&define.amd?define(function(){return Z}):\"undefined\"!==typeof module&&module.exports?module.exports=Z:(window.WebFont=Z,window.WebFontConfig&&Y.load(window.WebFontConfig));}());\n","const { default: NoodlRuntime } = require(\"@fluxscape/runtime\");\r\n\r\nfunction _makeRequest(path, options) {\r\n  var xhr = new XMLHttpRequest();\r\n\r\n  xhr.onreadystatechange = function () {\r\n    if (xhr.readyState === 4) {\r\n      var json;\r\n      try {\r\n        json = JSON.parse(xhr.response);\r\n      } catch (e) {}\r\n\r\n      if (xhr.status === 200 || xhr.status === 201) {\r\n        options.success(json);\r\n      } else options.error(json);\r\n    }\r\n  };\r\n\r\n  xhr.open(options.method || \"GET\", options.endpoint + path, true);\r\n\r\n  xhr.setRequestHeader(\"X-Parse-Application-Id\", options.appId);\r\n  xhr.setRequestHeader(\"Content-Type\", \"application/json\");\r\n\r\n  const cloudServices = NoodlRuntime.instance.getMetaData(\"cloudservices\");\r\n  if (cloudServices && cloudServices.deployVersion) {\r\n    xhr.setRequestHeader(\"x-noodl-cloud-version\", cloudServices.deployVersion);\r\n  }\r\n\r\n  // Check for current users\r\n  var _cu = localStorage[\"Parse/\" + options.appId + \"/currentUser\"];\r\n  if (_cu !== undefined) {\r\n    try {\r\n      const currentUser = JSON.parse(_cu);\r\n      xhr.setRequestHeader(\"X-Parse-Session-Token\", currentUser.sessionToken);\r\n    } catch (e) {\r\n      // Failed to extract session token\r\n    }\r\n  }\r\n\r\n  xhr.send(JSON.stringify(options.content));\r\n}\r\n\r\nconst cloudfunctions = {\r\n  async run(functionName, params) {\r\n    return new Promise((resolve, reject) => {\r\n      const cloudServices = NoodlRuntime.instance.getMetaData(\"cloudservices\");\r\n      if (cloudServices === undefined) {\r\n        reject(\"No cloud services defined in this project.\");\r\n        return;\r\n      }\r\n\r\n      const appId = cloudServices.appId;\r\n      const endpoint = NoodlRuntime.instance.editorConnection.isRunningLocally()\r\n        ? `http://${window.location.hostname}:8577`\r\n        : cloudServices.endpoint;\r\n\r\n      _makeRequest(\"/functions/\" + encodeURIComponent(functionName), {\r\n        appId,\r\n        endpoint,\r\n        content: params,\r\n        method: \"POST\",\r\n        success: (res) => {\r\n          resolve(res ? res.result : undefined);\r\n        },\r\n        error: (err) => {\r\n          reject(err);\r\n        },\r\n      });\r\n    });\r\n  },\r\n};\r\n\r\nmodule.exports = cloudfunctions;\r\n","const UserService = require('../nodes/std-library/user/userservice')\r\n\r\nconst users = {\r\n    async logIn(options) {\r\n        return new Promise((resolve,reject) => {\r\n            UserService.instance.logIn({\r\n                username:options.username,\r\n                password:options.password,\r\n                success:() => {\r\n                    resolve()\r\n                },\r\n                error:(e) => {\r\n                    reject(e)\r\n                }\r\n            })\r\n        })\r\n    },\r\n\r\n    async signUp(options) {\r\n        return new Promise((resolve,reject) => {\r\n            UserService.instance.signUp({\r\n                username:options.username,\r\n                password:options.password,\r\n                email:options.email,\r\n                properties:options.properties,\r\n                success:() => {\r\n                    resolve()\r\n                },\r\n                error:(e) => {\r\n                    reject(e)\r\n                }\r\n            })\r\n        })\r\n    },\r\n\r\n    async become(sessionToken) {\r\n        return new Promise((resolve,reject) => {\r\n            UserService.instance.fetchCurrentUser({\r\n                sessionToken,\r\n                success:() => {\r\n                    resolve()\r\n                },\r\n                error:(e) => {\r\n                    reject(e)\r\n                }\r\n            })\r\n        })\r\n    },\r\n\r\n    // Deprecated use cloud functions instead\r\n  /*  async requestPasswordReset(options) {\r\n        return new Promise((resolve,reject) => {\r\n            UserService.instance.requestPasswordReset({\r\n                email:options.email,\r\n                success:() => {\r\n                    resolve()\r\n                },\r\n                error:(e) => {\r\n                    reject(e)\r\n                }\r\n            })\r\n        })\r\n    },\r\n\r\n    async resetPassword(options) {\r\n        return new Promise((resolve,reject) => {\r\n            UserService.instance.resetPassword({\r\n                token:options.token,\r\n                username:options.username,\r\n                newPassword:options.newPassword,\r\n                success:() => {\r\n                    resolve()\r\n                },\r\n                error:(e) => {\r\n                    reject(e)\r\n                }\r\n            })\r\n        })\r\n    },   \r\n\r\n    async sendEmailVerification(options) {\r\n        return new Promise((resolve,reject) => {\r\n            UserService.instance.sendEmailVerification({\r\n                email:options.email,\r\n                success:() => {\r\n                    resolve()\r\n                },\r\n                error:(e) => {\r\n                    reject(e)\r\n                }\r\n            })\r\n        })\r\n    },\r\n\r\n    async verifyEmail(options) {\r\n        return new Promise((resolve,reject) => {\r\n            UserService.instance.verifyEmail({\r\n                username:options.username,\r\n                token:options.token,\r\n                success:() => {\r\n                    resolve()\r\n                },\r\n                error:(e) => {\r\n                    reject(e)\r\n                }\r\n            })\r\n        })\r\n    },*/\r\n\r\n    on(event,cb) {\r\n        UserService.instance.on(event,cb)\r\n    },\r\n\r\n    off(event,cb) {\r\n        UserService.instance.off(event,cb)\r\n    }, \r\n}\r\n\r\nconst _currentUser = {\r\n    async logOut() {\r\n        return new Promise((resolve,reject) => {\r\n            UserService.instance.logOut({\r\n                success:() => {\r\n                    resolve()\r\n                },\r\n                error:(e) => {\r\n                    reject(e)\r\n                }\r\n            })\r\n        })\r\n    },\r\n\r\n    async save() {\r\n        return new Promise((resolve,reject) => {\r\n            const props = Object.assign({},_currentUser.Properties.data)\r\n\r\n            UserService.instance.setUserProperties({\r\n                properties:props,\r\n                success:() => {\r\n                    resolve()\r\n                },\r\n                error:(e) => {\r\n                    reject(e)\r\n                }\r\n            })\r\n        })\r\n    },\r\n\r\n    async fetch() {\r\n        return new Promise((resolve,reject) => {\r\n            UserService.instance.fetchCurrentUser({\r\n                success:() => {\r\n                    resolve()\r\n                },\r\n                error:(e) => {\r\n                    reject(e)\r\n                }\r\n            })\r\n        })\r\n    }\r\n}\r\n\r\nObject.defineProperty(users, 'Current', { \r\n    get: function() { \r\n        const _user = UserService.instance.current; \r\n        if(_user === undefined) return; \r\n        else {\r\n            _currentUser.email = _user.email;\r\n            _currentUser.username = _user.username;\r\n            _currentUser.id = _user.id;\r\n            _currentUser.emailVerified = _user.emailVerified;\r\n            _currentUser.Properties = _user\r\n            return _currentUser\r\n        } \r\n    } \r\n});\r\n\r\nmodule.exports = users","module.exports = function patchedMomentum(current, start, time, lowerMargin, upperMargin, wrapperSize, options) {\r\n  if (options === void 0) {\r\n    options = this.options;\r\n  }\r\n  var distance = current - start;\r\n  var speed = Math.abs(distance) / time;\r\n  var deceleration = options.deceleration,\r\n    swipeBounceTime = options.swipeBounceTime,\r\n    swipeTime = options.swipeTime;\r\n  var momentumData = {\r\n    destination: current + (speed / deceleration) * (distance < 0 ? -1 : 1),\r\n    duration: swipeTime,\r\n    rate: 15\r\n  };\r\n  this.hooks.trigger(this.hooks.eventTypes.momentum, momentumData, distance);\r\n  if (momentumData.destination < lowerMargin) {\r\n    momentumData.destination = wrapperSize\r\n      ? Math.max(lowerMargin - wrapperSize / 4, lowerMargin - (wrapperSize / momentumData.rate) * speed)\r\n      : lowerMargin;\r\n    momentumData.duration = Math.abs(momentumData.destination - current) / speed;\r\n  } else if (momentumData.destination > upperMargin) {\r\n    momentumData.destination = wrapperSize\r\n      ? Math.min(upperMargin + wrapperSize / 4, upperMargin + (wrapperSize / momentumData.rate) * speed)\r\n      : upperMargin;\r\n    // momentumData.duration = swipeBounceTime;\r\n    momentumData.duration = Math.abs(momentumData.destination - current) / speed;\r\n  }\r\n  momentumData.destination = Math.round(momentumData.destination);\r\n  return momentumData;\r\n};\r\n","const _refCount = new Map(); //node id to ref count\r\n\r\nconst CSSDefinition = {\r\n  name: 'CSS Definition',\r\n  docs: 'https://docs.noodl.net/nodes/utilities/css-definition',\r\n  category: 'CustomCode',\r\n  color: 'javascript',\r\n  nodeDoubleClickAction: {\r\n    focusPort: 'Style'\r\n  },\r\n  initialize: function () {\r\n    var internal = this._internal;\r\n    internal.style = '';\r\n\r\n    const styleId = this.getStyleRefId();\r\n\r\n    this.addDeleteListener(() => {\r\n      _refCount.set(styleId, _refCount.get(styleId) - 1);\r\n      if (_refCount.get(styleId) === 0) {\r\n        this.removeStyleDeclaration();\r\n        _refCount.delete(styleId);\r\n      }\r\n    });\r\n\r\n    if (!_refCount.has(styleId)) {\r\n      _refCount.set(styleId, 0);\r\n    }\r\n\r\n    _refCount.set(styleId, _refCount.get(styleId) + 1);\r\n  },\r\n  inputs: {\r\n    style: {\r\n      index: 4005,\r\n      type: { name: 'string', allowEditOnly: true, codeeditor: 'css' },\r\n      displayName: 'Style',\r\n      group: 'Content',\r\n      default: '',\r\n\r\n      set: function (value) {\r\n        this.updateStyle(value);\r\n      }\r\n    }\r\n  },\r\n  outputs: {},\r\n  methods: {\r\n    getStyleRefId: function () {\r\n      return 'style_' + this.id;\r\n    },\r\n    removeStyleDeclaration: function () {\r\n      // Add SSR Support\r\n      if (typeof document === 'undefined') return;\r\n\r\n      var styleRefId = this.getStyleRefId();\r\n      var styleObj = document.getElementById(styleRefId);\r\n      if (styleObj !== null) {\r\n        styleObj.parentNode.removeChild(styleObj);\r\n      }\r\n    },\r\n    updateStyle: function (style) {\r\n      // Add SSR Support\r\n      if (typeof document === 'undefined') return;\r\n\r\n      var internal = this._internal;\r\n      var styleRefId = this.getStyleRefId();\r\n      internal.style = style;\r\n\r\n      if (style !== null) {\r\n        var styleObj = document.getElementById(styleRefId);\r\n        if (styleObj === null) {\r\n          styleObj = document.createElement('style');\r\n          styleObj.id = styleRefId;\r\n          styleObj.type = 'text/css';\r\n          document.head.appendChild(styleObj);\r\n        }\r\n\r\n        styleObj.innerHTML = '\\n' + style + '\\n';\r\n      } else {\r\n        this.removeStyleDeclaration();\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nmodule.exports = {\r\n  node: CSSDefinition\r\n};\r\n","module.exports = React;","module.exports = ReactDOM;","import { EventEmitter } from 'eventemitter3';\nimport difference$1 from 'lodash.difference';\n\nclass NodeRegister {\n    constructor(context) {\n        this._constructors = {};\n        this.context = context;\n    }\n    register(nodeDefinition) {\n        const name = nodeDefinition.metadata.name;\n        this._constructors[name] = nodeDefinition;\n    }\n    createNode(name, id, nodeScope) {\n        if (!this._constructors.hasOwnProperty(name)) {\n            throw new Error(\"Unknown node type with name \" + name);\n        }\n        return this._constructors[name](this.context, id, nodeScope);\n    }\n    getNodeMetadata(type) {\n        if (!this._constructors.hasOwnProperty(type)) {\n            throw new Error(\"Unknown node type with name \" + type);\n        }\n        return this._constructors[type].metadata;\n    }\n    hasNode(type) {\n        return this._constructors.hasOwnProperty(type);\n    }\n    getInputType(type, inputName) {\n        var _a, _b;\n        const metadata = this.getNodeMetadata(type);\n        return (_b = (_a = metadata.inputs) === null || _a === void 0 ? void 0 : _a[inputName]) === null || _b === void 0 ? void 0 : _b.type;\n    }\n}\n\nclass Timer {\n    constructor(scheduler, args) {\n        this._hasCalledOnStart = false;\n        this._wasStopped = false;\n        this._start = 0;\n        this._durationLeft = 0;\n        this.duration = args.duration || 0;\n        this._isRunning = false;\n        this._hasCalledOnStart = false;\n        this.scheduler = scheduler;\n        this.repeatCount = 1;\n        this.delay = 0;\n        for (const arg in args) {\n            this[arg] = args[arg];\n        }\n    }\n    start() {\n        if (this._isRunning) {\n            this.stop();\n        }\n        this.scheduler.scheduleTimer(this);\n        return this;\n    }\n    stop() {\n        this.scheduler.stopTimer(this);\n        this._hasCalledOnStart = false;\n        this._isRunning = false;\n        this._wasStopped = true; // This is used to avoid calling onFinish\n    }\n    isRunning() {\n        return this._isRunning;\n    }\n    durationLeft() {\n        return this._durationLeft;\n    }\n}\nclass TimerScheduler {\n    constructor(requestFrameCallback) {\n        this.requestFrame = requestFrameCallback;\n        this.runningTimers = [];\n        this.newTimers = [];\n    }\n    createTimer(args) {\n        return new Timer(this, args);\n    }\n    scheduleTimer(timer) {\n        if (this.newTimers.indexOf(timer) === -1) {\n            if (timer.repeatCount === 0) {\n                timer.repeatCount = 100000;\n            }\n            this.newTimers.push(timer);\n            this.requestFrame();\n        }\n    }\n    stopTimer(timer) {\n        let index;\n        if (timer._isRunning) {\n            index = this.runningTimers.indexOf(timer);\n            if (index !== -1) {\n                this.runningTimers.splice(index, 1);\n            }\n            if (timer.onStop && !timer._wasStopped) {\n                timer.onStop();\n            }\n        }\n        else {\n            index = this.newTimers.indexOf(timer);\n            if (index !== -1) {\n                this.newTimers.splice(index, 1);\n            }\n        }\n    }\n    runTimers(currentTime) {\n        var _a, _b;\n        const remainingTimers = [];\n        const finishedTimers = [];\n        const timersThisFrame = [];\n        let i;\n        const len = this.runningTimers.length;\n        let timer;\n        //copy timer list in case timers are added or removed during onStart or onRunning\n        for (i = 0; i < len; ++i) {\n            timersThisFrame[i] = this.runningTimers[i];\n        }\n        for (i = 0; i < len; ++i) {\n            timer = timersThisFrame[i];\n            if (timer && currentTime >= timer._start) {\n                if (timer._hasCalledOnStart === false && timer.onStart) {\n                    timer.onStart();\n                    timer._hasCalledOnStart = true;\n                }\n                let t;\n                if (timer.duration > 0) {\n                    t =\n                        (currentTime - timer._start) / (timer.duration * timer.repeatCount);\n                }\n                else {\n                    t = 1.0;\n                }\n                timer._durationLeft = timer.duration * (1 - t);\n                let localT = t * timer.repeatCount - Math.floor(t * timer.repeatCount);\n                if (t >= 1.0) {\n                    localT = 1.0;\n                }\n                if (timer.onRunning) {\n                    timer.onRunning(localT);\n                }\n                if (t < 1.0 && timer._isRunning) {\n                    remainingTimers.push(timer);\n                }\n                else if (!timer._wasStopped) {\n                    finishedTimers.push(timer);\n                }\n            }\n            else {\n                remainingTimers.push(timer);\n            }\n        }\n        this.runningTimers = remainingTimers;\n        for (i = 0; i < finishedTimers.length; ++i) {\n            finishedTimers[i]._isRunning = false;\n            finishedTimers[i]._hasCalledOnStart = false;\n            (_b = (_a = finishedTimers[i]) === null || _a === void 0 ? void 0 : _a.onFinish) === null || _b === void 0 ? void 0 : _b.call(_a);\n        }\n        //add newly queued timers\n        if (this.newTimers.length > 0) {\n            for (i = 0; i < this.newTimers.length; ++i) {\n                timer = this.newTimers[i];\n                timer._start = currentTime + timer.delay;\n                timer._isRunning = true;\n                timer._wasStopped = false;\n                this.runningTimers.push(timer);\n                if (timer.delay === 0) {\n                    //play first timer frame directly to keep everything nicely synched\n                    if (timer.onStart) {\n                        timer.onStart();\n                        timer._hasCalledOnStart = true;\n                    }\n                    if (timer.onRunning) {\n                        timer.onRunning(0);\n                    }\n                }\n            }\n            this.newTimers.length = 0;\n        }\n    }\n    hasPendingTimers() {\n        return this.runningTimers.length > 0 || this.newTimers.length > 0;\n    }\n}\n\nclass Variants {\n    constructor({ graphModel, getNodeScope }) {\n        this.getNodeScope = getNodeScope;\n        if (graphModel) {\n            this.graphModel = graphModel;\n            graphModel.on(\"variantUpdated\", (variant) => this.onVariantUpdated(variant));\n        }\n    }\n    getVariant(typename, name) {\n        if (!this.graphModel)\n            return undefined;\n        if (!name)\n            return undefined;\n        return this.graphModel.getVariant(typename, name);\n    }\n    onVariantUpdated(variant) {\n        const nodeScope = this.getNodeScope();\n        if (!nodeScope)\n            return;\n        //get all nodes with the type the variant applies to\n        const nodes = nodeScope.getNodesWithTypeRecursive(variant.typename);\n        //and filter for the ones using the updated variant\n        const nodesWithVariant = nodes.filter((node) => {\n            //if a variant has been set during runtime, it'll override the value from the model\n            if (typeof node.variant === \"object\")\n                return node.variant.name === variant.name;\n            if (typeof node.variant === \"string\")\n                return node.variant === variant.name;\n            //otherwise check the model (which always matches the editor)\n            return node.model && node.model.variant === variant.name;\n        });\n        //and re-apply the variant\n        for (const node of nodesWithVariant) {\n            node.setVariant(variant);\n        }\n    }\n}\n\nclass OutputProperty {\n    constructor(args) {\n        this.valuesSendThisIteration = 0;\n        if (!args.owner) {\n            throw new Error(\"Owner must be set\");\n        }\n        this.getter = args.getter || (() => undefined);\n        this.connections = [];\n        this._owner = args.owner;\n        this._name = args.name;\n        this.onFirstConnectionAdded = args.onFirstConnectionAdded;\n        this.onLastConnectionRemoved = args.onLastConnectionRemoved;\n    }\n    get name() {\n        return this._name;\n    }\n    get owner() {\n        return this._owner;\n    }\n    get value() {\n        return this.getter.call(this.owner);\n    }\n    get id() {\n        if (!this._id) {\n            this._id = this.owner.id + this.name;\n        }\n        return this._id;\n    }\n    registerConnection(node, inputPortName) {\n        this.connections.push({\n            node,\n            inputPortName,\n        });\n        if (this.connections.length === 1 && this.onFirstConnectionAdded) {\n            this.onFirstConnectionAdded.call(this.owner);\n        }\n    }\n    deregisterConnection(node, inputPortName) {\n        for (let i = 0; i < this.connections.length; i++) {\n            const connection = this.connections[i];\n            if (connection.node === node &&\n                connection.inputPortName === inputPortName) {\n                this.connections.splice(i, 1);\n                break;\n            }\n        }\n        if (this.connections.length === 0 && this.onLastConnectionRemoved) {\n            this.onLastConnectionRemoved.call(this.owner);\n        }\n    }\n    flagDependeesDirty(value) {\n        for (let i = 0, len = this.connections.length; i < len; i++) {\n            this.connections[i].node.flagDirty();\n        }\n    }\n    sendValue(value) {\n        if (this._lastUpdateIteration !== this.owner._updatedAtIteration) {\n            this._lastUpdateIteration = this.owner._updatedAtIteration;\n            this.valuesSendThisIteration = 0;\n        }\n        else {\n            this.valuesSendThisIteration++;\n        }\n        if (this.valuesSendThisIteration > 500) {\n            this.owner._cyclicLoop = true;\n        }\n        for (let i = 0, len = this.connections.length; i < len; i++) {\n            const connection = this.connections[i];\n            connection.node._setValueFromConnection(connection.inputPortName, value);\n        }\n    }\n    hasConnections() {\n        return this.connections.length > 0;\n    }\n}\n\nclass Node {\n    constructor(context, id) {\n        this.updateOnDirtyFlagging = true;\n        this.children = [];\n        // This is used by the node definitions to store internal state.\n        // Something that should get cleaned up in the future.\n        this._internal = {};\n        this._dirty = false;\n        this._inputs = {};\n        this._inputValues = {};\n        this._outputs = {};\n        this._inputConnections = {};\n        this._outputList = [];\n        this._isUpdating = false;\n        this._inputValuesQueue = {};\n        this._afterInputsHaveUpdatedCallbacks = [];\n        this._signalsSentThisUpdate = {};\n        this._deleted = false;\n        this._deleteListeners = [];\n        this._isFirstUpdate = true;\n        this._valuesFromConnections = {};\n        this._updateIteration = 0;\n        this.id = id;\n        this.context = context;\n    }\n    getInputValue(name) {\n        return this._inputValues[name];\n    }\n    registerInput(name, input) {\n        var _a;\n        if (this.hasInput(name)) {\n            throw new Error(\"Input property \" + name + \" already registered\");\n        }\n        this._inputs[name] = input;\n        if (input.type && typeof input.type === \"object\" && \"units\" in input.type) {\n            const defaultUnit = input.type.defaultUnit || ((_a = input.type.units) === null || _a === void 0 ? void 0 : _a[0]) || \"\";\n            this._inputValues[name] = {\n                value: input.default,\n                type: defaultUnit,\n            };\n        }\n        else if (input.hasOwnProperty(\"default\")) {\n            this._inputValues[name] = input.default;\n        }\n    }\n    deregisterInput(name) {\n        if (this.hasInput(name) === false) {\n            throw new Error(\"Input property \" + name + \" doesn't exist\");\n        }\n        delete this._inputs[name];\n        delete this._inputValues[name];\n    }\n    registerInputs(inputs) {\n        for (const name in inputs) {\n            this.registerInput(name, inputs[name]);\n        }\n    }\n    getInput(name) {\n        if (this.hasInput(name) === false) {\n            console.log(\"Node \" + this.name + \": Invalid input property \" + name);\n            return undefined;\n        }\n        return this._inputs[name];\n    }\n    hasInput(name) {\n        return name in this._inputs;\n    }\n    registerInputIfNeeded(_name) {\n        //noop, can be overriden by subclasses\n    }\n    setInputValue(name, value) {\n        var _a, _b, _c, _d, _e;\n        const input = this.getInput(name);\n        if (!input) {\n            console.log(\"node doesn't have input\", name);\n            return;\n        }\n        if (typeof input.type === \"object\" &&\n            input.type.name === \"array\" &&\n            typeof value === \"string\") {\n            try {\n                const parsedValue = JSON.parse(value);\n                input.set.call(this, parsedValue);\n                input.value = parsedValue;\n                this._inputValues[name] = parsedValue;\n            }\n            catch (e) {\n                // Handle parsing error if needed\n            }\n        }\n        else {\n            input.set.call(this, value);\n            input.value = value;\n            this._inputValues[name] = value;\n        }\n        if (input.type === \"color\" && this.context && this.context.styles) {\n            value = this.context.styles.resolveColor(value);\n        }\n        else if (input.type === \"array\" && typeof value === \"string\") {\n            try {\n                value = eval(value);\n                (_a = this.context.editorConnection) === null || _a === void 0 ? void 0 : _a.clearWarning((_c = (_b = this.nodeScope) === null || _b === void 0 ? void 0 : _b.componentOwner) === null || _c === void 0 ? void 0 : _c.name, this.id, \"invalid-array-\" + name);\n            }\n            catch (e) {\n                const error = e;\n                value = [];\n                console.log(e);\n                if (this.context.editorConnection) {\n                    this.context.editorConnection.sendWarning((_e = (_d = this.nodeScope) === null || _d === void 0 ? void 0 : _d.componentOwner) === null || _e === void 0 ? void 0 : _e.name, this.id, \"invalid-array-\" + name, {\n                        showGlobally: true,\n                        message: \"Invalid array<br>\" + error.toString(),\n                    });\n                }\n            }\n        }\n        input.set.call(this, value);\n    }\n    hasOutput(name) {\n        return name in this._outputs;\n    }\n    registerOutput(name, output) {\n        if (this.hasOutput(name)) {\n            throw new Error(\"Output property \" + name + \" already registered\");\n        }\n        const newOutput = new OutputProperty({\n            owner: this,\n            getter: output.get || output.getter,\n            name: name,\n            onFirstConnectionAdded: output.onFirstConnectionAdded,\n            onLastConnectionRemoved: output.onLastConnectionRemoved,\n        });\n        this._outputs[name] = newOutput;\n        this._outputList.push(newOutput);\n    }\n    deregisterOutput(name) {\n        if (this.hasOutput(name) === false) {\n            throw new Error(\"Output property \" + name + \" isn't registered\");\n        }\n        const output = this._outputs[name];\n        if (output.hasConnections()) {\n            throw new Error(\"Output property \" + name + \" has connections and can't be removed\");\n        }\n        delete this._outputs[name];\n        const index = this._outputList.indexOf(output);\n        this._outputList.splice(index, 1);\n    }\n    registerOutputs(outputs) {\n        for (const name in outputs) {\n            this.registerOutput(name, outputs[name]);\n        }\n    }\n    registerOutputIfNeeded() {\n        //noop, can be overriden by subclasses\n    }\n    getOutput(name) {\n        if (this.hasOutput(name) === false) {\n            throw new Error(\"Node \" + this.name + \" doesn't have a port named \" + name);\n        }\n        return this._outputs[name];\n    }\n    connectInput(inputName, sourceNode, sourcePortName) {\n        if (this.hasInput(inputName) === false) {\n            throw new Error(\"Invalid connection, input doesn't exist. Trying to connect from \" +\n                sourceNode.name +\n                \" output \" +\n                sourcePortName +\n                \" to \" +\n                this.name +\n                \" input \" +\n                inputName);\n        }\n        const sourcePort = sourceNode.getOutput(sourcePortName);\n        sourcePort.registerConnection(this, inputName);\n        if (!this._inputConnections[inputName]) {\n            this._inputConnections[inputName] = [];\n        }\n        this._inputConnections[inputName].push(sourcePort);\n        if (sourceNode._signalsSentThisUpdate[sourcePortName]) {\n            this._setValueFromConnection(inputName, true);\n            this._setValueFromConnection(inputName, false);\n        }\n        else {\n            const outputValue = sourcePort.value;\n            if (outputValue !== undefined) {\n                this._setValueFromConnection(inputName, outputValue);\n                if (this.context) {\n                    // Send value to editor for connection debugging.\n                    // Conceptually the value has already been sent,\n                    // but the editor needs to be notified after a connection is created\n                    this.context.connectionSentValue(sourcePort, sourcePort.value);\n                }\n            }\n        }\n        this.flagDirty();\n    }\n    removeInputConnection(inputName, sourceNodeId, sourcePortName) {\n        if (!this._inputConnections[inputName]) {\n            throw new Error(\"Node removeInputConnection: Input doesn't exist\");\n        }\n        const inputsToPort = this._inputConnections[inputName];\n        for (let i = 0; i < inputsToPort.length; i++) {\n            const sourcePort = inputsToPort[i];\n            if (sourcePort.owner.id === sourceNodeId &&\n                sourcePort.name === sourcePortName) {\n                inputsToPort.splice(i, 1);\n                //remove the output from the source node\n                const output = sourcePort.owner.getOutput(sourcePortName);\n                output.deregisterConnection(this, inputName);\n                break;\n            }\n        }\n        if (inputsToPort.length === 0) {\n            //no inputs left, remove the bookkeeping that traces values sent to this node as inputs\n            delete this._valuesFromConnections[inputName];\n        }\n    }\n    isInputConnected(inputName) {\n        if (!this._inputConnections.hasOwnProperty(inputName)) {\n            return false;\n        }\n        //We have connections, but they might be from non-connected component inputs.\n        // If they are from a component input then check the input on the component instance.\n        return this._inputConnections[inputName].some((c) => {\n            var _a;\n            //if this is not a component input, then we have a proper connection\n            if (c.owner.name !== \"Component Inputs\")\n                return true;\n            //the name of the output from the component input, is the same as the component instance input\n            const component = (_a = c.owner.nodeScope) === null || _a === void 0 ? void 0 : _a.componentOwner;\n            return component === null || component === void 0 ? void 0 : component.isInputConnected(c.name);\n        });\n    }\n    update() {\n        var _a, _b, _c, _d;\n        if (this._isUpdating || this._dirty === false) {\n            return;\n        }\n        if (this._updatedAtIteration !== this.context.updateIteration) {\n            this._updatedAtIteration = this.context.updateIteration;\n            this._updateIteration = 0;\n            if (this._cyclicLoop)\n                this._cyclicLoop = false;\n        }\n        this._isUpdating = true;\n        const maxUpdateIterations = 100;\n        try {\n            while (this._dirty && !this._cyclicLoop) {\n                this._updateDependencies();\n                //all inputs are now updated, flag as not dirty\n                this._dirty = false;\n                const inputNames = Object.keys(this._inputValuesQueue);\n                let hasMoreInputs = true;\n                while (hasMoreInputs && !this._cyclicLoop) {\n                    hasMoreInputs = false;\n                    for (let i = 0; i < inputNames.length; i++) {\n                        const inputName = inputNames[i];\n                        const queue = this._inputValuesQueue[inputName];\n                        if (queue.length > 0) {\n                            this.setInputValue(inputName, queue.shift());\n                            if (queue.length > 0) {\n                                hasMoreInputs = true;\n                            }\n                        }\n                    }\n                    const afterInputCallbacks = this._afterInputsHaveUpdatedCallbacks;\n                    this._afterInputsHaveUpdatedCallbacks = [];\n                    for (let i = 0; i < afterInputCallbacks.length; i++) {\n                        afterInputCallbacks[i].call(this);\n                    }\n                }\n                this._updateIteration++;\n                if (this._updateIteration >= maxUpdateIterations) {\n                    this._cyclicLoop = true;\n                }\n            }\n        }\n        catch (e) {\n            this._isUpdating = false;\n            throw e;\n        }\n        if (this._cyclicLoop) {\n            //flag the node as dirty again to let it contiune next frame so we don't just stop it\n            //This will allow the browser a chance to render and run other code\n            this.context.scheduleNextFrame(() => {\n                this.context.nodeIsDirty(this);\n            });\n            if (this.context.editorConnection &&\n                !this._cyclicWarningSent &&\n                this.context.isWarningTypeEnabled(\"cyclicLoops\")) {\n                this.context.editorConnection.sendWarning((_b = (_a = this.nodeScope) === null || _a === void 0 ? void 0 : _a.componentOwner) === null || _b === void 0 ? void 0 : _b.name, this.id, \"cyclic-loop\", {\n                    showGlobally: true,\n                    message: \"Cyclic loop detected\",\n                });\n                this._cyclicWarningSent = true;\n                console.log(\"cycle detected\", {\n                    id: this.id,\n                    name: this.name,\n                    component: (_d = (_c = this.nodeScope) === null || _c === void 0 ? void 0 : _c.componentOwner) === null || _d === void 0 ? void 0 : _d.name,\n                });\n            }\n        }\n        this._isFirstUpdate = false;\n        this._isUpdating = false;\n    }\n    _updateDependencies() {\n        for (const inputName in this._inputConnections) {\n            const connectedPorts = this._inputConnections[inputName];\n            for (let i = 0; i < connectedPorts.length; ++i) {\n                connectedPorts[i].owner.update();\n            }\n        }\n    }\n    flagDirty() {\n        if (this._dirty) {\n            return;\n        }\n        this._dirty = true;\n        //a hack to not update nodes as a component is being created.\n        //Nodes should update once all connections are in place, so inputs that rely on connections, e.g. \"Run\" on a Function node, have the correct context before running.\n        //This flag is being updated externally by the NodeScope and _performDirtyUpdate will be called when the component setup is done\n        if (this.updateOnDirtyFlagging) {\n            this._performDirtyUpdate();\n        }\n    }\n    _performDirtyUpdate() {\n        this.context && this.context.nodeIsDirty(this);\n        for (let i = 0; i < this._outputList.length; ++i) {\n            this._outputList[i].flagDependeesDirty();\n        }\n    }\n    sendValue(name, value) {\n        if (this.hasOutput(name) === false) {\n            console.log(\"Error: Node\", this.name, \"doesn't have a output named\", name);\n            return;\n        }\n        if (value === undefined) {\n            return;\n        }\n        const output = this.getOutput(name);\n        output.sendValue(value);\n        if (this.context) {\n            this.context.connectionSentValue(output, value);\n        }\n    }\n    flagOutputDirty(name) {\n        const output = this.getOutput(name);\n        this.sendValue(name, output.value);\n    }\n    flagAllOutputsDirty() {\n        for (const output of this._outputList) {\n            this.sendValue(output.name, output.value);\n        }\n    }\n    sendSignalOnOutput(outputName) {\n        if (this.hasOutput(outputName) === false) {\n            console.log(\"Error: Node\", this.name, \"doesn't have a output named\", outputName);\n            return;\n        }\n        const output = this.getOutput(outputName);\n        output.sendValue(true);\n        output.sendValue(false);\n        this._signalsSentThisUpdate[outputName] = true;\n        this.scheduleAfterInputsHaveUpdated(function () {\n            this._signalsSentThisUpdate[outputName] = false;\n        });\n        if (this.context) {\n            this.context.connectionSentSignal(output);\n        }\n    }\n    _setValueFromConnection(inputName, value) {\n        this._valuesFromConnections[inputName] = value;\n        this.queueInput(inputName, value);\n    }\n    _hasInputBeenSetFromAConnection(inputName) {\n        return this._valuesFromConnections.hasOwnProperty(inputName);\n    }\n    queueInput(inputName, value) {\n        if (!this._inputValuesQueue[inputName]) {\n            this._inputValuesQueue[inputName] = [];\n        }\n        //when values are queued during the very first update, make the last value overwrite previous ones\n        //so a chain with multiple nodes with values that connect to each other all\n        //consolidate to a single value, instead of piling up in the queue\n        if (this._isFirstUpdate) {\n            //signals need two values, so make sure we don't suppress the 'false' that comes directly\n            //after a 'true'\n            const queueValue = this._inputValuesQueue[inputName][0];\n            const isSignal = queueValue === true; // && value === true;\n            if (!isSignal) {\n                //default units are set as an object {value, unit}\n                //subsequent inputs can be unitless. and will will then overwrite those\n                //and the node will get a value without ever getting a unit.\n                //To make sure that doesn't happen, look at the value being overwritten\n                //and use the unit from that before overwriting\n                if (queueValue instanceof Object &&\n                    queueValue.unit &&\n                    value instanceof Object === false) {\n                    value = {\n                        value,\n                        unit: queueValue.unit,\n                    };\n                }\n                this._inputValuesQueue[inputName].length = 0;\n            }\n        }\n        this._inputValuesQueue[inputName].push(value);\n        this.flagDirty();\n    }\n    scheduleAfterInputsHaveUpdated(callbackFn) {\n        this._afterInputsHaveUpdatedCallbacks.push(callbackFn);\n        this.flagDirty();\n    }\n    setNodeModel(nodeModel) {\n        this.model = nodeModel;\n        nodeModel.on(\"parameterUpdated\", this._onNodeModelParameterUpdated, this);\n        nodeModel.on(\"variantUpdated\", this._onNodeModelVariantUpdated, this);\n        nodeModel.on(\"inputPortRemoved\", (port) => {\n            if (this.hasInput(port.name)) {\n                this.deregisterInput(port.name);\n            }\n        }, this);\n        nodeModel.on(\"outputPortRemoved\", (port) => {\n            if (this.hasOutput(port.name)) {\n                this.deregisterOutput(port.name);\n            }\n        }, this);\n    }\n    addDeleteListener(listener) {\n        this._deleteListeners.push(listener);\n    }\n    /*protected*/ _onNodeDeleted() {\n        if (this.model) {\n            this.model.removeListenersWithRef(this);\n            this.model = undefined;\n        }\n        this._deleted = true;\n        for (const deleteListener of this._deleteListeners) {\n            deleteListener.call(this);\n        }\n    }\n    _onNodeModelParameterUpdated(event) {\n        var _a;\n        this.registerInputIfNeeded(event.name);\n        if (event.value !== undefined) {\n            if (event.state) {\n                //this parameter is only used in a certain visual state\n                //make sure we are in that state before setting it\n                if (!this._getVisualStates) {\n                    console.log(\"Node has nos visual states, but got a parameter for state\", event.state);\n                    return;\n                }\n                const states = this._getVisualStates();\n                if (states.indexOf(event.state) !== -1) {\n                    this.queueInput(event.name, event.value);\n                }\n            }\n            else {\n                this.queueInput(event.name, event.value);\n            }\n        }\n        else {\n            //parameter is undefined, that means it has been removed and we should reset to default\n            let defaultValue;\n            const variant = this.variant;\n            if (typeof variant === \"object\") {\n                if (event.state) {\n                    //local value has been reset, check the variant first\n                    if (variant &&\n                        variant.stateParameters.hasOwnProperty(event.state) &&\n                        variant.stateParameters[event.state].hasOwnProperty(event.name)) {\n                        defaultValue = variant.stateParameters[event.state][event.name];\n                    }\n                    //and if variant has no value in that state, check for local values in the neutral state\n                    else if ((_a = this.model) === null || _a === void 0 ? void 0 : _a.parameters.hasOwnProperty(event.name)) {\n                        defaultValue = this.model.parameters[event.name];\n                    }\n                    //and then look in the variant neutral values\n                    else if (variant && variant.parameters.hasOwnProperty(event.name)) {\n                        defaultValue = variant.parameters[event.name];\n                    }\n                }\n                else if (variant && variant.parameters.hasOwnProperty(event.name)) {\n                    defaultValue = variant.parameters[event.name];\n                }\n            }\n            if (defaultValue === undefined) {\n                //get the default value for the port\n                defaultValue = this.context.getDefaultValueForInput(this.model.type, event.name);\n                //when a paramter that's used by a text style is reset, Noodl will modify the original dom node, outside of React\n                //React will then re-render, and should apply the values from the text style, but won't see any delta in the virtual dom,\n                //even though there is a diff to the real dom.\n                //to fix that, we just force React to re-render the entire node\n                this._resetReactVirtualDOM && this._resetReactVirtualDOM();\n            }\n            this.queueInput(event.name, defaultValue);\n        }\n    }\n    _onNodeModelVariantUpdated(variant) {\n        this.setVariant(variant);\n    }\n    setVariant(variant) {\n        this.variant = variant;\n    }\n}\n\n//this just assumes the base url is '/' always\nfunction getAbsoluteUrl(_url) {\n    if (_url === null || _url === undefined || _url === \"\") {\n        return window.Noodl.baseUrl || \"/\";\n    }\n    //convert to string in case the _url is a Cloud File (which is an object with a custom toString())\n    const url = String(_url);\n    //only add a the base url if this is a local URL (e.g. not a https url or  base64 string)\n    if (!url ||\n        url[0] === \"/\" ||\n        url.includes(\"://\") ||\n        url.startsWith(\"data:\")) {\n        return url;\n    }\n    return (window.Noodl.baseUrl || \"/\") + url;\n}\n/**\n * Log an error thrown by the JavaScript nodes.\n */\nfunction logJavaScriptNodeError(error) {\n    if (typeof error === \"string\") {\n        console.log(\"Error in JS node run code.\", error);\n    }\n    else if (error instanceof Error) {\n        console.log(\"Error in JS node run code.\", Object.getPrototypeOf(error).constructor.name + \": \" + error.message, error.stack);\n    }\n}\n//adapted from http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript\nfunction guid() {\n    function s4() {\n        return Math.floor((1 + Math.random()) * 0x10000)\n            .toString(16)\n            .substring(1);\n    }\n    return (s4() +\n        s4() +\n        \"-\" +\n        s4() +\n        \"-\" +\n        s4() +\n        \"-\" +\n        s4() +\n        \"-\" +\n        s4() +\n        s4() +\n        s4());\n}\nfunction randomString(size) {\n    if (size === 0) {\n        throw new Error(\"Zero-length randomString is useless.\");\n    }\n    const chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" + \"abcdefghijklmnopqrstuvwxyz\" + \"0123456789\";\n    let objectId = \"\";\n    for (let i = 0; i < size; ++i) {\n        objectId += chars[Math.floor((1 + Math.random()) * 0x10000) % chars.length];\n    }\n    return objectId;\n}\n\nclass NodeScope {\n    constructor(context, componentOwner) {\n        this.context = context;\n        this.nodes = {};\n        this.componentOwner = componentOwner; //Component Instance that owns this NodeScope\n        this.componentInstanceChildren = {};\n    }\n    verifyData(data, requiredKeys) {\n        requiredKeys.forEach((key) => {\n            if (!data[key]) {\n                throw new Error(\"Missing \" + key);\n            }\n        });\n    }\n    addConnection(connectionData) {\n        try {\n            this.verifyData(connectionData, [\n                \"sourceId\",\n                \"sourcePort\",\n                \"targetId\",\n                \"targetPort\",\n            ]);\n        }\n        catch (e) {\n            // @ts-expect-error\n            throw new Error(\"Error in connection: \" + e.message);\n        }\n        try {\n            const sourceNode = this.getNodeWithId(connectionData.sourceId);\n            const targetNode = this.getNodeWithId(connectionData.targetId);\n            targetNode.registerInputIfNeeded(connectionData.targetPort);\n            sourceNode.registerOutputIfNeeded(connectionData.sourcePort);\n            targetNode.connectInput(connectionData.targetPort, sourceNode, connectionData.sourcePort);\n        }\n        catch (e) {\n            // @ts-expect-error\n            console.error(e.message);\n        }\n    }\n    setNodeParameters(node, nodeModel) {\n        const variant = this.context.variants.getVariant(nodeModel.type, \n        // @ts-expect-error WTF is this codebase?\n        nodeModel.variant);\n        if (variant) {\n            //apply the variant (this will also apply the parameters)\n            node.setVariant(variant);\n        }\n        else {\n            const parameters = nodeModel.parameters || {};\n            let inputNames = Object.keys(parameters);\n            if (this.context.nodeRegister.hasNode(node.name)) {\n                const metadata = this.context.nodeRegister.getNodeMetadata(node.name);\n                if (metadata.inputs) {\n                    inputNames.sort((a, b) => {\n                        var _a, _b;\n                        const inputA = metadata.inputs[a];\n                        const inputB = metadata.inputs[b];\n                        return ((_a = inputB === null || inputB === void 0 ? void 0 : inputB.inputPriority) !== null && _a !== void 0 ? _a : 0) - ((_b = inputA === null || inputA === void 0 ? void 0 : inputA.inputPriority) !== null && _b !== void 0 ? _b : 0);\n                    });\n                }\n            }\n            inputNames.forEach((inputName) => {\n                node.registerInputIfNeeded(inputName);\n                //protect against obsolete parameters\n                if (node.hasInput(inputName) === false) {\n                    return;\n                }\n                node.queueInput(inputName, parameters[inputName]);\n            });\n        }\n    }\n    async createNodeFromModel(nodeModel, updateOnDirtyFlagging) {\n        if (nodeModel.type === \"Component Children\") {\n            if (nodeModel.parent) {\n                const parentInstance = this.getNodeWithId(nodeModel.parent.id);\n                this.componentOwner.setChildRoot(parentInstance);\n            }\n            return;\n        }\n        let node;\n        try {\n            node = await this.createNode(nodeModel.type, nodeModel.id);\n            node.updateOnDirtyFlagging =\n                updateOnDirtyFlagging === false ? false : true;\n            node.setNodeModel(nodeModel);\n        }\n        catch (e) {\n            // @ts-expect-error\n            console.error(e.message);\n            if (this.context.editorConnection &&\n                this.context.isWarningTypeEnabled(\"nodescope\")) {\n                this.context.editorConnection.sendWarning(this.componentOwner.name, nodeModel.id, \"nodelibrary-unknown-node\", {\n                    // @ts-expect-error\n                    message: e.message,\n                    showGlobally: true,\n                });\n            }\n            return;\n        }\n        if (nodeModel.variant && node.setVariant)\n            node.setVariant(nodeModel.variant);\n        this.setNodeParameters(node, nodeModel);\n        if (nodeModel.parent) {\n            this.insertNodeInTree(node, nodeModel);\n        }\n        return node;\n    }\n    insertNodeInTree(nodeInstance, nodeModel) {\n        if (!nodeModel.parent) {\n            throw new Error(\"Cannot insert node without parent\");\n        }\n        const parentInstance = this.getNodeWithId(nodeModel.parent.id);\n        const childIndex = nodeModel.parent.children.indexOf(nodeModel);\n        if (!parentInstance.addChild) {\n            throw new Error(\"Node \" +\n                parentInstance.id +\n                \" of type \" +\n                parentInstance.constructor.name +\n                \" can't have children\");\n        }\n        parentInstance.addChild(nodeInstance, childIndex);\n    }\n    getNodeWithId(id) {\n        if (!this.nodes.hasOwnProperty(id)) {\n            throw new Error(\"Unknown node id \" + id);\n        }\n        return this.nodes[id];\n    }\n    hasNodeWithId(id) {\n        return this.nodes.hasOwnProperty(id);\n    }\n    createPrimitiveNode(name, id, extraProps) {\n        if (!id)\n            id = guid();\n        if (this.nodes.hasOwnProperty(id)) {\n            throw Error(\"duplicate id \" + id);\n        }\n        const node = this.context.nodeRegister.createNode(name, id, this);\n        if (extraProps) {\n            for (const prop in extraProps) {\n                node[prop] = extraProps[prop];\n            }\n        }\n        this.nodes[id] = node;\n        return node;\n    }\n    async createNode(name, id, extraProps) {\n        if (!id)\n            id = guid();\n        if (this.nodes.hasOwnProperty(id)) {\n            throw Error(\"duplicate id \" + id);\n        }\n        let node;\n        if (this.context.nodeRegister.hasNode(name)) {\n            node = this.context.nodeRegister.createNode(name, id, this);\n            if (extraProps) {\n                for (const prop in extraProps) {\n                    node[prop] = extraProps[prop];\n                }\n            }\n        }\n        else {\n            node = await this.context.createComponentInstanceNode(name, id, this, extraProps);\n            this.componentInstanceChildren[id] = node;\n        }\n        this.nodes[id] = node;\n        return node;\n    }\n    getNodesWithIdRecursive(id) {\n        function findNodesWithIdRec(scope, id, result) {\n            if (scope.nodes.hasOwnProperty(id)) {\n                result.push(scope.nodes[id]);\n            }\n            const componentIds = Object.keys(scope.nodes).filter((nodeId) => {\n                return scope.nodes[nodeId] instanceof ComponentInstanceNode;\n            });\n            componentIds.forEach((componentId) => {\n                const nodeScope = scope.nodes[componentId].nodeScope;\n                if (nodeScope) {\n                    findNodesWithIdRec(nodeScope, id, result);\n                }\n            });\n        }\n        const result = [];\n        findNodesWithIdRec(this, id, result);\n        return result;\n    }\n    getNodesWithType(name) {\n        const ids = Object.keys(this.nodes).filter((id) => {\n            return this.nodes[id].name === name;\n        });\n        return ids.map((id) => {\n            return this.nodes[id];\n        });\n    }\n    getNodesWithTypeRecursive(name) {\n        let result = [];\n        const findNodesWithTypeRec = () => {\n            result = result.concat(this.getNodesWithType(name));\n            const componentIds = Object.keys(this.nodes).filter((nodeId) => {\n                return this.nodes[nodeId] instanceof ComponentInstanceNode;\n            });\n            componentIds.forEach((componentId) => {\n                const node = this.nodes[componentId];\n                if (node && node.nodeScope) {\n                    const res = node.nodeScope.getNodesWithTypeRecursive(name);\n                    result = result.concat(res);\n                }\n            });\n        };\n        findNodesWithTypeRec();\n        return result;\n    }\n    getAllNodesRecursive() {\n        let result = [];\n        const getAllNodesRec = () => {\n            result = result.concat(Object.values(this.nodes));\n            const componentIds = Object.keys(this.nodes).filter((nodeId) => {\n                return this.nodes[nodeId] instanceof ComponentInstanceNode;\n            });\n            componentIds.forEach((componentId) => {\n                const node = this.nodes[componentId];\n                if (node && node.nodeScope) {\n                    const res = node.nodeScope.getAllNodesRecursive();\n                    result = result.concat(res);\n                }\n            });\n        };\n        getAllNodesRec();\n        return result;\n    }\n    getAllNodesWithVariantRecursive(variant) {\n        const nodes = this.getAllNodesRecursive();\n        return nodes.filter((node) => node.variant === variant);\n    }\n    onNodeModelRemoved(nodeModel) {\n        const nodeInstance = this.getNodeWithId(nodeModel.id);\n        if (nodeModel.parent) {\n            const parentInstance = this.getNodeWithId(nodeModel.parent.id);\n            parentInstance.removeChild(nodeInstance);\n        }\n        nodeInstance._onNodeDeleted();\n        delete this.nodes[nodeInstance.id];\n        delete this.componentInstanceChildren[nodeInstance.id];\n    }\n    removeConnection(connectionModel) {\n        const targetNode = this.getNodeWithId(connectionModel.targetId);\n        targetNode.removeInputConnection(connectionModel.targetPort, connectionModel.sourceId, connectionModel.sourcePort);\n    }\n    async setComponentModel(componentModel) {\n        var _a;\n        this.componentModel = componentModel;\n        const nodes = [];\n        //create all nodes\n        for (const nodeModel of componentModel.getAllNodes()) {\n            const node = await this.createNodeFromModel(nodeModel, false);\n            if (node)\n                nodes.push(node);\n        }\n        componentModel\n            .getAllConnections()\n            .forEach((conn) => this.addConnection(conn));\n        //now that all nodes and connections are setup, trigger the dirty flagging so nodes can run with all the connections in place\n        nodes.forEach((node) => (node.updateOnDirtyFlagging = true));\n        nodes.forEach((node) => {\n            if (node._dirty) {\n                node._performDirtyUpdate();\n            }\n        });\n        componentModel.on(\"connectionAdded\", (conn) => this.addConnection(conn), this);\n        componentModel.on(\"connectionRemoved\", this.removeConnection, this);\n        componentModel.on(\"nodeAdded\", this.createNodeFromModel, this);\n        componentModel.on(\"nodeParentWillBeRemoved\", (nodeModel) => {\n            if (nodeModel.type === \"Component Children\") {\n                if (nodeModel.parent) {\n                    this.componentOwner.setChildRoot(null);\n                }\n                return;\n            }\n            const nodeInstance = this.getNodeWithId(nodeModel.id);\n            if (nodeInstance.parent) {\n                nodeInstance.parent.removeChild(nodeInstance);\n            }\n        }, this);\n        componentModel.on(\"nodeParentUpdated\", (nodeModel) => {\n            if (nodeModel.type === \"Component Children\") {\n                const parentInstance = nodeModel.parent\n                    ? this.getNodeWithId(nodeModel.parent.id)\n                    : null;\n                this.componentOwner.setChildRoot(parentInstance);\n            }\n            else {\n                const nodeInstance = this.getNodeWithId(nodeModel.id);\n                this.insertNodeInTree(nodeInstance, nodeModel);\n            }\n        }, this);\n        componentModel.on(\"nodeRemoved\", (nodeModel) => {\n            if (nodeModel.type !== \"Component Children\") {\n                this.onNodeModelRemoved(nodeModel);\n            }\n        }, this);\n        for (const id in this.nodes) {\n            const node = this.nodes[id];\n            (_a = node === null || node === void 0 ? void 0 : node.nodeScopeDidInitialize) === null || _a === void 0 ? void 0 : _a.call(node);\n        }\n    }\n    reset() {\n        if (this.componentModel) {\n            this.componentModel.removeListenersWithRef(this);\n            this.componentModel = undefined;\n        }\n        Object.keys(this.nodes).forEach((id) => {\n            if (this.nodes.hasOwnProperty(id)) {\n                this.deleteNode(this.nodes[id]);\n            }\n        });\n    }\n    deleteNode(nodeInstance) {\n        if (!this.nodes.hasOwnProperty(nodeInstance.id)) {\n            console.error(\"Node doesn't belong to this scope\", nodeInstance.id, nodeInstance.name);\n            return;\n        }\n        if (nodeInstance.parent) {\n            nodeInstance.parent.removeChild(nodeInstance);\n        }\n        //depth first\n        if (nodeInstance.getChildren) {\n            nodeInstance.getChildren().forEach((child) => {\n                nodeInstance.removeChild(child);\n                //the child might be created in a different scope\n                //if the child is a component instance, we want its parent scope, not the inner scope\n                const nodeScope = child.parentNodeScope || child.nodeScope;\n                nodeScope.deleteNode(child);\n            });\n        }\n        if (this.componentModel) {\n            const connectionFrom = this.componentModel.getConnectionsFrom(nodeInstance.id);\n            const connectionTo = this.componentModel.getConnectionsTo(nodeInstance.id);\n            connectionFrom.concat(connectionTo).forEach((connection) => {\n                if (this.nodes.hasOwnProperty(connection.targetId) &&\n                    this.nodes.hasOwnProperty(connection.sourceId)) {\n                    this.removeConnection(connection);\n                }\n            });\n        }\n        nodeInstance._onNodeDeleted();\n        delete this.nodes[nodeInstance.id];\n        delete this.componentInstanceChildren[nodeInstance.id]; //in case this is a component\n    }\n    sendEventFromThisScope(eventName, data, propagation, sendEventInThisScope) {\n        var _a, _b;\n        if (sendEventInThisScope) {\n            const eventReceivers = this.getNodesWithType(\"Event Receiver\").filter((eventReceiver) => {\n                // @ts-expect-error TODO: fix this\n                return eventReceiver.getChannelName() === eventName;\n            });\n            for (let i = 0; i < eventReceivers.length; i++) {\n                // @ts-expect-error TODO: fix this\n                const consumed = eventReceivers[i].handleEvent(data);\n                if (consumed)\n                    return true;\n            }\n        }\n        if (propagation === \"parent\" && this.componentOwner.parentNodeScope) {\n            // Send event to parent scope\n            //either the scope of the visual parent if there is one, otherwise the parent component\n            const parentNodeScope = this.componentOwner.parent\n                ? this.componentOwner.parent.nodeScope\n                : this.componentOwner.parentNodeScope;\n            if (!parentNodeScope)\n                return false;\n            return parentNodeScope.sendEventFromThisScope(eventName, data, propagation, true);\n        }\n        else if (propagation === \"children\") {\n            // Send event to all child scopes\n            const nodes = this.nodes;\n            for (const nodeId in nodes) {\n                const children = nodes[nodeId].children;\n                if (children)\n                    for (const child of children) {\n                        if (child.name &&\n                            this.context.hasComponentModelWithName(child.name)) {\n                            // This is a component instance child\n                            const consumed = (_a = child.nodeScope) === null || _a === void 0 ? void 0 : _a.sendEventFromThisScope(eventName, data, propagation, true);\n                            if (consumed)\n                                return true;\n                        }\n                    }\n            }\n        }\n        else if (propagation === \"siblings\") {\n            // Send event to all siblings, that is all children of the parent scope except this scope\n            let parentNodeScope;\n            if (this.componentOwner.parent) {\n                parentNodeScope = this.componentOwner.parent.nodeScope;\n            }\n            else {\n                parentNodeScope = this.componentOwner.parentNodeScope;\n            }\n            if (!parentNodeScope)\n                return false;\n            const nodes = parentNodeScope.nodes;\n            for (const nodeId in nodes) {\n                const children = nodes[nodeId].children;\n                if (children) {\n                    const _c = children.filter((child) => child.name &&\n                        this.context.hasComponentModelWithName(child.name) &&\n                        child.nodeScope !== this);\n                    for (const child of _c) {\n                        const consumed = (_b = child.nodeScope) === null || _b === void 0 ? void 0 : _b.sendEventFromThisScope(eventName, data, undefined, true);\n                        if (consumed)\n                            return true;\n                    }\n                }\n            }\n        }\n        return false;\n    }\n}\n\nlet componentIdCounter = 0;\nclass ComponentInstanceNode extends Node {\n    constructor(context, id, parentNodeScope) {\n        super(context, id);\n        this.nodeScope = new NodeScope(context, this);\n        this.parentNodeScope = parentNodeScope;\n        this._internal = {\n            childRoot: null,\n            componentOutputValues: {},\n            componentOutputs: [],\n            componentInputs: [],\n            inputValues: {},\n            roots: [],\n            instanceId: \"__$ndl_componentInstaceId\" + componentIdCounter,\n        };\n        this.nodeScope.modelScope = parentNodeScope\n            ? parentNodeScope.modelScope\n            : undefined;\n        componentIdCounter++;\n    }\n    async setComponentModel(componentModel) {\n        this.componentModel = componentModel;\n        const self = this;\n        await this.nodeScope.setComponentModel(componentModel);\n        this._internal.componentInputs =\n            this.nodeScope.getNodesWithType(\"Component Inputs\");\n        this._internal.componentOutputs =\n            this.nodeScope.getNodesWithType(\"Component Outputs\");\n        Object.values(componentModel.getInputPorts()).forEach(this.registerComponentInputPort.bind(this));\n        Object.values(componentModel.getOutputPorts()).forEach(this.registerComponentOutputPort.bind(this));\n        const roots = componentModel.roots || [];\n        this._internal.roots = roots.map((id) => this.nodeScope.getNodeWithId(id));\n        componentModel.on(\"rootAdded\", (id) => {\n            this._internal.roots.push(this.nodeScope.getNodeWithId(id));\n            this.forceUpdate();\n        }, this);\n        componentModel.on(\"rootRemoved\", function (id) {\n            const index = this._internal.roots.findIndex((root) => root.id === id);\n            if (index !== -1) {\n                this._internal.roots.splice(index, 1);\n            }\n            this.forceUpdate();\n        }, this);\n        componentModel.on(\"inputPortAdded\", this.registerComponentInputPort.bind(this), this);\n        componentModel.on(\"outputPortAdded\", this.registerComponentOutputPort.bind(this), this);\n        componentModel.on(\"inputPortRemoved\", function (port) {\n            if (self.hasInput(port.name)) {\n                self.deregisterInput(port.name);\n            }\n        }, this);\n        componentModel.on(\"outputPortRemoved\", function (port) {\n            if (this.hasOutput(port.name)) {\n                self.deregisterOutput(port.name);\n            }\n        }, this);\n        componentModel.on(\"nodeAdded\", function (node) {\n            if (node.type === \"Component Inputs\") {\n                self._internal.componentInputs.push(self.nodeScope.getNodeWithId(node.id));\n            }\n            else if (node.type === \"Component Outputs\") {\n                self._internal.componentOutputs.push(self.nodeScope.getNodeWithId(node.id));\n            }\n        }, this);\n        componentModel.on(\"nodeRemoved\", function (node) {\n            function removeNodesWithId(array, id) {\n                return array.filter((e) => e.id !== id);\n            }\n            if (node.type === \"Component Inputs\") {\n                self._internal.componentInputs = removeNodesWithId(self._internal.componentInputs, node.id);\n            }\n            else if (node.type === \"Component Outputs\") {\n                self._internal.componentOutputs = removeNodesWithId(self._internal.componentOutputs, node.id);\n            }\n        }, this);\n        componentModel.on(\"renamed\", function (event) {\n            self.name = event.newName;\n        }, this);\n    }\n    _onNodeDeleted() {\n        if (this.componentModel) {\n            this.componentModel.removeListenersWithRef(this);\n            this.componentModel = undefined;\n        }\n        this.nodeScope.reset();\n        super._onNodeDeleted();\n    }\n    registerComponentInputPort(port) {\n        this.registerInput(port.name, {\n            set: function (value) {\n                this._internal.inputValues[port.name] = value;\n                this._internal.componentInputs.forEach(function (componentInput) {\n                    componentInput.registerOutputIfNeeded(port.name);\n                    componentInput.flagOutputDirty(port.name);\n                });\n            },\n        });\n    }\n    registerComponentOutputPort(port) {\n        this.registerOutput(port.name, {\n            getter() {\n                return this._internal.componentOutputValues[port.name];\n            },\n        });\n    }\n    setOutputFromComponentOutput(name, value) {\n        var _a, _b;\n        if (this.hasOutput(name) === false) {\n            return;\n        }\n        (_b = (_a = this._internal.creatorCallbacks) === null || _a === void 0 ? void 0 : _a.onOutputChanged) === null || _b === void 0 ? void 0 : _b.call(_a, name, value, this._internal.componentOutputValues[name]);\n        this._internal.componentOutputValues[name] = value;\n        this.flagOutputDirty(name);\n    }\n    setChildRoot(node) {\n        const prevChildRoot = this._internal.childRoot;\n        const newChildRoot = node;\n        this._internal.childRoot = newChildRoot;\n        if (this.model && this.model.children) {\n            const parentNodeScope = this.parentNodeScope;\n            const children = this.model.children\n                .filter((child) => child.type !== \"Component Children\")\n                .map((child) => parentNodeScope === null || parentNodeScope === void 0 ? void 0 : parentNodeScope.getNodeWithId(child.id));\n            if (prevChildRoot) {\n                for (let i = 0; i < children.length; i++) {\n                    if (prevChildRoot.isChild(children[i])) {\n                        prevChildRoot.removeChild(children[i]);\n                    }\n                }\n            }\n            if (newChildRoot) {\n                for (let i = 0; i < children.length; i++) {\n                    const child = children[i];\n                    const index = child.model.parent.children.indexOf(child.model);\n                    this.addChild(child, index);\n                }\n            }\n        }\n    }\n    getChildRootIndex() {\n        var _a, _b;\n        if (!((_b = (_a = this._internal.childRoot) === null || _a === void 0 ? void 0 : _a.model) === null || _b === void 0 ? void 0 : _b.children)) {\n            return 0;\n        }\n        const children = this._internal.childRoot.model.children;\n        for (let i = 0; i < children.length; i++) {\n            if (children[i].type === \"Component Children\") {\n                return i;\n            }\n        }\n        return 0;\n    }\n    getChildRoot() {\n        if (this._internal.childRoot) {\n            return this._internal.childRoot;\n        }\n        return null;\n    }\n    getRoots() {\n        return this._internal.roots;\n    }\n    /** Added for SSR Support */\n    triggerDidMount() {\n        this._internal.roots.forEach((root) => {\n            var _a;\n            (_a = root.triggerDidMount) === null || _a === void 0 ? void 0 : _a.call(root);\n        });\n    }\n    render() {\n        if (this._internal.roots.length === 0) {\n            return null;\n        }\n        return this._internal.roots[0].render();\n    }\n    setChildIndex(childIndex) {\n        // NOTE: setChildIndex can be undefined when it is not a React node,\n        //       but still a visual node like the foreach (Repeater) node.\n        this.getRoots().forEach((root) => { var _a; return (_a = root.setChildIndex) === null || _a === void 0 ? void 0 : _a.call(root, childIndex); });\n    }\n    addChild(child, index) {\n        this.getChildRoot().addChild(child, index + this.getChildRootIndex());\n    }\n    removeChild(child) {\n        this.getChildRoot().removeChild(child);\n    }\n    getChildren() {\n        const childRoot = this.getChildRoot();\n        return childRoot ? childRoot.getChildren() : [];\n    }\n    isChild(child) {\n        if (!this.getChildRoot()) {\n            return false;\n        }\n        return this.getChildRoot().isChild(child);\n    }\n    contains(node) {\n        return this.getRoots().some((root) => { var _a; return (_a = root.contains) === null || _a === void 0 ? void 0 : _a.call(root, node); });\n    }\n    _performDirtyUpdate() {\n        super._performDirtyUpdate();\n        const componentInputs = this._internal.componentInputs;\n        for (let i = 0, len = componentInputs.length; i < len; i++) {\n            componentInputs[i].flagDirty();\n        }\n        this._internal.componentOutputs.forEach(function (componentOutput) {\n            componentOutput.flagDirty();\n        });\n    }\n    getRef() {\n        const root = this._internal.roots[0];\n        return root ? root.getRef() : undefined;\n    }\n    update() {\n        super.update();\n        this._internal.componentOutputs.forEach(function (componentOutput) {\n            componentOutput.update();\n        });\n    }\n    forceUpdate() {\n        if (!this.parent)\n            return;\n        //the parent will need to re-render the roots of this component instance\n        //TODO: make this use a cleaner API, and only invalidate the affected child, instead of all children\n        this.parent.cachedChildren = undefined;\n        this.parent.forceUpdate();\n    }\n    getInstanceId() {\n        return this._internal.instanceId;\n    }\n}\n\nclass NodeContext {\n    constructor(args = {}) {\n        var _a;\n        this.isUpdating = false;\n        const runningInEditor = args.hasOwnProperty(\"runningInEditor\")\n            ? args.runningInEditor\n            : false;\n        this._dirtyNodes = [];\n        this.callbacksAfterUpdate = [];\n        this.graphModel = args.graphModel;\n        this.platform = args.platform;\n        this.eventEmitter = new EventEmitter();\n        // this.eventEmitter.setMaxListeners(1000000);\n        this.eventSenderEmitter = new EventEmitter(); //used by event senders and receivers\n        // this.eventSenderEmitter.setMaxListeners(1000000);\n        this.globalValues = {};\n        this.globalsEventEmitter = new EventEmitter();\n        // this.globalsEventEmitter.setMaxListeners(1000000);\n        this.runningInEditor = !!runningInEditor;\n        this.currentFrameTime = 0;\n        this.frameNumber = 0;\n        this.updateIteration = 0;\n        this.nodeRegister = new NodeRegister(this);\n        this.timerScheduler = new TimerScheduler(this.scheduleUpdate.bind(this));\n        this.componentModels = {};\n        this.debugInspectorsEnabled = false;\n        this.connectionsToPulse = {};\n        this.connectionsToPulseChanged = false;\n        this.debugInspectors = {};\n        this.connectionPulsingCallbackScheduled = false;\n        this.editorConnection = args.editorConnection;\n        this.rootComponent = undefined;\n        this._outputHistory = {};\n        this._signalHistory = {};\n        this.warningTypes = {}; //default is to send all warning types\n        this.bundleFetchesInFlight = new Map();\n        this.variants = new Variants({\n            graphModel: this.graphModel,\n            getNodeScope: () => this.rootComponent ? this.rootComponent.nodeScope : null,\n        });\n        if (this.editorConnection) {\n            this.editorConnection.on(\"debugInspectorsUpdated\", (inspectors) => {\n                this.onDebugInspectorsUpdated(inspectors);\n            });\n            (_a = this.editorConnection) === null || _a === void 0 ? void 0 : _a.on(\"getConnectionValue\", ({ clientId, connectionId, }) => {\n                var _a, _b;\n                if (((_a = this.editorConnection) === null || _a === void 0 ? void 0 : _a.clientId) !== clientId)\n                    return;\n                const connection = this._outputHistory[connectionId];\n                (_b = this.editorConnection) === null || _b === void 0 ? void 0 : _b.sendConnectionValue(connectionId, connection ? connection.value : undefined);\n            });\n        }\n    }\n    setRootComponent(rootComponent) {\n        this.rootComponent = rootComponent;\n    }\n    getCurrentTime() {\n        return this.platform.getCurrentTime();\n    }\n    onDebugInspectorsUpdated(inspectors) {\n        if (!this.debugInspectorsEnabled)\n            return;\n        inspectors = inspectors.map((inspector) => {\n            if (inspector.type === \"connection\" && inspector.connection) {\n                const connection = inspector.connection;\n                inspector.id = connection.fromId + connection.fromProperty;\n            }\n            else if (inspector.type === \"node\" && inspector.nodeId) {\n                inspector.id = inspector.nodeId;\n            }\n            return inspector;\n        });\n        this.debugInspectors = {};\n        inspectors.forEach((inspector) => (this.debugInspectors[inspector.id] = inspector));\n        this.sendDebugInspectorValues();\n    }\n    updateDirtyNodes() {\n        let i, len;\n        let loop = true;\n        let iterations = 0;\n        this.updateIteration++;\n        this.isUpdating = true;\n        while (loop && iterations < 10) {\n            const dirtyNodes = this._dirtyNodes;\n            this._dirtyNodes = [];\n            for (i = 0, len = dirtyNodes.length; i < len; ++i) {\n                try {\n                    if (!dirtyNodes[i]._deleted) {\n                        dirtyNodes[i].update();\n                    }\n                }\n                catch (e) {\n                    console.error(e);\n                }\n            }\n            //make a new reference and reset array in case new callbacks are scheduled\n            //by the current callbacks\n            const callbacks = this.callbacksAfterUpdate;\n            this.callbacksAfterUpdate = [];\n            for (i = 0, len = callbacks.length; i < len; i++) {\n                try {\n                    callbacks[i]();\n                }\n                catch (e) {\n                    console.error(e);\n                }\n            }\n            loop =\n                this.callbacksAfterUpdate.length > 0 || this._dirtyNodes.length > 0;\n            iterations++;\n        }\n        this.isUpdating = false;\n    }\n    update() {\n        this.frameNumber++;\n        this.updateDirtyNodes();\n        if (this.timerScheduler.hasPendingTimers()) {\n            this.scheduleUpdate();\n            this.timerScheduler.runTimers(this.currentFrameTime);\n        }\n        if (this.debugInspectorsEnabled) {\n            this.sendDebugInspectorValues();\n        }\n    }\n    reset() {\n        //removes listeners like device orientation, websockets and more\n        this.eventEmitter.emit(\"applicationDataReloaded\");\n        const eventEmitter = this.eventEmitter;\n        [\"frameStart\", \"frameEnd\"].forEach(function (name) {\n            eventEmitter.removeAllListeners(name);\n        });\n        this.globalValues = {};\n        this._dirtyNodes.length = 0;\n        this.callbacksAfterUpdate.length = 0;\n        this.timerScheduler.runningTimers = [];\n        this.timerScheduler.newTimers = [];\n        this.rootComponent = undefined;\n        this.clearDebugInspectors();\n    }\n    nodeIsDirty(node) {\n        this._dirtyNodes.push(node);\n        this.scheduleUpdate();\n    }\n    scheduleUpdate() {\n        this.eventEmitter.emit(\"scheduleUpdate\");\n    }\n    scheduleAfterUpdate(fn) {\n        this.callbacksAfterUpdate.push(fn);\n        this.scheduleUpdate();\n    }\n    scheduleNextFrame(fn) {\n        this.eventEmitter.once(\"frameStart\", fn);\n        this.scheduleUpdate();\n    }\n    setGlobalValue(name, value) {\n        this.globalValues[name] = value;\n        this.globalsEventEmitter.emit(name);\n    }\n    getGlobalValue(name) {\n        return this.globalValues[name];\n    }\n    registerComponentModel(componentModel) {\n        if (this.componentModels.hasOwnProperty(componentModel.name)) {\n            throw new Error(\"Duplicate component name \" + componentModel.name);\n        }\n        this.componentModels[componentModel.name] = componentModel;\n        componentModel.on(\"renamed\", (event) => {\n            delete this.componentModels[event.oldName];\n            this.componentModels[event.newName] = componentModel;\n        }, this);\n    }\n    deregisterComponentModel(componentModel) {\n        if (this.componentModels.hasOwnProperty(componentModel.name)) {\n            this.componentModels[componentModel.name].removeListenersWithRef(this);\n            delete this.componentModels[componentModel.name];\n        }\n    }\n    async fetchComponentBundle(name) {\n        const fetchBundle = async (name) => {\n            const baseUrl = window.Noodl.Env[\"BaseUrl\"] || \"/\";\n            const bundleUrl = `${baseUrl}noodl_bundles/${name}.json`;\n            const response = await fetch(bundleUrl);\n            if (response.status === 404) {\n                throw new Error(\"Component not found \" + name);\n            }\n            const data = await response.json();\n            for (const component of data) {\n                if (this.graphModel.hasComponentWithName(component.name) === false) {\n                    await this.graphModel.importComponentFromEditorData(component);\n                }\n            }\n        };\n        if (this.bundleFetchesInFlight.has(name)) {\n            await this.bundleFetchesInFlight.get(name);\n        }\n        else {\n            const promise = fetchBundle(name);\n            this.bundleFetchesInFlight.set(name, promise);\n            await promise;\n        }\n    }\n    async getComponentModel(name) {\n        if (!name) {\n            throw new Error(\"Component instance must have a name\");\n        }\n        if (this.componentModels.hasOwnProperty(name) === false) {\n            const bundleName = this.graphModel.getBundleContainingComponent(name);\n            if (!bundleName) {\n                throw new Error(\"Can't find component model for \" + name);\n            }\n            //start fetching dependencies in the background\n            for (const bundleDep of this.graphModel.getBundleDependencies(bundleName)) {\n                this.fetchComponentBundle(bundleDep);\n            }\n            //and wait for the bundle that has the component we need\n            await this.fetchComponentBundle(bundleName);\n        }\n        return this.componentModels[name];\n    }\n    hasComponentModelWithName(name) {\n        return this.componentModels.hasOwnProperty(name);\n    }\n    async createComponentInstanceNode(componentName, id, nodeScope, extraProps) {\n        const node = new ComponentInstanceNode(this, id, nodeScope);\n        node.name = componentName;\n        if (extraProps) {\n            for (const prop in extraProps) {\n                node[prop] = extraProps[prop];\n            }\n        }\n        const componentModel = await this.getComponentModel(componentName);\n        await node.setComponentModel(componentModel);\n        return node;\n    }\n    _formatConnectionValue(value) {\n        if (typeof value === \"object\" &&\n            value &&\n            value.constructor &&\n            value.constructor.name === \"Node\") {\n            value = \"<Node> \" + value.name;\n        }\n        else if (typeof value === \"object\" &&\n            typeof window !== \"undefined\" &&\n            value instanceof HTMLElement) {\n            value = `DOM Node <${value.tagName}>`;\n        }\n        else if (typeof value === \"string\" && !value.startsWith(\"[Signal]\")) {\n            return '\"' + value + '\"';\n        }\n        else if (Number.isNaN(value)) {\n            return \"NaN\";\n        }\n        return value;\n    }\n    connectionSentValue(output, value) {\n        if (!this.editorConnection ||\n            !this.editorConnection.isConnected() ||\n            !this.debugInspectorsEnabled) {\n            return;\n        }\n        const timestamp = this.getCurrentTime();\n        this._outputHistory[output.id] = {\n            value,\n            timestamp,\n        };\n        if (this.connectionsToPulse.hasOwnProperty(output.id)) {\n            this.connectionsToPulse[output.id].timestamp = timestamp;\n            return;\n        }\n        const connections = [];\n        output.connections.forEach((connection) => {\n            connections.push(output.owner.id +\n                output.name +\n                connection.node.id +\n                connection.inputPortName);\n        });\n        this.connectionsToPulse[output.id] = {\n            timestamp,\n            connections,\n        };\n        this.connectionsToPulseChanged = true;\n        if (this.connectionPulsingCallbackScheduled === false) {\n            this.connectionPulsingCallbackScheduled = true;\n            setTimeout(this.clearOldConnectionPulsing.bind(this), 100);\n        }\n    }\n    connectionSentSignal(output) {\n        const id = output.id;\n        if (!this._signalHistory.hasOwnProperty(id)) {\n            this._signalHistory[id] = {\n                count: 0,\n            };\n        }\n        this._signalHistory[id].count++;\n        this.connectionSentValue(output, \"[Signal] Trigger count \" + this._signalHistory[id].count);\n    }\n    clearDebugInspectors() {\n        var _a;\n        this.debugInspectors = {};\n        this.connectionsToPulse = {};\n        (_a = this.editorConnection) === null || _a === void 0 ? void 0 : _a.sendPulsingConnections(this.connectionsToPulse);\n    }\n    clearOldConnectionPulsing() {\n        var _a;\n        this.connectionPulsingCallbackScheduled = false;\n        const now = this.getCurrentTime();\n        const connectionIds = Object.keys(this.connectionsToPulse);\n        connectionIds.forEach((id) => {\n            const con = this.connectionsToPulse[id];\n            if (now - con.timestamp > 100) {\n                this.connectionsToPulseChanged = true;\n                delete this.connectionsToPulse[id];\n            }\n        });\n        if (this.connectionsToPulseChanged) {\n            this.connectionsToPulseChanged = false;\n            (_a = this.editorConnection) === null || _a === void 0 ? void 0 : _a.sendPulsingConnections(this.connectionsToPulse);\n        }\n        if (Object.keys(this.connectionsToPulse).length > 0) {\n            this.connectionPulsingCallbackScheduled = true;\n            setTimeout(this.clearOldConnectionPulsing.bind(this), 500);\n        }\n    }\n    _getDebugInspectorValueForNode(id) {\n        if (!this.rootComponent)\n            return;\n        const nodes = this.rootComponent.nodeScope.getNodesWithIdRecursive(id);\n        const node = nodes[nodes.length - 1];\n        if (node && node.getInspectInfo) {\n            const info = node.getInspectInfo();\n            if (info !== undefined) {\n                return { type: \"node\", id, value: info };\n            }\n        }\n    }\n    sendDebugInspectorValues() {\n        var _a, _b;\n        const valuesToSend = [];\n        for (const id in this.debugInspectors) {\n            const inspector = this.debugInspectors[id];\n            if (inspector.type === \"connection\" &&\n                this._outputHistory.hasOwnProperty(id)) {\n                const value = this._outputHistory[id].value;\n                valuesToSend.push({\n                    type: \"connection\",\n                    id,\n                    value: this._formatConnectionValue(value),\n                });\n            }\n            else if (inspector.type === \"node\") {\n                const inspectorValue = this._getDebugInspectorValueForNode(id);\n                inspectorValue && valuesToSend.push(inspectorValue);\n            }\n        }\n        if (valuesToSend.length > 0) {\n            (_a = this.editorConnection) === null || _a === void 0 ? void 0 : _a.sendDebugInspectorValues(valuesToSend);\n        }\n        if (this.connectionsToPulseChanged) {\n            this.connectionsToPulseChanged = false;\n            (_b = this.editorConnection) === null || _b === void 0 ? void 0 : _b.sendPulsingConnections(this.connectionsToPulse);\n        }\n    }\n    setDebugInspectorsEnabled(enabled) {\n        this.debugInspectorsEnabled = enabled;\n        if (this.editorConnection) ;\n        if (enabled) {\n            this.sendDebugInspectorValues();\n        }\n    }\n    sendGlobalEventFromEventSender(channelName, inputValues) {\n        this.eventSenderEmitter.emit(channelName, inputValues);\n    }\n    setPopupCallbacks(callbacks) {\n        this.onShowPopup = callbacks.onShow;\n        this.onClosePopup = callbacks.onClose;\n    }\n    async showPopup(popupComponent, params, args) {\n        if (!this.onShowPopup)\n            return;\n        const nodeScope = this.rootComponent.nodeScope;\n        const popupNode = await nodeScope.createNode(popupComponent);\n        for (const inputKey in params) {\n            popupNode.setInputValue(inputKey, params[inputKey]);\n        }\n        popupNode.popupParent = (args === null || args === void 0 ? void 0 : args.senderNode) || null;\n        // Create container group\n        const group = nodeScope.createPrimitiveNode(\"Group\");\n        group.setInputValue(\"flexDirection\", \"node\");\n        group.setInputValue(\"cssClassName\", \"noodl-popup\");\n        const bodyScroll = this.graphModel.getSettings().bodyScroll;\n        //if the body can scroll the position of the popup needs to be fixed.\n        group.setInputValue(\"position\", bodyScroll ? \"fixed\" : \"absolute\");\n        const closePopupNodes = popupNode.nodeScope.getNodesWithType(\"NavigationClosePopup\");\n        if (closePopupNodes && closePopupNodes.length > 0) {\n            for (let j = 0; j < closePopupNodes.length; j++) {\n                closePopupNodes[j]._setCloseCallback((action, results) => {\n                    //close next frame so all nodes have a chance to update before being deleted\n                    this.scheduleNextFrame(() => {\n                        var _a, _b;\n                        //avoid double callbacks\n                        if (!nodeScope.hasNodeWithId(group.id))\n                            return;\n                        (_a = this.onClosePopup) === null || _a === void 0 ? void 0 : _a.call(this, group);\n                        nodeScope.deleteNode(group);\n                        (_b = args === null || args === void 0 ? void 0 : args.onClosePopup) === null || _b === void 0 ? void 0 : _b.call(args, action, results || {});\n                    });\n                });\n            }\n        }\n        this.onShowPopup(group);\n        requestAnimationFrame(() => {\n            //hack to make the react components have the right props\n            //TODO: figure out why this requestAnimationFrame is necessary\n            group.addChild(popupNode);\n        });\n    }\n    setWarningTypes(warningTypes) {\n        Object.assign(this.warningTypes, warningTypes);\n    }\n    isWarningTypeEnabled(warning) {\n        if (!this.warningTypes.hasOwnProperty(warning)) {\n            //if a level isn't set, default to true\n            return true;\n        }\n        return this.warningTypes[warning] ? true : false;\n    }\n    getDefaultValueForInput(nodeType, inputName) {\n        var _a;\n        if (this.nodeRegister.hasNode(nodeType) === false) {\n            return undefined;\n        }\n        const nodeMetadata = this.nodeRegister.getNodeMetadata(nodeType);\n        const inputMetadata = (_a = nodeMetadata.inputs) === null || _a === void 0 ? void 0 : _a[inputName];\n        if (!inputMetadata) {\n            return undefined;\n        }\n        if (inputMetadata.type.defaultUnit) {\n            return {\n                value: inputMetadata.default,\n                unit: inputMetadata.type.defaultUnit,\n            };\n        }\n        return inputMetadata.default;\n    }\n}\n\nclass EventSender {\n    constructor() {\n        this.listeners = {};\n        this.listenersWithRefs = {};\n    }\n    on(eventName, callback, ref) {\n        if (ref) {\n            if (!this.listenersWithRefs.hasOwnProperty(eventName)) {\n                this.listenersWithRefs[eventName] = new Map();\n            }\n            if (!this.listenersWithRefs[eventName].get(ref)) {\n                this.listenersWithRefs[eventName].set(ref, []);\n            }\n            this.listenersWithRefs[eventName].get(ref).push(callback);\n        }\n        else {\n            if (!this.listeners.hasOwnProperty(eventName)) {\n                this.listeners[eventName] = [];\n            }\n            this.listeners[eventName].push(callback);\n        }\n    }\n    removeListenersWithRef(ref) {\n        Object.keys(this.listenersWithRefs).forEach((eventName) => {\n            const listeners = this.listenersWithRefs[eventName];\n            if (listeners.has(ref)) {\n                listeners.delete(ref);\n            }\n        });\n    }\n    removeAllListeners(eventName) {\n        if (eventName) {\n            delete this.listeners[eventName];\n            delete this.listenersWithRefs[eventName];\n        }\n        else {\n            this.listeners = {};\n            this.listenersWithRefs = {};\n        }\n    }\n    async emit(eventName, data) {\n        const array = this.listeners[eventName];\n        if (array) {\n            const callbacks = [...array];\n            for (const callback of callbacks) {\n                await Promise.resolve(callback(data));\n            }\n        }\n        const map = this.listenersWithRefs[eventName];\n        if (map) {\n            for (const [ref, callbacks] of map) {\n                for (const callback of callbacks) {\n                    await Promise.resolve(callback.call(ref, data));\n                }\n            }\n        }\n    }\n}\n\n//used to optimize warnings so we're not sending unneccessary warnings.\n//Improves editor performance, especially in larger projects\nclass ActiveWarnings {\n    constructor() {\n        this.currentWarnings = new Map();\n    }\n    setWarning(nodeId, key, warning) {\n        //Check if we've already sent this warning\n        if (this.currentWarnings.has(nodeId)) {\n            //we have sent warnings to this node before, check if we've sent this particular one before\n            const warningKeys = this.currentWarnings.get(nodeId);\n            if (warningKeys && warningKeys[key] === warning) {\n                //we've already sent this warning, no need to send it again\n                return false;\n            }\n            //new warning, remember that we sent it\n            if (warningKeys) {\n                warningKeys[key] = warning;\n            }\n            return true;\n        }\n        else {\n            //new warning, we havent sent any warnings to this node before\n            //Remember that we sent it\n            this.currentWarnings.set(nodeId, { [key]: warning });\n            return true;\n        }\n    }\n    clearWarning(nodeId, key) {\n        const warningKeys = this.currentWarnings.get(nodeId);\n        if (!warningKeys || !warningKeys[key]) {\n            //There are no warnings that we've sent on this node.\n            //Save some performance by not sending an uneccesary message to the editor\n            return false;\n        }\n        delete warningKeys[key];\n        if (Object.keys(warningKeys).length === 0) {\n            this.currentWarnings.delete(nodeId);\n        }\n        return true;\n    }\n    clearWarnings(nodeId) {\n        if (this.currentWarnings.has(nodeId) === false) {\n            //no warnings on this node, save some performance by not sending a message to the editor\n            return false;\n        }\n        //no warnings for this node anymore\n        this.currentWarnings.delete(nodeId);\n        return true;\n    }\n}\n\nclass EditorConnection extends EventSender {\n    constructor(opts = {}) {\n        var _a, _b;\n        super();\n        this.clientId = \"\";\n        this.dynamicPortsHash = {};\n        this.serviceRequests = {};\n        this.runtimeType = opts.runtimeType;\n        this.platform = opts.platform || { getCurrentTime: () => Date.now() };\n        // @ts-expect-error\n        this.ws =\n            ((_a = opts.platform) === null || _a === void 0 ? void 0 : _a.webSocketClass) ||\n                (typeof WebSocket !== \"undefined\" ? WebSocket : undefined);\n        this.wsOptions = (_b = opts.platform) === null || _b === void 0 ? void 0 : _b.webSocketOptions;\n        this.reconnectOnClose = true;\n        this.enableDebugger = false;\n        this.lastSendTimestamp = 0;\n        this.sendQueue = [];\n        this.sendTimer = undefined;\n        //used to optimize warnings so we're not sending unneccessary warnings.\n        //Can slow down the editor in large projects\n        this.activeWarnings = new ActiveWarnings();\n    }\n    isRunningLocally() {\n        const runningLocallyInBrowser = (this.platform.isRunningLocally && this.platform.isRunningLocally()) ||\n            (typeof document !== \"undefined\" &&\n                (document.location.hostname === \"localhost\" ||\n                    document.location.hostname === \"127.0.0.1\"));\n        return runningLocallyInBrowser;\n    }\n    connect(address) {\n        this.socket = this.wsOptions\n            ? new this.ws(address, this.wsOptions)\n            : new this.ws(address);\n        this.socket.addEventListener(\"open\", () => {\n            var _a;\n            this.clientId = guid();\n            (_a = this.socket) === null || _a === void 0 ? void 0 : _a.send(JSON.stringify({\n                cmd: \"register\",\n                type: \"viewer\",\n                clientId: this.clientId,\n            }));\n            this.emit(\"connected\");\n        });\n        this.socket.addEventListener(\"close\", (event) => {\n            if (this.reconnectOnClose) {\n                this.reconnect(address);\n            }\n            console.log(\"Editor connection closed\", event.code, event.reason);\n            this.emit(\"connectionClosed\");\n        });\n        this.socket.addEventListener(\"error\", () => {\n            console.log(\"Editor connection error, trying to reconnect\");\n        });\n        this.socket.addEventListener(\"message\", async (e) => {\n            // NOTE: When the data is too big it seems to change from string to a blob\n            const text = typeof e.data === \"string\" ? e.data : await e.data.text();\n            const message = JSON.parse(text);\n            let content;\n            if (message.cmd === \"registered\") ;\n            else if (message.cmd === \"export\") {\n                content = JSON.parse(message.content);\n                if (message.type === \"full\" && message.target === this.clientId) {\n                    this.emit(\"exportDataFull\", content);\n                }\n            }\n            else if (message.cmd === \"hoverStart\") {\n                this.emit(\"hoverStart\", message.content.id);\n            }\n            else if (message.cmd === \"hoverEnd\") {\n                this.emit(\"hoverEnd\", message.content.id);\n            }\n            else if (message.cmd === \"refresh\") {\n                this.emit(\"reload\");\n            }\n            else if (message.cmd === \"debugInspectors\") {\n                if (this.debugInspectorsEnabled) {\n                    content = JSON.parse(message.content);\n                    this.emit(\"debugInspectorsUpdated\", content.inspectors);\n                }\n            }\n            else if (message.cmd === \"debuggingEnabled\") {\n                if (this.isRunningLocally()) {\n                    content = JSON.parse(message.content);\n                    this.emit(\"debuggingEnabledChanged\", content.enabled);\n                }\n            }\n            else if (message.cmd === \"getConnectionValue\") {\n                if (this.isRunningLocally()) {\n                    content = JSON.parse(message.content);\n                    await this.emit(\"getConnectionValue\", {\n                        clientId: content.clientId,\n                        connectionId: content.connectionId,\n                    });\n                }\n            }\n            else if (message.cmd === \"modelUpdate\") {\n                await this.emit(\"modelUpdate\", message.content);\n            }\n            else if (message.cmd === \"publish\") ;\n            else if (message.cmd === \"noodlModules\") {\n                this.emit(\"noodlModules\", JSON.parse(message.content));\n            }\n            else if (message.cmd === \"mqttUpdate\") {\n                this.emit(\"mqttUpdate\", message.content);\n            }\n            else if (message.cmd === \"activeComponentChanged\") {\n                this.emit(\"activeComponentChanged\", message.component);\n            }\n            else {\n                console.log(\"Command not implemented\", message);\n            }\n        });\n    }\n    reconnect(address) {\n        setTimeout(() => {\n            this.connect(address);\n        }, 2000);\n    }\n    isConnected() {\n        return this.socket !== undefined && this.socket.readyState === this.ws.OPEN;\n    }\n    //JSON replacer to make cyclic objects non-cyclic.\n    //Using this example: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Errors/Cyclic_object_value#examples\n    getCircularReplacer() {\n        const seen = new WeakSet();\n        return (key, value) => {\n            if (typeof value === \"object\" && value !== null) {\n                if (seen.has(value)) {\n                    return \"[Circular]\";\n                }\n                seen.add(value);\n            }\n            return value;\n        };\n    }\n    send(data) {\n        const now = this.platform.getCurrentTime();\n        const dt = now - this.lastSendTimestamp;\n        //Send objects as json and capture exceptions\n        const trySend = (msg) => {\n            var _a, _b;\n            try {\n                (_a = this.socket) === null || _a === void 0 ? void 0 : _a.send(JSON.stringify(msg));\n            }\n            catch (e) {\n                if (e.message && e.message.startsWith(\"Converting circular\")) {\n                    //the object is circular, try to address it\n                    try {\n                        (_b = this.socket) === null || _b === void 0 ? void 0 : _b.send(JSON.stringify(msg, this.getCircularReplacer()));\n                    }\n                    catch (e) {\n                        //still failed, give up\n                        console.log(\"failed to send message to editor\", msg, e);\n                    }\n                }\n                else {\n                    //message couldn't be serialized to json\n                    console.log(\"failed to send message to editor\", msg, e);\n                }\n            }\n        };\n        //batch messages so they're only sent at most every 200ms\n        //note that the first message will always be sent immediately, and the ones for 200ms after\n        //that one will be queued. So initial message response time is as low as possible (for hover etc)\n        if (dt < 200 || this.sendTimer || !this.isConnected()) {\n            this.sendQueue.push(data);\n            if (!this.sendTimer) {\n                this.sendTimer = setTimeout(() => {\n                    if (this.isConnected() === false) {\n                        return;\n                    }\n                    //send messages in chunks. If we send too many at once the editor UI can freeze for a while\n                    //since it's handling these in the renderer process\n                    const chunkSize = 50;\n                    for (let i = 0; i < this.sendQueue.length; i += chunkSize) {\n                        const chunk = this.sendQueue.slice(i, i + chunkSize);\n                        trySend(chunk);\n                    }\n                    this.sendQueue = [];\n                    this.sendTimer = undefined;\n                    this.lastSendTimestamp = this.platform.getCurrentTime();\n                }, 100);\n            }\n        }\n        else {\n            this.lastSendTimestamp = now;\n            trySend(data);\n        }\n    }\n    sendInspectId(id) {\n        this.send({\n            cmd: \"select\",\n            type: \"viewer\",\n            content: JSON.stringify({ id: id }),\n        });\n    }\n    sendSelectComponent(componentName) {\n        this.send({\n            cmd: \"select\",\n            type: \"viewer\",\n            content: JSON.stringify({ componentName }),\n        });\n    }\n    sendPulsingConnections(connectionMap) {\n        const connectionsToPulse = [];\n        Object.keys(connectionMap).forEach((c) => {\n            const connection = connectionMap[c];\n            connectionsToPulse.push(...connection.connections);\n        });\n        this.send({\n            cmd: \"connectiondebugpulse\",\n            type: \"viewer\",\n            content: JSON.stringify({\n                connectionsToPulse: connectionsToPulse,\n            }),\n        });\n    }\n    sendDebugInspectorValues(inspectors) {\n        this.send({\n            cmd: \"debuginspectorvalues\",\n            type: \"viewer\",\n            content: { inspectors },\n        });\n    }\n    sendConnectionValue(connectionId, value) {\n        this.send({\n            cmd: \"connectionValue\",\n            type: \"viewer\",\n            content: { connectionId, value },\n        });\n    }\n    _detectRename(before, after) {\n        if (!before || !after)\n            return;\n        if (before.length !== after.length)\n            return; // Must be of same length\n        const res = {};\n        for (let i = 0; i < before.length; i++) {\n            if (after.indexOf(before[i]) === -1) {\n                if (res.before)\n                    return; // Can only be one from before that is missing\n                res.before = before[i];\n            }\n            if (before.indexOf(after[i]) === -1) {\n                if (res.after)\n                    return; // Only one can be missing,otherwise we cannot match\n                res.after = after[i];\n            }\n        }\n        return res.before && res.after\n            ? { before: res.before, after: res.after }\n            : undefined;\n    }\n    sendDynamicPorts(id, ports, options) {\n        const hash = JSON.stringify(ports);\n        if (this.dynamicPortsHash[id] === hash) {\n            // Make sure we don't resend the same port data\n            return;\n        }\n        if (this.dynamicPortsHash[id] &&\n            ports &&\n            options &&\n            options.detectRenamed) {\n            const detectRenamed = Array.isArray(options.detectRenamed)\n                ? options.detectRenamed\n                : [options.detectRenamed];\n            const renamed = [];\n            detectRenamed.forEach((d) => {\n                let before = JSON.parse(this.dynamicPortsHash[id]);\n                let after = [...ports];\n                // Filter ports with correct prefix and plug\n                if (d.prefix) {\n                    before = before.filter((p) => p.name.startsWith(d.prefix));\n                    after = after.filter((p) => p.name.startsWith(d.prefix));\n                }\n                if (d.plug) {\n                    before = before.filter((p) => p.plug === d.plug);\n                    after = after.filter((p) => p.plug === d.plug);\n                }\n                // Remove the prefix\n                after = after.map((p) => p.name.substring((d.prefix || \"\").length));\n                before = before.map((p) => p.name.substring((d.prefix || \"\").length));\n                // Find the one that is renamed (if any)\n                const res = this._detectRename(before, after);\n                if (res) {\n                    renamed.push({\n                        plug: d.plug,\n                        patterns: [(d.prefix || \"\") + \"{{*}}\"],\n                        before: res.before,\n                        after: res.after,\n                    });\n                }\n            });\n            if (renamed.length > 0)\n                options.renamed = renamed;\n            delete options.detectRenamed;\n        }\n        this.dynamicPortsHash[id] = hash;\n        this.send({\n            cmd: \"instanceports\",\n            type: \"viewer\",\n            content: JSON.stringify({\n                nodeid: id,\n                ports: ports,\n                options: options,\n            }),\n        });\n    }\n    sendWarning(componentName, nodeId, key, warning) {\n        const isNewWarning = this.activeWarnings.setWarning(nodeId, key, warning);\n        if (isNewWarning) {\n            this.send({\n                cmd: \"showwarning\",\n                type: \"viewer\",\n                content: JSON.stringify({\n                    componentName: componentName,\n                    nodeId: nodeId,\n                    key: key,\n                    warning: warning,\n                }),\n            });\n        }\n    }\n    clearWarning(componentName, nodeId, key) {\n        const hasWarning = this.activeWarnings.clearWarning(nodeId, key);\n        if (hasWarning) {\n            this.send({\n                cmd: \"showwarning\",\n                type: \"viewer\",\n                content: JSON.stringify({\n                    componentName: componentName,\n                    nodeId: nodeId,\n                    key: key,\n                    warning: undefined,\n                }),\n            });\n        }\n    }\n    clearWarnings(componentName, nodeId) {\n        const hasWarnings = this.activeWarnings.clearWarnings(nodeId);\n        if (hasWarnings) {\n            this.send({\n                cmd: \"clearwarnings\",\n                type: \"viewer\",\n                content: JSON.stringify({\n                    componentName: componentName,\n                    nodeId: nodeId,\n                }),\n            });\n        }\n    }\n    sendPatches(patches) {\n        this.send({\n            cmd: \"patchproject\",\n            type: \"viewer\",\n            content: JSON.stringify(patches),\n        });\n    }\n    requestFullExport() {\n        this.send({\n            cmd: \"register\",\n            type: \"viewer\",\n        });\n    }\n    requestNoodlModules() {\n        this.send({\n            cmd: \"getNoodlModules\",\n            type: \"viewer\",\n        });\n    }\n    sendServiceRequest(request, callback) {\n        request.token = guid();\n        request.clientId = this.clientId;\n        this.serviceRequests[request.token] = callback;\n        this.send(request);\n    }\n    close() {\n        var _a;\n        this.reconnectOnClose = false;\n        if (this.isConnected() === false) {\n            return;\n        }\n        (_a = this.socket) === null || _a === void 0 ? void 0 : _a.close();\n    }\n    sendNodeLibrary(nodelibrary) {\n        this.send({\n            cmd: \"nodelibrary\",\n            type: \"viewer\",\n            runtimeType: this.runtimeType,\n            content: nodelibrary,\n            clientId: this.clientId,\n        });\n    }\n    sendComponentMetadata(componentName, key, data) {\n        this.send({\n            cmd: \"componentMetadata\",\n            type: \"viewer\",\n            content: JSON.stringify({\n                componentName,\n                key,\n                data,\n            }),\n        });\n    }\n    sendProjectMetadata(key, data) {\n        this.send({\n            cmd: \"projectMetadata\",\n            type: \"viewer\",\n            content: JSON.stringify({\n                key,\n                data,\n            }),\n        });\n    }\n}\n\nfunction formatDynamicPorts(nodeMetadata) {\n    var _a, _b;\n    const dynamicports = [];\n    for (const dp of nodeMetadata.dynamicports || []) {\n        if (dp.ports || dp.template || dp.port || dp.channelPort) {\n            //same format as editor expects, no need to transform it\n            dynamicports.push(dp);\n        }\n        else if (dp.inputs || dp.outputs) {\n            //inputs and outputs is just list of names\n            //need to pull the metadata from the inputs/outputs since they\n            //won't be registered by the editor (it's either a regular port\n            // or a dynamic port, can't register both)\n            const ports = [];\n            if (dp.inputs) {\n                for (const inputName of dp.inputs) {\n                    const input = (_a = nodeMetadata.inputs) === null || _a === void 0 ? void 0 : _a[inputName];\n                    if (input) {\n                        ports.push(formatPort(inputName, input, \"input\"));\n                    }\n                }\n            }\n            if (dp.outputs) {\n                for (const outputName of dp.outputs) {\n                    const output = (_b = nodeMetadata.outputs) === null || _b === void 0 ? void 0 : _b[outputName];\n                    if (output) {\n                        ports.push(formatPort(outputName, output, \"output\"));\n                    }\n                }\n            }\n            const dynamicPortGroup = {\n                name: dp.name || \"conditionalports/basic\",\n                condition: dp.condition,\n                ports,\n            };\n            dynamicports.push(dynamicPortGroup);\n        }\n    }\n    return dynamicports;\n}\nfunction formatPort(portName, portData, plugType) {\n    const port = {\n        name: portName,\n        type: portData.type,\n        plug: plugType,\n    };\n    if (portData.group) {\n        port.group = portData.group;\n    }\n    if (portData.displayName) {\n        port.displayName = portData.displayName;\n    }\n    if (portData.description) {\n        port.description = portData.description;\n    }\n    if (portData.editorName) {\n        port.editorName = portData.editorName;\n    }\n    if (portData.default !== undefined) {\n        port.default = portData.default;\n    }\n    if (portData.hasOwnProperty(\"index\")) {\n        port.index = portData.index;\n    }\n    if (portData.tooltip) {\n        port.tooltip = portData.tooltip;\n    }\n    if (portData.tab) {\n        port.tab = portData.tab;\n    }\n    if (portData.popout) {\n        port.popout = portData.popout;\n    }\n    if (portData.allowVisualStates) {\n        port.allowVisualStates = portData.allowVisualStates;\n    }\n    return port;\n}\nfunction generateNodeLibrary(nodeRegister) {\n    const obj = {\n        //note: needs to include ALL types\n        typecasts: [\n            {\n                from: \"string\",\n                to: [\n                    \"number\",\n                    \"boolean\",\n                    \"image\",\n                    \"color\",\n                    \"enum\",\n                    \"textStyle\",\n                    \"dimension\",\n                    \"array\",\n                    \"object\",\n                ],\n            },\n            {\n                from: \"boolean\",\n                to: [\"number\", \"string\", \"signal\"],\n            },\n            {\n                from: \"number\",\n                to: [\"boolean\", \"string\", \"dimension\"],\n            },\n            {\n                from: \"date\",\n                to: [\"string\"],\n            },\n            {\n                from: \"signal\",\n                to: [\"boolean\", \"number\"],\n            },\n            {\n                from: \"image\",\n                to: [],\n            },\n            {\n                from: \"cloudfile\",\n                to: [\"string\", \"image\"],\n            },\n            {\n                from: \"color\",\n                to: [],\n            },\n            {\n                from: \"enum\",\n                to: [],\n            },\n            {\n                from: \"object\",\n                to: [],\n            },\n            {\n                from: \"domelement\",\n                to: [],\n            },\n            {\n                from: \"reference\",\n                to: [],\n            },\n            {\n                from: \"font\",\n                to: [],\n            },\n            {\n                from: \"textStyle\",\n                to: [\"string\"],\n            },\n            {\n                // Collection is deprecated but supported via typecasts\n                from: \"collection\",\n                to: [\"array\"],\n            },\n            {\n                from: \"array\",\n                to: [\"collection\"],\n            },\n        ],\n        dynamicports: [\n            {\n                type: \"conditionalports\",\n                name: \"basic\",\n            },\n            {\n                type: \"expand\",\n                name: \"basic\",\n            },\n        ],\n        colors: {\n            nodes: {\n                component: {\n                    base: \"#643D8B\",\n                    baseHighlighted: \"#79559b\",\n                    header: \"#4E2877\",\n                    headerHighlighted: \"#643d8b\",\n                    outline: \"#4E2877\",\n                    outlineHighlighted: \"#b58900\",\n                    text: \"#dbd0e4\",\n                },\n                visual: {\n                    base: \"#315272\",\n                    baseHighlighted: \"#4d6784\",\n                    header: \"#173E5D\",\n                    headerHighlighted: \"#315272\",\n                    outline: \"#173E5D\",\n                    outlineHighlighted: \"#b58900\",\n                    text: \"#cfd5de\",\n                },\n                data: {\n                    base: \"#465524\",\n                    baseHighlighted: \"#5b6a37\",\n                    header: \"#314110\",\n                    headerHighlighted: \"#465524\",\n                    outline: \"#314110\",\n                    outlineHighlighted: \"#b58900\",\n                    text: \"#d2d6c5\",\n                },\n                javascript: {\n                    base: \"#7E3660\",\n                    baseHighlighted: \"#944e74\",\n                    header: \"#67214B\",\n                    headerHighlighted: \"#7e3660\",\n                    outline: \"#67214B\",\n                    outlineHighlighted: \"#d57bab\",\n                    text: \"#e4cfd9\",\n                },\n                default: {\n                    base: \"#4C4F59\",\n                    baseHighlighted: \"#62656e\",\n                    header: \"#373B45\",\n                    headerHighlighted: \"#4c4f59\",\n                    outline: \"#373B45\",\n                    outlineHighlighted: \"#b58900\",\n                    text: \"#d3d4d6\",\n                },\n            },\n            connections: {\n                signal: {\n                    normal: \"#006f82\",\n                    highlighted: \"#7ec2cf\",\n                    pulsing: \"#ffffff\",\n                },\n                default: {\n                    normal: \"#875d00\",\n                    highlighted: \"#e5ae32\",\n                    pulsing: \"#ffffff\",\n                },\n            },\n        },\n        nodetypes: [\n            {\n                name: \"Component Children\",\n                shortDesc: \"This node is a placeholder for where children of this component will be inserted.\",\n                docs: \"https://docs.noodl.net/nodes/component-utilities/component-children\",\n                color: \"component\",\n                allowAsChild: true,\n                category: \"Visual\",\n                haveComponentChildren: [\"Visual\"],\n            },\n        ],\n    };\n    const nodeTypes = Object.keys(nodeRegister._constructors);\n    nodeTypes.forEach(function (type) {\n        const nodeMetadata = nodeRegister._constructors[type].metadata;\n        const nodeObj = {\n            name: type,\n            searchTags: nodeMetadata.searchTags,\n        };\n        obj.nodetypes.push(nodeObj);\n        if (nodeMetadata.version) {\n            nodeObj.version = nodeMetadata.version;\n        }\n        if (nodeMetadata.displayNodeName) {\n            nodeObj.displayNodeName = nodeMetadata.displayNodeName;\n        }\n        if (nodeMetadata.nodeDoubleClickAction) {\n            nodeObj.nodeDoubleClickAction = nodeMetadata.nodeDoubleClickAction;\n        }\n        if (nodeMetadata.shortDesc) {\n            nodeObj.shortDesc = nodeMetadata.shortDesc;\n        }\n        if (nodeMetadata.module) {\n            nodeObj.module = nodeMetadata.module;\n        }\n        if (nodeMetadata.deprecated) {\n            nodeObj.deprecated = true;\n        }\n        if (nodeMetadata.haveComponentPorts) {\n            nodeObj.haveComponentPorts = true;\n        }\n        if (nodeMetadata.category === \"Visual\") {\n            nodeObj.allowAsChild = true;\n            nodeObj.allowAsExportRoot = true;\n            nodeObj.color = \"visual\";\n        }\n        if (nodeMetadata.allowAsExportRoot !== undefined) {\n            nodeObj.allowAsExportRoot = nodeMetadata.allowAsExportRoot;\n        }\n        if (nodeMetadata.allowChildren) {\n            nodeObj.allowChildrenWithCategory = [\"Visual\"];\n            nodeObj.color = \"visual\";\n        }\n        if (nodeMetadata.allowChildrenWithCategory) {\n            nodeObj.allowChildrenWithCategory =\n                nodeMetadata.allowChildrenWithCategory;\n        }\n        if (nodeMetadata.singleton) {\n            nodeObj.singleton = true;\n        }\n        if (nodeMetadata.allowAsChild) {\n            nodeObj.allowAsChild = true;\n        }\n        if (nodeMetadata.docs) {\n            nodeObj.docs = nodeMetadata.docs;\n        }\n        if (nodeMetadata.shortDocs) {\n            nodeObj.shortDocs = nodeMetadata.shortDocs;\n        }\n        else if (nodeMetadata.docs &&\n            nodeMetadata.docs.indexOf(\"https://docs.noodl.net\") === 0) {\n            nodeObj.shortDocs = nodeMetadata.docs.replace(\"/#\", \"\") + \"-short.md\";\n        }\n        nodeObj.category = nodeMetadata.category;\n        if (nodeMetadata.panels) {\n            nodeObj.panels = nodeMetadata.panels;\n        }\n        if (nodeMetadata.usePortAsLabel) {\n            nodeObj.usePortAsLabel = nodeMetadata.usePortAsLabel;\n            nodeObj.portLabelTruncationMode = nodeMetadata.portLabelTruncationMode;\n        }\n        if (nodeMetadata.color) {\n            nodeObj.color = nodeMetadata.color;\n        }\n        if (nodeMetadata.dynamicports) {\n            nodeObj.dynamicports = formatDynamicPorts(nodeMetadata);\n        }\n        if (nodeMetadata.exportDynamicPorts) {\n            nodeObj.exportDynamicPorts = nodeMetadata.exportDynamicPorts;\n        }\n        if (nodeMetadata.visualStates) {\n            nodeObj.visualStates = nodeMetadata.visualStates;\n        }\n        if (nodeMetadata.useVariants) {\n            nodeObj.useVariants = nodeMetadata.useVariants;\n        }\n        if (nodeMetadata.connectionPanel) {\n            nodeObj.connectionPanel = nodeMetadata.connectionPanel;\n        }\n        nodeObj.ports = [];\n        const dynamicports = nodeObj.dynamicports || [];\n        const selectorNames = {};\n        const conditionalPortNames = {};\n        //same for channel ports\n        dynamicports\n            .filter((d) => d.channelPort !== undefined)\n            .forEach((port) => {\n            conditionalPortNames[port.channelPort.plug + \"/\" + port.channelPort.name] = true;\n        });\n        if (dynamicports.length) {\n            nodeObj.dynamicports = dynamicports;\n        }\n        Object.keys(nodeMetadata.inputs || {}).forEach(function (inputName) {\n            var _a;\n            if (selectorNames.hasOwnProperty(\"input/\" + inputName) ||\n                conditionalPortNames.hasOwnProperty(\"input/\" + inputName)) {\n                //this is a selector or dynamic port. It's already been registered\n                return;\n            }\n            const port = (_a = nodeMetadata.inputs) === null || _a === void 0 ? void 0 : _a[inputName];\n            if (!port || port.exportToEditor === false) {\n                return;\n            }\n            if (!nodeObj.ports) {\n                nodeObj.ports = [];\n            }\n            nodeObj.ports.push(formatPort(inputName, port, \"input\"));\n        });\n        function exportOutput(name, output) {\n            const port = {\n                name: name,\n                type: output.type,\n                plug: \"output\",\n            };\n            if (output.group) {\n                port.group = output.group;\n            }\n            if (output.displayName) {\n                port.displayName = output.displayName;\n            }\n            if (output.editorName) {\n                port.editorName = output.editorName;\n            }\n            if (output.hasOwnProperty(\"index\")) {\n                port.index = output.index;\n            }\n            if (!nodeObj.ports) {\n                nodeObj.ports = [];\n            }\n            nodeObj.ports.push(port);\n        }\n        Object.keys(nodeMetadata.outputs || {}).forEach(function (prop) {\n            var _a;\n            if (selectorNames.hasOwnProperty(\"output/\" + prop) ||\n                conditionalPortNames.hasOwnProperty(\"output/\" + prop)) {\n                //this is a selector or dynamic port. It's already been registered\n                return;\n            }\n            const output = (_a = nodeMetadata.outputs) === null || _a === void 0 ? void 0 : _a[prop];\n            if (output) {\n                exportOutput(prop, output);\n            }\n        });\n    });\n    const coreNodes = [\n        {\n            name: \"UI Elements\",\n            description: \"Buttons, inputs, containers, media\",\n            type: \"visual\",\n            subCategories: [\n                {\n                    name: \"Basic Elements\",\n                    items: [\n                        \"Group\",\n                        \"net.noodl.visual.columns\",\n                        \"Text\",\n                        \"Image\",\n                        \"Video\",\n                        \"Circle\",\n                        \"net.noodl.visual.icon\",\n                    ],\n                },\n                {\n                    name: \"UI Controls\",\n                    items: [\n                        \"net.noodl.controls.button\",\n                        \"net.noodl.controls.checkbox\",\n                        \"net.noodl.controls.options\",\n                        \"net.noodl.controls.radiobutton\",\n                        \"Radio Button Group\",\n                        \"net.noodl.controls.range\",\n                        \"net.noodl.controls.textinput\",\n                    ],\n                },\n            ],\n        },\n        {\n            name: \"Navigation & Popups\",\n            description: \"Page routing, navigation, popups\",\n            type: \"logic\",\n            subCategories: [\n                {\n                    name: \"Navigation\",\n                    items: [\n                        \"Router\",\n                        \"RouterNavigate\",\n                        \"PageInputs\",\n                        \"net.noodl.externallink\",\n                        \"PageStackNavigateToPath\",\n                    ],\n                },\n                {\n                    name: \"Component Stack\",\n                    items: [\"Page Stack\", \"PageStackNavigate\", \"PageStackNavigateBack\"],\n                },\n                {\n                    name: \"Popups\",\n                    items: [\"NavigationShowPopup\", \"NavigationClosePopup\"],\n                },\n            ],\n        },\n        {\n            name: \"Logic & Utilities\",\n            description: \"Logic, events, string manipulation\",\n            type: \"logic\",\n            subCategories: [\n                {\n                    name: \"General Utils\",\n                    items: [\n                        \"States\",\n                        \"Value Changed\",\n                        \"Timer\",\n                        \"Color Blend\",\n                        \"Number Remapper\",\n                        \"Counter\",\n                        \"Drag\",\n                        \"net.noodl.animatetovalue\",\n                    ],\n                },\n                {\n                    name: \"Logic\",\n                    items: [\n                        \"Boolean To String\",\n                        \"Switch\",\n                        \"And\",\n                        \"Or\",\n                        \"Condition\",\n                        \"Inverter\",\n                    ],\n                },\n                {\n                    name: \"Events\",\n                    items: [\"Event Sender\", \"Event Receiver\"],\n                },\n                {\n                    name: \"String Manipulation\",\n                    items: [\n                        \"Substring\",\n                        \"String Mapper\",\n                        \"String Format\",\n                        \"Date To String\",\n                        \"Unique Id\",\n                    ],\n                },\n                {\n                    name: \"System\",\n                    items: [\"Screen Resolution\", \"Open File Picker\"],\n                },\n                {\n                    name: \"Variables\",\n                    items: [\"String\", \"Boolean\", \"Color\", \"Number\"],\n                },\n            ],\n        },\n        {\n            name: \"Component Utilities\",\n            description: \"Component inputs, outputs & object\",\n            type: \"component\",\n            subCategories: [\n                {\n                    name: \"\",\n                    items: [\n                        \"Component Inputs\",\n                        \"Component Outputs\",\n                        \"Component Children\",\n                        \"net.noodl.ComponentObject\",\n                        \"net.noodl.ParentComponentObject\",\n                        \"net.noodl.SetComponentObjectProperties\",\n                        \"net.noodl.SetParentComponentObjectProperties\",\n                    ],\n                },\n            ],\n        },\n        {\n            name: \"Read & Write Data\",\n            description: \"Arrays, objects, cloud data\",\n            type: \"data\",\n            subCategories: [\n                {\n                    name: \"\",\n                    items: [\n                        \"RunTasks\",\n                        \"For Each\",\n                        \"For Each Actions\",\n                        \"Model2\",\n                        \"SetModelProperties\",\n                        \"NewModel\",\n                        \"Set Variable\",\n                        \"Variable2\",\n                    ],\n                },\n                {\n                    name: \"Array\",\n                    items: [\n                        \"Collection2\",\n                        \"CollectionNew\",\n                        \"CollectionRemove\",\n                        \"CollectionClear\",\n                        \"CollectionInsert\",\n                        \"Filter Collection\",\n                        \"Map Collection\",\n                        \"Static Data\",\n                    ],\n                },\n                {\n                    name: \"Cloud Data\",\n                    items: [\n                        \"DbModel2\",\n                        \"NewDbModelProperties\",\n                        \"FilterDBModels\",\n                        \"SetDbModelProperties\",\n                        \"DbCollection2\",\n                        \"DeleteDbModelProperties\",\n                        \"AddDbModelRelation\",\n                        \"RemoveDbModelRelation\",\n                        \"Cloud File\",\n                        \"Upload File\",\n                        \"CloudFunction2\",\n                        \"DbConfig\",\n                    ],\n                },\n                {\n                    name: \"User\",\n                    items: [\n                        \"net.noodl.user.LogIn\",\n                        \"net.noodl.user.LogOut\",\n                        \"net.noodl.user.SignUp\",\n                        \"net.noodl.user.User\",\n                        \"net.noodl.user.SetUserProperties\",\n                        \"net.noodl.user.VerifyEmail\",\n                        \"net.noodl.user.SendEmailVerification\",\n                        \"net.noodl.user.ResetPassword\",\n                        \"net.noodl.user.RequestPasswordReset\",\n                    ],\n                },\n                {\n                    name: \"External Data\",\n                    items: [\"REST2\"],\n                },\n            ],\n        },\n        {\n            name: \"Custom Code\",\n            description: \"Custom JavaScript and CSS\",\n            type: \"javascript\",\n            subCategories: [\n                {\n                    name: \"\",\n                    items: [\n                        \"Expression\",\n                        \"JavaScriptFunction\",\n                        \"Javascript2\",\n                        \"CSS Definition\",\n                    ],\n                },\n            ],\n        },\n        {\n            name: \"Cloud Functions\",\n            description: \"Nodes to be used in cloud functions\",\n            type: \"data\",\n            subCategories: [\n                {\n                    name: \"\",\n                    items: [\"noodl.cloud.request\", \"noodl.cloud.response\"],\n                },\n                {\n                    name: \"Cloud Data\",\n                    items: [\"noodl.cloud.aggregate\"],\n                },\n            ],\n        },\n    ];\n    obj.nodeIndex = {\n        coreNodes,\n    };\n    const moduleNodes = [];\n    nodeTypes.forEach((type) => {\n        const nodeMetadata = nodeRegister._constructors[type].metadata;\n        if (nodeMetadata.module) {\n            moduleNodes.push(type);\n        }\n    });\n    if (moduleNodes.length) {\n        obj.nodeIndex.moduleNodes = [\n            {\n                name: \"\",\n                items: moduleNodes,\n            },\n        ];\n    }\n    return obj;\n}\n\nfunction addModuleSettings(result, modules) {\n    // Add module settings\n    for (let i = 0; i < modules.length; i++) {\n        const m = modules[i];\n        if (m.settings) {\n            m.settings.forEach((p) => {\n                result.ports.push(p);\n            });\n        }\n    }\n}\nfunction generateProjectSettings(\n// TODO: What is this?\nprojectSettings, modules) {\n    const result = {\n        dynamicports: [],\n        ports: [],\n    };\n    addModuleSettings(result, modules);\n    return result;\n}\n\nclass NodeModel extends EventSender {\n    // removeListenersWithRef: (ref: any) => void;\n    constructor(id, type) {\n        super();\n        this.id = id;\n        this.type = type;\n        this.inputs = [];\n        this.outputs = [];\n        this.children = [];\n        this.parameters = {};\n        this.inputPorts = {};\n        this.outputPorts = {};\n    }\n    setParameter(name, value, state) {\n        if (state) {\n            if (!this.stateParameters)\n                this.stateParameters = {};\n            if (!this.stateParameters[state])\n                this.stateParameters[state] = {};\n            if (value === undefined) {\n                delete this.stateParameters[state][name];\n            }\n            else {\n                this.stateParameters[state][name] = value;\n            }\n        }\n        else {\n            if (value === undefined) {\n                delete this.parameters[name];\n            }\n            else {\n                this.parameters[name] = value;\n            }\n        }\n        this.emit(\"parameterUpdated\", { name, value, state });\n    }\n    setParameters(parameters) {\n        Object.keys(parameters).forEach((name) => {\n            this.setParameter(name, parameters[name]);\n        });\n    }\n    setStateParameters(parameters) {\n        this.stateParameters = parameters;\n    }\n    setStateTransitions(stateTransitions) {\n        this.stateTransitions = stateTransitions;\n    }\n    setStateTransitionParamter(parameter, curve, state) {\n        if (!this.stateTransitions) {\n            this.stateTransitions = {};\n        }\n        if (curve) {\n            this.stateTransitions[state][parameter] = curve;\n        }\n        else {\n            delete this.stateTransitions[state][parameter];\n        }\n    }\n    setDefaultStateTransition(stateTransition, state) {\n        if (!this.defaultStateTransitions) {\n            this.defaultStateTransitions = {};\n        }\n        this.defaultStateTransitions[state] = stateTransition;\n    }\n    addInputPort(port) {\n        this.inputPorts[port.name] = port;\n        this.emit(\"inputPortAdded\", port);\n    }\n    getInputPort(portName) {\n        return this.inputPorts[portName];\n    }\n    getInputPorts() {\n        return this.inputPorts;\n    }\n    removeInputPortWithName(portName) {\n        if (this.inputPorts.hasOwnProperty(portName)) {\n            const port = this.inputPorts[portName];\n            delete this.inputPorts[portName];\n            this.emit(\"inputPortRemoved\", port);\n        }\n    }\n    updateInputPortTypes(ports) {\n        let changed = false;\n        for (const key in ports) {\n            if (this.inputPorts[key] !== undefined) {\n                this.inputPorts[key].type = ports[key].type;\n                changed = true;\n            }\n        }\n        changed && this.emit(\"inputPortTypesUpdated\");\n    }\n    addOutputPort(port) {\n        this.outputPorts[port.name] = port;\n        this.emit(\"outputPortAdded\", port);\n    }\n    getOutputPort(portName) {\n        return this.outputPorts[portName];\n    }\n    getOutputPorts() {\n        return this.outputPorts;\n    }\n    removeOutputPortWithName(portName) {\n        if (this.outputPorts.hasOwnProperty(portName)) {\n            const port = this.outputPorts[portName];\n            delete this.outputPorts[portName];\n            this.emit(\"outputPortRemoved\", port);\n        }\n    }\n    updateOutputPortTypes(ports) {\n        let changed = false;\n        for (const key in ports) {\n            if (this.outputPorts[key] !== undefined) {\n                this.outputPorts[key].type = ports[key].type;\n                changed = true;\n            }\n        }\n        changed && this.emit(\"outputPortTypesUpdated\");\n    }\n    addChild(child, index) {\n        child.parent = this;\n        if (index === undefined) {\n            this.children.push(child);\n        }\n        else {\n            this.children.splice(index, 0, child);\n        }\n        this.emit(\"childAdded\", child);\n    }\n    removeChild(child) {\n        child.parent = undefined;\n        const index = this.children.indexOf(child);\n        this.children.splice(index, 1);\n        this.emit(\"childRemoved\", child);\n    }\n    reset() {\n        this.removeAllListeners();\n    }\n    setVariant(variant) {\n        this.variant = variant;\n        this.emit(\"variantUpdated\", variant);\n    }\n    static createFromExportData(nodeData) {\n        const node = new NodeModel(nodeData.id, nodeData.type);\n        nodeData.parameters && node.setParameters(nodeData.parameters);\n        nodeData.stateParameters &&\n            node.setStateParameters(nodeData.stateParameters);\n        nodeData.stateTransitions &&\n            node.setStateTransitions(nodeData.stateTransitions);\n        if (nodeData.defaultStateTransitions) {\n            for (const state in nodeData.defaultStateTransitions) {\n                node.setDefaultStateTransition(nodeData.defaultStateTransitions[state], state);\n            }\n        }\n        nodeData.ports &&\n            nodeData.ports.forEach((port) => {\n                //some ports are incorrectly named outputs instead of output, patch it here so\n                //the rest of the code doesn't need to care\n                // TODO: WTF...\n                // if (port.plug === \"outputs\") {\n                //   port.plug = \"output\";\n                // }\n                if (port.plug === \"input\" || port.plug === \"input/output\") {\n                    node.addInputPort(port);\n                }\n                if (port.plug === \"output\" || port.plug === \"input/output\") {\n                    node.addOutputPort(port);\n                }\n            });\n        nodeData.variant && node.setVariant(nodeData.variant);\n        return node;\n    }\n}\n\nclass ComponentModel extends EventSender {\n    constructor(name) {\n        super();\n        this.name = name;\n        this.nodes = {};\n        this.connections = [];\n        this.roots = [];\n        this.inputPorts = {};\n        this.outputPorts = {};\n        this.metadata = {};\n    }\n    async addNode(node) {\n        node.component = this;\n        this.nodes[node.id] = node;\n        await this.emit(\"nodeAdded\", node);\n    }\n    hasNodeWithId(id) {\n        return this.getNodeWithId(id) !== undefined;\n    }\n    getNodeWithId(id) {\n        if (!id) {\n            return undefined;\n        }\n        return this.nodes[id];\n    }\n    getAllNodes() {\n        return Object.values(this.nodes);\n    }\n    getNodesWithType(type) {\n        const nodes = [];\n        Object.keys(this.nodes).forEach((id) => {\n            const node = this.nodes[id];\n            if (node.type === type) {\n                nodes.push(node);\n            }\n        });\n        return nodes;\n    }\n    addConnection(connection) {\n        this.connections.push(connection);\n        this.emit(\"connectionAdded\", connection);\n        //emit an event on the target node model\n        //used by numbered inputs\n        if (connection.targetId) {\n            const node = this.getNodeWithId(connection.targetId);\n            if (node) {\n                node.emit(\"inputConnectionAdded\", connection);\n            }\n        }\n    }\n    removeConnection(connection) {\n        const index = this.connections.findIndex((con) => {\n            return (con.sourceId === connection.sourceId &&\n                con.sourcePort === connection.sourcePort &&\n                con.targetId === connection.targetId &&\n                con.targetPort === connection.targetPort);\n        });\n        if (index === -1) {\n            // TODO: Setup a better logging system\n            // console.log(\"Connection doesn't exist\", connection);\n            return;\n        }\n        this.connections.splice(index, 1);\n        this.emit(\"connectionRemoved\", connection);\n        //emit an event on the target node model\n        //used by numbered inputs\n        if (connection.targetId) {\n            const node = this.getNodeWithId(connection.targetId);\n            if (node) {\n                node.emit(\"inputConnectionRemoved\", connection);\n            }\n        }\n    }\n    getConnectionsFromPort(nodeId, sourcePortName) {\n        return this.connections.filter((connection) => {\n            return (connection.sourceId === nodeId &&\n                connection.sourcePort === sourcePortName);\n        });\n    }\n    getConnectionsToPort(nodeId, targetPortName) {\n        return this.connections.filter((connection) => {\n            return (connection.targetId === nodeId &&\n                connection.targetPort === targetPortName);\n        });\n    }\n    getConnectionsFrom(nodeId) {\n        return this.connections.filter((connection) => {\n            return connection.sourceId === nodeId;\n        });\n    }\n    getConnectionsTo(nodeId) {\n        return this.connections.filter((connection) => {\n            return connection.targetId === nodeId;\n        });\n    }\n    addRootId(rootId) {\n        if (!rootId) {\n            return;\n        }\n        if (this.roots.indexOf(rootId) !== -1) {\n            return;\n        }\n        this.roots.push(rootId);\n        this.emit(\"rootAdded\", rootId);\n    }\n    removeRootId(rootId) {\n        const index = this.roots.indexOf(rootId);\n        if (index !== -1) {\n            this.roots.splice(index, 1);\n            this.emit(\"rootRemoved\", rootId);\n        }\n    }\n    getRoots() {\n        return this.roots;\n    }\n    async removeNodeWithId(id) {\n        const node = this.getNodeWithId(id);\n        if (!node) {\n            console.warn(\"ERROR: Attempted to remove non-existing node with ID:\", id);\n            return false;\n        }\n        //remove children first\n        while (node.children.length > 0) {\n            const child = node.children[0];\n            const childRemoved = await this.removeNodeWithId(child.id);\n            if (!childRemoved) {\n                // Workaround for corrupt node trees, should never happen, a remove should always be successful\n                node.children.shift();\n            }\n        }\n        const connections = this.getConnectionsTo(id).concat(this.getConnectionsFrom(id));\n        for (let i = 0; i < connections.length; i++) {\n            this.removeConnection(connections[i]);\n        }\n        this.setNodeParent(node, undefined);\n        if (this.roots.indexOf(node.id) !== -1) {\n            this.removeRootId(node.id);\n        }\n        await this.emit(\"nodeRemoved\", node);\n        node.removeAllListeners();\n        delete this.nodes[id];\n        await this.emit(\"nodeWasRemoved\", node);\n        return true;\n    }\n    getAllConnections() {\n        return this.connections;\n    }\n    getInputPorts() {\n        return this.inputPorts;\n    }\n    getOutputPorts() {\n        return this.outputPorts;\n    }\n    addInputPort(port) {\n        this.inputPorts[port.name] = port;\n        this.emit(\"inputPortAdded\", port);\n    }\n    addOutputPort(port) {\n        this.outputPorts[port.name] = port;\n        this.emit(\"outputPortAdded\", port);\n    }\n    removeOutputPortWithName(portName) {\n        if (this.outputPorts.hasOwnProperty(portName)) {\n            const port = this.outputPorts[portName];\n            delete this.outputPorts[portName];\n            this.emit(\"outputPortRemoved\", port);\n        }\n    }\n    removeInputPortWithName(portName) {\n        if (this.inputPorts.hasOwnProperty(portName)) {\n            const port = this.inputPorts[portName];\n            delete this.inputPorts[portName];\n            this.emit(\"inputPortRemoved\", port);\n        }\n    }\n    updateInputPortTypes(ports) {\n        let changed = false;\n        for (const key in ports) {\n            if (this.inputPorts[key] !== undefined) {\n                this.inputPorts[key].type = ports[key].type;\n                changed = true;\n            }\n        }\n        changed && this.emit(\"inputPortTypesUpdated\");\n    }\n    updateOutputPortTypes(ports) {\n        let changed = false;\n        for (const key in ports) {\n            if (this.outputPorts[key] !== undefined) {\n                this.outputPorts[key].type = ports[key].type;\n                changed = true;\n            }\n        }\n        changed && this.emit(\"outputPortTypesUpdated\");\n    }\n    renameInputPortOnNodeWithId(id, oldName, newName) {\n        //remove connections\n        const connections = this.getConnectionsToPort(id, oldName);\n        connections.forEach(this.removeConnection.bind(this));\n        //get port before deleting it\n        const nodeModel = this.getNodeWithId(id);\n        if (!nodeModel)\n            return;\n        // @ts-expect-error TODO: What is this?\n        const port = { ...nodeModel.getInputPort(oldName) };\n        //remove old port\n        if (port) {\n            nodeModel.removeInputPortWithName(oldName);\n            //rename and add new port\n            port.name = newName;\n            nodeModel.addInputPort(port);\n        }\n        //add new connection\n        connections.forEach((connection) => {\n            connection.targetPort = newName;\n        });\n        connections.forEach(this.addConnection.bind(this));\n    }\n    renameOutputPortOnNodeWithId(id, oldName, newName) {\n        //remove connections\n        const connections = this.getConnectionsFromPort(id, oldName);\n        connections.forEach(this.removeConnection.bind(this));\n        //get port before deleting it\n        const nodeModel = this.getNodeWithId(id);\n        if (!nodeModel)\n            return;\n        // @ts-expect-error TODO: What is this?\n        const port = { ...nodeModel.getOutputPort(oldName) };\n        //remove old port\n        nodeModel.removeOutputPortWithName(oldName);\n        //rename and add new port\n        port.name = newName;\n        nodeModel.addOutputPort(port);\n        //add new connection\n        connections.forEach((connection) => {\n            connection.sourcePort = newName;\n        });\n        connections.forEach(this.addConnection.bind(this));\n    }\n    setNodeParent(childModel, newParentModel, index) {\n        if (!childModel) {\n            return;\n        }\n        if (this.roots.indexOf(childModel.id) !== -1) {\n            this.removeRootId(childModel.id);\n        }\n        if (childModel.parent) {\n            this.emit(\"nodeParentWillBeRemoved\", childModel);\n            childModel.parent.removeChild(childModel);\n        }\n        childModel.emit(\"parentUpdated\", newParentModel);\n        if (newParentModel) {\n            newParentModel.addChild(childModel, index);\n            this.emit(\"nodeParentUpdated\", childModel);\n        }\n    }\n    async importEditorNodeData(nodeData, parentId, childIndex) {\n        const nodeModel = NodeModel.createFromExportData(nodeData);\n        await this.addNode(nodeModel);\n        if (parentId) {\n            this.setNodeParent(nodeModel, this.getNodeWithId(parentId), childIndex);\n        }\n        if (nodeData.children) {\n            for (let i = 0; i < nodeData.children.length; i++) {\n                const child = nodeData.children[i];\n                await this.importEditorNodeData(child, nodeModel.id, i);\n            }\n        }\n    }\n    async reset() {\n        while (this.roots.length) {\n            await this.removeNodeWithId(this.roots[0]);\n        }\n        for (const id of Object.keys(this.nodes)) {\n            //note: with an incomplete library there will be no roots\n            //so some of the nodes will have children, which will be recursively removed by\n            //removeNodeWithId(), so some IDs from the Object.keys(this.nodes) that runs this loop\n            //will already have been removed, so check if they exist before removing\n            if (this.hasNodeWithId(id)) {\n                await this.removeNodeWithId(id);\n            }\n        }\n        if (Object.keys(this.nodes).length > 0) {\n            throw new Error(\"Not all nodes were removed during a reset\");\n        }\n        if (this.connections.length > 0) {\n            throw new Error(\"Not all connections were removed during a reset\");\n        }\n    }\n    rename(newName) {\n        const oldName = this.name;\n        this.name = newName;\n        this.emit(\"renamed\", { oldName, newName });\n    }\n    setMetadata(key, data) {\n        this.metadata[key] = data;\n    }\n    getMetadata(key) {\n        if (!key)\n            return this.metadata;\n        return this.metadata[key];\n    }\n    static async createFromExportData(componentData) {\n        const componentModel = new ComponentModel(componentData.name);\n        if (componentData.metadata) {\n            for (const key in componentData.metadata) {\n                componentModel.setMetadata(key, componentData.metadata[key]);\n            }\n        }\n        componentData.ports &&\n            componentData.ports.forEach((port) => {\n                if (port.plug === \"input\" || port.plug === \"input/output\") {\n                    componentModel.addInputPort(port);\n                }\n                if (port.plug === \"output\" || port.plug === \"input/output\") {\n                    componentModel.addOutputPort(port);\n                }\n            });\n        if (componentData.nodes) {\n            for (const node of componentData.nodes) {\n                await componentModel.importEditorNodeData(node);\n            }\n        }\n        componentData.connections &&\n            componentData.connections.forEach((connection) => componentModel.addConnection(connection));\n        componentData.roots &&\n            componentData.roots.forEach((root) => componentModel.addRootId(root));\n        return componentModel;\n    }\n}\n\nclass GraphModel extends EventSender {\n    constructor() {\n        super();\n        this.componentToBundleMap = new Map();\n        this.variants = [];\n        this.components = {};\n        this.settings = {};\n        this.metadata = {};\n    }\n    async importComponentFromEditorData(componentData) {\n        const componentModel = await ComponentModel.createFromExportData(componentData);\n        this.addComponent(componentModel);\n    }\n    getBundleContainingComponent(name) {\n        return this.componentToBundleMap.get(name);\n    }\n    getBundlesContainingSheet(sheetName) {\n        const bundles = new Set();\n        for (const name of this.componentToBundleMap.keys()) {\n            const isOnDefaultSheet = name.indexOf(\"/#\") !== 0;\n            const isMatch = (isOnDefaultSheet && sheetName === \"Default\") ||\n                (!isOnDefaultSheet && name.indexOf(\"/#\" + sheetName) === 0);\n            if (isMatch) {\n                bundles.add(this.componentToBundleMap.get(name));\n            }\n        }\n        return Array.from(bundles);\n    }\n    getBundleDependencies(bundleName) {\n        const result = new Set();\n        const recurse = (name) => {\n            var _a;\n            const bundle = (_a = this.componentIndex) === null || _a === void 0 ? void 0 : _a[name];\n            if (bundle) {\n                for (const dep of bundle.dependencies) {\n                    if (!result.has(dep)) {\n                        result.add(dep);\n                        recurse(dep);\n                    }\n                }\n            }\n        };\n        recurse(bundleName);\n        return Array.from(result);\n    }\n    async importEditorData(exportData) {\n        this.componentIndex = exportData.componentIndex;\n        this.routerIndex = exportData.routerIndex;\n        this.componentToBundleMap = new Map();\n        for (const bundleName in exportData.componentIndex) {\n            const bundle = exportData.componentIndex[bundleName];\n            for (const componentName of bundle.components) {\n                this.componentToBundleMap.set(componentName, bundleName);\n            }\n        }\n        this.variants = exportData.variants || [];\n        exportData.settings && this.setSettings(exportData.settings);\n        exportData.metadata && this.setAllMetaData(exportData.metadata);\n        for (const component of exportData.components) {\n            await this.importComponentFromEditorData(component);\n        }\n        this.setRootComponentName(exportData.rootComponent);\n    }\n    setRootComponentName(componentName) {\n        this.rootComponent = componentName;\n        this.emit(\"rootComponentNameUpdated\", componentName);\n    }\n    getNodesWithType(type) {\n        let nodes = [];\n        const componentNames = Object.keys(this.components);\n        for (let i = 0; i < componentNames.length; i++) {\n            const component = this.components[componentNames[i]];\n            nodes = nodes.concat(component.getNodesWithType(type));\n        }\n        return nodes;\n    }\n    getComponentWithName(type) {\n        return this.components[type];\n    }\n    hasComponentWithName(type) {\n        return this.components[type] ? true : false;\n    }\n    getAllComponents() {\n        return Object.keys(this.components).map((name) => {\n            return this.components[name];\n        });\n    }\n    getAllNodes() {\n        let nodes = [];\n        const componentNames = Object.keys(this.components);\n        for (let i = 0; i < componentNames.length; i++) {\n            const component = this.components[componentNames[i]];\n            nodes = nodes.concat(component.getAllNodes());\n        }\n        return nodes;\n    }\n    addComponent(component) {\n        this.components[component.name] = component;\n        this.getNodesWithType(component.name).forEach(this._addComponentPorts.bind(this));\n        component.getAllNodes().forEach(this._onNodeAdded.bind(this));\n        component.on(\"nodeAdded\", this._onNodeAdded.bind(this), this);\n        component.on(\"nodeRemoved\", this._onNodeRemoved.bind(this), this);\n        component.on(\"nodeWasRemoved\", this._onNodeWasRemoved.bind(this), this);\n        this.emit(\"componentAdded\", component);\n    }\n    async removeComponentWithName(componentName) {\n        if (!componentName) {\n            return;\n        }\n        if (this.components.hasOwnProperty(componentName) === false) {\n            console.error(\"GraphModel: Component with name \" + componentName + \" not in graph\");\n            return;\n        }\n        const component = this.components[componentName];\n        await component.reset();\n        component.removeAllListeners();\n        delete this.components[component.name];\n        this.emit(\"componentRemoved\", component);\n    }\n    renameComponent(componentName, newName) {\n        if (this.components.hasOwnProperty(componentName) === false) {\n            console.error(\"GraphModel: Component with name \" + componentName + \" not in graph\");\n            return;\n        }\n        this.getNodesWithType(componentName).forEach(function (nodeModel) {\n            nodeModel.type = newName;\n        });\n        const component = this.components[componentName];\n        component.rename(newName);\n        delete this.components[componentName];\n        this.components[newName] = component;\n        this.emit(\"componentRenamed\", component);\n    }\n    _addComponentPorts(node) {\n        if (this.components.hasOwnProperty(node.type)) {\n            const component = this.components[node.type];\n            const inputPorts = component.getInputPorts();\n            const outputPorts = component.getOutputPorts();\n            Object.keys(inputPorts).forEach((portName) => {\n                node.addInputPort(inputPorts[portName]);\n            });\n            Object.keys(outputPorts).forEach((portName) => {\n                node.addOutputPort(outputPorts[portName]);\n            });\n        }\n    }\n    _onNodeAdded(node) {\n        this._addComponentPorts(node);\n        this.emit(\"nodeAdded\", node);\n        this.emit(\"nodeAdded.\" + node.type, node);\n    }\n    _onNodeRemoved(node) {\n        this.emit(\"nodeRemoved\", node);\n        this.emit(\"nodeRemoved.\" + node.type, node);\n    }\n    _onNodeWasRemoved(node) {\n        this.emit(\"nodeWasRemoved\", node);\n        this.emit(\"nodeWasRemoved.\" + node.type, node);\n    }\n    async reset() {\n        for (const componentName of Object.keys(this.components)) {\n            await this.removeComponentWithName(componentName);\n        }\n        this.setSettings({});\n    }\n    isEmpty() {\n        return Object.keys(this.components).length === 0;\n    }\n    setSettings(settings) {\n        this.settings = settings;\n        this.emit(\"projectSettingsChanged\", settings);\n    }\n    getSettings() {\n        return this.settings;\n    }\n    setAllMetaData(metadata) {\n        for (const p in metadata) {\n            this.setMetaData(p, metadata[p]);\n        }\n    }\n    setMetaData(key, data) {\n        if (this.metadata[key] &&\n            JSON.stringify(this.metadata[key]) === JSON.stringify(data)) {\n            return;\n        }\n        this.metadata[key] = data;\n        this.emit(\"metadataChanged\", { key, data });\n        this.emit(\"metadataChanged.\" + key, data);\n    }\n    getMetaData(key) {\n        if (key)\n            return this.metadata[key];\n        return this.metadata;\n    }\n    getVariants() {\n        return this.variants || [];\n    }\n    getVariant(typename, name) {\n        return this.variants.find((v) => v.name === name && v.typename === typename);\n    }\n    updateVariant(variant) {\n        const i = this.variants.findIndex((v) => v.name === variant.name && v.typename === variant.typename);\n        if (i !== -1)\n            this.variants.splice(i, 1);\n        this.variants.push(variant);\n        this.emit(\"variantUpdated\", variant);\n    }\n    updateVariantParameter(variantName, variantTypeName, parameterName, parameterValue, state) {\n        const variant = this.getVariant(variantTypeName, variantName);\n        if (!variant) {\n            console.log(\"updateVariantParameter: can't find variant\", variantName, variantTypeName);\n            return;\n        }\n        if (!state) {\n            if (parameterValue === undefined) {\n                delete variant.parameters[parameterName];\n            }\n            else {\n                variant.parameters[parameterName] = parameterValue;\n            }\n        }\n        else {\n            if (!variant.stateParameters.hasOwnProperty(state)) {\n                variant.stateParameters[state] = {};\n            }\n            if (parameterValue === undefined) {\n                delete variant.stateParameters[state][parameterName];\n            }\n            else {\n                variant.stateParameters[state][parameterName] = parameterValue;\n            }\n        }\n        this.emit(\"variantUpdated\", variant);\n    }\n    updateVariantDefaultStateTransition(variantName, variantTypeName, transition, state) {\n        const variant = this.getVariant(variantTypeName, variantName);\n        if (!variant)\n            return;\n        variant.defaultStateTransitions[state] = transition;\n        this.emit(\"variantUpdated\", variant);\n    }\n    updateVariantStateTransition(args) {\n        const { variantTypeName, variantName, state, parameterName, curve } = args;\n        const variant = this.getVariant(variantTypeName, variantName);\n        if (!variant)\n            return;\n        if (!variant.stateTransitions[state]) {\n            variant.stateTransitions[state] = {};\n        }\n        variant.stateTransitions[state][parameterName] = curve;\n    }\n    deleteVariant(typename, name) {\n        const i = this.variants.findIndex((v) => v.name === name && v.typename === typename);\n        if (i !== -1)\n            this.variants.splice(i, 1);\n    }\n}\n\nfunction difference(array1, array2) {\n    const valueSet = new Set(array2);\n    return array1.filter((e) => !valueSet.has(e));\n}\nasync function handleEvent(context, graphModel, event) {\n    function applyPortDelta(nodeModel, newPorts) {\n        const inputPorts = {};\n        const outputPorts = {};\n        newPorts.forEach((port) => {\n            // TODO: WTF...\n            // if (port && port.plug === \"outputs\") {\n            //   port.plug = \"output\";\n            // }\n            if (port.plug === \"input\" || port.plug === \"input/output\") {\n                inputPorts[port.name] = port;\n            }\n            if (port.plug === \"output\" || port.plug === \"input/output\") {\n                outputPorts[port.name] = port;\n            }\n        });\n        const existingInputs = Object.keys(nodeModel.getInputPorts());\n        const inputPortsToRemove = difference(existingInputs, Object.keys(inputPorts));\n        const inputPortsToAdd = difference(Object.keys(inputPorts), existingInputs);\n        nodeModel.updateInputPortTypes(inputPorts);\n        inputPortsToRemove.forEach(nodeModel.removeInputPortWithName.bind(nodeModel));\n        inputPortsToAdd.forEach((portName) => {\n            var _a;\n            nodeModel.addInputPort(inputPorts[portName]);\n            if (nodeModel instanceof NodeModel) {\n                if ((_a = nodeModel.parameters) === null || _a === void 0 ? void 0 : _a.hasOwnProperty(portName)) {\n                    setInputValueOnNodeInstancesWithModel(context.rootComponent.nodeScope, nodeModel, portName, nodeModel.parameters[portName]);\n                }\n            }\n        });\n        nodeModel.updateOutputPortTypes(outputPorts);\n        const existingOutputs = Object.keys(nodeModel.getOutputPorts());\n        const outputPortsToRemove = difference(existingOutputs, Object.keys(outputPorts));\n        const outputPortsToAdd = difference(Object.keys(outputPorts), existingOutputs);\n        outputPortsToRemove.forEach(nodeModel.removeOutputPortWithName.bind(nodeModel));\n        outputPortsToAdd.forEach((portName) => {\n            nodeModel.addOutputPort(outputPorts[portName]);\n        });\n    }\n    function setInputValueOnNodeInstancesWithModel(nodeScope, nodeModel, port, value) {\n        const nodes = nodeScope.getNodesWithIdRecursive(nodeModel.id);\n        nodes.forEach((node) => {\n            node.queueInput(port, value);\n        });\n    }\n    let componentModel;\n    if (event.componentName) {\n        componentModel = graphModel.getComponentWithName(event.componentName);\n    }\n    if (!componentModel) {\n        return;\n    }\n    // TODO: WTF...\n    // if (event.port && event.port.plug === \"outputs\") {\n    //   event.port.plug = \"output\";\n    // }\n    const eventHandlers = {\n        nodeAdded: (event) => {\n            componentModel === null || componentModel === void 0 ? void 0 : componentModel.importEditorNodeData(event.model, event.parentId, event.childIndex);\n        },\n        nodeRemoved: async (event) => {\n            if (componentModel === null || componentModel === void 0 ? void 0 : componentModel.hasNodeWithId(event.model.id)) {\n                await componentModel.removeNodeWithId(event.model.id);\n            }\n        },\n        connectionAdded: (event) => {\n            componentModel === null || componentModel === void 0 ? void 0 : componentModel.addConnection(event.model);\n        },\n        connectionRemoved: (event) => {\n            if (!componentModel) {\n                return;\n            }\n            componentModel.removeConnection(event.model);\n            const targetNodeModel = componentModel.getNodeWithId(event.model.targetId);\n            if (componentModel.getConnectionsToPort(targetNodeModel.id, event.model.targetId).length === 0) {\n                let value = targetNodeModel.parameters[event.model.targetPort];\n                if (value === undefined) {\n                    value = context.getDefaultValueForInput(targetNodeModel.type, event.model.targetPort);\n                }\n                setInputValueOnNodeInstancesWithModel(context.rootComponent.nodeScope, targetNodeModel, event.model.targetPort, value);\n            }\n        },\n        parameterChanged: (event) => {\n            if (!componentModel) {\n                return;\n            }\n            const nodeModel = componentModel.getNodeWithId(event.nodeId);\n            if (nodeModel === undefined) {\n                console.log(\"parameterChanged: Unknown node id\", event);\n                return;\n            }\n            if (event.parameters) {\n                const allParams = new Set([\n                    ...Object.keys(event.parameters),\n                    ...Object.keys(event.oldParameters),\n                ]);\n                for (const param of allParams) {\n                    nodeModel.setParameter(param, event.parameters[param]);\n                }\n            }\n            if (event.parameterName) {\n                nodeModel.setParameter(event.parameterName, event.parameterValue, event.state);\n            }\n        },\n        nodeAttached: (event) => {\n            if (!componentModel) {\n                return;\n            }\n            componentModel.setNodeParent(componentModel.getNodeWithId(event.nodeId), componentModel.getNodeWithId(event.parentId), event.childIndex);\n        },\n        nodeDetached: (event) => {\n            if (!componentModel) {\n                return;\n            }\n            componentModel.setNodeParent(componentModel.getNodeWithId(event.nodeId), null);\n            componentModel.addRootId(event.nodeId);\n        },\n        componentAdded: (event) => {\n            graphModel.importComponentFromEditorData(event.model);\n        },\n        componentRemoved: async (event) => {\n            await graphModel.removeComponentWithName(event.componentName);\n        },\n        rootAdded: (event) => {\n            componentModel === null || componentModel === void 0 ? void 0 : componentModel.addRootId(event.nodeId);\n        },\n        portAdded: (event) => {\n            if (!componentModel) {\n                return;\n            }\n            const nodeModel = componentModel.getNodeWithId(event.nodeId);\n            if (!event.port || !nodeModel) {\n                return;\n            }\n            if (event.port.plug === \"input\" || event.port.plug === \"input/output\") {\n                nodeModel.addInputPort(event.port);\n                // TODO: Was here a bug before?\n                if (nodeModel.parameters.hasOwnProperty(event.port.name)) {\n                    setInputValueOnNodeInstancesWithModel(context.rootComponent.nodeScope, nodeModel, event.port.name, nodeModel.parameters[event.port.name]);\n                }\n            }\n            if (event.port.plug === \"output\" ||\n                event.port.plug === \"input/output\") {\n                nodeModel.addOutputPort(event.port);\n            }\n        },\n        portRemoved: (event) => {\n            if (!componentModel) {\n                return;\n            }\n            const nodeModel = componentModel.getNodeWithId(event.nodeId);\n            if (!event.port || !nodeModel) {\n                return;\n            }\n            if (event.port.plug === \"input\" || event.port.plug === \"input/output\") {\n                nodeModel.removeInputPortWithName(event.port.name);\n            }\n            if (event.port.plug === \"output\" ||\n                event.port.plug === \"input/output\") {\n                nodeModel.removeOutputPortWithName(event.port.name);\n            }\n        },\n        nodePortRenamed: (event) => {\n            if (!event.port || !componentModel) {\n                return;\n            }\n            if (event.port.plug === \"input\" || event.port.plug === \"input/output\") {\n                if (event.nodeId && event.oldName) {\n                    componentModel.renameInputPortOnNodeWithId(event.nodeId, event.oldName, event.port.name);\n                }\n            }\n            if (event.nodeId &&\n                event.oldName &&\n                (event.port.plug === \"output\" || event.port.plug === \"input/output\")) {\n                componentModel.renameOutputPortOnNodeWithId(event.nodeId, event.oldName, event.port.name);\n            }\n            const node = componentModel.getNodeWithId(event.nodeId);\n            if ((node === null || node === void 0 ? void 0 : node.type) === \"Component Inputs\") {\n                componentModel.addInputPort(event.port);\n                graphModel\n                    .getNodesWithType(componentModel.name)\n                    .forEach((componentInstance) => {\n                    var _a;\n                    componentInstance.component.renameInputPortOnNodeWithId(componentInstance.id, event.oldName, (_a = event.port) === null || _a === void 0 ? void 0 : _a.name);\n                });\n                componentModel.removeInputPortWithName(event.oldName);\n            }\n            else if ((node === null || node === void 0 ? void 0 : node.type) === \"Component Outputs\") {\n                componentModel.addOutputPort(event.port);\n                graphModel\n                    .getNodesWithType(componentModel.name)\n                    .forEach((componentInstance) => {\n                    var _a;\n                    componentInstance.component.renameOutputPortOnNodeWithId(componentInstance.id, event.oldName, (_a = event.port) === null || _a === void 0 ? void 0 : _a.name);\n                });\n                componentModel.removeOutputPortWithName(event.oldName);\n            }\n        },\n        componentPortsUpdated: (event) => {\n            if (componentModel) {\n                applyPortDelta(componentModel, event.ports);\n            }\n        },\n        instancePortsChanged: (event) => {\n            if (!componentModel.hasNodeWithId(event.nodeId))\n                return;\n            const nodeModel = componentModel.getNodeWithId(event.nodeId);\n            if (nodeModel) {\n                applyPortDelta(nodeModel, event.ports);\n            }\n        },\n        componentRenamed: (event) => {\n            graphModel.renameComponent(event.oldName, event.newName);\n        },\n        settingsChanged: (event) => {\n            graphModel.setSettings(event.settings);\n        },\n        metadataChanged: (event) => {\n            graphModel.setMetaData(event.key, event.data);\n        },\n        componentMetadataChanged: (event) => {\n            const c = graphModel.getComponentWithName(event.componentName);\n            if (!c)\n                return;\n            c.setMetadata(event.key, event.data);\n        },\n        variantParametersChanged: (event) => {\n            if (event.variant) {\n                graphModel.updateVariant(event.variant);\n            }\n            else {\n                graphModel.updateVariantParameter(event.variantName, event.variantTypeName, event.parameterName, event.parameterValue, event.state);\n                if (event.parameterValue === undefined) {\n                    const variant = graphModel.getVariant(event.variantTypeName, event.variantName);\n                    const nodes = context.rootComponent.nodeScope.getAllNodesWithVariantRecursive(variant);\n                    nodes.forEach((node) => {\n                        node.queueInput(event.parameterName, node.getParameter(event.parameterName));\n                    });\n                }\n            }\n        },\n        variantDeleted: (event) => {\n            graphModel.deleteVariant(event.variantTypeName, event.variantName);\n        },\n        variantChanged: (event) => {\n            const nodeModel = componentModel.getNodeWithId(event.nodeId);\n            if (nodeModel) {\n                const variant = graphModel.getVariant(nodeModel.type, event.variantName);\n                nodeModel.setVariant(variant);\n            }\n        },\n        variantRenamed: (event) => {\n            const variant = graphModel.getVariant(event.variantTypeName, event.oldVariantName);\n            if (variant === null || variant === void 0 ? void 0 : variant.variantName) {\n                variant.name = variant.variantName;\n            }\n        },\n        defaultStateTransitionChanged: (event) => {\n            const nodeModel = componentModel.getNodeWithId(event.nodeId);\n            nodeModel === null || nodeModel === void 0 ? void 0 : nodeModel.setDefaultStateTransition(event.curve, event.state);\n        },\n        stateTransitionsChanged: (event) => {\n            const nodeModel = componentModel.getNodeWithId(event.nodeId);\n            if (nodeModel && event.parameterName) {\n                nodeModel.setStateTransitionParamter(event.parameterName, event.curve, event.state);\n            }\n        },\n        variantDefaultStateTransitionChanged: (event) => {\n            graphModel.updateVariantDefaultStateTransition(event.variantName, event.variantTypeName, event.curve, event.state);\n        },\n        variantStateTransitionsChanged: (event) => {\n            graphModel.updateVariantStateTransition(event);\n        },\n        routerIndexChanged: (event) => {\n            graphModel.routerIndex = event.data;\n        },\n    };\n    if (eventHandlers.hasOwnProperty(event.type)) {\n        await eventHandlers[event.type](event);\n        context.scheduleUpdate();\n    }\n    else {\n        console.log(\"Unknown event\", event);\n    }\n}\n\nclass Services {\n}\nServices.events = new EventEmitter();\n\nfunction createSetter(args) {\n    let currentValue = false;\n    return function (value) {\n        value = value ? true : false;\n        // value changed from false to true\n        if (value && currentValue === false) {\n            // @ts-expect-error\n            args.valueChangedToTrue.call(this);\n        }\n        currentValue = value;\n    };\n}\n\n/**\n * Executes async functions with a concurrency limit\n * @param poolLimit Maximum number of concurrent executions\n * @param values Array of input values to process\n * @param iteratorFn Function to execute for each value\n * @returns Promise that resolves with array of results\n */\nasync function asyncPool(poolLimit, values, iteratorFn) {\n    const ret = [];\n    const executing = [];\n    for (const item of values) {\n        const p = Promise.resolve().then(() => iteratorFn(item, values));\n        ret.push(p);\n        if (poolLimit <= values.length) {\n            const e = p.then(() => {\n                executing.splice(executing.indexOf(e), 1);\n            });\n            executing.push(e);\n            if (executing.length >= poolLimit) {\n                await Promise.race(executing);\n            }\n        }\n    }\n    return Promise.all(ret);\n}\n\nfunction registerInput(object, metadata, name, input) {\n    if (object.hasOwnProperty(name)) {\n        throw new Error(\"Input property \" + name + \" already registered\");\n    }\n    if (!input.set && !input.valueChangedToTrue) {\n        input.set = () => { };\n    }\n    if (input.set) {\n        object[name] = {\n            set: input.set,\n        };\n        //types to keep in the input on the node instances\n        //color and textStyles are used for style updates\n        //array is for supporting eval:ing strings\n        const typesToSaveInInput = [\"color\", \"textStyle\", \"array\"];\n        typesToSaveInInput.forEach((type) => {\n            if (input.type && (input.type === type || input.type.name === type)) {\n                object[name].type = type;\n            }\n        });\n    }\n    if (input.setUnitType) {\n        object[name].setUnitType = input.setUnitType;\n    }\n    metadata.inputs = metadata.inputs || {};\n    metadata.inputs[name] = {\n        displayName: input.displayName,\n        editorName: input.editorName,\n        group: input.group,\n        type: input.type,\n        default: input.default,\n        index: input.index,\n        exportToEditor: input.hasOwnProperty(\"exportToEditor\")\n            ? input.exportToEditor\n            : true,\n        inputPriority: input.inputPriority || 0,\n        tooltip: input.tooltip,\n        tab: input.tab,\n        popout: input.popout,\n        allowVisualStates: input.allowVisualStates,\n        nodeDoubleClickAction: input.nodeDoubleClickAction,\n    };\n    if (input.valueChangedToTrue) {\n        metadata.inputs[name].type = {\n            name: \"signal\",\n            allowConnectionsOnly: true,\n        };\n    }\n}\nfunction registerInputs(object, metadata, inputs) {\n    Object.keys(inputs).forEach(function (inputName) {\n        registerInput(object, metadata, inputName, inputs[inputName]);\n    });\n}\nfunction registerNumberedInputs(node, numberedInputs) {\n    for (const inputName of Object.keys(numberedInputs)) {\n        registerNumberedInput(node, inputName, numberedInputs[inputName]);\n    }\n}\nfunction registerNumberedInput(node, name, input) {\n    const oldRegisterInputIfNeeded = node.registerInputIfNeeded;\n    node.registerInputIfNeeded = function (inputName) {\n        if (oldRegisterInputIfNeeded) {\n            oldRegisterInputIfNeeded.call(node, inputName);\n        }\n        if (node.hasInput(inputName) || !inputName.startsWith(name)) {\n            return;\n        }\n        const index = Number(inputName.slice(name.length + 1)); // inputName is \"nameOfInput xxx\" where xxx is the index\n        node.registerInput(inputName, {\n            type: input.type,\n            set: input.createSetter.call(node, index),\n        });\n    };\n}\nfunction registerOutputsMetadata(metadata, outputs) {\n    Object.keys(outputs).forEach(function (name) {\n        const output = outputs[name];\n        metadata.outputs = metadata.outputs || {};\n        metadata.outputs[name] = {\n            displayName: output.displayName,\n            editorName: output.editorName,\n            group: output.group,\n            type: output.type,\n            index: output.index,\n            exportToEditor: output.hasOwnProperty(\"exportToEditor\")\n                ? output.exportToEditor\n                : true,\n        };\n    });\n}\nfunction initializeDefaultValues(defaultValues, inputsMetadata) {\n    Object.keys(inputsMetadata).forEach((name) => {\n        const defaultValue = inputsMetadata[name].default;\n        if (defaultValue === undefined)\n            return;\n        if (inputsMetadata[name].type.defaultUnit) {\n            defaultValues[name] = {\n                unit: inputsMetadata[name].type.defaultUnit,\n                value: defaultValue,\n            };\n        }\n        else {\n            defaultValues[name] = defaultValue;\n        }\n    });\n}\nfunction defineNode(opts) {\n    if (!opts.category) {\n        throw new Error(\"Node must have a category\");\n    }\n    if (!opts.name) {\n        throw new Error(\"Node must have a name\");\n    }\n    const metadata = {\n        inputs: {},\n        outputs: {},\n        category: opts.category,\n        dynamicports: opts.dynamicports,\n        exportDynamicPorts: opts.exportDynamicPorts,\n        useVariants: opts.useVariants,\n        allowChildren: opts.allowChildren,\n        allowChildrenWithCategory: opts.allowChildrenWithCategory,\n        singleton: opts.singleton,\n        connectionPanel: opts.connectionPanel,\n        allowAsChild: opts.allowAsChild,\n        visualStates: opts.visualStates,\n        panels: opts.panels,\n        color: opts.color,\n        usePortAsLabel: opts.usePortAsLabel,\n        portLabelTruncationMode: opts.portLabelTruncationMode,\n        name: opts.name,\n        displayNodeName: opts.displayNodeName || opts.displayName,\n        deprecated: opts.deprecated,\n        haveComponentPorts: opts.haveComponentPorts,\n        version: opts.version,\n        module: opts.module,\n        docs: opts.docs,\n        allowAsExportRoot: opts.allowAsExportRoot,\n        nodeDoubleClickAction: opts.nodeDoubleClickAction,\n        searchTags: opts.searchTags,\n    };\n    opts._internal = opts._internal || {};\n    //prototypeExtensions - old API\n    //methods - new API\n    opts.prototypeExtensions = opts.methods || opts.prototypeExtensions || {};\n    opts.inputs = opts.inputs || {};\n    opts.outputs = opts.outputs || {};\n    opts.initialize = opts.initialize || function () { };\n    const inputs = {};\n    registerInputs(inputs, metadata, opts.inputs);\n    registerOutputsMetadata(metadata, opts.outputs);\n    class NodeConstructor extends Node {\n        constructor(context, id) {\n            super(context, id);\n        }\n    }\n    if (opts.prototypeExtensions) {\n        Object.keys(opts.prototypeExtensions).forEach(function (propName) {\n            // TODO: WTF is this junk?!\n            // @ts-expect-error\n            if (!opts.prototypeExtensions[propName].value) {\n                // @ts-expect-error\n                opts.prototypeExtensions[propName] = {\n                    // @ts-expect-error\n                    value: opts.prototypeExtensions[propName],\n                };\n            }\n        });\n    }\n    // @ts-ignore\n    Object.defineProperties(NodeConstructor.prototype, opts.prototypeExtensions);\n    Object.defineProperty(NodeConstructor.prototype, \"name\", {\n        value: opts.name,\n    });\n    if (opts.getInspectInfo)\n        NodeConstructor.prototype.getInspectInfo = opts.getInspectInfo;\n    if (opts.nodeScopeDidInitialize)\n        NodeConstructor.prototype.nodeScopeDidInitialize =\n            opts.nodeScopeDidInitialize;\n    const nodeDefinition = function (context, id, nodeScope) {\n        var _a;\n        const node = new NodeConstructor(context, id);\n        //create all inputs. Use the inputs object for setters that don't have state and can be shared\n        node._inputs = Object.create(inputs);\n        //all inputs that use the valueChangedToTrue have state and need to be instanced\n        if (opts.inputs) {\n            Object.keys(opts.inputs).forEach(function (name) {\n                const input = opts.inputs[name];\n                if (input.valueChangedToTrue) {\n                    node._inputs[name] = {\n                        set: createSetter({\n                            valueChangedToTrue: input.valueChangedToTrue,\n                        }),\n                    };\n                }\n            });\n            if (opts.outputs) {\n                Object.keys(opts.outputs).forEach(function (name) {\n                    const output = opts.outputs[name];\n                    if (output.type === \"signal\") {\n                        node.registerOutput(name, {\n                            getter() {\n                                //signals are always emitted as a sequence of false, true, so this getter is never used\n                                return undefined;\n                            },\n                        });\n                    }\n                    else {\n                        node.registerOutput(name, output);\n                    }\n                });\n                opts.numberedInputs &&\n                    registerNumberedInputs(node, opts.numberedInputs);\n                node.nodeScope = nodeScope;\n                initializeDefaultValues(node._inputValues, metadata.inputs || {});\n                (_a = opts.initialize) === null || _a === void 0 ? void 0 : _a.call(node);\n                return node;\n            }\n            Object.assign(nodeDefinition, { metadata });\n            if (opts.numberedInputs)\n                registerSetupFunctionForNumberedInputs(nodeDefinition, opts.name, opts.numberedInputs);\n            return nodeDefinition;\n        }\n    };\n    nodeDefinition.metadata = metadata;\n    return nodeDefinition;\n}\nfunction registerSetupFunctionForNumberedInputs(nodeDefinition, nodeType, numberedInputs) {\n    const inputNames = Object.keys(numberedInputs);\n    if (!inputNames.length)\n        return;\n    nodeDefinition.setupNumberedInputDynamicPorts = function (context, graphModel) {\n        const editorConnection = context.editorConnection;\n        if (!editorConnection || !editorConnection.isRunningLocally()) {\n            return;\n        }\n        function collectPorts(node, inputName, input) {\n            const connections = node.component\n                .getConnectionsTo(node.id)\n                .map((c) => c.targetPort);\n            const allPortNames = Object.keys(node.parameters).concat(connections);\n            const portNames = allPortNames.filter((p) => p.startsWith(inputName + \" \"));\n            //Figure out how many we need to create\n            //It needs to be the highest index + 1\n            //Only parameters with values are present, e.g. input 3 can be missing even if input 4 is defined\n            const maxIndex = portNames.length\n                ? 1 +\n                    Math.max(...portNames.map((p) => Number(p.slice(inputName.length + 1))))\n                : 0;\n            const numPorts = maxIndex + 1;\n            const ports = [];\n            for (let i = 0; i < numPorts; i++) {\n                const port = {\n                    name: inputName + \" \" + i,\n                    displayName: (input.displayPrefix || inputName) + \" \" + i,\n                    type: input.type,\n                    plug: \"input\",\n                    group: input.group,\n                };\n                if (input.hasOwnProperty(\"index\")) {\n                    port.index = input.index + i;\n                }\n                ports.push(port);\n            }\n            return ports;\n        }\n        function updatePorts(node) {\n            const ports = inputNames\n                .map((inputName) => collectPorts(node, inputName, numberedInputs[inputName]))\n                .flat();\n            editorConnection === null || editorConnection === void 0 ? void 0 : editorConnection.sendDynamicPorts(node.id, ports);\n        }\n        graphModel.on(\"nodeAdded.\" + nodeType, (node) => {\n            updatePorts(node);\n            node.on(\"parameterUpdated\", () => {\n                updatePorts(node);\n            });\n            node.on(\"inputConnectionAdded\", () => {\n                updatePorts(node);\n            });\n            node.on(\"inputConnectionRemoved\", () => {\n                updatePorts(node);\n            });\n        });\n    };\n}\nfunction extend(obj1, obj2) {\n    for (const p in obj2) {\n        if (p === \"initialize\" && obj1.initialize) {\n            const oldInit = obj1.initialize;\n            obj1.initialize = function () {\n                oldInit.call(this);\n                obj2.initialize.call(this);\n            };\n            // @ts-ignore\n        }\n        else if (obj2[p] && obj2[p].constructor === Object) {\n            // @ts-ignore\n            obj1[p] = extend(obj1[p] || {}, obj2[p]);\n        }\n        else if (obj2[p] &&\n            // @ts-ignore\n            obj2[p].constructor === Array &&\n            obj1[p] &&\n            // @ts-ignore\n            obj1[p].constructor == Array) {\n            obj1[p] = obj1[p].concat(obj2[p]);\n        }\n        else {\n            obj1[p] = obj2[p];\n        }\n    }\n    return obj1;\n}\n\nconst node$y = {\n    name: \"Component Inputs\",\n    shortDesc: \"This node is used to define the inputs of a component.\",\n    docs: \"https://docs.noodl.net/nodes/component-utilities/component-inputs\",\n    panels: [\n        {\n            name: \"PortEditor\",\n            context: [\"select\", \"connectFrom\"],\n            title: \"Inputs\",\n            plug: \"output\",\n            type: {\n                name: \"*\",\n            },\n            canArrangeInGroups: true,\n        },\n        {\n            name: \"PropertyEditor\",\n            hidden: true,\n        },\n    ],\n    getInspectInfo() {\n        var _a;\n        return {\n            type: \"value\",\n            value: (_a = this.nodeScope) === null || _a === void 0 ? void 0 : _a.componentOwner._internal.inputValues,\n        };\n    },\n    color: \"component\",\n    haveComponentPorts: true,\n    category: \"Component Utilities\",\n    methods: {\n        registerOutputIfNeeded(name) {\n            if (this.hasOutput(name)) {\n                return;\n            }\n            this.registerOutput(name, {\n                getter() {\n                    var _a;\n                    return (_a = this.nodeScope) === null || _a === void 0 ? void 0 : _a.componentOwner._internal.inputValues[name];\n                },\n            });\n        },\n        _updateDependencies() {\n            var _a, _b;\n            (_b = (_a = this.nodeScope) === null || _a === void 0 ? void 0 : _a.componentOwner) === null || _b === void 0 ? void 0 : _b.update();\n        },\n    },\n};\n\nvar componentinputs = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$y\n});\n\nconst node$x = {\n    category: \"Component Utilities\",\n    name: \"Component Outputs\",\n    shortDesc: \"This node is used to define the outputs of a component.\",\n    docs: \"https://docs.noodl.net/nodes/component-utilities/component-outputs\",\n    panels: [\n        {\n            name: \"PortEditor\",\n            context: [\"select\", \"connectTo\"],\n            title: \"Outputs\",\n            plug: \"input\",\n            type: {\n                name: \"*\",\n            },\n            canArrangeInGroups: true,\n        },\n        {\n            name: \"PropertyEditor\",\n            hidden: true,\n        },\n    ],\n    color: \"component\",\n    haveComponentPorts: true,\n    prototypeExtensions: {\n        registerInputIfNeeded: function (name) {\n            if (this.hasInput(name)) {\n                return;\n            }\n            this.registerInput(name, {\n                set(value) {\n                    var _a, _b;\n                    (_b = (_a = this.nodeScope) === null || _a === void 0 ? void 0 : _a.componentOwner) === null || _b === void 0 ? void 0 : _b.setOutputFromComponentOutput(name, value);\n                },\n            });\n        },\n    },\n};\n\nvar componentoutputs = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$x\n});\n\nclass Model {\n    constructor(id, data) {\n        this.id = id;\n        this.data = data;\n    }\n    static get(id) {\n        if (id === undefined)\n            id = Model.guid();\n        if (!Model.models[id]) {\n            Model.models[id] = new Model(id, {});\n            Model.proxies[id] = new Proxy(Model.models[id], Model._modelProxyHandler);\n        }\n        return Model.proxies[id];\n    }\n    static create(data) {\n        const modelData = data ? data : {};\n        const m = Model.get(modelData.id);\n        for (const key in modelData) {\n            if (key === \"id\")\n                continue;\n            m.set(key, modelData[key]);\n        }\n        return m;\n    }\n    static exists(id) {\n        return Model.models[id] !== undefined;\n    }\n    static instanceOf(collection) {\n        return collection instanceof Model || collection.target instanceof Model;\n    }\n    static guid() {\n        return randomString(10);\n    }\n    on(event, listener) {\n        if (!this.listeners)\n            this.listeners = {};\n        if (!this.listeners[event])\n            this.listeners[event] = [];\n        this.listeners[event].push(listener);\n    }\n    off(event, listener) {\n        if (!this.listeners)\n            return;\n        if (!this.listeners[event])\n            return;\n        const idx = this.listeners[event].indexOf(listener);\n        if (idx !== -1)\n            this.listeners[event].splice(idx, 1);\n    }\n    notify(event, args) {\n        if (!this.listeners)\n            return;\n        if (!this.listeners[event])\n            return;\n        const l = this.listeners[event].slice();\n        for (let i = 0; i < l.length; i++) {\n            l[i](args);\n        }\n    }\n    setAll(obj) {\n        for (const i in obj) {\n            if (i === \"id\")\n                continue;\n            if (this.data[i] !== obj[i]) {\n                const old = this.data[i];\n                this.data[i] = obj[i];\n                this.notify(\"change\", { name: i, value: obj[i], old });\n            }\n        }\n    }\n    fill(value = null) {\n        for (const key in this.data) {\n            if (key === \"id\")\n                continue;\n            const temp = this.data[key];\n            this.data[key] = value;\n            this.notify(\"change\", { name: key, value: this.data[key], old: temp });\n        }\n    }\n    set(name, value, args) {\n        if ((args === null || args === void 0 ? void 0 : args.resolve) && name.indexOf(\".\") !== -1) {\n            const path = name.split(\".\");\n            let model = this;\n            for (let i = 0; i < path.length - 1; i++) {\n                const v = model.get(path[i]);\n                if (Model.instanceOf(v))\n                    model = v;\n                else\n                    return;\n            }\n            model.set(path[path.length - 1], value);\n            return;\n        }\n        const forceChange = args === null || args === void 0 ? void 0 : args.forceChange;\n        const oldValue = this.data[name];\n        this.data[name] = value;\n        if ((forceChange || oldValue !== value) && !(args === null || args === void 0 ? void 0 : args.silent)) {\n            this.notify(\"change\", { name, value, old: oldValue });\n        }\n    }\n    getId() {\n        return this.id;\n    }\n    get(name, args) {\n        if ((args === null || args === void 0 ? void 0 : args.resolve) && name.indexOf(\".\") !== -1) {\n            const path = name.split(\".\");\n            let model = this;\n            for (let i = 0; i < path.length - 1; i++) {\n                const v = model.get(path[i]);\n                if (Model.instanceOf(v))\n                    model = v;\n                else\n                    return;\n            }\n            return model.get(path[path.length - 1]);\n        }\n        return this.data[name];\n    }\n    toJSON() {\n        return Object.assign({}, this.data, { id: this.id });\n    }\n}\nModel._models = {};\nModel.models = Model._models;\nModel.proxies = {};\nModel._modelProxyHandler = {\n    get: function (target, prop, receiver) {\n        if (typeof target[prop] === \"function\")\n            // @ts-expect-error\n            return target[prop].bind(target);\n        else if (prop in target)\n            return Reflect.get(target, prop, receiver);\n        else\n            return target.get(prop.toString());\n    },\n    set: function (obj, prop, value) {\n        if (prop === \"_class\") {\n            obj._class = value;\n        }\n        else if (prop === \"id\") {\n            console.log(`Noodl.Object warning: id is readonly (Id is ${obj.id}, trying to set to ${value})`);\n            return true;\n        }\n        else {\n            obj.set(prop.toString(), value);\n        }\n        return true;\n    },\n    ownKeys(target) {\n        return Reflect.ownKeys(target.data);\n    },\n    getOwnPropertyDescriptor(target, prop) {\n        return Object.getOwnPropertyDescriptor(target.data, prop.toString());\n    },\n};\nclass ModelScope {\n    constructor() {\n        this.models = {};\n        this.proxies = {};\n    }\n    get(id) {\n        if (id === undefined)\n            id = Model.guid();\n        if (!this.models[id]) {\n            this.models[id] = new Model(id, {});\n            this.proxies[id] = new Proxy(this.models[id], Model._modelProxyHandler);\n        }\n        return this.proxies[id];\n    }\n    create(data) {\n        const modelData = data ? data : {};\n        const m = this.get(modelData.id);\n        for (const key in modelData) {\n            if (key === \"id\")\n                continue;\n            m.set(key, modelData[key]);\n        }\n        return m;\n    }\n    exists(id) {\n        return this.models[id] !== undefined;\n    }\n    instanceOf(collection) {\n        return collection instanceof Model || collection.target instanceof Model;\n    }\n    guid() {\n        return randomString(10);\n    }\n    reset() {\n        this.models = {};\n        this.proxies = {};\n        delete this._cloudStore;\n    }\n}\n\nfunction sendSignalOnInput(itemNode, name) {\n    itemNode.queueInput(name, true); // send signal\n    itemNode.queueInput(name, false);\n}\nconst node$w = {\n    name: \"RunTasks\",\n    displayNodeName: \"Run Tasks\",\n    docs: \"https://docs.noodl.net/nodes/data/run-tasks\",\n    color: \"data\",\n    category: \"Data\",\n    initialize() {\n        this._internal = {\n            queuedOperations: [],\n            state: \"idle\",\n            maxRunningTasks: 10,\n            activeTasks: new Map(), //id => ComponentInstanceNode\n        };\n    },\n    inputs: {\n        items: {\n            group: \"Data\",\n            displayName: \"Items\",\n            type: \"array\",\n            set(value) {\n                if (!value)\n                    return;\n                if (value === this._internal.items)\n                    return;\n                this._internal.items = value;\n            },\n        },\n        stopOnFailure: {\n            group: \"General\",\n            displayName: \"Stop On Failure\",\n            type: \"boolean\",\n            default: false,\n            set(value) {\n                this._internal.stopOnFailure = value;\n            },\n        },\n        maxRunningTasks: {\n            group: \"General\",\n            displayName: \"Max Running Tasks\",\n            type: \"number\",\n            default: 10,\n            set(value) {\n                this._internal.maxRunningTasks = value;\n            },\n        },\n        taskTemplate: {\n            type: \"component\",\n            displayName: \"Template\",\n            group: \"General\",\n            set(value) {\n                this._internal.template = value;\n            },\n        },\n        run: {\n            group: \"General\",\n            displayName: \"Do\",\n            type: \"signal\",\n            valueChangedToTrue() {\n                // @ts-expect-error\n                this.scheduleRun();\n            },\n        },\n        abort: {\n            group: \"General\",\n            displayName: \"Abort\",\n            type: \"signal\",\n            valueChangedToTrue() {\n                // @ts-expect-error\n                this.scheduleAbort();\n            },\n        },\n    },\n    outputs: {\n        success: {\n            type: \"signal\",\n            group: \"Events\",\n            displayName: \"Success\",\n        },\n        failure: {\n            type: \"signal\",\n            group: \"Events\",\n            displayName: \"Failure\",\n        },\n        done: {\n            type: \"signal\",\n            group: \"Events\",\n            displayName: \"Done\",\n        },\n        aborted: {\n            type: \"signal\",\n            group: \"Events\",\n            displayName: \"Aborted\",\n        },\n    },\n    methods: {\n        scheduleRun() {\n            const internal = this._internal;\n            if (!internal.hasScheduledRun) {\n                internal.hasScheduledRun = true;\n                this.scheduleAfterInputsHaveUpdated(() => {\n                    // @ts-expect-error\n                    this._queueOperation(() => {\n                        internal.hasScheduledRun = false;\n                        // @ts-expect-error\n                        this.run();\n                    });\n                });\n            }\n        },\n        scheduleAbort() {\n            const internal = this._internal;\n            if (!internal.hasScheduledAbort) {\n                internal.hasScheduledAbort = true;\n                this.scheduleAfterInputsHaveUpdated(() => {\n                    // @ts-expect-error\n                    this._queueOperation(() => {\n                        internal.hasScheduledAbort = false;\n                        // @ts-expect-error\n                        this.abort();\n                    });\n                });\n            }\n        },\n        async createTaskComponent(item) {\n            const internal = this._internal;\n            const modelScope = this.nodeScope.modelScope || Model;\n            const model = modelScope.create(item);\n            const itemNode = await this.nodeScope.createNode(internal.template, guid(), {\n                _forEachModel: model,\n                _forEachNode: this,\n            });\n            // This is needed to make sure any action connected to \"Do\"\n            // is not run directly\n            const _isInputConnected = itemNode.isInputConnected.bind(itemNode);\n            itemNode.isInputConnected = (name) => {\n                if (name === \"Do\")\n                    return true;\n                return _isInputConnected(name);\n            };\n            // Set the Id as an input\n            if (itemNode.hasInput(\"Id\")) {\n                itemNode.setInputValue(\"Id\", model.getId());\n            }\n            if (itemNode.hasInput(\"id\")) {\n                itemNode.setInputValue(\"id\", model.getId());\n            }\n            // Push all other values also as inputs\n            // if they exist as component inputs\n            for (const inputKey in itemNode._inputs) {\n                if (model.data[inputKey] !== undefined)\n                    itemNode.setInputValue(inputKey, model.data[inputKey]);\n            }\n            // capture signals\n            itemNode._internal.creatorCallbacks = {\n                onOutputChanged: (name, value, oldValue) => {\n                    if ((oldValue === false || oldValue === undefined) &&\n                        value === true) {\n                        // @ts-expect-error\n                        this.itemOutputSignalTriggered(name, model, itemNode);\n                    }\n                },\n            };\n            return itemNode;\n        },\n        async startTask(task) {\n            const internal = this._internal;\n            try {\n                // @ts-expect-error\n                const taskComponent = await this.createTaskComponent(task);\n                // @ts-expect-error\n                internal.runningTasks++;\n                sendSignalOnInput(taskComponent, \"Do\");\n                internal.activeTasks.set(taskComponent.id, taskComponent);\n            }\n            catch (e) {\n                // Something went wrong starting the task\n                console.log(e);\n            }\n        },\n        async run() {\n            const internal = this._internal;\n            if (this.context.editorConnection) {\n                if (internal.state !== \"idle\") {\n                    this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, \"run-tasks\", {\n                        message: \"Cannot start when not in idle mode\",\n                    });\n                }\n                else if (!internal.template) {\n                    this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, \"run-tasks\", {\n                        message: \"No task template specified.\",\n                    });\n                }\n                else if (!internal.items) {\n                    this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, \"run-tasks\", {\n                        message: \"No items array provided.\",\n                    });\n                }\n                else {\n                    this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, \"run-tasks\");\n                }\n            }\n            if (internal.state !== \"idle\") {\n                return;\n            }\n            if (!internal.template) {\n                return;\n            }\n            if (!internal.items) {\n                return;\n            }\n            internal.state = \"running\";\n            internal.numTasks = internal.items.length;\n            internal.failedTasks = 0;\n            internal.completedTasks = 0;\n            // @ts-expect-error\n            internal.queuedTasks = [].concat(internal.items);\n            internal.runningTasks = 0;\n            // No tasks\n            if (internal.items.length === 0) {\n                this.sendSignalOnOutput(\"success\");\n                internal.state = \"idle\";\n            }\n            // Start tasks\n            for (let i = 0; i < Math.min(internal.maxRunningTasks, internal.queuedTasks.length); i++) {\n                const task = internal.queuedTasks.shift();\n                if (!task)\n                    break;\n                // @ts-expect-error\n                this.startTask(task);\n            }\n        },\n        abort() {\n            const internal = this._internal;\n            internal.state = \"aborted\";\n        },\n        itemOutputSignalTriggered(name, model, itemNode) {\n            const internal = this._internal;\n            if (internal.state === \"idle\") {\n                // Signal while we are not running is ignored\n                return;\n            }\n            const checkDone = () => {\n                if (internal.state === \"aborted\") {\n                    this.sendSignalOnOutput(\"aborted\");\n                    internal.state = \"idle\";\n                    return;\n                }\n                if (internal.completedTasks === internal.numTasks) {\n                    if (internal.failedTasks === 0)\n                        this.sendSignalOnOutput(\"success\");\n                    else\n                        this.sendSignalOnOutput(\"failure\");\n                    this.sendSignalOnOutput(\"done\");\n                    internal.state = \"idle\";\n                }\n                else {\n                    if (internal.stopOnFailure) {\n                        // Only continue if there are no failed tasks, otherwise aborted\n                        if (internal.failedTasks === 0) {\n                            // @ts-expect-error\n                            internal.runningTasks++;\n                            // @ts-expect-error\n                            const task = internal.queuedTasks.shift();\n                            // @ts-expect-error\n                            if (task)\n                                this.startTask(task);\n                        }\n                        else {\n                            this.sendSignalOnOutput(\"failure\");\n                            this.sendSignalOnOutput(\"aborted\");\n                        }\n                    }\n                    else {\n                        // @ts-expect-error\n                        internal.runningTasks++;\n                        // @ts-expect-error\n                        const task = internal.queuedTasks.shift();\n                        // @ts-expect-error\n                        if (task)\n                            this.startTask(task);\n                    }\n                }\n            };\n            if (name === \"Success\") {\n                // @ts-expect-error\n                internal.completedTasks++;\n                // @ts-expect-error\n                internal.runningTasks--;\n                checkDone();\n            }\n            else if (name === \"Failure\") {\n                // @ts-expect-error\n                internal.completedTasks++;\n                // @ts-expect-error\n                internal.failedTasks++;\n                // @ts-expect-error\n                internal.runningTasks--;\n                checkDone();\n            }\n            internal.activeTasks.delete(itemNode.id);\n            this.nodeScope.deleteNode(itemNode);\n        },\n        _queueOperation(op) {\n            this._internal.queuedOperations.push(op);\n            // @ts-expect-error\n            this._runQueueOperations();\n        },\n        async _runQueueOperations() {\n            // @ts-expect-error\n            if (this.runningOperations) {\n                return;\n            }\n            // @ts-expect-error\n            this.runningOperations = true;\n            while (this._internal.queuedOperations.length) {\n                const op = this._internal.queuedOperations.shift();\n                // @ts-expect-error\n                await op();\n            }\n            // @ts-expect-error\n            this.runningOperations = false;\n        },\n    },\n    // @ts-expect-error\n    _deleteAllTasks() {\n        for (const taskComponent of this._internal.activeTasks) {\n            // @ts-expect-error\n            this.nodeScope.deleteNode(taskComponent);\n        }\n        this._internal.activeTasks.clear();\n    },\n    _onNodeDeleted() {\n        Node.prototype._onNodeDeleted.call(this);\n        // @ts-expect-error\n        this._deleteAllTasks();\n    },\n};\n\nvar runtasks = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$w\n});\n\nconst defaultRequestScript = \"\" +\n    \"//Add custom code to setup the request object before the request\\n\" +\n    \"//is made.\\n\" +\n    \"//\\n\" +\n    \"//*Request.resource     contains the resource path of the request.\\n\" +\n    \"//*Request.method       contains the method, GET, POST, PUT or DELETE.\\n\" +\n    \"//*Request.headers      is a map where you can add additional headers.\\n\" +\n    \"//*Request.parameters   is a map the parameters that will be appended\\n\" +\n    \"//                      to the url.\\n\" +\n    \"//*Request.content      contains the content of the request as a javascript\\n\" +\n    \"//                      object.\\n\" +\n    \"//\\n\" +\n    \"//*Inputs and *Outputs contain the inputs and outputs of the node.\\n\";\nconst defaultResponseScript = \"\" +\n    \"// Add custom code to convert the response content to outputs\\n\" +\n    \"//\\n\" +\n    \"//*Response.status    The status code of the response\\n\" +\n    \"//*Response.content   The content of the response as a javascript\\n\" +\n    \"//                    object.\\n\" +\n    \"//*Response.request   The request object that resulted in the response.\\n\" +\n    \"//\\n\" +\n    \"//*Inputs and *Outputs contain the inputs and outputs of the node.\\n\";\nconst node$v = {\n    name: \"REST2\",\n    displayNodeName: \"REST\",\n    docs: \"https://docs.noodl.net/nodes/data/rest\",\n    category: \"Data\",\n    color: \"data\",\n    searchTags: [\"http\", \"request\", \"fetch\"],\n    initialize() {\n        this._internal.inputValues = {};\n        this._internal.outputValues = {};\n        this._internal.outputValuesProxy = new Proxy(this._internal.outputValues, {\n            set: (obj, prop, value) => {\n                if (value !== this._internal.outputValues[prop]) {\n                    // @ts-expect-error\n                    this.registerOutputIfNeeded(\"out-\" + prop);\n                    this._internal.outputValues[prop] = value;\n                    this.flagOutputDirty(\"out-\" + prop);\n                }\n                return true;\n            },\n        });\n        this._internal.self = {};\n    },\n    getInspectInfo() {\n        return this._internal.inspectData\n            ? { type: \"value\", value: this._internal.inspectData }\n            : { type: \"text\", value: \"[Not executed yet]\" };\n    },\n    inputs: {\n        resource: {\n            type: \"string\",\n            displayName: \"Resource\",\n            group: \"Request\",\n            default: \"/\",\n            set(value) {\n                this._internal.resource = value;\n            },\n        },\n        method: {\n            type: {\n                name: \"enum\",\n                enums: [\n                    { label: \"GET\", value: \"GET\" },\n                    { label: \"POST\", value: \"POST\" },\n                    { label: \"PUT\", value: \"PUT\" },\n                    { label: \"PATCH\", value: \"PATCH\" },\n                    { label: \"DELETE\", value: \"DELETE\" },\n                ],\n            },\n            displayName: \"Method\",\n            group: \"Request\",\n            default: \"GET\",\n            set(value) {\n                this._internal.method = value;\n            },\n        },\n        requestScript: {\n            type: {\n                name: \"string\",\n                allowEditOnly: true,\n                codeeditor: \"javascript\",\n            },\n            displayName: \"Request\",\n            default: defaultRequestScript,\n            group: \"Scripts\",\n            set(script) {\n                try {\n                    this._internal.requestFunc = new Function(\"Inputs\", \"Outputs\", \"Request\", script);\n                }\n                catch (e) {\n                    console.log(e);\n                }\n            },\n        },\n        responseScript: {\n            type: {\n                name: \"string\",\n                allowEditOnly: true,\n                codeeditor: \"javascript\",\n            },\n            displayName: \"Response\",\n            default: defaultResponseScript,\n            group: \"Scripts\",\n            set(script) {\n                try {\n                    this._internal.responseFunc = new Function(\"Inputs\", \"Outputs\", \"Response\", script);\n                }\n                catch (e) {\n                    console.log(e);\n                }\n            },\n        },\n        fetch: {\n            type: \"signal\",\n            displayName: \"Fetch\",\n            group: \"Actions\",\n            valueChangedToTrue() {\n                // @ts-expect-error\n                this.scheduleFetch();\n            },\n        },\n        cancel: {\n            type: \"signal\",\n            displayName: \"Cancel\",\n            group: \"Actions\",\n            valueChangedToTrue() {\n                // @ts-expect-error\n                this.cancelFetch();\n            },\n        },\n    },\n    outputs: {\n        failure: {\n            type: \"signal\",\n            displayName: \"Failure\",\n            group: \"Events\",\n        },\n        success: {\n            type: \"signal\",\n            displayName: \"Success\",\n            group: \"Events\",\n        },\n        canceled: {\n            type: \"signal\",\n            displayName: \"Canceled\",\n            group: \"Events\",\n        },\n    },\n    prototypeExtensions: {\n        getScriptOutputValue(name) {\n            return this._internal.outputValues[name];\n        },\n        setScriptInputValue(name, value) {\n            return (this._internal.inputValues[name] = value);\n        },\n        registerOutputIfNeeded(name) {\n            if (this.hasOutput(name)) {\n                return;\n            }\n            if (name.startsWith(\"out-\"))\n                return this.registerOutput(name, {\n                    // @ts-expect-error\n                    getter: this.getScriptOutputValue.bind(this, name.substring(\"out-\".length)),\n                });\n        },\n        registerInputIfNeeded(name) {\n            if (this.hasInput(name)) {\n                return;\n            }\n            if (name.startsWith(\"in-\"))\n                return this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this.setScriptInputValue.bind(this, name.substring(\"in-\".length)),\n                });\n        },\n        scheduleFetch() {\n            const internal = this._internal;\n            if (!internal.hasScheduledFetch) {\n                internal.hasScheduledFetch = true;\n                // @ts-expect-error\n                this.scheduleAfterInputsHaveUpdated(this.doFetch.bind(this));\n            }\n        },\n        doResponse(status, response, request) {\n            if (this._internal.responseFunc) {\n                this._internal.responseFunc.apply(this._internal.self, [\n                    this._internal.inputValues,\n                    this._internal.outputValuesProxy,\n                    { status, content: response, request },\n                ]);\n            }\n            this._internal.inspectData = { status, content: response };\n            if (status >= 200 && status < 300) {\n                this.sendSignalOnOutput(\"success\");\n            }\n            else {\n                this.sendSignalOnOutput(\"failure\");\n            }\n        },\n        doExternalFetch(request) {\n            let url = request.resource;\n            if (Object.keys(request.parameters).length > 0) {\n                const parameters = Object.keys(request.parameters).map((p) => {\n                    return p + \"=\" + encodeURIComponent(request.parameters[p]);\n                });\n                url += \"?\" + parameters.join(\"&\");\n            }\n            // @ts-expect-error\n            if (typeof _noodl_cloud_runtime_version === \"undefined\") {\n                const xhr = new XMLHttpRequest();\n                // @ts-expect-error\n                this._xhr = xhr;\n                xhr.open(request.method, url, true);\n                for (const header in request.headers) {\n                    xhr.setRequestHeader(header, request.headers[header]);\n                }\n                xhr.onreadystatechange = () => {\n                    let sentResponse = false;\n                    if (xhr.readyState === 4) {\n                        const statusCode = xhr.status;\n                        const responseType = xhr.getResponseHeader(\"content-type\");\n                        const rawResponse = xhr.response;\n                        // @ts-expect-error\n                        delete this._xhr;\n                        if (responseType) {\n                            // @ts-expect-error\n                            responseType = responseType.toLowerCase();\n                            const responseData = responseType.indexOf(\"json\") !== -1\n                                ? JSON.parse(rawResponse)\n                                : rawResponse;\n                            // @ts-expect-error\n                            this.doResponse(statusCode, responseData, request);\n                            sentResponse = true;\n                        }\n                        if (sentResponse === false) {\n                            // @ts-expect-error\n                            this.doResponse(statusCode, rawResponse, request);\n                        }\n                    }\n                };\n                xhr.onerror = () => {\n                    // @ts-expect-error\n                    delete this._xhr;\n                    this.sendSignalOnOutput(\"failure\");\n                };\n                xhr.onabort = () => {\n                    // @ts-expect-error\n                    delete this._xhr;\n                    this.sendSignalOnOutput(\"canceled\");\n                };\n                if (request.content) {\n                    xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n                    xhr.send(JSON.stringify(request.content));\n                }\n                else {\n                    xhr.send();\n                }\n            }\n            else {\n                const headers = {\n                    ...request.headers,\n                    ...(request.content ? { \"Content-Type\": \"application/json\" } : {}),\n                };\n                fetch(url, {\n                    method: request.method,\n                    headers,\n                    body: request.content ? JSON.stringify(request.content) : undefined,\n                })\n                    .then((response) => {\n                    const responseType = response.headers.get(\"content-type\");\n                    if (responseType) {\n                        if (responseType.indexOf(\"/json\") !== -1) {\n                            response.json().then((json) => {\n                                // @ts-expect-error\n                                this.doResponse(response.status, json, request);\n                            });\n                        }\n                        else {\n                            if (this.context.editorConnection) {\n                                this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, \"rest-run-waring-\", {\n                                    message: \"REST only supports json content type in response.\",\n                                });\n                            }\n                        }\n                    }\n                    else {\n                        response.text().then((raw) => {\n                            // @ts-expect-error\n                            this.doResponse(response.status, raw, request);\n                        });\n                    }\n                })\n                    .catch((e) => {\n                    console.log(\"REST: Failed to request\", url);\n                    console.log(e);\n                    this.sendSignalOnOutput(\"failure\");\n                });\n            }\n        },\n        doFetch() {\n            this._internal.hasScheduledFetch = false;\n            let resource = this._internal.resource;\n            if (resource) {\n                for (const key in this._internal.inputValues) {\n                    resource = resource.replace(\"{\" + key + \"}\", this._internal.inputValues[key]);\n                }\n            }\n            const request = {\n                // @ts-expect-error\n                resource,\n                headers: {},\n                method: this._internal.method !== undefined ? this._internal.method : \"GET\",\n                parameters: {},\n            };\n            if (this._internal.requestFunc) {\n                this._internal.requestFunc.apply(this._internal.self, [\n                    this._internal.inputValues,\n                    this._internal.outputValuesProxy,\n                    request,\n                ]);\n            }\n            // @ts-expect-error\n            this.doExternalFetch(request);\n        },\n        cancelFetch() {\n            // @ts-expect-error\n            if (typeof _noodl_cloud_runtime_version === \"undefined\") {\n                // @ts-expect-error\n                this._xhr && this._xhr.abort();\n            }\n            else {\n                if (this.context.editorConnection) {\n                    this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, \"rest-run-waring-\", {\n                        message: \"REST doesn't support cancel in cloud functions.\",\n                    });\n                }\n            }\n        },\n    },\n};\nfunction parseScriptForErrors(script, args, name, node, context, ports) {\n    if (!context.editorConnection) {\n        return;\n    }\n    context.editorConnection.clearWarning(node.component.name, node.id, \"rest-run-waring-\" + name);\n    if (script === undefined) {\n        context.editorConnection.clearWarning(node.component.name, node.id, \"rest-parse-waring-\" + name);\n        return;\n    }\n    try {\n        new Function(...args, script);\n        context.editorConnection.clearWarning(node.component.name, node.id, \"rest-parse-waring-\" + name);\n    }\n    catch (e) {\n        context.editorConnection.sendWarning(node.component.name, node.id, \"rest-parse-waring-\" + name, {\n            message: \"<strong>\" + name + \"</strong>: \" + e.message,\n            showGlobally: true,\n        });\n    }\n    function exists(port) {\n        return ports.find((p) => p.name === port) !== undefined;\n    }\n    const scriptWithoutComments = script.replace(/\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/g, \"\");\n    const inputs = scriptWithoutComments.match(/Inputs\\.[A-Za-z0-9]+/g);\n    if (inputs) {\n        const unique = {};\n        inputs.forEach((v) => {\n            unique[v.substring(\"Inputs.\".length)] = true;\n        });\n        Object.keys(unique).forEach((p) => {\n            if (exists(\"in-\" + p))\n                return;\n            ports.push({\n                name: \"in-\" + p,\n                displayName: p,\n                plug: \"input\",\n                type: \"*\",\n                group: \"Inputs\",\n            });\n        });\n    }\n    const outputs = scriptWithoutComments.match(/Outputs\\.[A-Za-z0-9]+/g);\n    if (outputs) {\n        const unique = {};\n        outputs.forEach((v) => {\n            unique[v.substring(\"Outputs.\".length)] = true;\n        });\n        Object.keys(unique).forEach((p) => {\n            if (exists(\"out-\" + p))\n                return;\n            ports.push({\n                name: \"out-\" + p,\n                displayName: p,\n                plug: \"output\",\n                type: \"*\",\n                group: \"Outputs\",\n            });\n        });\n    }\n}\nfunction setup$a(context, graphModel) {\n    if (!context.editorConnection) {\n        return;\n    }\n    function managePortsForNode(node) {\n        function updatePorts() {\n            if (!node.parameters) {\n                return;\n            }\n            const ports = [];\n            function exists(name) {\n                for (let i = 0; i < ports.length; i++)\n                    if (ports[i].name === name && ports[i].plug === \"input\")\n                        return true;\n                return false;\n            }\n            if (node.parameters.resource) {\n                const inputs = node.parameters.resource.match(/\\{[A-Za-z0-9_]*\\}/g);\n                if (inputs) {\n                    for (const def of inputs) {\n                        const name = def.replace(\"{\", \"\").replace(\"}\", \"\");\n                        if (exists(\"in-\" + name))\n                            continue;\n                        ports.push({\n                            name: \"in-\" + name,\n                            displayName: name,\n                            type: \"string\",\n                            plug: \"input\",\n                            group: \"Inputs\",\n                        });\n                    }\n                }\n            }\n            if (node.parameters[\"requestScript\"]) {\n                parseScriptForErrors(node.parameters[\"requestScript\"], [\"Inputs\", \"Outputs\", \"Request\"], \"Request script\", node, context, ports);\n            }\n            if (node.parameters[\"responseScript\"]) {\n                parseScriptForErrors(node.parameters[\"responseScript\"], [\"Inputs\", \"Outputs\", \"Response\"], \"Response script\", node, context, ports);\n            }\n            context.editorConnection.sendDynamicPorts(node.id, ports);\n        }\n        updatePorts();\n        node.on(\"parameterUpdated\", () => {\n            updatePorts();\n        });\n    }\n    graphModel.on(\"editorImportComplete\", () => {\n        graphModel.on(\"nodeAdded.REST2\", (node) => {\n            managePortsForNode(node);\n        });\n        for (const node of graphModel.getNodesWithType(\"REST2\")) {\n            managePortsForNode(node);\n        }\n    });\n}\n\nvar restnode = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$v,\n    setup: setup$a\n});\n\nconst node$u = {\n    name: \"Expression\",\n    docs: \"https://docs.noodl.net/nodes/math/expression\",\n    usePortAsLabel: \"expression\",\n    category: \"CustomCode\",\n    color: \"javascript\",\n    nodeDoubleClickAction: {\n        focusPort: \"Expression\",\n    },\n    searchTags: [\"javascript\"],\n    initialize() {\n        const internal = this._internal;\n        internal.scope = {};\n        internal.hasScheduledEvaluation = false;\n        internal.code = undefined;\n        internal.cachedValue = 0;\n        internal.currentExpression = \"\";\n        internal.compiledFunction = undefined;\n        internal.inputNames = [];\n        internal.inputValues = [];\n    },\n    getInspectInfo() {\n        return this._internal.cachedValue;\n    },\n    inputs: {\n        expression: {\n            group: \"General\",\n            inputPriority: 1,\n            type: {\n                name: \"string\",\n                allowEditOnly: true,\n                codeeditor: \"javascript\",\n            },\n            displayName: \"Expression\",\n            set(value) {\n                const internal = this._internal;\n                internal.currentExpression =\n                    functionPreamble + \"return (\" + value + \");\";\n                internal.compiledFunction = undefined;\n                const newInputs = parsePorts(value);\n                const inputsToAdd = difference$1(newInputs, internal.inputNames);\n                const inputsToRemove = difference$1(internal.inputNames, newInputs);\n                const self = this;\n                inputsToRemove.forEach(function (name) {\n                    self.deregisterInput(name);\n                    delete internal.scope[name];\n                });\n                inputsToAdd.forEach(function (name) {\n                    if (self.hasInput(name)) {\n                        return;\n                    }\n                    self.registerInput(name, {\n                        set(value) {\n                            internal.scope[name] = value;\n                            if (!this.isInputConnected(\"run\")) {\n                                // @ts-expect-error\n                                this._scheduleEvaluateExpression();\n                            }\n                        },\n                    });\n                    internal.scope[name] = 0;\n                    self._inputValues[name] = 0;\n                });\n                internal.inputNames = Object.keys(internal.scope);\n                if (!this.isInputConnected(\"run\"))\n                    this._scheduleEvaluateExpression();\n            },\n        },\n        run: {\n            group: \"Actions\",\n            displayName: \"Run\",\n            type: \"signal\",\n            valueChangedToTrue() {\n                this._scheduleEvaluateExpression();\n            },\n        },\n    },\n    outputs: {\n        result: {\n            group: \"Result\",\n            type: \"*\",\n            displayName: \"Result\",\n            getter() {\n                if (!this._internal.currentExpression) {\n                    return 0;\n                }\n                return this._internal.cachedValue;\n            },\n        },\n        isTrue: {\n            group: \"Result\",\n            type: \"boolean\",\n            displayName: \"Is True\",\n            getter() {\n                if (!this._internal.currentExpression) {\n                    return false;\n                }\n                return !!this._internal.cachedValue;\n            },\n        },\n        isFalse: {\n            group: \"Result\",\n            type: \"boolean\",\n            displayName: \"Is False\",\n            getter() {\n                if (!this._internal.currentExpression) {\n                    return true;\n                }\n                return !this._internal.cachedValue;\n            },\n        },\n        isTrueEv: {\n            group: \"Events\",\n            type: \"signal\",\n            displayName: \"On True\",\n        },\n        isFalseEv: {\n            group: \"Events\",\n            type: \"signal\",\n            displayName: \"On False\",\n        },\n    },\n    prototypeExtensions: {\n        registerInputIfNeeded(name) {\n            if (this.hasInput(name)) {\n                return;\n            }\n            this._internal.scope[name] = 0;\n            this._inputValues[name] = 0;\n            this.registerInput(name, {\n                set(value) {\n                    this._internal.scope[name] = value;\n                    if (!this.isInputConnected(\"run\"))\n                        this._scheduleEvaluateExpression();\n                },\n            });\n        },\n        _scheduleEvaluateExpression() {\n            const internal = this._internal;\n            if (internal.hasScheduledEvaluation !== false) {\n                return;\n            }\n            internal.hasScheduledEvaluation = true;\n            this.flagDirty();\n            this.scheduleAfterInputsHaveUpdated(function () {\n                const lastValue = internal.cachedValue;\n                internal.cachedValue = this._calculateExpression();\n                if (lastValue !== internal.cachedValue) {\n                    this.flagOutputDirty(\"result\");\n                    this.flagOutputDirty(\"isTrue\");\n                    this.flagOutputDirty(\"isFalse\");\n                }\n                if (internal.cachedValue)\n                    this.sendSignalOnOutput(\"isTrueEv\");\n                else\n                    this.sendSignalOnOutput(\"isFalseEv\");\n                internal.hasScheduledEvaluation = false;\n            });\n        },\n        _calculateExpression() {\n            const internal = this._internal;\n            if (!internal.compiledFunction) {\n                internal.compiledFunction = this._compileFunction();\n            }\n            for (let i = 0; i < internal.inputNames.length; ++i) {\n                const inputValue = internal.scope[internal.inputNames[i]];\n                internal.inputValues[i] = inputValue;\n            }\n            try {\n                if (!internal.compiledFunction) {\n                    throw new Error(\"Compiled function is undefined\");\n                }\n                return internal.compiledFunction.apply(null, internal.inputValues);\n            }\n            catch (e) {\n                if (e instanceof Error) {\n                    console.error(\"Error in expression:\", e.message);\n                }\n            }\n            return undefined;\n        },\n        // @ts-expect-error\n        _compileFunction() {\n            const expression = this._internal.currentExpression;\n            const args = Object.keys(this._internal.scope);\n            const key = expression + args.join(\" \");\n            if (!compiledFunctionsCache[key]) {\n                args.push(expression);\n                try {\n                    compiledFunctionsCache[key] = construct(Function, args);\n                }\n                catch (e) {\n                    if (e instanceof Error) {\n                        console.error(\"Failed to compile JS function\", e.message);\n                    }\n                }\n            }\n            return compiledFunctionsCache[key];\n        },\n    },\n};\nconst functionPreamble = [\n    \"var min = Math.min,\" +\n        \"    max = Math.max,\" +\n        \"    cos = Math.cos,\" +\n        \"    sin = Math.sin,\" +\n        \"    tan = Math.tan,\" +\n        \"    sqrt = Math.sqrt,\" +\n        \"    pi = Math.PI,\" +\n        \"    round = Math.round,\" +\n        \"    floor = Math.floor,\" +\n        \"    ceil = Math.ceil,\" +\n        \"    abs = Math.abs,\" +\n        \"    random = Math.random;\",\n].join(\"\");\nfunction construct(constructor, args) {\n    function F() {\n        return constructor.apply(this, args);\n    }\n    F.prototype = constructor.prototype;\n    // @ts-expect-error\n    return new F();\n}\nconst compiledFunctionsCache = {};\nconst portsToIgnore = [\n    \"min\",\n    \"max\",\n    \"cos\",\n    \"sin\",\n    \"tan\",\n    \"sqrt\",\n    \"pi\",\n    \"round\",\n    \"floor\",\n    \"ceil\",\n    \"abs\",\n    \"random\",\n    \"Math\",\n    \"window\",\n    \"document\",\n    \"undefined\",\n    \"Vars\",\n    \"true\",\n    \"false\",\n    \"null\",\n    \"Boolean\",\n];\nfunction parsePorts(expression) {\n    const ports = [];\n    function addPort(name) {\n        if (portsToIgnore.indexOf(name) !== -1)\n            return;\n        if (ports.some((p) => p === name))\n            return;\n        ports.push(name);\n    }\n    // First remove all strings\n    expression = expression\n        .replace(/\\\"([^\\\"]*)\\\"/g, \"\")\n        .replace(/\\'([^\\']*)\\'/g, \"\");\n    // Extract identifiers\n    const identifiers = expression.matchAll(/[a-zA-Z\\_\\$][a-zA-Z0-9\\.\\_\\$]*/g);\n    for (const _id of identifiers) {\n        let name = _id[0];\n        if (name.indexOf(\".\") !== -1) {\n            name = name.split(\".\")[0]; // Take first symbol on \".\" sequence\n        }\n        addPort(name);\n    }\n    return ports;\n}\nfunction updatePorts$7(nodeId, expression, editorConnection) {\n    const portNames = parsePorts(expression);\n    const ports = portNames.map((name) => ({\n        group: \"Parameters\",\n        name,\n        type: {\n            name: \"*\",\n            editAsType: \"string\",\n        },\n        plug: \"input\",\n    }));\n    editorConnection.sendDynamicPorts(nodeId, ports);\n}\nfunction evalCompileWarnings(editorConnection, node) {\n    try {\n        new Function(node.parameters.expression);\n        editorConnection.clearWarning(node.component.name, node.id, \"expression-compile-error\");\n    }\n    catch (e) {\n        if (e instanceof Error) {\n            editorConnection.sendWarning(node.component.name, node.id, \"expression-compile-error\", {\n                message: e.message,\n            });\n        }\n    }\n}\nfunction setup$9(context, graphModel) {\n    if (!context.editorConnection ||\n        !context.editorConnection.isRunningLocally()) {\n        return;\n    }\n    graphModel.on(\"nodeAdded.Expression\", (node) => {\n        if (node.parameters.expression) {\n            updatePorts$7(node.id, node.parameters.expression, context.editorConnection);\n            evalCompileWarnings(context.editorConnection, node);\n        }\n        node.on(\"parameterUpdated\", (event) => {\n            if (event.name === \"expression\") {\n                updatePorts$7(node.id, node.parameters.expression, context.editorConnection);\n                evalCompileWarnings(context.editorConnection, node);\n            }\n        });\n    });\n}\n\nvar expression = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$u,\n    setup: setup$9\n});\n\nconst userFunctionsCache = {};\nclass JavascriptNodeParser {\n    constructor(code, options) {\n        this.inputs = {};\n        this.outputs = {};\n        this.code = code;\n        const node = options ? options.node : undefined;\n        this._initializeAPIs();\n        let userCode = userFunctionsCache[code];\n        if (!userCode) {\n            try {\n                userCode = new Function(\n                // @ts-ignore\n                [\"define\", \"script\", \"Node\", \"Component\"], JavascriptNodeParser.getCodePrefix() + code);\n                userFunctionsCache[code] = userCode;\n            }\n            catch (e) {\n                this.error = e instanceof Error ? e.message : String(e);\n                console.error(e);\n            }\n        }\n        if (userCode) {\n            try {\n                userCode(this.define.bind(this), this.script.bind(this), \n                // @ts-expect-error\n                this.apis.Node, node ? JavascriptNodeParser.getComponentScopeForNode(node) : {});\n                this._afterSourced();\n            }\n            catch (e) {\n                this.error = e instanceof Error ? e.message : String(e);\n                console.error(e);\n            }\n        }\n    }\n    define(userObject) {\n        this.inputs = userObject.inputs || {};\n        this.outputs = userObject.outputs || {};\n        this.setup = userObject.setup;\n        this.change = userObject.run || userObject.change;\n        this.destroy = userObject.destroy;\n        this.definedObject = userObject;\n    }\n    script(userObject) {\n        const _userObjectExtended = _scriptExtend(userObject);\n        this.inputs = _userObjectExtended.inputs || {};\n        this.outputs = _userObjectExtended.outputs || {};\n        this.setup = _userObjectExtended.setup;\n        this.change = _userObjectExtended.run || _userObjectExtended.change;\n        this.destroy = _userObjectExtended.destroy;\n        this.definedObject = _userObjectExtended;\n    }\n    _initializeAPIs() {\n        this.apis = {\n            Node: {\n                Inputs: {},\n                Outputs: {},\n                Signals: {},\n                Setters: {},\n            },\n        };\n    }\n    _afterSourced() {\n        if (this.definedObject !== undefined)\n            return;\n        const _Node = this.apis.Node;\n        this.inputs = Object.assign({}, _Node.Inputs || {});\n        this.outputs = Object.assign({}, _Node.Outputs || {});\n        this.setup = function (inputs, outputs) {\n            const _this = this;\n            _Node.setOutputs = function (_outputs) {\n                for (const key in _outputs) {\n                    outputs[key] = _outputs[key];\n                    // @ts-ignore\n                    _this.flagOutputDirty(key);\n                }\n            };\n            _Node.OnInit && _Node.OnInit.apply(this);\n        };\n        this.destroy = _Node.OnDestroy || this.destroy;\n        this.change = (inputs, outputs, changedInputs) => {\n            for (const key in changedInputs) {\n                if (typeof _Node.Setters[key] === \"function\") {\n                    _Node.Setters[key](inputs[key]);\n                }\n            }\n            if (typeof _Node.OnInputsChanged === \"function\") {\n                _Node.OnInputsChanged();\n            }\n        };\n        this.definedObject = {\n            inputs: this.inputs,\n            outputs: this.outputs,\n            setup: this.setup,\n            destroy: this.destroy,\n            change: this.change,\n        };\n        if (_Node.Signals !== undefined) {\n            for (const key in _Node.Signals) {\n                if (typeof _Node.Signals[key] === \"function\") {\n                    this.inputs[key] = \"signal\";\n                    this.definedObject[key] = _Node.Signals[key];\n                }\n            }\n        }\n    }\n    getPorts() {\n        const ports = [];\n        Object.keys(this.inputs).forEach((name) => {\n            const inputPort = this.inputs[name];\n            const port = {\n                name,\n                plug: \"input\",\n                type: undefined,\n                group: \"Inputs\",\n            };\n            if (typeof inputPort === \"string\") {\n                port.type = {\n                    name: inputPort,\n                };\n            }\n            else {\n                Object.assign(port, inputPort);\n            }\n            ports.push(port);\n        });\n        Object.keys(this.outputs).forEach((name) => {\n            ports.push({\n                name,\n                type: {\n                    name: this.outputs[name],\n                },\n                plug: \"output\",\n                group: \"Outputs\",\n            });\n        });\n        JavascriptNodeParser.parseAndAddPortsFromScript(this.code, ports, {});\n        return ports;\n    }\n    static createFromCode(code, options) {\n        return new JavascriptNodeParser(code, options);\n    }\n    static createFromURL(url, callback, options) {\n        url = getAbsoluteUrl(url);\n        const xhr = new XMLHttpRequest();\n        xhr.open(\"GET\", url, true);\n        xhr.onreadystatechange = function () {\n            if (this.readyState === 4 || this.readyState === XMLHttpRequest.DONE) {\n                callback(new JavascriptNodeParser(this.response));\n            }\n        };\n        xhr.onerror = function () {\n            console.log(\"Failed to request\", url);\n        };\n        xhr.send();\n    }\n    static parseAndAddPortsFromScript(script, ports, options) {\n        function _exists(port) {\n            if (typeof port === \"string\")\n                return ports.find((p) => p.name === port) !== undefined;\n            else\n                return (ports.find((p) => p.name === port.name && p.plug === port.plug) !==\n                    undefined);\n        }\n        function _addPortsFromMatch(match, options) {\n            if (match === undefined || match === null)\n                return;\n            const unique = {};\n            for (const _s of match) {\n                let name = _s[1];\n                if (name === undefined)\n                    continue;\n                unique[name] = true;\n            }\n            Object.keys(unique).forEach((p) => {\n                if (_exists({\n                    name: options.prefix + p,\n                    plug: options.plug,\n                }))\n                    return;\n                ports.push({\n                    name: options.prefix + p,\n                    displayName: p,\n                    plug: options.plug,\n                    type: options.type,\n                    group: options.group,\n                });\n            });\n        }\n        if (!options.skipInputs) {\n            _addPortsFromMatch(script.matchAll(/Inputs\\.([A-Za-z0-9_]+)/g), {\n                type: options.inputType || \"*\",\n                plug: \"input\",\n                group: options.inputGroup || \"Inputs\",\n                prefix: options.inputPrefix || \"\",\n            });\n            _addPortsFromMatch(script.matchAll(/Inputs\\s*\\[\\s*(?:'|\")(.*)(?:'|\")\\s*\\]/g), {\n                type: options.inputType || \"*\",\n                plug: \"input\",\n                group: options.inputGroup || \"Inputs\",\n                prefix: options.inputPrefix || \"\",\n            });\n        }\n        if (!options.skipOutputs) {\n            if (!options.skipOutputSignals) {\n                _addPortsFromMatch(script.matchAll(/Outputs\\.([A-Za-z0-9]+)\\s*\\(\\s*\\)/g), {\n                    type: \"signal\",\n                    plug: \"output\",\n                    group: \"Outputs\",\n                    prefix: options.outputPrefix || \"\",\n                });\n                _addPortsFromMatch(script.matchAll(/Outputs\\s*\\[\\s*(?:'|\")(.*)(?:'|\")\\s*\\]\\(\\s*\\)/g), {\n                    type: \"signal\",\n                    plug: \"output\",\n                    group: \"Outputs\",\n                    prefix: options.outputPrefix || \"\",\n                });\n            }\n            if (!options.skipRegularOutputs) {\n                _addPortsFromMatch(script.matchAll(/Outputs\\.([A-Za-z0-9_]+)/g), {\n                    type: \"*\",\n                    plug: \"output\",\n                    group: \"Outputs\",\n                    prefix: options.outputPrefix || \"\",\n                });\n                _addPortsFromMatch(script.matchAll(/Outputs\\s*\\[\\s*\\\"([^\\\"]*)\\\"\\s*\\]/g), {\n                    type: \"*\",\n                    plug: \"output\",\n                    group: \"Outputs\",\n                    prefix: options.outputPrefix || \"\",\n                });\n            }\n        }\n    }\n    static getCodePrefix() {\n        return \"const Script = (typeof Node !== 'undefined')?Node:undefined;\\n\";\n    }\n    static createNoodlAPI() {\n        return typeof window !== \"undefined\" && window.Noodl !== undefined\n            ? window.Noodl\n            : {};\n    }\n    static getComponentScopeForNode(node) {\n        const componentId = node.nodeScope.componentOwner.getInstanceId();\n        if (_componentScopes[componentId] === undefined) {\n            _componentScopes[componentId] = {};\n            const componentObject = (node.nodeScope.modelScope || Model).get(\"componentState\" + componentId);\n            _componentScopes[componentId].Object = componentObject;\n        }\n        const parentComponentObjectId = _findParentComponentStateModelId(node);\n        const parentComponentObject = parentComponentObjectId !== undefined\n            ? (node.nodeScope.modelScope || Model).get(parentComponentObjectId)\n            : undefined;\n        _componentScopes[componentId].ParentObject = parentComponentObject;\n        _componentScopes[componentId].RepeaterObject = _findForEachModel(node);\n        return _componentScopes[componentId];\n    }\n}\nfunction _scriptExtend(userObject) {\n    const _extended = {\n        inputs: userObject.inputs || {},\n        outputs: userObject.outputs || {},\n        setup: function (inputs, outputs) {\n            this.inputs = inputs;\n            this.outputs = outputs;\n            // @ts-expect-error\n            this.setOutputs = function (states) {\n                for (const key in states) {\n                    this.outputs[key] = states[key];\n                    // @ts-ignore\n                    this.flagOutputDirty(key);\n                }\n            };\n            if (userObject.methods) {\n                for (const key in userObject.methods) {\n                    // @ts-ignore\n                    this[key] = userObject.methods[key];\n                }\n            }\n            userObject.setup && userObject.setup.apply(this);\n        },\n        destroy: function (inputs, outputs) {\n            this.inputs = inputs;\n            this.outputs = outputs;\n            userObject.destroy && userObject.destroy.apply(this);\n        },\n        change: function (inputs, outputs) {\n            this.inputs = inputs;\n            this.outputs = outputs;\n            // @ts-ignore\n            const old = this._oldInputs || {};\n            if (userObject.changed) {\n                for (const key in inputs) {\n                    if (inputs[key] !== old[key]) {\n                        const changedFunction = userObject.changed[key];\n                        if (typeof changedFunction === \"function\")\n                            changedFunction.apply(this, [inputs[key], old[key]]);\n                    }\n                }\n            }\n            // @ts-ignore\n            this._oldInputs = Object.assign({}, inputs);\n        },\n    };\n    if (userObject.signals) {\n        for (const key in userObject.signals) {\n            // @ts-ignore\n            _extended[key] = userObject.signals[key];\n            _extended.inputs[key] = \"signal\";\n        }\n    }\n    return _extended;\n}\nconst _componentScopes = {};\nfunction _findParentComponentStateModelId(node) {\n    function getParentComponent(component) {\n        let parent;\n        if (component.getRoots().length > 0) {\n            const root = component.getRoots()[0];\n            if (root.getVisualParentNode) {\n                if (root.getVisualParentNode()) {\n                    parent = root.getVisualParentNode().nodeScope.componentOwner;\n                }\n            }\n            else if (root.parentNodeScope) {\n                parent = component.parentNodeScope.componentOwner;\n            }\n        }\n        else if (component.parentNodeScope) {\n            parent = component.parentNodeScope.componentOwner;\n        }\n        if (parent &&\n            parent.nodeScope &&\n            parent.nodeScope.componentOwner !== component) {\n            if (parent.nodeScope.getNodesWithType(\"net.noodl.ComponentObject\").length >\n                0) {\n                return parent;\n            }\n            if (parent.nodeScope.getNodesWithType(\"Component State\").length > 0) {\n                return parent;\n            }\n            return getParentComponent(parent);\n        }\n    }\n    const parent = getParentComponent(node.nodeScope.componentOwner);\n    if (!parent)\n        return;\n    return \"componentState\" + parent.getInstanceId();\n}\nfunction _findForEachModel(node) {\n    let component = node.nodeScope.componentOwner;\n    while (component !== undefined &&\n        component._forEachModel === undefined &&\n        component.parentNodeScope) {\n        component = component.parentNodeScope.componentOwner;\n    }\n    return component !== undefined ? component._forEachModel : undefined;\n}\n\nconst node$t = {\n    name: \"JavaScriptFunction\",\n    displayNodeName: \"Function\",\n    docs: \"https://docs.noodl.net/nodes/javascript/function\",\n    category: \"CustomCode\",\n    color: \"javascript\",\n    nodeDoubleClickAction: {\n        focusPort: \"Script\",\n    },\n    searchTags: [\"javascript\"],\n    exportDynamicPorts: true,\n    initialize: function () {\n        this._internal = {}; // TODO: Is this needed?\n        this._internal.inputValues = {};\n        this._internal.outputValues = {};\n        this._internal.inputTypes = {};\n        this._internal.outputTypes = {};\n        this._internal.outputValuesProxy = new Proxy(this._internal.outputValues, {\n            set: (obj, prop, value) => {\n                //a function node can continue running after it has been deleted. E.g. with timeouts or event listeners that hasn't been removed.\n                //if the node is deleted, just do nothing\n                if (this._deleted) {\n                    return true;\n                }\n                //only send outputs when they change.\n                //Some Noodl projects rely on this behavior, so changing it breaks backwards compability\n                if (value !== this._internal.outputValues[prop]) {\n                    this.registerOutputIfNeeded(\"out-\" + prop);\n                    this._internal.outputValues[prop] = value;\n                    this.flagOutputDirty(\"out-\" + prop);\n                }\n                return true;\n            },\n        });\n        this._internal._this = {};\n    },\n    getInspectInfo() {\n        return [\n            {\n                type: \"value\",\n                value: {\n                    inputs: this._internal.inputValues,\n                    outputs: this._internal.outputValues,\n                },\n            },\n        ];\n    },\n    inputs: {\n        scriptInputs: {\n            type: {\n                name: \"proplist\",\n                allowEditOnly: true,\n            },\n            group: \"Script Inputs\",\n            set(value) {\n                //  ignore\n            },\n        },\n        scriptOutputs: {\n            type: {\n                name: \"proplist\",\n                allowEditOnly: true,\n            },\n            group: \"Script Outputs\",\n            set(value) {\n                //  ignore\n            },\n        },\n        functionScript: {\n            displayName: \"Script\",\n            // @ts-expect-error TODO: What is this... ???\n            plug: \"input\",\n            type: {\n                name: \"string\",\n                allowEditOnly: true,\n                codeeditor: \"javascript\",\n            },\n            group: \"General\",\n            set(script) {\n                if (script === undefined) {\n                    this._internal.func = undefined;\n                    return;\n                }\n                this._internal.func = this.parseScript(script);\n                if (!this.isInputConnected(\"run\"))\n                    this.scheduleRun();\n            },\n        },\n        run: {\n            type: \"signal\",\n            displayName: \"Run\",\n            group: \"Actions\",\n            valueChangedToTrue: function () {\n                this.scheduleRun();\n            },\n        },\n    },\n    outputs: {},\n    methods: {\n        scheduleRun() {\n            // @ts-expect-error\n            if (this.runScheduled)\n                return;\n            // @ts-expect-error\n            this.runScheduled = true;\n            this.scheduleAfterInputsHaveUpdated(() => {\n                // @ts-expect-error\n                this.runScheduled = false;\n                if (!this._deleted) {\n                    // @ts-expect-error\n                    this.runScript();\n                }\n            });\n        },\n        async runScript() {\n            const func = this._internal.func;\n            if (func === undefined)\n                return;\n            const inputs = this._internal.inputValues;\n            const outputs = this._internal.outputValuesProxy;\n            // Prepare send signal functions\n            for (const key in this.model.outputPorts) {\n                // @ts-expect-error\n                if (this._isSignalType(key)) {\n                    const _sendSignal = () => {\n                        if (this.hasOutput(key))\n                            this.sendSignalOnOutput(key);\n                    };\n                    this._internal.outputValues[key.substring(\"out-\".length)] =\n                        _sendSignal;\n                    this._internal.outputValues[key.substring(\"out-\".length)].send =\n                        _sendSignal;\n                }\n            }\n            try {\n                await func.apply(this._internal._this, [\n                    inputs,\n                    outputs,\n                    // @ts-expect-error\n                    JavascriptNodeParser.createNoodlAPI(this.nodeScope.modelScope),\n                    JavascriptNodeParser.getComponentScopeForNode(this),\n                ]);\n            }\n            catch (e) {\n                logJavaScriptNodeError(e);\n                if (this.context.editorConnection &&\n                    this.context.isWarningTypeEnabled(\"javascriptExecution\")) {\n                    this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, \"js-function-run-waring\", {\n                        showGlobally: true,\n                        message: e.message,\n                        stack: e.stack,\n                    });\n                }\n            }\n        },\n        setScriptInputValue(name, value) {\n            this._internal.inputValues[name] = value;\n            if (!this.isInputConnected(\"run\")) {\n                // @ts-expect-error\n                this.scheduleRun();\n            }\n        },\n        getScriptOutputValue(name) {\n            // @ts-expect-error\n            if (this._isSignalType(name)) {\n                return undefined;\n            }\n            return this._internal.outputValues[name];\n        },\n        setScriptInputType(name, type) {\n            this._internal.inputTypes[name] = type;\n        },\n        setScriptOutputType(name, type) {\n            this._internal.outputTypes[name] = type;\n        },\n        parseScript(script) {\n            let func;\n            try {\n                const AsyncFunction = Object.getPrototypeOf(async function () { }).constructor;\n                func = new AsyncFunction(\"Inputs\", \"Outputs\", \"Noodl\", \"Component\", JavascriptNodeParser.getCodePrefix() + script);\n            }\n            catch (e) {\n                console.log(\"Error while parsing action script: \" + e);\n            }\n            return func;\n        },\n        _isSignalType(name) {\n            // This will catch signals in script that may not have been delivered by the editor yet\n            return (this.model.outputPorts[name] &&\n                // @ts-expect-error\n                this.model.outputPorts[name].type === \"signal\");\n        },\n        registerInputIfNeeded(name) {\n            if (this.hasInput(name)) {\n                return;\n            }\n            if (name.startsWith(\"in-\")) {\n                const n = name.substring(\"in-\".length);\n                const input = {\n                    // @ts-expect-error\n                    set: this.setScriptInputValue.bind(this, n),\n                };\n                //make sure we register the type as well, so Noodl resolves types like color styles to an actual color\n                if (this.model && this.model.parameters[\"intype-\" + n]) {\n                    // @ts-expect-error\n                    input.type = this.model.parameters[\"intype-\" + n];\n                }\n                this.registerInput(name, input);\n            }\n            if (name.startsWith(\"intype-\")) {\n                const n = name.substring(\"intype-\".length);\n                this.registerInput(name, {\n                    set(value) {\n                        //make sure we register the type as well, so Noodl resolves types like color styles to an actual color\n                        if (this.hasInput(\"in\" + n)) {\n                            // @ts-expect-error\n                            this.getInput(\"in\" + n).type = value;\n                        }\n                    },\n                });\n            }\n            if (name.startsWith(\"outtype-\")) {\n                this.registerInput(name, {\n                    set() { }, // Ignore\n                });\n            }\n        },\n        registerOutputIfNeeded(name) {\n            if (this.hasOutput(name)) {\n                return;\n            }\n            if (name.startsWith(\"out-\"))\n                return this.registerOutput(name, {\n                    // @ts-expect-error\n                    getter: this.getScriptOutputValue.bind(this, name.substring(\"out-\".length)),\n                });\n        },\n    },\n};\nfunction _parseScriptForErrorsAndPorts(script, name, node, context, ports) {\n    // Clear run warnings if the script is edited\n    context.editorConnection.clearWarning(node.component.name, node.id, \"js-function-run-waring\");\n    if (script === undefined) {\n        context.editorConnection.clearWarning(node.component.name, node.id, \"js-function-parse-waring\");\n        return;\n    }\n    try {\n        const AsyncFunction = Object.getPrototypeOf(async function () { }).constructor;\n        new AsyncFunction(\"Inputs\", \"Outputs\", \"Noodl\", \"Component\", script);\n        context.editorConnection.clearWarning(node.component.name, node.id, \"js-function-parse-waring\");\n    }\n    catch (e) {\n        context.editorConnection.sendWarning(node.component.name, node.id, \"js-function-parse-waring\", {\n            showGlobally: true,\n            message: e.message,\n        });\n    }\n    JavascriptNodeParser.parseAndAddPortsFromScript(script, ports, {\n        inputPrefix: \"in-\",\n        outputPrefix: \"out-\",\n    });\n}\nconst inputTypeEnums = [\n    {\n        value: \"string\",\n        label: \"String\",\n    },\n    {\n        value: \"boolean\",\n        label: \"Boolean\",\n    },\n    {\n        value: \"number\",\n        label: \"Number\",\n    },\n    {\n        value: \"object\",\n        label: \"Object\",\n    },\n    {\n        value: \"date\",\n        label: \"Date\",\n    },\n    {\n        value: \"array\",\n        label: \"Array\",\n    },\n    {\n        value: \"color\",\n        label: \"Color\",\n    },\n];\nfunction setup$8(context, graphModel) {\n    if (!context.editorConnection ||\n        !context.editorConnection.isRunningLocally()) {\n        return;\n    }\n    function _managePortsForNode(node) {\n        function _updatePorts() {\n            var _a;\n            const ports = [];\n            const _outputTypeEnums = inputTypeEnums.concat([\n                {\n                    value: \"signal\",\n                    label: \"Signal\",\n                },\n            ]);\n            // Outputs\n            if (node.parameters[\"scriptOutputs\"] !== undefined &&\n                node.parameters[\"scriptOutputs\"].length > 0) {\n                node.parameters[\"scriptOutputs\"].forEach((p) => {\n                    // Type for output\n                    ports.push({\n                        name: \"outtype-\" + p.label,\n                        displayName: \"Type\",\n                        editorName: p.label + \" | Type\",\n                        plug: \"input\",\n                        type: {\n                            name: \"enum\",\n                            enums: _outputTypeEnums,\n                            allowEditOnly: true,\n                        },\n                        default: \"string\",\n                        parent: \"scriptOutputs\",\n                        parentItemId: p.id,\n                    });\n                    // Value for output\n                    ports.push({\n                        name: \"out-\" + p.label,\n                        displayName: p.label,\n                        plug: \"output\",\n                        type: node.parameters[\"outtype-\" + p.label] || \"*\",\n                        group: \"Outputs\",\n                    });\n                });\n            }\n            // Inputs\n            if (node.parameters[\"scriptInputs\"] !== undefined &&\n                node.parameters[\"scriptInputs\"].length > 0) {\n                node.parameters[\"scriptInputs\"].forEach((p) => {\n                    // Type for input\n                    ports.push({\n                        name: \"intype-\" + p.label,\n                        displayName: \"Type\",\n                        editorName: p.label + \" | Type\",\n                        plug: \"input\",\n                        type: {\n                            name: \"enum\",\n                            enums: inputTypeEnums,\n                            allowEditOnly: true,\n                        },\n                        default: \"string\",\n                        parent: \"scriptInputs\",\n                        parentItemId: p.id,\n                    });\n                    // Default Value for input\n                    ports.push({\n                        name: \"in-\" + p.label,\n                        displayName: p.label,\n                        plug: \"input\",\n                        type: node.parameters[\"intype-\" + p.label] || \"string\",\n                        group: \"Inputs\",\n                    });\n                });\n            }\n            _parseScriptForErrorsAndPorts(node.parameters[\"functionScript\"], \"Script \", node, context, ports);\n            // Push output ports that are signals directly to the model, it's needed by the initial run of\n            // the script function\n            ports.forEach((p) => {\n                if (p.type === \"signal\" && p.plug === \"output\") {\n                    node.outputPorts[p.name] = p;\n                }\n            });\n            (_a = context.editorConnection) === null || _a === void 0 ? void 0 : _a.sendDynamicPorts(node.id, ports);\n        }\n        _updatePorts();\n        node.on(\"parameterUpdated\", function () {\n            _updatePorts();\n        });\n    }\n    graphModel.on(\"editorImportComplete\", () => {\n        graphModel.on(\"nodeAdded.JavaScriptFunction\", function (node) {\n            _managePortsForNode(node);\n        });\n        for (const node of graphModel.getNodesWithType(\"JavaScriptFunction\")) {\n            _managePortsForNode(node);\n        }\n    });\n}\n\nvar simplejavascript = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$t,\n    setup: setup$8\n});\n\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"items\")) {\n    Object.defineProperty(Array.prototype, \"items\", {\n        enumerable: false,\n        get() {\n            return this;\n        },\n        set(data) {\n            this.set(data);\n        },\n    });\n}\nObject.defineProperty(Array.prototype, \"each\", {\n    enumerable: false,\n    writable: false,\n    value: Array.prototype.forEach,\n});\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"size\")) {\n    Object.defineProperty(Array.prototype, \"size\", {\n        enumerable: false,\n        writable: false,\n        value: function () {\n            return this.length;\n        },\n    });\n}\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"get\")) {\n    Object.defineProperty(Array.prototype, \"get\", {\n        enumerable: false,\n        writable: false,\n        value: function (index) {\n            return this[index];\n        },\n    });\n}\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"getId\")) {\n    Object.defineProperty(Array.prototype, \"getId\", {\n        enumerable: false,\n        writable: false,\n        value: function () {\n            return this._id;\n        },\n    });\n}\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"id\")) {\n    Object.defineProperty(Array.prototype, \"id\", {\n        enumerable: false,\n        get() {\n            return this.getId();\n        },\n    });\n}\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"set\")) {\n    Object.defineProperty(Array.prototype, \"set\", {\n        enumerable: false,\n        writable: false,\n        value: function (src) {\n            let length, i;\n            if (src === this)\n                return;\n            src = src || []; //handle if src is undefined\n            function keyIndex(a) {\n                const keys = {};\n                const length = a.length;\n                for (let i = 0; i < length; i++) {\n                    const item = a[i];\n                    keys[item.getId()] = item;\n                }\n                return keys;\n            }\n            // Src can be a collection, or an array\n            const bItems = [];\n            length = src.length;\n            for (i = 0; i < length; i++) {\n                const item = src[i];\n                if (Model.instanceOf(item))\n                    bItems.push(item);\n                // @ts-expect-error TODO: What is this?\n                else\n                    bItems.push(Model.create(item));\n            }\n            const aItems = this.items;\n            const aKeys = keyIndex(aItems);\n            const bKeys = keyIndex(bItems);\n            // First remove all items not in the new collection\n            length = aItems.length;\n            for (i = 0; i < length; i++) {\n                if (!bKeys.hasOwnProperty(aItems[i].getId())) {\n                    // This item is not present in new collection, remove it\n                    this.removeAtIndex(i);\n                    i--;\n                    length--;\n                }\n            }\n            // Reorder items\n            for (i = 0; i < Math.min(aItems.length, bItems.length); i++) {\n                if (aItems[i] !== bItems[i]) {\n                    if (aKeys.hasOwnProperty(bItems[i].getId())) {\n                        // The bItem exist in the collection but is in the wrong place\n                        this.remove(bItems[i]);\n                    }\n                    // This is a new item, add it at correct index\n                    this.addAtIndex(bItems[i], i);\n                }\n            }\n            // Add remaining items\n            for (i = aItems.length; i < bItems.length; i++) {\n                this.add(bItems[i]);\n            }\n        },\n    });\n}\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"notify\")) {\n    Object.defineProperty(Array.prototype, \"notify\", {\n        enumerable: false,\n        writable: false,\n        value: async function (event, args) {\n            if (!this._listeners)\n                return;\n            if (!this._listeners[event])\n                return;\n            const l = this._listeners[event].slice(); //clone in case listeners array is modified in the callbacks\n            for (let i = 0; i < l.length; i++) {\n                await l[i](args);\n            }\n        },\n    });\n}\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"contains\")) {\n    Object.defineProperty(Array.prototype, \"contains\", {\n        enumerable: false,\n        writable: false,\n        value: function (item) {\n            return this.indexOf(item) !== -1;\n        },\n    });\n}\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"add\")) {\n    Object.defineProperty(Array.prototype, \"add\", {\n        enumerable: false,\n        writable: false,\n        value: async function (item) {\n            if (this.contains(item))\n                return; // Already contains item\n            this.items.push(item);\n            await this.notify(\"add\", { item: item, index: this.items.length - 1 });\n            await this.notify(\"change\");\n            item.notify(\"add\", { collection: this });\n        },\n    });\n}\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"remove\")) {\n    Object.defineProperty(Array.prototype, \"remove\", {\n        enumerable: false,\n        writable: false,\n        value: function (item) {\n            const idx = this.items.indexOf(item);\n            if (idx !== -1)\n                this.removeAtIndex(idx);\n        },\n    });\n}\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"addAtIndex\")) {\n    Object.defineProperty(Array.prototype, \"addAtIndex\", {\n        enumerable: false,\n        writable: false,\n        value: async function (item, index) {\n            if (this.contains(item))\n                return; // Already contains item\n            this.items.splice(index, 0, item);\n            await this.notify(\"add\", { item: item, index: index });\n            await this.notify(\"change\");\n            item.notify(\"add\", { collection: this, index: index });\n        },\n    });\n}\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"removeAtIndex\")) {\n    Object.defineProperty(Array.prototype, \"removeAtIndex\", {\n        enumerable: false,\n        writable: false,\n        value: async function (idx) {\n            const item = this.items[idx];\n            this.items.splice(idx, 1);\n            await this.notify(\"remove\", { item: item, index: idx });\n            await this.notify(\"change\");\n            await item.notify(\"remove\", { collection: this });\n        },\n    });\n}\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"on\")) {\n    Object.defineProperty(Array.prototype, \"on\", {\n        enumerable: false,\n        writable: false,\n        value: function (event, listener) {\n            if (!this._listeners)\n                Object.defineProperty(this, \"_listeners\", {\n                    enumerable: false,\n                    writable: false,\n                    value: {},\n                });\n            if (!this._listeners[event])\n                this._listeners[event] = [];\n            this._listeners[event].push(listener);\n        },\n    });\n}\nif (!Object.prototype.hasOwnProperty.call(Array.prototype, \"off\")) {\n    Object.defineProperty(Array.prototype, \"off\", {\n        enumerable: false,\n        writable: false,\n        value: function (event, listener) {\n            if (!this._listeners)\n                return;\n            if (!this._listeners[event])\n                return;\n            const idx = this._listeners[event].indexOf(listener);\n            if (idx !== -1)\n                this._listeners[event].splice(idx, 1);\n        },\n    });\n}\nclass Collection extends Array {\n    static create(items) {\n        const name = Model.guid();\n        Collection._collections[name] = new Collection();\n        Object.defineProperty(Collection._collections[name], \"_id\", {\n            enumerable: false,\n            writable: false,\n            value: name,\n        });\n        if (items) {\n            Collection._collections[name].set(items);\n        }\n        return Collection._collections[name];\n    }\n    static get(name) {\n        if (name === undefined)\n            name = Model.guid();\n        if (!Collection._collections[name]) {\n            Collection._collections[name] = new Collection();\n            Object.defineProperty(Collection._collections[name], \"_id\", {\n                enumerable: false,\n                writable: false,\n                value: name,\n            });\n        }\n        return Collection._collections[name];\n    }\n    static instanceOf(collection) {\n        return collection instanceof Collection;\n    }\n    static exists(name) {\n        return Collection._collections[name] !== undefined;\n    }\n}\nCollection._collections = {};\n\nclass CloudFile {\n    constructor({ name, url }) {\n        this.name = name;\n        this.url = url;\n    }\n    getUrl() {\n        return this.url;\n    }\n    getName() {\n        return this.name;\n    }\n    toString() {\n        return this.url;\n    }\n}\n\nconst _protectedFields = {\n    _common: [\"_createdAt\", \"_updatedAt\", \"objectId\"],\n    _User: [\"_email_verify_token\"],\n};\nfunction _removeProtectedFields(data, className) {\n    const _data = Object.assign({}, data);\n    _protectedFields._common.forEach((f) => delete _data[f]);\n    if (className && _protectedFields[className])\n        _protectedFields[className].forEach((f) => delete _data[f]);\n    return _data;\n}\nclass CloudStore {\n    static get instance() {\n        if (CloudStore._instance === undefined)\n            CloudStore._instance = new CloudStore();\n        return CloudStore._instance;\n    }\n    static get collections() {\n        if (CloudStore._collections === undefined) {\n            CloudStore._collections = {};\n            const dbCollections = NoodlRuntime$1.instance.getMetaData(\"dbCollections\") || [];\n            dbCollections.forEach((c) => {\n                if (CloudStore._collections) {\n                    CloudStore._collections[c.name] = c;\n                }\n            });\n            const systemCollections = NoodlRuntime$1.instance.getMetaData(\"systemCollections\") || [];\n            systemCollections.forEach((c) => {\n                if (CloudStore._collections) {\n                    CloudStore._collections[c.name] = c;\n                }\n            });\n        }\n        return CloudStore._collections;\n    }\n    constructor(modelScope) {\n        this._initCloudServices();\n        this.events = new EventEmitter();\n        // this.events.setMaxListeners(10000);\n        this.modelScope = modelScope || Model;\n    }\n    _fromJSON(item, collectionName) {\n        return CloudStore._fromJSON(item, collectionName, this.modelScope);\n    }\n    _deserializeJSON(data, type) {\n        return CloudStore._deserializeJSON(data, type, this.modelScope);\n    }\n    _serializeObject(data, collectionName) {\n        return CloudStore._serializeObject(data, collectionName, this.modelScope);\n    }\n    _initCloudServices() {\n        CloudStore._collections = undefined; // clear collection cache, so it's refetched\n        const cloudServices = NoodlRuntime$1.instance.getMetaData(\"cloudservices\");\n        if (cloudServices) {\n            this.appId = cloudServices.appId;\n            this.endpoint = cloudServices.endpoint;\n        }\n        const dbVersionMajor = NoodlRuntime$1.instance.getMetaData(\"dbVersionMajor\");\n        this.dbVersionMajor = dbVersionMajor;\n    }\n    on(event, fn, context) {\n        this.events.on.apply(this.events, [event, fn, context]);\n    }\n    off(event, fn, context, once) {\n        this.events.off.apply(this.events, [event, fn, context, once]);\n    }\n    _makeRequest(path, options) {\n        if (!this.appId)\n            throw new Error(\"App ID is not set\");\n        // @ts-expect-error _noodl_cloud_runtime_version\n        if (typeof _noodl_cloud_runtime_version === \"undefined\") {\n            // Running in browser\n            const xhr = new XMLHttpRequest();\n            xhr.onreadystatechange = function () {\n                if (xhr.readyState === 4) {\n                    let json;\n                    try {\n                        // In SSR, we dont have xhr.response\n                        json = JSON.parse(xhr.response || xhr.responseText);\n                    }\n                    catch (e) { }\n                    if (xhr.status === 200 || xhr.status === 201) {\n                        options.success(json);\n                    }\n                    else\n                        options.error(json || { error: xhr.responseText, status: xhr.status });\n                }\n            };\n            xhr.open(options.method || \"GET\", this.endpoint + path, true);\n            xhr.setRequestHeader(\"X-Parse-Application-Id\", this.appId);\n            // @ts-expect-error\n            if (typeof _noodl_cloudservices !== \"undefined\") {\n                xhr.setRequestHeader(\"X-Parse-Master-Key\", \n                // @ts-expect-error\n                _noodl_cloudservices.masterKey);\n            }\n            // Check for current users\n            const _cu = localStorage[\"Parse/\" + this.appId + \"/currentUser\"];\n            if (_cu !== undefined) {\n                try {\n                    const currentUser = JSON.parse(_cu);\n                    xhr.setRequestHeader(\"X-Parse-Session-Token\", currentUser.sessionToken);\n                }\n                catch (e) {\n                    // Failed to extract session token\n                }\n            }\n            if (options.onUploadProgress) {\n                xhr.upload.onprogress = (pe) => {\n                    if (options.onUploadProgress) {\n                        options.onUploadProgress(pe);\n                    }\n                };\n            }\n            if (options.content instanceof File) {\n                xhr.send(options.content);\n            }\n            else {\n                xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n                xhr.send(JSON.stringify(options.content));\n            }\n        }\n        else {\n            // Running in cloud runtime\n            const endpoint = \n            // @ts-expect-error\n            typeof _noodl_cloudservices !== \"undefined\"\n                ? // @ts-expect-error\n                    _noodl_cloudservices.endpoint\n                : this.endpoint;\n            const appId = \n            // @ts-expect-error\n            typeof _noodl_cloudservices !== \"undefined\"\n                ? // @ts-expect-error\n                    _noodl_cloudservices.appId\n                : this.appId;\n            const masterKey = \n            // @ts-expect-error\n            typeof _noodl_cloudservices !== \"undefined\"\n                ? // @ts-expect-error\n                    _noodl_cloudservices.masterKey\n                : undefined;\n            fetch(endpoint + path, {\n                method: options.method || \"GET\",\n                headers: {\n                    \"X-Parse-Application-Id\": appId,\n                    \"X-Parse-Master-Key\": masterKey,\n                    \"Content-Type\": \"application/json\",\n                },\n                body: JSON.stringify(options.content),\n            })\n                .then((r) => {\n                if (r.status === 200 || r.status === 201) {\n                    if (options.method === \"DELETE\") {\n                        options.success(undefined);\n                    }\n                    else {\n                        r.json()\n                            .then((json) => options.success(json))\n                            .catch((e) => options.error({\n                            error: \"CloudStore: Failed to get json result.\",\n                        }));\n                    }\n                }\n                else {\n                    if (options.method === \"DELETE\") {\n                        options.error({ error: \"Failed to delete.\" });\n                    }\n                    else {\n                        r.json()\n                            .then((json) => options.error(json))\n                            .catch((e) => options.error({ error: \"Failed to fetch.\" }));\n                    }\n                }\n            })\n                .catch((e) => {\n                options.error({ error: e.message });\n            });\n        }\n    }\n    query(options) {\n        this._makeRequest(\"/classes/\" + options.collection, {\n            method: \"POST\",\n            content: {\n                _method: \"GET\",\n                where: options.where,\n                limit: options.limit,\n                skip: options.skip,\n                include: Array.isArray(options.include)\n                    ? options.include.join(\",\")\n                    : options.include,\n                keys: Array.isArray(options.select)\n                    ? options.select.join(\",\")\n                    : options.select,\n                order: Array.isArray(options.sort)\n                    ? options.sort.join(\",\")\n                    : options.sort,\n                count: options.count,\n            },\n            success: function (response) {\n                options.success(response.results, response.count);\n            },\n            error: function () {\n                options.error();\n            },\n        });\n    }\n    aggregate(options) {\n        const args = [];\n        if (!options.group) {\n            options.error(\"You need to provide group option.\");\n            return;\n        }\n        if (options.limit)\n            args.push(\"limit=\" + options.limit);\n        if (options.skip)\n            args.push(\"skip=\" + options.skip);\n        const grouping = {};\n        Object.keys(options.group).forEach((k) => {\n            const _g = {};\n            const group = options.group[k];\n            if (group[\"avg\"] !== undefined)\n                _g[\"$avg\"] = \"$\" + group[\"avg\"];\n            else if (group[\"sum\"] !== undefined)\n                _g[\"$sum\"] = \"$\" + group[\"sum\"];\n            else if (group[\"max\"] !== undefined)\n                _g[\"$max\"] = \"$\" + group[\"max\"];\n            else if (group[\"min\"] !== undefined)\n                _g[\"$min\"] = \"$\" + group[\"min\"];\n            else if (group[\"distinct\"] !== undefined)\n                _g[\"$addToSet\"] = \"$\" + group[\"distinct\"];\n            grouping[k] = _g;\n        });\n        // I don't know which version the API was changed, lets just say above 4 for now.\n        if (this.dbVersionMajor && this.dbVersionMajor > 4) {\n            grouping._id = null;\n            if (options.where)\n                args.push(\"$match=\" + encodeURIComponent(JSON.stringify(options.where)));\n            args.push(\"$group=\" + JSON.stringify(grouping));\n        }\n        else {\n            grouping.objectId = null;\n            if (options.where)\n                args.push(\"match=\" + encodeURIComponent(JSON.stringify(options.where)));\n            args.push(\"group=\" + JSON.stringify(grouping));\n        }\n        this._makeRequest(\"/aggregate/\" +\n            options.collection +\n            (args.length > 0 ? \"?\" + args.join(\"&\") : \"\"), {\n            success: function (response) {\n                const res = {};\n                if (!response.results || response.results.length !== 1) {\n                    options.success({}); // No result\n                    return;\n                }\n                Object.keys(options.group).forEach((k) => {\n                    res[k] = response.results[0][k];\n                });\n                options.success(res);\n            },\n            error: function () {\n                options.error();\n            },\n        });\n    }\n    count(options) {\n        const args = [];\n        if (options.where)\n            args.push(\"where=\" + encodeURIComponent(JSON.stringify(options.where)));\n        args.push(\"limit=0\");\n        args.push(\"count=1\");\n        this._makeRequest(\"/classes/\" +\n            options.collection +\n            (args.length > 0 ? \"?\" + args.join(\"&\") : \"\"), {\n            success: function (response) {\n                options.success(response.count);\n            },\n            error: function () {\n                options.error();\n            },\n        });\n    }\n    distinct(options) {\n        const args = [];\n        if (options.where)\n            args.push(\"where=\" + encodeURIComponent(JSON.stringify(options.where)));\n        args.push(\"distinct=\" + options.property);\n        this._makeRequest(\"/aggregate/\" +\n            options.collection +\n            (args.length > 0 ? \"?\" + args.join(\"&\") : \"\"), {\n            success: function (response) {\n                options.success(response.results);\n            },\n            error: function () {\n                options.error();\n            },\n        });\n    }\n    fetch(options) {\n        const args = [];\n        if (options.include) {\n            args.push(\"include=\" +\n                (Array.isArray(options.include)\n                    ? options.include.join(\",\")\n                    : options.include));\n        }\n        if (options.keys) {\n            args.push(\"keys=\" +\n                (Array.isArray(options.keys) ? options.keys.join(\",\") : options.keys));\n        }\n        if (options.excludeKeys) {\n            args.push(\"excludeKeys=\" +\n                (Array.isArray(options.excludeKeys)\n                    ? options.excludeKeys.join(\",\")\n                    : options.excludeKeys));\n        }\n        this._makeRequest(\"/classes/\" +\n            options.collection +\n            \"/\" +\n            options.objectId +\n            (args.length > 0 ? \"?\" + args.join(\"&\") : \"\"), {\n            method: \"GET\",\n            success: (response) => {\n                options.success(response);\n                this.events.emit(\"fetch\", {\n                    type: \"fetch\",\n                    objectId: options.objectId,\n                    object: response,\n                    collection: options.collection,\n                });\n            },\n            error: function (res) {\n                options.error(res.error);\n            },\n        });\n    }\n    create(options) {\n        this._makeRequest(\"/classes/\" + options.collection, {\n            method: \"POST\",\n            content: Object.assign(_removeProtectedFields(CloudStore._serializeObject(options.data, options.collection), options.collection), { ACL: options.acl }),\n            success: (response) => {\n                const _obj = Object.assign({}, options.data, response);\n                options.success(_obj);\n                this.events.emit(\"create\", {\n                    type: \"create\",\n                    objectId: options.objectId,\n                    object: _obj,\n                    collection: options.collection,\n                });\n            },\n            error: function (res) {\n                options.error(res.error);\n            },\n        });\n    }\n    increment(options) {\n        const data = {};\n        for (let key in options.properties) {\n            data[key] = { __op: \"Increment\", amount: options.properties[key] };\n        }\n        this._makeRequest(\"/classes/\" + options.collection + \"/\" + options.objectId, {\n            method: \"PUT\",\n            content: data,\n            success: (response) => {\n                options.success(response);\n            },\n            error: function (res) {\n                options.error(res.error);\n            },\n        });\n    }\n    save(options) {\n        const _data = Object.assign({}, options.data);\n        delete _data.createdAt;\n        delete _data.updatedAt;\n        this._makeRequest(\"/classes/\" + options.collection + \"/\" + options.objectId, {\n            method: \"PUT\",\n            content: Object.assign(_removeProtectedFields(CloudStore._serializeObject(_data, options.collection), options.collection), {\n                ACL: options.acl,\n            }),\n            success: (response) => {\n                options.success(response);\n                this.events.emit(\"save\", {\n                    type: \"save\",\n                    objectId: options.objectId,\n                    object: Object.assign({}, options.data, response),\n                    collection: options.collection,\n                });\n            },\n            error: function (res) {\n                options.error(res.error);\n            },\n        });\n    }\n    delete(options) {\n        this._makeRequest(\"/classes/\" + options.collection + \"/\" + options.objectId, {\n            method: \"DELETE\",\n            success: () => {\n                options.success();\n                this.events.emit(\"delete\", {\n                    type: \"delete\",\n                    objectId: options.objectId,\n                    collection: options.collection,\n                });\n            },\n            error: function (res) {\n                options.error(res.error);\n            },\n        });\n    }\n    addRelation(options) {\n        if (!options.key)\n            throw new Error(\"Key is required\");\n        const _content = {};\n        _content[options.key] = {\n            __op: \"AddRelation\",\n            objects: [\n                {\n                    __type: \"Pointer\",\n                    objectId: options.targetObjectId,\n                    className: options.targetClass,\n                },\n            ],\n        };\n        this._makeRequest(\"/classes/\" + options.collection + \"/\" + options.objectId, {\n            method: \"PUT\",\n            content: _content,\n            success: function (response) {\n                options.success(response);\n            },\n            error: function (res) {\n                options.error(res.error);\n            },\n        });\n    }\n    removeRelation(options) {\n        if (!options.key)\n            throw new Error(\"Key is required\");\n        const _content = {};\n        _content[options.key] = {\n            __op: \"RemoveRelation\",\n            objects: [\n                {\n                    __type: \"Pointer\",\n                    objectId: options.targetObjectId,\n                    className: options.targetClass,\n                },\n            ],\n        };\n        this._makeRequest(\"/classes/\" + options.collection + \"/\" + options.objectId, {\n            method: \"PUT\",\n            content: _content,\n            success: function (response) {\n                options.success(response);\n            },\n            error: function (res) {\n                options.error(res.error);\n            },\n        });\n    }\n    uploadFile(options) {\n        if (!options.file)\n            throw new Error(\"File is required\");\n        this._makeRequest(\"/files/\" + options.file.name, {\n            method: \"POST\",\n            content: options.file,\n            contentType: options.file.type,\n            success: (response) => options.success(Object.assign({}, options.data, response)),\n            error: (err) => options.error(err),\n            onUploadProgress: options.onUploadProgress,\n        });\n    }\n    deleteFile(options) {\n        if (!options.file)\n            throw new Error(\"File is required\");\n        this._makeRequest(\"/files/\" + options.file.name, {\n            method: \"DELETE\",\n            success: (response) => options.success(Object.assign({}, options.data, response)),\n            error: (err) => options.error(err),\n        });\n    }\n    // TODO: What is modelScope?\n    static forScope(modelScope) {\n        if (modelScope === undefined)\n            return CloudStore.instance;\n        // @ts-expect-error\n        if (modelScope._cloudStore)\n            return modelScope._cloudStore;\n        // @ts-expect-error\n        modelScope._cloudStore = new CloudStore(modelScope);\n        // @ts-expect-error\n        return modelScope._cloudStore;\n    }\n    static invalidateCollections() {\n        // @ts-expect-error\n        _collections = undefined;\n    }\n    static _fromJSON(item, collectionName, modelScope) {\n        const modelStore = modelScope || Model;\n        const model = modelStore.get(item.objectId);\n        model._class = collectionName;\n        let schema;\n        if (collectionName !== undefined &&\n            // @ts-expect-error\n            CloudStore._collections[collectionName] !== undefined) {\n            // @ts-expect-error\n            schema = CloudStore._collections[collectionName].schema;\n        }\n        for (const key in item) {\n            if (key === \"objectId\" || key === \"ACL\") {\n                continue;\n            }\n            const _type = schema && schema.properties && schema.properties[key]\n                ? schema.properties[key].type\n                : undefined;\n            model.set(key, CloudStore._deserializeJSON(item[key], _type, modelScope));\n        }\n        return model;\n    }\n    static _serializeObject(data, collectionName, modelScope) {\n        let schema;\n        // @ts-expect-error\n        if (CloudStore._collections[collectionName])\n            // @ts-expect-error\n            schema = CloudStore._collections[collectionName].schema;\n        for (const key in data) {\n            const _type = schema && schema.properties && schema.properties[key]\n                ? schema.properties[key].type\n                : undefined;\n            if (data[key] === undefined || data[key] === null) ;\n            else if (_type === \"Pointer\" && typeof data[key] === \"string\") {\n                // This is a string pointer to an object\n                data[key] = {\n                    __type: \"Pointer\",\n                    className: schema.properties[key].targetClass,\n                    objectId: data[key],\n                };\n            }\n            else if (_type === \"Pointer\" &&\n                typeof data[key] === \"object\" &&\n                (modelScope || Model).instanceOf(data[key])) {\n                // This is an embedded object that should be stored as pointer\n                data[key] = {\n                    __type: \"Pointer\",\n                    className: schema.properties[key].targetClass,\n                    objectId: data[key].getId(),\n                };\n            }\n            else if (_type === \"Date\" &&\n                (typeof data[key] === \"string\" || data[key] instanceof Date)) {\n                data[key] = {\n                    __type: \"Date\",\n                    iso: data[key] instanceof Date ? data[key].toISOString() : data[key],\n                };\n            }\n            else if (_type === \"File\" && data[key] instanceof CloudFile) {\n                const cloudFile = data[key];\n                data[key] = {\n                    __type: \"File\",\n                    url: cloudFile.getUrl(),\n                    name: cloudFile.getName(),\n                };\n            }\n            else if (_type === \"Array\" &&\n                typeof data[key] === \"string\" &&\n                Collection.exists(data[key])) {\n                data[key] = _toJSON(Collection.get(data[key]));\n            }\n            else if (_type === \"Object\" &&\n                typeof data[key] === \"string\" &&\n                (modelScope || Model).exists(data[key])) {\n                data[key] = _toJSON((modelScope || Model).get(data[key]));\n            }\n            else if (_type === \"GeoPoint\" && typeof data[key] === \"object\") {\n                data[key] = {\n                    __type: \"GeoPoint\",\n                    latitude: Number(data[key].latitude),\n                    longitude: Number(data[key].longitude),\n                };\n            }\n            else\n                data[key] = _toJSON(data[key]);\n        }\n        return data;\n    }\n    static _deserializeJSON(data, type, modelScope) {\n        if (data === undefined)\n            return;\n        if (data === null)\n            return null;\n        if (type === \"Relation\" && data.__type === \"Relation\") {\n            return undefined; // Ignore relation fields\n        }\n        else if (type === \"Pointer\" && data.__type === \"Pointer\") {\n            // This is a pointer type, resolve into id\n            return data.objectId;\n        }\n        else if (type === \"Date\" && data.__type === \"Date\") {\n            return new Date(data.iso);\n        }\n        else if (type === \"Date\" && typeof data === \"string\") {\n            return new Date(data);\n        }\n        else if (type === \"File\" && data.__type === \"File\") {\n            return new CloudFile(data);\n        }\n        else if (type === \"GeoPoint\" && data.__type === \"GeoPoint\") {\n            return {\n                latitude: data.latitude,\n                longitude: data.longitude,\n            };\n        }\n        else if (_isArrayOfObjects(data)) {\n            const a = [];\n            for (let i = 0; i < data.length; i++) {\n                a.push(CloudStore._deserializeJSON(data[i], undefined, modelScope));\n            }\n            const c = Collection.get();\n            c.set(a);\n            return c;\n        }\n        else if (Array.isArray(data))\n            return data;\n        // This is an array with mixed data, just return it\n        else if (data &&\n            data.__type === \"Object\" &&\n            data.className !== undefined &&\n            data.objectId !== undefined) {\n            const _data = Object.assign({}, data);\n            delete _data.className;\n            delete _data.__type;\n            return CloudStore._fromJSON(_data, data.className, modelScope);\n        }\n        else if (typeof data === \"object\" && data !== null) {\n            const m = (modelScope || Model).get();\n            for (const key in data) {\n                m.set(key, CloudStore._deserializeJSON(data[key], undefined, modelScope));\n            }\n            return m;\n        }\n        else\n            return data;\n    }\n}\nfunction _isArrayOfObjects(a) {\n    if (!Array.isArray(a))\n        return false;\n    for (let i = 0; i < a.length; i++)\n        if (typeof a[i] !== \"object\" || a[i] === null)\n            return false;\n    return true;\n}\nfunction _toJSON(obj) {\n    if (obj instanceof Model) {\n        const res = {};\n        for (const key in obj.data) {\n            res[key] = _toJSON(obj.data[key]);\n        }\n        return res;\n    }\n    else if (obj instanceof Collection) {\n        const res = [];\n        obj.items.forEach((m) => {\n            res.push(_toJSON(m));\n        });\n        return res;\n    }\n    return obj;\n}\n\nfunction convertVisualFilter(query, options) {\n    const inputs = options.queryParameters;\n    if (query.combinator !== undefined && query.rules !== undefined) {\n        if (query.rules.length === 0)\n            return;\n        else if (query.rules.length === 1)\n            return convertVisualFilter(query.rules[0], options);\n        else {\n            const _res = {};\n            const _op = \"$\" + query.combinator;\n            _res[_op] = [];\n            query.rules.forEach((r) => {\n                const cond = convertVisualFilter(r, options);\n                if (cond !== undefined)\n                    _res[_op].push(cond);\n            });\n            return _res;\n        }\n    }\n    else if (query.operator === \"related to\") {\n        // @ts-expect-error\n        const value = query.input !== undefined ? inputs[query.input] : undefined;\n        if (value === undefined)\n            return;\n        return {\n            $relatedTo: {\n                object: {\n                    __type: \"Pointer\",\n                    objectId: value,\n                    className: query.relatedTo,\n                },\n                key: query.relationProperty,\n            },\n        };\n    }\n    else {\n        const _res = {};\n        let cond;\n        // @ts-expect-error\n        let value = query.input !== undefined ? inputs[query.input] : query.value;\n        if (query.operator === \"exist\") {\n            _res[query.property] = { $exists: true };\n            return _res;\n        }\n        else if (query.operator === \"not exist\") {\n            _res[query.property] = { $exists: false };\n            return _res;\n        }\n        if (value === undefined)\n            return;\n        let schema;\n        // @ts-expect-error\n        if (CloudStore._collections[options.collectionName]) {\n            // @ts-expect-error\n            schema = CloudStore._collections[options.collectionName].schema;\n        }\n        const propertyType = schema && schema.properties && schema.properties[query.property]\n            ? schema.properties[query.property].type\n            : undefined;\n        if (propertyType === \"Date\") {\n            if (!(value instanceof Date))\n                value = new Date(value.toString());\n            value = { __type: \"Date\", iso: value.toISOString() };\n        }\n        if (query.operator === \"greater than\")\n            cond = { $gt: value };\n        else if (query.operator === \"greater than or equal to\")\n            cond = { $gte: value };\n        else if (query.operator === \"less than\")\n            cond = { $lt: value };\n        else if (query.operator === \"less than or equal to\")\n            cond = { $lte: value };\n        else if (query.operator === \"equal to\")\n            cond = { $eq: value };\n        else if (query.operator === \"not equal to\")\n            cond = { $ne: value };\n        else if (query.operator === \"points to\") {\n            const targetClass = schema && schema.properties && schema.properties[query.property]\n                ? schema.properties[query.property].targetClass\n                : undefined;\n            cond = {\n                $eq: { __type: \"Pointer\", objectId: value, className: targetClass },\n            };\n        }\n        else if (query.operator === \"contain\") {\n            cond = { $regex: value, $options: \"i\" };\n        }\n        _res[query.property] = cond;\n        return _res;\n    }\n}\nfunction matchesQuery(model, query) {\n    let match = true;\n    if (query === undefined)\n        return true;\n    if (query[\"$and\"] !== undefined) {\n        query[\"$and\"].forEach((q) => {\n            match = match && matchesQuery(model, q);\n        });\n    }\n    else if (query[\"$or\"] !== undefined) {\n        match = false;\n        query[\"$or\"].forEach((q) => {\n            match = match || matchesQuery(model, q);\n        });\n    }\n    else {\n        const keys = Object.keys(query);\n        keys.forEach((k) => {\n            if (k === \"objectId\") {\n                if (query[k][\"$eq\"] !== undefined)\n                    match = match && model.getId() === query[k][\"$eq\"];\n                else if (query[k][\"$in\"] !== undefined)\n                    match = match && query[k][\"$in\"].indexOf(model.getId()) !== -1;\n            }\n            else if (k === \"$relatedTo\") {\n                match = false; // cannot resolve relation queries locally\n            }\n            else {\n                const value = model.get(k);\n                if (query[k][\"$eq\"] !== undefined &&\n                    query[k][\"$eq\"].__type === \"Pointer\")\n                    match = match && value === query[k][\"$eq\"].objectId;\n                else if (query[k][\"$eq\"] !== undefined)\n                    match = match && value == query[k][\"$eq\"];\n                else if (query[k][\"$ne\"] !== undefined)\n                    match = match && value != query[k][\"$ne\"];\n                else if (query[k][\"$lt\"] !== undefined)\n                    match = match && value < query[k][\"$lt\"];\n                else if (query[k][\"$lte\"] !== undefined)\n                    match = match && value <= query[k][\"$lt\"];\n                else if (query[k][\"$gt\"] !== undefined)\n                    match = match && value > query[k][\"$gt\"];\n                else if (query[k][\"$gte\"] !== undefined)\n                    match = match && value >= query[k][\"$gte\"];\n                else if (query[k][\"$exists\"] !== undefined)\n                    match = match && value !== undefined;\n                else if (query[k][\"$in\"] !== undefined)\n                    match = match && query[k][\"$in\"].indexOf(value) !== -1;\n                else if (query[k][\"$nin\"] !== undefined)\n                    match = match && query[k][\"$in\"].indexOf(value) === -1;\n                else if (query[k][\"$regex\"] !== undefined)\n                    match =\n                        match &&\n                            new RegExp(query[k][\"$regex\"], query[k][\"$options\"]).test(value);\n            }\n        });\n    }\n    return match;\n}\nfunction compareObjects(sort, a, b) {\n    for (let i = 0; i < sort.length; i++) {\n        let _s = sort[i];\n        if (_s[0] === \"-\") {\n            // Descending\n            let prop = _s.substring(1);\n            if (a.get(prop) > b.get(prop))\n                return -1;\n            else if (a.get(prop) < b.get(prop))\n                return 1;\n        }\n        else {\n            // Ascending\n            if (a.get(_s) > b.get(_s))\n                return 1;\n            else if (a.get(_s) < b.get(_s))\n                return -1;\n        }\n    }\n    return 0;\n}\nfunction convertVisualSorting(sorting) {\n    return sorting.map((s) => {\n        return (s.order === \"descending\" ? \"-\" : \"\") + s.property;\n    });\n}\nfunction _value(v) {\n    if (v instanceof Date && typeof v.toISOString === \"function\") {\n        return {\n            __type: \"Date\",\n            iso: v.toISOString(),\n        };\n    }\n    return v;\n}\nfunction convertFilterOp(filter, options) {\n    var _a, _b, _c, _d, _e, _f;\n    const keys = Object.keys(filter);\n    if (keys.length === 0)\n        return {};\n    if (keys.length !== 1) {\n        return (_a = options === null || options === void 0 ? void 0 : options.error) === null || _a === void 0 ? void 0 : _a.call(options, \"Filter must only have one key found \" + keys.join(\",\"));\n    }\n    const res = {};\n    const key = keys[0];\n    if (filter[\"and\"] !== undefined && Array.isArray(filter[\"and\"])) {\n        res[\"$and\"] = filter[\"and\"].map((f) => convertFilterOp(f, options));\n    }\n    else if (filter[\"or\"] !== undefined && Array.isArray(filter[\"or\"])) {\n        res[\"$or\"] = filter[\"or\"].map((f) => convertFilterOp(f, options));\n    }\n    else if (filter[\"idEqualTo\"] !== undefined) {\n        res[\"objectId\"] = { $eq: filter[\"idEqualTo\"] };\n    }\n    else if (filter[\"idContainedIn\"] !== undefined) {\n        res[\"objectId\"] = { $in: filter[\"idContainedIn\"] };\n    }\n    else if (filter[\"relatedTo\"] !== undefined) {\n        const modelId = filter[\"relatedTo\"][\"id\"];\n        if (modelId === undefined) {\n            return (_b = options === null || options === void 0 ? void 0 : options.error) === null || _b === void 0 ? void 0 : _b.call(options, \"Must provide id in relatedTo filter\");\n        }\n        const relationKey = filter[\"relatedTo\"][\"key\"];\n        if (relationKey === undefined) {\n            return (_c = options === null || options === void 0 ? void 0 : options.error) === null || _c === void 0 ? void 0 : _c.call(options, \"Must provide key in relatedTo filter\");\n        }\n        const className = filter[\"relatedTo\"][\"className\"] ||\n            ((_d = (options.modelScope || Model).get(modelId)) === null || _d === void 0 ? void 0 : _d._class);\n        if (typeof className === \"undefined\") {\n            // Either the pointer is loaded as an object or we allow passing in the className.\n            return (_e = options === null || options === void 0 ? void 0 : options.error) === null || _e === void 0 ? void 0 : _e.call(options, \"Must preload the Pointer or include className\");\n        }\n        res[\"$relatedTo\"] = {\n            object: {\n                __type: \"Pointer\",\n                objectId: modelId,\n                className,\n            },\n            key: relationKey,\n        };\n    }\n    else if (typeof filter[key] === \"object\") {\n        const opAndValue = filter[key];\n        if (opAndValue[\"equalTo\"] !== undefined)\n            res[key] = { $eq: _value(opAndValue[\"equalTo\"]) };\n        else if (opAndValue[\"notEqualTo\"] !== undefined)\n            res[key] = { $ne: _value(opAndValue[\"notEqualTo\"]) };\n        else if (opAndValue[\"lessThan\"] !== undefined)\n            res[key] = { $lt: _value(opAndValue[\"lessThan\"]) };\n        else if (opAndValue[\"greaterThan\"] !== undefined)\n            res[key] = { $gt: _value(opAndValue[\"greaterThan\"]) };\n        else if (opAndValue[\"lessThanOrEqualTo\"] !== undefined)\n            res[key] = { $lte: _value(opAndValue[\"lessThanOrEqualTo\"]) };\n        else if (opAndValue[\"greaterThanOrEqualTo\"] !== undefined)\n            res[key] = { $gte: _value(opAndValue[\"greaterThanOrEqualTo\"]) };\n        else if (opAndValue[\"exists\"] !== undefined)\n            res[key] = { $exists: opAndValue[\"exists\"] };\n        else if (opAndValue[\"containedIn\"] !== undefined)\n            res[key] = { $in: opAndValue[\"containedIn\"] };\n        else if (opAndValue[\"notContainedIn\"] !== undefined)\n            res[key] = { $nin: opAndValue[\"notContainedIn\"] };\n        else if (opAndValue[\"pointsTo\"] !== undefined) {\n            let schema = null;\n            // @ts-expect-error\n            if (CloudStore._collections[options.collectionName]) {\n                // @ts-expect-error\n                schema = CloudStore._collections[options.collectionName].schema;\n            }\n            const targetClass = \n            // @ts-expect-error\n            schema && schema.properties && schema.properties[key]\n                ? // @ts-expect-error\n                    schema.properties[key].targetClass\n                : undefined;\n            const type = \n            // @ts-expect-error\n            schema && schema.properties && schema.properties[key]\n                ? // @ts-expect-error\n                    schema.properties[key].type\n                : undefined;\n            if (type === \"Relation\") {\n                res[key] = {\n                    __type: \"Pointer\",\n                    objectId: opAndValue[\"pointsTo\"],\n                    className: targetClass,\n                };\n            }\n            else {\n                if (Array.isArray(opAndValue[\"pointsTo\"])) {\n                    res[key] = {\n                        $in: opAndValue[\"pointsTo\"].map((v) => {\n                            return { __type: \"Pointer\", objectId: v, className: targetClass };\n                        }),\n                    };\n                }\n                else {\n                    res[key] = {\n                        $eq: {\n                            __type: \"Pointer\",\n                            objectId: opAndValue[\"pointsTo\"],\n                            className: targetClass,\n                        },\n                    };\n                }\n            }\n        }\n        else if (opAndValue[\"matchesRegex\"] !== undefined) {\n            res[key] = {\n                $regex: opAndValue[\"matchesRegex\"],\n                $options: opAndValue[\"options\"],\n            };\n        }\n        else if (opAndValue[\"text\"] !== undefined &&\n            opAndValue[\"text\"][\"search\"] !== undefined) {\n            const _v = opAndValue[\"text\"][\"search\"];\n            if (typeof _v === \"string\")\n                res[key] = { $text: { $search: { $term: _v, $caseSensitive: false } } };\n            else\n                res[key] = {\n                    $text: {\n                        $search: {\n                            $term: _v.term,\n                            $language: _v.language,\n                            $caseSensitive: _v.caseSensitive,\n                            $diacriticSensitive: _v.diacriticSensitive,\n                        },\n                    },\n                };\n            // Geo points\n        }\n        else if (opAndValue[\"nearSphere\"] !== undefined) {\n            const _v = opAndValue[\"nearSphere\"];\n            res[key] = {\n                $nearSphere: {\n                    __type: \"GeoPoint\",\n                    latitude: _v.latitude,\n                    longitude: _v.longitude,\n                },\n                $maxDistanceInMiles: _v.maxDistanceInMiles,\n                $maxDistanceInKilometers: _v.maxDistanceInKilometers,\n                $maxDistanceInRadians: _v.maxDistanceInRadians,\n            };\n        }\n        else if (opAndValue[\"withinBox\"] !== undefined) {\n            const _v = opAndValue[\"withinBox\"];\n            res[key] = {\n                $within: {\n                    $box: _v.map((gp) => ({\n                        __type: \"GeoPoint\",\n                        latitude: gp.latitude,\n                        longitude: gp.longitude,\n                    })),\n                },\n            };\n        }\n        else if (opAndValue[\"withinPolygon\"] !== undefined) {\n            const _v = opAndValue[\"withinPolygon\"];\n            res[key] = {\n                $geoWithin: {\n                    $polygon: _v.map((gp) => ({\n                        __type: \"GeoPoint\",\n                        latitude: gp.latitude,\n                        longitude: gp.longitude,\n                    })),\n                },\n            };\n        }\n    }\n    else {\n        (_f = options === null || options === void 0 ? void 0 : options.error) === null || _f === void 0 ? void 0 : _f.call(options, \"Unrecognized filter keys \" + keys.join(\",\"));\n    }\n    return res;\n}\n\nconst node$s = {\n    name: \"DbCollection2\",\n    docs: \"https://docs.noodl.net/nodes/data/cloud-data/query-records\",\n    displayName: \"Query Records\",\n    /* shortDesc: \"A database collection.\",*/\n    category: \"Cloud Services\",\n    usePortAsLabel: \"collectionName\",\n    color: \"data\",\n    initialize() {\n        const _this = this;\n        this._internal.queryParameters = {};\n        let collectionChangedScheduled = false;\n        this._internal.collectionChangedCallback = function () {\n            //this can be called multiple times when adding/removing more than one item\n            //so optimize by only updating outputs once\n            if (collectionChangedScheduled)\n                return;\n            collectionChangedScheduled = true;\n            _this.scheduleAfterInputsHaveUpdated(function () {\n                _this.flagOutputDirty(\"count\");\n                _this.flagOutputDirty(\"firstItemId\");\n                _this.flagOutputDirty(\"isEmpty\");\n                collectionChangedScheduled = false;\n            });\n        };\n        this._internal.cloudStoreEvents = function (args) {\n            var _a, _b;\n            if (_this.isInputConnected(\"storageFetch\") === true)\n                return;\n            if (_this._internal.collection === undefined)\n                return;\n            if (args.collection !== _this._internal.name)\n                return;\n            function _addModelAtCorrectIndex(m) {\n                var _a, _b;\n                if (((_a = _this._internal.currentQuery) === null || _a === void 0 ? void 0 : _a.sort) !== undefined) {\n                    // We need to add it at the right index\n                    for (let i = 0; i < _this._internal.collection.size(); i++)\n                        if (compareObjects(_this._internal.currentQuery.sort, _this._internal.collection.get(i), m) > 0)\n                            break;\n                    // @ts-expect-error\n                    _this._internal.collection.addAtIndex(m, i);\n                }\n                else {\n                    _this._internal.collection.add(m);\n                }\n                // Make sure we don't exceed limit\n                let size = _this._internal.collection.size();\n                if (((_b = _this._internal.currentQuery) === null || _b === void 0 ? void 0 : _b.limit) !== undefined &&\n                    size > _this._internal.currentQuery.limit)\n                    _this._internal.collection.remove(_this._internal.collection.get(_this._internal.currentQuery.sort !== undefined &&\n                        _this._internal.currentQuery.sort[0][0] === \"-\"\n                        ? size - 1\n                        : 0));\n                //Send the array again over the items output to trigger function nodes etc that might be connected\n                _this.flagOutputDirty(\"items\");\n                _this.flagOutputDirty(\"count\");\n                _this.flagOutputDirty(\"firstItemId\");\n                _this.flagOutputDirty(\"isEmpty\");\n            }\n            if (args.type === \"create\") {\n                const m = Model.get(args.object.objectId);\n                if (m !== undefined) {\n                    // Check if the object matches the current query\n                    if (matchesQuery(m, (_a = _this._internal.currentQuery) === null || _a === void 0 ? void 0 : _a.where)) {\n                        // If matches the query, add the item to results\n                        _addModelAtCorrectIndex(m);\n                    }\n                }\n            }\n            else if (args.type === \"save\") {\n                const m = Model.get(args.objectId);\n                if (m !== undefined) {\n                    const matchesQuery$1 = matchesQuery(m, (_b = _this._internal.currentQuery) === null || _b === void 0 ? void 0 : _b.where);\n                    if (!matchesQuery$1 && _this._internal.collection.contains(m)) {\n                        // The record no longer matches the filter, remove it\n                        _this._internal.collection.remove(m);\n                        //Send the array again over the items output to trigger function nodes etc that might be connected\n                        _this.flagOutputDirty(\"items\");\n                        _this.flagOutputDirty(\"count\");\n                        _this.flagOutputDirty(\"firstItemId\");\n                        _this.flagOutputDirty(\"isEmpty\");\n                    }\n                    else if (matchesQuery$1 && !_this._internal.collection.contains(m)) {\n                        // It's not part of the result collection but now matches they query, add it and resort\n                        _addModelAtCorrectIndex(m);\n                    }\n                }\n            }\n            else if (args.type === \"delete\") {\n                const m = Model.get(args.objectId);\n                if (m !== undefined) {\n                    _this._internal.collection.remove(m);\n                    //Send the array again over the items output to trigger function nodes etc that might be connected\n                    _this.flagOutputDirty(\"items\");\n                    _this.flagOutputDirty(\"count\");\n                    _this.flagOutputDirty(\"firstItemId\");\n                    _this.flagOutputDirty(\"isEmpty\");\n                }\n            }\n        };\n        // Listening to cloud store events is only for the global model scope, only valid in browser\n        // in cloud runtime its a nop\n        // @ts-expect-error\n        const cloudstore = CloudStore.forScope(this.nodeScope.modelScope);\n        cloudstore.on(\"save\", this._internal.cloudStoreEvents);\n        cloudstore.on(\"create\", this._internal.cloudStoreEvents);\n        cloudstore.on(\"delete\", this._internal.cloudStoreEvents);\n        this._internal.storageSettings = {};\n    },\n    getInspectInfo() {\n        const collection = this._internal.collection;\n        if (!collection) {\n            return { type: \"text\", value: \"[Not executed yet]\" };\n        }\n        return [\n            {\n                type: \"value\",\n                value: collection.items,\n            },\n        ];\n    },\n    inputs: {},\n    outputs: {\n        items: {\n            type: \"array\",\n            displayName: \"Items\",\n            group: \"General\",\n            getter() {\n                return this._internal.collection;\n            },\n        },\n        firstItemId: {\n            type: \"string\",\n            displayName: \"First Record Id\",\n            group: \"General\",\n            getter() {\n                if (this._internal.collection) {\n                    const firstItem = this._internal.collection.get(0);\n                    if (firstItem !== undefined)\n                        return firstItem.getId();\n                }\n            },\n        },\n        isEmpty: {\n            type: \"boolean\",\n            displayName: \"Is Empty\",\n            group: \"General\",\n            getter() {\n                if (this._internal.collection) {\n                    return this._internal.collection.size() === 0;\n                }\n                return true;\n            },\n        },\n        count: {\n            type: \"number\",\n            displayName: \"Count\",\n            group: \"General\",\n            getter() {\n                return this._internal.collection ? this._internal.collection.size() : 0;\n            },\n        },\n        fetched: {\n            group: \"Events\",\n            type: \"signal\",\n            displayName: \"Success\",\n        },\n        failure: {\n            group: \"Events\",\n            type: \"signal\",\n            displayName: \"Failure\",\n        },\n        error: {\n            type: \"string\",\n            displayName: \"Error\",\n            group: \"Error\",\n            getter() {\n                return this._internal.error;\n            },\n        },\n    },\n    prototypeExtensions: {\n        setCollectionName(name) {\n            this._internal.name = name;\n            // @ts-expect-error\n            if (this.isInputConnected(\"storageFetch\") === false)\n                this.scheduleFetch();\n        },\n        setCollection(collection) {\n            // @ts-expect-error\n            this.bindCollection(collection);\n            this.flagOutputDirty(\"firstItemId\");\n            this.flagOutputDirty(\"isEmpty\");\n            this.flagOutputDirty(\"items\");\n            this.flagOutputDirty(\"count\");\n        },\n        unbindCurrentCollection() {\n            const collection = this._internal.collection;\n            if (!collection)\n                return;\n            collection.off(\"change\", this._internal.collectionChangedCallback);\n            this._internal.collection = undefined;\n        },\n        bindCollection(collection) {\n            // @ts-expect-error\n            this.unbindCurrentCollection();\n            this._internal.collection = collection;\n            collection &&\n                collection.on(\"change\", this._internal.collectionChangedCallback);\n        },\n        _onNodeDeleted() {\n            Node.prototype._onNodeDeleted.call(this);\n            // @ts-expect-error\n            this.unbindCurrentCollection();\n            // @ts-expect-error\n            const cloudstore = CloudStore.forScope(this.nodeScope.modelScope);\n            cloudstore.off(\"insert\", this._internal.cloudStoreEvents);\n            cloudstore.off(\"delete\", this._internal.cloudStoreEvents);\n            cloudstore.off(\"save\", this._internal.cloudStoreEvents);\n        },\n        setError(err) {\n            this._internal.err = err;\n            this.flagOutputDirty(\"error\");\n            this.sendSignalOnOutput(\"failure\");\n        },\n        scheduleFetch() {\n            const internal = this._internal;\n            if (internal.fetchScheduled)\n                return;\n            internal.fetchScheduled = true;\n            this.scheduleAfterInputsHaveUpdated(() => {\n                internal.fetchScheduled = false;\n                // @ts-expect-error\n                this.fetch();\n            });\n        },\n        fetch() {\n            if (this.context.editorConnection) {\n                if (this._internal.name === undefined) {\n                    this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, \"query-collection\", {\n                        message: \"No collection specified for query\",\n                    });\n                }\n                else {\n                    this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, \"query-collection\");\n                }\n            }\n            const _c = Collection.get();\n            // @ts-expect-error\n            const f = this.getStorageFilter();\n            // @ts-expect-error\n            const limit = this.getStorageLimit();\n            // @ts-expect-error\n            const skip = this.getStorageSkip();\n            // @ts-expect-error\n            const count = this.getStorageFetchTotalCount();\n            this._internal.currentQuery = {\n                where: f.where,\n                sort: f.sort,\n                limit,\n                skip,\n            };\n            CloudStore.forScope(this.nodeScope.modelScope).query({\n                // @ts-expect-error\n                collection: this._internal.name,\n                where: f.where,\n                sort: f.sort,\n                limit,\n                skip,\n                count,\n                success: (results, count) => {\n                    if (results !== undefined) {\n                        _c.set(results.map((i) => {\n                            const m = CloudStore._fromJSON(i, \n                            // @ts-expect-error\n                            this._internal.name, \n                            // @ts-expect-error\n                            this.nodeScope.modelScope);\n                            return m;\n                        }));\n                    }\n                    if (count !== undefined) {\n                        this._internal.storageSettings.storageTotalCount = count;\n                        if (this.hasOutput(\"storageTotalCount\"))\n                            this.flagOutputDirty(\"storageTotalCount\");\n                    }\n                    // @ts-expect-error\n                    this.setCollection(_c);\n                    this.sendSignalOnOutput(\"fetched\");\n                },\n                error: (err) => {\n                    // @ts-expect-error\n                    this.setCollection(_c);\n                    // @ts-expect-error\n                    this.setError(err || \"Failed to fetch.\");\n                },\n            });\n        },\n        // @ts-expect-error\n        getStorageFilter() {\n            var _a;\n            const storageSettings = this._internal.storageSettings;\n            if (storageSettings[\"storageFilterType\"] === undefined ||\n                storageSettings[\"storageFilterType\"] === \"simple\") {\n                // Create simple filter\n                const _where = this._internal.visualFilter !== undefined\n                    ? convertVisualFilter(this._internal.visualFilter, {\n                        queryParameters: this._internal.queryParameters,\n                        collectionName: this._internal.name,\n                    })\n                    : undefined;\n                const _sort = this._internal.visualSorting !== undefined\n                    ? convertVisualSorting(this._internal.visualSorting)\n                    : undefined;\n                return {\n                    where: _where,\n                    sort: _sort,\n                };\n            }\n            else if (storageSettings[\"storageFilterType\"] === \"json\") {\n                // JSON filter\n                if (!this._internal.filterFunc) {\n                    try {\n                        let filterCode = storageSettings[\"storageJSONFilter\"];\n                        // Parse out variables\n                        filterCode = filterCode.replace(/\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/g, \"\"); // Remove comments\n                        this._internal.filterVariables =\n                            filterCode.match(/\\$[A-Za-z0-9]+/g) || [];\n                        const args = [\"filter\", \"where\", \"sort\", \"Inputs\"]\n                            // @ts-expect-error\n                            .concat(this._internal.filterVariables)\n                            .concat([filterCode]);\n                        this._internal.filterFunc = Function.apply(null, args);\n                    }\n                    catch (e) {\n                        this._internal.filterFunc = undefined;\n                        console.log(\"Error while parsing filter script: \" + e);\n                    }\n                }\n                if (!this._internal.filterFunc)\n                    return;\n                let _filter = {}, _sort = [];\n                const _this = this;\n                // Collect filter variables\n                const _filterCb = function (f) {\n                    _filter = convertFilterOp(f, {\n                        collectionName: _this._internal.name,\n                        error(err) {\n                            // @ts-expect-error\n                            _this.context.editorConnection.sendWarning(\n                            // @ts-expect-error\n                            _this.nodeScope.componentOwner.name, _this.id, \"query-collection-filter\", {\n                                message: err,\n                            });\n                        },\n                    });\n                };\n                const _sortCb = function (s) {\n                    _sort = s;\n                };\n                // Extract inputs\n                const inputs = {};\n                for (const key in storageSettings) {\n                    if (key.startsWith(\"storageFilterValue-\"))\n                        inputs[key.substring(\"storageFilterValue-\".length)] =\n                            storageSettings[key];\n                }\n                const filterFuncArgs = [_filterCb, _filterCb, _sortCb, inputs]; // One for filter, one for where\n                (_a = this._internal.filterVariables) === null || _a === void 0 ? void 0 : _a.forEach((v) => {\n                    filterFuncArgs.push(storageSettings[\"storageFilterValue-\" + v.substring(1)]);\n                });\n                // Run the code to get the filter\n                try {\n                    this._internal.filterFunc.apply(this, filterFuncArgs);\n                }\n                catch (e) {\n                    console.log(\"Error while running filter script: \" + e);\n                }\n                return { where: _filter, sort: _sort };\n            }\n        },\n        // @ts-expect-error\n        getStorageLimit() {\n            const storageSettings = this._internal.storageSettings;\n            if (!storageSettings[\"storageEnableLimit\"])\n                return undefined;\n            else\n                return storageSettings[\"storageLimit\"] || 10;\n        },\n        // @ts-expect-error\n        getStorageSkip() {\n            const storageSettings = this._internal.storageSettings;\n            if (!storageSettings[\"storageEnableLimit\"])\n                return undefined;\n            else\n                return storageSettings[\"storageSkip\"] || 0;\n        },\n        // @ts-expect-error\n        getStorageFetchTotalCount() {\n            const storageSettings = this._internal.storageSettings;\n            return !!storageSettings[\"storageEnableCount\"];\n        },\n        registerOutputIfNeeded(name) {\n            if (this.hasOutput(name)) {\n                return;\n            }\n            this.registerOutput(name, {\n                getter() {\n                    return this._internal.storageSettings[name];\n                },\n            });\n        },\n        setVisualFilter(value) {\n            this._internal.visualFilter = value;\n            // @ts-expect-error\n            if (this.isInputConnected(\"storageFetch\") === false)\n                this.scheduleFetch();\n        },\n        setVisualSorting(value) {\n            this._internal.visualSorting = value;\n            // @ts-expect-error\n            if (this.isInputConnected(\"storageFetch\") === false)\n                this.scheduleFetch();\n        },\n        setQueryParameter(name, value) {\n            this._internal.queryParameters[name] = value;\n            // @ts-expect-error\n            if (this.isInputConnected(\"storageFetch\") === false)\n                this.scheduleFetch();\n        },\n        registerInputIfNeeded(name) {\n            if (this.hasInput(name)) {\n                return;\n            }\n            if (name.startsWith(\"qp-\"))\n                return this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this.setQueryParameter.bind(this, name.substring(\"qp-\".length)),\n                });\n            const dynamicSignals = {\n                // @ts-expect-error\n                storageFetch: this.scheduleFetch.bind(this),\n            };\n            if (dynamicSignals[name])\n                return this.registerInput(name, {\n                    set: createSetter({\n                        valueChangedToTrue: dynamicSignals[name],\n                    }),\n                });\n            const dynamicSetters = {\n                // @ts-expect-error\n                collectionName: this.setCollectionName.bind(this),\n                // @ts-expect-error\n                visualFilter: this.setVisualFilter.bind(this),\n                // @ts-expect-error\n                visualSort: this.setVisualSorting.bind(this),\n            };\n            if (dynamicSetters[name])\n                return this.registerInput(name, {\n                    set: dynamicSetters[name],\n                });\n            this.registerInput(name, {\n                set(value) {\n                    this._internal.storageSettings[name] = value;\n                    if (this.isInputConnected(\"storageFetch\") === false) {\n                        // @ts-expect-error\n                        this.scheduleFetch();\n                    }\n                },\n            });\n        },\n    },\n};\nconst _defaultJSONQuery = \"// Write your query script here, check out the reference documentation for examples\\n\" +\n    \"where({ })\\n\";\nfunction updatePorts$6(nodeId, parameters, editorConnection, graphModel) {\n    const ports = [];\n    const dbCollections = graphModel.getMetaData(\"dbCollections\");\n    const systemCollections = graphModel.getMetaData(\"systemCollections\");\n    const _systemClasses = [\n        { label: \"User\", value: \"_User\" },\n        { label: \"Role\", value: \"_Role\" },\n    ];\n    ports.push({\n        name: \"collectionName\",\n        type: {\n            name: \"enum\",\n            enums: _systemClasses.concat(dbCollections !== undefined\n                ? dbCollections.map((c) => {\n                    return { value: c.name, label: c.name };\n                })\n                : []),\n            allowEditOnly: true,\n        },\n        displayName: \"Class\",\n        plug: \"input\",\n        group: \"General\",\n    });\n    ports.push({\n        name: \"storageFilterType\",\n        type: {\n            name: \"enum\",\n            allowEditOnly: true,\n            enums: [\n                { value: \"simple\", label: \"Visual\" },\n                { value: \"json\", label: \"Javascript\" },\n            ],\n        },\n        displayName: \"Filter\",\n        default: \"simple\",\n        plug: \"input\",\n        group: \"General\",\n    });\n    // Limit\n    ports.push({\n        type: { name: \"boolean\" },\n        plug: \"input\",\n        group: \"Limit\",\n        name: \"storageEnableLimit\",\n        displayName: \"Use limit\",\n    });\n    if (parameters[\"storageEnableLimit\"]) {\n        ports.push({\n            type: { name: \"number\" },\n            default: 10,\n            plug: \"input\",\n            group: \"Limit\",\n            name: \"storageLimit\",\n            displayName: \"Limit\",\n        });\n        ports.push({\n            type: { name: \"number\" },\n            default: 0,\n            plug: \"input\",\n            group: \"Limit\",\n            name: \"storageSkip\",\n            displayName: \"Skip\",\n        });\n    }\n    ports.push({\n        type: { name: \"signal\" },\n        plug: \"input\",\n        group: \"Actions\",\n        name: \"storageFetch\",\n        displayName: \"Do\",\n    });\n    // Total Count\n    ports.push({\n        type: { name: \"boolean\" },\n        plug: \"input\",\n        group: \"Total Count\",\n        name: \"storageEnableCount\",\n        displayName: \"Fetch total count\",\n    });\n    if (parameters[\"storageEnableCount\"]) {\n        ports.push({\n            type: { name: \"number\" },\n            plug: \"output\",\n            group: \"General\",\n            name: \"storageTotalCount\",\n            displayName: \"Total Count\",\n        });\n    }\n    // Simple query\n    if (parameters[\"storageFilterType\"] === undefined ||\n        parameters[\"storageFilterType\"] === \"simple\") {\n        if (parameters.collectionName !== undefined) {\n            let c = dbCollections &&\n                dbCollections.find((c) => c.name === parameters.collectionName);\n            if (c === undefined && systemCollections)\n                c = systemCollections.find((c) => c.name === parameters.collectionName);\n            if (c && c.schema && c.schema.properties) {\n                const schema = JSON.parse(JSON.stringify(c.schema));\n                dbCollections === null || dbCollections === void 0 ? void 0 : dbCollections.forEach(_findRelations.bind(null, parameters, schema));\n                systemCollections === null || systemCollections === void 0 ? void 0 : systemCollections.forEach(_findRelations.bind(null, parameters, schema));\n                ports.push({\n                    name: \"visualFilter\",\n                    plug: \"input\",\n                    type: { name: \"query-filter\", schema: schema, allowEditOnly: true },\n                    displayName: \"Filter\",\n                    group: \"Filter\",\n                });\n                ports.push({\n                    name: \"visualSort\",\n                    plug: \"input\",\n                    type: { name: \"query-sorting\", schema: schema, allowEditOnly: true },\n                    displayName: \"Sort\",\n                    group: \"Sorting\",\n                });\n            }\n            if (parameters.visualFilter !== undefined) {\n                // Find all input ports\n                const uniqueInputs = {};\n                _collectInputs$1(uniqueInputs, parameters.visualFilter);\n                Object.keys(uniqueInputs).forEach((input) => {\n                    ports.push({\n                        name: \"qp-\" + input,\n                        plug: \"input\",\n                        type: { name: \"*\" },\n                        displayName: input,\n                        group: \"Query Parameters\",\n                    });\n                });\n            }\n        }\n    }\n    // JSON query\n    else if (parameters[\"storageFilterType\"] === \"json\") {\n        ports.push({\n            type: { name: \"string\", allowEditOnly: true, codeeditor: \"javascript\" },\n            plug: \"input\",\n            group: \"Filter\",\n            name: \"storageJSONFilter\",\n            default: _defaultJSONQuery,\n            displayName: \"Filter\",\n        });\n        let filter = String(parameters[\"storageJSONFilter\"]);\n        if (filter) {\n            filter = filter.replace(/\\/\\*[\\s\\S]*?\\*\\/|\\/\\/.*/g, \"\"); // Remove comments\n            const variables = filter.match(/\\$[A-Za-z0-9]+/g);\n            if (variables) {\n                const unique = {};\n                variables.forEach((v) => {\n                    unique[v] = true;\n                });\n                Object.keys(unique).forEach((p) => {\n                    ports.push({\n                        name: \"storageFilterValue-\" + p.substring(1),\n                        displayName: p.substring(1),\n                        group: \"Filter Values\",\n                        plug: \"input\",\n                        type: { name: \"*\", allowConnectionsOnly: true },\n                    });\n                });\n            }\n            // Support variables with the \"Inputs.\"\" syntax\n            JavascriptNodeParser.parseAndAddPortsFromScript(filter, ports, {\n                inputPrefix: \"storageFilterValue-\",\n                inputGroup: \"Filter Values\",\n                inputType: { name: \"*\", allowConnectionsOnly: true },\n                skipOutputs: true,\n            });\n        }\n    }\n    editorConnection.sendDynamicPorts(nodeId, ports);\n}\nfunction setup$7(context, graphModel) {\n    if (!context.editorConnection ||\n        !context.editorConnection.isRunningLocally()) {\n        return;\n    }\n    function _managePortsForNode(node) {\n        updatePorts$6(node.id, node.parameters, context.editorConnection, graphModel);\n        node.on(\"parameterUpdated\", function (event) {\n            if (event.name.startsWith(\"storage\") ||\n                event.name === \"visualFilter\" ||\n                event.name === \"collectionName\") {\n                updatePorts$6(node.id, node.parameters, context.editorConnection, graphModel);\n            }\n        });\n        graphModel.on(\"metadataChanged.dbCollections\", function () {\n            CloudStore.invalidateCollections();\n            updatePorts$6(node.id, node.parameters, context.editorConnection, graphModel);\n        });\n        graphModel.on(\"metadataChanged.systemCollections\", function () {\n            CloudStore.invalidateCollections();\n            updatePorts$6(node.id, node.parameters, context.editorConnection, graphModel);\n        });\n        graphModel.on(\"metadataChanged.cloudservices\", function () {\n            CloudStore.instance._initCloudServices();\n        });\n    }\n    graphModel.on(\"editorImportComplete\", () => {\n        graphModel.on(\"nodeAdded.DbCollection2\", function (node) {\n            _managePortsForNode(node);\n        });\n        for (const node of graphModel.getNodesWithType(\"DbCollection2\")) {\n            _managePortsForNode(node);\n        }\n    });\n}\nfunction _collectInputs$1(uniqueInputs, query) {\n    if (query === undefined) {\n        return;\n    }\n    if (query.rules !== undefined) {\n        query.rules.forEach((r) => _collectInputs$1(uniqueInputs, r));\n    }\n    else if (query.input !== undefined) {\n        uniqueInputs[query.input] = true;\n    }\n}\n// Find all records that have a relation with this type\nfunction _findRelations(parameters, schema, c) {\n    if (c.schema !== undefined && c.schema.properties !== undefined) {\n        for (const key in c.schema.properties) {\n            const p = c.schema.properties[key];\n            if (p.type === \"Relation\" &&\n                p.targetClass === parameters.collectionName) {\n                if (schema.relations === undefined)\n                    schema.relations = {};\n                if (schema.relations[c.name] === undefined)\n                    schema.relations[c.name] = [];\n                schema.relations[c.name].push({ property: key });\n            }\n        }\n    }\n}\n\nvar dbcollectionnode2 = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$s,\n    setup: setup$7\n});\n\nconst node$r = {\n    name: \"DbModel2\",\n    docs: \"https://docs.noodl.net/nodes/data/cloud-data/record\",\n    displayNodeName: \"Record\",\n    shortDesc: \"Database model\",\n    category: \"Cloud Services\",\n    usePortAsLabel: \"collectionName\",\n    color: \"data\",\n    dynamicports: [\n        {\n            name: \"conditionalports/extended\",\n            condition: \"idSource = explicit OR idSource NOT SET\",\n            inputs: [\"modelId\"],\n        },\n    ],\n    initialize: function () {\n        const internal = this._internal;\n        internal.inputValues = {};\n        internal.relationModelIds = {};\n        const _this = this;\n        this._internal.onModelChangedCallback = function (args) {\n            if (_this.isInputConnected(\"fetch\"))\n                return;\n            if (_this.hasOutput(\"prop-\" + args.name))\n                _this.flagOutputDirty(\"prop-\" + args.name);\n            if (_this.hasOutput(\"changed-\" + args.name))\n                _this.sendSignalOnOutput(\"changed-\" + args.name);\n            _this.sendSignalOnOutput(\"changed\");\n        };\n    },\n    getInspectInfo() {\n        const model = this._internal.model;\n        if (!model)\n            return \"[No Record]\";\n        return [\n            { type: \"text\", value: \"Id: \" + model.getId() },\n            { type: \"value\", value: model.data },\n        ];\n    },\n    outputs: {\n        id: {\n            type: \"string\",\n            displayName: \"Id\",\n            group: \"General\",\n            getter: function () {\n                return this._internal.model\n                    ? this._internal.model.getId()\n                    : this._internal.modelId;\n            },\n        },\n        fetched: {\n            type: \"signal\",\n            displayName: \"Fetched\",\n            group: \"Events\",\n        },\n        changed: {\n            type: \"signal\",\n            displayName: \"Changed\",\n            group: \"Events\",\n        },\n        failure: {\n            type: \"signal\",\n            displayName: \"Failure\",\n            group: \"Events\",\n        },\n        error: {\n            type: \"string\",\n            displayName: \"Error\",\n            group: \"Error\",\n            getter: function () {\n                return this._internal.error;\n            },\n        },\n    },\n    inputs: {\n        idSource: {\n            type: {\n                name: \"enum\",\n                enums: [\n                    { label: \"Specify explicitly\", value: \"explicit\" },\n                    { label: \"From repeater\", value: \"foreach\" },\n                ],\n                allowEditOnly: true,\n            },\n            default: \"explicit\",\n            displayName: \"Id Source\",\n            group: \"General\",\n            set(value) {\n                if (value === \"foreach\") {\n                    this.scheduleAfterInputsHaveUpdated(() => {\n                        // Find closest nodescope that have a _forEachModel\n                        let component = this.nodeScope.componentOwner;\n                        while (component !== undefined &&\n                            component._forEachModel === undefined &&\n                            component.parentNodeScope) {\n                            component = component.parentNodeScope.componentOwner;\n                        }\n                        // @ts-expect-error\n                        this.setModel(component !== undefined ? component._forEachModel : undefined);\n                    });\n                }\n            },\n        },\n        modelId: {\n            type: { name: \"string\", allowConnectionsOnly: true },\n            displayName: \"Id\",\n            group: \"General\",\n            set(value) {\n                if (value instanceof Model) {\n                    // Can be passed as model as well\n                    value = value.getId();\n                }\n                else if (typeof value === \"object\") {\n                    // If this is an js object, dereference it\n                    value = Model.create(value).getId();\n                }\n                this._internal.modelId = value; // Wait to fetch data\n                if (this.isInputConnected(\"fetch\") === false) {\n                    // @ts-expect-error\n                    this.setModelID(value);\n                }\n                else {\n                    this.flagOutputDirty(\"id\");\n                }\n            },\n        },\n        fetch: {\n            displayName: \"Fetch\",\n            group: \"Actions\",\n            valueChangedToTrue() {\n                // @ts-expect-error\n                this.scheduleFetch();\n            },\n        },\n    },\n    methods: {\n        setCollectionID(id) {\n            this._internal.collectionId = id;\n        },\n        setModelID(id) {\n            const model = (this.nodeScope.modelScope || Model).get(id);\n            // @ts-expect-error\n            this.setModel(model);\n        },\n        setModel(model) {\n            if (this._internal.model) {\n                // Remove old listener if existing\n                this._internal.model.off(\"change\", \n                // @ts-expect-error\n                this._internal.onModelChangedCallback);\n            }\n            this._internal.model = model;\n            this.flagOutputDirty(\"id\");\n            // @ts-expect-error\n            model.on(\"change\", this._internal.onModelChangedCallback);\n            // We have a new model, mark all outputs as dirty\n            for (const key in model.data) {\n                if (this.hasOutput(\"prop-\" + key)) {\n                    this.flagOutputDirty(\"prop-\" + key);\n                }\n            }\n            this.sendSignalOnOutput(\"fetched\");\n        },\n        _onNodeDeleted() {\n            Node.prototype._onNodeDeleted.call(this);\n            if (this._internal.model)\n                this._internal.model.off(\"change\", \n                // @ts-expect-error\n                this._internal.onModelChangedCallback);\n        },\n        scheduleOnce(type, cb) {\n            const _this = this;\n            const _type = \"hasScheduled\" + type;\n            if (this._internal[_type])\n                return;\n            this._internal[_type] = true;\n            this.scheduleAfterInputsHaveUpdated(function () {\n                _this._internal[_type] = false;\n                cb();\n            });\n        },\n        setError(err) {\n            this._internal.error = err;\n            this.flagOutputDirty(\"error\");\n            this.sendSignalOnOutput(\"failure\");\n            if (this.context.editorConnection) {\n                this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, \"storage-op-warning\", {\n                    message: err,\n                    showGlobally: true,\n                });\n            }\n        },\n        clearWarnings() {\n            if (this.context.editorConnection) {\n                this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, \"storage-op-warning\");\n            }\n        },\n        scheduleFetch() {\n            const _this = this;\n            const internal = this._internal;\n            // @ts-expect-error\n            this.scheduleOnce(\"Fetch\", function () {\n                // Don't do fetch if no id\n                if (internal.modelId === undefined || internal.modelId === \"\") {\n                    // @ts-expect-error\n                    _this.setError(\"Missing Id.\");\n                    return;\n                }\n                // @ts-expect-error\n                const cloudstore = CloudStore.forScope(_this.nodeScope.modelScope);\n                cloudstore.fetch({\n                    // @ts-expect-error\n                    collection: internal.collectionId,\n                    objectId: internal.modelId, // Get the objectId part of the model id\n                    success: function (response) {\n                        // @ts-expect-error\n                        const model = cloudstore._fromJSON(response, internal.collectionId);\n                        if (internal.model !== model) {\n                            // Check if we need to change model\n                            if (internal.model) {\n                                // Remove old listener if existing\n                                // @ts-expect-error\n                                internal.model.off(\"change\", internal.onModelChangedCallback);\n                            }\n                            internal.model = model;\n                            model.on(\"change\", internal.onModelChangedCallback);\n                        }\n                        _this.flagOutputDirty(\"id\");\n                        delete response.objectId;\n                        for (const key in response) {\n                            if (_this.hasOutput(\"prop-\" + key)) {\n                                _this.flagOutputDirty(\"prop-\" + key);\n                            }\n                        }\n                        _this.sendSignalOnOutput(\"fetched\");\n                    },\n                    error: function (err) {\n                        // @ts-expect-error\n                        _this.setError(err || \"Failed to fetch.\");\n                    },\n                });\n            });\n        },\n        scheduleStore: function () {\n            const internal = this._internal;\n            if (!internal.model)\n                return;\n            // @ts-expect-error\n            this.scheduleOnce(\"Store\", function () {\n                for (const i in internal.inputValues) {\n                    // @ts-expect-error\n                    internal.model.set(i, internal.inputValues[i], { resolve: true });\n                }\n            });\n        },\n        registerOutputIfNeeded: function (name) {\n            if (this.hasOutput(name)) {\n                return;\n            }\n            if (name.startsWith(\"prop-\"))\n                this.registerOutput(name, {\n                    getter: userOutputGetter$1.bind(this, name.substring(\"prop-\".length)),\n                });\n        },\n        registerInputIfNeeded: function (name) {\n            if (this.hasInput(name)) {\n                return;\n            }\n            const dynamicSignals = {};\n            if (dynamicSignals[name])\n                return this.registerInput(name, {\n                    set: createSetter({\n                        valueChangedToTrue: dynamicSignals[name],\n                    }),\n                });\n            const dynamicSetters = {\n                // @ts-expect-error\n                collectionName: this.setCollectionID.bind(this),\n            };\n            if (dynamicSetters[name])\n                return this.registerInput(name, {\n                    set: dynamicSetters[name],\n                });\n            if (name.startsWith(\"prop-\"))\n                this.registerInput(name, {\n                    set: userInputSetter$1.bind(this, name.substring(\"prop-\".length)),\n                });\n        },\n    },\n};\nfunction userOutputGetter$1(name) {\n    // @ts-expect-error\n    return this._internal.model\n        ? // @ts-expect-error\n            this._internal.model.get(name, { resolve: true })\n        : undefined;\n}\nfunction userInputSetter$1(name, value) {\n    // @ts-expect-error\n    this._internal.inputValues[name] = value;\n}\nfunction updatePorts$5(nodeId, parameters, editorConnection, graphModel) {\n    const ports = [];\n    const dbCollections = graphModel.getMetaData(\"dbCollections\");\n    const systemCollections = graphModel.getMetaData(\"systemCollections\");\n    const _systemClasses = [\n        { label: \"User\", value: \"_User\" },\n        { label: \"Role\", value: \"_Role\" },\n    ];\n    ports.push({\n        name: \"collectionName\",\n        displayName: \"Class\",\n        group: \"General\",\n        type: {\n            name: \"enum\",\n            enums: _systemClasses.concat(dbCollections !== undefined\n                ? dbCollections.map((c) => {\n                    return { value: c.name, label: c.name };\n                })\n                : []),\n            allowEditOnly: true,\n        },\n        plug: \"input\",\n    });\n    if (parameters.collectionName && dbCollections) {\n        // Fetch ports from collection keys\n        let c = dbCollections.find((c) => c.name === parameters.collectionName);\n        if (c === undefined && systemCollections)\n            c = systemCollections.find((c) => c.name === parameters.collectionName);\n        if (c && c.schema && c.schema.properties) {\n            const props = c.schema.properties;\n            for (const key in props) {\n                const p = props[key];\n                if (ports.find((_p) => _p.name === key))\n                    continue;\n                if (p.type !== \"Relation\") {\n                    // Other schema type ports\n                    const _typeMap = {\n                        String: \"string\",\n                        Boolean: \"boolean\",\n                        Number: \"number\",\n                        Date: \"date\",\n                    };\n                    ports.push({\n                        type: {\n                            name: _typeMap[p.type] ? _typeMap[p.type] : \"*\",\n                        },\n                        plug: \"output\",\n                        group: \"Properties\",\n                        name: \"prop-\" + key,\n                        displayName: key,\n                    });\n                    ports.push({\n                        type: \"signal\",\n                        plug: \"output\",\n                        group: \"Changed Events\",\n                        displayName: key + \" Changed\",\n                        name: \"changed-\" + key,\n                    });\n                }\n            }\n        }\n    }\n    editorConnection.sendDynamicPorts(nodeId, ports);\n}\nfunction setup$6(context, graphModel) {\n    if (!context.editorConnection ||\n        !context.editorConnection.isRunningLocally()) {\n        return;\n    }\n    function _managePortsForNode(node) {\n        updatePorts$5(node.id, node.parameters, context.editorConnection, graphModel);\n        node.on(\"parameterUpdated\", function () {\n            updatePorts$5(node.id, node.parameters, context.editorConnection, graphModel);\n        });\n        graphModel.on(\"metadataChanged.dbCollections\", function () {\n            CloudStore.invalidateCollections();\n            updatePorts$5(node.id, node.parameters, context.editorConnection, graphModel);\n        });\n        graphModel.on(\"metadataChanged.systemCollections\", function () {\n            CloudStore.invalidateCollections();\n            updatePorts$5(node.id, node.parameters, context.editorConnection, graphModel);\n        });\n    }\n    graphModel.on(\"editorImportComplete\", () => {\n        graphModel.on(\"nodeAdded.DbModel2\", function (node) {\n            _managePortsForNode(node);\n        });\n        for (const node of graphModel.getNodesWithType(\"DbModel2\")) {\n            _managePortsForNode(node);\n        }\n    });\n}\n\nvar dbmodelnode2 = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$r,\n    setup: setup$6\n});\n\nfunction _addBaseInfo$1(def, opts) {\n    const _includeInputProperties = opts === undefined || opts.includeInputProperties;\n    const _includeRelations = opts !== undefined && opts.includeRelations;\n    Object.assign(def.node, {\n        category: \"Data\",\n        color: \"data\",\n        inputs: def.node.inputs || {},\n        outputs: def.node.outputs || {},\n        methods: def.node.methods || {},\n    });\n    // Outputs\n    // @ts-expect-error\n    Object.assign(def.node.outputs, {\n        failure: {\n            type: \"signal\",\n            displayName: \"Failure\",\n            group: \"Events\",\n        },\n        error: {\n            type: \"string\",\n            displayName: \"Error\",\n            group: \"Error\",\n            getter: function () {\n                // @ts-expect-error\n                return this._internal.error;\n            },\n        },\n    });\n    // Methods\n    // @ts-expect-error\n    Object.assign(def.node.methods, {\n        scheduleOnce: function (type, cb) {\n            const _this = this;\n            const _type = \"hasScheduled\" + type;\n            // @ts-expect-error\n            if (this._internal[_type])\n                return;\n            // @ts-expect-error\n            this._internal[_type] = true;\n            // @ts-expect-error\n            this.scheduleAfterInputsHaveUpdated(function () {\n                // @ts-expect-error\n                _this._internal[_type] = false;\n                cb();\n            });\n        },\n        checkWarningsBeforeCloudOp() {\n            //clear all errors first\n            // @ts-expect-error\n            this.clearWarnings();\n            // @ts-expect-error\n            if (!this._internal.collectionId) {\n                // @ts-expect-error\n                this.setError(\"No class name specified\");\n                return false;\n            }\n            return true;\n        },\n        setError: function (err) {\n            // @ts-expect-error\n            this._internal.error = err;\n            // @ts-expect-error\n            this.flagOutputDirty(\"error\");\n            // @ts-expect-error\n            this.sendSignalOnOutput(\"failure\");\n            // @ts-expect-error\n            if (this.context.editorConnection) {\n                // @ts-expect-error\n                this.context.editorConnection.sendWarning(\n                // @ts-expect-error\n                this.nodeScope.componentOwner.name, \n                // @ts-expect-error\n                this.id, \"storage-op-warning\", {\n                    message: err,\n                    showGlobally: true,\n                });\n            }\n        },\n        clearWarnings() {\n            // @ts-expect-error\n            if (this.context.editorConnection) {\n                // @ts-expect-error\n                this.context.editorConnection.clearWarning(\n                // @ts-expect-error\n                this.nodeScope.componentOwner.name, \n                // @ts-expect-error\n                this.id, \"storage-op-warning\");\n            }\n        },\n    });\n    // Setup\n    Object.assign(def, {\n        setup: function (context, graphModel) {\n            if (!context.editorConnection ||\n                !context.editorConnection.isRunningLocally()) {\n                return;\n            }\n            function _managePortsForNode(node) {\n                function _updatePorts() {\n                    var _a;\n                    const ports = [];\n                    const dbCollections = graphModel.getMetaData(\"dbCollections\");\n                    const systemCollections = graphModel.getMetaData(\"systemCollections\");\n                    const _systemClasses = [\n                        { label: \"User\", value: \"_User\" },\n                        { label: \"Role\", value: \"_Role\" },\n                    ];\n                    const parameters = node.parameters;\n                    ports.push({\n                        name: \"collectionName\",\n                        displayName: \"Class\",\n                        group: \"General\",\n                        type: {\n                            name: \"enum\",\n                            enums: _systemClasses.concat(dbCollections !== undefined\n                                ? dbCollections.map((c) => {\n                                    return { value: c.name, label: c.name };\n                                })\n                                : []),\n                            allowEditOnly: true,\n                        },\n                        plug: \"input\",\n                    });\n                    if (_includeRelations && parameters.collectionName && dbCollections) {\n                        // Fetch ports from collection keys\n                        let c = dbCollections.find((c) => c.name === parameters.collectionName);\n                        if (c === undefined && systemCollections)\n                            c = systemCollections.find((c) => c.name === parameters.collectionName);\n                        if (c && c.schema && c.schema.properties) {\n                            const props = c.schema.properties;\n                            const enums = Object.keys(props)\n                                .filter((key) => props[key].type === \"Relation\")\n                                .map((key) => ({ label: key, value: key }));\n                            ports.push({\n                                name: \"relationProperty\",\n                                displayName: \"Relation\",\n                                group: \"General\",\n                                type: { name: \"enum\", enums: enums, allowEditOnly: true },\n                                plug: \"input\",\n                            });\n                        }\n                    }\n                    if (_includeInputProperties &&\n                        parameters.collectionName &&\n                        dbCollections) {\n                        const _typeMap = {\n                            String: \"string\",\n                            Boolean: \"boolean\",\n                            Number: \"number\",\n                            Date: \"date\",\n                        };\n                        // Fetch ports from collection keys\n                        let c = dbCollections.find((c) => c.name === parameters.collectionName);\n                        if (c === undefined && systemCollections)\n                            c = systemCollections.find((c) => c.name === parameters.collectionName);\n                        if (c && c.schema && c.schema.properties) {\n                            const props = c.schema.properties;\n                            for (const key in props) {\n                                const p = props[key];\n                                if (ports.find((_p) => _p.name === key))\n                                    continue;\n                                ports.push({\n                                    type: {\n                                        name: _typeMap[p.type] ? _typeMap[p.type] : \"*\",\n                                    },\n                                    plug: \"input\",\n                                    group: \"Properties\",\n                                    name: \"prop-\" + key,\n                                    displayName: key,\n                                });\n                            }\n                        }\n                    }\n                    // @ts-expect-error\n                    (_a = def._additionalDynamicPorts) === null || _a === void 0 ? void 0 : _a.call(def, node, ports, graphModel);\n                    context.editorConnection.sendDynamicPorts(node.id, ports);\n                }\n                _updatePorts();\n                node.on(\"parameterUpdated\", function () {\n                    _updatePorts();\n                });\n                graphModel.on(\"metadataChanged.dbCollections\", function () {\n                    CloudStore.invalidateCollections();\n                    _updatePorts();\n                });\n                graphModel.on(\"metadataChanged.systemCollections\", function () {\n                    CloudStore.invalidateCollections();\n                    _updatePorts();\n                });\n            }\n            graphModel.on(\"editorImportComplete\", () => {\n                graphModel.on(\"nodeAdded.\" + def.node.name, function (node) {\n                    _managePortsForNode(node);\n                });\n                for (const node of graphModel.getNodesWithType(def.node.name)) {\n                    _managePortsForNode(node);\n                }\n            });\n        },\n    });\n}\nfunction _addModelId$1(def, opts) {\n    const _methods = Object.assign({}, def.node.methods);\n    const _includeInputs = opts === undefined || opts.includeInputs;\n    const _includeOutputs = opts === undefined || opts.includeOutputs;\n    Object.assign(def.node, {\n        inputs: def.node.inputs || {},\n        outputs: def.node.outputs || {},\n        methods: def.node.methods || {},\n    });\n    if (_includeInputs) {\n        Object.assign(def.node, {\n            usePortAsLabel: \"collectionName\",\n        });\n        def.node.dynamicports = (def.node.dynamicports || []).concat([\n            {\n                name: \"conditionalports/extended\",\n                condition: \"idSource = explicit OR idSource NOT SET\",\n                inputs: [\"modelId\"],\n            },\n        ]);\n        // Inputs\n        // @ts-expect-error\n        Object.assign(def.node.inputs, {\n            idSource: {\n                type: {\n                    name: \"enum\",\n                    enums: [\n                        { label: \"Specify explicitly\", value: \"explicit\" },\n                        { label: \"From repeater\", value: \"foreach\" },\n                    ],\n                    allowEditOnly: true,\n                },\n                default: \"explicit\",\n                displayName: \"Id Source\",\n                group: \"General\",\n                tooltip: \"Choose if you want to specify the Id explicitly, \\n or if you want it to be that of the current record in a repeater.\",\n                set: function (value) {\n                    if (value === \"foreach\") {\n                        // @ts-expect-error\n                        this.scheduleAfterInputsHaveUpdated(() => {\n                            // Find closest nodescope that have a _forEachModel\n                            // @ts-expect-error\n                            let component = this.nodeScope.componentOwner;\n                            while (component !== undefined &&\n                                component._forEachModel === undefined &&\n                                component.parentNodeScope) {\n                                component = component.parentNodeScope.componentOwner;\n                            }\n                            // @ts-expect-error\n                            this.setModel(component !== undefined ? component._forEachModel : undefined);\n                        });\n                    }\n                },\n            },\n            modelId: {\n                type: {\n                    name: \"string\",\n                    identifierOf: \"ModelName\",\n                    identifierDisplayName: \"Object Ids\",\n                },\n                displayName: \"Id\",\n                group: \"General\",\n                set: function (value) {\n                    if (value instanceof Model)\n                        value = value.getId(); // Can be passed as model as well\n                    // @ts-expect-error\n                    this._internal.modelId = value; // Wait to fetch data\n                    // @ts-expect-error\n                    this.setModelID(value);\n                },\n            },\n        });\n    }\n    // Outputs\n    if (_includeOutputs) {\n        // @ts-expect-error\n        Object.assign(def.node.outputs, {\n            id: {\n                type: \"string\",\n                displayName: \"Id\",\n                group: \"General\",\n                getter: function () {\n                    // @ts-expect-error\n                    return this._internal.model\n                        ? // @ts-expect-error\n                            this._internal.model.getId()\n                        : // @ts-expect-error\n                            this._internal.modelId;\n                },\n            },\n        });\n    }\n    // Methods\n    // @ts-expect-error\n    Object.assign(def.node.methods, {\n        setCollectionID: function (id) {\n            // @ts-expect-error\n            this._internal.collectionId = id;\n            // @ts-expect-error\n            this.clearWarnings();\n        },\n        setModelID: function (id) {\n            // @ts-expect-error\n            const model = (this.nodeScope.modelScope || Model).get(id);\n            // @ts-expect-error\n            this.setModel(model);\n        },\n        setModel: function (model) {\n            // @ts-expect-error\n            this._internal.model = model;\n            // @ts-expect-error\n            this.flagOutputDirty(\"id\");\n        },\n        registerInputIfNeeded: function (name) {\n            // @ts-expect-error\n            if (this.hasInput(name)) {\n                return;\n            }\n            if (name === \"collectionName\")\n                // @ts-expect-error\n                this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this.setCollectionID.bind(this),\n                });\n            _methods &&\n                _methods.registerInputIfNeeded &&\n                // @ts-expect-error\n                _methods.registerInputIfNeeded.call(this, name);\n        },\n    });\n}\nfunction _addInputProperties$1(def) {\n    const _def = { node: Object.assign({}, def.node), setup: def.setup };\n    const _methods = Object.assign({}, def.node.methods);\n    Object.assign(def.node, {\n        inputs: def.node.inputs || {},\n        outputs: def.node.outputs || {},\n        methods: def.node.methods || {},\n    });\n    Object.assign(def.node, {\n        initialize: function () {\n            // @ts-expect-error\n            const internal = this._internal;\n            internal.inputValues = {};\n            // @ts-expect-error\n            _def.node.initialize && _def.node.initialize.call(this);\n        },\n    });\n    // Outputs\n    // @ts-expect-error\n    Object.assign(def.node.outputs, {});\n    // Inputs\n    // @ts-expect-error\n    Object.assign(def.node.inputs, {});\n    // Methods\n    // @ts-expect-error\n    Object.assign(def.node.methods, {\n        registerInputIfNeeded: function (name) {\n            // @ts-expect-error\n            if (this.hasInput(name)) {\n                return;\n            }\n            if (name.startsWith(\"prop-\"))\n                // @ts-expect-error\n                this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this._setInputValue.bind(this, name.substring(\"prop-\".length)),\n                });\n            _methods &&\n                _methods.registerInputIfNeeded &&\n                // @ts-expect-error\n                _methods.registerInputIfNeeded.call(this, name);\n        },\n        _setInputValue: function (name, value) {\n            // @ts-expect-error\n            this._internal.inputValues[name] = value;\n        },\n    });\n}\nfunction _addRelationProperty(def) {\n    const _methods = Object.assign({}, def.node.methods);\n    Object.assign(def.node, {\n        inputs: def.node.inputs || {},\n        outputs: def.node.outputs || {},\n        methods: def.node.methods || {},\n    });\n    // Inputs\n    // @ts-expect-error\n    Object.assign(def.node.inputs, {\n        targetId: {\n            type: { name: \"string\", allowConnectionsOnly: true },\n            displayName: \"Target Record Id\",\n            group: \"General\",\n            set: function (value) {\n                // @ts-expect-error\n                this._internal.targetModelId = value;\n            },\n        },\n    });\n    // Methods\n    // @ts-expect-error\n    Object.assign(def.node.methods, {\n        registerInputIfNeeded: function (name) {\n            // @ts-expect-error\n            if (this.hasInput(name)) {\n                return;\n            }\n            if (name === \"relationProperty\")\n                // @ts-expect-error\n                this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this.setRelationProperty.bind(this),\n                });\n            _methods &&\n                _methods.registerInputIfNeeded &&\n                // @ts-expect-error\n                _methods.registerInputIfNeeded.call(this, name);\n        },\n        setRelationProperty: function (value) {\n            // @ts-expect-error\n            this._internal.relationProperty = value;\n        },\n    });\n}\nfunction _getCurrentUser(modelScope) {\n    // @ts-expect-error _noodl_cloud_runtime_version\n    if (typeof _noodl_cloud_runtime_version === \"undefined\") {\n        // We are running in browser, try to find the current user\n        const _cu = localStorage[\"Parse/\" + CloudStore.instance.appId + \"/currentUser\"];\n        if (_cu !== undefined) {\n            let cu;\n            try {\n                cu = JSON.parse(_cu);\n            }\n            catch (e) { }\n            return cu !== undefined ? cu.objectId : undefined;\n        }\n    }\n    else {\n        // Assume we are running in cloud runtime\n        const request = modelScope.get(\"Request\");\n        // @ts-expect-error\n        return request.UserId;\n    }\n}\nfunction _addAccessControl(def) {\n    const _def = { node: Object.assign({}, def.node), setup: def.setup };\n    const _methods = Object.assign({}, def.node.methods);\n    Object.assign(def.node, {\n        inputs: def.node.inputs || {},\n        outputs: def.node.outputs || {},\n        methods: def.node.methods || {},\n    });\n    Object.assign(def.node, {\n        initialize() {\n            // @ts-expect-error\n            const internal = this._internal;\n            internal.accessControl = {};\n            // @ts-expect-error\n            _def.node.initialize && _def.node.initialize.call(this);\n        },\n    });\n    // Inputs\n    // @ts-expect-error\n    Object.assign(def.node.inputs, {\n        accessControl: {\n            type: { name: \"proplist\", autoName: \"Rule\", allowEditOnly: true },\n            index: 1000,\n            displayName: \"Access Control Rules\",\n            group: \"Access Control Rules\",\n            set(value) {\n                // @ts-expect-error\n                this._internal.accessControlRules = value;\n            },\n        },\n    });\n    // Dynamic ports\n    // @ts-expect-error\n    const _super = def._additionalDynamicPorts;\n    // @ts-expect-error\n    def._additionalDynamicPorts = function (node, ports, graphModel) {\n        if (node.parameters[\"accessControl\"] !== undefined &&\n            node.parameters[\"accessControl\"].length > 0) {\n            node.parameters[\"accessControl\"].forEach((ac) => {\n                const prefix = \"acl-\" + ac.id;\n                // User or role?\n                ports.push({\n                    name: prefix + \"-target\",\n                    displayName: \"Target\",\n                    editorName: ac.label + \" | Target\",\n                    plug: \"input\",\n                    type: {\n                        name: \"enum\",\n                        enums: [\n                            { value: \"user\", label: \"User\" },\n                            { value: \"everyone\", label: \"Everyone\" },\n                            { value: \"role\", label: \"Role\" },\n                        ],\n                        allowEditOnly: true,\n                    },\n                    group: ac.label + \" Access Rule\",\n                    default: \"user\",\n                    parent: \"accessControl\",\n                    parentItemId: ac.id,\n                });\n                if (node.parameters[prefix + \"-target\"] === \"role\") {\n                    ports.push({\n                        name: prefix + \"-role\",\n                        displayName: \"Role\",\n                        editorName: ac.label + \" | Role\",\n                        group: ac.label + \" Access Rule\",\n                        plug: \"input\",\n                        type: \"string\",\n                        parent: \"accessControl\",\n                        parentItemId: ac.id,\n                    });\n                }\n                else if (node.parameters[prefix + \"-target\"] === undefined ||\n                    node.parameters[prefix + \"-target\"] === \"user\") {\n                    ports.push({\n                        name: prefix + \"-userid\",\n                        displayName: \"User Id\",\n                        group: ac.label + \" Access Rule\",\n                        editorName: ac.label + \" | User Id\",\n                        plug: \"input\",\n                        type: { name: \"string\", allowConnectionsOnly: true },\n                        parent: \"accessControl\",\n                        parentItemId: ac.id,\n                    });\n                }\n                // Read\n                ports.push({\n                    name: prefix + \"-read\",\n                    displayName: \"Read\",\n                    editorName: ac.label + \" | Read\",\n                    group: ac.label + \" Access Rule\",\n                    plug: \"input\",\n                    type: { name: \"boolean\" },\n                    default: true,\n                    parent: \"accessControl\",\n                    parentItemId: ac.id,\n                });\n                // Write\n                ports.push({\n                    name: prefix + \"-write\",\n                    displayName: \"Write\",\n                    editorName: ac.label + \" | Write\",\n                    group: ac.label + \" Access Rule\",\n                    plug: \"input\",\n                    type: { name: \"boolean\" },\n                    default: true,\n                    parent: \"accessControl\",\n                    parentItemId: ac.id,\n                });\n            });\n        }\n        _super && _super(node, ports, graphModel);\n    };\n    // Methods\n    // @ts-expect-error\n    Object.assign(def.node.methods, {\n        registerInputIfNeeded: function (name) {\n            // @ts-expect-error\n            if (this.hasInput(name)) {\n                return;\n            }\n            if (name.startsWith(\"acl-\"))\n                // @ts-expect-error\n                this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this.setAccessControl.bind(this, name),\n                });\n            _methods &&\n                _methods.registerInputIfNeeded &&\n                // @ts-expect-error\n                _methods.registerInputIfNeeded.call(this, name);\n        },\n        _getACL: function () {\n            let acl = {};\n            function _rule(rule) {\n                return {\n                    read: rule.read === undefined ? true : rule.read,\n                    write: rule.write === undefined ? true : rule.write,\n                };\n            }\n            // @ts-expect-error\n            const currentUserId = _getCurrentUser(this.nodeScope.modelScope);\n            // @ts-expect-error\n            if (this._internal.accessControlRules !== undefined) {\n                // @ts-expect-error\n                this._internal.accessControlRules.forEach((r) => {\n                    // @ts-expect-error\n                    const rule = this._internal.accessControl[r.id];\n                    if (rule === undefined) {\n                        const userId = currentUserId;\n                        if (userId !== undefined)\n                            acl[userId] = { write: true, read: true };\n                    }\n                    else if (rule.target === \"everyone\") {\n                        acl[\"*\"] = _rule(rule);\n                    }\n                    else if (rule.target === \"user\") {\n                        const userId = rule.userid || currentUserId;\n                        acl[userId] = _rule(rule);\n                    }\n                    else if (rule.target === \"role\") {\n                        acl[\"role:\" + rule.role] = _rule(rule);\n                    }\n                });\n            }\n            return Object.keys(acl).length > 0 ? acl : undefined;\n        },\n        setAccessControl: function (name, value) {\n            const _parts = name.split(\"-\");\n            // @ts-expect-error\n            if (this._internal.accessControl[_parts[1]] === undefined)\n                // @ts-expect-error\n                this._internal.accessControl[_parts[1]] = {};\n            // @ts-expect-error\n            this._internal.accessControl[_parts[1]][_parts[2]] = value;\n        },\n    });\n}\n\nconst SetDbModelPropertiedNodeDefinition = {\n    node: {\n        name: \"SetDbModelProperties\",\n        category: \"\",\n        docs: \"https://docs.noodl.net/nodes/data/cloud-data/set-record-properties\",\n        displayNodeName: \"Set Record Properties\",\n        usePortAsLabel: \"collectionName\",\n        dynamicports: [\n            {\n                name: \"conditionalports/extended\",\n                condition: \"storeType = cloud OR storeType NOT SET\",\n                inputs: [\"storeProperties\"],\n            },\n        ],\n        inputs: {\n            store: {\n                displayName: \"Do\",\n                group: \"Actions\",\n                valueChangedToTrue() {\n                    if (this._internal.storeType === undefined ||\n                        this._internal.storeType === \"cloud\") {\n                        // @ts-expect-error\n                        this.scheduleSave();\n                    }\n                    else {\n                        // @ts-expect-error\n                        this.scheduleStore();\n                    }\n                },\n            },\n            storeProperties: {\n                displayName: \"Properties to  store\",\n                group: \"General\",\n                type: {\n                    name: \"enum\",\n                    enums: [\n                        { label: \"Only specified\", value: \"specified\" },\n                        { label: \"All\", value: \"all\" },\n                    ],\n                },\n                default: \"specified\",\n                set: function (value) {\n                    this._internal.storeProperties = value;\n                },\n            },\n            storeType: {\n                displayName: \"Store to\",\n                group: \"General\",\n                type: {\n                    name: \"enum\",\n                    enums: [\n                        { label: \"Cloud and local\", value: \"cloud\" },\n                        { label: \"Local only\", value: \"local\" },\n                    ],\n                },\n                default: \"cloud\",\n                set: function (value) {\n                    this._internal.storeType = value;\n                },\n            },\n        },\n        outputs: {\n            stored: {\n                type: \"signal\",\n                displayName: \"Success\",\n                group: \"Events\",\n            },\n        },\n        methods: {\n            scheduleSave() {\n                const _this = this;\n                const internal = this._internal;\n                // @ts-expect-error\n                if (!this.checkWarningsBeforeCloudOp())\n                    return;\n                // @ts-expect-error\n                this.scheduleOnce(\"StorageSave\", function () {\n                    if (!internal.model) {\n                        // @ts-expect-error\n                        _this.setError(\"Missing Record Id\");\n                        return;\n                    }\n                    const model = internal.model;\n                    for (const key in internal.inputValues) {\n                        model.set(key, internal.inputValues[key], { resolve: true });\n                    }\n                    // @ts-expect-error\n                    CloudStore.forScope(_this.nodeScope.modelScope).save({\n                        // @ts-expect-error\n                        collection: internal.collectionId,\n                        objectId: model.getId(), // Get the objectId part of the model id\n                        data: internal.storeProperties === \"all\"\n                            ? model.data\n                            : internal.inputValues, // Only store input values by default, if not explicitly specified\n                        // @ts-expect-error\n                        acl: _this._getACL(),\n                        success: function (response) {\n                            for (const key in response) {\n                                model.set(key, response[key]);\n                            }\n                            _this.sendSignalOnOutput(\"stored\");\n                        },\n                        error: function (err) {\n                            // @ts-expect-error\n                            _this.setError(err || \"Failed to save.\");\n                        },\n                    });\n                });\n            },\n            scheduleStore() {\n                // @ts-expect-error\n                if (this.hasScheduledStore)\n                    return;\n                // @ts-expect-error\n                this.hasScheduledStore = true;\n                const internal = this._internal;\n                this.scheduleAfterInputsHaveUpdated(() => {\n                    // @ts-expect-error\n                    this.hasScheduledStore = false;\n                    if (!internal.model)\n                        return;\n                    for (const i in internal.inputValues) {\n                        internal.model.set(i, internal.inputValues[i], { resolve: true });\n                    }\n                    this.sendSignalOnOutput(\"stored\");\n                });\n            },\n        },\n    },\n};\n_addBaseInfo$1(SetDbModelPropertiedNodeDefinition);\n_addModelId$1(SetDbModelPropertiedNodeDefinition);\n_addInputProperties$1(SetDbModelPropertiedNodeDefinition);\n_addAccessControl(SetDbModelPropertiedNodeDefinition);\nconst node$q = SetDbModelPropertiedNodeDefinition.node;\n\nvar setdbmodelpropertiesnode = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$q\n});\n\nconst DeleteDbModelPropertiedNodeDefinition = {\n    node: {\n        name: \"DeleteDbModelProperties\",\n        category: \"\",\n        docs: \"https://docs.noodl.net/nodes/data/cloud-data/delete-record\",\n        displayNodeName: \"Delete Record\",\n        shortDesc: \"Stores any amount of properties and can be used standalone or together with Collections and For Each nodes.\",\n        inputs: {\n            store: {\n                displayName: \"Do\",\n                group: \"Actions\",\n                valueChangedToTrue() {\n                    // @ts-expect-error\n                    this.storageDelete();\n                },\n            },\n        },\n        outputs: {\n            deleted: {\n                type: \"signal\",\n                displayName: \"Success\",\n                group: \"Events\",\n            },\n        },\n        methods: {\n            storageDelete() {\n                const internal = this._internal;\n                // @ts-expect-error\n                if (!this.checkWarningsBeforeCloudOp())\n                    return;\n                // @ts-expect-error\n                this.scheduleOnce(\"StorageDelete\", () => {\n                    if (!internal.model) {\n                        // @ts-expect-error\n                        this.setError(\"Missing Record Id\");\n                        return;\n                    }\n                    // @ts-expect-error\n                    CloudStore.forScope(this.nodeScope.ModelScope).delete({\n                        // @ts-expect-error\n                        collection: internal.collectionId,\n                        objectId: internal.model.getId(), // Get the objectId part of the model id,\n                        success: () => {\n                            // @ts-expect-error\n                            internal.model.notify(\"delete\"); // Notify that this model has been deleted\n                            this.sendSignalOnOutput(\"deleted\");\n                        },\n                        error: (err) => {\n                            // @ts-expect-error\n                            this.setError(err || \"Failed to delete.\");\n                        },\n                    });\n                });\n            },\n        },\n    },\n};\n_addBaseInfo$1(DeleteDbModelPropertiedNodeDefinition, {\n    includeInputProperties: false,\n});\n_addModelId$1(DeleteDbModelPropertiedNodeDefinition);\nconst node$p = DeleteDbModelPropertiedNodeDefinition.node;\n\nvar deletedbmodelpropertiesnode = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$p\n});\n\nconst NewDbModelPropertiedNodeDefinition = {\n    node: {\n        name: \"NewDbModelProperties\",\n        category: \"\",\n        docs: \"https://docs.noodl.net/nodes/data/cloud-data/create-new-record\",\n        displayName: \"Create New Record\",\n        usePortAsLabel: \"collectionName\",\n        inputs: {\n            store: {\n                displayName: \"Do\",\n                group: \"Actions\",\n                valueChangedToTrue() {\n                    // @ts-expect-error\n                    this.storageInsert();\n                },\n            },\n            sourceObjectId: {\n                type: { name: \"string\", allowConnectionsOnly: true },\n                displayName: \"Source Object Id\",\n                group: \"General\",\n                set(value) {\n                    if (value instanceof Model)\n                        value = value.getId(); // Can be passed as model as well\n                    this._internal.sourceObjectId = value; // Wait to fetch data\n                },\n            },\n        },\n        outputs: {\n            created: {\n                type: \"signal\",\n                displayName: \"Success\",\n                group: \"Events\",\n            },\n        },\n        methods: {\n            storageInsert() {\n                const internal = this._internal;\n                // @ts-expect-error\n                if (!this.checkWarningsBeforeCloudOp())\n                    return;\n                // @ts-expect-error\n                this.scheduleOnce(\"StorageInsert\", () => {\n                    const initValues = Object.assign({}, internal.sourceObjectId\n                        ? (this.nodeScope.modelScope || Model).get(internal.sourceObjectId).data\n                        : {}, internal.inputValues);\n                    const cloudstore = CloudStore.forScope(this.nodeScope.modelScope);\n                    cloudstore.create({\n                        // @ts-expect-error\n                        collection: internal.collectionId,\n                        data: initValues,\n                        // @ts-expect-error\n                        acl: this._getACL(),\n                        success: (data) => {\n                            // Successfully created\n                            // @ts-expect-error\n                            const m = cloudstore._fromJSON(data, internal.collectionId);\n                            // @ts-expect-error\n                            this.setModel(m);\n                            this.sendSignalOnOutput(\"created\");\n                        },\n                        error: (err) => {\n                            // @ts-expect-error\n                            this.setError(err || \"Failed to insert.\");\n                        },\n                    });\n                });\n            },\n        },\n    },\n};\n_addBaseInfo$1(NewDbModelPropertiedNodeDefinition);\n_addModelId$1(NewDbModelPropertiedNodeDefinition, {\n    includeOutputs: true,\n});\n_addInputProperties$1(NewDbModelPropertiedNodeDefinition);\n_addAccessControl(NewDbModelPropertiedNodeDefinition);\nconst node$o = NewDbModelPropertiedNodeDefinition.node;\n\nvar newdbmodelpropertiesnode = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$o\n});\n\nconst AddDbModelRelationNodeDefinition$1 = {\n    node: {\n        name: \"AddDbModelRelation\",\n        category: \"Data\",\n        docs: \"https://docs.noodl.net/nodes/data/cloud-data/add-record-relation\",\n        displayNodeName: \"Add Record Relation\",\n        usePortAsLabel: \"collectionName\",\n        inputs: {\n            store: {\n                displayName: \"Do\",\n                group: \"Actions\",\n                valueChangedToTrue() {\n                    // @ts-expect-error\n                    this.scheduleAddRelation();\n                },\n            },\n        },\n        outputs: {\n            relationAdded: {\n                type: \"signal\",\n                displayName: \"Success\",\n                group: \"Events\",\n            },\n        },\n        methods: {\n            validateInputs() {\n                if (!this.context.editorConnection)\n                    return;\n                const _warning = (message) => {\n                    this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, \"add-relation\", {\n                        message,\n                    });\n                };\n                if (this._internal.collectionId === undefined) {\n                    _warning(\"No class specified\");\n                }\n                else if (this._internal.relationProperty === undefined) {\n                    _warning(\"No relation property specified\");\n                }\n                else if (this._internal.targetModelId === undefined) {\n                    _warning(\"No target record Id (the record to add a relation to) specified\");\n                }\n                else if (this._internal.model === undefined) {\n                    _warning(\"No record Id specified (the record that should get the relation)\");\n                }\n                else {\n                    this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, \"add-relation\");\n                }\n            },\n            scheduleAddRelation() {\n                const _this = this;\n                const internal = this._internal;\n                // @ts-expect-error\n                this.scheduleOnce(\"StorageAddRelation\", function () {\n                    // @ts-expect-error\n                    _this.validateInputs();\n                    if (!internal.model)\n                        return;\n                    const model = internal.model;\n                    const targetModelId = internal.targetModelId;\n                    if (targetModelId === undefined)\n                        return;\n                    // @ts-expect-error\n                    CloudStore.forScope(_this.nodeScope.modelScope).addRelation({\n                        collection: internal.collectionId,\n                        objectId: model.getId(),\n                        key: internal.relationProperty,\n                        targetObjectId: targetModelId,\n                        // @ts-expect-error\n                        targetClass: (_this.nodeScope.modelScope || Model).get(targetModelId)._class,\n                        success: function (response) {\n                            for (const key in response) {\n                                model.set(key, response[key]);\n                            }\n                            // Successfully added relation\n                            _this.sendSignalOnOutput(\"relationAdded\");\n                        },\n                        error: function (err) {\n                            // @ts-expect-error\n                            _this.setError(err || \"Failed to add relation.\");\n                        },\n                    });\n                });\n            },\n        },\n    },\n};\n_addBaseInfo$1(AddDbModelRelationNodeDefinition$1, {\n    includeRelations: true,\n});\n_addModelId$1(AddDbModelRelationNodeDefinition$1);\n_addRelationProperty(AddDbModelRelationNodeDefinition$1);\nconst node$n = AddDbModelRelationNodeDefinition$1.node;\n\nvar dbmodelnodeAddrelation = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$n\n});\n\nconst AddDbModelRelationNodeDefinition = {\n    node: {\n        name: \"RemoveDbModelRelation\",\n        category: \"\",\n        docs: \"https://docs.noodl.net/nodes/data/cloud-data/remove-record-relation\",\n        displayName: \"Remove Record Relation\",\n        usePortAsLabel: \"collectionName\",\n        inputs: {\n            store: {\n                displayName: \"Do\",\n                group: \"Actions\",\n                valueChangedToTrue() {\n                    // @ts-expect-error\n                    this.scheduleRemoveRelation();\n                },\n            },\n        },\n        outputs: {\n            relationRemoved: {\n                type: \"signal\",\n                displayName: \"Success\",\n                group: \"Events\",\n            },\n        },\n        methods: {\n            validateInputs() {\n                if (!this.context.editorConnection)\n                    return;\n                const _warning = (message) => {\n                    this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, \"add-relation\", {\n                        message,\n                    });\n                };\n                if (this._internal.collectionId === undefined) {\n                    _warning(\"No class specified\");\n                }\n                else if (this._internal.relationProperty === undefined) {\n                    _warning(\"No relation property specified\");\n                }\n                else if (this._internal.targetModelId === undefined) {\n                    _warning(\"No target record Id (the record to add a relation to) specified\");\n                }\n                else if (this._internal.model === undefined) {\n                    _warning(\"No record Id specified (the record that should get the relation)\");\n                }\n                else {\n                    this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, \"add-relation\");\n                }\n            },\n            scheduleRemoveRelation() {\n                const _this = this;\n                const internal = this._internal;\n                // @ts-expect-error\n                this.scheduleOnce(\"StorageRemoveRelation\", function () {\n                    // @ts-expect-error\n                    _this.validateInputs();\n                    if (!internal.model)\n                        return;\n                    const model = internal.model;\n                    const targetModelId = internal.targetModelId;\n                    if (targetModelId === undefined)\n                        return;\n                    // @ts-expect-error\n                    CloudStore.forScope(_this.nodeScope.modelScope).removeRelation({\n                        // @ts-expect-error\n                        collection: internal.collectionId,\n                        objectId: model.getId(),\n                        key: internal.relationProperty,\n                        targetObjectId: targetModelId,\n                        // @ts-expect-error\n                        targetClass: (_this.nodeScope.modelScope || Model).get(targetModelId)._class,\n                        success: function (response) {\n                            for (const _key in response) {\n                                model.set(_key, response[_key]);\n                            }\n                            // Successfully removed relation\n                            _this.sendSignalOnOutput(\"relationRemoved\");\n                        },\n                        error: function (err) {\n                            // @ts-expect-error\n                            _this.setError(err || \"Failed to remove relation.\");\n                        },\n                    });\n                });\n            },\n        },\n    },\n};\n_addBaseInfo$1(AddDbModelRelationNodeDefinition, {\n    includeRelations: true,\n});\n_addModelId$1(AddDbModelRelationNodeDefinition);\n_addRelationProperty(AddDbModelRelationNodeDefinition);\nconst node$m = AddDbModelRelationNodeDefinition.node;\n\nvar dbmodelnodeRemoverelation = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$m\n});\n\nconst node$l = {\n    name: \"FilterDBModels\",\n    docs: \"https://docs.noodl.net/nodes/data/cloud-data/filter-records\",\n    displayNodeName: \"Filter Records\",\n    shortDesc: \"Filter, sort and limit array\",\n    category: \"Data\",\n    color: \"data\",\n    initialize() {\n        const _this = this;\n        this._internal.collectionChangedCallback = function () {\n            if (_this.isInputConnected(\"filter\") === true)\n                return;\n            // @ts-expect-error\n            _this.scheduleFilter();\n        };\n        this._internal.cloudStoreEvents = function (args) {\n            if (_this.isInputConnected(\"filter\") === true)\n                return;\n            if (_this._internal.visualFilter === undefined)\n                return;\n            if (_this._internal.collection === undefined)\n                return;\n            if (args.collection !== _this._internal.collectionName)\n                return;\n            if (args.objectId !== undefined &&\n                _this._internal.collection.contains(Model.get(args.objectId)))\n                // @ts-expect-error\n                _this.scheduleFilter();\n        };\n        CloudStore.instance.on(\"save\", this._internal.cloudStoreEvents);\n        this._internal.enabled = true;\n        this._internal.filterSettings = {};\n        this._internal.filterParameters = {};\n    },\n    getInspectInfo() {\n        const collection = this._internal.filteredCollection;\n        if (!collection) {\n            return { type: \"text\", value: \"[Not executed yet]\" };\n        }\n        return [\n            {\n                type: \"text\",\n                value: \"Id: \" + collection.getId(),\n            },\n            {\n                type: \"value\",\n                value: collection.items,\n            },\n        ];\n    },\n    inputs: {\n        items: {\n            type: \"array\",\n            displayName: \"Items\",\n            group: \"General\",\n            set(value) {\n                // @ts-expect-error\n                this.bindCollection(value);\n                // @ts-expect-error\n                if (this.isInputConnected(\"filter\") === false)\n                    this.scheduleFilter();\n            },\n        },\n        enabled: {\n            type: \"boolean\",\n            group: \"General\",\n            displayName: \"Enabled\",\n            default: true,\n            set(value) {\n                this._internal.enabled = value;\n                // @ts-expect-error\n                if (this.isInputConnected(\"filter\") === false)\n                    this.scheduleFilter();\n            },\n        },\n        filter: {\n            type: \"signal\",\n            group: \"Actions\",\n            displayName: \"Filter\",\n            valueChangedToTrue() {\n                // @ts-expect-error\n                this.scheduleFilter();\n            },\n        },\n    },\n    outputs: {\n        items: {\n            type: \"array\",\n            displayName: \"Items\",\n            group: \"General\",\n            getter() {\n                return this._internal.filteredCollection;\n            },\n        },\n        firstItemId: {\n            type: \"string\",\n            displayName: \"First Record Id\",\n            group: \"General\",\n            getter() {\n                if (this._internal.filteredCollection !== undefined) {\n                    const firstItem = this._internal.filteredCollection.get(0);\n                    if (firstItem !== undefined)\n                        return firstItem.getId();\n                }\n            },\n        },\n        count: {\n            type: \"number\",\n            displayName: \"Count\",\n            group: \"General\",\n            getter() {\n                return this._internal.filteredCollection\n                    ? this._internal.filteredCollection.size()\n                    : 0;\n            },\n        },\n        modified: {\n            group: \"Events\",\n            type: \"signal\",\n            displayName: \"Filtered\",\n        },\n    },\n    prototypeExtensions: {\n        unbindCurrentCollection() {\n            const collection = this._internal.collection;\n            if (!collection)\n                return;\n            collection.off(\"change\", this._internal.collectionChangedCallback);\n            this._internal.collection = undefined;\n        },\n        bindCollection(collection) {\n            // @ts-expect-error\n            this.unbindCurrentCollection();\n            this._internal.collection = collection;\n            collection &&\n                collection.on(\"change\", this._internal.collectionChangedCallback);\n        },\n        _onNodeDeleted() {\n            Node.prototype._onNodeDeleted.call(this);\n            // @ts-expect-error\n            this.unbindCurrentCollection();\n            CloudStore.instance.off(\"save\", this._internal.cloudStoreEvents);\n        },\n        getLimit() {\n            const filterSettings = this._internal.filterSettings;\n            if (!filterSettings[\"filterEnableLimit\"])\n                return;\n            else\n                return filterSettings[\"filterLimit\"] || 10;\n        },\n        getSkip() {\n            const filterSettings = this._internal.filterSettings;\n            if (!filterSettings[\"filterEnableLimit\"])\n                return;\n            else\n                return filterSettings[\"filterSkip\"] || 0;\n        },\n        scheduleFilter() {\n            // @ts-expect-error\n            if (this.collectionChangedScheduled)\n                return;\n            // @ts-expect-error\n            this.collectionChangedScheduled = true;\n            this.scheduleAfterInputsHaveUpdated(() => {\n                // @ts-expect-error\n                this.collectionChangedScheduled = false;\n                if (!this._internal.collection)\n                    return;\n                // Apply filter and write to output collection\n                let filtered = [].concat(this._internal.collection.items);\n                if (this._internal.enabled) {\n                    const _filter = this._internal.visualFilter;\n                    if (_filter !== undefined) {\n                        const filter = convertVisualFilter(_filter, {\n                            queryParameters: this._internal.filterParameters,\n                            collectionName: this._internal.collectionName,\n                        });\n                        if (filter)\n                            filtered = filtered.filter((m) => matchesQuery(m, filter));\n                    }\n                    const _sort = this._internal.visualSorting;\n                    if (_sort !== undefined && _sort.length > 0) {\n                        const sort = convertVisualSorting(_sort);\n                        if (sort)\n                            filtered.sort(compareObjects.bind(this, sort));\n                    }\n                    // @ts-expect-error\n                    const skip = this.getSkip();\n                    if (skip)\n                        filtered = filtered.slice(skip, filtered.length);\n                    // @ts-expect-error\n                    const limit = this.getLimit();\n                    if (limit)\n                        filtered = filtered.slice(0, limit);\n                }\n                this._internal.filteredCollection = Collection.create(filtered);\n                this.sendSignalOnOutput(\"modified\");\n                this.flagOutputDirty(\"firstItemId\");\n                this.flagOutputDirty(\"items\");\n                this.flagOutputDirty(\"count\");\n            });\n        },\n        setCollectionName(name) {\n            this._internal.collectionName = name;\n        },\n        setVisualFilter(value) {\n            this._internal.visualFilter = value;\n            // @ts-expect-error\n            if (this.isInputConnected(\"filter\") === false)\n                this.scheduleFilter();\n        },\n        setVisualSorting(value) {\n            this._internal.visualSorting = value;\n            // @ts-expect-error\n            if (this.isInputConnected(\"filter\") === false)\n                this.scheduleFilter();\n        },\n        setFilterParameter: function (name, value) {\n            this._internal.filterParameters[name] = value;\n            if (this.isInputConnected(\"filter\") === false)\n                this.scheduleFilter();\n        },\n        registerInputIfNeeded(name) {\n            if (this.hasInput(name)) {\n                return;\n            }\n            if (name === \"collectionName\")\n                return this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this.setCollectionName.bind(this),\n                });\n            if (name === \"visualFilter\")\n                return this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this.setVisualFilter.bind(this),\n                });\n            if (name === \"visualSorting\")\n                return this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this.setVisualSorting.bind(this),\n                });\n            if (name.startsWith(\"fp-\"))\n                return this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this.setFilterParameter.bind(this, name.substring(\"fp-\".length)),\n                });\n            this.registerInput(name, {\n                set(value) {\n                    this._internal.filterSettings[name] = value;\n                    // @ts-expect-error\n                    if (this.isInputConnected(\"filter\") === false)\n                        this.scheduleFilter();\n                },\n            });\n        },\n    },\n};\nfunction updatePorts$4(nodeId, parameters, editorConnection, dbCollections) {\n    const ports = [];\n    ports.push({\n        name: \"collectionName\",\n        type: {\n            name: \"enum\",\n            enums: dbCollections !== undefined\n                ? dbCollections.map((c) => {\n                    return { value: c.name, label: c.name };\n                })\n                : [],\n            allowEditOnly: true,\n        },\n        displayName: \"Class\",\n        plug: \"input\",\n        group: \"General\",\n    });\n    ports.push({\n        type: \"boolean\",\n        plug: \"input\",\n        group: \"Limit\",\n        name: \"filterEnableLimit\",\n        displayName: \"Use limit\",\n    });\n    if (parameters[\"filterEnableLimit\"]) {\n        ports.push({\n            type: \"number\",\n            default: 10,\n            plug: \"input\",\n            group: \"Limit\",\n            name: \"filterLimit\",\n            displayName: \"Limit\",\n        });\n        ports.push({\n            type: \"number\",\n            default: 0,\n            plug: \"input\",\n            group: \"Limit\",\n            name: \"filterSkip\",\n            displayName: \"Skip\",\n        });\n    }\n    if (parameters.collectionName !== undefined) {\n        const c = dbCollections.find((c) => c.name === parameters.collectionName);\n        if (c && c.schema && c.schema.properties) {\n            const schema = JSON.parse(JSON.stringify(c.schema));\n            const _supportedTypes = {\n                Boolean: true,\n                String: true,\n                Date: true,\n                Number: true,\n                Pointer: true,\n            };\n            for (const key in schema.properties) {\n                if (!_supportedTypes[schema.properties[key].type]) {\n                    delete schema.properties[key];\n                }\n            }\n            ports.push({\n                name: \"visualFilter\",\n                plug: \"input\",\n                type: { name: \"query-filter\", schema: schema, allowEditOnly: true },\n                displayName: \"Filter\",\n                group: \"Filter\",\n            });\n            ports.push({\n                name: \"visualSorting\",\n                plug: \"input\",\n                type: { name: \"query-sorting\", schema: schema, allowEditOnly: true },\n                displayName: \"Sorting\",\n                group: \"Sorting\",\n            });\n        }\n        if (parameters.visualFilter !== undefined) {\n            // Find all input ports\n            const uniqueInputs = {};\n            _collectInputs(uniqueInputs, parameters.visualFilter);\n            Object.keys(uniqueInputs).forEach((input) => {\n                ports.push({\n                    name: \"fp-\" + input,\n                    plug: \"input\",\n                    type: \"*\",\n                    displayName: input,\n                    group: \"Filter Parameters\",\n                });\n            });\n        }\n    }\n    editorConnection.sendDynamicPorts(nodeId, ports);\n}\nfunction setup$5(context, graphModel) {\n    if (!context.editorConnection ||\n        !context.editorConnection.isRunningLocally()) {\n        return;\n    }\n    graphModel.on(\"nodeAdded.FilterDBModels\", function (node) {\n        updatePorts$4(node.id, node.parameters, \n        // @ts-expect-error\n        context.editorConnection, graphModel.getMetaData(\"dbCollections\"));\n        node.on(\"parameterUpdated\", function () {\n            updatePorts$4(node.id, node.parameters, \n            // @ts-expect-error\n            context.editorConnection, graphModel.getMetaData(\"dbCollections\"));\n        });\n        graphModel.on(\"metadataChanged.dbCollections\", function (data) {\n            CloudStore.invalidateCollections();\n            // @ts-expect-error\n            updatePorts$4(node.id, node.parameters, context.editorConnection, data);\n        });\n        graphModel.on(\"metadataChanged.systemCollections\", function (data) {\n            CloudStore.invalidateCollections();\n            // @ts-expect-error\n            updatePorts$4(node.id, node.parameters, context.editorConnection, data);\n        });\n    });\n}\nfunction _collectInputs(uniqueInputs, query) {\n    if (query === undefined) {\n        return;\n    }\n    if (query.rules !== undefined) {\n        query.rules.forEach((r) => _collectInputs(uniqueInputs, r));\n    }\n    else if (query.input !== undefined) {\n        uniqueInputs[query.input] = true;\n    }\n}\n\nvar filterdbmodelsnode = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$l,\n    setup: setup$5\n});\n\nconst node$k = {\n    name: \"Model2\",\n    docs: \"https://docs.noodl.net/nodes/data/object/object-node\",\n    displayNodeName: \"Object\",\n    shortDesc: \"Stores any amount of properties and can be used standalone or together with Collections and For Each nodes.\",\n    category: \"Data\",\n    usePortAsLabel: \"modelId\",\n    color: \"data\",\n    dynamicports: [\n        {\n            name: \"conditionalports/extended\",\n            condition: \"idSource = explicit OR idSource NOT SET\",\n            inputs: [\"modelId\"],\n        },\n    ],\n    initialize() {\n        const internal = this._internal;\n        internal.inputValues = {};\n        internal.dirtyValues = {};\n        internal.onModelChangedCallback = (args) => {\n            if (this.isInputConnected(\"fetch\") === true)\n                return;\n            if (this.hasOutput(\"prop-\" + args.name))\n                this.flagOutputDirty(\"prop-\" + args.name);\n            if (this.hasOutput(\"changed-\" + args.name))\n                this.sendSignalOnOutput(\"changed-\" + args.name);\n            this.sendSignalOnOutput(\"changed\");\n        };\n    },\n    getInspectInfo() {\n        const model = this._internal.model;\n        if (!model)\n            return \"[No Object]\";\n        return [\n            { type: \"text\", value: \"Id: \" + model.getId() },\n            { type: \"value\", value: model.data },\n        ];\n    },\n    outputs: {\n        id: {\n            type: \"string\",\n            displayName: \"Id\",\n            group: \"General\",\n            getter() {\n                return this._internal.model\n                    ? this._internal.model.getId()\n                    : this._internal.modelId;\n            },\n        },\n        changed: {\n            type: \"signal\",\n            displayName: \"Changed\",\n            group: \"Events\",\n        },\n        fetched: {\n            type: \"signal\",\n            displayName: \"Fetched\",\n            group: \"Events\",\n        },\n    },\n    inputs: {\n        idSource: {\n            type: {\n                name: \"enum\",\n                enums: [\n                    { label: \"Specify explicitly\", value: \"explicit\" },\n                    { label: \"From repeater\", value: \"foreach\" },\n                ],\n                allowEditOnly: true,\n            },\n            default: \"explicit\",\n            displayName: \"Get Id from\",\n            group: \"General\",\n            set(value) {\n                if (value === \"foreach\") {\n                    this.scheduleAfterInputsHaveUpdated(() => {\n                        // Find closest nodescope that have a _forEachModel\n                        let component = this.nodeScope.componentOwner;\n                        while (component !== undefined &&\n                            component._forEachModel === undefined &&\n                            component.parentNodeScope) {\n                            component = component.parentNodeScope.componentOwner;\n                        }\n                        // @ts-expect-error\n                        this.setModel(component !== undefined\n                            ? component._forEachModel\n                            : undefined);\n                    });\n                }\n            },\n        },\n        modelId: {\n            type: {\n                name: \"string\",\n                identifierOf: \"ModelName\",\n                identifierDisplayName: \"Object Ids\",\n            },\n            displayName: \"Id\",\n            group: \"General\",\n            set(value) {\n                if (value instanceof Model)\n                    value = value.getId();\n                // Can be passed as model as well\n                else if (typeof value === \"object\")\n                    value = Model.create(value).getId(); // If this is an js object, dereference it\n                this._internal.modelId = value; // Wait to fetch data\n                // @ts-expect-error\n                if (this.isInputConnected(\"fetch\") === false)\n                    this.setModelID(value);\n                else {\n                    this.flagOutputDirty(\"id\");\n                }\n            },\n        },\n        properties: {\n            type: { name: \"stringlist\", allowEditOnly: true },\n            displayName: \"Properties\",\n            group: \"Properties\",\n            set(value) { },\n        },\n        fetch: {\n            displayName: \"Fetch\",\n            group: \"Actions\",\n            valueChangedToTrue() {\n                // @ts-expect-error\n                this.scheduleSetModel();\n            },\n        },\n    },\n    prototypeExtensions: {\n        scheduleStore() {\n            if (this.hasScheduledStore)\n                return;\n            this.hasScheduledStore = true;\n            const internal = this._internal;\n            this.scheduleAfterInputsHaveUpdated(() => {\n                this.hasScheduledStore = false;\n                if (!internal.model)\n                    return;\n                for (const i in internal.dirtyValues) {\n                    internal.model.set(i, internal.inputValues[i], { resolve: true });\n                }\n                internal.dirtyValues = {}; // Reset dirty values\n            });\n        },\n        scheduleSetModel() {\n            if (this.hasScheduledSetModel)\n                return;\n            this.hasScheduledSetModel = true;\n            this.scheduleAfterInputsHaveUpdated(() => {\n                this.hasScheduledSetModel = false;\n                // @ts-expect-error\n                this.setModelID(this._internal.modelId);\n            });\n        },\n        setModelID(id) {\n            const model = (this.nodeScope.modelScope || Model).get(id);\n            // @ts-expect-error\n            this.setModel(model);\n            this.sendSignalOnOutput(\"fetched\");\n        },\n        setModel(model) {\n            if (this._internal.model)\n                // Remove old listener if existing\n                this._internal.model.off(\"change\", this._internal.onModelChangedCallback);\n            this._internal.model = model;\n            this.flagOutputDirty(\"id\");\n            // In set idSource, we are calling setModel with undefined\n            if (model) {\n                model.on(\"change\", this._internal.onModelChangedCallback);\n                // We have a new model, mark all outputs as dirty\n                for (const key in model.data) {\n                    if (this.hasOutput(\"prop-\" + key))\n                        this.flagOutputDirty(\"prop-\" + key);\n                }\n            }\n        },\n        _onNodeDeleted() {\n            if (this._internal.model)\n                this._internal.model.off(\"change\", this._internal.onModelChangedCallback);\n        },\n        registerOutputIfNeeded(name) {\n            if (this.hasOutput(name)) {\n                return;\n            }\n            if (name.startsWith(\"prop-\"))\n                this.registerOutput(name, {\n                    getter: userOutputGetter.bind(this, name.substring(\"prop-\".length)),\n                });\n        },\n        registerInputIfNeeded(name) {\n            if (this.hasInput(name)) {\n                return;\n            }\n            if (name.startsWith(\"prop-\"))\n                this.registerInput(name, {\n                    set: userInputSetter.bind(this, name.substring(\"prop-\".length)),\n                });\n        },\n    },\n};\nfunction userOutputGetter(name) {\n    return this._internal.model\n        ? this._internal.model.get(name, { resolve: true })\n        : undefined;\n}\nfunction userInputSetter(name, value) {\n    this._internal.inputValues[name] = value;\n    // Store on change if no connection to store or new\n    const model = this._internal.model;\n    const valueChanged = model ? model.get(name) !== value : true;\n    if (valueChanged) {\n        this._internal.dirtyValues[name] = true;\n        this.scheduleStore();\n    }\n}\nfunction updatePorts$3(nodeId, parameters, editorConnection) {\n    const ports = [];\n    // Add value outputs\n    const properties = parameters.properties;\n    if (properties) {\n        const propArray = properties ? properties.split(\",\") : undefined;\n        if (propArray) {\n            for (const p of propArray) {\n                ports.push({\n                    type: {\n                        name: \"*\",\n                        allowConnectionsOnly: true,\n                    },\n                    plug: \"input/output\",\n                    group: \"Properties\",\n                    name: \"prop-\" + p,\n                    displayName: p,\n                });\n                ports.push({\n                    type: \"signal\",\n                    plug: \"output\",\n                    group: \"Changed Events\",\n                    displayName: p + \" Changed\",\n                    name: \"changed-\" + p,\n                });\n            }\n        }\n    }\n    editorConnection.sendDynamicPorts(nodeId, ports, {\n        detectRenamed: {\n            plug: \"input/output\",\n        },\n    });\n}\nfunction setup$4(context, graphModel) {\n    if (!context.editorConnection ||\n        !context.editorConnection.isRunningLocally()) {\n        return;\n    }\n    graphModel.on(\"nodeAdded.Model2\", function (node) {\n        updatePorts$3(node.id, node.parameters, context.editorConnection);\n        node.on(\"parameterUpdated\", function () {\n            updatePorts$3(node.id, node.parameters, context.editorConnection);\n        });\n    });\n}\n\nvar modelnode2 = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$k,\n    setup: setup$4\n});\n\nfunction _addBaseInfo(def) {\n    Object.assign(def.node, {\n        category: \"Data\",\n        color: \"data\",\n    });\n}\nfunction _addModelId(def, opts) {\n    const _includeInputs = opts === undefined || opts.includeInputs;\n    const _includeOutputs = opts === undefined || opts.includeOutputs;\n    Object.assign(def.node, {\n        inputs: def.node.inputs || {},\n        outputs: def.node.outputs || {},\n        methods: def.node.methods || {},\n    });\n    if (_includeInputs) {\n        Object.assign(def.node, {\n            usePortAsLabel: \"modelId\",\n        });\n        def.node.dynamicports = (def.node.dynamicports || []).concat([\n            {\n                name: \"conditionalports/extended\",\n                condition: \"idSource = explicit OR idSource NOT SET\",\n                inputs: [\"modelId\"],\n            },\n        ]);\n        // Inputs\n        // @ts-expect-error\n        Object.assign(def.node.inputs, {\n            idSource: {\n                type: {\n                    name: \"enum\",\n                    enums: [\n                        { label: \"Specify explicitly\", value: \"explicit\" },\n                        { label: \"From repeater\", value: \"foreach\" },\n                    ],\n                    allowEditOnly: true,\n                },\n                default: \"explicit\",\n                displayName: \"Id Source\",\n                group: \"General\",\n                set(value) {\n                    if (value === \"foreach\") {\n                        // @ts-expect-error\n                        this.scheduleAfterInputsHaveUpdated(() => {\n                            // Find closest nodescope that have a _forEachModel\n                            // @ts-expect-error\n                            let component = this.nodeScope.componentOwner;\n                            while (component !== undefined &&\n                                component._forEachModel === undefined &&\n                                component.parentNodeScope) {\n                                component = component.parentNodeScope.componentOwner;\n                            }\n                            // @ts-expect-error\n                            this.setModel(component !== undefined ? component._forEachModel : undefined);\n                        });\n                    }\n                },\n            },\n            modelId: {\n                type: {\n                    name: \"string\",\n                    identifierOf: \"ModelName\",\n                    identifierDisplayName: \"Object Ids\",\n                },\n                displayName: \"Id\",\n                group: \"General\",\n                set: function (value) {\n                    if (value instanceof Model)\n                        value = value.getId(); // Can be passed as model as well\n                    // @ts-expect-error\n                    this._internal.modelId = value; // Wait to fetch data\n                    // @ts-expect-error\n                    this.setModelID(value);\n                },\n            },\n        });\n    }\n    // Outputs\n    if (_includeOutputs) {\n        // @ts-expect-error\n        Object.assign(def.node.outputs, {\n            id: {\n                type: \"string\",\n                displayName: \"Id\",\n                group: \"General\",\n                getter: function () {\n                    // @ts-expect-error\n                    return this._internal.model\n                        ? // @ts-expect-error\n                            this._internal.model.getId()\n                        : // @ts-expect-error\n                            this._internal.modelId;\n                },\n            },\n        });\n    }\n    // Methods\n    // @ts-expect-error\n    Object.assign(def.node.methods, {\n        setModelID: function (id) {\n            // @ts-expect-error\n            const model = (this.nodeScope.modelScope || Model).get(id);\n            // @ts-expect-error\n            this.setModel(model);\n        },\n        setModel: function (model) {\n            // @ts-expect-error\n            this._internal.model = model;\n            // @ts-expect-error\n            this.flagOutputDirty(\"id\");\n        },\n    });\n    //Inspect model\n    if (!def.node.getInspectInfo) {\n        def.node.getInspectInfo = function () {\n            // @ts-expect-error\n            const model = this._internal.model;\n            if (!model)\n                return \"[No Object]\";\n            return [\n                { type: \"text\", value: \"Id: \" + model.getId() },\n                { type: \"value\", value: model.data },\n            ];\n        };\n    }\n}\nfunction _addInputProperties(def) {\n    const _def = {\n        node: Object.assign({}, def.node),\n        setup: def.setup,\n    };\n    const _methods = Object.assign({}, def.node.methods);\n    Object.assign(def.node, {\n        inputs: def.node.inputs || {},\n        outputs: def.node.outputs || {},\n        methods: def.node.methods || {},\n    });\n    Object.assign(def, {\n        setup: function (context, graphModel) {\n            if (!context.editorConnection ||\n                !context.editorConnection.isRunningLocally()) {\n                return;\n            }\n            graphModel.on(\"nodeAdded.\" + def.node.name, function (node) {\n                function _updatePorts() {\n                    const ports = [];\n                    const _types = [\n                        { label: \"String\", value: \"string\" },\n                        { label: \"Boolean\", value: \"boolean\" },\n                        { label: \"Number\", value: \"number\" },\n                        { label: \"Date\", value: \"date\" },\n                        { label: \"Array\", value: \"array\" },\n                        { label: \"Object\", value: \"object\" },\n                        { label: \"Any\", value: \"*\" },\n                    ];\n                    // Add value outputs\n                    let properties = node.parameters.properties;\n                    if (properties) {\n                        properties = properties ? properties.split(\",\") : undefined;\n                        for (const p of properties) {\n                            // Property input\n                            ports.push({\n                                type: {\n                                    name: node.parameters[\"type-\" + p] === undefined\n                                        ? \"*\"\n                                        : node.parameters[\"type-\" + p],\n                                },\n                                plug: \"input\",\n                                group: \"Property Values\",\n                                displayName: p,\n                                name: \"prop-\" + p,\n                            });\n                            // Property type\n                            ports.push({\n                                type: {\n                                    name: \"enum\",\n                                    enums: _types,\n                                    allowEditOnly: true,\n                                },\n                                plug: \"input\",\n                                group: \"Property Types\",\n                                displayName: p,\n                                default: \"*\",\n                                name: \"type-\" + p,\n                            });\n                        }\n                    }\n                    context.editorConnection.sendDynamicPorts(node.id, ports, {\n                        detectRenamed: {\n                            plug: \"input\",\n                        },\n                    });\n                }\n                _updatePorts();\n                node.on(\"parameterUpdated\", function () {\n                    _updatePorts();\n                });\n            });\n            _def.setup && _def.setup(context, graphModel);\n        },\n    });\n    // Initialize\n    Object.assign(def.node, {\n        initialize: function () {\n            // @ts-expect-error\n            const internal = this._internal;\n            internal.inputValues = {};\n            internal.inputTypes = {};\n            _def.node.initialize && _def.node.initialize.call(this);\n        },\n    });\n    // Outputs\n    // @ts-expect-error\n    Object.assign(def.node.outputs, {});\n    // Inputs\n    // @ts-expect-error\n    Object.assign(def.node.inputs, {\n        properties: {\n            type: { name: \"stringlist\", allowEditOnly: true },\n            displayName: \"Properties\",\n            group: \"Properties to set\",\n            set: function () { },\n        },\n    });\n    // Methods\n    // @ts-expect-error\n    Object.assign(def.node.methods, {\n        _pushInputValues: function (model) {\n            // @ts-expect-error\n            const internal = this._internal;\n            const _defaultValueForType = {\n                boolean: false,\n                string: \"\",\n                number: 0,\n                date: new Date(),\n            };\n            const _allKeys = {};\n            for (const key in internal.inputTypes)\n                _allKeys[key] = true;\n            for (const key in internal.inputValues)\n                _allKeys[key] = true;\n            // @ts-expect-error\n            const properties = this.model.parameters.properties || \"\";\n            const validProperties = properties.split(\",\");\n            const keysToSet = Object.keys(_allKeys).filter((key) => validProperties.indexOf(key) !== -1);\n            for (const i of keysToSet) {\n                let value = internal.inputValues[i];\n                if (value !== undefined) {\n                    //Parse array types with string as javascript\n                    if (internal.inputTypes[i] !== undefined &&\n                        internal.inputTypes[i] === \"array\" &&\n                        typeof value === \"string\") {\n                        // @ts-expect-error\n                        this.context.editorConnection.clearWarning(\n                        // @ts-expect-error\n                        this.nodeScope.componentOwner.name, \n                        // @ts-expect-error\n                        this.id, \"invalid-array-\" + i);\n                        try {\n                            value = eval(value); //this might be static data in the form of javascript\n                        }\n                        catch (e) {\n                            if (value.indexOf(\"[\") !== -1 || value.indexOf(\"{\") !== -1) {\n                                // @ts-expect-error\n                                this.context.editorConnection.sendWarning(\n                                // @ts-expect-error\n                                this.nodeScope.componentOwner.name, \n                                // @ts-expect-error\n                                this.id, \"invalid-array-\" + i, {\n                                    showGlobally: true,\n                                    // @ts-expect-error\n                                    message: \"Invalid array<br>\" + e.toString(),\n                                });\n                                value = [];\n                            }\n                            else {\n                                //backwards compatibility with how this node used to work\n                                value = Collection.get(value);\n                            }\n                        }\n                    }\n                    // Resolve object from IDs\n                    if (internal.inputTypes[i] !== undefined &&\n                        internal.inputTypes[i] === \"object\" &&\n                        typeof value === \"string\") {\n                        // @ts-expect-error\n                        value = (this.nodeScope.modelScope || Model).get(value);\n                    }\n                    // @ts-expect-error\n                    model.set(i, value, { resolve: true });\n                }\n                else {\n                    // @ts-expect-error\n                    model.set(i, _defaultValueForType[internal.inputTypes[i]], {\n                        resolve: true,\n                    });\n                }\n            }\n        },\n        scheduleStore: function () {\n            // @ts-expect-error\n            if (this.hasScheduledStore)\n                return;\n            // @ts-expect-error\n            this.hasScheduledStore = true;\n            // @ts-expect-error\n            const internal = this._internal;\n            // @ts-expect-error\n            this.scheduleAfterInputsHaveUpdated(() => {\n                // @ts-expect-error\n                this.hasScheduledStore = false;\n                if (!internal.model)\n                    return;\n                // @ts-expect-error\n                this._pushInputValues(internal.model);\n                // @ts-expect-error\n                this.sendSignalOnOutput(\"stored\");\n            });\n        },\n        registerInputIfNeeded: function (name) {\n            // @ts-expect-error\n            if (this.hasInput(name)) {\n                return;\n            }\n            if (name.startsWith(\"prop-\"))\n                // @ts-expect-error\n                this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this._setInputValue.bind(this, name.substring(\"prop-\".length)),\n                });\n            if (name.startsWith(\"type-\"))\n                // @ts-expect-error\n                this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this._setInputType.bind(this, name.substring(\"type-\".length)),\n                });\n            _methods &&\n                _methods.registerInputIfNeeded &&\n                // @ts-expect-error\n                _def.node.methods.registerInputIfNeeded.call(this, name);\n        },\n        _setInputValue: function (name, value) {\n            // @ts-expect-error\n            this._internal.inputValues[name] = value;\n        },\n        _setInputType: function (name, value) {\n            // @ts-expect-error\n            this._internal.inputTypes[name] = value;\n        },\n    });\n}\n\nconst SetModelPropertiedNodeDefinition = {\n    node: {\n        name: \"SetModelProperties\",\n        category: \"\",\n        docs: \"https://docs.noodl.net/nodes/data/object/set-object-properties\",\n        displayNodeName: \"Set Object Properties\",\n        inputs: {\n            store: {\n                displayName: \"Do\",\n                group: \"Actions\",\n                valueChangedToTrue: function () {\n                    this.scheduleStore();\n                },\n            },\n        },\n        outputs: {\n            stored: {\n                type: \"signal\",\n                displayName: \"Done\",\n                group: \"Events\",\n            },\n        },\n    },\n};\n_addBaseInfo(SetModelPropertiedNodeDefinition);\n_addModelId(SetModelPropertiedNodeDefinition);\n_addInputProperties(SetModelPropertiedNodeDefinition);\nconst node$j = SetModelPropertiedNodeDefinition.node;\n\nvar setmodelpropertiesnode = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$j\n});\n\nconst NewModelNodeDefinition = {\n    node: {\n        name: \"NewModel\",\n        category: \"\",\n        docs: \"https://docs.noodl.net/nodes/data/object/create-new-object\",\n        displayNodeName: \"Create New Object\",\n        inputs: {\n            new: {\n                displayName: \"Do\",\n                group: \"Actions\",\n                valueChangedToTrue() {\n                    // @ts-expect-error\n                    this.scheduleNew();\n                },\n            },\n        },\n        outputs: {\n            created: {\n                type: \"signal\",\n                displayName: \"Done\",\n                group: \"Events\",\n            },\n        },\n        methods: {\n            scheduleNew() {\n                // @ts-expect-error\n                if (this.hasScheduledNew)\n                    return;\n                // @ts-expect-error\n                this.hasScheduledNew = true;\n                this.scheduleAfterInputsHaveUpdated(() => {\n                    // @ts-expect-error\n                    this.hasScheduledNew = false;\n                    const newModel = (this.nodeScope.modelScope || Model).get();\n                    // @ts-expect-error\n                    this._pushInputValues(newModel);\n                    // @ts-expect-error\n                    this.setModel(newModel);\n                    this.sendSignalOnOutput(\"created\");\n                });\n            },\n        },\n    },\n};\n_addBaseInfo(NewModelNodeDefinition);\n_addModelId(NewModelNodeDefinition, { includeOutputs: true });\n_addInputProperties(NewModelNodeDefinition);\nconst node$i = NewModelNodeDefinition.node;\n\nvar newmodelnode = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$i\n});\n\nconst node$h = {\n    name: \"Cloud File\",\n    docs: \"https://docs.noodl.net/nodes/data/cloud-data/cloud-file\",\n    category: \"Cloud Services\",\n    color: \"data\",\n    getInspectInfo() {\n        var _a;\n        return (_a = this._internal.cloudFile) === null || _a === void 0 ? void 0 : _a.getUrl();\n    },\n    outputs: {\n        url: {\n            type: \"string\",\n            displayName: \"URL\",\n            group: \"General\",\n            getter() {\n                var _a;\n                return (_a = this._internal.cloudFile) === null || _a === void 0 ? void 0 : _a.getUrl();\n            },\n        },\n        name: {\n            type: \"string\",\n            displayName: \"Name\",\n            group: \"General\",\n            getter() {\n                if (!this._internal.cloudFile)\n                    return undefined;\n                //parse prefixes the file with a guid_\n                //remove it so the name is the same as the original file name\n                const n = this._internal.cloudFile.getName().split(\"_\");\n                return n.length === 1 ? n[0] : n.slice(1).join(\"_\");\n            },\n        },\n    },\n    inputs: {\n        file: {\n            type: \"cloudfile\",\n            displayName: \"Cloud File\",\n            group: \"General\",\n            set(value) {\n                if (!(value instanceof CloudFile)) {\n                    return;\n                }\n                this._internal.cloudFile = value;\n                this.flagOutputDirty(\"name\");\n                this.flagOutputDirty(\"url\");\n            },\n        },\n    },\n};\n\nvar cloudfilenode = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$h\n});\n\nclass ConfigService {\n    constructor() {\n        this.cacheDuration = 15 * 60 * 1000; // 15 min cache\n    }\n    _makeRequest(path, options) {\n        if (typeof _noodl_cloud_runtime_version === \"undefined\") {\n            // Running in browser\n            const xhr = new XMLHttpRequest();\n            xhr.onreadystatechange = function () {\n                if (xhr.readyState === 4) {\n                    let json;\n                    try {\n                        json = JSON.parse(xhr.response);\n                    }\n                    catch (e) { }\n                    if (xhr.status === 200 || xhr.status === 201) {\n                        options.success(json);\n                    }\n                    else\n                        options.error(json || { error: xhr.responseText, status: xhr.status });\n                }\n            };\n            const cloudServices = NoodlRuntime$1.instance.getMetaData(\"cloudservices\");\n            const appId = cloudServices.appId;\n            const endpoint = cloudServices.endpoint;\n            xhr.open(\"GET\", endpoint + path, true);\n            xhr.setRequestHeader(\"X-Parse-Application-Id\", appId);\n            xhr.send();\n        }\n        else {\n            // Running in cloud runtime\n            const endpoint = typeof _noodl_cloudservices !== \"undefined\"\n                ? _noodl_cloudservices.endpoint\n                : this.endpoint;\n            const appId = typeof _noodl_cloudservices !== \"undefined\"\n                ? _noodl_cloudservices.appId\n                : this.appId;\n            const masterKey = typeof _noodl_cloudservices !== \"undefined\"\n                ? _noodl_cloudservices.masterKey\n                : undefined;\n            fetch(endpoint + path, {\n                method: \"GET\",\n                // @ts-expect-error\n                headers: {\n                    \"X-Parse-Application-Id\": appId,\n                    \"X-Parse-Master-Key\": masterKey,\n                },\n            })\n                .then((r) => {\n                if (r.status === 200 || r.status === 201) {\n                    r.json()\n                        .then((json) => options.success(json))\n                        .catch((e) => options.error({\n                        error: \"Config: Failed to get json result.\",\n                    }));\n                }\n                else {\n                    r.json()\n                        .then((json) => options.error(json))\n                        .catch((e) => options.error({ error: \"Failed to fetch.\" }));\n                }\n            })\n                .catch((e) => {\n                options.error({ error: e.message });\n            });\n        }\n    }\n    _getConfig() {\n        return new Promise((resolve, reject) => {\n            this._makeRequest(\"/config\", {\n                success: (config) => {\n                    resolve(config.params || {});\n                },\n                error: (err) => {\n                    reject(err);\n                },\n            });\n        });\n    }\n    async getConfig() {\n        if (this.configCachePending)\n            return this.configCachePending;\n        if (!this.configCache) {\n            this.configCachePending = this._getConfig();\n            this.configCache = await this.configCachePending;\n            delete this.configCachePending;\n            this.ttl = Date.now() + this.cacheDuration;\n            return this.configCache;\n        }\n        else {\n            // Update cache if ttl has passed\n            if (this.ttl && Date.now() > this.ttl) {\n                this._getConfig().then((config) => {\n                    this.configCache = config;\n                    this.ttl = Date.now() + this.cacheDuration;\n                });\n            }\n            // But return currently cached\n            return this.configCache;\n        }\n    }\n    clearCache() {\n        delete this.configCache;\n    }\n}\nConfigService.instance = new ConfigService();\n\nconst ConfigNodeDefinition = {\n    name: \"DbConfig\",\n    docs: \"https://docs.noodl.net/nodes/data/cloud-data/config\",\n    displayNodeName: \"Config\",\n    category: \"Cloud Services\",\n    usePortAsLabel: \"configKey\",\n    color: \"data\",\n    initialize: function () {\n        const internal = this._internal;\n        ConfigService.instance.getConfig().then((config) => {\n            internal.config = config;\n            if (this.hasOutput(\"value\"))\n                this.flagOutputDirty(\"value\");\n        });\n    },\n    getInspectInfo() {\n        // @ts-expect-error\n        const value = this.getValue();\n        if (value === undefined)\n            return \"[No Value]\";\n        return [{ type: \"value\", value: value }];\n    },\n    methods: {\n        getValue: function () {\n            const internal = this._internal;\n            if (internal.useDevValue &&\n                this.context.editorConnection &&\n                this.context.editorConnection.isRunningLocally()) {\n                return internal.devValue;\n            }\n            else if (internal.config !== undefined &&\n                internal.configKey !== undefined) {\n                return internal.config[internal.configKey];\n            }\n        },\n        setInternal: function (key, value) {\n            this._internal[key] = value;\n            if (this.hasOutput(\"value\"))\n                this.flagOutputDirty(\"value\");\n        },\n        registerOutputIfNeeded: function (name) {\n            if (this.hasOutput(name)) {\n                return;\n            }\n            if (name === \"value\")\n                return this.registerOutput(name, {\n                    // @ts-expect-error\n                    getter: this.getValue.bind(this),\n                });\n        },\n        registerInputIfNeeded: function (name) {\n            if (this.hasInput(name)) {\n                return;\n            }\n            if (name === \"configKey\" || name === \"useDevValue\" || name === \"devValue\")\n                return this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this.setInternal.bind(this, name),\n                });\n        },\n    },\n};\nconst node$g = ConfigNodeDefinition;\nfunction setup$3(context, graphModel) {\n    if (!context.editorConnection ||\n        !context.editorConnection.isRunningLocally()) {\n        return;\n    }\n    function updatePorts(node) {\n        const ports = [];\n        context.editorConnection.clearWarning(node.component.name, node.id, \"dbconfig-warning\");\n        const configSchema = graphModel.getMetaData(\"dbConfigSchema\");\n        let valueType;\n        if (configSchema) {\n            const isCloud = typeof global._noodl_cloud_runtime_version !== \"undefined\";\n            ports.push({\n                name: \"configKey\",\n                displayName: \"Parameter\",\n                group: \"General\",\n                type: {\n                    name: \"enum\",\n                    enums: Object.keys(configSchema)\n                        .filter((k) => isCloud || !configSchema[k].masterKeyOnly)\n                        .map((k) => ({ value: k, label: k })),\n                    allowEditOnly: true,\n                },\n                plug: \"input\",\n            });\n            if (node.parameters[\"configKey\"] !== undefined &&\n                configSchema &&\n                configSchema[node.parameters[\"configKey\"]]) {\n                valueType = configSchema[node.parameters[\"configKey\"]].type;\n                if (valueType === \"string\" ||\n                    valueType === \"boolean\" ||\n                    valueType === \"number\" ||\n                    valueType === \"object\" ||\n                    valueType === \"array\") {\n                    ports.push({\n                        name: \"useDevValue\",\n                        displayName: \"Enable\",\n                        group: \"Local Override\",\n                        type: \"boolean\",\n                        default: false,\n                        plug: \"input\",\n                    });\n                    if (node.parameters[\"useDevValue\"] === true) {\n                        ports.push({\n                            name: \"devValue\",\n                            displayName: \"Value\",\n                            group: \"Local Override\",\n                            type: valueType,\n                            plug: \"input\",\n                        });\n                    }\n                }\n            }\n            else if (node.parameters[\"configKey\"] !== undefined) {\n                context.editorConnection.sendWarning(node.component.name, node.id, \"dbconfig-warning\", {\n                    showGlobally: true,\n                    message: node.parameters[\"configKey\"] +\n                        \" config parameter is missing, add it to your cloud service.\",\n                });\n            }\n        }\n        else {\n            context.editorConnection.sendWarning(node.component.name, node.id, \"dbconfig-warning\", {\n                showGlobally: true,\n                message: \"You need an active cloud service.\",\n            });\n        }\n        ports.push({\n            name: \"value\",\n            displayName: \"Value\",\n            group: \"General\",\n            type: valueType || \"*\",\n            plug: \"output\",\n        });\n        context.editorConnection.sendDynamicPorts(node.id, ports);\n    }\n    function _managePortsForNode(node) {\n        updatePorts(node);\n        node.on(\"parameterUpdated\", function () {\n            updatePorts(node);\n        });\n        graphModel.on(\"metadataChanged.dbConfigSchema\", function () {\n            ConfigService.instance.clearCache();\n            updatePorts(node);\n        });\n    }\n    graphModel.on(\"editorImportComplete\", () => {\n        graphModel.on(\"nodeAdded.DbConfig\", function (node) {\n            _managePortsForNode(node);\n        });\n        for (const node of graphModel.getNodesWithType(\"DbConfig\")) {\n            _managePortsForNode(node);\n        }\n    });\n}\n\nvar dbconfig = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$g,\n    setup: setup$3\n});\n\nfunction createDefinition(args) {\n    return {\n        name: args.name,\n        docs: args.docs,\n        shortDesc: args.shortDesc,\n        nodeDoubleClickAction: args.nodeDoubleClickAction,\n        category: \"Variables\",\n        initialize() {\n            this._internal.currentValue = args.startValue;\n            this._internal.latestValue = 0;\n        },\n        getInspectInfo() {\n            const type = args.type.name === \"color\" ? \"color\" : \"text\";\n            return [{ type, value: this._internal.currentValue }];\n        },\n        inputs: {\n            value: {\n                type: args.type,\n                displayName: \"Value\",\n                default: args.startValue,\n                set(value) {\n                    if (this.isInputConnected(\"saveValue\") === false) {\n                        // @ts-expect-error\n                        this.setValueTo(value);\n                    }\n                    else {\n                        this._internal.latestValue = value;\n                    }\n                },\n            },\n            saveValue: {\n                displayName: \"Set\",\n                valueChangedToTrue() {\n                    this.scheduleAfterInputsHaveUpdated(function () {\n                        // @ts-expect-error\n                        this.setValueTo(this._internal.latestValue);\n                        this.sendSignalOnOutput(\"stored\");\n                    });\n                },\n            },\n        },\n        outputs: {\n            savedValue: {\n                type: args.type.name,\n                displayName: \"Value\",\n                getter() {\n                    return this._internal.currentValue;\n                },\n            },\n            changed: {\n                type: \"signal\",\n                displayName: \"Changed\",\n            },\n            stored: {\n                type: \"signal\",\n                displayName: \"Stored\",\n            },\n        },\n        prototypeExtensions: {\n            setValueTo(value) {\n                value = args.cast(value);\n                const changed = this._internal.currentValue !== value;\n                this._internal.currentValue = value;\n                if (changed) {\n                    this.flagOutputDirty(\"savedValue\");\n                    this.sendSignalOnOutput(\"changed\");\n                    args.onChanged && args.onChanged.call(this);\n                }\n            },\n        },\n    };\n}\n\nconst node$f = createDefinition({\n    name: \"Number\",\n    docs: \"https://docs.noodl.net/nodes/data/number\",\n    startValue: 0,\n    nodeDoubleClickAction: {\n        focusPort: \"value\",\n    },\n    type: {\n        name: \"number\",\n    },\n    cast(value) {\n        return Number(value);\n    },\n});\n\nvar number = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$f\n});\n\nconst StringNode = createDefinition({\n    name: \"String\",\n    docs: \"https://docs.noodl.net/nodes/data/string\",\n    shortDesc: \"Contains a string (text).\",\n    startValue: \"\",\n    nodeDoubleClickAction: {\n        focusPort: \"value\",\n    },\n    type: {\n        name: \"string\",\n    },\n    cast(value) {\n        return String(value);\n    },\n    onChanged: function () {\n        this.flagOutputDirty(\"length\");\n    },\n});\nextend(StringNode, {\n    usePortAsLabel: \"value\",\n    portLabelTruncationMode: \"length\",\n    outputs: {\n        length: {\n            type: \"number\",\n            displayName: \"Length\",\n            getter: function () {\n                return this._internal.currentValue.length;\n            },\n        },\n    },\n});\nconst node$e = StringNode;\n\nvar string = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$e\n});\n\nconst node$d = createDefinition({\n    name: \"Boolean\",\n    docs: \"https://docs.noodl.net/nodes/data/boolean\",\n    startValue: false,\n    type: {\n        name: \"boolean\",\n    },\n    cast(value) {\n        return Boolean(value);\n    },\n});\n\nvar boolean = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$d\n});\n\nconst node$c = {\n    name: \"Condition\",\n    docs: \"https://docs.noodl.net/nodes/utilities/logic/condition\",\n    category: \"Logic\",\n    initialize() { },\n    getInspectInfo() {\n        const condition = this.getInputValue(\"condition\");\n        let value;\n        if (condition === undefined) {\n            value = \"[No input]\";\n        }\n        else {\n            value = condition;\n        }\n        return [\n            {\n                type: \"value\",\n                value,\n            },\n        ];\n    },\n    inputs: {\n        condition: {\n            type: \"boolean\",\n            displayName: \"Condition\",\n            group: \"General\",\n            set(_value) {\n                if (!this.isInputConnected(\"eval\")) {\n                    // Evaluate right away\n                    // @ts-expect-error\n                    this.scheduleEvaluate();\n                }\n            },\n        },\n        eval: {\n            type: \"signal\",\n            displayName: \"Evaluate\",\n            group: \"Actions\",\n            valueChangedToTrue() {\n                // @ts-expect-error\n                this.scheduleEvaluate();\n            },\n        },\n    },\n    outputs: {\n        ontrue: {\n            type: \"signal\",\n            displayName: \"On True\",\n            group: \"Events\",\n        },\n        onfalse: {\n            type: \"signal\",\n            displayName: \"On False\",\n            group: \"Events\",\n        },\n        result: {\n            type: \"boolean\",\n            displayName: \"Is True\",\n            group: \"Booleans\",\n            getter() {\n                return !!this.getInputValue(\"condition\");\n            },\n        },\n        isfalse: {\n            type: \"boolean\",\n            displayName: \"Is False\",\n            group: \"Booleans\",\n            getter() {\n                return !this.getInputValue(\"condition\");\n            },\n        },\n    },\n    methods: {\n        scheduleEvaluate() {\n            this.scheduleAfterInputsHaveUpdated(() => {\n                this.flagOutputDirty(\"result\");\n                this.flagOutputDirty(\"isfalse\");\n                const condition = this.getInputValue(\"condition\");\n                this.sendSignalOnOutput(condition ? \"ontrue\" : \"onfalse\");\n            });\n        },\n    },\n};\n\nvar condition = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$c\n});\n\nfunction and(values) {\n    //if none are false, then return true\n    return values.length > 0 && values.some((v) => !v) === false;\n}\nconst node$b = {\n    name: \"And\",\n    docs: \"https://docs.noodl.net/nodes/logic/and\",\n    category: \"Logic\",\n    initialize() {\n        this._internal = {\n            inputs: [],\n        };\n    },\n    getInspectInfo() {\n        return and(this._internal.inputs);\n    },\n    numberedInputs: {\n        input: {\n            displayPrefix: \"Input\",\n            type: \"boolean\",\n            createSetter(index) {\n                return function (value) {\n                    const boolValue = value ? true : false;\n                    if (this._internal.inputs[index] === boolValue) {\n                        return;\n                    }\n                    this._internal.inputs[index] = boolValue;\n                    const result = and(this._internal.inputs);\n                    if (this._internal.result !== result) {\n                        this._internal.result = result;\n                        this.flagOutputDirty(\"result\");\n                    }\n                };\n            },\n        },\n    },\n    outputs: {\n        result: {\n            type: \"boolean\",\n            displayName: \"Result\",\n            get() {\n                return this._internal.result;\n            },\n        },\n    },\n};\n\nvar and$1 = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$b\n});\n\nfunction isTrue(value) {\n    return value ? true : false;\n}\nconst node$a = {\n    name: \"Or\",\n    docs: \"https://docs.noodl.net/nodes/logic/or\",\n    category: \"Logic\",\n    initialize() {\n        this._internal.inputs = [];\n    },\n    getInspectInfo() {\n        return this._internal.inputs.some(isTrue);\n    },\n    numberedInputs: {\n        input: {\n            type: \"boolean\",\n            displayPrefix: \"Input\",\n            createSetter(index) {\n                return function (value) {\n                    if (this._internal.inputs[index] === value) {\n                        return;\n                    }\n                    this._internal.inputs[index] = value;\n                    this.flagOutputDirty(\"result\");\n                };\n            },\n        },\n    },\n    outputs: {\n        result: {\n            type: \"boolean\",\n            displayName: \"Result\",\n            getter: function () {\n                return this._internal.inputs.some(isTrue);\n            },\n        },\n    },\n};\n\nvar or = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$a\n});\n\nconst node$9 = {\n    name: \"Boolean To String\",\n    docs: \"https://docs.noodl.net/nodes/utilities/boolean-to-string\",\n    category: \"Utilities\",\n    initialize() {\n        this._internal.inputs = [];\n        this._internal.currentSelectedIndex = 0;\n        this._internal.indexChanged = false;\n        this._internal.trueString = \"\";\n        this._internal.falseString = \"\";\n    },\n    inputs: {\n        trueString: {\n            displayName: \"String for true\",\n            type: \"string\",\n            set(value) {\n                if (this._internal.trueString === value)\n                    return;\n                this._internal.trueString = value;\n                if (this._internal.currentInput) {\n                    this.flagOutputDirty(\"currentValue\");\n                }\n            },\n        },\n        falseString: {\n            displayName: \"String for false\",\n            type: \"string\",\n            set(value) {\n                if (this._internal.falseString === value)\n                    return;\n                this._internal.falseString = value;\n                if (!this._internal.currentInput) {\n                    this.flagOutputDirty(\"currentValue\");\n                }\n            },\n        },\n        input: {\n            type: { name: \"boolean\" },\n            displayName: \"Selector\",\n            set(value) {\n                if (this._internal.currentInput === value)\n                    return;\n                this._internal.currentInput = value;\n                this.flagOutputDirty(\"currentValue\");\n                this.sendSignalOnOutput(\"inputChanged\");\n            },\n        },\n    },\n    outputs: {\n        currentValue: {\n            type: \"string\",\n            displayName: \"Current Value\",\n            group: \"Value\",\n            getter() {\n                return this._internal.currentInput\n                    ? this._internal.trueString\n                    : this._internal.falseString;\n            },\n        },\n        inputChanged: {\n            type: \"signal\",\n            displayName: \"Selector Changed\",\n            group: \"Signals\",\n        },\n    },\n};\n\nvar booleantostring = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$9\n});\n\nconst node$8 = {\n    name: \"Date To String\",\n    docs: \"https://docs.noodl.net/nodes/utilities/date-to-string\",\n    category: \"Utilities\",\n    initialize() {\n        this._internal.formatString = \"{year}-{month}-{date}\";\n    },\n    inputs: {\n        formatString: {\n            displayName: \"Format\",\n            type: \"string\",\n            default: \"{year}-{month}-{date}\",\n            set(value) {\n                if (this._internal.formatString === value)\n                    return;\n                this._internal.formatString = value;\n                if (this._internal.currentInput !== undefined) {\n                    // @ts-expect-error\n                    this._format();\n                    this.flagOutputDirty(\"currentValue\");\n                }\n            },\n        },\n        input: {\n            type: {\n                name: \"date\",\n            },\n            displayName: \"Date\",\n            set(value) {\n                const _value = typeof value === \"string\" ? new Date(value) : value;\n                if (this._internal.currentInput === _value)\n                    return;\n                this._internal.currentInput = _value;\n                // @ts-expect-error\n                this._format();\n            },\n        },\n    },\n    outputs: {\n        currentValue: {\n            type: \"string\",\n            displayName: \"Date String\",\n            group: \"Value\",\n            getter() {\n                return this._internal.dateString;\n            },\n        },\n        inputChanged: {\n            type: \"signal\",\n            displayName: \"Date Changed\",\n            group: \"Signals\",\n        },\n        onError: {\n            type: \"signal\",\n            displayName: \"Invalid Date\",\n            group: \"Signals\",\n        },\n    },\n    methods: {\n        _format() {\n            try {\n                const t = this._internal.currentInput;\n                const format = this._internal.formatString;\n                const date = (\"0\" + t.getDate()).slice(-2);\n                const month = (\"0\" + (t.getMonth() + 1)).slice(-2);\n                const monthShort = new Intl.DateTimeFormat(\"en-US\", {\n                    month: \"short\",\n                }).format(t);\n                const year = t.getFullYear();\n                const yearShort = year.toString().substring(2);\n                const hours = (\"0\" + t.getHours()).slice(-2);\n                const minutes = (\"0\" + t.getMinutes()).slice(-2);\n                const seconds = (\"0\" + t.getSeconds()).slice(-2);\n                this._internal.dateString = format\n                    .replace(/\\{date\\}/g, date)\n                    .replace(/\\{month\\}/g, String(month))\n                    .replace(/\\{monthShort\\}/g, monthShort)\n                    .replace(/\\{year\\}/g, String(year))\n                    .replace(/\\{yearShort\\}/g, String(yearShort))\n                    .replace(/\\{hours\\}/g, String(hours))\n                    .replace(/\\{minutes\\}/g, String(minutes))\n                    .replace(/\\{seconds\\}/g, String(seconds));\n            }\n            catch (error) {\n                // Set the output to be blank, makes it easier to handle.\n                this._internal.dateString = \"\";\n                this.flagOutputDirty(\"onError\");\n            }\n            // Flag that the value have changed\n            this.flagOutputDirty(\"currentValue\");\n            this.sendSignalOnOutput(\"inputChanged\");\n        },\n    },\n};\n\nvar datetostring = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$8\n});\n\nconst node$7 = {\n    name: \"String Mapper\",\n    docs: \"https://docs.noodl.net/nodes/string-manipulation/string-mapper\",\n    category: \"Utilities\",\n    initialize() {\n        this._internal = {\n            inputs: [],\n            mappings: [],\n        };\n    },\n    getInspectInfo() {\n        return this._internal.mappedString;\n    },\n    numberedInputs: {\n        input: {\n            type: \"string\",\n            displayPrefix: \"Input\",\n            group: \"Inputs\",\n            index: 10,\n            createSetter(index) {\n                return function (value) {\n                    value = value === undefined ? \"\" : String(value);\n                    this._internal.inputs[index] = value;\n                    // @ts-expect-error\n                    this.scheduleMapping();\n                };\n            },\n        },\n        output: {\n            type: \"string\",\n            displayPrefix: \"Mapping\",\n            index: 1001,\n            group: \"Mappings\",\n            createSetter(index) {\n                return function (value) {\n                    value = value === undefined ? \"\" : String(value);\n                    this._internal.mappings[index] = value;\n                    // @ts-expect-error\n                    this.scheduleMapping();\n                };\n            },\n        },\n    },\n    inputs: {\n        inputString: {\n            type: {\n                name: \"string\",\n            },\n            index: 1,\n            displayName: \"Input String\",\n            set(value) {\n                this._internal.currentInputString =\n                    value !== undefined ? String(value) : undefined;\n                // @ts-expect-error\n                this.scheduleMapping();\n            },\n        },\n        defaultMapping: {\n            type: \"string\",\n            displayName: \"Default\",\n            index: 1000,\n            group: \"Mappings\",\n            set(value) {\n                this._internal.defaultMapping = value;\n                // @ts-expect-error\n                this.scheduleMapping();\n            },\n        },\n    },\n    outputs: {\n        mappedString: {\n            type: \"string\",\n            displayName: \"Mapped String\",\n            group: \"Value\",\n            getter() {\n                return this._internal.mappedString;\n            },\n        },\n    },\n    prototypeExtensions: {\n        doMapping() {\n            this._internal.hasScheduledFetch = false;\n            const idx = this._internal.inputs.indexOf(this._internal.currentInputString);\n            if (idx !== -1)\n                this._internal.mappedString = this._internal.mappings[idx];\n            else\n                this._internal.mappedString = this._internal.defaultMapping;\n            this.flagOutputDirty(\"mappedString\");\n        },\n        scheduleMapping() {\n            const internal = this._internal;\n            if (!internal.hasScheduledFetch) {\n                internal.hasScheduledFetch = true;\n                // @ts-expect-error\n                this.scheduleAfterInputsHaveUpdated(this.doMapping.bind(this));\n            }\n        },\n    },\n};\n\nvar stringmapper = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$7\n});\n\nfunction invert(value) {\n    if (value === undefined) {\n        return undefined;\n    }\n    return !value;\n}\nconst node$6 = {\n    name: \"Inverter\",\n    docs: \"https://docs.noodl.net/nodes/logic/inverter\",\n    category: \"Logic\",\n    initialize() {\n        this._internal.currentValue = undefined;\n    },\n    getInspectInfo() {\n        return String(invert(this._internal.currentValue));\n    },\n    inputs: {\n        value: {\n            type: {\n                name: \"boolean\",\n            },\n            displayName: \"Value\",\n            set(value) {\n                this._internal.currentValue = value;\n                this.flagOutputDirty(\"result\");\n            },\n        },\n    },\n    outputs: {\n        result: {\n            type: \"boolean\",\n            displayName: \"Result\",\n            getter() {\n                return invert(this._internal.currentValue);\n            },\n        },\n    },\n};\n\nvar inverter = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$6\n});\n\nconst node$5 = {\n    name: \"Substring\",\n    docs: \"https://docs.noodl.net/nodes/string-manipulation/substring\",\n    category: \"String Manipulation\",\n    initialize() {\n        var internal = this._internal;\n        internal.startIndex = 0;\n        internal.endIndex = -1;\n        internal.cachedResult = \"\";\n        internal.inputString = \"\";\n        internal.resultDirty = false;\n    },\n    inputs: {\n        start: {\n            type: \"number\",\n            displayName: \"Start\",\n            default: 0,\n            set(value) {\n                this._internal.startIndex = value;\n                this._internal.resultDirty = true;\n                this.flagOutputDirty(\"result\");\n            },\n        },\n        end: {\n            type: \"number\",\n            displayName: \"End\",\n            default: 0,\n            set(value) {\n                this._internal.endIndex = value;\n                this._internal.resultDirty = true;\n                this.flagOutputDirty(\"result\");\n            },\n        },\n        string: {\n            type: {\n                name: \"string\",\n            },\n            displayName: \"String\",\n            default: \"\",\n            set(value) {\n                const stringValue = String(value);\n                this._internal.inputString = stringValue;\n                this._internal.resultDirty = true;\n                this.flagOutputDirty(\"result\");\n            },\n        },\n    },\n    outputs: {\n        result: {\n            type: \"string\",\n            displayName: \"Result\",\n            getter() {\n                var internal = this._internal;\n                if (internal.resultDirty) {\n                    if (internal.endIndex === -1) {\n                        internal.cachedResult = internal.inputString.substr(internal.startIndex);\n                    }\n                    else {\n                        internal.cachedResult = internal.inputString.substr(internal.startIndex, internal.endIndex - internal.startIndex);\n                    }\n                    internal.resultDirty = false;\n                }\n                return internal.cachedResult;\n            },\n        },\n    },\n};\n\nvar substring = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$5\n});\n\nconst node$4 = {\n    name: \"String Format\",\n    docs: \"https://docs.noodl.net/nodes/string-manipulation/string-format\",\n    category: \"String Manipulation\",\n    usePortAsLabel: \"format\",\n    portLabelTruncationMode: \"length\",\n    initialize() {\n        const internal = this._internal;\n        internal.format = \"\";\n        internal.cachedResult = \"\";\n        internal.resultDirty = false;\n        internal.inputValues = {};\n    },\n    getInspectInfo() {\n        // @ts-expect-error\n        return this.formatValue();\n    },\n    inputs: {\n        format: {\n            type: { name: \"string\", multiline: true },\n            displayName: \"Format\",\n            set(value) {\n                if (this._internal.format === value)\n                    return;\n                this._internal.format = value;\n                this._internal.resultDirty = true;\n                // @ts-expect-error\n                this.scheduleFormat();\n            },\n        },\n    },\n    outputs: {\n        formatted: {\n            type: \"string\",\n            displayName: \"Formatted\",\n            get() {\n                // @ts-expect-error\n                return this.formatValue();\n            },\n        },\n    },\n    methods: {\n        formatValue() {\n            const internal = this._internal;\n            if (internal.resultDirty) {\n                let formatted = internal.format;\n                const matches = internal.format.match(/\\{[A-Za-z0-9_]*\\}/g);\n                let inputs = [];\n                if (matches) {\n                    inputs = matches.map((name) => {\n                        return name.replace(\"{\", \"\").replace(\"}\", \"\");\n                    });\n                }\n                inputs.forEach((name) => {\n                    const v = internal.inputValues[name];\n                    formatted = formatted.replace(\"{\" + name + \"}\", v !== undefined ? v : \"\");\n                });\n                internal.cachedResult = formatted;\n                internal.resultDirty = false;\n            }\n            return internal.cachedResult;\n        },\n        registerInputIfNeeded(name) {\n            if (this.hasInput(name)) {\n                return;\n            }\n            this.registerInput(name, {\n                set(value) {\n                    if (this._internal.inputValues[name] === value)\n                        return;\n                    this._internal.inputValues[name] = value;\n                    this._internal.resultDirty = true;\n                    // @ts-expect-error\n                    this.scheduleFormat();\n                },\n            });\n        },\n        scheduleFormat() {\n            // @ts-expect-error\n            if (this.formatScheduled)\n                return;\n            // @ts-expect-error\n            this.formatScheduled = true;\n            this.scheduleAfterInputsHaveUpdated(() => {\n                // @ts-expect-error\n                this.formatValue();\n                this.flagOutputDirty(\"formatted\");\n                // @ts-expect-error\n                this.formatScheduled = false;\n            });\n        },\n    },\n};\nfunction updatePorts$2(id, format, editorConnection) {\n    const inputs = format.match(/\\{[A-Za-z0-9_]*\\}/g) || [];\n    const portsNames = inputs.map((def) => {\n        return def.replace(\"{\", \"\").replace(\"}\", \"\");\n    });\n    const ports = portsNames\n        //get unique names\n        .filter((value, index, self) => {\n        return self.indexOf(value) === index;\n    })\n        //and map names to ports\n        .map((name) => {\n        return {\n            name: name,\n            type: \"string\",\n            plug: \"input\",\n        };\n    });\n    editorConnection.sendDynamicPorts(id, ports);\n}\nfunction setup$2(context, graphModel) {\n    if (!context.editorConnection ||\n        !context.editorConnection.isRunningLocally()) {\n        return;\n    }\n    graphModel.on(\"nodeAdded.String Format\", (node) => {\n        if (node.parameters.format) {\n            updatePorts$2(node.id, node.parameters.format, context.editorConnection);\n        }\n        node.on(\"parameterUpdated\", (event) => {\n            if (event.name === \"format\") {\n                updatePorts$2(node.id, node.parameters.format, context.editorConnection);\n            }\n        });\n    });\n}\n\nvar stringformat = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$4,\n    setup: setup$2\n});\n\nconst node$3 = {\n    name: \"Counter\",\n    docs: \"https://docs.noodl.net/nodes/math/counter\",\n    category: \"Math\",\n    initialize() {\n        this._internal.currentValue = 0;\n        this._internal.startValue = 0;\n        this._internal.startValueSet = false;\n        this._internal.limitsEnabled = false;\n        this._internal.limitsMin = 0;\n        this._internal.limitsMax = 0;\n    },\n    getInspectInfo() {\n        return \"Count: \" + this._internal.currentValue;\n    },\n    inputs: {\n        increase: {\n            group: \"Actions\",\n            displayName: \"Increase Count\",\n            valueChangedToTrue() {\n                if (this._internal.limitsEnabled &&\n                    this._internal.currentValue >= this._internal.limitsMax) {\n                    return;\n                }\n                this._internal.currentValue++;\n                this.flagOutputDirty(\"currentCount\");\n                this.sendSignalOnOutput(\"countChanged\");\n            },\n        },\n        decrease: {\n            group: \"Actions\",\n            displayName: \"Decrease Count\",\n            valueChangedToTrue() {\n                if (this._internal.limitsEnabled &&\n                    this._internal.currentValue <= this._internal.limitsMin) {\n                    return;\n                }\n                this._internal.currentValue--;\n                this.flagOutputDirty(\"currentCount\");\n                this.sendSignalOnOutput(\"countChanged\");\n            },\n        },\n        reset: {\n            group: \"Actions\",\n            displayName: \"Reset To Start\",\n            valueChangedToTrue() {\n                // @ts-expect-error\n                if (this.currentValue === 0) {\n                    return;\n                }\n                this._internal.currentValue = this._internal.startValue;\n                this.flagOutputDirty(\"currentCount\");\n                this.sendSignalOnOutput(\"countChanged\");\n            },\n        },\n        startValue: {\n            type: \"number\",\n            displayName: \"Start Value\",\n            default: 0,\n            set(value) {\n                this._internal.startValue = Number(value);\n                if (this._internal.startValueSet === false) {\n                    this._internal.startValueSet = true;\n                    this._internal.currentValue = this._internal.startValue;\n                    this.flagOutputDirty(\"currentCount\");\n                    this.sendSignalOnOutput(\"countChanged\");\n                }\n            },\n        },\n        limitsMin: {\n            type: {\n                name: \"number\",\n            },\n            displayName: \"Min Value\",\n            group: \"Limits\",\n            default: 0,\n            set(value) {\n                this._internal.limitsMin = Number(value);\n            },\n        },\n        limitsMax: {\n            type: {\n                name: \"number\",\n            },\n            displayName: \"Max Value\",\n            group: \"Limits\",\n            default: 0,\n            set(value) {\n                this._internal.limitsMax = Number(value);\n            },\n        },\n        limitsEnabled: {\n            type: {\n                name: \"boolean\",\n            },\n            displayName: \"Limits Enabled\",\n            group: \"Limits\",\n            default: false,\n            set(value) {\n                this._internal.limitsEnabled = value ? true : false;\n            },\n        },\n    },\n    outputs: {\n        currentCount: {\n            displayName: \"Current Count\",\n            type: \"number\",\n            getter() {\n                return this._internal.currentValue;\n            },\n        },\n        countChanged: {\n            displayName: \"Count Changed\",\n            type: \"signal\",\n        },\n    },\n};\n\nvar counter = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$3\n});\n\nconst node$2 = {\n    name: \"Unique Id\",\n    docs: \"https://docs.noodl.net/nodes/utilities/unique-id\",\n    category: \"String Manipulation\",\n    initialize() {\n        const internal = this._internal;\n        internal.guid = guid();\n    },\n    getInspectInfo() {\n        return this._internal.guid;\n    },\n    inputs: {\n        new: {\n            displayName: \"New\",\n            valueChangedToTrue: function () {\n                const internal = this._internal;\n                internal.guid = guid();\n                this.flagOutputDirty(\"guid\");\n            },\n        },\n    },\n    outputs: {\n        guid: {\n            type: \"string\",\n            displayName: \"Id\",\n            getter: function () {\n                const internal = this._internal;\n                return internal.guid;\n            },\n        },\n    },\n    prototypeExtensions: {},\n};\n\nvar uniqueid = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$2\n});\n\nconst node$1 = {\n    name: \"net.noodl.user.SetUserProperties\",\n    docs: \"https://docs.noodl.net/nodes/data/user/set-user-properties\",\n    displayNodeName: \"Set User Properties\",\n    category: \"Cloud Services\",\n    color: \"data\",\n    initialize() {\n        const internal = this._internal;\n        internal.userProperties = {};\n    },\n    outputs: {\n        success: {\n            type: \"signal\",\n            displayName: \"Success\",\n            group: \"Events\",\n        },\n        failure: {\n            type: \"signal\",\n            displayName: \"Failure\",\n            group: \"Events\",\n        },\n        error: {\n            type: \"string\",\n            displayName: \"Error\",\n            group: \"Error\",\n            getter() {\n                return this._internal.error;\n            },\n        },\n    },\n    inputs: {\n        store: {\n            displayName: \"Do\",\n            group: \"Actions\",\n            valueChangedToTrue() {\n                // @ts-expect-error\n                this.scheduleStore();\n            },\n        },\n        email: {\n            displayName: \"Email\",\n            type: \"string\",\n            group: \"General\",\n            set(value) {\n                this._internal.email = value;\n            },\n        },\n        username: {\n            displayName: \"Username\",\n            type: \"string\",\n            group: \"General\",\n            set(value) {\n                this._internal.username = value;\n            },\n        },\n    },\n    methods: {\n        setError(err) {\n            this._internal.error = err;\n            this.flagOutputDirty(\"error\");\n            this.sendSignalOnOutput(\"failure\");\n            if (this.context.editorConnection) {\n                this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, \"user-set-warning\", {\n                    message: err,\n                    showGlobally: true,\n                });\n            }\n        },\n        clearWarnings() {\n            if (this.context.editorConnection) {\n                this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, \"user-set-warning\");\n            }\n        },\n        scheduleStore() {\n            const internal = this._internal;\n            // @ts-expect-error\n            if (this.storeScheduled === true)\n                return;\n            // @ts-expect-error\n            this.storeScheduled = true;\n            this.scheduleAfterInputsHaveUpdated(() => {\n                // @ts-expect-error\n                this.storeScheduled = false;\n                // @ts-expect-error\n                const UserService = NoodlRuntime.Services.UserService;\n                UserService.forScope(this.nodeScope.modelScope).setUserProperties({\n                    email: this._internal.email,\n                    username: this._internal.username,\n                    properties: internal.userProperties,\n                    success: () => {\n                        this.sendSignalOnOutput(\"success\");\n                    },\n                    error: (e) => {\n                        // @ts-expect-error\n                        this.setError(e);\n                    },\n                });\n            });\n        },\n        setUserProperty(name, value) {\n            this._internal.userProperties[name] = value;\n        },\n        registerInputIfNeeded(name) {\n            if (this.hasInput(name)) {\n                return;\n            }\n            if (name.startsWith(\"prop-\"))\n                return this.registerInput(name, {\n                    // @ts-expect-error\n                    set: this.setUserProperty.bind(this, name.substring(\"prop-\".length)),\n                });\n        },\n    },\n};\nfunction updatePorts$1(nodeId, parameters, editorConnection, systemCollections) {\n    const ports = [];\n    if (systemCollections) {\n        // Fetch ports from collection keys\n        const c = systemCollections.find((c) => c.name === \"_User\");\n        if (c && c.schema && c.schema.properties) {\n            const props = c.schema.properties;\n            const _ignoreKeys = \n            // @ts-expect-error\n            typeof _noodl_cloud_runtime_version === \"undefined\"\n                ? [\n                    \"authData\",\n                    \"createdAt\",\n                    \"updatedAt\",\n                    \"email\",\n                    \"username\",\n                    \"emailVerified\",\n                    \"password\",\n                ]\n                : [\"authData\", \"createdAt\", \"updatedAt\", \"email\", \"username\"];\n            for (const key in props) {\n                if (_ignoreKeys.indexOf(key) !== -1)\n                    continue;\n                const p = props[key];\n                if (ports.find((_p) => _p.name === key))\n                    continue;\n                if (p.type === \"Relation\") ;\n                else {\n                    // Other schema type ports\n                    const _typeMap = {\n                        String: \"string\",\n                        Boolean: \"boolean\",\n                        Number: \"number\",\n                        Date: \"date\",\n                    };\n                    ports.push({\n                        type: {\n                            name: _typeMap[p.type] ? _typeMap[p.type] : \"*\",\n                        },\n                        plug: \"input\",\n                        group: \"Properties\",\n                        name: \"prop-\" + key,\n                        displayName: key,\n                    });\n                }\n            }\n        }\n    }\n    editorConnection.sendDynamicPorts(nodeId, ports);\n}\nfunction setup$1(context, graphModel) {\n    if (!context.editorConnection ||\n        !context.editorConnection.isRunningLocally()) {\n        return;\n    }\n    function _managePortsForNode(node) {\n        updatePorts$1(node.id, node.parameters, context.editorConnection, graphModel.getMetaData(\"systemCollections\"));\n        node.on(\"parameterUpdated\", function (event) {\n            updatePorts$1(node.id, node.parameters, context.editorConnection, graphModel.getMetaData(\"systemCollections\"));\n        });\n        graphModel.on(\"metadataChanged.systemCollections\", function (data) {\n            updatePorts$1(node.id, node.parameters, context.editorConnection, data);\n        });\n    }\n    graphModel.on(\"editorImportComplete\", () => {\n        graphModel.on(\"nodeAdded.net.noodl.user.SetUserProperties\", function (node) {\n            _managePortsForNode(node);\n        });\n        for (const node of graphModel.getNodesWithType(\"net.noodl.user.SetUserProperties\")) {\n            _managePortsForNode(node);\n        }\n    });\n}\n\nvar setuserproperties = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node$1,\n    setup: setup$1\n});\n\nconst node = {\n    name: \"net.noodl.user.User\",\n    docs: \"https://docs.noodl.net/nodes/data/user/user-node\",\n    displayNodeName: \"User\",\n    category: \"Cloud Services\",\n    color: \"data\",\n    initialize() {\n        const _this = this;\n        this._internal.onModelChangedCallback = function (args) {\n            if (_this.isInputConnected(\"fetch\"))\n                return;\n            if (_this.hasOutput(\"prop-\" + args.name))\n                _this.flagOutputDirty(\"prop-\" + args.name);\n            if (_this.hasOutput(\"changed-\" + args.name))\n                _this.sendSignalOnOutput(\"changed-\" + args.name);\n            _this.sendSignalOnOutput(\"changed\");\n        };\n        // @ts-expect-error\n        const userService = NoodlRuntime.Services.UserService.forScope(\n        // @ts-expect-error\n        this.nodeScope.modelScope);\n        // @ts-expect-error\n        this.setUserModel(userService.current);\n        userService.on(\"loggedIn\", () => {\n            // @ts-expect-error\n            this.setUserModel(userService.current);\n            if (this.hasOutput(\"loggedIn\"))\n                this.sendSignalOnOutput(\"loggedIn\");\n        });\n        userService.on(\"sessionGained\", () => {\n            // @ts-expect-error\n            this.setUserModel(userService.current);\n        });\n        userService.on(\"loggedOut\", () => {\n            // @ts-expect-error\n            this.setUserModel(undefined);\n            if (this.hasOutput(\"loggedOut\"))\n                this.sendSignalOnOutput(\"loggedOut\");\n        });\n        userService.on(\"sessionLost\", () => {\n            // @ts-expect-error\n            this.setUserModel(undefined);\n            if (this.hasOutput(\"sessionLost\"))\n                this.sendSignalOnOutput(\"sessionLost\");\n        });\n    },\n    getInspectInfo() {\n        const model = this._internal.model;\n        if (!model)\n            return \"[No Model]\";\n        return [\n            { type: \"text\", value: \"Id: \" + model.getId() },\n            { type: \"value\", value: this._internal.model.data },\n        ];\n    },\n    outputs: {\n        id: {\n            type: \"string\",\n            displayName: \"Id\",\n            group: \"General\",\n            getter() {\n                return this._internal.model !== undefined\n                    ? this._internal.model.getId()\n                    : undefined;\n            },\n        },\n        fetched: {\n            type: \"signal\",\n            displayName: \"Fetched\",\n            group: \"Events\",\n        },\n        changed: {\n            type: \"signal\",\n            displayName: \"Changed\",\n            group: \"Events\",\n        },\n        failure: {\n            type: \"signal\",\n            displayName: \"Failure\",\n            group: \"Events\",\n        },\n        error: {\n            type: \"string\",\n            displayName: \"Error\",\n            group: \"Error\",\n            getter() {\n                return this._internal.error;\n            },\n        },\n        username: {\n            type: \"string\",\n            displayName: \"Username\",\n            group: \"General\",\n            getter() {\n                return this._internal.model !== undefined\n                    ? this._internal.model.get(\"username\")\n                    : undefined;\n            },\n        },\n        email: {\n            type: \"string\",\n            displayName: \"Email\",\n            group: \"General\",\n            getter() {\n                return this._internal.model !== undefined\n                    ? this._internal.model.get(\"email\")\n                    : undefined;\n            },\n        },\n        authenticated: {\n            type: \"boolean\",\n            displayName: \"Authenticated\",\n            group: \"General\",\n            getter() {\n                return this._internal.model !== undefined;\n            },\n        },\n    },\n    inputs: {\n        fetch: {\n            displayName: \"Fetch\",\n            group: \"Actions\",\n            valueChangedToTrue() {\n                // @ts-expect-error\n                this.scheduleFetch();\n            },\n        },\n    },\n    methods: {\n        _onNodeDeleted() {\n            Node.prototype._onNodeDeleted.call(this);\n            if (this._internal.model)\n                this._internal.model.off(\"change\", this._internal.onModelChangedCallback);\n        },\n        scheduleOnce(type, cb) {\n            const _this = this;\n            const _type = \"hasScheduled\" + type;\n            if (this._internal[_type])\n                return;\n            this._internal[_type] = true;\n            this.scheduleAfterInputsHaveUpdated(function () {\n                _this._internal[_type] = false;\n                cb();\n            });\n        },\n        setError(err) {\n            this._internal.error = err;\n            this.flagOutputDirty(\"error\");\n            this.sendSignalOnOutput(\"failure\");\n            if (this.context.editorConnection) {\n                this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, \"user-warning\", {\n                    message: err,\n                    showGlobally: true,\n                });\n            }\n        },\n        clearWarnings() {\n            if (this.context.editorConnection) {\n                this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, \"user-warning\");\n            }\n        },\n        setUserModel(model) {\n            const internal = this._internal;\n            if (internal.model !== model) {\n                // Check if we need to change model\n                if (internal.model)\n                    // Remove old listener if existing\n                    internal.model.off(\"change\", internal.onModelChangedCallback);\n                internal.model = model;\n                if (model)\n                    model.on(\"change\", internal.onModelChangedCallback);\n            }\n            this.flagOutputDirty(\"id\");\n            this.flagOutputDirty(\"authenticated\");\n            this.flagOutputDirty(\"email\");\n            this.flagOutputDirty(\"username\");\n            // Notify all properties changed\n            if (model)\n                for (const key in model.data) {\n                    if (this.hasOutput(\"prop-\" + key))\n                        this.flagOutputDirty(\"prop-\" + key);\n                }\n        },\n        scheduleFetch() {\n            this._internal;\n            // @ts-expect-error\n            this.scheduleOnce(\"Fetch\", () => {\n                // @ts-expect-error\n                const userService = NoodlRuntime.Services.UserService.forScope(this.nodeScope.modelScope);\n                userService.fetchCurrentUser({\n                    success: (response) => {\n                        // @ts-expect-error\n                        this.setUserModel(userService.current);\n                        this.sendSignalOnOutput(\"fetched\");\n                    },\n                    error: (err) => {\n                        // @ts-expect-error\n                        this.setError(err || \"Failed to fetch.\");\n                    },\n                });\n            });\n        },\n        registerOutputIfNeeded(name) {\n            if (this.hasOutput(name)) {\n                return;\n            }\n            if (name === \"loggedOut\" ||\n                name === \"loggedIn\" ||\n                name === \"sessionLost\") {\n                this.registerOutput(name, {\n                    getter: () => { } /* No getter needed, signal */,\n                });\n                return;\n            }\n            if (name.startsWith(\"prop-\"))\n                this.registerOutput(name, {\n                    // @ts-expect-error\n                    getter: this.getUserProperty.bind(this, name.substring(\"prop-\".length)),\n                });\n        },\n        getUserProperty(name) {\n            return this._internal.model !== undefined\n                ? this._internal.model.get(name)\n                : undefined;\n        },\n    },\n};\nfunction updatePorts(nodeId, parameters, editorConnection, systemCollections) {\n    const ports = [];\n    if (systemCollections) {\n        // Fetch ports from collection keys\n        const c = systemCollections.find((c) => c.name === \"_User\");\n        if (c && c.schema && c.schema.properties) {\n            const props = c.schema.properties;\n            const _ignoreKeys = [\"authData\", \"password\", \"username\", \"email\"];\n            for (const key in props) {\n                if (_ignoreKeys.indexOf(key) !== -1)\n                    continue;\n                const p = props[key];\n                if (ports.find((_p) => _p.name === key))\n                    continue;\n                if (p.type === \"Relation\") ;\n                else {\n                    // Other schema type ports\n                    const _typeMap = {\n                        String: \"string\",\n                        Boolean: \"boolean\",\n                        Number: \"number\",\n                        Date: \"date\",\n                    };\n                    ports.push({\n                        type: {\n                            name: _typeMap[p.type] ? _typeMap[p.type] : \"*\",\n                        },\n                        plug: \"output\",\n                        group: \"Properties\",\n                        name: \"prop-\" + key,\n                        displayName: key,\n                    });\n                    ports.push({\n                        type: \"signal\",\n                        plug: \"output\",\n                        group: \"Changed Events\",\n                        displayName: key + \" Changed\",\n                        name: \"changed-\" + key,\n                    });\n                }\n            }\n        }\n    }\n    // @ts-expect-error\n    if (typeof _noodl_cloud_runtime_version === \"undefined\") {\n        // On the client we have some extra outputs\n        ports.push({\n            plug: \"output\",\n            name: \"loggedIn\",\n            type: \"signal\",\n            displayName: \"Logged In\",\n            group: \"Events\",\n        });\n        ports.push({\n            plug: \"output\",\n            name: \"loggedOut\",\n            type: \"signal\",\n            displayName: \"Logged Out\",\n            group: \"Events\",\n        });\n        ports.push({\n            plug: \"output\",\n            name: \"sessionLost\",\n            type: \"signal\",\n            displayName: \"Session Lost\",\n            group: \"Events\",\n        });\n    }\n    editorConnection.sendDynamicPorts(nodeId, ports);\n}\nfunction setup(context, graphModel) {\n    if (!context.editorConnection ||\n        !context.editorConnection.isRunningLocally()) {\n        return;\n    }\n    function _managePortsForNode(node) {\n        updatePorts(node.id, node.parameters, context.editorConnection, graphModel.getMetaData(\"systemCollections\"));\n        node.on(\"parameterUpdated\", function (event) {\n            updatePorts(node.id, node.parameters, context.editorConnection, graphModel.getMetaData(\"systemCollections\"));\n        });\n        graphModel.on(\"metadataChanged.systemCollections\", function (data) {\n            updatePorts(node.id, node.parameters, context.editorConnection, data);\n        });\n    }\n    graphModel.on(\"editorImportComplete\", () => {\n        graphModel.on(\"nodeAdded.net.noodl.user.User\", function (node) {\n            _managePortsForNode(node);\n        });\n        for (const node of graphModel.getNodesWithType(\"net.noodl.user.User\")) {\n            _managePortsForNode(node);\n        }\n    });\n}\n\nvar user = /*#__PURE__*/Object.freeze({\n    __proto__: null,\n    node: node,\n    setup: setup\n});\n\nfunction registerNodes(noodlRuntime) {\n    [\n        componentinputs,\n        componentoutputs,\n        runtasks,\n        // Data\n        restnode,\n        // Custom code\n        expression,\n        simplejavascript,\n        // Records\n        dbcollectionnode2,\n        dbmodelnode2,\n        setdbmodelpropertiesnode,\n        deletedbmodelpropertiesnode,\n        newdbmodelpropertiesnode,\n        dbmodelnodeAddrelation,\n        dbmodelnodeRemoverelation,\n        filterdbmodelsnode,\n        // Object\n        modelnode2,\n        setmodelpropertiesnode,\n        newmodelnode,\n        // Cloud\n        cloudfilenode,\n        dbconfig,\n        // Variables\n        number,\n        string,\n        boolean,\n        // Utils\n        condition,\n        and$1,\n        or,\n        booleantostring,\n        datetostring,\n        stringmapper,\n        inverter,\n        substring,\n        stringformat,\n        counter,\n        uniqueid,\n        // User\n        setuserproperties,\n        user,\n        // @ts-expect-error\n    ].forEach((node) => noodlRuntime.registerNode(node));\n}\n\nlet NoodlRuntime$1 = class NoodlRuntime {\n    constructor(args) {\n        args.platform = args.platform || {};\n        NoodlRuntime.instance = this;\n        this.type = args.type || \"browser\";\n        this.noodlModules = [];\n        this.eventEmitter = new EventEmitter();\n        this.updateScheduled = false;\n        this.rootComponent = null;\n        this._currentLoadedData = null;\n        this.isWaitingForExport = true;\n        this.graphModel = new GraphModel();\n        this.errorHandlers = [];\n        this.frameNumber = 0;\n        this.dontCreateRootComponent = !!args.dontCreateRootComponent;\n        this.componentFilter = args.componentFilter;\n        this.runningInEditor = args.runDeployed ? false : true;\n        this.platform = {\n            requestUpdate: args.platform.requestUpdate,\n            getCurrentTime: args.platform.getCurrentTime,\n            webSocketOptions: args.platform.webSocketOptions,\n            objectToString: args.platform.objectToString,\n        };\n        if (!args.platform.requestUpdate) {\n            throw new Error(\"platform.requestUpdate must be set\");\n        }\n        if (!args.platform.getCurrentTime) {\n            throw new Error(\"platform.getCurrentTime must be set\");\n        }\n        this.editorConnection = new EditorConnection({\n            platform: args.platform,\n            runtimeType: this.type,\n        });\n        this.context = new NodeContext({\n            runningInEditor: args.runDeployed ? false : true,\n            editorConnection: this.editorConnection,\n            platform: this.platform,\n            graphModel: this.graphModel,\n        });\n        this.context.eventEmitter.on(\"scheduleUpdate\", this.scheduleUpdate.bind(this));\n        if (!args.runDeployed) {\n            this._setupEditorCommunication(args);\n        }\n        this.registerGraphModelListeners();\n        registerNodes(this);\n    }\n    async prefetchBundles(bundleNames, numParallelFetches) {\n        await asyncPool(numParallelFetches, bundleNames, async (name) => {\n            await this.context.fetchComponentBundle(name);\n        });\n    }\n    _setupEditorCommunication(args) {\n        function objectEquals(x, y) {\n            if (x === null || x === undefined || y === null || y === undefined) {\n                return x === y;\n            }\n            if (x === y) {\n                return true;\n            }\n            if (Array.isArray(x) && x.length !== y.length) {\n                return false;\n            }\n            if (!(x instanceof Object)) {\n                return false;\n            }\n            if (!(y instanceof Object)) {\n                return false;\n            }\n            const p = Object.keys(x);\n            return (Object.keys(y).every((i) => p.indexOf(i) !== -1) &&\n                p.every((i) => objectEquals(x[i], y[i])));\n        }\n        this.editorConnection.on(\"exportDataFull\", async (exportData) => {\n            if (this.graphModel.isEmpty() === false) {\n                this.reload();\n                return;\n            }\n            this.isWaitingForExport = false;\n            if (objectEquals(this._currentLoadedData, exportData) === false) {\n                if (this.componentFilter) {\n                    exportData.components = exportData.components.filter((c) => this.componentFilter(c));\n                }\n                await this.setData(exportData);\n                if (exportData.componentIndex) {\n                    const allBundles = Object.keys(exportData.componentIndex);\n                    await this.prefetchBundles(allBundles, 2);\n                }\n                this.graphModel.emit(\"editorImportComplete\");\n            }\n        });\n        this.editorConnection.on(\"reload\", this.reload.bind(this));\n        this.editorConnection.on(\"modelUpdate\", this.onModelUpdateReceived.bind(this));\n        this.editorConnection.on(\"metadataUpdate\", this.onMetaDataUpdateReceived.bind(this));\n        this.editorConnection.on(\"connected\", () => {\n            this.sendNodeLibrary();\n        });\n    }\n    setDebugInspectorsEnabled(enabled) {\n        this.context.setDebugInspectorsEnabled(enabled);\n    }\n    registerModule(module) {\n        if (module.nodes) {\n            for (let nodeDefinition of module.nodes) {\n                if (!nodeDefinition.node)\n                    nodeDefinition = { node: nodeDefinition };\n                nodeDefinition.node.module = module.name || \"Unknown Module\";\n                this.registerNode(nodeDefinition);\n            }\n        }\n        this.noodlModules.push(module);\n    }\n    registerGraphModelListeners() {\n        this.graphModel.on(\"componentAdded\", (component) => {\n            this.context.registerComponentModel(component);\n        }, this);\n        this.graphModel.on(\"componentRemoved\", (component) => {\n            this.context.deregisterComponentModel(component);\n        }, this);\n    }\n    reload() {\n        location.reload();\n    }\n    registerNode(nodeDefinition) {\n        if (nodeDefinition.node) {\n            const definedNode = defineNode(nodeDefinition.node);\n            this.context.nodeRegister.register(definedNode);\n            definedNode.setupNumberedInputDynamicPorts &&\n                definedNode.setupNumberedInputDynamicPorts(this.context, this.graphModel);\n        }\n        else {\n            // TODO: Should this just be nodeDefinition?\n            this.context.nodeRegister.register(nodeDefinition.node);\n        }\n        nodeDefinition.setup && nodeDefinition.setup(this.context, this.graphModel);\n    }\n    async _setRootComponent(rootComponentName) {\n        if (this.rootComponent && this.rootComponent.name === rootComponentName)\n            return;\n        if (this.rootComponent) {\n            this.rootComponent.model &&\n                this.rootComponent.model.removeListenersWithRef(this);\n            this.rootComponent = undefined;\n        }\n        if (rootComponentName) {\n            this.rootComponent = await this.context.createComponentInstanceNode(rootComponentName, \"rootComponent\", null);\n            this.rootComponent.componentModel.on(\"rootAdded\", () => this.eventEmitter.emit(\"rootComponentUpdated\"), this);\n            this.rootComponent.componentModel.on(\"rootRemoved\", () => this.eventEmitter.emit(\"rootComponentUpdated\"), this);\n            this.context.setRootComponent(this.rootComponent);\n        }\n        this.eventEmitter.emit(\"rootComponentUpdated\");\n    }\n    async setData(graphData) {\n        if (this._disableLoad)\n            return;\n        this._currentLoadedData = graphData;\n        await this.graphModel.importEditorData(graphData);\n        for (const module of this.noodlModules) {\n            typeof module.setup === \"function\" && module.setup();\n        }\n        if (this.dontCreateRootComponent !== true) {\n            await this._setRootComponent(this.graphModel.rootComponent || null);\n            this.graphModel.on(\"rootComponentNameUpdated\", (name) => {\n                this._setRootComponent(name);\n            });\n            this.graphModel.on(\"componentRemoved\", (componentModel) => {\n                if (this.rootComponent &&\n                    this.rootComponent.name === componentModel.name) {\n                    this._setRootComponent(null);\n                }\n            });\n            this.graphModel.on(\"componentAdded\", (componentModel) => {\n                setTimeout(() => {\n                    if (!this.rootComponent &&\n                        this.graphModel.rootComponent === componentModel.name) {\n                        this._setRootComponent(componentModel.name);\n                    }\n                }, 1);\n            });\n        }\n        this.scheduleUpdate();\n    }\n    scheduleUpdate() {\n        var _a, _b;\n        if (this.updateScheduled) {\n            return;\n        }\n        this.updateScheduled = true;\n        (_b = (_a = this.platform).requestUpdate) === null || _b === void 0 ? void 0 : _b.call(_a, this._doUpdate.bind(this));\n    }\n    _doUpdate() {\n        this.updateScheduled = false;\n        this.context.currentFrameTime = this.platform.getCurrentTime();\n        this.context.eventEmitter.emit(\"frameStart\");\n        this.context.update();\n        this.context.eventEmitter.emit(\"frameEnd\");\n        this.frameNumber++;\n    }\n    setProjectSettings(settings) {\n        this.projectSettings = settings;\n    }\n    getNodeLibrary() {\n        const projectSettings = generateProjectSettings(this.graphModel.getSettings(), this.noodlModules);\n        if (this.projectSettings) {\n            this.projectSettings.ports &&\n                (projectSettings.ports = projectSettings.ports.concat(this.projectSettings.ports));\n            this.projectSettings.dynamicports &&\n                (projectSettings.dynamicports = projectSettings.ports.concat(this.projectSettings.dynamicports));\n        }\n        const nodeLibrary = generateNodeLibrary(this.context.nodeRegister);\n        nodeLibrary.projectsettings = projectSettings;\n        return JSON.stringify(nodeLibrary, null, 3);\n    }\n    sendNodeLibrary() {\n        const nodeLibrary = this.getNodeLibrary();\n        if (this.lastSentNodeLibrary !== nodeLibrary) {\n            this.lastSentNodeLibrary = nodeLibrary;\n            this.editorConnection.sendNodeLibrary(nodeLibrary);\n        }\n    }\n    connectToEditor(address) {\n        this.editorConnection.connect(address);\n    }\n    onMetaDataUpdateReceived(event) {\n        if (!this.graphModel.isEmpty()) {\n            handleEvent(this.context, this.graphModel, event);\n        }\n    }\n    async onModelUpdateReceived(event) {\n        if (this.isWaitingForExport) {\n            return;\n        }\n        if (event.type === \"projectInstanceChanged\") {\n            this.reload();\n        }\n        else if (this.graphModel.isEmpty() === false) {\n            await handleEvent(this.context, this.graphModel, event);\n        }\n    }\n    addErrorHandler(callback) {\n        this.errorHandlers.push(callback);\n    }\n    reportError(message) {\n        this.errorHandlers.forEach((eh) => {\n            eh(message);\n        });\n    }\n    getProjectSettings() {\n        return this.graphModel.getSettings();\n    }\n    getMetaData(key) {\n        return this.graphModel.getMetaData(key);\n    }\n};\nNoodlRuntime$1.Services = Services;\nNoodlRuntime$1.Node = Node;\nNoodlRuntime$1.NodeDefinition = { defineNode };\nNoodlRuntime$1.EdgeTriggeredInput = createSetter;\n\nfunction createRecordsAPI(modelScope) {\n    let _cloudstore;\n    const cloudstore = () => {\n        // We must create the cloud store just in time so all meta data is loaded\n        if (!_cloudstore)\n            _cloudstore = new CloudStore(modelScope);\n        return _cloudstore;\n    };\n    return {\n        async query(className, query, options) {\n            if (typeof className === \"undefined\")\n                throw new Error(\"'className' is undefined\");\n            return new Promise((resolve, reject) => {\n                cloudstore().query({\n                    collection: className,\n                    where: convertFilterOp(query || {}, {\n                        collectionName: className,\n                        error: (e) => reject(e),\n                        modelScope,\n                    }),\n                    limit: options === null || options === void 0 ? void 0 : options.limit,\n                    sort: options === null || options === void 0 ? void 0 : options.sort,\n                    skip: options === null || options === void 0 ? void 0 : options.skip,\n                    include: options === null || options === void 0 ? void 0 : options.include,\n                    select: options === null || options === void 0 ? void 0 : options.select,\n                    count: options === null || options === void 0 ? void 0 : options.count,\n                    success: (results, count) => {\n                        const _results = results.map((r) => cloudstore()._fromJSON(r, className));\n                        if (count !== undefined)\n                            resolve({ results: _results, count });\n                        else\n                            resolve(_results);\n                    },\n                    error: (err) => {\n                        reject(Error(err || \"Failed to query.\"));\n                    },\n                });\n            });\n        },\n        async count(className, query) {\n            if (typeof className === \"undefined\")\n                throw new Error(\"'className' is undefined\");\n            return new Promise((resolve, reject) => {\n                cloudstore().count({\n                    collection: className,\n                    where: query\n                        ? convertFilterOp(query || {}, {\n                            collectionName: className,\n                            error: (e) => reject(e),\n                            modelScope,\n                        })\n                        : undefined,\n                    success: (count) => {\n                        resolve(count);\n                    },\n                    error: (err) => {\n                        reject(Error(err || \"Failed to query.\"));\n                    },\n                });\n            });\n        },\n        async distinct(className, property, query) {\n            if (typeof className === \"undefined\")\n                throw new Error(\"'className' is undefined\");\n            return new Promise((resolve, reject) => {\n                cloudstore().distinct({\n                    collection: className,\n                    property,\n                    where: query\n                        ? convertFilterOp(query || {}, {\n                            collectionName: className,\n                            error: (e) => reject(e),\n                            modelScope,\n                        })\n                        : undefined,\n                    success: (results) => {\n                        resolve(results);\n                    },\n                    error: (err) => {\n                        reject(Error(err || \"Failed to query.\"));\n                    },\n                });\n            });\n        },\n        async aggregate(className, group, query) {\n            if (typeof className === \"undefined\")\n                throw new Error(\"'className' is undefined\");\n            return new Promise((resolve, reject) => {\n                cloudstore().aggregate({\n                    collection: className,\n                    group,\n                    where: query\n                        ? convertFilterOp(query || {}, {\n                            collectionName: className,\n                            error: (e) => reject(e),\n                            modelScope,\n                        })\n                        : undefined,\n                    success: (results) => {\n                        resolve(results);\n                    },\n                    error: (err) => {\n                        reject(Error(err || \"Failed to aggregate.\"));\n                    },\n                });\n            });\n        },\n        async fetch(objectOrId, options) {\n            if (typeof objectOrId === \"undefined\")\n                return Promise.reject(new Error(\"'objectOrId' is undefined.\"));\n            const id = typeof objectOrId === \"string\" ? objectOrId : objectOrId.getId();\n            const className = (options === null || options === void 0 ? void 0 : options.className) || (modelScope || Model).get(id)._class;\n            return new Promise((resolve, reject) => {\n                if (!className) {\n                    return reject(\"No class name specified\");\n                }\n                cloudstore().fetch({\n                    collection: className,\n                    objectId: id,\n                    keys: options === null || options === void 0 ? void 0 : options.keys,\n                    include: options === null || options === void 0 ? void 0 : options.include,\n                    excludeKeys: options === null || options === void 0 ? void 0 : options.excludeKeys,\n                    success: function (response) {\n                        const record = cloudstore()._fromJSON(response, className);\n                        resolve(record);\n                    },\n                    error: function (err) {\n                        reject(Error(err || \"Failed to fetch.\"));\n                    },\n                });\n            });\n        },\n        async increment(objectOrId, properties, options) {\n            if (typeof objectOrId === \"undefined\")\n                return Promise.reject(new Error(\"'objectOrId' is undefined.\"));\n            const id = typeof objectOrId === \"string\" ? objectOrId : objectOrId.getId();\n            const className = (options === null || options === void 0 ? void 0 : options.className) || (modelScope || Model).get(id)._class;\n            return new Promise((resolve, reject) => {\n                if (!className)\n                    return reject(\"No class name specified\");\n                cloudstore().increment({\n                    collection: className,\n                    objectId: id,\n                    properties,\n                    success: (response) => {\n                        cloudstore()._fromJSON(Object.assign({ objectId: id }, response), className); // Update values\n                        resolve();\n                    },\n                    error: (err) => {\n                        reject(Error(err || \"Failed to increment.\"));\n                    },\n                });\n            });\n        },\n        async save(objectOrId, properties, options) {\n            if (typeof objectOrId === \"undefined\")\n                return Promise.reject(new Error(\"'objectOrId' is undefined.\"));\n            const id = typeof objectOrId === \"string\" ? objectOrId : objectOrId.getId();\n            const className = (options === null || options === void 0 ? void 0 : options.className) || (modelScope || Model).get(id)._class;\n            const model = (modelScope || Model).get(id);\n            if (properties) {\n                Object.keys(properties).forEach((p) => {\n                    model.set(p, properties[p]);\n                });\n            }\n            return new Promise((resolve, reject) => {\n                if (!className)\n                    return reject(\"No class name specified\");\n                cloudstore().save({\n                    collection: className,\n                    objectId: id,\n                    data: properties || model.data,\n                    acl: options === null || options === void 0 ? void 0 : options.acl,\n                    success: (response) => {\n                        cloudstore()._fromJSON(Object.assign({ objectId: id }, response), className); // Assign updated at\n                        resolve();\n                    },\n                    error: (err) => {\n                        reject(Error(err || \"Failed to save.\"));\n                    },\n                });\n            });\n        },\n        async create(className, properties, options) {\n            if (typeof className === \"undefined\")\n                throw new Error(\"'className' is undefined\");\n            return new Promise((resolve, reject) => {\n                cloudstore().create({\n                    collection: className,\n                    data: properties,\n                    acl: options === null || options === void 0 ? void 0 : options.acl,\n                    success: (data) => {\n                        // Successfully created\n                        const m = cloudstore()._fromJSON(data, className);\n                        resolve(m);\n                    },\n                    error: (err) => {\n                        reject(Error(err || \"Failed to insert.\"));\n                    },\n                });\n            });\n        },\n        async delete(objectOrId, options) {\n            if (typeof objectOrId === \"undefined\")\n                return Promise.reject(new Error(\"'objectOrId' is undefined.\"));\n            const id = typeof objectOrId === \"string\" ? objectOrId : objectOrId.getId();\n            const className = (options === null || options === void 0 ? void 0 : options.className) || (modelScope || Model).get(id)._class;\n            return new Promise((resolve, reject) => {\n                if (!className)\n                    return reject(\"No class name specified\");\n                cloudstore().delete({\n                    collection: className,\n                    objectId: id,\n                    success: () => {\n                        // @ts-expect-error\n                        (modelScope || Model).get(id).notify(\"delete\");\n                        resolve();\n                    },\n                    error: (err) => {\n                        reject(Error(err || \"Failed to delete.\"));\n                    },\n                });\n            });\n        },\n        async addRelation(options) {\n            var _a, _b;\n            const recordId = options.recordId || ((_a = options.record) === null || _a === void 0 ? void 0 : _a.getId());\n            const className = options.className || (modelScope || Model).get(recordId)._class;\n            const targetRecordId = options.targetRecordId || ((_b = options.targetRecord) === null || _b === void 0 ? void 0 : _b.getId());\n            const targetClassName = options.targetClassName ||\n                (modelScope || Model).get(targetRecordId)._class;\n            return new Promise((resolve, reject) => {\n                if (!className)\n                    return reject(\"No class name specified\");\n                if (!targetClassName)\n                    return reject(\"No target class name specified\");\n                cloudstore().addRelation({\n                    collection: className,\n                    objectId: recordId,\n                    key: options.key,\n                    targetObjectId: targetRecordId,\n                    targetClass: targetClassName,\n                    success: () => {\n                        resolve();\n                    },\n                    error: (err) => {\n                        reject(Error(err || \"Failed to add relation.\"));\n                    },\n                });\n            });\n        },\n        async removeRelation(options) {\n            var _a, _b;\n            const recordId = options.recordId || ((_a = options.record) === null || _a === void 0 ? void 0 : _a.getId());\n            const className = options.className || (modelScope || Model).get(recordId)._class;\n            const targetRecordId = options.targetRecordId || ((_b = options.targetRecord) === null || _b === void 0 ? void 0 : _b.getId());\n            const targetClassName = options.targetClassName ||\n                (modelScope || Model).get(targetRecordId)._class;\n            return new Promise((resolve, reject) => {\n                if (!className)\n                    return reject(\"No class name specified\");\n                if (!targetClassName)\n                    return reject(\"No target class name specified\");\n                cloudstore().removeRelation({\n                    collection: className,\n                    objectId: recordId,\n                    key: options.key,\n                    targetObjectId: targetRecordId,\n                    targetClass: targetClassName,\n                    success: () => {\n                        resolve();\n                    },\n                    error: (err) => {\n                        reject(Error(err || \"Failed to add relation.\"));\n                    },\n                });\n            });\n        },\n    };\n}\n\nexport { Collection, ComponentModel, EditorConnection, GraphModel, JavascriptNodeParser, Model, ModelScope, Node, NodeContext, NodeModel, NodeScope, Services, TimerScheduler, createRecordsAPI, createSetter, NoodlRuntime$1 as default, defineNode, extend, getAbsoluteUrl, guid, logJavaScriptNodeError, randomString };\n//# sourceMappingURL=noodl-runtime.esm.js.map\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\tid: moduleId,\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","__webpack_require__.nc = undefined;","import { EditorConnection } from \"@fluxscape/runtime\";\r\nimport { GraphModel } from \"@fluxscape/runtime\";\r\n\r\nexport default class GraphWarnings {\r\n  private graphModel: any;\r\n  private editorConnection: any;\r\n\r\n  constructor(graphModel: GraphModel, editorConnection: EditorConnection) {\r\n    this.graphModel = graphModel;\r\n    this.editorConnection = editorConnection;\r\n\r\n    this.graphModel\r\n      .getAllComponents()\r\n      .forEach((c: any) => this._bindComponentModel(c));\r\n    this.graphModel.on(\r\n      \"componentAdded\",\r\n      (c: any) => this._bindComponentModel(c),\r\n      this\r\n    );\r\n    this.graphModel.on(\r\n      \"componentRemoved\",\r\n      (c: any) => c.removeListenersWithRef(this),\r\n      this\r\n    );\r\n  }\r\n\r\n  private _bindComponentModel(c: any) {\r\n    c.on(\"rootAdded\", () => this._evaluateWarnings(c), this);\r\n    c.on(\r\n      \"rootRemoved\",\r\n      (root: any) => {\r\n        this.editorConnection.clearWarning(\r\n          c.name,\r\n          root,\r\n          \"multiple-visual-roots-warning\"\r\n        );\r\n        this._evaluateWarnings(c);\r\n      },\r\n      this\r\n    );\r\n    this._evaluateWarnings(c);\r\n  }\r\n\r\n  private _evaluateWarnings(c: any) {\r\n    const roots = c.getRoots();\r\n\r\n    if (roots.length === 0) return;\r\n\r\n    this.editorConnection.clearWarning(\r\n      c.name,\r\n      roots[0],\r\n      \"multiple-visual-roots-warning\"\r\n    );\r\n    for (let i = 1; i < roots.length; i++) {\r\n      this.editorConnection.sendWarning(\r\n        c.name,\r\n        roots[i],\r\n        \"multiple-visual-roots-warning\",\r\n        {\r\n          message:\r\n            \"This node is detached from the main node tree<br>and won't be rendered\",\r\n          level: \"info\",\r\n        }\r\n      );\r\n    }\r\n  }\r\n\r\n  dispose() {\r\n    this.graphModel.getAllComponents().forEach((c: any) => {\r\n      c.removeListenersWithRef(this);\r\n    });\r\n\r\n    this.graphModel.removeListenersWithRef(this);\r\n  }\r\n}\r\n","import NoodlRuntime from \"@fluxscape/runtime\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\nexport class Highlighter {\r\n  private highlightedNodes: Map<any, HTMLElement>;\r\n  private selectedNodes: Map<any, HTMLElement>;\r\n  private noodlRuntime: NoodlRuntime;\r\n  private isUpdatingHighlights: boolean;\r\n  private highlightRootDiv: HTMLDivElement;\r\n  private windowBorderDiv: HTMLDivElement;\r\n\r\n  constructor(noodlRuntime: NoodlRuntime) {\r\n    this.highlightedNodes = new Map();\r\n    this.selectedNodes = new Map();\r\n    this.noodlRuntime = noodlRuntime;\r\n\r\n    this.isUpdatingHighlights = false;\r\n\r\n    //create the div that holds the highlight and selection UI\r\n    const div = document.createElement(\"div\");\r\n    div.style.width = \"100%\";\r\n    div.style.height = \"100%\";\r\n    div.style.top = \"0\";\r\n    div.style.left = \"0\";\r\n    div.style.overflow = \"hidden\";\r\n    div.style.position = \"fixed\";\r\n    div.style.zIndex = \"1000000000\";\r\n    div.style.pointerEvents = \"none\";\r\n    document.body.appendChild(div);\r\n    this.highlightRootDiv = div;\r\n\r\n    this.windowBorderDiv = this.createHighlightDiv();\r\n    this.windowBorderDiv.style.position = \"absolute\";\r\n    this.windowBorderDiv.style.top = \"0\";\r\n    this.windowBorderDiv.style.left = \"0\";\r\n    this.windowBorderDiv.style.boxShadow = \"inset 0 0 0 3px #2CA7BA\";\r\n    this.windowBorderDiv.style.opacity = \"1.0\";\r\n    this.windowBorderDiv.style.width = \"100vw\";\r\n    this.windowBorderDiv.style.height = \"100vh\";\r\n  }\r\n\r\n  private createHighlightDiv(): HTMLDivElement {\r\n    const div = document.createElement(\"div\");\r\n    div.style.position = \"absolute\";\r\n    div.style.top = \"0\";\r\n    div.style.left = \"0\";\r\n    div.style.outline = \"2px solid #2CA7BA\";\r\n    div.style.opacity = \"1.0\";\r\n    return div;\r\n  }\r\n\r\n  setWindowSelected(enabled: boolean): void {\r\n    return; //disable this feature for now, needs some iteration\r\n\r\n    /*if (enabled) {\r\n      this.highlightRootDiv.appendChild(this.windowBorderDiv);\r\n    } else {\r\n      this.windowBorderDiv.parentNode && this.windowBorderDiv.parentNode.removeChild(this.windowBorderDiv);\r\n    }*/\r\n  }\r\n\r\n  updateHighlights(): void {\r\n    const items = Array.from(this.highlightedNodes.entries()).concat(\r\n      Array.from(this.selectedNodes.entries())\r\n    );\r\n\r\n    for (const item of items) {\r\n      const domNode =\r\n        item[0].getRef() && ReactDOM.findDOMNode(item[0].getRef());\r\n\r\n      if (!domNode) {\r\n        //user has deleted this node, just remove it\r\n        this.highlightedNodes.delete(item[0]);\r\n        item[1].remove();\r\n        continue;\r\n      }\r\n\r\n      const rect = domNode.getBoundingClientRect();\r\n      const highlight = item[1];\r\n\r\n      highlight.style.transform = `translateX(${rect.x}px) translateY(${rect.y}px)`;\r\n      highlight.style.width = rect.width + \"px\";\r\n      highlight.style.height = rect.height + \"px\";\r\n    }\r\n\r\n    this.isUpdatingHighlights =\r\n      this.highlightedNodes.size > 0 || this.selectedNodes.size > 0;\r\n\r\n    if (this.isUpdatingHighlights) {\r\n      requestAnimationFrame(this.updateHighlights.bind(this));\r\n    }\r\n  }\r\n\r\n  highlightNodesWithId(nodeId: string): void {\r\n    //gather all nodes with a DOM node we can highlight, that aren't already highlighted\r\n    const nodes = getNodes(this.noodlRuntime, nodeId)\r\n      .filter((node: any) => node.getRef)\r\n      .filter((node: any) => !this.highlightedNodes.has(node));\r\n\r\n    for (const node of nodes) {\r\n      const highlight = this.createHighlightDiv();\r\n\r\n      this.highlightRootDiv.appendChild(highlight);\r\n      this.highlightedNodes.set(node, highlight);\r\n    }\r\n\r\n    if (\r\n      (this.selectedNodes.size > 0 || this.highlightedNodes.size > 0) &&\r\n      !this.isUpdatingHighlights\r\n    ) {\r\n      this.updateHighlights();\r\n    }\r\n  }\r\n\r\n  disableHighlight(): void {\r\n    for (const item of this.highlightedNodes) {\r\n      const highlight = item[1];\r\n      if (highlight) {\r\n        highlight.remove();\r\n      }\r\n    }\r\n    this.highlightedNodes.clear();\r\n  }\r\n\r\n  selectNodesWithId(nodeId: string): any[] {\r\n    //we don't track when nodes are created, so if there's no root component, wait a while and then highlight so we can get all the instances\r\n    //TODO: track nodes as they're created so newly created nodes can be selected if their IDs match\r\n    if (!this.noodlRuntime.rootComponent) {\r\n      this.noodlRuntime.eventEmitter.once(\"rootComponentUpdated\", () => {\r\n        setTimeout(() => {\r\n          this.selectNodesWithId(nodeId);\r\n        }, 300);\r\n      });\r\n    }\r\n\r\n    const nodes = getNodes(this.noodlRuntime, nodeId)\r\n      .filter((node: any) => node.getRef)\r\n      .filter((node: any) => !this.selectedNodes.has(node));\r\n\r\n    for (const node of nodes) {\r\n      const selection = this.createHighlightDiv();\r\n\r\n      this.highlightRootDiv.appendChild(selection);\r\n      this.selectedNodes.set(node, selection);\r\n    }\r\n\r\n    if (this.selectedNodes.size > 0) {\r\n      this.setWindowSelected(false);\r\n    }\r\n\r\n    if (\r\n      (this.selectedNodes.size > 0 || this.highlightedNodes.size > 0) &&\r\n      !this.isUpdatingHighlights\r\n    ) {\r\n      this.updateHighlights();\r\n    }\r\n\r\n    return nodes;\r\n  }\r\n\r\n  deselectNodes(): void {\r\n    for (const item of this.selectedNodes) {\r\n      const selection = item[1];\r\n      if (selection) {\r\n        selection.remove();\r\n      }\r\n    }\r\n    this.selectedNodes.clear();\r\n  }\r\n}\r\n\r\nfunction getNodes(noodlRuntime: NoodlRuntime, nodeId: string): any[] {\r\n  if (!noodlRuntime.rootComponent) {\r\n    return [];\r\n  }\r\n  return noodlRuntime.rootComponent.nodeScope.getNodesWithIdRecursive(nodeId);\r\n}\r\n","export class Inspector {\r\n  private component?: any;\r\n  private onDisableHighlight: () => void;\r\n  private onMouseMove: (e: MouseEvent) => void;\r\n  private onClick: (e: MouseEvent) => void;\r\n  private onContextMenu: (e: MouseEvent) => void;\r\n  private onMouseOut: (e: MouseEvent) => void;\r\n  private blockEvent: (e: Event) => void;\r\n\r\n  constructor({\r\n    onInspect,\r\n    onHighlight,\r\n    onDisableHighlight,\r\n  }: {\r\n    onInspect: (ids: string[]) => void;\r\n    onHighlight: (id: string) => void;\r\n    onDisableHighlight: () => void;\r\n  }) {\r\n    this.onMouseMove = (e: MouseEvent) => {\r\n      onDisableHighlight();\r\n\r\n      const noodlNode = this.findNoodlNode(e.target as HTMLElement);\r\n      if (noodlNode) {\r\n        document.body.style.cursor = \"pointer\";\r\n        onHighlight(noodlNode.id);\r\n      } else {\r\n        document.body.style.cursor = \"initial\";\r\n      }\r\n\r\n      e.stopPropagation();\r\n    };\r\n\r\n    this.onClick = (e: MouseEvent) => {\r\n      onDisableHighlight();\r\n\r\n      const noodlNode = this.findNoodlNode(e.target as HTMLElement);\r\n      if (noodlNode) {\r\n        onInspect([noodlNode.id]);\r\n      }\r\n\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      //not sure how to stop React input elements from getting focus, so blurring the potential element that got focus on click\r\n      if (document.activeElement) {\r\n        (document.activeElement as HTMLElement).blur();\r\n      }\r\n    };\r\n\r\n    this.onContextMenu = (e: MouseEvent) => {\r\n      const nodeIds = document\r\n        .elementsFromPoint(e.clientX, e.clientY)\r\n        .map((dom) => this.findNoodlNode(dom as HTMLElement))\r\n        .filter((node) => !!node)\r\n        .map((node) => node.id);\r\n\r\n      if (nodeIds.length) {\r\n        onInspect(nodeIds);\r\n      }\r\n\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n\r\n      //not sure how to stop React input elements from getting focus, so blurring the potential element that got focus on click\r\n      if (document.activeElement) {\r\n        (document.activeElement as HTMLElement).blur();\r\n      }\r\n    };\r\n\r\n    this.onMouseOut = (e: MouseEvent) => {\r\n      onDisableHighlight();\r\n    };\r\n\r\n    this.blockEvent = (e: Event) => {\r\n      e.stopPropagation();\r\n    };\r\n\r\n    this.onDisableHighlight = onDisableHighlight;\r\n  }\r\n\r\n  setComponent(component: any) {\r\n    this.component = component;\r\n  }\r\n\r\n  enable() {\r\n    //blur active element, if any\r\n    if (document.activeElement) {\r\n      (document.activeElement as HTMLElement).blur();\r\n    }\r\n\r\n    //get events from capture phase, before they tunnel down the tree\r\n    document.addEventListener(\"mouseenter\", this.blockEvent, true);\r\n    document.addEventListener(\"mouseover\", this.blockEvent, true);\r\n    document.addEventListener(\"mousedown\", this.blockEvent, true);\r\n    document.addEventListener(\"mouseup\", this.blockEvent, true);\r\n    document.addEventListener(\"mousemove\", this.onMouseMove, true);\r\n    document.addEventListener(\"mouseout\", this.onMouseOut, true);\r\n    document.addEventListener(\"click\", this.onClick, true);\r\n    document.addEventListener(\"contextmenu\", this.onContextMenu, true);\r\n  }\r\n\r\n  disable() {\r\n    document.body.style.cursor = \"initial\";\r\n\r\n    document.removeEventListener(\"mouseenter\", this.blockEvent, true);\r\n    document.removeEventListener(\"mouseover\", this.blockEvent, true);\r\n    document.removeEventListener(\"mousedown\", this.blockEvent, true);\r\n    document.removeEventListener(\"mouseup\", this.blockEvent, true);\r\n    document.removeEventListener(\"mousemove\", this.onMouseMove, true);\r\n    document.removeEventListener(\"mouseout\", this.onMouseOut, true);\r\n    document.removeEventListener(\"click\", this.onClick, true);\r\n    document.removeEventListener(\"contextmenu\", this.onContextMenu, true);\r\n\r\n    this.onDisableHighlight();\r\n  }\r\n\r\n  findNoodlNode(dom: HTMLElement | null): any {\r\n    //walk the dom tree upwards until a dom element with react state is found\r\n    let domFiber: any;\r\n    while (!domFiber && dom) {\r\n      const key = Object.keys(dom).find((key) =>\r\n        key.startsWith(\"__reactInternalInstance$\")\r\n      );\r\n      domFiber = key ? dom[key] : null;\r\n      if (!domFiber) {\r\n        dom = dom.parentElement;\r\n      }\r\n    }\r\n\r\n    //found none\r\n    if (!domFiber) {\r\n      return undefined;\r\n    }\r\n\r\n    const GetCompFiber = (fiber: any) => {\r\n      let parentFiber = fiber.return;\r\n      while (parentFiber && typeof parentFiber.type === \"string\") {\r\n        parentFiber = parentFiber.return;\r\n      }\r\n      return parentFiber;\r\n    };\r\n\r\n    //found a react node, now walk the react tree until a noodl node is found\r\n    //(identified by having a noodlNode prop)\r\n    let compFiber = GetCompFiber(domFiber);\r\n    while (\r\n      compFiber &&\r\n      (!compFiber.stateNode ||\r\n        !compFiber.stateNode.props ||\r\n        !compFiber.stateNode.props.noodlNode)\r\n    ) {\r\n      compFiber = GetCompFiber(compFiber);\r\n    }\r\n\r\n    const noodlNode = compFiber\r\n      ? compFiber.stateNode.props.noodlNode\r\n      : undefined;\r\n    if (!noodlNode) return;\r\n\r\n    if (this.component) {\r\n      let node = noodlNode;\r\n\r\n      while (node) {\r\n        if (node.parentNodeScope) {\r\n          if (\r\n            node.parentNodeScope.componentOwner.name === this.component.name\r\n          ) {\r\n            return node;\r\n          }\r\n          node = node.parentNodeScope.componentOwner;\r\n        } else {\r\n          if (node.nodeScope.componentOwner.name === this.component.name) {\r\n            return node;\r\n          }\r\n          node = node.nodeScope.componentOwner;\r\n        }\r\n      }\r\n\r\n      return node;\r\n    }\r\n\r\n    return noodlNode;\r\n  }\r\n}\r\n","const IS_BROWSER = typeof document !== \"undefined\";\r\n\r\nexport class SeoApi {\r\n  private _title = \"\";\r\n  private _meta: Record<string, string> = {};\r\n\r\n  /** Returns the current document title. */\r\n  get title(): string {\r\n    return IS_BROWSER ? document.title : this._title;\r\n  }\r\n\r\n  /** Set the document title. */\r\n  setTitle(value: string) {\r\n    this._title = value;\r\n\r\n    if (IS_BROWSER) {\r\n      document.title = value;\r\n    }\r\n  }\r\n\r\n  /** Returns all the current meta-tags  */\r\n  get meta(): Readonly<SeoApi[\"_meta\"]> {\r\n    return this._meta;\r\n  }\r\n\r\n  /** Clear all the meta-tags. */\r\n  clearMeta(): void {\r\n    if (IS_BROWSER) {\r\n      // Remove all the meta-tags, technically this is useless when running client-side.\r\n      Object.keys(this._meta).forEach((key) => {\r\n        const metaTag = document.querySelector(`meta[name=\"${key}\"]`);\r\n        if (metaTag) {\r\n          metaTag.remove();\r\n        }\r\n      });\r\n    }\r\n\r\n    this._meta = {};\r\n  }\r\n\r\n  /** Returns a specific meta-tag by name. */\r\n  getMeta(key: string) {\r\n    // NOTE: We are not querying if the meta-tag exist, maybe something we would like to do?\r\n    return this._meta[key];\r\n  }\r\n\r\n  /**\r\n   * Set a meta-tag.\r\n   *\r\n   * @param key The 'name' and/or the 'property' key used for the meta-tags.\r\n   * @param value The meta-tag content; if undefined, the meta-tag is removed.\r\n   */\r\n  setMeta(key: string, value: string | undefined): void {\r\n    // @ts-expect-error\r\n    this._meta[key] = value;\r\n\r\n    if (IS_BROWSER) {\r\n      const metaTag = document.querySelector(`meta[name=\"${key}\"]`);\r\n      if (metaTag) {\r\n        if (!value) {\r\n          metaTag.remove();\r\n        } else {\r\n          metaTag.setAttribute(\"content\", value);\r\n        }\r\n      } else if (value) {\r\n        const newMetaTag = document.createElement(\"meta\");\r\n        newMetaTag.setAttribute(\"name\", key);\r\n        newMetaTag.setAttribute(\"property\", key);\r\n        newMetaTag.setAttribute(\"content\", value);\r\n        document.head.appendChild(newMetaTag);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import NoodlRuntime from \"@fluxscape/runtime/src/runtime\";\r\nimport { RouterHandler } from \"../nodes/navigation/router-handler\";\r\n\r\ninterface ShowPopupOptions {\r\n  onClosePopup: (action: string | undefined, results: any) => void;\r\n}\r\n\r\ninterface NavigateOptions {\r\n  query?: Record<string, string>;\r\n}\r\n\r\ninterface Navigation {\r\n  _noodlRuntime: NoodlRuntime | undefined;\r\n  showPopup(\r\n    componentPath: string,\r\n    params: any\r\n  ): Promise<{ action: string | undefined; parameters: any }>;\r\n  navigate(routerName: string, targetPageName: string, params: any): void;\r\n  navigateToPath(path: string, options?: NavigateOptions): void;\r\n}\r\n\r\nconst navigation: Navigation = {\r\n  /**\r\n   * This is set by \"packages/noodl-viewer-react/src/noodl-js-api.js\"\r\n   */\r\n  _noodlRuntime: undefined,\r\n\r\n  async showPopup(\r\n    componentPath: string,\r\n    params: any\r\n  ): Promise<{ action: string | undefined; parameters: any }> {\r\n    return new Promise<{ action: string | undefined; parameters: any }>(\r\n      (resolve) => {\r\n        navigation._noodlRuntime!.context.showPopup(componentPath, params, {\r\n          onClosePopup: (action, results) => {\r\n            resolve({\r\n              action: action?.replace(\"closeAction-\", \"\"),\r\n              parameters: results,\r\n            });\r\n          },\r\n        });\r\n      }\r\n    );\r\n  },\r\n\r\n  navigate(routerName: string, targetPageName: string, params: any): void {\r\n    RouterHandler.instance.navigate(routerName, {\r\n      target: targetPageName,\r\n      params: params,\r\n    });\r\n  },\r\n\r\n  navigateToPath(path: string, options?: NavigateOptions): void {\r\n    let hashPath: string | undefined, urlPath: string | undefined;\r\n    const navigationPathType =\r\n      NoodlRuntime.instance.getProjectSettings()[\"navigationPathType\"];\r\n    if (navigationPathType === undefined || navigationPathType === \"hash\") {\r\n      hashPath = path;\r\n    } else {\r\n      urlPath = path;\r\n    }\r\n\r\n    const query: string[] = [];\r\n    if (options && options.query !== undefined) {\r\n      for (const key in options.query) {\r\n        query.push(`${key}=${options.query[key]}`);\r\n      }\r\n    }\r\n\r\n    const compiledUrl =\r\n      (urlPath !== undefined ? urlPath : \"\") +\r\n      (query.length >= 1 ? \"?\" + query.join(\"&\") : \"\") +\r\n      (hashPath !== undefined ? \"#\" + hashPath : \"\");\r\n\r\n    window.history.pushState({}, \"\", compiledUrl);\r\n    dispatchEvent(new PopStateEvent(\"popstate\", {}));\r\n  },\r\n};\r\n\r\nexport default navigation;\r\n","import { CloudStore } from \"@fluxscape/runtime/src/api/cloudstore\";\r\nimport { CloudFile } from \"@fluxscape/runtime/src/api/cloudfile\";\r\n\r\ninterface UploadOptions {\r\n  onProgress?: (progress: number) => void;\r\n}\r\n\r\nconst files = {\r\n  async upload(file: File, options?: UploadOptions): Promise<CloudFile> {\r\n    return new Promise((resolve, reject) => {\r\n      CloudStore.instance.uploadFile({\r\n        file,\r\n        // @ts-expect-error process is not typed\r\n        onUploadProgress: (p: number) => {\r\n          options?.onProgress?.(p);\r\n        },\r\n        success: (response: any) => {\r\n          resolve(new CloudFile(response));\r\n        },\r\n        error: (e: any) => {\r\n          reject(e);\r\n        },\r\n      });\r\n    });\r\n  },\r\n};\r\n\r\nexport default files;\r\n","export default {\r\n  ports: [\r\n    {\r\n      name: \"htmlTitle\",\r\n      displayName: \"Title\",\r\n      group: \"General\",\r\n      plug: \"input\",\r\n      type: \"string\",\r\n      default: \"Fluxscape Viewer\",\r\n      tooltip: \"The title that web browsers show\",\r\n      ignoreInExport: true,\r\n    },\r\n    {\r\n      name: \"headCode\",\r\n      displayName: \"Head Code\",\r\n      group: \"Custom Code\",\r\n      plug: \"input\",\r\n      type: {\r\n        name: \"string\",\r\n        codeeditor: \"html\",\r\n      },\r\n      tooltip: \"Add custom code to the &lt;head&gt; tag\",\r\n      ignoreInExport: true,\r\n    },\r\n    {\r\n      name: \"navigationPathType\",\r\n      displayName: \"URL Path Type\",\r\n      group: \"Navigation\",\r\n      plug: \"input\",\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"Hash\", value: \"hash\" },\r\n          { label: \"Path\", value: \"path\" },\r\n        ],\r\n      },\r\n      default: \"hash\",\r\n    },\r\n    {\r\n      name: \"bodyScroll\",\r\n      displayName: \"Body Scroll\",\r\n      group: \"Experimental features\",\r\n      plug: \"input\",\r\n      type: {\r\n        name: \"boolean\",\r\n      },\r\n      tooltip: \"Changes so the &lt;body&gt; tag will scroll by default\",\r\n    },\r\n    {\r\n      name: \"repeaterDisabledWhenUnmounted\",\r\n      displayName: \"Disable when unmounted\",\r\n      group: \"Experimental features - Repeater\",\r\n      plug: \"input\",\r\n      type: {\r\n        name: \"boolean\",\r\n      },\r\n      tooltip: \"Repeater will only create components when it's mounted\",\r\n    },\r\n    {\r\n      name: \"repeaterCreateComponentsAsync\",\r\n      displayName: \"Create asynchronously\",\r\n      group: \"Experimental features - Repeater\",\r\n      plug: \"input\",\r\n      type: {\r\n        name: \"boolean\",\r\n      },\r\n      tooltip: \"Repeater items will be created in chunks to keep UI responsive\",\r\n    },\r\n  ],\r\n};\r\n","export class DOMBoundingBoxObserver {\r\n  private isRunning: boolean;\r\n  private numBoundingBoxObservers: number;\r\n  private callback: (type: string, boundingBox: DOMRect) => void;\r\n  private pollDelay?: number;\r\n  private target?: HTMLElement;\r\n\r\n  constructor(\r\n    callback: (type: string, boundingBox: DOMRect) => void,\r\n    pollDelay?: number\r\n  ) {\r\n    this.isRunning = false;\r\n    this.numBoundingBoxObservers = 0;\r\n    this.callback = callback;\r\n    this.pollDelay = pollDelay;\r\n  }\r\n\r\n  addObserver() {\r\n    this.numBoundingBoxObservers++;\r\n\r\n    if (!this.isRunning) {\r\n      this._startObserver();\r\n    }\r\n  }\r\n\r\n  removeObserver() {\r\n    this.numBoundingBoxObservers--;\r\n    if (this.numBoundingBoxObservers === 0) {\r\n      this._stopObserver();\r\n    }\r\n  }\r\n\r\n  setTarget(target: HTMLElement) {\r\n    this.target = target;\r\n    if (this.numBoundingBoxObservers > 0 && !this.isRunning) {\r\n      this._startObserver();\r\n    }\r\n  }\r\n\r\n  private _startObserver() {\r\n    if (this.isRunning) return;\r\n    if (!this.target) return;\r\n\r\n    this.isRunning = true;\r\n\r\n    let boundingRect: DOMRect = this.target.getBoundingClientRect();\r\n    const observer = () => {\r\n      if (!this.target) {\r\n        this.isRunning = false;\r\n        return;\r\n      }\r\n\r\n      const bb = this.target.getBoundingClientRect();\r\n      if (boundingRect.x !== bb.x) {\r\n        this.callback(\"x\", bb);\r\n      }\r\n      if (boundingRect.y !== bb.y) {\r\n        this.callback(\"y\", bb);\r\n      }\r\n      if (boundingRect.width !== bb.width) {\r\n        this.callback(\"width\", bb);\r\n      }\r\n      if (boundingRect.height !== bb.height) {\r\n        this.callback(\"height\", bb);\r\n      }\r\n      boundingRect = bb;\r\n\r\n      if (this.isRunning) {\r\n        if (this.pollDelay) {\r\n          setTimeout(observer, this.pollDelay);\r\n        } else {\r\n          //poll as quickly as possible\r\n          window.requestAnimationFrame(observer);\r\n        }\r\n      }\r\n    };\r\n\r\n    window.requestAnimationFrame(observer);\r\n  }\r\n\r\n  private _stopObserver() {\r\n    this.isRunning = false;\r\n  }\r\n}\r\n","function isPercentage(size) {\r\n  return size && size[size.length - 1] === \"%\";\r\n}\r\n\r\nfunction getPercentage(size) {\r\n  return Number(size.slice(0, -1));\r\n}\r\n\r\nfunction getSizeWithMargins(size, startMargin, endMargin) {\r\n  if (!startMargin && !endMargin) {\r\n    return size;\r\n  }\r\n\r\n  let css = `calc(${size}`;\r\n  if (startMargin) {\r\n    css += ` - ${startMargin}`;\r\n  }\r\n  if (endMargin) {\r\n    css += ` - ${endMargin}`;\r\n  }\r\n  css += \")\";\r\n\r\n  return css;\r\n}\r\n\r\nexport default {\r\n  size(style, props) {\r\n    if (props.parentLayout === \"none\") {\r\n      style.position = \"absolute\";\r\n    }\r\n\r\n    if (props.sizeMode === \"explicit\") {\r\n      style.width = props.width;\r\n      style.height = props.height;\r\n    } else if (props.sizeMode === \"contentHeight\") {\r\n      style.width = props.width;\r\n    } else if (props.sizeMode === \"contentWidth\") {\r\n      style.height = props.height;\r\n    }\r\n\r\n    style.flexShrink = 0;\r\n\r\n    if (props.parentLayout === \"row\" && style.position === \"relative\") {\r\n      if (isPercentage(style.width) && !props.fixedWidth) {\r\n        style.flexGrow = getPercentage(style.width);\r\n        style.flexShrink = 1;\r\n      }\r\n\r\n      if (isPercentage(style.height) && !props.fixedHeight) {\r\n        style.height = getSizeWithMargins(\r\n          style.height,\r\n          style.marginTop,\r\n          style.marginBottom\r\n        );\r\n      }\r\n    } else if (\r\n      props.parentLayout === \"column\" &&\r\n      style.position === \"relative\"\r\n    ) {\r\n      if (isPercentage(style.width) && !props.fixedWidth) {\r\n        style.width = getSizeWithMargins(\r\n          style.width,\r\n          style.marginLeft,\r\n          style.marginRight\r\n        );\r\n      }\r\n\r\n      if (isPercentage(style.height) && !props.fixedHeight) {\r\n        style.flexGrow = getPercentage(style.height);\r\n        style.flexShrink = 1;\r\n      }\r\n    } else if (style.position !== \"relative\") {\r\n      if (isPercentage(style.width)) {\r\n        style.width = getSizeWithMargins(\r\n          style.width,\r\n          style.marginLeft,\r\n          style.marginRight\r\n        );\r\n      }\r\n      if (isPercentage(style.height)) {\r\n        style.height = getSizeWithMargins(\r\n          style.height,\r\n          style.marginTop,\r\n          style.marginBottom\r\n        );\r\n      }\r\n    }\r\n  },\r\n  align(style, props) {\r\n    const { position } = style;\r\n    let { alignX, alignY } = props;\r\n\r\n    //Elements with position absolute get's a default alignment.\r\n    //This keeps backward compability, and makes sense for most use cases of\r\n    //absolutely positioned elements\r\n    if (position !== \"relative\") {\r\n      alignX = alignX || \"left\";\r\n      alignY = alignY || \"top\";\r\n    }\r\n\r\n    let transform = \"\";\r\n\r\n    const parentFlexDirection = props.parentLayout || \"column\";\r\n    if (alignX) {\r\n      if (position !== \"relative\") {\r\n        if (alignX === \"left\") {\r\n          style.left = 0;\r\n        } else if (alignX === \"center\") {\r\n          style.left = \"50%\";\r\n          transform += \"translateX(-50%) \";\r\n        } else {\r\n          style.right = 0;\r\n        }\r\n      } else if (position === \"relative\" && parentFlexDirection === \"row\") {\r\n        switch (alignX) {\r\n          case \"left\":\r\n            style.marginRight = style.marginRight ? style.marginRight : \"auto\";\r\n            break;\r\n          case \"center\":\r\n            style.marginRight = style.marginRight ? style.marginRight : \"auto\";\r\n            style.marginLeft = style.marginLeft ? style.marginLeft : \"auto\";\r\n            break;\r\n          case \"right\":\r\n            style.marginLeft = style.marginLeft ? style.marginLeft : \"auto\";\r\n            break;\r\n        }\r\n      } else if (position === \"relative\" && parentFlexDirection === \"column\") {\r\n        switch (alignX) {\r\n          case \"left\":\r\n            style.alignSelf = \"flex-start\";\r\n            break;\r\n          case \"center\":\r\n            style.alignSelf = \"center\";\r\n            break;\r\n          case \"right\":\r\n            style.alignSelf = \"flex-end\";\r\n            break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (alignY) {\r\n      if (position !== \"relative\") {\r\n        if (alignY === \"top\") {\r\n          style.top = 0;\r\n        } else if (alignY === \"center\") {\r\n          style.top = \"50%\";\r\n          transform += \"translateY(-50%)\";\r\n        } else {\r\n          style.bottom = 0;\r\n        }\r\n      } else if (position === \"relative\" && parentFlexDirection === \"column\") {\r\n        switch (alignY) {\r\n          case \"top\":\r\n            style.marginBottom = style.marginBottom\r\n              ? style.marginBottom\r\n              : \"auto\";\r\n            break;\r\n          case \"center\":\r\n            style.marginTop = style.marginTop ? style.marginTop : \"auto\";\r\n            style.marginBottom = style.marginBottom\r\n              ? style.marginBottom\r\n              : \"auto\";\r\n            break;\r\n          case \"bottom\":\r\n            style.marginTop = style.marginTop ? style.marginTop : \"auto\";\r\n            break;\r\n        }\r\n      } else if (position === \"relative\" && parentFlexDirection === \"row\") {\r\n        switch (alignY) {\r\n          case \"top\":\r\n            style.alignSelf = \"flex-start\";\r\n            break;\r\n          case \"center\":\r\n            style.alignSelf = \"center\";\r\n            break;\r\n          case \"bottom\":\r\n            style.alignSelf = \"flex-end\";\r\n            break;\r\n        }\r\n      }\r\n    }\r\n\r\n    if (transform) {\r\n      style.transform = transform + (style.transform || \"\");\r\n    }\r\n  },\r\n};\r\n","function isObject(item: any): item is Record<string, any> {\r\n  return item && typeof item === \"object\" && !Array.isArray(item);\r\n}\r\n\r\nexport default function mergeDeep(\r\n  target: Record<string, any>,\r\n  ...sources: Array<Record<string, any>>\r\n): Record<string, any> {\r\n  if (!sources.length) return target;\r\n  const source = sources.shift();\r\n\r\n  if (isObject(target) && isObject(source)) {\r\n    for (const key in source) {\r\n      if (isObject(source[key])) {\r\n        if (!target[key]) Object.assign(target, { [key]: {} });\r\n        mergeDeep(target[key], source[key]);\r\n      } else {\r\n        Object.assign(target, { [key]: source[key] });\r\n      }\r\n    }\r\n  }\r\n\r\n  return mergeDeep(target, ...sources);\r\n}\r\n","import { getAbsoluteUrl } from \"@fluxscape/runtime\";\r\n\r\nexport class FontLoader {\r\n  static instance = new FontLoader();\r\n\r\n  loadedFontFamilies: { [key: string]: boolean };\r\n  fontCssFamiliesAdded: { [key: string]: boolean };\r\n  fontCallbacks: { [key: string]: Function[] };\r\n\r\n  constructor() {\r\n    this.loadedFontFamilies = {};\r\n    this.fontCssFamiliesAdded = {};\r\n    this.fontCallbacks = {};\r\n\r\n    const defaultFonts = [\r\n      \"Arial\",\r\n      \"Arial Black\",\r\n      \"Courier New\",\r\n      \"Helvetica\",\r\n      \"Impact\",\r\n      \"Lucida Console\",\r\n      \"Tahoma\",\r\n      \"Times New Roman\",\r\n    ];\r\n\r\n    defaultFonts.forEach((fontFamily) => {\r\n      this.loadedFontFamilies[fontFamily] = true;\r\n    });\r\n  }\r\n\r\n  private removeFileEnding(url: string): string {\r\n    return url.replace(/\\.[^/.]+$/, \"\");\r\n  }\r\n\r\n  loadFont(fontURL: string): void {\r\n    // Support SSR\r\n    if (typeof document === \"undefined\") return;\r\n\r\n    fontURL = getAbsoluteUrl(fontURL);\r\n\r\n    // get file name without path and file ending\r\n    const family = this.removeFileEnding(fontURL).split(\"/\").pop()!;\r\n\r\n    // check if it's already loaded\r\n    if (this.loadedFontFamilies[family]) {\r\n      this.fontCallbacks[family]?.forEach((callback) => {\r\n        callback();\r\n      });\r\n      return;\r\n    }\r\n\r\n    // check if font is already being loaded, we're just waiting for the callback\r\n    if (this.fontCssFamiliesAdded[family]) {\r\n      return;\r\n    }\r\n\r\n    this.fontCssFamiliesAdded[family] = true;\r\n\r\n    const newStyle = document.createElement(\"style\");\r\n    newStyle.type = \"text/css\";\r\n\r\n    // @ts-expect-error\r\n    const baseUrl = Noodl.Env[\"BaseUrl\"] || \"/\";\r\n\r\n    if (fontURL.startsWith(\"/\")) {\r\n      fontURL = fontURL.substring(1);\r\n    }\r\n\r\n    newStyle.appendChild(\r\n      document.createTextNode(\r\n        `@font-face { font-family: '${family}'; src: url('${baseUrl}${fontURL}'); }\\n`\r\n      )\r\n    );\r\n    document.head.appendChild(newStyle);\r\n\r\n    // Support SSR\r\n    if (typeof window !== \"undefined\") {\r\n      const WebFontLoader = require(\"webfontloader\");\r\n      WebFontLoader.load({\r\n        timeout: 1000 * 600, // 10 minutes in case the bandwidth is reeeeeeally low\r\n        custom: {\r\n          families: [family],\r\n        },\r\n        fontactive: (loadedFamily) => {\r\n          this.loadedFontFamilies[loadedFamily] = true;\r\n          this.fontCallbacks[loadedFamily]?.forEach((callback) => {\r\n            callback();\r\n          });\r\n        },\r\n      });\r\n    }\r\n  }\r\n\r\n  callWhenFontIsActive(family: string, callback: Function): void {\r\n    if (this.loadedFontFamilies[family]) {\r\n      callback();\r\n      return;\r\n    }\r\n\r\n    if (!this.fontCallbacks[family]) {\r\n      this.fontCallbacks[family] = [];\r\n    }\r\n    this.fontCallbacks[family].push(callback);\r\n  }\r\n}\r\n","export function createTooltip({\r\n  title,\r\n  body,\r\n  images,\r\n}: {\r\n  title: string;\r\n  body?: string | string[];\r\n  images?: { src: string; label?: string; body?: string }[];\r\n}): string {\r\n  let html = `<h3>${title}</h3>`;\r\n  if (body) {\r\n    body = Array.isArray(body) ? body : [body];\r\n\r\n    html += body.map((text) => `<p>${text}</p>`).join(\"\");\r\n  }\r\n\r\n  if (images) {\r\n    let imgHtml = \"\";\r\n\r\n    images.forEach((e) => {\r\n      imgHtml += `<div class=\"popup-layer-image-item\">`;\r\n      imgHtml += `<img src=\"../assets/images/tooltips/${e.src}\">`;\r\n      if (e.label) {\r\n        imgHtml += `<h3>${e.label}</h3>`;\r\n      }\r\n      if (e.body) {\r\n        imgHtml += `<p>${e.body}</p>`;\r\n      }\r\n      imgHtml += `</div>`;\r\n    });\r\n\r\n    html += `<div class=\"popup-layer-image-row\">${imgHtml}</div>`;\r\n  }\r\n\r\n  return html;\r\n}\r\n","import { getAbsoluteUrl } from \"@fluxscape/runtime\";\r\n\r\nimport { FontLoader } from \"./fontloader\";\r\nimport { createTooltip } from \"./tooltips\";\r\n\r\nfunction addInputCss(definition, inputs) {\r\n  if (!definition.inputCss) {\r\n    definition.inputCss = {};\r\n  }\r\n\r\n  if (!definition.defaultCss) {\r\n    definition.defaultCss = {};\r\n  }\r\n\r\n  for (const name in inputs) {\r\n    definition.inputCss[name] = inputs[name];\r\n  }\r\n}\r\n\r\nfunction mergeAttribute(definition, attribute, values) {\r\n  if (!definition[attribute]) {\r\n    definition[attribute] = {};\r\n  }\r\n\r\n  for (const name in values) {\r\n    definition[attribute][name] = values[name];\r\n  }\r\n}\r\n\r\nfunction addInputs(definition, values) {\r\n  mergeAttribute(definition, \"inputs\", values);\r\n}\r\n\r\nfunction addInputProps(definition, values) {\r\n  mergeAttribute(definition, \"inputProps\", values);\r\n}\r\n\r\nfunction addDynamicInputPorts(definition, condition, inputs) {\r\n  if (!definition.dynamicports) {\r\n    definition.dynamicports = [];\r\n  }\r\n\r\n  definition.dynamicports.push({ condition, inputs });\r\n}\r\n\r\nfunction addOutputProps(definition, values) {\r\n  mergeAttribute(definition, \"outputProps\", values);\r\n}\r\n\r\nexport default {\r\n  addInputProps,\r\n  addInputs,\r\n  addDynamicInputPorts,\r\n  addInputCss,\r\n  addSharedVisualInputs(definition) {\r\n    addInputCss(definition, {\r\n      opacity: {\r\n        index: 200,\r\n        group: \"Style\",\r\n        displayName: \"Opacity\",\r\n        type: \"number\",\r\n        default: 1,\r\n        allowVisualStates: true,\r\n      },\r\n      mixBlendMode: {\r\n        index: 201,\r\n        group: \"Style\",\r\n        displayName: \"Blend Mode\",\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { label: \"Normal\", value: \"normal\" },\r\n            { label: \"Multiply\", value: \"multiply\" },\r\n            { label: \"Screen\", value: \"screen\" },\r\n            { label: \"Overlay\", value: \"overlay\" },\r\n            { label: \"Darken\", value: \"darken\" },\r\n            { label: \"Lighten\", value: \"lighten\" },\r\n            { label: \"Color Dodge\", value: \"color-dodge\" },\r\n            { label: \"Color Burn\", value: \"color-burn\" },\r\n            { label: \"Hard Light\", value: \"hard-light\" },\r\n            { label: \"Soft Light\", value: \"soft-light\" },\r\n            { label: \"Difference\", value: \"difference\" },\r\n            { label: \"Exclusion\", value: \"exclusion\" },\r\n            { label: \"Hue\", value: \"hue\" },\r\n            { label: \"Saturation\", value: \"saturation\" },\r\n            { label: \"Color\", value: \"color\" },\r\n            { label: \"Luminosity\", value: \"luminosity\" },\r\n          ],\r\n        },\r\n        default: \"normal\",\r\n        applyDefault: false,\r\n        allowVisualStates: true,\r\n      },\r\n    });\r\n\r\n    addInputs(definition, {\r\n      visible: {\r\n        index: 210,\r\n        displayName: \"Visible\",\r\n        group: \"Style\",\r\n        default: true,\r\n        type: \"boolean\",\r\n        set(value) {\r\n          if (value) {\r\n            this.removeStyle([\"visibility\"]);\r\n          } else {\r\n            this.setStyle({ visibility: \"hidden\" });\r\n          }\r\n        },\r\n      },\r\n      zIndex: {\r\n        index: 211,\r\n        displayName: \"zIndex\",\r\n        group: \"Style\",\r\n        type: \"number\",\r\n        allowVisualStates: true,\r\n        set(value) {\r\n          if (value === undefined) {\r\n            this.removeStyle([\"zIndex\"]);\r\n          } else {\r\n            this.setStyle({ zIndex: Number(value) });\r\n          }\r\n        },\r\n      },\r\n    });\r\n  },\r\n  addMarginInputs(definition) {\r\n    addInputCss(definition, {\r\n      marginLeft: {\r\n        index: 1,\r\n        group: \"Margin and padding\",\r\n        displayName: \"Margin Left\",\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\", \"%\"],\r\n          defaultUnit: \"px\",\r\n          marginPaddingComp: \"margin-left\",\r\n        },\r\n        allowVisualStates: true,\r\n      },\r\n      marginRight: {\r\n        index: 2,\r\n        group: \"Margin and padding\",\r\n        displayName: \"Margin Right\",\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\", \"%\"],\r\n          defaultUnit: \"px\",\r\n          marginPaddingComp: \"margin-right\",\r\n        },\r\n        allowVisualStates: true,\r\n      },\r\n      marginTop: {\r\n        index: 3,\r\n        group: \"Margin and padding\",\r\n        displayName: \"Margin Top\",\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\", \"%\"],\r\n          defaultUnit: \"px\",\r\n          marginPaddingComp: \"margin-top\",\r\n        },\r\n        allowVisualStates: true,\r\n      },\r\n      marginBottom: {\r\n        index: 4,\r\n        group: \"Margin and padding\",\r\n        displayName: \"Margin Bottom\",\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\", \"%\"],\r\n          defaultUnit: \"px\",\r\n          marginPaddingComp: \"margin-bottom\",\r\n        },\r\n        allowVisualStates: true,\r\n      },\r\n    });\r\n  },\r\n  addPaddingInputs(definition, args) {\r\n    args = args || {};\r\n    const defaults = args.defaults ? args.defaults : {};\r\n\r\n    const styleTag = args.styleTag;\r\n\r\n    addInputCss(definition, {\r\n      paddingLeft: {\r\n        index: 64,\r\n        group: \"Margin and padding\",\r\n        default: defaults.paddingLeft || 0,\r\n        applyDefault: false,\r\n        displayName: \"Pad Left\",\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\"],\r\n          defaultUnit: \"px\",\r\n          marginPaddingComp: \"padding-left\",\r\n        },\r\n        allowVisualStates: true,\r\n        styleTag,\r\n      },\r\n      paddingRight: {\r\n        index: 65,\r\n        group: \"Margin and padding\",\r\n        default: defaults.paddingRight || 0,\r\n        applyDefault: false,\r\n        displayName: \"Pad Right\",\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\"],\r\n          defaultUnit: \"px\",\r\n          marginPaddingComp: \"padding-right\",\r\n        },\r\n        allowVisualStates: true,\r\n        styleTag,\r\n      },\r\n      paddingTop: {\r\n        index: 66,\r\n        group: \"Margin and padding\",\r\n        displayName: \"Pad Top\",\r\n        default: defaults.paddingTop || 0,\r\n        applyDefault: false,\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\"],\r\n          defaultUnit: \"px\",\r\n          marginPaddingComp: \"padding-top\",\r\n        },\r\n        allowVisualStates: true,\r\n        styleTag,\r\n      },\r\n      paddingBottom: {\r\n        index: 67,\r\n        group: \"Margin and padding\",\r\n        displayName: \"Pad Bottom\",\r\n        default: defaults.paddingBottom || 0,\r\n        applyDefault: false,\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\"],\r\n          defaultUnit: \"px\",\r\n          marginPaddingComp: \"padding-bottom\",\r\n        },\r\n        allowVisualStates: true,\r\n        styleTag,\r\n      },\r\n    });\r\n  },\r\n  addTransformInputs(definition) {\r\n    addInputs(definition, {\r\n      transformX: {\r\n        group: \"Placement\",\r\n        displayName: \"Pos X\",\r\n        default: 0,\r\n        index: 300,\r\n        allowVisualStates: true,\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\", \"%\"],\r\n          defaultUnit: \"px\",\r\n        },\r\n        set(value) {\r\n          if (!this.transforms) this.transforms = {};\r\n          this.transforms.x = value.value + value.unit;\r\n          this.updateTransform();\r\n        },\r\n      },\r\n      transformY: {\r\n        group: \"Placement\",\r\n        displayName: \"Pos Y\",\r\n        default: 0,\r\n        index: 301,\r\n        allowVisualStates: true,\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\", \"%\"],\r\n          defaultUnit: \"px\",\r\n        },\r\n        set(value) {\r\n          if (!this.transforms) this.transforms = {};\r\n          this.transforms.y = value.value + value.unit;\r\n          this.updateTransform();\r\n        },\r\n      },\r\n      transformRotation: {\r\n        index: 302,\r\n        group: \"Placement\",\r\n        displayName: \"Rotation\",\r\n        default: 0,\r\n        allowVisualStates: true,\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"deg\"],\r\n          defaultUnit: \"deg\",\r\n        },\r\n        set(value) {\r\n          if (!this.transforms) this.transforms = {};\r\n          this.transforms.rotation = value.value + value.unit;\r\n          this.updateTransform();\r\n        },\r\n      },\r\n      transformScale: {\r\n        index: 303,\r\n        group: \"Placement\",\r\n        displayName: \"Scale\",\r\n        default: 1,\r\n        allowVisualStates: true,\r\n        type: {\r\n          name: \"number\",\r\n        },\r\n        set(value) {\r\n          if (!this.transforms) this.transforms = {};\r\n          this.transforms.scale = value;\r\n          this.updateTransform();\r\n        },\r\n      },\r\n      transformOriginX: {\r\n        index: 304,\r\n        group: \"Placement\",\r\n        displayName: \"Transform Origin X\",\r\n        allowVisualStates: true,\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\", \"%\"],\r\n          defaultUnit: \"%\",\r\n        },\r\n        default: \"50\",\r\n        set(value) {\r\n          this.transformOriginX = value.value + value.unit;\r\n          this.updateTransformOrigin();\r\n        },\r\n      },\r\n      transformOriginY: {\r\n        index: 305,\r\n        group: \"Placement\",\r\n        displayName: \"Transform Origin Y\",\r\n        allowVisualStates: true,\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\", \"%\"],\r\n          defaultUnit: \"%\",\r\n        },\r\n        default: \"50\",\r\n        set(value) {\r\n          this.transformOriginY = value.value + value.unit;\r\n          this.updateTransformOrigin();\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!definition.methods) definition.methods = {};\r\n\r\n    definition.methods.updateTransform = function () {\r\n      let transform = \"\";\r\n\r\n      const { x, y, rotation, scale } = this.transforms;\r\n\r\n      if (x) transform += `translateX(${x}) `;\r\n      if (y) transform += `translateY(${y}) `;\r\n      if (rotation) transform += `rotate(${rotation}) `;\r\n      if (scale !== undefined) transform += `scale(${scale},${scale})`;\r\n\r\n      this.setStyle({ transform });\r\n    };\r\n\r\n    definition.methods.updateTransformOrigin = function () {\r\n      const x =\r\n        this.transformOriginX !== undefined ? this.transformOriginX : \"50%\";\r\n      const y =\r\n        this.transformOriginY !== undefined ? this.transformOriginY : \"50%\";\r\n\r\n      this.setStyle({\r\n        transformOrigin: `${x} ${y}`,\r\n      });\r\n    };\r\n  },\r\n  addAlignInputs(definition) {\r\n    const positions = [\r\n      { label: \"In Layout\", value: \"relative\" },\r\n      { label: \"Absolute\", value: \"absolute\" },\r\n      { label: \"Sticky\", value: \"sticky\" },\r\n      { label: \"Fixed\", value: \"fixed\" },\r\n    ];\r\n\r\n    addInputCss(definition, {\r\n      position: {\r\n        index: 11,\r\n        displayName: \"Position\",\r\n        group: \"Layout\",\r\n        type: {\r\n          name: \"enum\",\r\n          enums: positions,\r\n        },\r\n        default: \"relative\",\r\n      },\r\n    });\r\n\r\n    addInputProps(definition, {\r\n      alignX: {\r\n        index: 5,\r\n        group: \"Alignment\",\r\n        displayName: \"Align X\",\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { label: \"Left\", value: \"left\" },\r\n            { label: \"Center\", value: \"center\" },\r\n            { label: \"Right\", value: \"right\" },\r\n          ],\r\n          alignComp: \"horizontal\",\r\n        },\r\n      },\r\n      alignY: {\r\n        index: 6,\r\n        group: \"Alignment\",\r\n        displayName: \"Align Y\",\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { label: \"Top\", value: \"top\" },\r\n            { label: \"Center\", value: \"center\" },\r\n            { label: \"Bottom\", value: \"bottom\" },\r\n          ],\r\n          alignComp: \"vertical\",\r\n        },\r\n      },\r\n    });\r\n\r\n    addPositionAndAlignTooltips(definition);\r\n  },\r\n  addPointerEventOutputs(definition) {\r\n    addInputs(definition, {\r\n      pointerEventsMode: {\r\n        index: 403,\r\n        displayName: \"Pointer Events Mode\",\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { label: \"Inherit\", value: \"inherit\" },\r\n            { label: \"Explicit\", value: \"explicit\" },\r\n          ],\r\n        },\r\n        default: \"inherit\",\r\n        group: \"Pointer Events\",\r\n        set(value) {\r\n          if (value === \"inherit\") {\r\n            this.removeStyle([\"pointerEvents\"]);\r\n          } else {\r\n            let pointerEvents = \"auto\"; //default to auto\r\n            if (this._internal.pointerEventsEnabled !== undefined) {\r\n              pointerEvents = this._internal.pointerEventsEnabled\r\n                ? \"auto\"\r\n                : \"none\";\r\n            }\r\n            this.setStyle({ pointerEvents });\r\n          }\r\n        },\r\n      },\r\n      pointerEventsEnabled: {\r\n        index: 404,\r\n        displayName: \"Pointer Events Enabled\",\r\n        type: \"boolean\",\r\n        group: \"Pointer Events\",\r\n        default: true,\r\n        set(value) {\r\n          this._internal.pointerEventsEnabled = value ? true : false;\r\n          this.setStyle({\r\n            pointerEvents: this._internal.pointerEventsEnabled\r\n              ? \"auto\"\r\n              : \"none\",\r\n          });\r\n        },\r\n      },\r\n    });\r\n\r\n    addInputProps(definition, {\r\n      blockTouch: {\r\n        index: 450,\r\n        displayName: \"Block Pointer Events\",\r\n        group: \"Pointer Events\",\r\n        type: \"boolean\",\r\n      },\r\n    });\r\n\r\n    addDynamicInputPorts(definition, \"pointerEventsMode = explicit\", [\r\n      \"pointerEventsEnabled\",\r\n    ]);\r\n\r\n    addOutputProps(definition, {\r\n      onClick: {\r\n        displayName: \"Click\",\r\n        group: \"Events\",\r\n        type: \"signal\",\r\n        propPath: \"pointer\",\r\n      },\r\n      pointerDown: {\r\n        displayName: \"Pointer Down\",\r\n        group: \"Pointer Events\",\r\n        type: \"signal\",\r\n        propPath: \"pointer\",\r\n        props: {\r\n          onMouseDown() {\r\n            this.sendSignalOnOutput(\"pointerDown\");\r\n          },\r\n          onTouchStart() {\r\n            this.sendSignalOnOutput(\"pointerDown\");\r\n          },\r\n        },\r\n      },\r\n      pointerUp: {\r\n        displayName: \"Pointer Up\",\r\n        group: \"Pointer Events\",\r\n        type: \"signal\",\r\n        propPath: \"pointer\",\r\n        props: {\r\n          onMouseUp() {\r\n            this.sendSignalOnOutput(\"pointerUp\");\r\n          },\r\n          onTouchEnd() {\r\n            this.sendSignalOnOutput(\"pointerUp\");\r\n          },\r\n          onTouchCancel() {\r\n            this.sendSignalOnOutput(\"pointerUp\");\r\n          },\r\n        },\r\n      },\r\n      pointerEnter: {\r\n        displayName: \"Pointer Enter\",\r\n        group: \"Pointer Events\",\r\n        type: \"signal\",\r\n        propPath: \"pointer\",\r\n        props: {\r\n          onMouseEnter() {\r\n            this.sendSignalOnOutput(\"pointerEnter\");\r\n          },\r\n        },\r\n      },\r\n      hoverStart: {\r\n        displayName: \"Hover Start\",\r\n        group: \"Hover Events\",\r\n        type: \"signal\",\r\n        propPath: \"pointer\",\r\n        props: {\r\n          onMouseOver() {\r\n            this.sendSignalOnOutput(\"hoverStart\");\r\n            this.setVisualStates([\"hover\"]);\r\n          },\r\n        },\r\n      },\r\n      hoverEnd: {\r\n        displayName: \"Hover End\",\r\n        group: \"Hover Events\",\r\n        type: \"signal\",\r\n        propPath: \"pointer\",\r\n        props: {\r\n          onMouseLeave() {\r\n            this.sendSignalOnOutput(\"hoverEnd\");\r\n            this.setVisualStates([\"\"]);\r\n          },\r\n        },\r\n      },\r\n    });\r\n\r\n    addPointerEventsTooltips(definition);\r\n  },\r\n  addDimensions(\r\n    definition,\r\n    {\r\n      defaultSizeMode = \"explicit\",\r\n      contentLabel = \"Content\",\r\n      useDimensionConstraints = true,\r\n    } = {}\r\n  ) {\r\n    let widthCondition = \"sizeMode = explicit OR sizeMode = contentHeight\";\r\n    let heightCondition = \"sizeMode = explicit OR sizeMode = contentWidth\";\r\n\r\n    if (defaultSizeMode === \"explicit\" || defaultSizeMode === \"contentHeight\") {\r\n      widthCondition += \" OR sizeMode NOT SET\";\r\n    }\r\n\r\n    if (defaultSizeMode === \"explicit\" || defaultSizeMode === \"contentWidth\") {\r\n      heightCondition += \" OR sizeMode NOT SET\";\r\n    }\r\n\r\n    addDynamicInputPorts(definition, widthCondition, [\"width\"]);\r\n    addDynamicInputPorts(definition, heightCondition, [\"height\"]);\r\n\r\n    addInputProps(definition, {\r\n      sizeMode: {\r\n        index: 10,\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { value: \"explicit\", label: \"Explicit\" },\r\n            { value: \"contentWidth\", label: \"Content Width\" },\r\n            { value: \"contentHeight\", label: \"Content Height\" },\r\n            { value: \"contentSize\", label: \"Content Size\" },\r\n          ],\r\n          allowEditOnly: true,\r\n          sizeComp: \"mode\",\r\n        },\r\n        group: \"Dimensions\",\r\n        displayName: \"Size Mode\",\r\n        default: defaultSizeMode,\r\n        allowVisualStates: true,\r\n      },\r\n      width: {\r\n        index: 11,\r\n        group: \"Dimensions\",\r\n        displayName: \"Width\",\r\n        type: {\r\n          name: \"dimension\",\r\n          units: [\"%\", \"px\", \"vw\", \"vh\"],\r\n          defaultUnit: \"%\",\r\n        },\r\n        default: 100,\r\n        allowVisualStates: true,\r\n        onChange(value) {\r\n          this.props.fixedWidth = value.isFixed;\r\n        },\r\n      },\r\n      height: {\r\n        index: 13,\r\n        group: \"Dimensions\",\r\n        displayName: \"Height\",\r\n        type: {\r\n          name: \"dimension\",\r\n          units: [\"%\", \"px\", \"vw\", \"vh\"],\r\n          defaultUnit: \"%\",\r\n        },\r\n        default: 100,\r\n        allowVisualStates: true,\r\n        onChange(value) {\r\n          this.props.fixedHeight = value.isFixed;\r\n        },\r\n      },\r\n    });\r\n\r\n    if (!Noodl.deployed) {\r\n      addDimensionTooltips(definition, contentLabel);\r\n    }\r\n\r\n    if (useDimensionConstraints) {\r\n      addInputCss(definition, {\r\n        minWidth: {\r\n          index: 400,\r\n          group: \"Dimension Constraints\",\r\n          displayName: \"Min Width\",\r\n          allowVisualStates: true,\r\n          type: {\r\n            name: \"number\",\r\n            units: [\"%\", \"px\", \"vw\", \"vh\"],\r\n            defaultUnit: \"%\",\r\n          },\r\n        },\r\n        maxWidth: {\r\n          index: 401,\r\n          group: \"Dimension Constraints\",\r\n          displayName: \"Max Width\",\r\n          allowVisualStates: true,\r\n          type: {\r\n            name: \"number\",\r\n            units: [\"%\", \"px\", \"vw\", \"vh\"],\r\n            defaultUnit: \"%\",\r\n          },\r\n        },\r\n        minHeight: {\r\n          index: 402,\r\n          group: \"Dimension Constraints\",\r\n          displayName: \"Min Height\",\r\n          allowVisualStates: true,\r\n          type: {\r\n            name: \"number\",\r\n            units: [\"%\", \"px\", \"vw\", \"vh\"],\r\n            defaultUnit: \"%\",\r\n          },\r\n        },\r\n        maxHeight: {\r\n          index: 403,\r\n          group: \"Dimension Constraints\",\r\n          displayName: \"Max Height\",\r\n          allowVisualStates: true,\r\n          type: {\r\n            name: \"number\",\r\n            units: [\"%\", \"px\", \"vw\", \"vh\"],\r\n            defaultUnit: \"%\",\r\n          },\r\n        },\r\n      });\r\n\r\n      if (!Noodl.deployed) {\r\n        addDimensionConstraintsTooltips(definition);\r\n      }\r\n    }\r\n  },\r\n  _addCornerRadius(definition, opts) {\r\n    opts = opts || {};\r\n    const defaults = opts.defaults || {};\r\n    const styleTag = opts.styleTag;\r\n\r\n    if (!defaults.borderRadius) defaults.borderRadius = 0;\r\n\r\n    function defineCornerTab(definition, suffix, tabName, indexOffset) {\r\n      const nameWithTab = (name) =>\r\n        `${name} ${suffix ? \"(\" + suffix + \")\" : \"\"}`;\r\n\r\n      const tab = { group: \"corners\", tab: tabName, label: suffix };\r\n      const radiusName = `border${suffix}Radius`;\r\n      addInputs(definition, {\r\n        [radiusName]: {\r\n          index: 240 + indexOffset,\r\n          displayName: \"Corner Radius\",\r\n          editorName: nameWithTab(\"Corner Radius\"),\r\n          group: \"Corner Radius\",\r\n          type: {\r\n            name: \"number\",\r\n            units: [\"px\", \"%\"],\r\n            defaultUnit: \"px\",\r\n          },\r\n          allowVisualStates: true,\r\n          default: defaults[radiusName],\r\n          tab,\r\n          set(value) {\r\n            this._internal.borderRadius[radiusName] =\r\n              value.value === undefined\r\n                ? Number(value) + \"px\"\r\n                : value.value + value.unit;\r\n\r\n            this._updateCornerRadii();\r\n          },\r\n        },\r\n      });\r\n    }\r\n\r\n    defineCornerTab(definition, \"\", \"corners-all\", 0);\r\n    defineCornerTab(definition, \"TopLeft\", \"corners-top-left\", 1);\r\n    defineCornerTab(definition, \"TopRight\", \"corners-top-right\", 2);\r\n    defineCornerTab(definition, \"BottomRight\", \"corners-bottom-right\", 3);\r\n    defineCornerTab(definition, \"BottomLeft\", \"corners-bottom-left\", 4);\r\n\r\n    definition.methods._updateCornerRadii = function () {\r\n      const b = this._internal.borderRadius;\r\n\r\n      function setCorner(style, corner) {\r\n        const r = `border${corner}Radius`;\r\n        style[r] = b[r] || b.borderRadius;\r\n      }\r\n\r\n      const style = {};\r\n      setCorner(style, \"TopLeft\");\r\n      setCorner(style, \"TopRight\");\r\n      setCorner(style, \"BottomRight\");\r\n      setCorner(style, \"BottomLeft\");\r\n\r\n      this.setStyle(style, styleTag);\r\n    };\r\n\r\n    const oldInit = definition.initialize;\r\n    definition.initialize = function () {\r\n      oldInit && oldInit.call(this);\r\n      this._internal.borderRadius = { ...defaults };\r\n      if (defaults.borderRadius) this._updateCornerRadii();\r\n    };\r\n  },\r\n  addBorderInputs(definition, opts) {\r\n    opts = opts || {};\r\n    const defaults = opts.defaults || {};\r\n    const styleTag = opts.styleTag;\r\n\r\n    if (defaults.borderStyle === undefined) defaults.borderStyle = \"none\";\r\n    if (defaults.borderWidth === undefined) defaults.borderWidth = 2;\r\n    if (defaults.borderColor === undefined) defaults.borderColor = \"#000000\";\r\n\r\n    function defineBorderTab(definition, suffix, tabName, indexOffset) {\r\n      const styleName = `border${suffix}Style`;\r\n      const widthName = `border${suffix}Width`;\r\n      const colorName = `border${suffix}Color`;\r\n\r\n      let orNotSet =\r\n        defaults.borderStyle !== \"none\" ? \"OR borderStyle NOT SET\" : \"\";\r\n\r\n      if (suffix) {\r\n        if (defaults[styleName] && defaults[styleName] !== \"none\")\r\n          orNotSet += `OR ${styleName} NOT SET`;\r\n        addDynamicInputPorts(\r\n          definition,\r\n          `${styleName} = solid OR ${styleName} = dashed OR ${styleName} = dotted OR borderStyle = solid OR borderStyle = dashed OR borderStyle = dotted ${orNotSet}`,\r\n          [`${widthName}`, `${colorName}`]\r\n        );\r\n      } else {\r\n        addDynamicInputPorts(\r\n          definition,\r\n          `${styleName} = solid OR ${styleName} = dashed OR ${styleName} = dotted ${orNotSet}`,\r\n          [`${widthName}`, `${colorName}`]\r\n        );\r\n      }\r\n\r\n      const tab = { group: \"border-styles\", tab: tabName, label: suffix };\r\n\r\n      const nameWithTab = (name) =>\r\n        `${name} ${suffix ? \"(\" + suffix + \")\" : \"\"}`;\r\n      const index = 202 + indexOffset * 4;\r\n\r\n      addInputs(definition, {\r\n        [styleName]: {\r\n          index: index + 1,\r\n          displayName: \"Border Style\",\r\n          editorName: nameWithTab(\"Border Style\"),\r\n          group: \"Border Style\",\r\n          allowVisualStates: true,\r\n          type: {\r\n            name: \"enum\",\r\n            enums: [\r\n              { label: \"None\", value: \"none\" },\r\n              { label: \"Solid\", value: \"solid\" },\r\n              { label: \"Dotted\", value: \"dotted\" },\r\n              { label: \"Dashed\", value: \"dashed\" },\r\n            ],\r\n          },\r\n          default: defaults[styleName],\r\n          tab,\r\n          set(value) {\r\n            this._internal.borders[styleName] = value;\r\n            this._updateBorders();\r\n          },\r\n        },\r\n        [widthName]: {\r\n          index: index + 2,\r\n          displayName: \"Border Width\",\r\n          editorName: nameWithTab(\"Border Width\"),\r\n          group: \"Border Style\",\r\n          allowVisualStates: true,\r\n          type: {\r\n            name: \"number\",\r\n            units: [\"px\"],\r\n            defaultUnit: \"px\",\r\n          },\r\n          default: defaults[widthName],\r\n          tab,\r\n          set(value) {\r\n            this._internal.borders[widthName] =\r\n              value.value === undefined\r\n                ? Number(value) + \"px\"\r\n                : value.value + value.unit;\r\n            this._updateBorders();\r\n          },\r\n        },\r\n        [colorName]: {\r\n          index: index + 3,\r\n          displayName: \"Border Color\",\r\n          editorName: nameWithTab(\"Border Color\"),\r\n          group: \"Border Style\",\r\n          type: \"color\",\r\n          default: defaults[colorName],\r\n          allowVisualStates: true,\r\n          tab,\r\n          set(value) {\r\n            this._internal.borders[colorName] = value;\r\n            this._updateBorders();\r\n          },\r\n        },\r\n      });\r\n    }\r\n\r\n    defineBorderTab(definition, \"\", \"borders-all\", 0);\r\n    defineBorderTab(definition, \"Left\", \"borders-left\", 1);\r\n    defineBorderTab(definition, \"Top\", \"borders-top\", 2);\r\n    defineBorderTab(definition, \"Right\", \"borders-right\", 3);\r\n    defineBorderTab(definition, \"Bottom\", \"borders-bottom\", 4);\r\n\r\n    definition.methods._updateBorders = function () {\r\n      const b = this._internal.borders;\r\n\r\n      function setBorder(style, group) {\r\n        const width = `border${group}Width`;\r\n        const color = `border${group}Color`;\r\n        const borderStyle = `border${group}Style`;\r\n\r\n        style[width] = b[width] || b.borderWidth;\r\n        style[color] = b[color] || b.borderColor;\r\n        style[borderStyle] = b[borderStyle] || b.borderStyle;\r\n      }\r\n\r\n      const style = {};\r\n      setBorder(style, \"Top\");\r\n      setBorder(style, \"Right\");\r\n      setBorder(style, \"Bottom\");\r\n      setBorder(style, \"Left\");\r\n\r\n      this.setStyle(style, styleTag);\r\n    };\r\n\r\n    const oldInit = definition.initialize;\r\n    definition.initialize = function () {\r\n      oldInit && oldInit.call(this);\r\n      this._internal.borders = { ...defaults };\r\n\r\n      const hasDefaultBorders =\r\n        defaults.borderStyle !== \"none\" ||\r\n        (defaults.borderTopStyle && defaults.borderTopStyle !== \"none\") ||\r\n        (defaults.borderRightStyle && defaults.borderRightStyle !== \"none\") ||\r\n        (defaults.borderBottomStyle && defaults.borderBottomStyle !== \"none\") ||\r\n        (defaults.borderRightStyle && defaults.borderRightStyle !== \"none\");\r\n\r\n      if (hasDefaultBorders) this._updateBorders();\r\n    };\r\n\r\n    this._addCornerRadius(definition, { defaults, styleTag });\r\n  },\r\n  addShadowInputs(definition, args) {\r\n    args = args || {};\r\n    const styleTag = args.styleTag;\r\n\r\n    addDynamicInputPorts(definition, \"boxShadowEnabled = true\", [\r\n      \"boxShadowOffsetX\",\r\n      \"boxShadowOffsetY\",\r\n      \"boxShadowInset\",\r\n      \"boxShadowBlurRadius\",\r\n      \"boxShadowSpreadRadius\",\r\n      \"boxShadowColor\",\r\n    ]);\r\n\r\n    addInputs(definition, {\r\n      boxShadowEnabled: {\r\n        index: 250,\r\n        group: \"Box Shadow\",\r\n        displayName: \"Shadow Enabled\",\r\n        type: \"boolean\",\r\n        default: false,\r\n        allowVisualStates: true,\r\n        set(value) {\r\n          this._internal.boxShadowEnabled = value;\r\n          this._updateBoxShadow();\r\n        },\r\n      },\r\n      boxShadowOffsetX: {\r\n        index: 251,\r\n        group: \"Box Shadow\",\r\n        displayName: \"Offset X\",\r\n        default: 0,\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\"],\r\n          defaultUnit: \"px\",\r\n        },\r\n        allowVisualStates: true,\r\n        set(value) {\r\n          this._internal.boxShadowOffsetX = value.value + value.unit;\r\n          this._updateBoxShadow();\r\n        },\r\n      },\r\n      boxShadowOffsetY: {\r\n        index: 252,\r\n        group: \"Box Shadow\",\r\n        displayName: \"Offset Y\",\r\n        default: 0,\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\"],\r\n          defaultUnit: \"px\",\r\n        },\r\n        allowVisualStates: true,\r\n        set(value) {\r\n          this._internal.boxShadowOffsetY = value.value + value.unit;\r\n          this._updateBoxShadow();\r\n        },\r\n      },\r\n      boxShadowBlurRadius: {\r\n        index: 253,\r\n        group: \"Box Shadow\",\r\n        displayName: \"Blur Radius\",\r\n        default: 5,\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\"],\r\n          defaultUnit: \"px\",\r\n        },\r\n        allowVisualStates: true,\r\n        set(value) {\r\n          this._internal.boxShadowBlurRadius = value.value + value.unit;\r\n          this._updateBoxShadow();\r\n        },\r\n      },\r\n      boxShadowSpreadRadius: {\r\n        index: 254,\r\n        group: \"Box Shadow\",\r\n        displayName: \"Spread Radius\",\r\n        default: 2,\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\"],\r\n          defaultUnit: \"px\",\r\n        },\r\n        allowVisualStates: true,\r\n        set(value) {\r\n          this._internal.boxShadowSpreadRadius = value.value + value.unit;\r\n          this._updateBoxShadow();\r\n        },\r\n      },\r\n      boxShadowInset: {\r\n        index: 255,\r\n        group: \"Box Shadow\",\r\n        displayName: \"Inset\",\r\n        type: \"boolean\",\r\n        default: false,\r\n        allowVisualStates: true,\r\n        set(value) {\r\n          this._internal.boxShadowInset = value;\r\n          this._updateBoxShadow();\r\n        },\r\n      },\r\n      boxShadowColor: {\r\n        index: 256,\r\n        group: \"Box Shadow\",\r\n        displayName: \"Shadow Color\",\r\n        type: \"color\",\r\n        default: \"#00000033\",\r\n        allowVisualStates: true,\r\n        set(value) {\r\n          this._internal.boxShadowColor = value;\r\n          this._updateBoxShadow();\r\n        },\r\n      },\r\n    });\r\n\r\n    definition.methods._updateBoxShadow = function () {\r\n      const internal = this._internal;\r\n\r\n      if (internal.boxShadowEnabled) {\r\n        this.setStyle(\r\n          {\r\n            boxShadow: `${internal.boxShadowInset ? \"inset \" : \"\"}${\r\n              internal.boxShadowOffsetX\r\n            } ${internal.boxShadowOffsetY} ${internal.boxShadowBlurRadius} ${\r\n              internal.boxShadowSpreadRadius\r\n            } ${internal.boxShadowColor}`,\r\n          },\r\n          styleTag\r\n        );\r\n      } else {\r\n        this.removeStyle([\"boxShadow\"], styleTag);\r\n      }\r\n    };\r\n\r\n    const oldInit = definition.initialize;\r\n    definition.initialize = function () {\r\n      oldInit && oldInit.call(this);\r\n      this._internal.boxShadowOffsetX = 0;\r\n      this._internal.boxShadowOffsetY = 0;\r\n      this._internal.boxShadowBlurRadius = \"5px\";\r\n      this._internal.boxShadowSpreadRadius = \"2px\";\r\n      this._internal.boxShadowColor = \"#00000033\";\r\n    };\r\n  },\r\n  addIconInputs(definition, args) {\r\n    args = args || {};\r\n\r\n    const index = 20;\r\n\r\n    const defaults = {\r\n      useIcon: true,\r\n      iconColor: \"#FFFFFF\",\r\n    };\r\n\r\n    if (args.defaults) {\r\n      Object.assign(defaults, args.defaults);\r\n    }\r\n\r\n    let useIconCondition = \"useIcon = true\";\r\n    if (defaults.useIcon) {\r\n      useIconCondition += \" OR useIcon NOT SET\";\r\n    }\r\n\r\n    const useIconPorts = [\"iconSourceType\", \"iconSize\"];\r\n    if (args.enableIconPlacement) {\r\n      useIconPorts.push(\"iconPlacement\");\r\n      useIconPorts.push(\"iconSpacing\");\r\n    }\r\n\r\n    addDynamicInputPorts(definition, useIconCondition, useIconPorts);\r\n\r\n    if (defaults.useIcon) {\r\n      addDynamicInputPorts(\r\n        definition,\r\n        \"#js (params.useIcon===true || params.useIcon===undefined) && params.iconSourceType === 'image'\",\r\n        [\"iconImageSource\"]\r\n      );\r\n      addDynamicInputPorts(\r\n        definition,\r\n        \"#js (params.useIcon===true || params.useIcon===undefined) && params.iconSourceType === 'icon'\",\r\n        [\"iconIconSource\", \"iconColor\"]\r\n      );\r\n    } else {\r\n      addDynamicInputPorts(\r\n        definition,\r\n        \"useIcon = true AND iconSourceType = image\",\r\n        [\"iconImageSource\"]\r\n      );\r\n      addDynamicInputPorts(\r\n        definition,\r\n        \"useIcon = true AND iconSourceType = icon\",\r\n        [\"iconIconSource\", \"iconColor\"]\r\n      );\r\n    }\r\n\r\n    if (!args.hideEnableIconInput) {\r\n      addInputProps(definition, {\r\n        useIcon: {\r\n          type: \"boolean\",\r\n          group: \"Icon\",\r\n          displayName: \"Enable Icon\",\r\n          default: defaults.useIcon,\r\n          allowVisualStates: true,\r\n          index: index,\r\n        },\r\n      });\r\n    }\r\n\r\n    addInputProps(definition, {\r\n      iconSourceType: {\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { label: \"Image\", value: \"image\" },\r\n            { label: \"Icon\", value: \"icon\" },\r\n          ],\r\n        },\r\n        group: \"Icon\",\r\n        displayName: \"Type\",\r\n        default: \"icon\",\r\n        allowVisualStates: true,\r\n        index: index + 1,\r\n      },\r\n      iconIconSource: {\r\n        type: \"icon\",\r\n        displayName: \"Icon Source\",\r\n        group: \"Icon\",\r\n        allowVisualStates: true,\r\n        index: index + 3,\r\n      },\r\n    });\r\n\r\n    addInputs(definition, {\r\n      iconImageSource: {\r\n        type: \"image\",\r\n        displayName: \"Image Source\",\r\n        group: \"Icon\",\r\n        allowVisualStates: true,\r\n        index: index + 2,\r\n        set(iconImageSource) {\r\n          this.props.iconImageSource = getAbsoluteUrl(iconImageSource);\r\n        },\r\n      },\r\n    });\r\n\r\n    if (args.enableIconPlacement) {\r\n      addInputProps(definition, {\r\n        iconSpacing: {\r\n          group: \"Icon\",\r\n          displayName: \"Spacing\",\r\n          default: 10,\r\n          type: {\r\n            name: \"number\",\r\n            units: [\"px\"],\r\n            defaultUnit: \"px\",\r\n          },\r\n          allowVisualStates: true,\r\n          index: index + 4,\r\n        },\r\n        iconPlacement: {\r\n          type: {\r\n            name: \"enum\",\r\n            enums: [\r\n              { label: \"Left\", value: \"left\" },\r\n              { label: \"Right\", value: \"right\" },\r\n            ],\r\n          },\r\n          group: \"Icon\",\r\n          displayName: \"Placement\",\r\n          default: \"left\",\r\n          allowVisualStates: true,\r\n          index: index + 5,\r\n        },\r\n      });\r\n    }\r\n\r\n    addInputProps(definition, {\r\n      iconSize: {\r\n        group: \"Icon\",\r\n        displayName: \"Size\",\r\n        default: 16,\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\"],\r\n          defaultUnit: \"px\",\r\n        },\r\n        allowVisualStates: true,\r\n        index: index + 6,\r\n      },\r\n      iconColor: {\r\n        group: \"Icon\",\r\n        displayName: \"Color\",\r\n        editorName: \"Icon Color\",\r\n        default: defaults.iconColor,\r\n        type: \"color\",\r\n        allowVisualStates: true,\r\n        index: index + 7,\r\n      },\r\n    });\r\n  },\r\n\r\n  addLabelInputs(definition, args) {\r\n    args = args || {};\r\n\r\n    const defaults = {\r\n      useLabel: false,\r\n    };\r\n\r\n    if (args.defaults) {\r\n      Object.assign(defaults, args.defaults);\r\n    }\r\n\r\n    const condition = defaults.useLabel\r\n      ? \"useLabel = true OR useLabel NOT SET\"\r\n      : \"useLabel = true\";\r\n\r\n    const textStylePortPrefix = args.styleTag || \"\";\r\n\r\n    const ports = [\"label\"].concat(\r\n      [\r\n        \"textStyle\",\r\n        \"fontFamily\",\r\n        \"fontSize\",\r\n        \"color\",\r\n        \"letterSpacing\",\r\n        \"lineHeight\",\r\n        \"textTransform\",\r\n      ].map((port) => textStylePortPrefix + port)\r\n    );\r\n    if (args.enableSpacing) {\r\n      ports.push(\"labelSpacing\");\r\n    }\r\n\r\n    addDynamicInputPorts(definition, condition, ports);\r\n\r\n    addInputProps(definition, {\r\n      useLabel: {\r\n        index: 18,\r\n        type: \"boolean\",\r\n        displayName: \"Enable Label\",\r\n        group: \"Label\",\r\n        default: defaults.useLabel,\r\n      },\r\n      label: {\r\n        type: \"string\",\r\n        displayName: \"Label\",\r\n        group: \"Label\",\r\n        default: \"Label\",\r\n      },\r\n    });\r\n\r\n    if (args.enableSpacing) {\r\n      addInputProps(definition, {\r\n        labelSpacing: {\r\n          displayName: \"Spacing\",\r\n          group: \"Label\",\r\n          type: {\r\n            name: \"number\",\r\n            units: [\"px\"],\r\n            defaultUnit: \"px\",\r\n          },\r\n          default: 10,\r\n        },\r\n      });\r\n    }\r\n\r\n    this.addTextStyleInputs(definition, {\r\n      ...args,\r\n      group: \"Label Text Style\",\r\n      popout: {\r\n        group: \"label-text-style\",\r\n        label: \"Text Style\",\r\n        parentGroup: \"Label\",\r\n      },\r\n    });\r\n  },\r\n\r\n  addTextStyleInputs(definition, args) {\r\n    args = args || {};\r\n\r\n    const group = args.group || \"Text Style\";\r\n    const styleTag = args.styleTag;\r\n\r\n    const portPrefix = args.hasOwnProperty(\"portPrefix\")\r\n      ? args.portPrefix\r\n      : args.styleTag || \"\";\r\n\r\n    const textStyleInputName = portPrefix + \"textStyle\";\r\n\r\n    const index = args.portIndex !== undefined ? args.portIndex : 19;\r\n\r\n    function prettyName(name) {\r\n      return args.displayName ? args.displayName + \" \" + name : name;\r\n    }\r\n\r\n    addInputs(definition, {\r\n      [textStyleInputName]: {\r\n        index: index,\r\n        type: {\r\n          name: \"textStyle\",\r\n          childPorts: [\r\n            \"fontFamily\",\r\n            \"fontSize\",\r\n            \"color\",\r\n            \"letterSpacing\",\r\n            \"lineHeight\",\r\n            \"textTransform\",\r\n          ],\r\n          childPortPrefix: portPrefix,\r\n        },\r\n        group: group,\r\n        displayName: \"Text Style\",\r\n        editorName: prettyName(\"Text Style\"),\r\n        default: \"None\",\r\n        set(value) {\r\n          this.props[textStyleInputName] =\r\n            this.context.styles.getTextStyle(value);\r\n          this.forceUpdate();\r\n        },\r\n        allowVisualStates: true,\r\n        popout: args.popout,\r\n      },\r\n      [portPrefix + \"fontFamily\"]: {\r\n        index: index + 1,\r\n        type: {\r\n          name: \"font\",\r\n          parentPort: textStyleInputName,\r\n        },\r\n        group: group,\r\n        displayName: \"Font Family\",\r\n        editorName: prettyName(\"Font Family\"),\r\n        set(value) {\r\n          if (value) {\r\n            let family = value;\r\n            if (family.split(\".\").length > 1) {\r\n              FontLoader.instance.loadFont(family);\r\n              family = family.replace(/\\.[^/.]+$/, \"\");\r\n              family = family.split(\"/\").pop();\r\n            }\r\n            this.setStyle({ fontFamily: family }, styleTag);\r\n          } else {\r\n            this.removeStyle([\"fontFamily\"], styleTag);\r\n          }\r\n\r\n          if (this.props[textStyleInputName]) {\r\n            this.forceUpdate();\r\n          }\r\n        },\r\n        allowVisualStates: true,\r\n        popout: args.popout,\r\n      },\r\n    });\r\n\r\n    addInputCss(definition, {\r\n      [portPrefix + \"fontSize\"]: {\r\n        index: index + 2,\r\n        group: group,\r\n        displayName: \"Font Size\",\r\n        editorName: prettyName(\"Font Size\"),\r\n        targetStyleProperty: \"fontSize\",\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\"],\r\n          defaultUnit: \"px\",\r\n          parentPort: textStyleInputName,\r\n        },\r\n        onChange() {\r\n          if (this.props[textStyleInputName]) {\r\n            this.forceUpdate();\r\n          }\r\n        },\r\n        allowVisualStates: true,\r\n        popout: args.popout,\r\n        styleTag,\r\n      },\r\n      [portPrefix + \"color\"]: {\r\n        index: index + 3,\r\n        type: {\r\n          name: \"color\",\r\n          parentPort: textStyleInputName,\r\n        },\r\n        displayName: \"Color\",\r\n        editorName: prettyName(\"Color\"),\r\n        group: group,\r\n        targetStyleProperty: \"color\",\r\n        allowVisualStates: true,\r\n        popout: args.popout,\r\n        styleTag,\r\n        onChange() {\r\n          if (this.props[textStyleInputName]) {\r\n            this.forceUpdate();\r\n          }\r\n        },\r\n      },\r\n      [portPrefix + \"letterSpacing\"]: {\r\n        index: index + 4,\r\n        group: group,\r\n        displayName: \"Letter Spacing\",\r\n        editorName: prettyName(\"Letter Spacing\"),\r\n        targetStyleProperty: \"letterSpacing\",\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\", \"em\"],\r\n          defaultUnit: \"px\",\r\n        },\r\n        allowVisualStates: true,\r\n        popout: args.popout,\r\n        styleTag,\r\n        default: \"Auto\",\r\n        applyDefault: false,\r\n        onChange() {\r\n          if (this.props[textStyleInputName]) {\r\n            this.forceUpdate();\r\n          }\r\n        },\r\n      },\r\n      [portPrefix + \"lineHeight\"]: {\r\n        index: index + 5,\r\n        group: group,\r\n        displayName: \"Line Height\",\r\n        editorName: prettyName(\"Line Height\"),\r\n        targetStyleProperty: \"lineHeight\",\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"\", \"px\", \"%\"],\r\n          defaultUnit: \"\",\r\n          parentPort: textStyleInputName,\r\n        },\r\n        allowVisualStates: true,\r\n        onChange() {\r\n          if (this.props[textStyleInputName]) {\r\n            this.forceUpdate();\r\n          }\r\n        },\r\n        popout: args.popout,\r\n        styleTag,\r\n        default: \"Auto\",\r\n        applyDefault: false,\r\n      },\r\n      [portPrefix + \"textTransform\"]: {\r\n        index: index + 6,\r\n        group: group,\r\n        displayName: \"Case\",\r\n        editorName: prettyName(\"Case\"),\r\n        applyDefault: false,\r\n        targetStyleProperty: \"textTransform\",\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { label: \"None\", value: \"none\" },\r\n            { label: \"Uppercase\", value: \"uppercase\" },\r\n            { label: \"Lowercase\", value: \"lowercase\" },\r\n            { label: \"Capitalize\", value: \"capitalize\" },\r\n          ],\r\n          parentPort: textStyleInputName,\r\n        },\r\n        default: \"none\",\r\n        popout: args.popout,\r\n        styleTag,\r\n        allowVisualStates: true,\r\n        onChange() {\r\n          if (this.props[textStyleInputName]) {\r\n            this.forceUpdate();\r\n          }\r\n        },\r\n      },\r\n    });\r\n\r\n    const fontFamilyPort = portPrefix + \"fontFamily\";\r\n\r\n    definition.setup = function (context, graphModel) {\r\n      graphModel.on(\"nodeAdded.\" + definition.name, function (node) {\r\n        if (\r\n          node.parameters[fontFamilyPort] &&\r\n          node.parameters[fontFamilyPort].split(\".\").length > 1\r\n        ) {\r\n          FontLoader.instance.loadFont(node.parameters[fontFamilyPort]);\r\n        }\r\n        node.on(\"parameterUpdated\", function (event) {\r\n          if (event.name === fontFamilyPort && event.value) {\r\n            if (event.value.split(\".\").length > 1) {\r\n              FontLoader.instance.loadFont(event.value);\r\n            }\r\n          }\r\n        });\r\n      });\r\n    };\r\n  },\r\n};\r\n\r\nfunction addDimensionTooltips(definition, contentLabel) {\r\n  definition.inputProps.sizeMode.tooltip = {\r\n    explicit: {\r\n      standard: \"Explicit width & height\",\r\n      extended: createTooltip({\r\n        title: \"Explicit width & height\",\r\n        body: \"Set width & height explicitly in pixels(px), percentage(%) or viewport size(vh/vw).\",\r\n        images: [{ src: \"size-mode-explicit.svg\" }],\r\n      }),\r\n    },\r\n    contentWidth: {\r\n      standard: `${contentLabel} width & explicit height`,\r\n      extended: createTooltip({\r\n        title: `${contentLabel} width & explicit height`,\r\n        body: `The width will match the width of the ${contentLabel.toLowerCase()}. Height is set explicitly.`,\r\n        images: [{ src: \"size-mode-content-width.svg\" }],\r\n      }),\r\n    },\r\n    contentHeight: {\r\n      standard: `Explicit width & ${contentLabel.toLowerCase()} height`,\r\n      extended: createTooltip({\r\n        title: `Explicit width & ${contentLabel.toLowerCase()} height`,\r\n        body: `The width is set explicitly. The height will match the height of the ${contentLabel.toLowerCase()}`,\r\n        images: [{ src: \"size-mode-content-height.svg\" }],\r\n      }),\r\n    },\r\n    contentSize: {\r\n      standard: `${contentLabel} width & height`,\r\n      extended: createTooltip({\r\n        title: `${contentLabel} width & height`,\r\n        body: `The width and height will match the size of the ${contentLabel.toLowerCase()}`,\r\n        images: [{ src: \"size-mode-content-size.svg\" }],\r\n      }),\r\n    },\r\n  };\r\n\r\n  const unitsBodyText = [\r\n    \"- %: Relative to parents size. If 'fixed' is false this element will resize to share space with siblings. If 'Clip Content' is disabled, it'll also expand to fit the boundaries of all its content\",\r\n    \"- px: Pixels\",\r\n    \"- vw: Relative to viewport width. 100 makes the element the same width as the screen\",\r\n    \"- vh: Relative to viewport height. 100 makes the element the same height as the screen\",\r\n  ];\r\n\r\n  const fixedTooltip = createTooltip({\r\n    title: \"Fixed\",\r\n    body: [\r\n      \"- Enabled: Elements will be the exact size set\",\r\n      \"- Disabled: Element will resize to fill up empty space, or shrink to make space for siblings. Use the dimension constraints, min and max size, to control the boundaries\",\r\n    ],\r\n  });\r\n\r\n  definition.inputProps.width.tooltip = {\r\n    dimension: createTooltip({\r\n      title: \"Width\",\r\n      body: unitsBodyText,\r\n    }),\r\n    fixed: fixedTooltip,\r\n  };\r\n\r\n  definition.inputProps.height.tooltip = {\r\n    dimension: createTooltip({\r\n      title: \"Height\",\r\n      body: unitsBodyText,\r\n    }),\r\n    fixed: fixedTooltip,\r\n  };\r\n}\r\n\r\nfunction addDimensionConstraintsTooltips(definition) {\r\n  definition.inputCss.minWidth.tooltip = createTooltip({\r\n    title: \"Minimum width\",\r\n    body: \"This is prioritized over other properties, so the element won't shrink below this size\",\r\n  });\r\n\r\n  definition.inputCss.minHeight.tooltip = createTooltip({\r\n    title: \"Minimum height\",\r\n    body: \"This is prioritized over other properties, so the element won't shrink below this size\",\r\n  });\r\n\r\n  definition.inputCss.maxWidth.tooltip = createTooltip({\r\n    title: \"Maximum width\",\r\n    body: \"This is prioritized over other properties, so the element won't grow beyond this size\",\r\n  });\r\n\r\n  definition.inputCss.maxHeight.tooltip = createTooltip({\r\n    title: \"Maximum height\",\r\n    body: \"This is prioritized over other properties, so the element won't grow beyond this size\",\r\n  });\r\n}\r\n\r\nfunction addPointerEventsTooltips(definition) {\r\n  definition.inputs.pointerEventsMode.tooltip = createTooltip({\r\n    title: \"Pointer events mode\",\r\n    body: [\r\n      \"Control if mouse and touch events are enabled on this node\",\r\n      \"- Inherit: Same settings as parent\",\r\n      \"- Explicit: Enable control on this element\",\r\n    ],\r\n  });\r\n  definition.inputs.pointerEventsEnabled.tooltip = createTooltip({\r\n    title: \"Pointer events enabled\",\r\n    body: [\r\n      \"- Enabled: This element will receive mouse and touch events\",\r\n      \"- Disabled: No mouse or touch events will be captured by this element and the element below will receive it instead\",\r\n    ],\r\n  });\r\n}\r\n\r\nfunction addPositionAndAlignTooltips(definition) {\r\n  definition.inputCss.position.tooltip = createTooltip({\r\n    title: \"Position\",\r\n    images: [\r\n      {\r\n        label: \"Relative\",\r\n        body: \"Relative to its siblings\",\r\n        src: \"position-relative.svg\",\r\n      },\r\n      {\r\n        label: \"Absolute\",\r\n        body: \"Not affected by siblings or parent's layout\",\r\n        src: \"position-absolute.svg\",\r\n      },\r\n      {\r\n        label: \"Sticky\",\r\n        body: \"Stick to parent's edge on overflow\",\r\n        src: \"position-sticky.svg\",\r\n      },\r\n      {\r\n        label: \"Fixed\",\r\n        body: \"Always stay in the same place and take no space in the layout\",\r\n        src: \"position-sticky.svg\",\r\n      },\r\n    ],\r\n  });\r\n}\r\n","import BezierEasing from \"bezier-easing\";\r\nimport { default as EaseCurves } from \"./easecurves\";\r\n\r\ninterface Node {\r\n  _transitions?: { [key: string]: any };\r\n  getInputValue(name: string): any;\r\n  getInput(name: string): { type: string } | null;\r\n  queueInput(name: string, value: any): void;\r\n  context: {\r\n    styles: {\r\n      resolveColor(color: string): string;\r\n    };\r\n    timerScheduler: {\r\n      createTimer(config: {\r\n        duration: number;\r\n        onRunning: (t: number) => void;\r\n        onFinish: () => void;\r\n      }): { start: () => void; stop: () => void };\r\n    };\r\n  };\r\n}\r\n\r\ninterface Transition {\r\n  curve: number[];\r\n  dur: number;\r\n}\r\n\r\nexport default function transitionParameter(\r\n  node: Node,\r\n  name: string,\r\n  endValue: any,\r\n  transition: Transition\r\n): void {\r\n  if (node._transitions && node._transitions[name]) {\r\n    node._transitions[name].stop();\r\n    delete node._transitions[name];\r\n  }\r\n\r\n  const startValue = node.getInputValue(name);\r\n  const input = node.getInput(name);\r\n\r\n  let animation: ((t: number) => any) | undefined;\r\n\r\n  if (input && input.type === \"color\") {\r\n    animation = colorAnimation(\r\n      node.context.styles.resolveColor(startValue),\r\n      node.context.styles.resolveColor(endValue)\r\n    );\r\n  } else if (typeof startValue === \"number\" && typeof endValue === \"number\") {\r\n    animation = numberAnimation(startValue, endValue);\r\n  } else if (\r\n    typeof startValue === \"object\" &&\r\n    startValue.hasOwnProperty(\"value\") &&\r\n    typeof endValue === \"object\" &&\r\n    endValue.hasOwnProperty(\"value\")\r\n  ) {\r\n    animation = numberAnimation(startValue.value, endValue.value);\r\n  }\r\n\r\n  if (animation) {\r\n    if (!node._transitions) node._transitions = {};\r\n\r\n    const ease = BezierEasing(transition.curve);\r\n\r\n    node._transitions[name] = node.context.timerScheduler.createTimer({\r\n      duration: transition.dur,\r\n      onRunning: (t) => {\r\n        // @ts-ignore\r\n        const v = animation(ease.get(t));\r\n        node.queueInput(name, v);\r\n      },\r\n      onFinish: () => {\r\n        // @ts-expect-error\r\n        delete node._transitions[name];\r\n      },\r\n    });\r\n\r\n    node._transitions[name].start();\r\n  } else {\r\n    // no transition supported for this parameter type, so just set it\r\n    node.queueInput(name, endValue);\r\n  }\r\n}\r\n\r\nfunction numberAnimation(start: number, end: number): (t: number) => number {\r\n  return (t) => {\r\n    return EaseCurves.linear(start, end, t);\r\n  };\r\n}\r\n\r\nfunction setRGBA(result: number[], hex: string): void {\r\n  if (hex === \"transparent\" || !hex) {\r\n    result[3] = 0;\r\n    return;\r\n  }\r\n\r\n  const numComponents = (hex.length - 1) / 2;\r\n\r\n  for (let i = 0; i < numComponents; ++i) {\r\n    const index = 1 + i * 2;\r\n    result[i] = parseInt(hex.substring(index, index + 2), 16);\r\n  }\r\n}\r\n\r\nfunction componentToHex(c: number): string {\r\n  const hex = c.toString(16);\r\n  return hex.length === 1 ? \"0\" + hex : hex;\r\n}\r\n\r\nfunction rgbaToHex(rgba: number[]): string {\r\n  return (\r\n    \"#\" +\r\n    componentToHex(rgba[0]) +\r\n    componentToHex(rgba[1]) +\r\n    componentToHex(rgba[2]) +\r\n    componentToHex(rgba[3])\r\n  );\r\n}\r\n\r\nfunction colorAnimation(start: string, end: string): (t: number) => string {\r\n  const rgba0 = [0, 0, 0, 255];\r\n  setRGBA(rgba0, start);\r\n\r\n  const rgba1 = [0, 0, 0, 255];\r\n  setRGBA(rgba1, end);\r\n\r\n  if (!start || start === \"transparent\") {\r\n    rgba0[0] = rgba1[0];\r\n    rgba0[1] = rgba1[1];\r\n    rgba0[2] = rgba1[2];\r\n  }\r\n  if (!end || end === \"transparent\") {\r\n    rgba1[0] = rgba0[0];\r\n    rgba1[1] = rgba0[1];\r\n    rgba1[2] = rgba0[2];\r\n  }\r\n\r\n  const rgba = [0, 0, 0, 0];\r\n\r\n  return (t) => {\r\n    rgba[0] = Math.floor(EaseCurves.linear(rgba0[0], rgba1[0], t));\r\n    rgba[1] = Math.floor(EaseCurves.linear(rgba0[1], rgba1[1], t));\r\n    rgba[2] = Math.floor(EaseCurves.linear(rgba0[2], rgba1[2], t));\r\n    rgba[3] = Math.floor(EaseCurves.linear(rgba0[3], rgba1[3], t));\r\n\r\n    return rgbaToHex(rgba);\r\n  };\r\n}\r\n","\"use strict\";\r\n\r\nimport React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\nimport { DOMBoundingBoxObserver } from \"./dom-boundingbox-oberver\";\r\nimport Layout from \"./layout\";\r\nimport mergeDeep from \"./mergedeep\";\r\nimport NodeSharedPortDefinitions from \"./node-shared-port-definitions\";\r\nimport transitionParameter from \"./node-transitions\";\r\n\r\ninterface Node {\r\n  props: any;\r\n  outputPropValues: { [key: string]: any };\r\n  sendSignalOnOutput: (name: string) => void;\r\n  flagOutputDirty: (name: string) => void;\r\n  forceUpdate: () => void;\r\n  context: any;\r\n  style: any;\r\n  renderedAtFrame: number;\r\n  useFrame: boolean;\r\n  currentVisualStates?: string[];\r\n  getVisualParentNode: () => Node | undefined;\r\n  innerReactComponentRef?: React.Component | null;\r\n}\r\n\r\nfunction addOutputPropHandler(\r\n  node: Node,\r\n  propCallbacks: { [key: string]: Function },\r\n  propPath?: string\r\n) {\r\n  const props = propPath ? node.props[propPath] : node.props;\r\n\r\n  for (const propName in propCallbacks) {\r\n    if (props[propName]) {\r\n      const prevCb = props[propName];\r\n      props[propName] = () => {\r\n        prevCb();\r\n        propCallbacks[propName].call(node);\r\n      };\r\n    } else {\r\n      props[propName] = propCallbacks[propName].bind(node);\r\n    }\r\n  }\r\n  node.forceUpdate();\r\n}\r\n\r\nfunction addPrimitiveOutputPropHandler(node: Node, name: string, output: any) {\r\n  let prop;\r\n\r\n  if (output.type === \"signal\") {\r\n    prop = () => {\r\n      node.sendSignalOnOutput(name);\r\n    };\r\n  } else {\r\n    prop = (...args: any[]) => {\r\n      node.outputPropValues[name] = output.getValue\r\n        ? output.getValue.call(node, ...args)\r\n        : args[0];\r\n      node.flagOutputDirty(name);\r\n      output.onChange &&\r\n        output.onChange.call(node, node.outputPropValues[name]);\r\n    };\r\n  }\r\n\r\n  addOutputPropHandler(node, { [name]: prop }, output.propPath);\r\n}\r\n\r\nfunction defineRegularInputProp(input: any, name: string) {\r\n  if (!input.type) throw new Error(`input ${name} is missing a type`);\r\n\r\n  if (input.type.units) {\r\n    input.set = function (value: any) {\r\n      const props = input.propPath ? this.props[input.propPath] : this.props;\r\n      if (value && value.value !== undefined) {\r\n        props[name] = value.value + value.unit;\r\n      } else {\r\n        delete props[name];\r\n      }\r\n      if (input.onChange) {\r\n        input.onChange.call(this, value);\r\n      }\r\n      this.forceUpdate();\r\n    };\r\n  } else {\r\n    input.set = function (value: any) {\r\n      const props = input.propPath ? this.props[input.propPath] : this.props;\r\n      if (value !== undefined) {\r\n        props[name] = value;\r\n      } else {\r\n        delete props[name];\r\n      }\r\n      if (input.onChange) {\r\n        input.onChange.call(this, value);\r\n      }\r\n      this.forceUpdate();\r\n    };\r\n  }\r\n}\r\n\r\nfunction flattenArray(target: any[], array: any[]) {\r\n  for (const e of array) {\r\n    if (Array.isArray(e)) {\r\n      flattenArray(target, e);\r\n    } else if (e !== undefined) {\r\n      target.push(e);\r\n    }\r\n  }\r\n}\r\n\r\ninterface NoodlReactComponentProps {\r\n  noodlNode: Node;\r\n  style?: React.CSSProperties;\r\n  [key: string]: any;\r\n}\r\n\r\nclass NoodlReactComponent extends React.Component<NoodlReactComponentProps> {\r\n  componentDidMount() {\r\n    this.props.noodlNode.sendSignalOnOutput(\"didMount\");\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.props.noodlNode.sendSignalOnOutput(\"willUnmount\");\r\n    const noodlNode = this.props.noodlNode;\r\n    if (noodlNode.currentVisualStates) {\r\n      const statesToRemove = [\"hover\", \"pressed\", \"focused\"];\r\n      const vs = noodlNode.currentVisualStates.filter(\r\n        (s) => !statesToRemove.includes(s)\r\n      );\r\n      // @ts-expect-error\r\n      noodlNode.setVisualStates(vs);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const { noodlNode, style, ...otherProps } = this.props;\r\n\r\n    let finalStyle = noodlNode.style;\r\n\r\n    if (style) {\r\n      finalStyle = {\r\n        ...noodlNode.style,\r\n        ...style,\r\n      };\r\n    }\r\n\r\n    const props = {\r\n      ref: (ref: React.Component | null) => {\r\n        noodlNode.innerReactComponentRef = ref;\r\n      },\r\n      style: finalStyle,\r\n      ...noodlNode.props,\r\n      ...otherProps,\r\n    };\r\n\r\n    // @ts-expect-error\r\n    if (noodlNode.noodlNodeAsProp) {\r\n      props.noodlNode = noodlNode;\r\n\r\n      const parent = noodlNode.getVisualParentNode();\r\n      if (parent && parent.props.layout) {\r\n        props.parentLayout = parent.props.layout;\r\n      }\r\n    }\r\n\r\n    noodlNode.renderedAtFrame = noodlNode.context.frameNumber;\r\n\r\n    if (noodlNode.useFrame) {\r\n      if (props.textStyle !== undefined) {\r\n        props.style = finalStyle = Object.assign(\r\n          {},\r\n          props.textStyle,\r\n          finalStyle\r\n        );\r\n      }\r\n      Layout.size(finalStyle, props);\r\n      Layout.align(finalStyle, props);\r\n    }\r\n\r\n    return React.createElement(\r\n      // @ts-expect-error\r\n      noodlNode.reactComponent,\r\n      props,\r\n      // @ts-expect-error\r\n      noodlNode.renderChildren()\r\n    );\r\n  }\r\n}\r\n\r\nfunction setStylesOnDOMNode(\r\n  rootElement: HTMLElement,\r\n  styles: { [key: string]: string },\r\n  styleTag?: string\r\n) {\r\n  let element = rootElement;\r\n\r\n  if (styleTag) {\r\n    if (element.getAttribute(\"noodl-style-tag\") !== styleTag) {\r\n      element = rootElement.querySelector(\r\n        `[noodl-style-tag=${styleTag}]`\r\n      ) as HTMLElement;\r\n    }\r\n  }\r\n\r\n  if (!element) return;\r\n\r\n  for (const p in styles) {\r\n    element.style[p] = styles[p];\r\n  }\r\n}\r\n\r\nlet reactKeyCounter = 0;\r\n\r\nfunction createNodeFromReactComponent(def: any) {\r\n  const { frame } = def;\r\n  if (frame !== undefined) {\r\n    if (frame.dimensions) {\r\n      NodeSharedPortDefinitions.addDimensions(\r\n        def,\r\n        typeof frame.dimensions === \"object\" ? frame.dimensions : undefined\r\n      );\r\n    }\r\n\r\n    if (frame.position) NodeSharedPortDefinitions.addTransformInputs(def);\r\n    if (frame.margins) NodeSharedPortDefinitions.addMarginInputs(def);\r\n    if (frame.padding) NodeSharedPortDefinitions.addPaddingInputs(def);\r\n    if (frame.align) NodeSharedPortDefinitions.addAlignInputs(def);\r\n  }\r\n\r\n  const {\r\n    initialize,\r\n    inputs,\r\n    inputProps,\r\n    inputCss,\r\n    outputs,\r\n    outputProps,\r\n    dynamicports,\r\n    defaultCss = {},\r\n    methods,\r\n  } = def;\r\n\r\n  const startStyle = Object.assign({}, defaultCss);\r\n  const startStyles: { [key: string]: any } = {};\r\n\r\n  for (const name in inputCss) {\r\n    const input = inputCss[name];\r\n\r\n    const hasDefault =\r\n      input.hasOwnProperty(\"default\") && input.applyDefault !== false;\r\n    if (input.styleTag && !startStyles.hasOwnProperty(input.styleTag)) {\r\n      startStyles[input.styleTag] = {};\r\n    }\r\n\r\n    if (hasDefault) {\r\n      const value = input.type.units\r\n        ? input.default + input.type.defaultUnit\r\n        : input.default;\r\n      if (input.styleTag) {\r\n        startStyles[input.styleTag][name] = value;\r\n      } else {\r\n        startStyle[name] = value;\r\n      }\r\n    }\r\n  }\r\n\r\n  function boundingBoxObserverCallback(attribute: string, rect: DOMRect) {\r\n    // @ts-expect-error\r\n    this.clientBoundingRect = rect;\r\n    if (attribute === \"x\") {\r\n      // @ts-expect-error\r\n      this.flagOutputDirty(\"screenPositionX\");\r\n    } else if (attribute === \"y\") {\r\n      // @ts-expect-error\r\n      this.flagOutputDirty(\"screenPositionY\");\r\n    } else if (attribute === \"width\") {\r\n      // @ts-expect-error\r\n      this.flagOutputDirty(\"boundingWidth\");\r\n    } else if (attribute === \"height\") {\r\n      // @ts-expect-error\r\n      this.flagOutputDirty(\"boundingHeight\");\r\n    }\r\n  }\r\n\r\n  const useVariants = def.useVariants !== undefined ? def.useVariants : true;\r\n\r\n  const ReactComponentNode: any = {\r\n    name: def.name,\r\n    docs: def.docs,\r\n    displayNodeName: def.displayNodeName || def.displayName,\r\n    shortDesc: \"\",\r\n    category: \"Visual\",\r\n    allowChildren: def.allowChildren === undefined ? true : def.allowChildren,\r\n    visualStates: def.visualStates,\r\n    allowAsExportRoot: def.allowAsExportRoot,\r\n    singleton: def.singleton,\r\n    useVariants,\r\n    usePortAsLabel: def.usePortAsLabel,\r\n    portLabelTruncationMode: def.portLabelTruncationMode,\r\n    connectionPanel: def.connectionPanel,\r\n    nodeDoubleClickAction: def.nodeDoubleClickAction,\r\n    initialize() {\r\n      this.reactKey = \"key\" + reactKeyCounter;\r\n      reactKeyCounter++;\r\n\r\n      this.children = [];\r\n      if (hasChildCountOutput) {\r\n        this.childrenCount = 0;\r\n      }\r\n\r\n      this.props = { styles: {} };\r\n      this.outputPropValues = {};\r\n      this.style = Object.assign({}, startStyle);\r\n\r\n      for (const styleTag in startStyles) {\r\n        this.props.styles[styleTag] = Object.assign({}, startStyles[styleTag]);\r\n      }\r\n      this.childIndex = 0;\r\n      this.clientBoundingRect = {};\r\n      this.noodlNodeAsProp = def.noodlNodeAsProp ? true : false;\r\n\r\n      const pollDelay = this.context && this.context.runningInCanvas ? 300 : 0;\r\n      this.boundingBoxObserver = new DOMBoundingBoxObserver(\r\n        boundingBoxObserverCallback.bind(this),\r\n        pollDelay\r\n      );\r\n\r\n      this.wantsToBeMounted = true;\r\n\r\n      this.useFrame = !!frame;\r\n\r\n      for (const name in inputProps) {\r\n        const input = inputProps[name];\r\n        if (input.propPath && !this.props.hasOwnProperty(input.propPath)) {\r\n          this.props[input.propPath] = {};\r\n        }\r\n\r\n        const props = input.propPath ? this.props[input.propPath] : this.props;\r\n\r\n        if (input.hasOwnProperty(\"default\")) {\r\n          if (input.type.defaultUnit && input.default !== undefined) {\r\n            props[name] = input.default + input.type.defaultUnit;\r\n          } else {\r\n            props[name] = input.default;\r\n          }\r\n        }\r\n      }\r\n\r\n      for (const outputName in outputProps) {\r\n        const output = outputProps[outputName];\r\n        if (output.propPath && !this.props.hasOwnProperty(output.propPath)) {\r\n          this.props[output.propPath] = {};\r\n        }\r\n\r\n        if (!output.props) {\r\n          addPrimitiveOutputPropHandler(this, outputName, output);\r\n        } else {\r\n          addOutputPropHandler(this, output.props, output.propPath);\r\n        }\r\n      }\r\n\r\n      this.reactComponentRef = null;\r\n      this.reactComponent = def.getReactComponent.call(this);\r\n\r\n      if (initialize) {\r\n        initialize.call(this);\r\n      }\r\n    },\r\n    getInspectInfo: def.getInspectInfo,\r\n    nodeScopeDidInitialize: def.nodeScopeDidInitialize,\r\n    dynamicports,\r\n    inputs: {\r\n      cssClassName: {\r\n        index: 100010,\r\n        displayName: \"CSS Class\",\r\n        group: \"Advanced HTML\",\r\n        type: \"string\",\r\n        default: \"\",\r\n        set(value: string) {\r\n          // @ts-expect-error\r\n          this.props.className = value;\r\n          // @ts-expect-error\r\n          this.forceUpdate();\r\n        },\r\n      },\r\n      styleCss: {\r\n        index: 100011,\r\n        displayName: \"CSS Style\",\r\n        group: \"Advanced HTML\",\r\n        type: {\r\n          name: \"string\",\r\n          codeeditor: \"text\",\r\n          allowEditOnly: true,\r\n        },\r\n        default: \"/* background-color: red; */\",\r\n        set(value: string) {\r\n          // @ts-expect-error\r\n          this.updateAdvancedStyle({ content: value });\r\n        },\r\n      },\r\n    },\r\n    outputs: {\r\n      childIndex: {\r\n        displayName: \"Child Index\",\r\n        type: \"number\",\r\n        get() {\r\n          // @ts-expect-error\r\n          return this.childIndex;\r\n        },\r\n      },\r\n      this: {\r\n        displayName: \"This\",\r\n        type: \"reference\",\r\n        get() {\r\n          return this;\r\n        },\r\n      },\r\n      screenPositionX: {\r\n        group: \"Bounding Box\",\r\n        displayName: \"Screen Position X\",\r\n        type: \"number\",\r\n        get() {\r\n          // @ts-expect-error\r\n          return this.clientBoundingRect.x;\r\n        },\r\n        onFirstConnectionAdded() {\r\n          // @ts-expect-error\r\n          this.boundingBoxObserver.addObserver();\r\n        },\r\n        onLastConnectionRemoved() {\r\n          // @ts-expect-error\r\n          this.boundingBoxObserver.removeObserver();\r\n        },\r\n      },\r\n      screenPositionY: {\r\n        group: \"Bounding Box\",\r\n        displayName: \"Screen Position Y\",\r\n        type: \"number\",\r\n        get() {\r\n          // @ts-expect-error\r\n          return this.clientBoundingRect.y;\r\n        },\r\n        onFirstConnectionAdded() {\r\n          // @ts-expect-error\r\n          this.boundingBoxObserver.addObserver();\r\n        },\r\n        onLastConnectionRemoved() {\r\n          // @ts-expect-error\r\n          this.boundingBoxObserver.removeObserver();\r\n        },\r\n      },\r\n      boundingWidth: {\r\n        group: \"Bounding Box\",\r\n        displayName: \"Width\",\r\n        type: \"number\",\r\n        get() {\r\n          // @ts-expect-error\r\n          return this.clientBoundingRect.width;\r\n        },\r\n        onFirstConnectionAdded() {\r\n          // @ts-expect-error\r\n          this.boundingBoxObserver.addObserver();\r\n        },\r\n        onLastConnectionRemoved() {\r\n          // @ts-expect-error\r\n          this.boundingBoxObserver.removeObserver();\r\n        },\r\n      },\r\n      boundingHeight: {\r\n        group: \"Bounding Box\",\r\n        displayName: \"Height\",\r\n        type: \"number\",\r\n        get() {\r\n          // @ts-expect-error\r\n          return this.clientBoundingRect.height;\r\n        },\r\n        onFirstConnectionAdded() {\r\n          // @ts-expect-error\r\n          this.boundingBoxObserver.addObserver();\r\n        },\r\n        onLastConnectionRemoved() {\r\n          // @ts-expect-error\r\n          this.boundingBoxObserver.removeObserver();\r\n        },\r\n      },\r\n      didMount: {\r\n        group: \"Mounted\",\r\n        displayName: \"Did Mount\",\r\n        type: \"signal\",\r\n      },\r\n      willUnmount: {\r\n        group: \"Mounted\",\r\n        displayName: \"Will Unmount\",\r\n        type: \"signal\",\r\n      },\r\n    },\r\n    methods: {\r\n      updateAdvancedStyle(params: { content: string }) {\r\n        // @ts-expect-error\r\n        if (this.customCssStyles) {\r\n          // @ts-expect-error\r\n          this.removeStyle(Object.keys(this.customCssStyles));\r\n          // @ts-expect-error\r\n          this.customCssStyles = undefined;\r\n        }\r\n\r\n        let style: { [key: string]: string } = {};\r\n        let errorMessage = \"\";\r\n\r\n        let rawCss = (params.content || \"\").replace(\"\\n\", \"\");\r\n\r\n        let css = \"\";\r\n        while (rawCss.length) {\r\n          let nextComment = rawCss.indexOf(\"/*\");\r\n          if (nextComment === -1) {\r\n            nextComment = rawCss.length;\r\n          }\r\n          css += rawCss.substring(0, nextComment);\r\n          rawCss = rawCss.substring(nextComment);\r\n\r\n          if (rawCss.length) {\r\n            let endComment = rawCss.indexOf(\"*/\");\r\n            if (endComment === -1) endComment = rawCss.length;\r\n            rawCss = rawCss.substring(endComment + 2);\r\n          }\r\n        }\r\n        function trim(s: string) {\r\n          return s.replace(/^\\s+|\\s+$/gm, \"\");\r\n        }\r\n\r\n        const styles = css\r\n          .split(\";\")\r\n          .map(trim)\r\n          .filter((s) => s.length);\r\n\r\n        for (const s of styles) {\r\n          const parts = s.split(\":\").map(trim);\r\n\r\n          if (s.indexOf(\"\\n\") !== -1) {\r\n            errorMessage += \"Missing semicolon: \" + s.split(\"\\n\")[0];\r\n          } else if (parts.length !== 2) {\r\n            errorMessage += \"Syntax error: \" + s;\r\n          } else {\r\n            const nameParts = parts[0].split(\"-\");\r\n            for (let i = 1; i < nameParts.length; i++) {\r\n              nameParts[i] =\r\n                nameParts[i][0].toUpperCase() + nameParts[i].substring(1);\r\n            }\r\n            style[nameParts.join(\"\")] = parts[1];\r\n          }\r\n        }\r\n\r\n        if (errorMessage) {\r\n          // @ts-expect-error\r\n          this.context.editorConnection.sendWarning(\r\n            // @ts-expect-error\r\n            this.nodeScope.componentOwner.name,\r\n            // @ts-expect-error\r\n            this.id,\r\n            \"css-parse-waring\",\r\n            {\r\n              message: \"Error in CSS Style<br>\" + errorMessage,\r\n            }\r\n          );\r\n        } else {\r\n          // @ts-expect-error\r\n          this.context.editorConnection.clearWarning(\r\n            // @ts-expect-error\r\n            this.nodeScope.componentOwner.name,\r\n            // @ts-expect-error\r\n            this.id,\r\n            \"css-parse-waring\"\r\n          );\r\n          style && this.setStyle(style);\r\n          // @ts-expect-error\r\n          this.customCssStyles = style;\r\n        }\r\n      },\r\n      setChildIndex(index: number) {\r\n        // @ts-expect-error\r\n        this.childIndex = index;\r\n        // @ts-expect-error\r\n        this.flagOutputDirty(\"childIndex\");\r\n      },\r\n      updateChildIndices() {\r\n        let indexOffset = 0;\r\n        // @ts-expect-error\r\n        for (let i = 0; i < this.children.length; i++) {\r\n          // @ts-expect-error\r\n          const child = this.children[i];\r\n          if (\r\n            child.name === \"For Each\" ||\r\n            child.name === \"Component Children\"\r\n          ) {\r\n            indexOffset--;\r\n          }\r\n          child.setChildIndex && child.setChildIndex(i + indexOffset);\r\n        }\r\n      },\r\n      updateChildrenCount() {\r\n        let count = 0;\r\n        // @ts-expect-error\r\n        this.children.forEach((child: any) => {\r\n          if (child?.model?.type === \"For Each\") {\r\n            count += child.model.children.length;\r\n          } else {\r\n            count++;\r\n          }\r\n        });\r\n        // @ts-expect-error\r\n        this.childrenCount = count;\r\n        // @ts-expect-error\r\n        this.flagOutputDirty(\"childrenCount\");\r\n      },\r\n      addChild(child: any, index?: number) {\r\n        if (index === undefined) {\r\n          // @ts-expect-error\r\n          index = this.children.length;\r\n        }\r\n\r\n        child.parent = this;\r\n        // @ts-expect-error\r\n        this.children.splice(index, 0, child);\r\n        // @ts-expect-error\r\n        this.cachedChildren = undefined;\r\n        this.scheduleUpdateChildCountAndIndicies();\r\n        this.forceUpdate();\r\n      },\r\n      removeChild(child: any) {\r\n        // @ts-expect-error\r\n        const index = this.children.indexOf(child);\r\n        if (index !== -1) {\r\n          // @ts-expect-error\r\n          this.children.splice(index, 1);\r\n          child.parent = undefined;\r\n\r\n          // @ts-expect-error\r\n          this.cachedChildren = undefined;\r\n          this.scheduleUpdateChildCountAndIndicies();\r\n          this.forceUpdate();\r\n        }\r\n      },\r\n      contains(node: any) {\r\n        // @ts-expect-error\r\n        const index = this.children.indexOf(node);\r\n        if (index !== -1) return true;\r\n\r\n        // @ts-expect-error\r\n        return this.children.some(\r\n          (child: any) => child.contains && child.contains(node)\r\n        );\r\n      },\r\n      scheduleUpdateChildCountAndIndicies() {\r\n        // @ts-expect-error\r\n        if (this.updateChildIndiciesScheduled) return;\r\n        // @ts-expect-error\r\n        this.updateChildIndiciesScheduled = true;\r\n        // @ts-expect-error\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          this.updateChildIndices();\r\n          if (hasChildCountOutput) {\r\n            this.updateChildrenCount();\r\n          }\r\n          // @ts-expect-error\r\n          this.updateChildIndiciesScheduled = false;\r\n        });\r\n      },\r\n      getChildren() {\r\n        // @ts-expect-error\r\n        return this.children;\r\n      },\r\n      isChild(child: any) {\r\n        // @ts-expect-error\r\n        return this.children.indexOf(child) !== -1;\r\n      },\r\n      getChildRoot() {\r\n        return this;\r\n      },\r\n      forceUpdate() {\r\n        // @ts-expect-error\r\n        if (this.forceUpdateScheduled === true) return;\r\n        // @ts-expect-error\r\n        this.forceUpdateScheduled = true;\r\n\r\n        // @ts-expect-error\r\n        this.context.eventEmitter.once(\"frameEnd\", () => {\r\n          // @ts-expect-error\r\n          this.forceUpdateScheduled = false;\r\n\r\n          // @ts-expect-error\r\n          if (this.renderedAtFrame === this.context.frameNumber) {\r\n            return;\r\n          }\r\n\r\n          // @ts-expect-error\r\n          this.reactComponentRef && this.reactComponentRef.setState({});\r\n        });\r\n        // @ts-expect-error\r\n        this.context.scheduleUpdate();\r\n      },\r\n      _resetReactVirtualDOM() {\r\n        // @ts-expect-error\r\n        this.reactKey = \"key\" + reactKeyCounter;\r\n        reactKeyCounter++;\r\n        const parent = this.getVisualParentNode();\r\n        if (parent) {\r\n          parent.cachedChildren = undefined;\r\n          parent.forceUpdate();\r\n        }\r\n      },\r\n      triggerDidMount() {\r\n        // @ts-expect-error\r\n        if (this.wantsToBeMounted && !this.didCallTriggerDidMount) {\r\n          // @ts-expect-error\r\n          this.didCallTriggerDidMount = true;\r\n\r\n          // @ts-expect-error\r\n          if (this.hasOutput(\"didMount\")) {\r\n            // @ts-expect-error\r\n            this.sendSignalOnOutput(\"didMount\");\r\n          }\r\n\r\n          // @ts-expect-error\r\n          if (this.props.didMount) {\r\n            // @ts-expect-error\r\n            this.props.didMount();\r\n          }\r\n\r\n          // @ts-expect-error\r\n          if (this.didMount) {\r\n            // @ts-expect-error\r\n            this.didMount();\r\n          }\r\n        }\r\n\r\n        // @ts-expect-error\r\n        this.children.forEach((child: any) => {\r\n          child.triggerDidMount && child.triggerDidMount();\r\n        });\r\n      },\r\n      render() {\r\n        // @ts-expect-error\r\n        if (!this.wantsToBeMounted) {\r\n          return;\r\n        }\r\n\r\n        return React.createElement(NoodlReactComponent, {\r\n          // @ts-expect-error\r\n          key: this.reactKey,\r\n          // @ts-expect-error\r\n          noodlNode: this,\r\n          ref: (ref: React.Component | null) => {\r\n            // @ts-expect-error\r\n            this.reactComponentRef = ref;\r\n            // @ts-expect-error\r\n            this.boundingBoxObserver.setTarget(ReactDOM.findDOMNode(ref));\r\n          },\r\n        });\r\n      },\r\n      renderChildren() {\r\n        // @ts-expect-error\r\n        if (!this.cachedChildren) {\r\n          // @ts-expect-error\r\n          let c = this.children.map((child: any) => child.render());\r\n\r\n          let children: any[] = [];\r\n          flattenArray(children, c);\r\n\r\n          if (children.length === 0) {\r\n            // @ts-expect-error\r\n            children = null;\r\n          } else if (children.length === 1) {\r\n            children = children[0];\r\n          }\r\n\r\n          // @ts-expect-error\r\n          this.cachedChildren = children;\r\n        }\r\n\r\n        // @ts-expect-error\r\n        return this.cachedChildren;\r\n      },\r\n      setStyle(newStyles: { [key: string]: string }, styleTag?: string) {\r\n        // @ts-expect-error\r\n        const styleObject = styleTag ? this.props.styles[styleTag] : this.style;\r\n\r\n        for (const p in newStyles) {\r\n          styleObject[p] = newStyles[p];\r\n        }\r\n\r\n        const domElement = this.getDOMElement();\r\n        if (!domElement) return;\r\n\r\n        let forceUpdate = false;\r\n\r\n        if (!styleTag) {\r\n          if (newStyles.hasOwnProperty(\"opacity\")) {\r\n            forceUpdate =\r\n              newStyles.hasOwnProperty(\"opacity\") &&\r\n              // @ts-expect-error\r\n              ((domElement.style.opacity === \"0\" && newStyles.opacity > 0) ||\r\n                // @ts-expect-error\r\n                (domElement.style.opacity !== \"0\" && newStyles.opacity === 0));\r\n          }\r\n          if (newStyles.transform) {\r\n            let transform = newStyles.transform;\r\n\r\n            const parent = this.getVisualParentNode();\r\n            if (\r\n              // @ts-expect-error\r\n              this.style.position === \"absolute\" ||\r\n              !parent ||\r\n              !parent.style.flexDirection\r\n            ) {\r\n              if (\r\n                // @ts-expect-error\r\n                this.props.alignX === \"center\" &&\r\n                // @ts-expect-error\r\n                !(domElement.style.marginLeft && domElement.style.marginRight)\r\n              )\r\n                transform = \"translateX(-50%) \" + transform;\r\n              if (\r\n                // @ts-expect-error\r\n                this.props.alignY === \"center\" &&\r\n                // @ts-expect-error\r\n                !(domElement.style.marginTop && domElement.style.marginBottom)\r\n              )\r\n                transform = \"translateY(-50%) \" + transform;\r\n            }\r\n\r\n            newStyles.transform = transform;\r\n          }\r\n\r\n          const marginsChanged =\r\n            newStyles.hasOwnProperty(\"marginLeft\") ||\r\n            newStyles.hasOwnProperty(\"marginRight\") ||\r\n            newStyles.hasOwnProperty(\"marginTop\") ||\r\n            newStyles.hasOwnProperty(\"marginBottom\");\r\n          const sizeInPercent =\r\n            // @ts-expect-error\r\n            (this.props.width &&\r\n              // @ts-expect-error\r\n              this.props.width[this.props.width.length - 1] === \"%\") ||\r\n            // @ts-expect-error\r\n            (this.props.height &&\r\n              // @ts-expect-error\r\n              this.props.height[this.props.height.length - 1] === \"%\");\r\n          if (sizeInPercent && marginsChanged) {\r\n            forceUpdate = true;\r\n          }\r\n\r\n          if (newStyles.position || newStyles.flexDirection || newStyles.clip) {\r\n            forceUpdate = true;\r\n          }\r\n        }\r\n\r\n        if (forceUpdate) {\r\n          this.forceUpdate();\r\n        } else {\r\n          // @ts-expect-error\r\n          setStylesOnDOMNode(domElement, newStyles, styleTag);\r\n        }\r\n      },\r\n      removeStyle(styles: string[], styleTag?: string) {\r\n        // @ts-expect-error\r\n        const styleObject = styleTag ? this.props.styles[styleTag] : this.style;\r\n\r\n        for (const p of styles) {\r\n          delete styleObject[p];\r\n        }\r\n\r\n        const domElement = this.getDOMElement();\r\n\r\n        let forceUpdate = false;\r\n        if (!styleTag && domElement) {\r\n          const forceUpdateAttributes = {\r\n            marginTop: true,\r\n            marginBottom: true,\r\n            marginLeft: true,\r\n            marginRight: true,\r\n          };\r\n\r\n          for (const p of styles) {\r\n            if (forceUpdateAttributes[p]) forceUpdate = true;\r\n          }\r\n        }\r\n\r\n        if (domElement) {\r\n          const newStyles: { [key: string]: string } = {};\r\n          for (const p of styles) {\r\n            newStyles[p] = \"\";\r\n          }\r\n          // @ts-expect-error\r\n          setStylesOnDOMNode(domElement, newStyles, styleTag);\r\n        }\r\n\r\n        if (forceUpdate) {\r\n          this.forceUpdate();\r\n        }\r\n      },\r\n      getStyle(style: string) {\r\n        // @ts-expect-error\r\n        return this.style[style];\r\n      },\r\n      getRef() {\r\n        // @ts-expect-error\r\n        return this.reactComponentRef;\r\n      },\r\n      getDOMElement() {\r\n        const ref = this.getRef();\r\n        if (!ref) return;\r\n\r\n        return ReactDOM.findDOMNode(ref);\r\n      },\r\n      getVisualParentNode() {\r\n        // @ts-expect-error\r\n        if (this.parent) return this.parent;\r\n\r\n        // @ts-expect-error\r\n        let component = this.nodeScope.componentOwner;\r\n        while (!component.parent && component.parentNodeScope) {\r\n          component = component.parentNodeScope.componentOwner;\r\n        }\r\n\r\n        return component ? component.parent : undefined;\r\n      },\r\n      setVariant(variant: any) {\r\n        this._stopStateTransitions();\r\n\r\n        // @ts-expect-error\r\n        this.variant = variant;\r\n\r\n        const parameters: { [key: string]: any } = {};\r\n        variant && mergeDeep(parameters, variant.parameters);\r\n        // @ts-expect-error\r\n        mergeDeep(parameters, this.model.parameters);\r\n\r\n        // @ts-expect-error\r\n        if (this.currentVisualStates) {\r\n          const stateParameters = this.getParametersForStates(\r\n            // @ts-expect-error\r\n            this.currentVisualStates\r\n          );\r\n          mergeDeep(parameters, stateParameters);\r\n        }\r\n\r\n        const parametersToSet = Object.keys(parameters).filter(\r\n          // @ts-expect-error\r\n          (p) => !this._hasInputBeenSetFromAConnection(p)\r\n        );\r\n\r\n        for (const inputName of parametersToSet) {\r\n          // @ts-expect-error\r\n          this.registerInputIfNeeded(inputName);\r\n\r\n          // @ts-expect-error\r\n          if (this.hasInput(inputName)) {\r\n            // @ts-expect-error\r\n            this.queueInput(inputName, parameters[inputName]);\r\n          }\r\n        }\r\n      },\r\n      getParameter(name: string) {\r\n        // @ts-expect-error\r\n        if (this.model.parameters.hasOwnProperty(name)) {\r\n          // @ts-expect-error\r\n          return this.model.parameters[name];\r\n        } else if (\r\n          // @ts-expect-error\r\n          this.variant &&\r\n          // @ts-expect-error\r\n          this.variant.parameters.hasOwnProperty(name)\r\n        ) {\r\n          // @ts-expect-error\r\n          return this.variant.parameters[name];\r\n        } else {\r\n          // @ts-expect-error\r\n          return this.context.getDefaultValueForInput(this.model.type, name);\r\n        }\r\n      },\r\n      getParametersForStates(states: string[]) {\r\n        const params: { [key: string]: any } = {};\r\n\r\n        // @ts-expect-error\r\n        if (this.variant) {\r\n          for (const state of states) {\r\n            if (\r\n              // @ts-expect-error\r\n              this.variant.stateParameters &&\r\n              // @ts-expect-error\r\n              this.variant.stateParameters.hasOwnProperty(state)\r\n            ) {\r\n              // @ts-expect-error\r\n              mergeDeep(params, this.variant.stateParameters[state]);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (const param in params) {\r\n          // @ts-expect-error\r\n          if (this.model.parameters.hasOwnProperty(param)) {\r\n            if (isObject(params[param])) {\r\n              // @ts-expect-error\r\n              mergeDeep(params[param], this.model.parameters[param]);\r\n            } else {\r\n              // @ts-expect-error\r\n              params[param] = this.model.parameters[param];\r\n            }\r\n          }\r\n        }\r\n\r\n        // @ts-expect-error\r\n        if (this.model.stateParameters) {\r\n          for (const state of states) {\r\n            // @ts-expect-error\r\n            if (this.model.stateParameters.hasOwnProperty(state)) {\r\n              // @ts-expect-error\r\n              mergeDeep(params, this.model.stateParameters[state]);\r\n            }\r\n          }\r\n        }\r\n\r\n        return params;\r\n      },\r\n      _getNewState(prevStates: string[], newStates: string[]) {\r\n        const addedStates = newStates.filter(\r\n          (value) => !(prevStates || []).includes(value)\r\n        );\r\n        const newState = addedStates.length ? addedStates[0] : \"neutral\";\r\n\r\n        return newState === \"\" ? \"neutral\" : newState;\r\n      },\r\n      _getDefaultTransition(state: string) {\r\n        if (\r\n          // @ts-expect-error\r\n          this.model.defaultStateTransitions &&\r\n          // @ts-expect-error\r\n          this.model.defaultStateTransitions[state] &&\r\n          // @ts-expect-error\r\n          this.model.defaultStateTransitions[state].curve\r\n        ) {\r\n          // @ts-expect-error\r\n          return this.model.defaultStateTransitions[state];\r\n        } else if (\r\n          // @ts-expect-error\r\n          this.variant &&\r\n          // @ts-expect-error\r\n          this.variant.defaultStateTransitions &&\r\n          // @ts-expect-error\r\n          this.variant.defaultStateTransitions[state] &&\r\n          // @ts-expect-error\r\n          this.variant.defaultStateTransitions[state].curve\r\n        ) {\r\n          // @ts-expect-error\r\n          return this.variant.defaultStateTransitions[state];\r\n        }\r\n      },\r\n      _getStateTransition(state: string) {\r\n        let transitions: { [key: string]: any } = {};\r\n\r\n        // @ts-expect-error\r\n        if (this.model.stateTransitions && this.model.stateTransitions[state]) {\r\n          // @ts-expect-error\r\n          Object.assign(transitions, this.model.stateTransitions[state]);\r\n        }\r\n\r\n        if (\r\n          // @ts-expect-error\r\n          this.variant &&\r\n          // @ts-expect-error\r\n          this.variant.stateTransitions &&\r\n          // @ts-expect-error\r\n          this.variant.stateTransitions[state]\r\n        ) {\r\n          // @ts-expect-error\r\n          Object.assign(transitions, this.variant.stateTransitions[state]);\r\n        }\r\n\r\n        return transitions;\r\n      },\r\n      setVisualStates(newStates: string[]) {\r\n        // @ts-expect-error\r\n        if (!this.model) {\r\n          return;\r\n        }\r\n\r\n        const statesAreEqual =\r\n          // @ts-expect-error\r\n          this.currentVisualStates &&\r\n          // @ts-expect-error\r\n          newStates.length === this.currentVisualStates.length &&\r\n          newStates.every(\r\n            // @ts-expect-error\r\n            (val, index) => val === this.currentVisualStates[index]\r\n          );\r\n        if (statesAreEqual) return;\r\n\r\n        // @ts-expect-error\r\n        const prevStateParams = this.currentVisualStates\r\n          ? // @ts-expect-error\r\n            this.getParametersForStates(this.currentVisualStates)\r\n          : {};\r\n        const newStateParams = this.getParametersForStates(newStates);\r\n\r\n        // @ts-expect-error\r\n        const newState = this._getNewState(this.currentVisualStates, newStates);\r\n\r\n        // @ts-expect-error\r\n        this.currentVisualStates = newStates;\r\n\r\n        const newValues: { [key: string]: any } = {};\r\n\r\n        for (const param in prevStateParams) {\r\n          if (\r\n            !newStateParams.hasOwnProperty(param) &&\r\n            // @ts-expect-error\r\n            !this._hasInputBeenSetFromAConnection(param)\r\n          ) {\r\n            const value = this.getParameter(param);\r\n            if (value !== undefined) {\r\n              newValues[param] = this.getParameter(param);\r\n            }\r\n          }\r\n        }\r\n\r\n        for (const param in newStateParams) {\r\n          if (\r\n            // @ts-expect-error\r\n            !this._hasInputBeenSetFromAConnection(param) &&\r\n            newStateParams[param] !== undefined\r\n          ) {\r\n            newValues[param] = newStateParams[param];\r\n          }\r\n        }\r\n\r\n        const defaultTransition = this._getDefaultTransition(newState);\r\n        const stateTransition = this._getStateTransition(newState);\r\n\r\n        for (const param in newValues) {\r\n          if (stateTransition[param] && stateTransition[param].curve) {\r\n            transitionParameter(\r\n              // @ts-expect-error\r\n              this,\r\n              param,\r\n              newValues[param],\r\n              stateTransition[param]\r\n            );\r\n          } else if (!stateTransition[param] && defaultTransition) {\r\n            transitionParameter(\r\n              // @ts-expect-error\r\n              this,\r\n              param,\r\n              newValues[param],\r\n              defaultTransition\r\n            );\r\n          } else {\r\n            // @ts-expect-error\r\n            if (this._transitions && this._transitions[param]) {\r\n              // @ts-expect-error\r\n              this._transitions[param].stop();\r\n              // @ts-expect-error\r\n              delete this._transitions[param];\r\n            }\r\n\r\n            // @ts-expect-error\r\n            this.queueInput(param, newValues[param]);\r\n          }\r\n        }\r\n      },\r\n      _getVisualStates() {\r\n        // @ts-expect-error\r\n        return this.currentVisualStates || [];\r\n      },\r\n      _stopStateTransitions() {\r\n        // @ts-expect-error\r\n        if (!this._transitions) return;\r\n\r\n        // @ts-expect-error\r\n        for (const name in this._transitions) {\r\n          // @ts-expect-error\r\n          this._transitions[name].stop();\r\n          // @ts-expect-error\r\n          delete this._transitions[name];\r\n        }\r\n      },\r\n    },\r\n  };\r\n\r\n  if (useVariants) {\r\n    ReactComponentNode.inputs.variant = {\r\n      displayName: \"Variant\",\r\n      group: \"General\",\r\n      type: {\r\n        name: \"string\",\r\n        allowConnectionsOnly: true,\r\n      },\r\n      set(variantName: string) {\r\n        if (this.variant && this.variant.name === variantName) return;\r\n        const variant = this.context.variants.getVariant(\r\n          this.model.type,\r\n          variantName\r\n        );\r\n        variant && this.setVariant(variant);\r\n      },\r\n    };\r\n  }\r\n\r\n  if (def.mountedInput !== false) {\r\n    ReactComponentNode.inputs.mounted = {\r\n      displayName: \"Mounted\",\r\n      index: 9999,\r\n      type: \"boolean\",\r\n      group: \"General\",\r\n      default: true,\r\n      set(value: boolean) {\r\n        value = value ? true : false;\r\n        if (this.wantsToBeMounted !== value) {\r\n          this.wantsToBeMounted = value;\r\n          const parent = this.getVisualParentNode();\r\n          if (parent) {\r\n            parent.cachedChildren = undefined;\r\n            parent.forceUpdate();\r\n          }\r\n        }\r\n      },\r\n    };\r\n  }\r\n\r\n  const hasChildCountOutput =\r\n    ReactComponentNode.allowChildren || ReactComponentNode.displayName;\r\n\r\n  if (hasChildCountOutput) {\r\n    ReactComponentNode.outputs.childrenCount = {\r\n      displayName: \"Children Count\",\r\n      type: \"number\",\r\n      get() {\r\n        return this.childrenCount;\r\n      },\r\n    };\r\n  }\r\n\r\n  for (const name in inputs) {\r\n    ReactComponentNode.inputs[name] = inputs[name];\r\n  }\r\n\r\n  for (const inputName in inputProps) {\r\n    const input = inputProps[inputName];\r\n    if (input.type === \"node\") {\r\n      input.type = \"reference\";\r\n      input.set = function (value: any) {\r\n        const props = input.propPath ? this.props[input.propPath] : this.props;\r\n        if (value !== undefined) {\r\n          props[inputName] = value.render();\r\n        } else {\r\n          delete props[inputName];\r\n        }\r\n        this.forceUpdate();\r\n      };\r\n    } else {\r\n      if (input.type === \"signal\") {\r\n        console.error(\r\n          `Error: Signals not supported as a react prop. node: '${def.name}' input: '${inputName}'`\r\n        );\r\n      } else {\r\n        defineRegularInputProp(input, inputName);\r\n      }\r\n    }\r\n\r\n    ReactComponentNode.inputs[inputName] = input;\r\n  }\r\n\r\n  for (const name in inputCss) {\r\n    const input = inputCss[name];\r\n    const styleTargetName = input.targetStyleProperty || name;\r\n\r\n    if (input.type.units) {\r\n      input.set = function (value: any) {\r\n        if (typeof value !== \"object\" && input.type.defaultUnit) {\r\n          value = { value, unit: input.type.defaultUnit };\r\n        }\r\n\r\n        if (typeof value === \"object\" && value.value !== undefined) {\r\n          this.setStyle(\r\n            { [styleTargetName]: value.value + value.unit },\r\n            input.styleTag\r\n          );\r\n        } else if (value !== undefined) {\r\n          this.setStyle({ [styleTargetName]: value }, input.styleTag);\r\n        } else {\r\n          this.removeStyle([styleTargetName], input.styleTag);\r\n        }\r\n        if (input.onChange) {\r\n          input.onChange.call(this, value);\r\n        }\r\n      };\r\n    } else {\r\n      input.set = function (value: any) {\r\n        if (value !== undefined) {\r\n          this.setStyle({ [styleTargetName]: value }, input.styleTag);\r\n        } else {\r\n          this.removeStyle([styleTargetName], input.styleTag);\r\n        }\r\n        if (input.onChange) {\r\n          input.onChange.call(this, value);\r\n        }\r\n      };\r\n    }\r\n\r\n    ReactComponentNode.inputs[name] = input;\r\n  }\r\n\r\n  for (const name in outputs) {\r\n    ReactComponentNode.outputs[name] = outputs[name];\r\n  }\r\n\r\n  for (const name in outputProps) {\r\n    const output = outputProps[name];\r\n\r\n    if (output.type !== \"signal\") {\r\n      output.get = function () {\r\n        return this.outputPropValues[name];\r\n      };\r\n    }\r\n\r\n    ReactComponentNode.outputs[name] = output;\r\n  }\r\n\r\n  for (const name in methods) {\r\n    ReactComponentNode.methods[name] = methods[name];\r\n  }\r\n\r\n  return {\r\n    node: ReactComponentNode,\r\n    setup: def.setup,\r\n  };\r\n}\r\n\r\nfunction isObject(item: any) {\r\n  return item && typeof item === \"object\" && !Array.isArray(item);\r\n}\r\n\r\nexport { createNodeFromReactComponent };\r\n","const pointerEvents = [\r\n  \"onClick\",\r\n  \"onMouseDown\",\r\n  \"onMouseMove\",\r\n  \"onMouseUp\",\r\n  \"onMouseEnter\",\r\n  \"onMouseLeave\",\r\n  \"onMouseOver\",\r\n  \"onMouseOut\",\r\n  \"onTouchStart\",\r\n  \"onTouchMove\",\r\n  \"onTouchEnd\",\r\n  \"onTouchCancel\",\r\n  \"onPointerDown\",\r\n  \"onPointerMove\",\r\n  \"onPointerUp\",\r\n  \"onPointerCancel\",\r\n];\r\n\r\n//These should not be blocked, it causes some annoying behaviour when using hover\r\nconst pointerEventsNotToBlock = new Set([\"onMouseLeave\", \"onMouseOut\"]);\r\n\r\nexport default function pointerProps(props) {\r\n  const newProps = {};\r\n\r\n  for (const eventName of pointerEvents) {\r\n    if (props.blockTouch && !pointerEventsNotToBlock.has(eventName)) {\r\n      //Noodl stores pointer event callbacks in props.pointer\r\n      if (props.pointer && props.pointer[eventName]) {\r\n        newProps[eventName] = (e) => {\r\n          props.pointer[eventName](e);\r\n          e.stopPropagation();\r\n        };\r\n      }\r\n      //some third party library might add pointer event callbacks as well, so look for callbacks directly on the props object\r\n      else if (props[eventName]) {\r\n        newProps[eventName] = (e) => {\r\n          props[eventName](e);\r\n          e.stopPropagation();\r\n        };\r\n      } else {\r\n        //there was no existing listener, so create a new one that just blocks\r\n        newProps[eventName] = (e) => {\r\n          e.stopPropagation();\r\n        };\r\n      }\r\n    }\r\n    //check if third party code added a listener\r\n    else if (props[eventName]) {\r\n      newProps[eventName] = props[eventName];\r\n    }\r\n    //check if Noodl added a listener\r\n    else if (props.pointer) {\r\n      newProps[eventName] = props.pointer[eventName];\r\n    }\r\n  }\r\n\r\n  if (props.noodlNode) {\r\n    for (const p in newProps) {\r\n      const f = newProps[p];\r\n      if (f) {\r\n        newProps[p] = (e) => {\r\n          // @ts-expect-error\r\n          f.call(this, e);\r\n          props.noodlNode.context.updateDirtyNodes();\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  return newProps;\r\n}\r\n","import PointerListeners from \"../../pointerlisteners\";\r\n\r\nfunction _shallowCompare(o1, o2) {\r\n  let p;\r\n  for (p in o1) {\r\n    if (o1.hasOwnProperty(p)) {\r\n      if (o1[p] !== o2[p]) {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n  for (p in o2) {\r\n    if (o2.hasOwnProperty(p)) {\r\n      if (o1[p] !== o2[p]) {\r\n        return false;\r\n      }\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\nconst _styleSheets = {};\r\n\r\nfunction updateStylesForClass(_class, props, _styleTemplate) {\r\n  if (_styleSheets[_class]) {\r\n    // Check if props have changed\r\n    if (!_shallowCompare(props, _styleSheets[_class].props)) {\r\n      _styleSheets[_class].style.innerHTML = _styleTemplate(_class, props);\r\n      _styleSheets[_class].props = Object.assign({}, props);\r\n    }\r\n  } else {\r\n    // Create a new style sheet if none exists\r\n    const style = document.createElement(\"style\");\r\n    style.innerHTML = _styleTemplate(_class, props);\r\n    document.head.appendChild(style);\r\n\r\n    _styleSheets[_class] = { style, props: Object.assign({}, props) };\r\n  }\r\n}\r\n\r\nfunction mergeAttribute(definition, attribute, values) {\r\n  if (!definition[attribute]) {\r\n    definition[attribute] = {};\r\n  }\r\n\r\n  for (const name in values) {\r\n    definition[attribute][name] = values[name];\r\n  }\r\n}\r\n\r\nfunction addInputs(definition, values) {\r\n  mergeAttribute(definition, \"inputs\", values);\r\n}\r\n\r\nfunction addInputProps(definition, values) {\r\n  mergeAttribute(definition, \"inputProps\", values);\r\n}\r\n\r\nfunction addOutputProps(definition, values) {\r\n  mergeAttribute(definition, \"outputProps\", values);\r\n}\r\n\r\nfunction addOutputs(definition, values) {\r\n  mergeAttribute(definition, \"outputs\", values);\r\n}\r\n\r\nfunction addControlEventsAndStates(definition, args?) {\r\n  args = args || {};\r\n\r\n  definition.visualStates = [\r\n    { name: \"neutral\", label: \"Neutral\" },\r\n    { name: \"hover\", label: \"Hover\" },\r\n    { name: \"pressed\", label: \"Pressed\" },\r\n    { name: \"focused\", label: \"Focused\" },\r\n    { name: \"disabled\", label: \"Disabled\" },\r\n  ];\r\n\r\n  if (args.checked) {\r\n    definition.visualStates.splice(3, 0, { name: \"checked\", label: \"Checked\" });\r\n  }\r\n\r\n  addInputs(definition, {\r\n    enabled: {\r\n      type: \"boolean\",\r\n      displayName: \"Enabled\",\r\n      group: \"General\",\r\n      default: true,\r\n      set: function (value) {\r\n        value = !!value;\r\n        // @ts-expect-error\r\n        const changed = value !== this._internal.enabled;\r\n        // @ts-expect-error\r\n        this.props.enabled = this._internal.enabled = value;\r\n\r\n        if (changed) {\r\n          // @ts-expect-error\r\n          this._updateVisualState();\r\n          // @ts-expect-error\r\n          this.forceUpdate();\r\n          // @ts-expect-error\r\n          this.flagOutputDirty(\"enabled\");\r\n        }\r\n      },\r\n    },\r\n  });\r\n\r\n  addInputProps(definition, {\r\n    blockTouch: {\r\n      index: 450,\r\n      displayName: \"Block Pointer Events\",\r\n      type: \"boolean\",\r\n      group: \"Pointer Events\",\r\n    },\r\n  });\r\n\r\n  definition.methods._updateVisualState = function () {\r\n    const states = [];\r\n\r\n    //make sure they are in the order they should be applied\r\n    if (this._internal.enabled) {\r\n      // @ts-expect-error\r\n      if (this.outputPropValues.hoverState) states.push(\"hover\");\r\n      // @ts-expect-error\r\n      if (this.outputPropValues.pressedState) states.push(\"pressed\");\r\n      // @ts-expect-error\r\n      if (this.outputPropValues.focusState) states.push(\"focused\");\r\n    }\r\n\r\n    // @ts-expect-error\r\n    if (args.checked && this._internal.checked) states.push(\"checked\");\r\n    // @ts-expect-error\r\n    if (!this._internal.enabled) states.push(\"disabled\");\r\n\r\n    this.setVisualStates(states);\r\n  };\r\n\r\n  addOutputProps(definition, {\r\n    // Focus\r\n    focusState: {\r\n      displayName: \"Focused\",\r\n      group: \"States\",\r\n      type: \"boolean\",\r\n      props: {\r\n        onFocus() {\r\n          // @ts-expect-error\r\n          this.outputPropValues.focusState = true;\r\n          // @ts-expect-error\r\n          this.flagOutputDirty(\"focusState\");\r\n          // @ts-expect-error\r\n          this._updateVisualState();\r\n        },\r\n        onBlur() {\r\n          // @ts-expect-error\r\n          this.outputPropValues.focusState = false;\r\n          // @ts-expect-error\r\n          this.flagOutputDirty(\"focusState\");\r\n          // @ts-expect-error\r\n          this._updateVisualState();\r\n        },\r\n      },\r\n    },\r\n    onFocus: {\r\n      displayName: \"Focused\",\r\n      group: \"Focus Events\",\r\n      type: \"signal\",\r\n      props: {\r\n        onFocus() {\r\n          // @ts-expect-error\r\n          this.sendSignalOnOutput(\"onFocus\");\r\n        },\r\n      },\r\n    },\r\n    onBlur: {\r\n      displayName: \"Blurred\",\r\n      group: \"Focus Events\",\r\n      type: \"signal\",\r\n      props: {\r\n        onBlur() {\r\n          // @ts-expect-error\r\n          this.sendSignalOnOutput(\"onBlur\");\r\n        },\r\n      },\r\n    },\r\n\r\n    // Hover\r\n    hoverState: {\r\n      displayName: \"Hover\",\r\n      group: \"States\",\r\n      type: \"boolean\",\r\n      props: {\r\n        onMouseOver() {\r\n          // @ts-expect-error\r\n          this.outputPropValues.hoverState = true;\r\n          // @ts-expect-error\r\n          this.flagOutputDirty(\"hoverState\");\r\n          // @ts-expect-error\r\n          this._updateVisualState();\r\n        },\r\n        onMouseLeave() {\r\n          // @ts-expect-error\r\n          this.outputPropValues.hoverState = false;\r\n          // @ts-expect-error\r\n          this.flagOutputDirty(\"hoverState\");\r\n          // @ts-expect-error\r\n          this._updateVisualState();\r\n        },\r\n      },\r\n    },\r\n    hoverStart: {\r\n      displayName: \"Hover Start\",\r\n      group: \"Pointer Events\",\r\n      type: \"signal\",\r\n      props: {\r\n        onMouseOver() {\r\n          // @ts-expect-error\r\n          this.sendSignalOnOutput(\"hoverStart\");\r\n        },\r\n      },\r\n    },\r\n    hoverEnd: {\r\n      displayName: \"Hover End\",\r\n      group: \"Pointer Events\",\r\n      type: \"signal\",\r\n      props: {\r\n        onMouseLeave() {\r\n          // @ts-expect-error\r\n          this.sendSignalOnOutput(\"hoverEnd\");\r\n        },\r\n      },\r\n    },\r\n\r\n    // Pressed\r\n    pressedState: {\r\n      displayName: \"Pressed\",\r\n      group: \"States\",\r\n      type: \"boolean\",\r\n      props: {\r\n        onMouseDown() {\r\n          // @ts-expect-error\r\n          this.outputPropValues.pressedState = true;\r\n          // @ts-expect-error\r\n          this.flagOutputDirty(\"pressedState\");\r\n          // @ts-expect-error\r\n          this._updateVisualState();\r\n        },\r\n        onTouchStart() {\r\n          // @ts-expect-error\r\n          this.outputPropValues.pressedState = true;\r\n          // @ts-expect-error\r\n          this.flagOutputDirty(\"pressedState\");\r\n          // @ts-expect-error\r\n          this._updateVisualState();\r\n        },\r\n        onMouseUp() {\r\n          // @ts-expect-error\r\n          this.outputPropValues.pressedState = false;\r\n          // @ts-expect-error\r\n          this.flagOutputDirty(\"pressedState\");\r\n          // @ts-expect-error\r\n          this._updateVisualState();\r\n        },\r\n        onTouchEnd() {\r\n          // @ts-expect-error\r\n          this.outputPropValues.pressedState = false;\r\n          // @ts-expect-error\r\n          this.flagOutputDirty(\"pressedState\");\r\n          // @ts-expect-error\r\n          this._updateVisualState();\r\n        },\r\n        onTouchCancel() {\r\n          // @ts-expect-error\r\n          this.outputPropValues.pressedState = false;\r\n          // @ts-expect-error\r\n          this.flagOutputDirty(\"pressedState\");\r\n          // @ts-expect-error\r\n          this._updateVisualState();\r\n        },\r\n        onMouseLeave() {\r\n          // @ts-expect-error\r\n          this.outputPropValues.pressedState = false;\r\n          // @ts-expect-error\r\n          this.flagOutputDirty(\"pressedState\");\r\n          // @ts-expect-error\r\n          this._updateVisualState();\r\n        },\r\n      },\r\n    },\r\n    pointerDown: {\r\n      displayName: \"Pointer Down\",\r\n      group: \"Pointer Events\",\r\n      type: \"signal\",\r\n      props: {\r\n        onMouseDown() {\r\n          // @ts-expect-error\r\n          this.sendSignalOnOutput(\"pointerDown\");\r\n        },\r\n        onTouchStart() {\r\n          // @ts-expect-error\r\n          this.sendSignalOnOutput(\"pointerDown\");\r\n        },\r\n      },\r\n    },\r\n    pointerUp: {\r\n      displayName: \"Pointer Up\",\r\n      group: \"Pointer Events\",\r\n      type: \"signal\",\r\n      props: {\r\n        onMouseUp() {\r\n          // @ts-expect-error\r\n          this.sendSignalOnOutput(\"pointerUp\");\r\n        },\r\n        onTouchEnd() {\r\n          // @ts-expect-error\r\n          this.sendSignalOnOutput(\"pointerUp\");\r\n        },\r\n        onTouchCancel() {\r\n          // @ts-expect-error\r\n          this.sendSignalOnOutput(\"pointerUp\");\r\n        },\r\n      },\r\n    },\r\n  });\r\n\r\n  addOutputs(definition, {\r\n    enabled: {\r\n      type: \"boolean\",\r\n      displayName: \"Enabled\",\r\n      group: \"States\",\r\n      getter: function () {\r\n        // @ts-expect-error\r\n        return this._internal.enabled;\r\n      },\r\n    },\r\n  });\r\n\r\n  const oldInit = definition.initialize;\r\n  definition.initialize = function () {\r\n    oldInit && oldInit.call(this);\r\n    this.props.enabled = this._internal.enabled = true;\r\n    this.outputPropValues.hoverState =\r\n      this.outputPropValues.focusState =\r\n      this.outputPropValues.pressedState =\r\n        false;\r\n  };\r\n}\r\n\r\nfunction controlEvents(props) {\r\n  return Object.assign(\r\n    {},\r\n    {\r\n      onFocus: props.onFocus,\r\n      onBlur: props.onBlur,\r\n    },\r\n    PointerListeners(props)\r\n  );\r\n}\r\n\r\nexport default {\r\n  updateStylesForClass,\r\n  addControlEventsAndStates,\r\n  controlEvents,\r\n};\r\n","import React from \"react\";\r\n\r\nimport Layout from \"../../../layout\";\r\nimport Utils from \"../../../nodes/controls/utils\";\r\nimport { Noodl, Slot } from \"../../../types\";\r\n\r\nexport interface ButtonProps extends Noodl.ReactProps {\r\n  enabled: boolean;\r\n  buttonType: \"button\" | \"submit\";\r\n\r\n  attrs: React.Attributes;\r\n\r\n  textStyle: Noodl.TextStyle;\r\n\r\n  useLabel: boolean;\r\n  label: string;\r\n  labelSpacing: string;\r\n  labeltextStyle: Noodl.TextStyle;\r\n\r\n  useIcon: boolean;\r\n  iconPlacement: \"left\" | \"right\";\r\n  iconSpacing: string;\r\n  iconSourceType: \"image\" | \"icon\";\r\n  iconImageSource: Noodl.Image;\r\n  iconIconSource: Noodl.Icon;\r\n  iconSize: string;\r\n  iconColor: Noodl.Color;\r\n\r\n  onClick: () => void;\r\n\r\n  children: Slot;\r\n}\r\n\r\nexport function Button(props: ButtonProps) {\r\n  let style: React.CSSProperties = { ...props.style };\r\n  Layout.size(style, props);\r\n  Layout.align(style, props);\r\n\r\n  if (props.textStyle !== undefined) {\r\n    // Apply text style\r\n    style = Object.assign({}, props.textStyle, style);\r\n    style.color = props.noodlNode.context.styles.resolveColor(style.color);\r\n  }\r\n\r\n  function _renderIcon() {\r\n    const iconStyle: React.CSSProperties = {};\r\n\r\n    if (props.useLabel) {\r\n      if (props.iconPlacement === \"left\" || props.iconPlacement === undefined) {\r\n        iconStyle.marginRight = props.iconSpacing;\r\n      } else {\r\n        iconStyle.marginLeft = props.iconSpacing;\r\n      }\r\n    }\r\n\r\n    if (\r\n      props.iconSourceType === \"image\" &&\r\n      props.iconImageSource !== undefined\r\n    ) {\r\n      iconStyle.width = props.iconSize;\r\n      iconStyle.height = props.iconSize;\r\n      return <img alt=\"\" src={props.iconImageSource} style={iconStyle} />;\r\n    } else if (\r\n      props.iconSourceType === \"icon\" &&\r\n      props.iconIconSource !== undefined\r\n    ) {\r\n      iconStyle.fontSize = props.iconSize;\r\n      iconStyle.color = props.iconColor;\r\n\r\n      if (props.iconIconSource.codeAsClass === true) {\r\n        return (\r\n          <span\r\n            className={[\r\n              props.iconIconSource.class,\r\n              props.iconIconSource.code,\r\n            ].join(\" \")}\r\n            style={iconStyle}\r\n          ></span>\r\n        );\r\n      } else {\r\n        return (\r\n          <span className={props.iconIconSource.class} style={iconStyle}>\r\n            {props.iconIconSource.code}\r\n          </span>\r\n        );\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  let className = \"ndl-controls-button\";\r\n  if (props.className) className = className + \" \" + props.className;\r\n\r\n  let content: React.ReactNode = null;\r\n\r\n  if (props.useLabel && props.useIcon) {\r\n    content = (\r\n      <>\r\n        {props.iconPlacement === \"left\" ? _renderIcon() : null}\r\n        {String(props.label)}\r\n        {props.iconPlacement === \"right\" ? _renderIcon() : null}\r\n      </>\r\n    );\r\n  } else if (props.useLabel) {\r\n    content = String(props.label);\r\n  } else if (props.useIcon) {\r\n    content = _renderIcon();\r\n  }\r\n\r\n  return (\r\n    <button\r\n      {...props.attrs}\r\n      className={className}\r\n      disabled={!props.enabled}\r\n      {...Utils.controlEvents(props)}\r\n      type={props.buttonType}\r\n      style={style}\r\n      onClick={props.onClick}\r\n    >\r\n      {content}\r\n      {props.children}\r\n    </button>\r\n  );\r\n}\r\n","import { Button } from \"../../components/controls/Button\";\r\nimport NodeSharedPortDefinitions from \"../../node-shared-port-definitions\";\r\nimport { createNodeFromReactComponent } from \"../../react-component-node\";\r\nimport Utils from \"./utils\";\r\nimport { ReactNodeDefinition } from \"../../ReactNodeDefinition\";\r\n\r\ninterface Internal {}\r\n\r\ntype Props = {\r\n  attrs: Record<string, any>;\r\n  layout?: string;\r\n};\r\n\r\nconst ButtonNode: ReactNodeDefinition<Internal, Props> = {\r\n  name: \"net.noodl.controls.button\",\r\n  displayName: \"Button\",\r\n  docs: \"https://docs.noodl.net/nodes/ui-controls/button\",\r\n  allowChildren: true,\r\n  noodlNodeAsProp: true,\r\n  usePortAsLabel: \"label\",\r\n  portLabelTruncationMode: \"length\",\r\n  nodeDoubleClickAction: {\r\n    focusPort: \"label\",\r\n  },\r\n  connectionPanel: {\r\n    groupPriority: [\r\n      \"General\",\r\n      \"Style\",\r\n      \"Actions\",\r\n      \"Events\",\r\n      \"States\",\r\n      \"Mounted\",\r\n      \"Label\",\r\n      \"Label Text Style\",\r\n      \"Hover Events\",\r\n      \"Pointer Events\",\r\n      \"Focus Events\",\r\n    ],\r\n  },\r\n  initialize() {\r\n    this.props.attrs = {};\r\n    this.props.layout = \"row\"; //Used to tell child nodes what layout to expect\r\n  },\r\n  // @ts-expect-error\r\n  getReactComponent() {\r\n    return Button;\r\n  },\r\n  inputs: {\r\n    testId: {\r\n      index: 100009,\r\n      displayName: \"Test ID Attribute\",\r\n      group: \"Advanced HTML\",\r\n      type: \"string\",\r\n      set(value) {\r\n        this.props.attrs![\"data-testid\"] = value;\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n  },\r\n  inputCss: {\r\n    backgroundColor: {\r\n      index: 100,\r\n      displayName: \"Background Color\",\r\n      group: \"Style\",\r\n      type: \"color\",\r\n      default: \"#000000\",\r\n      allowVisualStates: true,\r\n    },\r\n  },\r\n  outputProps: {\r\n    onClick: {\r\n      displayName: \"Click\",\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n    },\r\n  },\r\n};\r\n\r\nNodeSharedPortDefinitions.addDimensions(ButtonNode, {\r\n  defaultSizeMode: \"contentSize\",\r\n  contentLabel: \"Content\",\r\n});\r\nNodeSharedPortDefinitions.addTextStyleInputs(ButtonNode);\r\nNodeSharedPortDefinitions.addAlignInputs(ButtonNode);\r\nNodeSharedPortDefinitions.addTransformInputs(ButtonNode);\r\nNodeSharedPortDefinitions.addPaddingInputs(ButtonNode, {\r\n  defaults: {\r\n    paddingTop: 5,\r\n    paddingRight: 20,\r\n    paddingBottom: 5,\r\n    paddingLeft: 20,\r\n  },\r\n});\r\nNodeSharedPortDefinitions.addMarginInputs(ButtonNode);\r\nNodeSharedPortDefinitions.addLabelInputs(ButtonNode, {\r\n  defaults: { useLabel: true },\r\n});\r\nNodeSharedPortDefinitions.addIconInputs(ButtonNode, {\r\n  enableIconPlacement: true,\r\n  defaults: { useIcon: false },\r\n});\r\nNodeSharedPortDefinitions.addSharedVisualInputs(ButtonNode);\r\nNodeSharedPortDefinitions.addBorderInputs(ButtonNode);\r\nNodeSharedPortDefinitions.addShadowInputs(ButtonNode);\r\n\r\nUtils.addControlEventsAndStates(ButtonNode);\r\n\r\nexport default createNodeFromReactComponent(ButtonNode);\r\n","import React, { useEffect, useState } from \"react\";\r\n\r\nimport Layout from \"../../../layout\";\r\nimport Utils from \"../../../nodes/controls/utils\";\r\nimport { Noodl } from \"../../../types\";\r\n\r\nexport interface CheckboxProps extends Noodl.ReactProps {\r\n  id: string;\r\n  enabled: boolean;\r\n  checked: boolean;\r\n\r\n  attrs: React.Attributes;\r\n\r\n  useLabel: boolean;\r\n  label: string;\r\n  labelSpacing: string;\r\n  labeltextStyle: Noodl.TextStyle;\r\n\r\n  useIcon: boolean;\r\n  iconPlacement: \"left\" | \"right\";\r\n  iconSpacing: string;\r\n  iconSourceType: \"image\" | \"icon\";\r\n  iconImageSource: Noodl.Image;\r\n  iconIconSource: Noodl.Icon;\r\n  iconSize: string;\r\n  iconColor: Noodl.Color;\r\n\r\n  checkedChanged: (checked: boolean) => void;\r\n}\r\n\r\nexport function Checkbox(props: CheckboxProps) {\r\n  const [checked, setChecked] = useState(props.checked);\r\n\r\n  // Report initial values when mounted\r\n  useEffect(() => {\r\n    setChecked(!!props.checked);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    setChecked(!!props.checked);\r\n  }, [props.checked]);\r\n\r\n  const style: React.CSSProperties = { ...props.style };\r\n\r\n  if (props.parentLayout === \"none\") {\r\n    style.position = \"absolute\";\r\n  }\r\n\r\n  Layout.align(style, props);\r\n\r\n  const inputProps = {\r\n    ...props.attrs,\r\n    id: props.id,\r\n    className: [props.className, \"ndl-controls-checkbox-2\"].join(\" \"),\r\n    disabled: !props.enabled,\r\n    style: {\r\n      width: props.styles.checkbox.width,\r\n      height: props.styles.checkbox.height,\r\n    },\r\n  };\r\n\r\n  const inputWrapperStyle: React.CSSProperties = {\r\n    display: \"flex\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n    flexShrink: 0,\r\n    position: \"relative\",\r\n    ...props.styles.checkbox,\r\n  };\r\n\r\n  if (!props.useLabel) {\r\n    Object.assign(inputProps, Utils.controlEvents(props));\r\n    Object.assign(inputWrapperStyle, style);\r\n  }\r\n\r\n  function _renderIcon() {\r\n    if (props.iconSourceType === \"image\" && props.iconImageSource !== undefined)\r\n      return (\r\n        <img\r\n          alt=\"\"\r\n          src={props.iconImageSource}\r\n          style={{\r\n            width: props.iconSize,\r\n            height: props.iconSize,\r\n            position: \"absolute\",\r\n          }}\r\n        />\r\n      );\r\n    else if (\r\n      props.iconSourceType === \"icon\" &&\r\n      props.iconIconSource !== undefined\r\n    ) {\r\n      const style: React.CSSProperties = {\r\n        fontSize: props.iconSize,\r\n        color: props.iconColor,\r\n        position: \"absolute\",\r\n      };\r\n\r\n      if (props.iconIconSource.codeAsClass === true) {\r\n        return (\r\n          <span\r\n            className={[\r\n              props.iconIconSource.class,\r\n              props.iconIconSource.code,\r\n            ].join(\" \")}\r\n            style={style}\r\n          ></span>\r\n        );\r\n      } else {\r\n        return (\r\n          <span className={props.iconIconSource.class} style={style}>\r\n            {props.iconIconSource.code}\r\n          </span>\r\n        );\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  const checkbox = (\r\n    <div\r\n      className=\"ndl-controls-pointer\"\r\n      style={inputWrapperStyle}\r\n      noodl-style-tag=\"checkbox\"\r\n    >\r\n      {props.useIcon ? _renderIcon() : null}\r\n      <input\r\n        type=\"checkbox\"\r\n        {...inputProps}\r\n        checked={checked}\r\n        onChange={(e) => {\r\n          setChecked(e.target.checked);\r\n          props.checkedChanged && props.checkedChanged(e.target.checked);\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n\r\n  if (props.useLabel) {\r\n    const labelStyle: React.CSSProperties = {\r\n      marginLeft: props.labelSpacing,\r\n      ...props.labeltextStyle,\r\n      ...props.styles.label,\r\n    };\r\n\r\n    if (!props.enabled) {\r\n      labelStyle.cursor = \"default\";\r\n    }\r\n\r\n    labelStyle.color = props.noodlNode.context.styles.resolveColor(\r\n      labelStyle.color\r\n    );\r\n\r\n    return (\r\n      <div\r\n        style={{ display: \"flex\", alignItems: \"center\", ...style }}\r\n        {...Utils.controlEvents(props)}\r\n      >\r\n        {checkbox}\r\n        <label\r\n          className=\"ndl-controls-pointer\"\r\n          style={labelStyle}\r\n          htmlFor={props.id}\r\n          noodl-style-tag=\"label\"\r\n        >\r\n          {props.label}\r\n        </label>\r\n      </div>\r\n    );\r\n  } else {\r\n    return checkbox;\r\n  }\r\n}\r\n","import { guid } from \"@fluxscape/runtime\";\r\nimport { Checkbox } from \"../../components/controls/Checkbox\";\r\nimport NodeSharedPortDefinitions from \"../../node-shared-port-definitions\";\r\nimport { createNodeFromReactComponent } from \"../../react-component-node\";\r\nimport Utils from \"./utils\";\r\n\r\nconst CheckBoxNode = {\r\n  name: \"net.noodl.controls.checkbox\",\r\n  displayName: \"Checkbox\",\r\n  docs: \"https://docs.noodl.net/nodes/ui-controls/checkbox\",\r\n  allowChildren: false,\r\n  noodlNodeAsProp: true,\r\n  nodeDoubleClickAction: {\r\n    focusPort: \"label\",\r\n  },\r\n  usePortAsLabel: \"label\",\r\n  portLabelTruncationMode: \"length\",\r\n  connectionPanel: {\r\n    groupPriority: [\r\n      \"General\",\r\n      \"Style\",\r\n      \"Actions\",\r\n      \"Events\",\r\n      \"States\",\r\n      \"Mounted\",\r\n      \"Label\",\r\n      \"Label Text Style\",\r\n      \"Hover Events\",\r\n      \"Pointer Events\",\r\n      \"Focus Events\",\r\n    ],\r\n  },\r\n  initialize() {\r\n    // @ts-expect-error\r\n    this.props.attrs = {};\r\n    // @ts-expect-error\r\n    this.props.sizeMode = \"explicit\";\r\n    // @ts-expect-error\r\n    this.props.id = \"input-\" + guid();\r\n    // @ts-expect-error\r\n    this.props.checked = this._internal.checked = false;\r\n\r\n    // @ts-expect-error\r\n    this.props.checkedChanged = (checked) => {\r\n      // @ts-expect-error\r\n      const changed = this._internal.checked !== checked;\r\n      // @ts-expect-error\r\n      this._internal.checked = checked;\r\n      if (changed) {\r\n        // @ts-expect-error\r\n        this.flagOutputDirty(\"checked\");\r\n        // @ts-expect-error\r\n        this.sendSignalOnOutput(\"onChange\");\r\n        // @ts-expect-error\r\n        this._updateVisualState();\r\n      }\r\n    };\r\n  },\r\n  getReactComponent() {\r\n    return Checkbox;\r\n  },\r\n  inputs: {\r\n    checked: {\r\n      type: \"boolean\",\r\n      displayName: \"Checked\",\r\n      group: \"General\",\r\n      default: false,\r\n      index: 100,\r\n      set: function (value) {\r\n        value = !!value;\r\n        // @ts-expect-error\r\n        const changed = value !== this._internal.checked;\r\n        // @ts-expect-error\r\n        this.props.checked = this._internal.checked = value;\r\n\r\n        if (changed) {\r\n          // @ts-expect-error\r\n          this.forceUpdate();\r\n          // @ts-expect-error\r\n          this.flagOutputDirty(\"checked\");\r\n          // @ts-expect-error\r\n          this._updateVisualState();\r\n        }\r\n      },\r\n    },\r\n    check: {\r\n      type: \"signal\",\r\n      displayName: \"Check\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        if (this._internal.checked === true) return;\r\n\r\n        // @ts-expect-error\r\n        this.props.checked = this._internal.checked = true;\r\n\r\n        // @ts-expect-error\r\n        this.forceUpdate();\r\n        // @ts-expect-error\r\n        this.flagOutputDirty(\"checked\");\r\n        // @ts-expect-error\r\n        this._updateVisualState();\r\n      },\r\n    },\r\n    uncheck: {\r\n      type: \"signal\",\r\n      displayName: \"Uncheck\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        if (this._internal.checked === false) return;\r\n\r\n        // @ts-expect-error\r\n        this.props.checked = this._internal.checked = false;\r\n\r\n        // @ts-expect-error\r\n        this.forceUpdate();\r\n        // @ts-expect-error\r\n        this.flagOutputDirty(\"checked\");\r\n        // @ts-expect-error\r\n        this._updateVisualState();\r\n      },\r\n    },\r\n    testId: {\r\n      index: 100009,\r\n      displayName: \"Test ID Attribute\",\r\n      group: \"Advanced HTML\",\r\n      type: \"string\",\r\n      set(value) {\r\n        // @ts-expect-error\r\n        this.props.attrs[\"data-testid\"] = value;\r\n        // @ts-expect-error\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n  },\r\n  inputCss: {\r\n    backgroundColor: {\r\n      index: 201,\r\n      displayName: \"Background Color\",\r\n      group: \"Style\",\r\n      type: \"color\",\r\n      default: \"transparent\",\r\n      applyDefault: false,\r\n      allowVisualStates: true,\r\n      styleTag: \"checkbox\",\r\n    },\r\n    width: {\r\n      index: 11,\r\n      group: \"Dimensions\",\r\n      displayName: \"Width\",\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"px\", \"vw\", \"vh\"],\r\n        defaultUnit: \"px\",\r\n      },\r\n      default: 32,\r\n      allowVisualStates: true,\r\n      styleTag: \"checkbox\",\r\n    },\r\n    height: {\r\n      index: 12,\r\n      group: \"Dimensions\",\r\n      displayName: \"Height\",\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"px\", \"vw\", \"vh\"],\r\n        defaultUnit: \"px\",\r\n      },\r\n      default: 32,\r\n      allowVisualStates: true,\r\n      styleTag: \"checkbox\",\r\n    },\r\n  },\r\n  outputs: {\r\n    checked: {\r\n      type: \"boolean\",\r\n      displayName: \"Checked\",\r\n      group: \"States\",\r\n      getter: function () {\r\n        // @ts-expect-error\r\n        return this._internal.checked;\r\n      },\r\n    },\r\n    onChange: {\r\n      displayName: \"Changed\",\r\n      group: \"Events\",\r\n      type: \"signal\",\r\n    },\r\n  },\r\n};\r\n\r\nNodeSharedPortDefinitions.addAlignInputs(CheckBoxNode);\r\nNodeSharedPortDefinitions.addTransformInputs(CheckBoxNode);\r\nNodeSharedPortDefinitions.addMarginInputs(CheckBoxNode);\r\nNodeSharedPortDefinitions.addPaddingInputs(CheckBoxNode);\r\nNodeSharedPortDefinitions.addIconInputs(CheckBoxNode);\r\nNodeSharedPortDefinitions.addLabelInputs(CheckBoxNode, {\r\n  enableSpacing: true,\r\n  styleTag: \"label\",\r\n});\r\nNodeSharedPortDefinitions.addSharedVisualInputs(CheckBoxNode);\r\nNodeSharedPortDefinitions.addBorderInputs(CheckBoxNode, {\r\n  defaults: {\r\n    borderStyle: \"solid\",\r\n    borderWidth: 2,\r\n    borderColor: \"#000000\",\r\n    borderRadius: 3,\r\n  },\r\n  styleTag: \"checkbox\",\r\n});\r\nNodeSharedPortDefinitions.addShadowInputs(CheckBoxNode, {\r\n  styleTag: \"checkbox\",\r\n});\r\nUtils.addControlEventsAndStates(CheckBoxNode, { checked: true });\r\n\r\nexport default createNodeFromReactComponent(CheckBoxNode);\r\n","import React, { useEffect, useState } from \"react\";\r\n\r\nimport type { TSFixme } from \"../../../../typings/global\";\r\nimport Layout from \"../../../layout\";\r\nimport Utils from \"../../../nodes/controls/utils\";\r\nimport { Noodl } from \"../../../types\";\r\n\r\nexport interface SelectProps extends Noodl.ReactProps {\r\n  id: string;\r\n  value: string;\r\n  enabled: boolean;\r\n  textStyle: Noodl.TextStyle;\r\n  items: TSFixme;\r\n\r\n  attrs: React.Attributes;\r\n\r\n  placeholder: string;\r\n  placeholderOpacity: string;\r\n\r\n  useIcon: boolean;\r\n  iconPlacement: \"left\" | \"right\";\r\n  iconSpacing: string;\r\n  iconSourceType: \"image\" | \"icon\";\r\n  iconImageSource: Noodl.Image;\r\n  iconIconSource: Noodl.Icon;\r\n  iconSize: string;\r\n  iconColor: Noodl.Color;\r\n\r\n  useLabel: boolean;\r\n  label: string;\r\n  labelSpacing: string;\r\n  labeltextStyle: Noodl.TextStyle;\r\n\r\n  onClick: () => void;\r\n  valueChanged: (value: string) => void;\r\n}\r\n\r\nexport function Select(props: SelectProps) {\r\n  const [value, setValue] = useState(props.value);\r\n\r\n  useEffect(() => {\r\n    setValue(props.value);\r\n    props.valueChanged(props.value);\r\n  }, [props.value, props.items]);\r\n\r\n  let style = { ...props.style };\r\n  Layout.size(style, props);\r\n  Layout.align(style, props);\r\n\r\n  if (props.textStyle !== undefined) {\r\n    // Apply text style\r\n    style = Object.assign({}, props.textStyle, style);\r\n    style.color = props.noodlNode.context.styles.resolveColor(style.color);\r\n  }\r\n\r\n  // Hide label if there is no selected value, of if value is not in the items array\r\n  const selectedIndex =\r\n    !props.items || value === undefined\r\n      ? -1\r\n      : props.items.findIndex((i) => i.Value === value);\r\n\r\n  const { height, ...otherStyles } = style;\r\n\r\n  function _renderIcon() {\r\n    if (props.iconSourceType === \"image\" && props.iconImageSource !== undefined)\r\n      return (\r\n        <img\r\n          alt=\"\"\r\n          src={props.iconImageSource}\r\n          style={{ width: props.iconSize, height: props.iconSize }}\r\n        ></img>\r\n      );\r\n    else if (\r\n      props.iconSourceType === \"icon\" &&\r\n      props.iconIconSource !== undefined\r\n    ) {\r\n      const style: React.CSSProperties = {\r\n        fontSize: props.iconSize,\r\n        color: props.iconColor,\r\n      };\r\n      if (props.iconPlacement === \"left\" || props.iconPlacement === undefined)\r\n        style.marginRight = props.iconSpacing;\r\n      else style.marginLeft = props.iconSpacing;\r\n\r\n      if (props.iconIconSource.codeAsClass === true) {\r\n        return (\r\n          <span\r\n            className={[\r\n              props.iconIconSource.class,\r\n              props.iconIconSource.code,\r\n            ].join(\" \")}\r\n            style={style}\r\n          ></span>\r\n        );\r\n      } else {\r\n        return (\r\n          <span className={props.iconIconSource.class} style={style}>\r\n            {props.iconIconSource.code}\r\n          </span>\r\n        );\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  const inputProps: React.SelectHTMLAttributes<HTMLSelectElement> = {\r\n    ...props.attrs,\r\n    id: props.id,\r\n    className: props.className,\r\n    style: {\r\n      inset: 0,\r\n      opacity: 0,\r\n      position: \"absolute\" as React.CSSProperties[\"position\"],\r\n      textTransform: \"inherit\",\r\n      cursor: props.enabled ? \"\" : \"default\",\r\n      // @ts-ignore\r\n      \"-webkit-appearance\": \"none\",\r\n    },\r\n    onClick: props.onClick,\r\n  };\r\n\r\n  const inputWrapperStyle = {\r\n    display: \"flex\",\r\n    alignItems: \"center\",\r\n    ...props.styles.inputWrapper,\r\n    cursor: props.enabled ? \"\" : \"default\",\r\n  };\r\n\r\n  const heightInPercent = height && height[String(height).length - 1] === \"%\";\r\n\r\n  if (props.useLabel) {\r\n    if (heightInPercent) {\r\n      inputWrapperStyle.flexGrow = 1;\r\n    } else {\r\n      inputWrapperStyle.height = height;\r\n    }\r\n  } else {\r\n    Object.assign(inputWrapperStyle, otherStyles);\r\n    inputWrapperStyle.height = height;\r\n  }\r\n\r\n  let options: JSX.Element[] = [];\r\n\r\n  if (props.items) {\r\n    options = props.items.map((i) => (\r\n      <option\r\n        key={i.Value}\r\n        value={i.Value}\r\n        disabled={\r\n          i.Disabled === \"true\" || i.Disabled === true ? true : undefined\r\n        }\r\n      >\r\n        {i.Label}\r\n      </option>\r\n    ));\r\n    // options.unshift();\r\n  }\r\n\r\n  let label: React.ReactNode | null = null;\r\n\r\n  if (selectedIndex >= 0 && selectedIndex < props.items.length) {\r\n    label = <span>{props.items[selectedIndex].Label}</span>;\r\n  } else if (props.placeholder) {\r\n    label = (\r\n      <span style={{ opacity: props.placeholderOpacity }}>\r\n        {props.placeholder}\r\n      </span>\r\n    );\r\n  }\r\n\r\n  //A hidden first option is preselected and added to the list of options, it makes it possible to select the first item in the dropdown\r\n  const inputWrapper = (\r\n    <div\r\n      className=\"ndl-controls-pointer\"\r\n      style={inputWrapperStyle}\r\n      noodl-style-tag=\"inputWrapper\"\r\n    >\r\n      {props.useIcon && props.iconPlacement === \"left\" ? _renderIcon() : null}\r\n      <div\r\n        style={{\r\n          width: \"100%\",\r\n          height: \"100%\",\r\n          alignItems: \"center\",\r\n          display: \"flex\",\r\n        }}\r\n      >\r\n        {label}\r\n      </div>\r\n      {props.useIcon && props.iconPlacement === \"right\" ? _renderIcon() : null}\r\n      <select\r\n        {...inputProps}\r\n        disabled={!props.enabled}\r\n        value={options.find((i) => i.props.value === value) ? value : undefined}\r\n        {...Utils.controlEvents(props)}\r\n        onChange={(e) => {\r\n          setValue(e.target.value);\r\n          props.valueChanged && props.valueChanged(e.target.value);\r\n        }}\r\n      >\r\n        <option value=\"\" disabled selected hidden />\r\n        {options}\r\n      </select>\r\n    </div>\r\n  );\r\n\r\n  if (props.useLabel) {\r\n    const outerWrapperStyle: React.CSSProperties = {\r\n      ...otherStyles,\r\n      display: \"flex\",\r\n      flexDirection: \"column\",\r\n    };\r\n\r\n    if (heightInPercent) {\r\n      outerWrapperStyle.height = height;\r\n    }\r\n\r\n    return (\r\n      <div style={outerWrapperStyle}>\r\n        <label\r\n          htmlFor={props.id}\r\n          style={{\r\n            ...props.labeltextStyle,\r\n            ...props.styles.label,\r\n            marginBottom: props.labelSpacing,\r\n          }}\r\n          noodl-style-tag=\"label\"\r\n        >\r\n          {props.label}\r\n        </label>\r\n        {inputWrapper}\r\n      </div>\r\n    );\r\n  } else {\r\n    return inputWrapper;\r\n  }\r\n}\r\n","import { Select } from \"../../components/controls/Select\";\r\nimport { guid } from \"@fluxscape/runtime\";\r\nimport { ReactNodeDefinition } from \"../../ReactNodeDefinition\";\r\nimport NodeSharedPortDefinitions from \"../../node-shared-port-definitions\";\r\nimport { createNodeFromReactComponent } from \"../../react-component-node\";\r\nimport Utils from \"./utils\";\r\n\r\ninterface Internal {\r\n  items: any; // Adjust type as necessary\r\n  value: string;\r\n  attrs: Record<string, any>;\r\n  id: string;\r\n  valueChanged: (value: string) => void;\r\n  _itemsChanged: () => void;\r\n}\r\n\r\ntype Props = {\r\n  layout?: string;\r\n};\r\n\r\nconst OptionsNode: ReactNodeDefinition<Internal, Props> = {\r\n  name: \"net.noodl.controls.options\",\r\n  displayName: \"Dropdown\",\r\n  docs: \"https://docs.noodl.net/nodes/ui-controls/dropdown\",\r\n  allowChildren: false,\r\n  noodlNodeAsProp: true,\r\n  usePortAsLabel: \"label\",\r\n  nodeDoubleClickAction: {\r\n    focusPort: \"label\",\r\n  },\r\n  connectionPanel: {\r\n    groupPriority: [\r\n      \"General\",\r\n      \"Style\",\r\n      \"Actions\",\r\n      \"Events\",\r\n      \"States\",\r\n      \"Mounted\",\r\n      \"Text Style\",\r\n      \"Label\",\r\n      \"Label Text Style\",\r\n      \"Hover Events\",\r\n      \"Pointer Events\",\r\n      \"Focus Events\",\r\n    ],\r\n  },\r\n  initialize() {\r\n    // @ts-expect-error\r\n    this.props.attrs = {};\r\n    // @ts-expect-error\r\n    this._itemsChanged = () => {\r\n      this.forceUpdate();\r\n    };\r\n\r\n    // @ts-expect-error\r\n    this.props.id = \"input-\" + guid();\r\n\r\n    // @ts-expect-error\r\n    this.props.valueChanged = (value: string) => {\r\n      const changed = this._internal.value !== value;\r\n      this._internal.value = value;\r\n      if (changed) {\r\n        this.flagOutputDirty(\"value\");\r\n        this.sendSignalOnOutput(\"onChange\");\r\n      }\r\n    };\r\n  },\r\n  // @ts-expect-error\r\n  getReactComponent() {\r\n    return Select;\r\n  },\r\n  inputs: {\r\n    items: {\r\n      type: \"array\",\r\n      displayName: \"Items\",\r\n      group: \"General\",\r\n      set: function (newValue: any) {\r\n        if (\r\n          this._internal.items !== newValue &&\r\n          this._internal.items !== undefined\r\n        ) {\r\n          // @ts-expect-error\r\n          this._internal.items.off(\"change\", this._itemsChanged);\r\n        }\r\n        this._internal.items = newValue;\r\n        // @ts-expect-error\r\n        this._internal.items.on(\"change\", this._itemsChanged);\r\n\r\n        // @ts-expect-error\r\n        this.props.items = this._internal.items;\r\n\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n    value: {\r\n      type: \"string\",\r\n      displayName: \"Value\",\r\n      group: \"General\",\r\n      set: function (value: string) {\r\n        if (value !== undefined && typeof value !== \"string\") {\r\n          // @ts-expect-error\r\n          if (value?.toString !== undefined) value = value.toString();\r\n          else return;\r\n        }\r\n\r\n        const changed = value !== this._internal.value;\r\n        // @ts-expect-error\r\n        this.props.value = this._internal.value = value;\r\n\r\n        if (changed) {\r\n          this.forceUpdate();\r\n          this.flagOutputDirty(\"value\");\r\n        }\r\n      },\r\n    },\r\n    testId: {\r\n      index: 100009,\r\n      displayName: \"Test ID Attribute\",\r\n      group: \"Advanced HTML\",\r\n      type: \"string\",\r\n      set(value: string) {\r\n        // @ts-expect-error\r\n        this.props.attrs[\"data-testid\"] = value;\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n  },\r\n  inputProps: {\r\n    placeholder: {\r\n      displayName: \"Placeholder\",\r\n      type: \"string\",\r\n      group: \"Placeholder\",\r\n    },\r\n    placeholderOpacity: {\r\n      group: \"Placeholder\",\r\n      displayName: \"Placeholder opacity\",\r\n      type: \"number\",\r\n      default: 0.5,\r\n    },\r\n  },\r\n  outputs: {\r\n    value: {\r\n      type: \"string\",\r\n      displayName: \"Value\",\r\n      group: \"States\",\r\n      getter: function () {\r\n        return this._internal.value;\r\n      },\r\n    },\r\n    onChange: {\r\n      type: \"signal\",\r\n      displayName: \"Changed\",\r\n      group: \"Events\",\r\n    },\r\n  },\r\n  inputCss: {\r\n    backgroundColor: {\r\n      index: 100,\r\n      displayName: \"Background Color\",\r\n      group: \"Style\",\r\n      type: \"color\",\r\n      default: \"transparent\",\r\n      styleTag: \"inputWrapper\",\r\n      allowVisualStates: true,\r\n    },\r\n  },\r\n};\r\n\r\nNodeSharedPortDefinitions.addDimensions(OptionsNode, {\r\n  defaultSizeMode: \"contentSize\",\r\n  contentLabel: \"Content\",\r\n});\r\nNodeSharedPortDefinitions.addAlignInputs(OptionsNode);\r\nNodeSharedPortDefinitions.addTextStyleInputs(OptionsNode);\r\nNodeSharedPortDefinitions.addTransformInputs(OptionsNode);\r\nNodeSharedPortDefinitions.addPaddingInputs(OptionsNode, {\r\n  styleTag: \"inputWrapper\",\r\n});\r\nNodeSharedPortDefinitions.addMarginInputs(OptionsNode);\r\nNodeSharedPortDefinitions.addIconInputs(OptionsNode, {\r\n  enableIconPlacement: true,\r\n  defaults: { useIcon: false, iconColor: \"#000000\" },\r\n});\r\nNodeSharedPortDefinitions.addLabelInputs(OptionsNode, {\r\n  enableSpacing: true,\r\n  styleTag: \"label\",\r\n});\r\nNodeSharedPortDefinitions.addSharedVisualInputs(OptionsNode);\r\nNodeSharedPortDefinitions.addBorderInputs(OptionsNode, {\r\n  defaults: {\r\n    borderStyle: \"solid\",\r\n    borderWidth: 2,\r\n    borderColor: \"#000000\",\r\n    borderRadius: 5,\r\n  },\r\n  styleTag: \"inputWrapper\",\r\n});\r\n\r\nNodeSharedPortDefinitions.addShadowInputs(OptionsNode, {\r\n  styleTag: \"inputWrapper\",\r\n});\r\nUtils.addControlEventsAndStates(OptionsNode);\r\n\r\nexport default createNodeFromReactComponent(OptionsNode);\r\n","import React from \"react\";\r\n\r\nexport interface IRadioButtonContext {\r\n  name: string | undefined;\r\n  selected: string | undefined;\r\n  checkedChanged?: (value: string) => void;\r\n}\r\n\r\nconst RadioButtonContext = React.createContext<IRadioButtonContext>({\r\n  name: undefined,\r\n  selected: undefined,\r\n  checkedChanged: undefined,\r\n});\r\n\r\nexport default RadioButtonContext;\r\n","import React, { useContext } from \"react\";\r\n\r\nimport RadioButtonContext from \"../../../contexts/radiobuttoncontext\";\r\nimport Layout from \"../../../layout\";\r\nimport Utils from \"../../../nodes/controls/utils\";\r\nimport { Noodl } from \"../../../types\";\r\n\r\nexport interface RadioButtonProps extends Noodl.ReactProps {\r\n  id: string;\r\n  enabled: boolean;\r\n  value: string;\r\n\r\n  attrs: React.Attributes;\r\n\r\n  useLabel: boolean;\r\n  label: string;\r\n  labelSpacing: string;\r\n  labeltextStyle: Noodl.TextStyle;\r\n\r\n  useIcon: boolean;\r\n  iconPlacement: \"left\" | \"right\";\r\n  iconSpacing: string;\r\n  iconSourceType: \"image\" | \"icon\";\r\n  iconImageSource: Noodl.Image;\r\n  iconIconSource: Noodl.Icon;\r\n  iconSize: string;\r\n  iconColor: Noodl.Color;\r\n\r\n  fillSpacing: string;\r\n\r\n  checkedChanged: (value: boolean) => void;\r\n}\r\n\r\nfunction isPercentage(size /* string */) {\r\n  return size && size[size.length - 1] === \"%\";\r\n}\r\n\r\nexport function RadioButton(props: RadioButtonProps) {\r\n  const radioButtonGroup = useContext(RadioButtonContext);\r\n\r\n  const style = { ...props.style };\r\n\r\n  if (props.parentLayout === \"none\") {\r\n    style.position = \"absolute\";\r\n  }\r\n\r\n  Layout.align(style, props);\r\n\r\n  props.checkedChanged &&\r\n    props.checkedChanged(\r\n      radioButtonGroup ? radioButtonGroup.selected === props.value : false\r\n    );\r\n\r\n  const inputProps = {\r\n    ...props.attrs,\r\n    id: props.id,\r\n    disabled: !props.enabled,\r\n    className: [props.className, \"ndl-controls-radio-2\"].join(\" \"),\r\n    style: {\r\n      width: props.styles.radio.width,\r\n      height: props.styles.radio.height,\r\n    },\r\n  };\r\n\r\n  const inputWrapperStyle: React.CSSProperties = {\r\n    display: \"flex\",\r\n    alignItems: \"center\",\r\n    justifyContent: \"center\",\r\n    position: \"relative\",\r\n    flexShrink: 0,\r\n    ...props.styles.radio,\r\n  };\r\n\r\n  if (props.useLabel) {\r\n    if (isPercentage(props.styles.radio.width)) {\r\n      delete inputWrapperStyle.width;\r\n      inputWrapperStyle.flexGrow = 1;\r\n    }\r\n  } else {\r\n    Object.assign(inputProps, Utils.controlEvents(props));\r\n    Object.assign(inputWrapperStyle, style);\r\n  }\r\n\r\n  function _renderIcon() {\r\n    if (props.iconSourceType === \"image\" && props.iconImageSource !== undefined)\r\n      return (\r\n        <img\r\n          alt=\"\"\r\n          src={props.iconImageSource}\r\n          style={{ width: props.iconSize, height: props.iconSize }}\r\n        />\r\n      );\r\n    else if (\r\n      props.iconSourceType === \"icon\" &&\r\n      props.iconIconSource !== undefined\r\n    ) {\r\n      const style = { fontSize: props.iconSize, color: props.iconColor };\r\n      if (props.iconIconSource.codeAsClass === true) {\r\n        return (\r\n          <span\r\n            className={[\r\n              \"ndl-controls-abs-center\",\r\n              props.iconIconSource.class,\r\n              props.iconIconSource.code,\r\n            ].join(\" \")}\r\n            style={style}\r\n          ></span>\r\n        );\r\n      } else {\r\n        return (\r\n          <span\r\n            className={[\r\n              \"ndl-controls-abs-center\",\r\n              props.iconIconSource.class,\r\n            ].join(\" \")}\r\n            style={style}\r\n          >\r\n            {props.iconIconSource.code}\r\n          </span>\r\n        );\r\n      }\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  const fillStyle: React.CSSProperties = {\r\n    left: props.fillSpacing,\r\n    right: props.fillSpacing,\r\n    top: props.fillSpacing,\r\n    bottom: props.fillSpacing,\r\n    backgroundColor: props.styles.fill.backgroundColor,\r\n    borderRadius: \"inherit\",\r\n    position: \"absolute\",\r\n  };\r\n\r\n  const radioButton = (\r\n    <div\r\n      className=\"ndl-controls-pointer\"\r\n      style={inputWrapperStyle}\r\n      noodl-style-tag=\"radio\"\r\n    >\r\n      <div style={fillStyle} noodl-style-tag=\"fill\" />\r\n      {props.useIcon ? _renderIcon() : null}\r\n      <input\r\n        type=\"radio\"\r\n        name={radioButtonGroup ? radioButtonGroup.name : undefined}\r\n        {...inputProps}\r\n        checked={\r\n          radioButtonGroup ? radioButtonGroup.selected === props.value : false\r\n        }\r\n        onChange={(e) => {\r\n          radioButtonGroup &&\r\n            radioButtonGroup.checkedChanged &&\r\n            radioButtonGroup.checkedChanged(props.value);\r\n        }}\r\n      />\r\n    </div>\r\n  );\r\n\r\n  if (props.useLabel) {\r\n    const labelStyle = {\r\n      marginLeft: props.labelSpacing,\r\n      ...props.labeltextStyle,\r\n      ...props.styles.label,\r\n      cursor: props.enabled ? undefined : \"default\",\r\n    };\r\n\r\n    labelStyle.color = props.noodlNode.context.styles.resolveColor(\r\n      labelStyle.color\r\n    );\r\n\r\n    const wrapperStyle = { display: \"flex\", alignItems: \"center\", ...style };\r\n    if (isPercentage(props.styles.radio.width)) {\r\n      wrapperStyle.width = props.styles.radio.width;\r\n    }\r\n    if (isPercentage(props.styles.radio.height)) {\r\n      wrapperStyle.height = props.styles.radio.height;\r\n    }\r\n\r\n    return (\r\n      <div style={wrapperStyle} {...Utils.controlEvents(props)}>\r\n        {radioButton}\r\n        <label\r\n          className=\"ndl-controls-pointer\"\r\n          style={labelStyle}\r\n          htmlFor={props.id}\r\n          noodl-style-tag=\"label\"\r\n        >\r\n          {props.label}\r\n        </label>\r\n      </div>\r\n    );\r\n  } else {\r\n    return radioButton;\r\n  }\r\n}\r\n","import { RadioButton } from \"../../components/controls/RadioButton\";\r\nimport { guid } from \"@fluxscape/runtime\";\r\nimport NodeSharedPortDefinitions from \"../../node-shared-port-definitions\";\r\nimport { createNodeFromReactComponent } from \"../../react-component-node\";\r\nimport Utils from \"./utils\";\r\n\r\nconst RadioButtonNode = {\r\n  name: \"net.noodl.controls.radiobutton\",\r\n  displayName: \"Radio Button\",\r\n  docs: \"https://docs.noodl.net/nodes/ui-controls/radio-button\",\r\n  allowChildren: false,\r\n  noodlNodeAsProp: true,\r\n  usePortAsLabel: \"label\",\r\n  nodeDoubleClickAction: {\r\n    focusPort: \"label\",\r\n  },\r\n  connectionPanel: {\r\n    groupPriority: [\r\n      \"General\",\r\n      \"Style\",\r\n      \"Fill Style\",\r\n      \"Actions\",\r\n      \"Events\",\r\n      \"States\",\r\n      \"Mounted\",\r\n      \"Label\",\r\n      \"Label Text Style\",\r\n      \"Hover Events\",\r\n      \"Pointer Events\",\r\n      \"Focus Events\",\r\n    ],\r\n  },\r\n  initialize() {\r\n    // @ts-expect-error\r\n    this.props.attrs = {};\r\n    // @ts-expect-error\r\n    this.props.sizeMode = \"explicit\";\r\n    // @ts-expect-error\r\n    this.props.id = \"input-\" + guid();\r\n\r\n    // @ts-expect-error\r\n    this._internal.checked = false;\r\n\r\n    // @ts-expect-error\r\n    this.props.checkedChanged = (checked) => {\r\n      // @ts-expect-error\r\n      const changed = this._internal.checked !== checked;\r\n      // @ts-expect-error\r\n      this._internal.checked = checked;\r\n      if (changed) {\r\n        // @ts-expect-error\r\n        this.flagOutputDirty(\"checked\");\r\n        // @ts-expect-error\r\n        this._updateVisualState();\r\n      }\r\n    };\r\n\r\n    // @ts-expect-error\r\n    this.props.styles.fill = {};\r\n  },\r\n  getReactComponent() {\r\n    return RadioButton;\r\n  },\r\n  inputs: {\r\n    fillColor: {\r\n      index: 19,\r\n      displayName: \"Fill Color\",\r\n      group: \"Fill Style\",\r\n      type: \"color\",\r\n      allowVisualStates: true,\r\n      styleTag: \"fill\",\r\n      set(value) {\r\n        // @ts-expect-error\r\n        this.setStyle({ backgroundColor: value }, \"fill\");\r\n      },\r\n    },\r\n    testId: {\r\n      index: 100009,\r\n      displayName: \"Test ID Attribute\",\r\n      group: \"Advanced HTML\",\r\n      type: \"string\",\r\n      set(value) {\r\n        // @ts-expect-error\r\n        this.props.attrs[\"data-testid\"] = value;\r\n        // @ts-expect-error\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n  },\r\n  inputProps: {\r\n    value: {\r\n      type: \"string\",\r\n      displayName: \"Value\",\r\n      group: \"General\",\r\n      index: 100,\r\n    },\r\n    fillSpacing: {\r\n      displayName: \"Fill Spacing\",\r\n      group: \"Fill Style\",\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"px\", \"vw\", \"vh\"],\r\n        defaultUnit: \"px\",\r\n      },\r\n      allowVisualStates: true,\r\n      default: 2,\r\n    },\r\n  },\r\n  inputCss: {\r\n    width: {\r\n      index: 11,\r\n      group: \"Dimensions\",\r\n      displayName: \"Width\",\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"px\", \"%\", \"vw\", \"vh\"],\r\n        defaultUnit: \"px\",\r\n      },\r\n      default: 32,\r\n      allowVisualStates: true,\r\n      styleTag: \"radio\",\r\n      onChange() {\r\n        // @ts-expect-error\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n    height: {\r\n      index: 12,\r\n      group: \"Dimensions\",\r\n      displayName: \"Height\",\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"px\", \"%\"],\r\n        defaultUnit: \"px\",\r\n      },\r\n      default: 32,\r\n      allowVisualStates: true,\r\n      styleTag: \"radio\",\r\n      onChange() {\r\n        // @ts-expect-error\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n    backgroundColor: {\r\n      index: 201,\r\n      displayName: \"Background Color\",\r\n      group: \"Style\",\r\n      type: \"color\",\r\n      allowVisualStates: true,\r\n      styleTag: \"radio\",\r\n      default: \"transparent\",\r\n      applyDefault: false,\r\n    },\r\n  },\r\n  outputs: {\r\n    checked: {\r\n      type: \"boolean\",\r\n      displayName: \"Checked\",\r\n      group: \"States\",\r\n      get() {\r\n        // @ts-expect-error\r\n        return this._internal.checked;\r\n      },\r\n    },\r\n  },\r\n};\r\n\r\nNodeSharedPortDefinitions.addAlignInputs(RadioButtonNode);\r\nNodeSharedPortDefinitions.addTransformInputs(RadioButtonNode);\r\nNodeSharedPortDefinitions.addMarginInputs(RadioButtonNode);\r\nNodeSharedPortDefinitions.addPaddingInputs(RadioButtonNode);\r\nNodeSharedPortDefinitions.addIconInputs(RadioButtonNode);\r\nNodeSharedPortDefinitions.addLabelInputs(RadioButtonNode, {\r\n  enableSpacing: true,\r\n  styleTag: \"label\",\r\n});\r\nNodeSharedPortDefinitions.addSharedVisualInputs(RadioButtonNode);\r\nNodeSharedPortDefinitions.addBorderInputs(RadioButtonNode, {\r\n  defaults: {\r\n    borderStyle: \"solid\",\r\n    borderWidth: 2,\r\n    borderRadius: 16,\r\n  },\r\n  styleTag: \"radio\",\r\n});\r\nNodeSharedPortDefinitions.addShadowInputs(RadioButtonNode, {\r\n  styleTag: \"radio\",\r\n});\r\nUtils.addControlEventsAndStates(RadioButtonNode, { checked: true });\r\n\r\nexport default createNodeFromReactComponent(RadioButtonNode);\r\n","import React, { useEffect, useState } from \"react\";\r\n\r\nimport RadioButtonContext from \"../../../contexts/radiobuttoncontext\";\r\nimport Layout from \"../../../layout\";\r\nimport { Noodl, Slot } from \"../../../types\";\r\n\r\nexport interface RadioButtonGroupProps extends Noodl.ReactProps {\r\n  name: string;\r\n  value: string;\r\n\r\n  valueChanged?: (value: string) => void;\r\n\r\n  children: Slot;\r\n}\r\n\r\nexport function RadioButtonGroup(props: RadioButtonGroupProps) {\r\n  const [selected, setSelected] = useState(props.value);\r\n  const context = {\r\n    selected: selected,\r\n    name: props.name,\r\n    checkedChanged: (value) => {\r\n      setSelected(value);\r\n      props.valueChanged && props.valueChanged(value);\r\n    },\r\n  };\r\n\r\n  useEffect(() => {\r\n    setSelected(props.value);\r\n  }, [props.value]);\r\n\r\n  const style: React.CSSProperties = { ...props.style };\r\n  Layout.size(style, props);\r\n  Layout.align(style, props);\r\n\r\n  let className = \"ndl-controls-radiobuttongroup\";\r\n  if (props.className) className = className + \" \" + props.className;\r\n\r\n  return (\r\n    <RadioButtonContext.Provider value={context}>\r\n      <div className={className} style={style}>\r\n        {props.children}\r\n      </div>\r\n    </RadioButtonContext.Provider>\r\n  );\r\n}\r\n","export const flexDirectionValues = [\r\n  \"row\",\r\n  \"row-reverse\",\r\n  \"column\",\r\n  \"column-reverse\",\r\n  \"inherit\",\r\n  \"initial\",\r\n  \"revert\",\r\n  \"unset\",\r\n];\r\n","import { RadioButtonGroup } from \"../../components/controls/RadioButtonGroup\";\r\nimport { flexDirectionValues } from \"../../constants/flex\";\r\nimport { guid } from \"@fluxscape/runtime\";\r\nimport NodeSharedPortDefinitions from \"../../node-shared-port-definitions\";\r\nimport { createNodeFromReactComponent } from \"../../react-component-node\";\r\n\r\nconst RadioButtonGroupNode = {\r\n  name: \"Radio Button Group\",\r\n  displayName: \"Radio Button Group\",\r\n  docs: \"https://docs.noodl.net/nodes/ui-controls/radio-button-group\",\r\n  allowChildren: true,\r\n  noodlNodeAsProp: true,\r\n  useVariants: false,\r\n  connectionPanel: {\r\n    groupPriority: [\r\n      \"General\",\r\n      \"Style\",\r\n      \"Actions\",\r\n      \"Events\",\r\n      \"Mounted\",\r\n      \"States\",\r\n    ],\r\n  },\r\n  initialize() {\r\n    // @ts-expect-error\r\n    this.props.name = \"radio-\" + guid();\r\n\r\n    // @ts-expect-error\r\n    this.props.valueChanged = (value) => {\r\n      // @ts-expect-error\r\n      const changed = this._internal.value !== value;\r\n      // @ts-expect-error\r\n      this._internal.value = value;\r\n      // @ts-expect-error\r\n      this.props.value = value;\r\n      if (changed) {\r\n        // @ts-expect-error\r\n        this.forceUpdate();\r\n        // @ts-expect-error\r\n        this.flagOutputDirty(\"value\");\r\n        // @ts-expect-error\r\n        this.sendSignalOnOutput(\"onChange\");\r\n      }\r\n    };\r\n  },\r\n  getReactComponent() {\r\n    return RadioButtonGroup;\r\n  },\r\n  defaultCss: {\r\n    display: \"flex\",\r\n    position: \"relative\",\r\n    flexDirection: \"column\",\r\n  },\r\n  inputs: {\r\n    flexDirection: {\r\n      //don't rename for backwards compat\r\n      index: 11,\r\n      displayName: \"Layout\",\r\n      group: \"Layout\",\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"Vertical\", value: \"column\" },\r\n          { label: \"Horizontal\", value: \"row\" },\r\n        ],\r\n      },\r\n      default: \"column\",\r\n      set(value) {\r\n        // @ts-expect-error\r\n        this.props.layout = value;\r\n\r\n        if (value !== \"none\") {\r\n          // @ts-expect-error\r\n          this.setStyle({ flexDirection: value });\r\n        } else {\r\n          // @ts-expect-error\r\n          this.removeStyle([\"flexDirection\"]);\r\n        }\r\n\r\n        // @ts-expect-error\r\n        if (this.context.editorConnection) {\r\n          // Send warning if the value is wrong\r\n          if (value !== \"none\" && !flexDirectionValues.includes(value)) {\r\n            // @ts-expect-error\r\n            this.context.editorConnection.sendWarning(\r\n              // @ts-expect-error\r\n              this.nodeScope.componentOwner.name,\r\n              // @ts-expect-error\r\n              this.id,\r\n              \"layout-warning\",\r\n              {\r\n                message:\r\n                  \"Invalid Layout value has to be a valid flex-direction value.\",\r\n              }\r\n            );\r\n          } else {\r\n            // @ts-expect-error\r\n            this.context.editorConnection.clearWarning(\r\n              // @ts-expect-error\r\n              this.nodeScope.componentOwner.name,\r\n              // @ts-expect-error\r\n              this.id,\r\n              \"layout-warning\"\r\n            );\r\n          }\r\n        }\r\n\r\n        // @ts-expect-error\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n    value: {\r\n      index: 20,\r\n      type: \"string\",\r\n      displayName: \"Value\",\r\n      group: \"General\",\r\n      set: function (value) {\r\n        if (typeof value !== \"string\" && value.toString !== undefined)\r\n          value = value.toString();\r\n        if (typeof value !== \"string\") return;\r\n\r\n        // @ts-expect-error\r\n        const changed = value !== this._internal.value;\r\n        // @ts-expect-error\r\n        this.props.value = this._internal.value = value;\r\n\r\n        if (changed) {\r\n          // @ts-expect-error\r\n          this.forceUpdate();\r\n          // @ts-expect-error\r\n          this.flagOutputDirty(\"value\");\r\n        }\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    value: {\r\n      type: \"string\",\r\n      displayName: \"Value\",\r\n      group: \"States\",\r\n      getter: function () {\r\n        // @ts-expect-error\r\n        return this._internal.value;\r\n      },\r\n    },\r\n    onChange: {\r\n      type: \"signal\",\r\n      displayName: \"Changed\",\r\n      group: \"Events\",\r\n    },\r\n  },\r\n  inputProps: {},\r\n  outputProps: {},\r\n};\r\n\r\nNodeSharedPortDefinitions.addDimensions(RadioButtonGroupNode, {\r\n  defaultSizeMode: \"contentSize\",\r\n  contentLabel: \"Content\",\r\n});\r\nNodeSharedPortDefinitions.addAlignInputs(RadioButtonGroupNode);\r\nNodeSharedPortDefinitions.addTransformInputs(RadioButtonGroupNode);\r\nNodeSharedPortDefinitions.addMarginInputs(RadioButtonGroupNode);\r\nNodeSharedPortDefinitions.addPaddingInputs(RadioButtonGroupNode);\r\nNodeSharedPortDefinitions.addSharedVisualInputs(RadioButtonGroupNode);\r\n\r\nexport default createNodeFromReactComponent(RadioButtonGroupNode);\r\n","import React, { useEffect, useState } from \"react\";\r\n\r\nimport Layout from \"../../../layout\";\r\nimport Utils from \"../../../nodes/controls/utils\";\r\nimport { Noodl } from \"../../../types\";\r\n\r\nexport interface SliderProps extends Noodl.ReactProps {\r\n  _nodeId: string;\r\n  id: string;\r\n  enabled: boolean;\r\n\r\n  attrs: React.Attributes;\r\n  sizeMode?: string; // TODO: What is sizeMode here?\r\n\r\n  value: number;\r\n  min: number;\r\n  max: number;\r\n  step: number;\r\n\r\n  thumbHeight: string;\r\n  thumbWidth: string;\r\n  thumbColor: string;\r\n\r\n  trackHeight: string;\r\n  trackActiveColor: string;\r\n  trackColor: string;\r\n\r\n  onClick: () => void;\r\n  updateOutputValue: (value: number) => void;\r\n}\r\n\r\nfunction _styleTemplate(_class: string, props: SliderProps) {\r\n  return `.${_class}::-webkit-slider-thumb {\r\n  width: ${props.thumbWidth};\r\n}`;\r\n}\r\n\r\nfunction setBorderStyle(\r\n  style: React.CSSProperties,\r\n  prefix: string,\r\n  props: SliderProps\r\n) {\r\n  function setBorder(style: React.CSSProperties, group: string) {\r\n    const width = `${prefix}Border${group}Width`;\r\n    const color = `${prefix}Border${group}Color`;\r\n    const borderStyle = `${prefix}Border${group}Style`;\r\n\r\n    const w = props[width] || props[`${prefix}BorderWidth`];\r\n    if (w !== undefined) style[`border${group}Width`] = w;\r\n\r\n    const c = (style[color] = props[color] || props[`${prefix}BorderColor`]);\r\n    if (c !== undefined) style[`border${group}Color`] = c;\r\n\r\n    const s = props[borderStyle] || props[`${prefix}BorderStyle`];\r\n    if (s !== undefined) style[`border${group}Style`] = s;\r\n  }\r\n\r\n  setBorder(style, \"Top\");\r\n  setBorder(style, \"Right\");\r\n  setBorder(style, \"Bottom\");\r\n  setBorder(style, \"Left\");\r\n}\r\n\r\nfunction setBorderRadius(\r\n  style: React.CSSProperties,\r\n  prefix: string,\r\n  props: SliderProps\r\n) {\r\n  const radius = props[`${prefix}BorderRadius`];\r\n  const tl = props[`${prefix}BorderTopLeftRadius`] || radius;\r\n  const tr = props[`${prefix}BorderTopRightRadius`] || radius;\r\n  const br = props[`${prefix}BorderBottomRightRadius`] || radius;\r\n  const bl = props[`${prefix}BorderBottomLeftRadius`] || radius;\r\n\r\n  style.borderRadius = `${tl} ${tr} ${br} ${bl}`;\r\n}\r\n\r\nfunction setShadow(\r\n  style: React.CSSProperties,\r\n  prefix: string,\r\n  props: SliderProps\r\n) {\r\n  if (!props[`${prefix}BoxShadowEnabled`]) return;\r\n\r\n  const inset = props[`${prefix}BoxShadowInset`];\r\n  const x = props[`${prefix}BoxShadowOffsetX`];\r\n  const y = props[`${prefix}BoxShadowOffsetY`];\r\n  const blur = props[`${prefix}BoxShadowBlurRadius`];\r\n  const spread = props[`${prefix}BoxShadowSpreadRadius`];\r\n  const color = props[`${prefix}BoxShadowColor`];\r\n\r\n  style.boxShadow = `${\r\n    inset ? \"inset \" : \"\"\r\n  }${x} ${y} ${blur} ${spread} ${color}`;\r\n}\r\n\r\nfunction hasUnitPx(value: string) {\r\n  return value && value[value.length - 1] === \"x\";\r\n}\r\n\r\nexport function Slider(props: SliderProps) {\r\n  const [value, setValue] = useState(props.value);\r\n\r\n  useEffect(() => {\r\n    onValueChanged(props.value);\r\n  }, [props.value]);\r\n\r\n  function onValueChanged(value: number) {\r\n    setValue(value);\r\n    props.updateOutputValue(value);\r\n  }\r\n\r\n  const style: React.CSSProperties = { ...props.style };\r\n  Layout.size(style, props);\r\n  Layout.align(style, props);\r\n\r\n  const instanceClassId = \"ndl-controls-range-\" + props._nodeId;\r\n  Utils.updateStylesForClass(instanceClassId, props, _styleTemplate);\r\n\r\n  const className = `ndl-controls-range2 ${instanceClassId} ${\r\n    props.className ? props.className : \"\"\r\n  } `;\r\n\r\n  const inputProps: React.InputHTMLAttributes<HTMLInputElement> = {\r\n    ...props.attrs,\r\n    id: props.id,\r\n    style: {\r\n      width: \"100%\",\r\n      opacity: 0,\r\n    },\r\n    onClick: props.onClick,\r\n    min: props.min,\r\n    max: props.max,\r\n  };\r\n\r\n  inputProps.style = inputProps.style || {};\r\n\r\n  if (props.step) {\r\n    inputProps.step = props.step;\r\n  }\r\n\r\n  //make the input as tall as the tallest element, track or thumb, so the entire area becomes interactive\r\n  //Makes it possible to design sliders with thin tracks and tall thumbs\r\n\r\n  if (hasUnitPx(props.thumbHeight)) {\r\n    if (hasUnitPx(props.trackHeight)) {\r\n      const thumbHeight = Number(props.thumbHeight.slice(0, -2));\r\n      const trackHeight = Number(props.trackHeight.slice(0, -2));\r\n      inputProps.style.height = Math.max(thumbHeight, trackHeight) + \"px\";\r\n    } else {\r\n      inputProps.style.height = props.thumbHeight;\r\n    }\r\n  } else {\r\n    inputProps.style.height = props.trackHeight;\r\n  }\r\n\r\n  const divStyle = {\r\n    display: \"flex\",\r\n    alignItems: \"center\",\r\n    ...style,\r\n  };\r\n\r\n  const valueFactor = (value - props.min) / (props.max - props.min);\r\n\r\n  const trackStyle: React.CSSProperties = {\r\n    position: \"absolute\",\r\n    width: \"100%\",\r\n    height: props.trackHeight,\r\n    background: `linear-gradient(to right, ${props.trackActiveColor} 0%, ${\r\n      props.trackActiveColor\r\n    } ${valueFactor * 100}%, ${props.trackColor} ${valueFactor * 100}%, ${\r\n      props.trackColor\r\n    } 100%)`,\r\n  };\r\n\r\n  setBorderStyle(trackStyle, \"track\", props);\r\n  setBorderRadius(trackStyle, \"track\", props);\r\n  setShadow(trackStyle, \"track\", props);\r\n\r\n  const thumbStyle: React.CSSProperties = {\r\n    position: \"absolute\",\r\n    left: \"calc((100% - \" + props.thumbWidth + \") * \" + valueFactor + \")\",\r\n    width: props.thumbWidth,\r\n    height: props.thumbHeight,\r\n    backgroundColor: props.thumbColor,\r\n  };\r\n\r\n  setBorderStyle(thumbStyle, \"thumb\", props);\r\n  setBorderRadius(thumbStyle, \"thumb\", props);\r\n  setShadow(thumbStyle, \"thumb\", props);\r\n\r\n  return (\r\n    <div style={divStyle}>\r\n      <div style={trackStyle} />\r\n      <div style={thumbStyle} />\r\n      <input\r\n        className={className}\r\n        {...Utils.controlEvents(props)}\r\n        type=\"range\"\r\n        {...inputProps}\r\n        value={value}\r\n        disabled={!props.enabled}\r\n        onChange={(e) => onValueChanged(Number(e.target.value))}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import { Slider, SliderProps } from \"../../components/controls/Slider\";\r\nimport { guid } from \"@fluxscape/runtime\";\r\nimport NodeSharedPortDefinitions from \"../../node-shared-port-definitions\";\r\nimport { createNodeFromReactComponent } from \"../../react-component-node\";\r\nimport Utils from \"./utils\";\r\nimport { ReactNodeDefinition } from \"../../ReactNodeDefinition\";\r\n\r\nconst thumbPopout = { group: \"thumb-styles\", label: \"Thumb Styles\" };\r\nconst trackPopout = { group: \"track-styles\", label: \"Track Styles\" };\r\n\r\ninterface Internal {\r\n  outputValue: number;\r\n  valuePercent: number;\r\n}\r\n\r\nconst RangeNode: ReactNodeDefinition<Internal, SliderProps> = {\r\n  name: \"net.noodl.controls.range\",\r\n  displayNodeName: \"Slider\",\r\n  category: \"Controls\",\r\n  docs: \"https://docs.noodl.net/nodes/ui-controls/slider\",\r\n  allowChildren: false,\r\n  noodlNodeAsProp: true,\r\n  connectionPanel: {\r\n    groupPriority: [\r\n      \"General\",\r\n      \"Style\",\r\n      \"Actions\",\r\n      \"Events\",\r\n      \"States\",\r\n      \"Mounted\",\r\n      \"Hover Events\",\r\n      \"Pointer Events\",\r\n      \"Focus Events\",\r\n    ],\r\n  },\r\n  initialize() {\r\n    this.props.attrs = {};\r\n    this.props.sizeMode = \"contentHeight\";\r\n    this.props.id = \"input-\" + guid();\r\n\r\n    this.props.value = this.props.min;\r\n    this._internal.outputValue = 0;\r\n\r\n    this.props._nodeId = this.id;\r\n\r\n    //this is used by the range to communicate with the node whenever the range changes value\r\n\r\n    this.props.updateOutputValue = (value: string | number) => {\r\n      value = typeof value === \"string\" ? parseFloat(value) : value;\r\n\r\n      const valueChanged = this._internal.outputValue !== value;\r\n      if (valueChanged) {\r\n        this._internal.outputValue = value;\r\n        this.flagOutputDirty(\"value\");\r\n        // @ts-expect-error\r\n        this._updateOutputValuePercent(value);\r\n        this.sendSignalOnOutput(\"onChange\");\r\n      }\r\n\r\n      // On first mount, output the initial percentage.\r\n      if (!this._internal.valuePercent) {\r\n        // @ts-expect-error\r\n        this._updateOutputValuePercent(value);\r\n      }\r\n    };\r\n\r\n    this.props.updateOutputValue(this.props.value); // Set the value output to an initial value\r\n  },\r\n  getReactComponent() {\r\n    return Slider;\r\n  },\r\n  inputs: {\r\n    value: {\r\n      type: \"string\",\r\n      displayName: \"Value\",\r\n      group: \"General\",\r\n      index: 100,\r\n      set(value) {\r\n        // @ts-expect-error\r\n        this._setInputValue(value);\r\n      },\r\n    },\r\n    testId: {\r\n      index: 100009,\r\n      displayName: \"Test ID Attribute\",\r\n      group: \"Advanced HTML\",\r\n      type: \"string\",\r\n      set(value) {\r\n        this.props.attrs[\"data-testid\"] = value;\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n  },\r\n  outputs: {\r\n    value: {\r\n      type: \"number\",\r\n      displayName: \"Value\",\r\n      group: \"States\",\r\n      get() {\r\n        return this._internal.outputValue;\r\n      },\r\n    },\r\n    valuePercent: {\r\n      type: \"number\",\r\n      displayName: \"Value Percent\",\r\n      group: \"States\",\r\n      get() {\r\n        return this._internal.valuePercent;\r\n      },\r\n    },\r\n    onChange: {\r\n      type: \"signal\",\r\n      displayName: \"Changed\",\r\n      group: \"Events\",\r\n    },\r\n  },\r\n  inputProps: {\r\n    min: {\r\n      type: \"number\",\r\n      displayName: \"Min\",\r\n      group: \"General\",\r\n      default: 0,\r\n      index: 100,\r\n      onChange() {\r\n        // @ts-expect-error\r\n        this._setInputValue(this.props.value);\r\n      },\r\n    },\r\n    max: {\r\n      type: \"number\",\r\n      displayName: \"Max\",\r\n      group: \"General\",\r\n      default: 100,\r\n      index: 100,\r\n      onChange() {\r\n        // @ts-expect-error\r\n        this._setInputValue(this.props.value);\r\n      },\r\n    },\r\n    step: {\r\n      type: \"number\",\r\n      displayName: \"Step\",\r\n      group: \"General\",\r\n      default: 1,\r\n      index: 100,\r\n    },\r\n    width: {\r\n      index: 11,\r\n      group: \"Dimensions\",\r\n      displayName: \"Width\",\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"%\", \"px\", \"vw\"],\r\n        defaultUnit: \"%\",\r\n      },\r\n      default: 100,\r\n      allowVisualStates: true,\r\n    },\r\n    // Styles\r\n    thumbWidth: {\r\n      group: \"Thumb Style\",\r\n      displayName: \"Width\",\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"px\", \"vw\", \"%\"],\r\n        defaultUnit: \"px\",\r\n        allowEditOnly: true,\r\n      },\r\n      default: 16,\r\n      popout: thumbPopout,\r\n      allowVisualStates: true,\r\n    },\r\n    thumbHeight: {\r\n      group: \"Thumb Style\",\r\n      displayName: \"Height\",\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"px\", \"vh\", \"%\"],\r\n        defaultUnit: \"px\",\r\n        allowEditOnly: true,\r\n      },\r\n      default: 16,\r\n      popout: thumbPopout,\r\n      allowVisualStates: true,\r\n    },\r\n    thumbColor: {\r\n      group: \"Thumb Style\",\r\n      displayName: \"Color\",\r\n      type: { name: \"color\", allowEditOnly: true },\r\n      default: \"#000000\",\r\n      popout: thumbPopout,\r\n      allowVisualStates: true,\r\n    },\r\n    trackHeight: {\r\n      group: \"Track Style\",\r\n      displayName: \"Height\",\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"px\", \"vh\", \"%\"],\r\n        defaultUnit: \"px\",\r\n        allowEditOnly: true,\r\n      },\r\n      default: 6,\r\n      popout: trackPopout,\r\n      allowVisualStates: true,\r\n    },\r\n    trackColor: {\r\n      group: \"Track Style\",\r\n      displayName: \"Inactive Color\",\r\n      type: { name: \"color\", allowEditOnly: true },\r\n      default: \"#f0f0f0\",\r\n      popout: trackPopout,\r\n      allowVisualStates: true,\r\n    },\r\n    trackActiveColor: {\r\n      group: \"Track Style\",\r\n      displayName: \"Active Color\",\r\n      type: { name: \"color\", allowEditOnly: true },\r\n      default: \"#f0f0f0\",\r\n      popout: trackPopout,\r\n      allowVisualStates: true,\r\n    },\r\n  },\r\n  methods: {\r\n    _updateOutputValuePercent(value: number) {\r\n      const min = Number(this.props.min);\r\n      const max = Number(this.props.max);\r\n\r\n      const valuePercent = Math.floor(((value - min) / (max - min)) * 100);\r\n      const valuePercentChanged =\r\n        // @ts-expect-error\r\n        this._internal.valuePercentChanged !== valuePercent;\r\n\r\n      this._internal.valuePercent = valuePercent;\r\n      valuePercentChanged && this.flagOutputDirty(\"valuePercent\");\r\n    },\r\n    _setInputValue(newValue) {\r\n      //make sure value never goes out of range\r\n      const value = Math.max(\r\n        this.props.min,\r\n        Math.min(this.props.max, newValue || 0)\r\n      );\r\n\r\n      const changed = value !== this.props.value;\r\n      if (changed) {\r\n        this.props.value = value;\r\n        this.forceUpdate();\r\n      }\r\n    },\r\n  },\r\n};\r\n\r\n//Add borders\r\nfunction addBorderInputs(definition, opts) {\r\n  opts = opts || {};\r\n  const defaults = opts.defaults || {};\r\n  const popout = opts.popout;\r\n\r\n  defaults.borderStyle = \"none\";\r\n  defaults.borderWidth = 0;\r\n  defaults.borderColor = \"#000000\";\r\n\r\n  const prefixLabel =\r\n    opts.propPrefix[0].toUpperCase() + opts.propPrefix.slice(1);\r\n\r\n  function defineBorderTab(definition, suffix, tabName, indexOffset) {\r\n    const styleName = opts.propPrefix + `Border${suffix}Style`;\r\n    const widthName = opts.propPrefix + `Border${suffix}Width`;\r\n    const colorName = opts.propPrefix + `Border${suffix}Color`;\r\n\r\n    let orNotSet =\r\n      defaults.borderStyle !== \"none\" ? \"OR borderStyle NOT SET\" : \"\";\r\n\r\n    if (suffix) {\r\n      if (defaults[styleName] && defaults[styleName] !== \"none\")\r\n        orNotSet += `OR ${styleName} NOT SET`;\r\n      NodeSharedPortDefinitions.addDynamicInputPorts(\r\n        definition,\r\n        `${styleName} = solid OR ${styleName} = dashed OR ${styleName} = dotted OR borderStyle = solid OR borderStyle = dashed OR borderStyle = dotted ${orNotSet}`,\r\n        [`${widthName}`, `${colorName}`]\r\n      );\r\n    } else {\r\n      NodeSharedPortDefinitions.addDynamicInputPorts(\r\n        definition,\r\n        `${styleName} = solid OR ${styleName} = dashed OR ${styleName} = dotted ${orNotSet}`,\r\n        [`${widthName}`, `${colorName}`]\r\n      );\r\n    }\r\n\r\n    const tab = {\r\n      group: opts.propPrefix + \"-border-styles\",\r\n      tab: tabName,\r\n      label: suffix,\r\n    };\r\n\r\n    const editorName = (name) =>\r\n      `${prefixLabel} ${name} ${suffix ? \"(\" + suffix + \")\" : \"\"}`;\r\n    const index = 202 + indexOffset * 4;\r\n\r\n    const groupName = prefixLabel + \" Border Style\";\r\n\r\n    NodeSharedPortDefinitions.addInputProps(definition, {\r\n      [styleName]: {\r\n        index: index + 1,\r\n        displayName: \"Border Style\",\r\n        editorName: editorName(\"Border Style\"),\r\n        group: groupName,\r\n        type: {\r\n          name: \"enum\",\r\n          enums: [\r\n            { label: \"None\", value: \"none\" },\r\n            { label: \"Solid\", value: \"solid\" },\r\n            { label: \"Dotted\", value: \"dotted\" },\r\n            { label: \"Dashed\", value: \"dashed\" },\r\n          ],\r\n        },\r\n        default: defaults[`border${suffix}Style`],\r\n        tab,\r\n        popout,\r\n        allowVisualStates: true,\r\n      },\r\n      [widthName]: {\r\n        index: index + 2,\r\n        displayName: \"Border Width\",\r\n        editorName: editorName(\"Border Width\"),\r\n        group: groupName,\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\"],\r\n          defaultUnit: \"px\",\r\n        },\r\n        default: defaults[`border${suffix}Width`],\r\n        tab,\r\n        popout,\r\n        allowVisualStates: true,\r\n      },\r\n      [colorName]: {\r\n        index: index + 3,\r\n        displayName: \"Border Color\",\r\n        editorName: editorName(\"Border Color\"),\r\n        group: groupName,\r\n        type: \"color\",\r\n        default: defaults[`border${suffix}Color`],\r\n        tab,\r\n        popout,\r\n        allowVisualStates: true,\r\n      },\r\n    });\r\n  }\r\n\r\n  defineBorderTab(definition, \"\", \"borders-all\", 0);\r\n  defineBorderTab(definition, \"Left\", \"borders-left\", 1);\r\n  defineBorderTab(definition, \"Top\", \"borders-top\", 2);\r\n  defineBorderTab(definition, \"Right\", \"borders-right\", 3);\r\n  defineBorderTab(definition, \"Bottom\", \"borders-bottom\", 4);\r\n}\r\n\r\nfunction addBorderRadius(definition, opts) {\r\n  opts = opts || {};\r\n  const defaults = opts.defaults || {};\r\n  const popout = opts.popout;\r\n\r\n  if (!defaults.borderRadius) defaults.borderRadius = 0;\r\n\r\n  const prefixLabel =\r\n    opts.propPrefix[0].toUpperCase() + opts.propPrefix.slice(1);\r\n\r\n  function defineCornerTab(definition, suffix, tabName, indexOffset) {\r\n    const editorName = (name) =>\r\n      `${prefixLabel} ${name} ${suffix ? \"(\" + suffix + \")\" : \"\"}`;\r\n\r\n    const tab = {\r\n      group: opts.propPrefix + \"-corners\",\r\n      tab: tabName,\r\n      label: suffix,\r\n    };\r\n    const radiusName = `Border${suffix}Radius`;\r\n\r\n    NodeSharedPortDefinitions.addInputProps(definition, {\r\n      [opts.propPrefix + radiusName]: {\r\n        index: 240 + indexOffset,\r\n        displayName: \"Corner Radius\",\r\n        editorName: editorName(\"Corner Radius\"),\r\n        group: prefixLabel + \" Corner Radius\",\r\n        type: {\r\n          name: \"number\",\r\n          units: [\"px\", \"%\"],\r\n          defaultUnit: \"px\",\r\n        },\r\n        default: defaults[`border${suffix}Radius`],\r\n        tab,\r\n        popout,\r\n      },\r\n    });\r\n  }\r\n\r\n  defineCornerTab(definition, \"\", \"corners-all\", 0);\r\n  defineCornerTab(definition, \"TopLeft\", \"corners-top-left\", 1);\r\n  defineCornerTab(definition, \"TopRight\", \"corners-top-right\", 2);\r\n  defineCornerTab(definition, \"BottomRight\", \"corners-bottom-right\", 3);\r\n  defineCornerTab(definition, \"BottomLeft\", \"corners-bottom-left\", 4);\r\n}\r\n\r\nfunction addShadowInputs(definition, opts) {\r\n  opts = opts || {};\r\n  const popout = opts.popout;\r\n  const prefix = opts.propPrefix;\r\n\r\n  NodeSharedPortDefinitions.addDynamicInputPorts(\r\n    definition,\r\n    `${prefix}BoxShadowEnabled = true`,\r\n    [\r\n      `${prefix}BoxShadowOffsetX`,\r\n      `${prefix}BoxShadowOffsetY`,\r\n      `${prefix}BoxShadowInset`,\r\n      `${prefix}BoxShadowBlurRadius`,\r\n      `${prefix}BoxShadowSpreadRadius`,\r\n      `${prefix}BoxShadowColor`,\r\n    ]\r\n  );\r\n\r\n  const prefixLabel =\r\n    opts.propPrefix[0].toUpperCase() + opts.propPrefix.slice(1);\r\n  const editorName = (name) => `${prefixLabel} ${name}`;\r\n\r\n  NodeSharedPortDefinitions.addInputProps(definition, {\r\n    [`${prefix}BoxShadowEnabled`]: {\r\n      index: 250,\r\n      group: opts.group || \"Box Shadow\",\r\n      displayName: \"Shadow Enabled\",\r\n      editorName: editorName(\"Shadow Enabled\"),\r\n      type: \"boolean\",\r\n      allowVisualStates: true,\r\n      popout,\r\n    },\r\n    [`${prefix}BoxShadowOffsetX`]: {\r\n      index: 251,\r\n      group: opts.group || \"Box Shadow\",\r\n      displayName: \"Offset X\",\r\n      editorName: editorName(\"Offset X\"),\r\n      default: 0,\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"px\"],\r\n        defaultUnit: \"px\",\r\n      },\r\n      allowVisualStates: true,\r\n      popout,\r\n    },\r\n    [`${prefix}BoxShadowOffsetY`]: {\r\n      index: 252,\r\n      group: opts.group || \"Box Shadow\",\r\n      displayName: \"Offset Y\",\r\n      editorName: editorName(\"Offset Y\"),\r\n      default: 0,\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"px\"],\r\n        defaultUnit: \"px\",\r\n      },\r\n      allowVisualStates: true,\r\n      popout,\r\n    },\r\n    [`${prefix}BoxShadowBlurRadius`]: {\r\n      index: 253,\r\n      group: opts.group || \"Box Shadow\",\r\n      displayName: \"Blur Radius\",\r\n      editorName: editorName(\"Blur Radius\"),\r\n      default: 5,\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"px\"],\r\n        defaultUnit: \"px\",\r\n      },\r\n      allowVisualStates: true,\r\n      popout,\r\n    },\r\n    [`${prefix}BoxShadowSpreadRadius`]: {\r\n      index: 254,\r\n      group: opts.group || \"Box Shadow\",\r\n      displayName: \"Spread Radius\",\r\n      editorName: editorName(\"Spread Radius\"),\r\n      default: 2,\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"px\"],\r\n        defaultUnit: \"px\",\r\n      },\r\n      allowVisualStates: true,\r\n      popout,\r\n    },\r\n    [`${prefix}BoxShadowInset`]: {\r\n      index: 255,\r\n      group: opts.group || \"Box Shadow\",\r\n      displayName: \"Inset\",\r\n      editorName: editorName(\"Inset\"),\r\n      type: \"boolean\",\r\n      default: false,\r\n      allowVisualStates: true,\r\n      popout,\r\n    },\r\n    [`${prefix}BoxShadowColor`]: {\r\n      index: 256,\r\n      group: opts.group || \"Box Shadow\",\r\n      displayName: \"Shadow Color\",\r\n      editorName: editorName(\"Shadow Color\"),\r\n      type: \"color\",\r\n      default: \"#00000033\",\r\n      allowVisualStates: true,\r\n      popout,\r\n    },\r\n  });\r\n}\r\n\r\nNodeSharedPortDefinitions.addAlignInputs(RangeNode);\r\nNodeSharedPortDefinitions.addTransformInputs(RangeNode);\r\nNodeSharedPortDefinitions.addMarginInputs(RangeNode);\r\nNodeSharedPortDefinitions.addPaddingInputs(RangeNode);\r\nNodeSharedPortDefinitions.addSharedVisualInputs(RangeNode);\r\naddBorderInputs(RangeNode, { propPrefix: \"track\", popout: trackPopout });\r\naddBorderRadius(RangeNode, { propPrefix: \"track\", popout: trackPopout });\r\naddShadowInputs(RangeNode, {\r\n  propPrefix: \"track\",\r\n  popout: trackPopout,\r\n  group: \"Track Box Shadow\",\r\n});\r\n\r\naddBorderInputs(RangeNode, { propPrefix: \"thumb\", popout: thumbPopout });\r\naddBorderRadius(RangeNode, { propPrefix: \"thumb\", popout: thumbPopout });\r\naddShadowInputs(RangeNode, {\r\n  propPrefix: \"thumb\",\r\n  popout: thumbPopout,\r\n  group: \"Thumb Box Shadow\",\r\n});\r\n\r\nUtils.addControlEventsAndStates(RangeNode);\r\n\r\nexport default createNodeFromReactComponent(RangeNode);\r\n","import React from 'react';\r\n\r\nimport Layout from '../../../layout';\r\nimport Utils from '../../../nodes/controls/utils';\r\nimport { Noodl, Slot } from '../../../types';\r\n\r\n//this stops a text field from being unfocused by the clickHandler in the viewer that handles focus globally.\r\n//The specific case is when a mouseDown is registered in the input, but the mouseUp is outside.\r\n//It'll trigger a focus change that'll blur the input field, which is annyoing when you're selecting text\r\nfunction preventGlobalFocusChange(e) {\r\n  e.stopPropagation();\r\n  window.removeEventListener('click', preventGlobalFocusChange, true);\r\n}\r\n\r\nexport interface TextInputProps extends Noodl.ReactProps {\r\n  id: string;\r\n  type: 'text' | 'textArea' | 'email' | 'number' | 'password' | 'url';\r\n  textStyle: Noodl.TextStyle;\r\n\r\n  attrs: React.Attributes;\r\n\r\n  enabled: boolean;\r\n\r\n  placeholder: string;\r\n  maxLength: number;\r\n\r\n  startValue: string;\r\n  value: string;\r\n\r\n  useLabel: boolean;\r\n  label: string;\r\n  labelSpacing: string;\r\n  labeltextStyle: Noodl.TextStyle;\r\n\r\n  useIcon: boolean;\r\n  iconPlacement: 'left' | 'right';\r\n  iconSpacing: string;\r\n  iconSourceType: 'image' | 'icon';\r\n  iconImageSource: Noodl.Image;\r\n  iconIconSource: Noodl.Icon;\r\n  iconSize: string;\r\n  iconColor: Noodl.Color;\r\n\r\n  onTextChanged?: (value: string) => void;\r\n  onEnter?: () => void;\r\n\r\n  children: Slot;\r\n}\r\n\r\n// Based on (HTMLTextAreaElement | HTMLInputElement)\r\ntype InputRef = (HTMLTextAreaElement | HTMLInputElement) & {\r\n  noodlNode?: Noodl.ReactProps['noodlNode'];\r\n} | null;\r\n\r\ntype State = {\r\n  value: string;\r\n};\r\n\r\nexport class TextInput extends React.Component<TextInputProps, State> {\r\n  ref: React.MutableRefObject<InputRef>;\r\n\r\n  constructor(props: TextInputProps) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      value: props.startValue\r\n    } satisfies State;\r\n\r\n    this.ref = React.createRef<InputRef>();\r\n  }\r\n\r\n  setText(value: string) {\r\n    this.setState({ value });\r\n    this.props.onTextChanged && this.props.onTextChanged(value);\r\n  }\r\n\r\n  componentDidMount() {\r\n    // Plumbing for the focused signals\r\n    if (this.ref.current) {\r\n      this.ref.current.noodlNode = this.props.noodlNode;\r\n    }\r\n\r\n    this.setText(this.props.startValue);\r\n  }\r\n\r\n  render() {\r\n    const style: React.CSSProperties = { ...this.props.style };\r\n\r\n    Layout.size(style, this.props);\r\n    Layout.align(style, this.props);\r\n\r\n    if (style.opacity === 0) {\r\n      style.pointerEvents = 'none';\r\n    }\r\n\r\n    const { height, ...otherStylesTmp } = style;\r\n    \r\n    // otherStylesTmp is not React.CSSProperties, reassigning it will correct the type.\r\n    const otherStyles: React.CSSProperties = otherStylesTmp;\r\n\r\n    const props = this.props;\r\n\r\n    const _renderIcon = () => {\r\n      if (props.iconSourceType === 'image' && props.iconImageSource !== undefined)\r\n        return (\r\n          <img\r\n            alt=\"\"\r\n            src={props.iconImageSource}\r\n            style={{\r\n              width: props.iconSize,\r\n              height: props.iconSize\r\n            }}\r\n            onClick={() => this.focus()}\r\n          />\r\n        );\r\n      else if (props.iconSourceType === 'icon' && props.iconIconSource !== undefined) {\r\n        const style: React.CSSProperties = {\r\n          userSelect: 'none',\r\n          fontSize: props.iconSize,\r\n          color: props.iconColor\r\n        };\r\n        if (props.iconPlacement === 'left' || props.iconPlacement === undefined) style.marginRight = props.iconSpacing;\r\n        else style.marginLeft = props.iconSpacing;\r\n\r\n        if (props.iconIconSource.codeAsClass === true) {\r\n          return (\r\n            <span className={[props.iconIconSource.class, props.iconIconSource.code].join(' ')} style={style}></span>\r\n          );\r\n        } else {\r\n          return (\r\n            <span className={props.iconIconSource.class} style={style}>\r\n              {props.iconIconSource.code}\r\n            </span>\r\n          );\r\n        }\r\n      }\r\n\r\n      return null;\r\n    };\r\n\r\n    let className = 'ndl-controls-textinput ' + props.id;\r\n    if (props.className) className = className + ' ' + props.className;\r\n\r\n    let inputContent;\r\n\r\n    const inputStyles: React.CSSProperties = {\r\n      ...props.textStyle,\r\n      ...props.styles.input,\r\n      width: '100%',\r\n      height: '100%'\r\n    };\r\n\r\n    inputStyles.color = props.noodlNode.context.styles.resolveColor(inputStyles.color);\r\n\r\n    const inputProps = {\r\n      ...props.attrs,\r\n      id: props.id,\r\n      value: this.state.value,\r\n      ...Utils.controlEvents(props),\r\n      disabled: !props.enabled,\r\n      style: inputStyles,\r\n      className,\r\n      placeholder: props.placeholder,\r\n      maxLength: props.maxLength,\r\n      onChange: (e) => this.onChange(e)\r\n    };\r\n\r\n    if (props.type !== 'textArea') {\r\n      inputContent = (\r\n        <input\r\n          ref={(ref) => (this.ref.current = ref)}\r\n          type={this.props.type}\r\n          {...inputProps}\r\n          onKeyDown={(e) => this.onKeyDown(e)}\r\n          onMouseDown={() => window.addEventListener('click', preventGlobalFocusChange, true)}\r\n          noodl-style-tag=\"input\"\r\n        />\r\n      );\r\n    } else {\r\n      inputProps.style.resize = 'none'; //disable user resizing\r\n      inputContent = (\r\n        <textarea\r\n          ref={(ref) => (this.ref.current = ref)}\r\n          {...inputProps}\r\n          onKeyDown={(e) => this.onKeyDown(e)}\r\n          noodl-style-tag=\"input\"\r\n        />\r\n      );\r\n    }\r\n\r\n    const inputWrapperStyle = {\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      ...props.styles.inputWrapper\r\n    };\r\n\r\n    const heightInPercent = height && height[String(height).length - 1] === '%';\r\n\r\n    if (props.useLabel) {\r\n      if (heightInPercent) {\r\n        inputWrapperStyle.flexGrow = 1;\r\n      } else {\r\n        inputWrapperStyle.height = height;\r\n      }\r\n    } else {\r\n      Object.assign(inputWrapperStyle, otherStyles);\r\n      inputWrapperStyle.height = height;\r\n    }\r\n\r\n    if (props.type !== 'textArea') {\r\n      inputWrapperStyle.alignItems = 'center';\r\n    }\r\n\r\n    const inputWithWrapper = (\r\n      <div style={inputWrapperStyle} noodl-style-tag=\"inputWrapper\">\r\n        {props.useIcon && props.iconPlacement === 'left' ? _renderIcon() : null}\r\n        {inputContent}\r\n        {props.useIcon && props.iconPlacement === 'right' ? _renderIcon() : null}\r\n      </div>\r\n    );\r\n\r\n    if (props.useLabel) {\r\n      otherStyles.display = 'flex';\r\n      otherStyles.flexDirection = 'column';\r\n      if (heightInPercent) otherStyles.height = height;\r\n\r\n      const labelStyle: React.CSSProperties = {\r\n        ...props.labeltextStyle,\r\n        ...props.styles.label,\r\n        marginBottom: props.labelSpacing\r\n      };\r\n      labelStyle.color = props.noodlNode.context.styles.resolveColor(labelStyle.color);\r\n\r\n      return (\r\n        <div style={otherStyles}>\r\n          <label htmlFor={props.id} style={labelStyle} noodl-style-tag=\"label\">\r\n            {props.label}\r\n          </label>\r\n          {inputWithWrapper}\r\n        </div>\r\n      );\r\n    } else {\r\n      return inputWithWrapper;\r\n    }\r\n  }\r\n\r\n  onKeyDown(e) {\r\n    if (e.key === 'Enter' || e.which === 13) {\r\n      this.props.onEnter && this.props.onEnter();\r\n    }\r\n  }\r\n\r\n  onChange(event) {\r\n    const value = event.target.value;\r\n    this.setText(value);\r\n  }\r\n\r\n  focus() {\r\n    this.ref.current && this.ref.current.focus();\r\n  }\r\n\r\n  blur() {\r\n    this.ref.current && this.ref.current.blur();\r\n  }\r\n\r\n  hasFocus() {\r\n    return document.activeElement === this.ref.current;\r\n  }\r\n}\r\n","import { TextInput } from \"../../components/controls/TextInput\";\r\nimport { guid } from \"@fluxscape/runtime\";\r\nimport NodeSharedPortDefinitions from \"../../node-shared-port-definitions\";\r\nimport { createNodeFromReactComponent } from \"../../react-component-node\";\r\nimport Utils from \"./utils\";\r\n\r\nfunction _styleTemplate(className, props) {\r\n  return `\r\n    .${className}::placeholder {\r\n        opacity: ${props.placeholderOpacity};\r\n    }\r\n    `;\r\n}\r\n\r\nconst TextInputNode = {\r\n  name: \"net.noodl.controls.textinput\",\r\n  displayName: \"Text Input\",\r\n  docs: \"https://docs.noodl.net/nodes/ui-controls/text-input\",\r\n  allowChildren: false,\r\n  noodlNodeAsProp: true,\r\n  usePortAsLabel: \"label\",\r\n  nodeDoubleClickAction: {\r\n    focusPort: \"label\",\r\n  },\r\n  connectionPanel: {\r\n    groupPriority: [\r\n      \"General\",\r\n      \"Text\",\r\n      \"Style\",\r\n      \"Actions\",\r\n      \"Events\",\r\n      \"States\",\r\n      \"Mounted\",\r\n      \"Text Style\",\r\n      \"Label\",\r\n      \"Label Text Style\",\r\n      \"Hover Events\",\r\n      \"Pointer Events\",\r\n      \"Focus Events\",\r\n    ],\r\n  },\r\n  getReactComponent() {\r\n    return TextInput;\r\n  },\r\n  initialize() {\r\n    // @ts-expect-error\r\n    this.props.attrs = {};\r\n    // @ts-expect-error\r\n    this.props.startValue = \"\";\r\n    // @ts-expect-error\r\n    this.props.id = this._internal.controlId = \"input-\" + guid();\r\n  },\r\n  inputProps: {\r\n    type: {\r\n      displayName: \"Type\",\r\n      group: \"Text\",\r\n      index: 19,\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"Text\", value: \"text\" },\r\n          { label: \"Text Area\", value: \"textArea\" },\r\n          { label: \"Email\", value: \"email\" },\r\n          { label: \"Number\", value: \"number\" },\r\n          { label: \"Password\", value: \"password\" },\r\n          { label: \"URL\", value: \"url\" },\r\n        ],\r\n      },\r\n      default: \"text\",\r\n    },\r\n    placeholder: {\r\n      index: 22,\r\n      group: \"Text\",\r\n      displayName: \"Placeholder\",\r\n      default: \"Type here...\",\r\n      type: {\r\n        name: \"string\",\r\n      },\r\n    },\r\n    maxLength: {\r\n      group: \"Text\",\r\n      displayName: \"Max length\",\r\n      type: \"number\",\r\n      index: 24,\r\n    },\r\n  },\r\n  inputs: {\r\n    placeHolderOpacity: {\r\n      index: 23,\r\n      group: \"Text\",\r\n      displayName: \"Placeholder opacity\",\r\n      type: \"number\",\r\n      default: 0.5,\r\n      set(value) {\r\n        // @ts-expect-error\r\n        const className = this._internal.controlId;\r\n        Utils.updateStylesForClass(\r\n          className,\r\n          { placeholderOpacity: value },\r\n          _styleTemplate\r\n        );\r\n      },\r\n    },\r\n    set: {\r\n      group: \"Actions\",\r\n      displayName: \"Set\",\r\n      type: \"signal\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          // @ts-expect-error\r\n          this.setText(this._internal.text);\r\n        });\r\n      },\r\n    },\r\n    startValue: {\r\n      index: 18,\r\n      displayName: \"Text\",\r\n      type: \"string\",\r\n      group: \"Text\",\r\n      set(value) {\r\n        // @ts-expect-error\r\n        if (this._internal.text === value) return;\r\n\r\n        // @ts-expect-error\r\n        this._internal.text = value;\r\n        // @ts-expect-error\r\n        if (this.isInputConnected(\"set\") === false) {\r\n          // @ts-expect-error\r\n          this.setText(value);\r\n        }\r\n      },\r\n    },\r\n    clear: {\r\n      type: \"signal\",\r\n      group: \"Actions\",\r\n      displayName: \"Clear\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.clear();\r\n      },\r\n    },\r\n    focus: {\r\n      type: \"signal\",\r\n      group: \"Actions\",\r\n      displayName: \"Focus\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.context.setNodeFocused(this, true);\r\n      },\r\n    },\r\n    blur: {\r\n      type: \"signal\",\r\n      group: \"Actions\",\r\n      displayName: \"Blur\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.context.setNodeFocused(this, false);\r\n      },\r\n    },\r\n    textAlignX: {\r\n      group: \"Text Alignment\",\r\n      index: 13,\r\n      displayName: \"Text Horizontal Align\",\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"left\", value: \"left\" },\r\n          { label: \"center\", value: \"center\" },\r\n          { label: \"right\", value: \"right\" },\r\n        ],\r\n        alignComp: \"justify\",\r\n      },\r\n      default: \"left\",\r\n      set(value) {\r\n        switch (value) {\r\n          case \"left\":\r\n            // @ts-expect-error\r\n            this.setStyle({ textAlign: \"left\" }, \"input\");\r\n            break;\r\n          case \"center\":\r\n            // @ts-expect-error\r\n            this.setStyle({ textAlign: \"center\" }, \"input\");\r\n            break;\r\n          case \"right\":\r\n            // @ts-expect-error\r\n            this.setStyle({ textAlign: \"right\" }, \"input\");\r\n            break;\r\n        }\r\n      },\r\n    },\r\n    testId: {\r\n      index: 100009,\r\n      displayName: \"Test ID Attribute\",\r\n      group: \"Advanced HTML\",\r\n      type: \"string\",\r\n      set(value) {\r\n        // @ts-expect-error\r\n        this.props.attrs[\"data-testid\"] = value;\r\n        // @ts-expect-error\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n  },\r\n  inputCss: {\r\n    backgroundColor: {\r\n      index: 100,\r\n      displayName: \"Background Color\",\r\n      group: \"Style\",\r\n      type: \"color\",\r\n      default: \"transparent\",\r\n      allowVisualStates: true,\r\n      styleTag: \"inputWrapper\",\r\n    },\r\n  },\r\n  outputProps: {\r\n    // Value\r\n    onTextChanged: {\r\n      group: \"General\",\r\n      displayName: \"Text\",\r\n      type: \"string\",\r\n      index: 1,\r\n      onChange() {\r\n        // @ts-expect-error\r\n        this.sendSignalOnOutput(\"textChanged\");\r\n      },\r\n    },\r\n\r\n    // Events\r\n    onEnter: {\r\n      group: \"Events\",\r\n      displayName: \"On Enter\",\r\n      type: \"signal\",\r\n    },\r\n  },\r\n  outputs: {\r\n    textChanged: {\r\n      displayName: \"Text Changed\",\r\n      type: \"signal\",\r\n      group: \"General\",\r\n      index: 2,\r\n    },\r\n  },\r\n  methods: {\r\n    _focus() {\r\n      // @ts-expect-error\r\n      if (!this.innerReactComponentRef) return;\r\n      // @ts-expect-error\r\n      this.innerReactComponentRef.focus();\r\n    },\r\n    _blur() {\r\n      // @ts-expect-error\r\n      if (!this.innerReactComponentRef) return;\r\n      // @ts-expect-error\r\n      this.innerReactComponentRef.blur();\r\n    },\r\n    clear() {\r\n      // @ts-expect-error\r\n      this.props.startValue = \"\";\r\n      // @ts-expect-error\r\n      if (this.innerReactComponentRef) {\r\n        // @ts-expect-error\r\n        this.innerReactComponentRef.setText(\"\");\r\n      }\r\n    },\r\n    setText(text) {\r\n      // @ts-expect-error\r\n      this.props.startValue = text;\r\n      // @ts-expect-error\r\n      if (this.innerReactComponentRef) {\r\n        //the text component is currently mounted, and will signal the onTextChanged output\r\n        // @ts-expect-error\r\n        if (this.innerReactComponentRef.hasFocus() === false) {\r\n          // @ts-expect-error\r\n          this.innerReactComponentRef.setText(text);\r\n        }\r\n        // @ts-expect-error\r\n      } else if (this.outputPropValues[\"onTextChanged\"] !== text) {\r\n        //text component isn't mounted yet, set the output manually\r\n        // @ts-expect-error\r\n        this.outputPropValues[\"onTextChanged\"] = text;\r\n        // @ts-expect-error\r\n        this.flagOutputDirty(\"onTextChanged\");\r\n      }\r\n    },\r\n  },\r\n};\r\n\r\nNodeSharedPortDefinitions.addDimensions(TextInputNode, {\r\n  defaultSizeMode: \"contentSize\",\r\n  contentLabel: \"Text\",\r\n});\r\nNodeSharedPortDefinitions.addIconInputs(TextInputNode, {\r\n  enableIconPlacement: true,\r\n  defaults: { useIcon: false, iconColor: \"#000000\" },\r\n});\r\nNodeSharedPortDefinitions.addLabelInputs(TextInputNode, {\r\n  enableSpacing: true,\r\n  styleTag: \"label\",\r\n  displayName: \"Label\",\r\n});\r\n\r\nNodeSharedPortDefinitions.addTextStyleInputs(TextInputNode, {\r\n  styleTag: \"input\",\r\n  portPrefix: \"\",\r\n  portIndex: 18,\r\n  popout: {\r\n    group: \"input-text-style\",\r\n    label: \"Text Style\",\r\n    parentGroup: \"Text\",\r\n  },\r\n});\r\n\r\nNodeSharedPortDefinitions.addAlignInputs(TextInputNode);\r\nNodeSharedPortDefinitions.addTransformInputs(TextInputNode);\r\nNodeSharedPortDefinitions.addPaddingInputs(TextInputNode, {\r\n  styleTag: \"inputWrapper\",\r\n});\r\nNodeSharedPortDefinitions.addMarginInputs(TextInputNode);\r\nNodeSharedPortDefinitions.addSharedVisualInputs(TextInputNode);\r\nNodeSharedPortDefinitions.addBorderInputs(TextInputNode, {\r\n  styleTag: \"inputWrapper\",\r\n});\r\nNodeSharedPortDefinitions.addShadowInputs(TextInputNode, {\r\n  styleTag: \"inputWrapper\",\r\n});\r\nUtils.addControlEventsAndStates(TextInputNode);\r\n\r\nexport default createNodeFromReactComponent(TextInputNode);\r\n","export default class ASyncQueue {\r\n  private queue: Array<{\r\n    promise: () => Promise<any>;\r\n    resolve: (value: any) => void;\r\n    reject: (reason?: any) => void;\r\n  }> = [];\r\n  private workingOnPromise: boolean = false;\r\n\r\n  enqueue(promise: () => Promise<any>): Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      this.queue.push({\r\n        promise,\r\n        resolve,\r\n        reject,\r\n      });\r\n      this.dequeue();\r\n    });\r\n  }\r\n\r\n  private dequeue(): boolean {\r\n    if (this.workingOnPromise) {\r\n      return false;\r\n    }\r\n    const item = this.queue.shift();\r\n    if (!item) {\r\n      return false;\r\n    }\r\n    try {\r\n      this.workingOnPromise = true;\r\n      item\r\n        .promise()\r\n        .then((value) => {\r\n          this.workingOnPromise = false;\r\n          item.resolve(value);\r\n          this.dequeue();\r\n        })\r\n        .catch((err) => {\r\n          this.workingOnPromise = false;\r\n          item.reject(err);\r\n          this.dequeue();\r\n        });\r\n    } catch (err) {\r\n      this.workingOnPromise = false;\r\n      item.reject(err);\r\n      this.dequeue();\r\n    }\r\n    return true;\r\n  }\r\n}\r\n","import React, { useEffect } from \"react\";\r\nimport ASyncQueue from \"../../async-queue\";\r\nimport { createNodeFromReactComponent } from \"../../react-component-node\";\r\nimport NavigationHandler from \"./navigation-handler\";\r\nimport NoodlRuntime, { guid } from \"@fluxscape/runtime\";\r\nimport { Transitions } from \"./transitions\";\r\nimport { ReactNodeDefinition } from \"../../ReactNodeDefinition\";\r\n\r\ninterface PageStackProps {\r\n  didMount: () => void;\r\n  willUnmount: () => void;\r\n  style: React.CSSProperties;\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst PageStackReactComponent: React.FC<PageStackProps> = (props) => {\r\n  const { didMount, willUnmount, style, children } = props;\r\n\r\n  useEffect(() => {\r\n    didMount();\r\n    return () => {\r\n      willUnmount();\r\n    };\r\n  }, [didMount, willUnmount]);\r\n\r\n  return <div style={style}>{children}</div>;\r\n};\r\n\r\ninterface Internal {\r\n  stack: any[];\r\n  topPageName: string;\r\n  stackDepth: number;\r\n  pageInfo: Record<string, any>;\r\n  asyncQueue: ASyncQueue;\r\n  isMounted: boolean;\r\n  name: string;\r\n  useRoutes: boolean;\r\n  pages: any[];\r\n  hasScheduledReset: boolean;\r\n  startPageId: string;\r\n  startPage: string;\r\n  remainingNavigationPath: string[] | undefined;\r\n  isTransitioning: boolean;\r\n}\r\n\r\ntype Props = {\r\n  layout?: string;\r\n  didMount: () => void;\r\n  willUnmount: () => void;\r\n};\r\n\r\nconst PageStack: ReactNodeDefinition<Internal, Props> = {\r\n  name: \"Page Stack\",\r\n  displayNodeName: \"Component Stack\",\r\n  category: \"Visuals\",\r\n  docs: \"https://docs.noodl.net/nodes/component-stack/component-stack-node\",\r\n  useVariants: false,\r\n  initialize() {\r\n    this._internal.stack = [];\r\n    this._internal.topPageName = \"\";\r\n    this._internal.stackDepth = 0;\r\n    this._internal.pageInfo = {};\r\n    this._internal.asyncQueue = new ASyncQueue();\r\n\r\n    // @ts-expect-error\r\n    this.onScheduleReset = () => {\r\n      // @ts-expect-error\r\n      this.scheduleReset();\r\n    };\r\n\r\n    this.props.didMount = () => {\r\n      this._internal.isMounted = true;\r\n\r\n      // @ts-expect-error\r\n      if (window.history && window.history.pushState) {\r\n        // @ts-expect-error\r\n        window.addEventListener(\"popstate\", this.onScheduleReset);\r\n      } else {\r\n        // @ts-expect-error\r\n        window.addEventListener(\"hashchange\", this.onScheduleReset);\r\n      }\r\n\r\n      // @ts-expect-error\r\n      this._registerPageStack();\r\n    };\r\n\r\n    this.props.willUnmount = () => {\r\n      this._internal.isMounted = false;\r\n      // @ts-expect-error\r\n      window.removeEventListener(\"popstate\", this.onScheduleReset);\r\n      // @ts-expect-error\r\n      window.removeEventListener(\"hashchange\", this.onScheduleReset);\r\n      // @ts-expect-error\r\n      this._deregisterPageStack();\r\n    };\r\n  },\r\n  getInspectInfo() {\r\n    if (this._internal.stack.length === 0) {\r\n      return \"No active page\";\r\n    }\r\n\r\n    const info = [{ type: \"text\", value: \"Active Components:\" }];\r\n\r\n    return info.concat(\r\n      this._internal.stack.map((p) => {\r\n        // @ts-expect-error\r\n        const pageInfo = this._findPage(p.pageId);\r\n        return {\r\n          type: \"text\",\r\n          value: \"- \" + pageInfo.label,\r\n        };\r\n      })\r\n    );\r\n  },\r\n  defaultCss: {\r\n    width: \"100%\",\r\n    flex: \"1 1 100%\",\r\n    position: \"relative\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n  },\r\n  // @ts-expect-error\r\n  getReactComponent() {\r\n    return PageStackReactComponent;\r\n  },\r\n  inputs: {\r\n    name: {\r\n      type: { name: \"string\", identifierOf: \"PackStack\" },\r\n      displayName: \"Name\",\r\n      group: \"General\",\r\n      default: \"Main\",\r\n      set(value) {\r\n        // @ts-expect-error\r\n        this._deregisterPageStack();\r\n        this._internal.name = value;\r\n\r\n        if (this._internal.isMounted) {\r\n          // @ts-expect-error\r\n          this._registerPageStack();\r\n        }\r\n      },\r\n    },\r\n    useRoutes: {\r\n      type: \"boolean\",\r\n      displayName: \"Use Routes\",\r\n      group: \"General\",\r\n      default: false,\r\n      set(value) {\r\n        this._internal.useRoutes = !!value;\r\n      },\r\n    },\r\n    clip: {\r\n      displayName: \"Clip Content\",\r\n      type: \"boolean\",\r\n      group: \"Layout\",\r\n      default: true,\r\n      set(value) {\r\n        if (value) {\r\n          // @ts-expect-error\r\n          this.setStyle({ overflow: \"hidden\" });\r\n        } else {\r\n          // @ts-expect-error\r\n          this.removeStyle([\"overflow\"]);\r\n        }\r\n      },\r\n    },\r\n    pages: {\r\n      type: \"proplist\",\r\n      displayName: \"Components\",\r\n      group: \"Components\",\r\n      set(value) {\r\n        this._internal.pages = value;\r\n        if (this._internal.isMounted) {\r\n          // @ts-expect-error\r\n          this.scheduleReset();\r\n        }\r\n      },\r\n    },\r\n    reset: {\r\n      type: \"signal\",\r\n      displayName: \"Reset\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleReset();\r\n      },\r\n    },\r\n  },\r\n  inputCss: {\r\n    backgroundColor: {\r\n      type: \"color\",\r\n      displayName: \"Background Color\",\r\n      group: \"Style\",\r\n      default: \"transparent\",\r\n      applyDefault: false,\r\n    },\r\n  },\r\n  outputs: {\r\n    topPageName: {\r\n      type: \"string\",\r\n      displayName: \"Top Component Name\",\r\n      group: \"General\",\r\n      get() {\r\n        return this._internal.topPageName;\r\n      },\r\n    },\r\n    stackDepth: {\r\n      type: \"number\",\r\n      displayName: \"Stack Depth\",\r\n      group: \"General\",\r\n      get() {\r\n        return this._internal.stackDepth;\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    _registerPageStack() {\r\n      NavigationHandler.instance.registerPageStack(this._internal.name, this);\r\n    },\r\n    _deregisterPageStack() {\r\n      NavigationHandler.instance.deregisterPageStack(this._internal.name, this);\r\n    },\r\n    _findPage(pageIdOrLabel: string) {\r\n      if (this._internal.pageInfo[pageIdOrLabel]) {\r\n        const pageInfo = this._internal.pageInfo[pageIdOrLabel];\r\n        const pageRef = this._internal.pages.find(\r\n          (x) => x.id === pageIdOrLabel\r\n        );\r\n        return {\r\n          component: String(pageInfo.component),\r\n          label: String(pageRef.label),\r\n          id: String(pageIdOrLabel),\r\n        };\r\n      }\r\n\r\n      const pageRef = this._internal.pages.find(\r\n        (x) => x.label === pageIdOrLabel\r\n      );\r\n      if (pageRef) {\r\n        const pageInfo = this._internal.pageInfo[pageRef.id];\r\n        return {\r\n          component: String(pageInfo.component),\r\n          label: String(pageRef.label),\r\n          id: String(pageRef.id),\r\n        };\r\n      }\r\n\r\n      return undefined;\r\n    },\r\n    setPageOutputs(outputs: Record<string, any>) {\r\n      for (const prop in outputs) {\r\n        this._internal[prop] = outputs[prop];\r\n        this.flagOutputDirty(prop);\r\n      }\r\n    },\r\n    scheduleReset() {\r\n      const internal = this._internal;\r\n      if (!internal.hasScheduledReset) {\r\n        internal.hasScheduledReset = true;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          internal.hasScheduledReset = false;\r\n          // @ts-expect-error\r\n          this.reset();\r\n        });\r\n      }\r\n    },\r\n    createPageContainer() {\r\n      const group = this.nodeScope!.createPrimitiveNode(\"Group\");\r\n      group.setStyle({ flex: \"1 0 100%\" });\r\n      return group;\r\n    },\r\n    reset() {\r\n      // @ts-expect-error\r\n      this._internal.asyncQueue.enqueue(this.resetAsync.bind(this));\r\n    },\r\n    async resetAsync() {\r\n      // @ts-expect-error\r\n      const children = this.getChildren();\r\n      for (const c of children) {\r\n        // @ts-expect-error\r\n        this.removeChild(c);\r\n        // @ts-expect-error\r\n        this.nodeScope.deleteNode(c);\r\n      }\r\n\r\n      if (\r\n        this._internal.pages === undefined ||\r\n        this._internal.pages.length === 0\r\n      )\r\n        return;\r\n\r\n      let startPageId;\r\n      let params = {};\r\n\r\n      // @ts-expect-error\r\n      const pageFromUrl = this.matchPageFromUrl();\r\n      if (pageFromUrl !== undefined) {\r\n        startPageId = pageFromUrl.pageId;\r\n        params = { ...pageFromUrl.query, ...pageFromUrl.params };\r\n      } else {\r\n        startPageId = this._internal.startPageId;\r\n        if (startPageId === undefined) startPageId = this._internal.pages[0].id;\r\n      }\r\n\r\n      // @ts-expect-error\r\n      const pageInfo = this._findPage(startPageId);\r\n      if (pageInfo === undefined || pageInfo.component === undefined) {\r\n        return;\r\n      }\r\n\r\n      // @ts-expect-error\r\n      const content = await this.nodeScope.createNode(\r\n        pageInfo.component,\r\n        guid()\r\n      );\r\n\r\n      for (const key in params) {\r\n        content.setInputValue(key, params[key]);\r\n      }\r\n\r\n      // @ts-expect-error\r\n      const group = this.createPageContainer();\r\n      group.addChild(content);\r\n\r\n      // @ts-expect-error\r\n      this.addChild(group);\r\n      this._internal.stack = [\r\n        {\r\n          from: null,\r\n          page: group,\r\n          pageId: startPageId,\r\n          pageInfo: pageInfo,\r\n          params: params,\r\n          componentName: this._internal.startPage,\r\n        },\r\n      ];\r\n\r\n      // @ts-expect-error\r\n      this.setPageOutputs({\r\n        topPageName: pageInfo.label,\r\n        stackDepth: this._internal.stack.length,\r\n      });\r\n    },\r\n    getRelativeURL() {\r\n      const top = this._internal.stack[this._internal.stack.length - 1];\r\n      if (top === undefined) return;\r\n\r\n      let urlPath = top.pageInfo.path;\r\n      if (urlPath === undefined) {\r\n        const pageItem = this._internal.pages.find((p) => p.id == top.pageId);\r\n        if (pageItem === undefined) return;\r\n\r\n        urlPath = pageItem.label.replace(/\\s+/g, \"-\").toLowerCase();\r\n      }\r\n\r\n      const paramsInPath = urlPath.match(/{([^}]+)}/g);\r\n      const params = { ...top.params };\r\n      if (paramsInPath) {\r\n        for (const param of paramsInPath) {\r\n          const key = param.replace(/[{}]/g, \"\");\r\n          if (top.params[key] !== undefined) {\r\n            urlPath = urlPath.replace(param, encodeURIComponent(params[key]));\r\n            delete params[key];\r\n          }\r\n        }\r\n      }\r\n\r\n      const query = Object.keys(params).map((key) => ({\r\n        name: key,\r\n        value: params[key],\r\n      }));\r\n\r\n      if (urlPath.startsWith(\"/\")) urlPath = urlPath.substring(1);\r\n\r\n      return {\r\n        path: urlPath,\r\n        query: query,\r\n      };\r\n    },\r\n    getNavigationAbsoluteURL() {\r\n      // @ts-expect-error\r\n      let parent = this.parent;\r\n\r\n      while (\r\n        parent !== undefined &&\r\n        typeof parent.getNavigationAbsoluteURL !== \"function\"\r\n      ) {\r\n        parent = parent.getVisualParentNode();\r\n      }\r\n\r\n      const parentUrl =\r\n        parent === undefined\r\n          ? { path: \"\", query: [] }\r\n          : parent.getNavigationAbsoluteURL();\r\n      // @ts-expect-error\r\n      const thisUrl = this.getRelativeURL();\r\n      if (thisUrl === undefined) return parentUrl;\r\n\r\n      return {\r\n        path:\r\n          parentUrl.path +\r\n          (parentUrl.path.endsWith(\"/\") ? \"\" : \"/\") +\r\n          thisUrl.path,\r\n        query: parentUrl.query.concat(thisUrl.query),\r\n      };\r\n    },\r\n    _getLocationPath() {\r\n      const navigationPathType =\r\n        NoodlRuntime.instance.getProjectSettings()[\"navigationPathType\"];\r\n      if (navigationPathType === undefined || navigationPathType === \"hash\") {\r\n        let hash = location.hash;\r\n        if (hash) {\r\n          if (hash[0] === \"#\") hash = hash.substring(1);\r\n          if (hash[0] === \"/\") hash = hash.substring(1);\r\n        }\r\n        return hash;\r\n      } else {\r\n        let path = location.pathname;\r\n        if (path) {\r\n          if (path[0] === \"/\") path = path.substring(1);\r\n        }\r\n        return path;\r\n      }\r\n    },\r\n    _getSearchParams() {\r\n      const pl = /\\+/g;\r\n      const search = /([^&=]+)=?([^&]*)/g;\r\n      const decode = (s: string) => decodeURIComponent(s.replace(pl, \" \"));\r\n      const query = window.location.search.substring(1);\r\n\r\n      let match: RegExpExecArray | null;\r\n      const urlParams: Record<string, string> = {};\r\n      while ((match = search.exec(query))) {\r\n        urlParams[decode(match[1])] = decode(match[2]);\r\n      }\r\n\r\n      return urlParams;\r\n    },\r\n    getNavigationRemainingPath() {\r\n      return this._internal.remainingNavigationPath;\r\n    },\r\n    matchPageFromUrl(url?: string) {\r\n      if (!this._internal.useRoutes) return;\r\n      if (\r\n        this._internal.pages === undefined ||\r\n        this._internal.pages.length === 0\r\n      )\r\n        return;\r\n\r\n      // @ts-expect-error\r\n      let parent = this.parent;\r\n      while (\r\n        parent !== undefined &&\r\n        typeof parent.getNavigationRemainingPath !== \"function\"\r\n      ) {\r\n        parent = parent.getVisualParentNode();\r\n      }\r\n\r\n      const pathParts =\r\n        parent === undefined\r\n          ? // @ts-expect-error\r\n            this._getLocationPath().split(\"/\").filter(Boolean)\r\n          : parent.getNavigationRemainingPath();\r\n      if (pathParts === undefined) return;\r\n\r\n      // @ts-expect-error\r\n      const urlQuery = this._getSearchParams();\r\n\r\n      const _matchPathParts = (path: string[], pattern: string[]) => {\r\n        const params: Record<string, string> = {};\r\n        for (let i = 0; i < pattern.length; i++) {\r\n          if (path[i] === undefined) return;\r\n\r\n          const _p = pattern[i];\r\n          if (_p[0] === \"{\" && _p[_p.length - 1] === \"}\") {\r\n            params[_p.substring(1, _p.length - 1)] = decodeURIComponent(\r\n              path[i]\r\n            );\r\n          } else if (_p !== path[i]) return;\r\n        }\r\n        return {\r\n          params: params,\r\n          remainingPathParts: path.splice(pattern.length),\r\n        };\r\n      };\r\n\r\n      for (const page of this._internal.pages) {\r\n        const pageInfo = this._internal.pageInfo[page.id];\r\n        if (pageInfo === undefined) continue;\r\n\r\n        let pagePattern = pageInfo.path;\r\n        if (pagePattern === undefined) {\r\n          pagePattern = page.label.replace(/\\s+/g, \"-\").toLowerCase();\r\n        }\r\n        if (pagePattern[0] === \"/\") pagePattern = pagePattern.substring(1);\r\n\r\n        const match = _matchPathParts(pathParts, pagePattern.split(\"/\"));\r\n        if (match) {\r\n          this._internal.remainingNavigationPath = match.remainingPathParts;\r\n          return {\r\n            pageId: page.id,\r\n            params: match.params,\r\n            query: urlQuery,\r\n          };\r\n        }\r\n      }\r\n    },\r\n    _updateUrlWithTopPage() {\r\n      if (this._internal.useRoutes && window.history !== undefined) {\r\n        // @ts-expect-error\r\n        const url = this.getNavigationAbsoluteURL();\r\n\r\n        let urlPath, hashPath;\r\n        const navigationPathType =\r\n          NoodlRuntime.instance.getProjectSettings()[\"navigationPathType\"];\r\n        if (navigationPathType === undefined || navigationPathType === \"hash\") {\r\n          hashPath = url.path;\r\n        } else {\r\n          urlPath = url.path;\r\n        }\r\n\r\n        const query = url.query.map((q) => `${q.name}=${q.value}`);\r\n        const compiledUrl =\r\n          (urlPath !== undefined ? urlPath : \"\") +\r\n          (query.length >= 1 ? \"?\" + query.join(\"&\") : \"\") +\r\n          (hashPath !== undefined ? \"#\" + hashPath : \"\");\r\n\r\n        this._internal.remainingNavigationPath = undefined;\r\n        window.history.pushState({}, \"\", compiledUrl);\r\n      }\r\n    },\r\n    replace(args: any) {\r\n      // @ts-expect-error\r\n      this._internal.asyncQueue.enqueue(this.replaceAsync.bind(this, args));\r\n    },\r\n    async replaceAsync(args: any) {\r\n      if (\r\n        this._internal.pages === undefined ||\r\n        this._internal.pages.length === 0\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      if (this._internal.isTransitioning) {\r\n        return;\r\n      }\r\n\r\n      const pageId = args.target || this._internal.pages[0].id;\r\n\r\n      // @ts-expect-error\r\n      const pageInfo = this._findPage(pageId);\r\n      if (pageInfo === undefined || pageInfo.component === undefined) {\r\n        return;\r\n      }\r\n\r\n      // @ts-expect-error\r\n      const children = this.getChildren();\r\n      for (const c of children) {\r\n        // @ts-expect-error\r\n        this.removeChild(c);\r\n        // @ts-expect-error\r\n        this.nodeScope.deleteNode(c);\r\n      }\r\n\r\n      // @ts-expect-error\r\n      const group = this.createPageContainer();\r\n      // @ts-expect-error\r\n      const content = await this.nodeScope.createNode(\r\n        pageInfo.component,\r\n        guid()\r\n      );\r\n      for (const key in args.params) {\r\n        content.setInputValue(key, args.params[key]);\r\n      }\r\n      group.addChild(content);\r\n      // @ts-expect-error\r\n      this.addChild(group);\r\n\r\n      this._internal.stack = [\r\n        {\r\n          from: null,\r\n          page: group,\r\n          pageId: pageId,\r\n          pageInfo: pageInfo,\r\n          params: args.params,\r\n          componentName: args.target,\r\n        },\r\n      ];\r\n\r\n      // @ts-expect-error\r\n      this.setPageOutputs({\r\n        topPageName: pageInfo.label,\r\n        stackDepth: this._internal.stack.length,\r\n      });\r\n\r\n      // @ts-expect-error\r\n      this._updateUrlWithTopPage();\r\n      args.hasNavigated && args.hasNavigated();\r\n    },\r\n    navigate(args: any) {\r\n      // @ts-expect-error\r\n      this._internal.asyncQueue.enqueue(this.navigateAsync.bind(this, args));\r\n    },\r\n    async navigateAsync(args: any) {\r\n      if (\r\n        this._internal.pages === undefined ||\r\n        this._internal.pages.length === 0\r\n      ) {\r\n        return;\r\n      }\r\n\r\n      if (this._internal.isTransitioning) {\r\n        return;\r\n      }\r\n\r\n      const pageId = args.target || this._internal.pages[0].id;\r\n\r\n      // @ts-expect-error\r\n      const pageInfo = this._findPage(pageId);\r\n      if (pageInfo === undefined || pageInfo.component === undefined) {\r\n        return;\r\n      }\r\n\r\n      // @ts-expect-error\r\n      const group = this.createPageContainer();\r\n      group.setInputValue(\"position\", \"absolute\");\r\n\r\n      // @ts-expect-error\r\n      const content = await this.nodeScope.createNode(\r\n        pageInfo.component,\r\n        guid()\r\n      );\r\n      for (const key in args.params) {\r\n        content.setInputValue(key, args.params[key]);\r\n      }\r\n      group.addChild(content);\r\n\r\n      const navigateBackNodes = content.nodeScope.getNodesWithType(\r\n        \"PageStackNavigateBack\"\r\n      );\r\n      if (navigateBackNodes && navigateBackNodes.length > 0) {\r\n        for (const node of navigateBackNodes) {\r\n          // @ts-expect-error\r\n          node._setBackCallback(this.back.bind(this));\r\n        }\r\n      }\r\n\r\n      const top = this._internal.stack[this._internal.stack.length - 1];\r\n      const newTop = {\r\n        from: top.page,\r\n        page: group,\r\n        pageInfo: pageInfo,\r\n        pageId: pageId,\r\n        params: args.params,\r\n        transition: new Transitions[args.transition.type || \"Push\"](\r\n          top.page,\r\n          group,\r\n          args.transition\r\n        ),\r\n        backCallback: args.backCallback,\r\n        componentName: args.target,\r\n      };\r\n      this._internal.stack.push(newTop);\r\n      // @ts-expect-error\r\n      this.setPageOutputs({\r\n        topPageName: pageInfo.label,\r\n        stackDepth: this._internal.stack.length,\r\n      });\r\n      // @ts-expect-error\r\n      this._updateUrlWithTopPage();\r\n\r\n      newTop.transition.forward(0);\r\n      this._internal.isTransitioning = true;\r\n      newTop.transition.start({\r\n        end: () => {\r\n          this._internal.isTransitioning = false;\r\n          // @ts-expect-error\r\n          this.removeChild(top.page);\r\n          group.setInputValue(\"position\", \"relative\");\r\n        },\r\n      });\r\n\r\n      // @ts-expect-error\r\n      this.addChild(group);\r\n      args.hasNavigated && args.hasNavigated();\r\n    },\r\n    back(args: any) {\r\n      if (this._internal.stack.length <= 1) return;\r\n      if (this._internal.isTransitioning) return;\r\n\r\n      const top = this._internal.stack[this._internal.stack.length - 1];\r\n      top.page.setInputValue(\"position\", \"absolute\");\r\n      // @ts-expect-error\r\n      this.addChild(top.from, 0);\r\n      top.backCallback && top.backCallback(args.backAction, args.results);\r\n\r\n      // @ts-expect-error\r\n      const pageInfo = this._findPage(\r\n        this._internal.stack[this._internal.stack.length - 2].pageId\r\n      );\r\n      // @ts-expect-error\r\n      this.setPageOutputs({\r\n        topPageName: pageInfo.label,\r\n        stackDepth: this._internal.stack.length - 1,\r\n      });\r\n\r\n      this._internal.isTransitioning = true;\r\n      top.transition.start({\r\n        end: () => {\r\n          this._internal.isTransitioning = false;\r\n          top.page.setInputValue(\"position\", \"relative\");\r\n          // @ts-expect-error\r\n          this.removeChild(top.page);\r\n          // @ts-expect-error\r\n          this.nodeScope.deleteNode(top.page);\r\n          this._internal.stack.pop();\r\n          // @ts-expect-error\r\n          this._updateUrlWithTopPage();\r\n        },\r\n        back: true,\r\n      });\r\n    },\r\n    setPageComponent(pageId: string, component: any) {\r\n      const internal = this._internal;\r\n      if (!internal.pageInfo[pageId]) internal.pageInfo[pageId] = {};\r\n      internal.pageInfo[pageId].component = component;\r\n    },\r\n    setPagePath(pageId: string, path: string) {\r\n      const internal = this._internal;\r\n      if (!internal.pageInfo[pageId]) internal.pageInfo[pageId] = {};\r\n      internal.pageInfo[pageId].path = path;\r\n    },\r\n    setStartPage(pageId: string) {\r\n      this._internal.startPageId = pageId;\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name.startsWith(\"pageComp-\"))\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setPageComponent.bind(\r\n            this,\r\n            name.substring(\"pageComp-\".length)\r\n          ),\r\n        });\r\n\r\n      if (name.startsWith(\"pagePath-\"))\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setPagePath.bind(this, name.substring(\"pagePath-\".length)),\r\n        });\r\n\r\n      if (name === \"startPage\")\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setStartPage.bind(this),\r\n        });\r\n    },\r\n  },\r\n  setup(context: any, graphModel: any) {\r\n    if (\r\n      !context.editorConnection ||\r\n      !context.editorConnection.isRunningLocally()\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    function _managePortsForNode(node: any) {\r\n      function _updatePorts() {\r\n        const ports: any[] = [];\r\n\r\n        if (\r\n          node.parameters[\"pages\"] !== undefined &&\r\n          node.parameters[\"pages\"].length > 0\r\n        ) {\r\n          node.parameters[\"pages\"].forEach((p: any) => {\r\n            ports.push({\r\n              name: \"pageComp-\" + p.id,\r\n              displayName: \"Component\",\r\n              editorName: p.label + \" | Component\",\r\n              plug: \"input\",\r\n              type: \"component\",\r\n              parent: \"pages\",\r\n              parentItemId: p.id,\r\n            });\r\n\r\n            if (node.parameters[\"useRoutes\"] === true) {\r\n              ports.push({\r\n                name: \"pagePath-\" + p.id,\r\n                displayName: \"Path\",\r\n                editorName: p.label + \" | Path\",\r\n                plug: \"input\",\r\n                type: \"string\",\r\n                default: p.label.replace(/\\s+/g, \"-\").toLowerCase(),\r\n                parent: \"pages\",\r\n                parentItemId: p.id,\r\n              });\r\n            }\r\n          });\r\n\r\n          ports.push({\r\n            plug: \"input\",\r\n            type: {\r\n              name: \"enum\",\r\n              enums: node.parameters[\"pages\"].map((p: any) => ({\r\n                label: p.label,\r\n                value: p.id,\r\n              })),\r\n              allowEditOnly: true,\r\n            },\r\n            group: \"General\",\r\n            displayName: \"Start Page\",\r\n            name: \"startPage\",\r\n            default: node.parameters[\"pages\"][0].id,\r\n          });\r\n        }\r\n\r\n        context.editorConnection.sendDynamicPorts(node.id, ports);\r\n      }\r\n\r\n      _updatePorts();\r\n      node.on(\"parameterUpdated\", function (ev: any) {\r\n        if (ev.name === \"pages\" || ev.name === \"useRoutes\") _updatePorts();\r\n      });\r\n    }\r\n\r\n    graphModel.on(\"editorImportComplete\", () => {\r\n      graphModel.on(\"nodeAdded.Page Stack\", function (node: any) {\r\n        _managePortsForNode(node);\r\n      });\r\n\r\n      for (const node of graphModel.getNodesWithType(\"Page Stack\")) {\r\n        _managePortsForNode(node);\r\n      }\r\n    });\r\n  },\r\n};\r\n\r\nexport default createNodeFromReactComponent(PageStack);\r\n","import React from \"react\";\r\n\r\nimport type { TSFixme } from \"../../../../typings/global\";\r\nimport Layout from \"../../../layout\";\r\nimport { Noodl, Slot } from \"../../../types\";\r\n\r\ntype MetaTag = {\r\n  isProperty: boolean;\r\n  key: string;\r\n  displayName: string;\r\n  editorName?: string;\r\n  group: string;\r\n  type?: string;\r\n  popout?: TSFixme;\r\n};\r\n\r\nconst ogPopout = {\r\n  group: \"seo-og\",\r\n  label: \"Open Graph\",\r\n  parentGroup: \"Experimental SEO\",\r\n};\r\n\r\nconst twitterPopout = {\r\n  group: \"seo-twitter\",\r\n  label: \"Twitter\",\r\n  parentGroup: \"Experimental SEO\",\r\n};\r\n\r\nexport const META_TAGS: MetaTag[] = [\r\n  {\r\n    isProperty: true,\r\n    key: \"description\",\r\n    displayName: \"Description\",\r\n    group: \"Experimental SEO\",\r\n  },\r\n  {\r\n    isProperty: true,\r\n    key: \"robots\",\r\n    displayName: \"Robots\",\r\n    group: \"Experimental SEO\",\r\n  },\r\n  {\r\n    isProperty: true,\r\n    key: \"og:title\",\r\n    displayName: \"Title\",\r\n    editorName: \"OG Title\",\r\n    group: \"General\",\r\n    popout: ogPopout,\r\n  },\r\n  {\r\n    isProperty: true,\r\n    key: \"og:description\",\r\n    displayName: \"Description\",\r\n    editorName: \"OG Description\",\r\n    group: \"General\",\r\n    popout: ogPopout,\r\n  },\r\n  {\r\n    isProperty: true,\r\n    key: \"og:url\",\r\n    displayName: \"Url\",\r\n    editorName: \"OG Url\",\r\n    group: \"General\",\r\n    popout: ogPopout,\r\n  },\r\n  {\r\n    isProperty: true,\r\n    key: \"og:type\",\r\n    displayName: \"Type\",\r\n    editorName: \"OG Type\",\r\n    group: \"General\",\r\n    popout: ogPopout,\r\n  },\r\n  {\r\n    isProperty: true,\r\n    key: \"og:image\",\r\n    displayName: \"Image\",\r\n    editorName: \"OG Image\",\r\n    group: \"Image\",\r\n    popout: ogPopout,\r\n  },\r\n  {\r\n    isProperty: true,\r\n    key: \"og:image:width\",\r\n    displayName: \"Image Width\",\r\n    editorName: \"OG Image Width\",\r\n    group: \"Image\",\r\n    popout: ogPopout,\r\n  },\r\n  {\r\n    isProperty: true,\r\n    key: \"og:image:height\",\r\n    displayName: \"Image Height\",\r\n    editorName: \"OG Image Height\",\r\n    group: \"Image\",\r\n    popout: ogPopout,\r\n  },\r\n  {\r\n    isProperty: false,\r\n    key: \"twitter:card\",\r\n    displayName: \"Card\",\r\n    editorName: \"Twitter Card\",\r\n    group: \"General\",\r\n    popout: twitterPopout,\r\n  },\r\n  {\r\n    isProperty: false,\r\n    key: \"twitter:title\",\r\n    displayName: \"Title\",\r\n    editorName: \"Twitter Title\",\r\n    group: \"General\",\r\n    popout: twitterPopout,\r\n  },\r\n  {\r\n    isProperty: false,\r\n    key: \"twitter:description\",\r\n    displayName: \"Description\",\r\n    editorName: \"Twitter Description\",\r\n    group: \"General\",\r\n    popout: twitterPopout,\r\n  },\r\n  {\r\n    isProperty: false,\r\n    key: \"twitter:image\",\r\n    displayName: \"Image\",\r\n    editorName: \"Twitter Image\",\r\n    group: \"General\",\r\n    popout: twitterPopout,\r\n  },\r\n];\r\n\r\ntype MetaTagKey = typeof META_TAGS[number][\"key\"];\r\n\r\nexport interface PageProps extends Noodl.ReactProps {\r\n  metatags?: Record<MetaTagKey, string>;\r\n\r\n  children: Slot;\r\n}\r\n\r\nexport function Page(props: PageProps) {\r\n  const { style, children } = props;\r\n\r\n  Layout.size(style, props);\r\n  Layout.align(style, props);\r\n\r\n  // Allow changing the metatags from inputs\r\n  META_TAGS.forEach((item) => {\r\n    const value = props.metatags && props.metatags[item.key];\r\n    // @ts-expect-error Noodl is globally defined.\r\n    Noodl.SEO.setMeta(item.key, value);\r\n  });\r\n\r\n  return (\r\n    <div style={style} className={props.className}>\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n","import { META_TAGS, Page } from \"../../components/navigation/Page\";\r\nimport NodeSharedPortDefinitions from \"../../node-shared-port-definitions\";\r\nimport { createNodeFromReactComponent } from \"../../react-component-node\";\r\nimport { ReactNodeDefinition } from \"../../ReactNodeDefinition\";\r\n\r\ninterface Internal {\r\n  urlPath?: string;\r\n  title?: string;\r\n}\r\n\r\ntype Props = {\r\n  layout?: string;\r\n};\r\n\r\nexport const node: ReactNodeDefinition<Internal, Props> = {\r\n  name: \"Page\",\r\n  displayNodeName: \"Page\",\r\n  category: \"Visuals\",\r\n  docs: \"https://docs.noodl.net/nodes/navigation/page\",\r\n  useVariants: false,\r\n  mountedInput: false,\r\n  allowAsExportRoot: false,\r\n  singleton: true,\r\n  connectionPanel: {\r\n    groupPriority: [\"General\", \"Mounted\"],\r\n  },\r\n  initialize() {\r\n    this.props.layout = \"column\"; // this allows the children to know what type of layout type they're in\r\n    if (this.isInputConnected(\"onPageReady\")) {\r\n      // @ts-expect-error\r\n      this.nodeScope.context.eventEmitter.emit(\"SSR_PageLoading\", this.id);\r\n    }\r\n  },\r\n  defaultCss: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    position: \"relative\",\r\n    alignItems: \"flex-start\",\r\n    flex: \"1 1\",\r\n    alignSelf: \"stretch\",\r\n  },\r\n  // @ts-expect-error\r\n  getReactComponent() {\r\n    return Page;\r\n  },\r\n  inputs: {\r\n    sitemapIncluded: {\r\n      index: 80001,\r\n      displayName: \"Included\",\r\n      group: \"Experimental Sitemap\",\r\n      default: true,\r\n      type: {\r\n        name: \"boolean\",\r\n        allowEditOnly: true,\r\n      },\r\n    },\r\n    sitemapChangefreq: {\r\n      index: 80002,\r\n      displayName: \"Change Freq\",\r\n      group: \"Experimental Sitemap\",\r\n      default: \"weekly\",\r\n      type: {\r\n        name: \"enum\",\r\n        allowEditOnly: true,\r\n        enums: [\r\n          { label: \"always\", value: \"always\" },\r\n          { label: \"hourly\", value: \"hourly\" },\r\n          { label: \"daily\", value: \"daily\" },\r\n          { label: \"weekly\", value: \"weekly\" },\r\n          { label: \"monthly\", value: \"monthly\" },\r\n          { label: \"yearly\", value: \"yearly\" },\r\n          { label: \"never\", value: \"never\" },\r\n        ],\r\n      },\r\n    },\r\n    sitemapPriority: {\r\n      index: 80003,\r\n      displayName: \"Priority\",\r\n      group: \"Experimental Sitemap\",\r\n      default: 0.5,\r\n      type: {\r\n        name: \"number\",\r\n        allowEditOnly: true,\r\n      },\r\n    },\r\n  },\r\n  inputProps: META_TAGS.reduce((result, x, index) => {\r\n    result[x.key] = {\r\n      index: 80000 + index,\r\n      displayName: x.displayName,\r\n      editorName: x.editorName || x.displayName,\r\n      propPath: \"metatags\",\r\n      group: x.group,\r\n      popout: x.popout,\r\n      type: x.type || \"string\",\r\n    };\r\n    return result;\r\n  }, {}),\r\n  methods: {\r\n    getUrlPath() {\r\n      return this._internal.urlPath;\r\n    },\r\n    getTitle() {\r\n      return this._internal.title;\r\n    },\r\n    setTitle(value: string) {\r\n      this._internal.title = value;\r\n    },\r\n    setUrlPath(value: string) {\r\n      this._internal.urlPath = value;\r\n    },\r\n    registerInputIfNeeded(name: string) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n\r\n      if (name === \"title\") {\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setTitle.bind(this),\r\n        });\r\n      }\r\n\r\n      if (name === \"urlPath\") {\r\n        return this.registerInput(name, {\r\n          // @ts-expect-error\r\n          set: this.setUrlPath.bind(this),\r\n        });\r\n      }\r\n    },\r\n  },\r\n  setup(context, graphModel) {\r\n    if (\r\n      !context.editorConnection ||\r\n      !context.editorConnection.isRunningLocally()\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    function _managePortsForNode(node) {\r\n      function _updatePorts() {\r\n        const ports = [];\r\n\r\n        // Title and urlpath ports\r\n        const titleParts = node.component.name.split(\"/\");\r\n        // @ts-expect-error\r\n        ports.push({\r\n          name: \"title\",\r\n          displayName: \"Title\",\r\n          type: \"string\",\r\n          group: \"General\",\r\n          plug: \"input\",\r\n          default: titleParts[titleParts.length - 1],\r\n        });\r\n\r\n        const title =\r\n          node.parameters[\"title\"] || titleParts[titleParts.length - 1];\r\n        const defaultUrlPath = title.replace(/\\s+/g, \"-\").toLowerCase();\r\n        // @ts-expect-error\r\n        ports.push({\r\n          name: \"urlPath\",\r\n          displayName: \"Url Path\",\r\n          type: \"string\",\r\n          group: \"General\",\r\n          plug: \"input\",\r\n          default: defaultUrlPath,\r\n        });\r\n\r\n        context.editorConnection.sendDynamicPorts(node.id, ports);\r\n      }\r\n\r\n      _updatePorts();\r\n      node.on(\"parameterUpdated\", function (ev) {\r\n        if (ev.name === \"title\") _updatePorts();\r\n      });\r\n    }\r\n\r\n    graphModel.on(\"editorImportComplete\", () => {\r\n      graphModel.on(\"nodeAdded.Page\", function (node) {\r\n        _managePortsForNode(node);\r\n      });\r\n\r\n      graphModel.on(\"componentRenamed\", function (component) {\r\n        const page = graphModel\r\n          .getNodesWithType(\"Page\")\r\n          .filter((x) => component.roots.includes(x.id));\r\n        if (page.length > 0) {\r\n          _managePortsForNode(page[0]);\r\n        }\r\n      });\r\n\r\n      for (const node of graphModel.getNodesWithType(\"Page\")) {\r\n        _managePortsForNode(node);\r\n      }\r\n    });\r\n  },\r\n};\r\n\r\nNodeSharedPortDefinitions.addPaddingInputs(node);\r\n\r\nexport default createNodeFromReactComponent(node);\r\n","import React, { useEffect } from \"react\";\r\n\r\nimport { createNodeFromReactComponent } from \"../../react-component-node\";\r\nimport { Noodl, Slot } from \"../../types\";\r\nimport {\r\n  ComponentPageInfo,\r\n  NavigateArgs,\r\n  RouterHandler,\r\n} from \"./router-handler\";\r\nimport ASyncQueue from \"../../async-queue\";\r\nimport { ReactNodeDefinition } from \"../../ReactNodeDefinition\";\r\nimport NoodlRuntime, { guid } from \"@fluxscape/runtime\";\r\n\r\nexport interface RouterReactComponentProps extends Noodl.ReactProps {\r\n  didMount: () => void;\r\n  willUnmount: () => void;\r\n\r\n  layout?: string; // TODO: What is layout here?\r\n\r\n  children: Slot;\r\n}\r\n\r\nfunction RouterReactComponent(props: RouterReactComponentProps) {\r\n  const { didMount, willUnmount, children, style } = props;\r\n\r\n  useEffect(() => {\r\n    didMount();\r\n    return () => {\r\n      willUnmount();\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className={props.className} style={style}>\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction _trimUrlPart(url) {\r\n  if (url[0] === \"/\") url = url.substring(1);\r\n  if (url[url.length - 1] === \"/\") url = url.substring(0, url.length - 1);\r\n  return url;\r\n}\r\n\r\nfunction getBaseUrlLength(url: string): number {\r\n  // If the URL is a full URL, then we only want to get the pathname.\r\n  // Otherwise we just return the url length which should be the pathname.\r\n  if (!url.startsWith(\"/\")) {\r\n    try {\r\n      // Lets say the baseUrl is:\r\n      // \"https://collar-zippy-overcome.sandbox.noodl.app/my-folder\"\r\n      // Then we want to remove \"/my-folder\" from the substring\r\n      return new URL(url).pathname.length;\r\n    } catch {\r\n      /* noop */\r\n    }\r\n  }\r\n\r\n  return url.length;\r\n}\r\n\r\ninterface Internal {\r\n  asyncQueue: ASyncQueue;\r\n  isMounted: boolean;\r\n  hasScheduledReset: boolean;\r\n  currentUrl: string;\r\n  currentPage: ComponentPageInfo;\r\n  currentPageComponent: Node;\r\n  currentParams: NavigateArgs[\"params\"];\r\n  remainingNavigationPath: string[];\r\n  urlPath: string;\r\n  name: string;\r\n}\r\n\r\nconst RouterNode: ReactNodeDefinition<Internal, RouterReactComponentProps> = {\r\n  name: \"Router\",\r\n  displayNodeName: \"Page Router\",\r\n  category: \"Visuals\",\r\n  docs: \"https://docs.noodl.net/nodes/navigation/page-router\",\r\n  useVariants: false,\r\n  connectionPanel: {\r\n    groupPriority: [\"General\", \"Actions\", \"Events\", \"Mounted\"],\r\n  },\r\n  initialize() {\r\n    this._internal.asyncQueue = new ASyncQueue();\r\n\r\n    // @ts-expect-error\r\n    this.onScheduleReset = () => {\r\n      // @ts-expect-error\r\n      this.scheduleReset();\r\n    };\r\n\r\n    this.props.didMount = () => {\r\n      this._internal.isMounted = true;\r\n\r\n      // SSR Support\r\n      if (typeof window !== \"undefined\") {\r\n        // Listen to push state events and update stack\r\n        // @ts-expect-error\r\n        if (window.history && window.history.pushState) {\r\n          //this is event is manually sent on push, so covers both pop and push state\r\n          // @ts-expect-error\r\n          window.addEventListener(\"popstate\", this.onScheduleReset);\r\n        } else {\r\n          // Only hash support\r\n          // @ts-expect-error\r\n          window.addEventListener(\"hashchange\", this.onScheduleReset);\r\n        }\r\n      }\r\n\r\n      // @ts-expect-error\r\n      this._registerRouter();\r\n    };\r\n\r\n    this.props.willUnmount = () => {\r\n      this._internal.isMounted = false;\r\n\r\n      // @ts-expect-error\r\n      window.removeEventListener(\"popstate\", this.onScheduleReset);\r\n      // @ts-expect-error\r\n      window.removeEventListener(\"hashchange\", this.onScheduleReset);\r\n\r\n      // @ts-expect-error\r\n      this._deregisterRouter();\r\n    };\r\n\r\n    this.props.layout = \"column\";\r\n  },\r\n  getInspectInfo() {\r\n    return this._internal.currentUrl;\r\n  },\r\n  defaultCss: {\r\n    flex: \"1 1\",\r\n    alignSelf: \"stretch\",\r\n    position: \"relative\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n  },\r\n  getReactComponent() {\r\n    return RouterReactComponent;\r\n  },\r\n  inputs: {\r\n    name: {\r\n      type: \"string\",\r\n      displayName: \"Name\",\r\n      group: \"General\",\r\n      set(value) {\r\n        // @ts-expect-error\r\n        this._deregisterRouter();\r\n        this._internal.name = value;\r\n\r\n        if (this._internal.isMounted) {\r\n          // @ts-expect-error\r\n          this._registerRouter();\r\n        }\r\n      },\r\n    },\r\n    pages: {\r\n      type: { name: \"pages\", allowEditOnly: true },\r\n      displayName: \"Pages\",\r\n      group: \"Pages\",\r\n      set(value) {\r\n        // @ts-expect-error\r\n        this._internal.pages = value;\r\n        if (this._internal.isMounted) {\r\n          // @ts-expect-error\r\n          this.scheduleReset();\r\n        }\r\n      },\r\n    },\r\n    urlPath: {\r\n      type: \"string\",\r\n      displayName: \"Url path\",\r\n      group: \"General\",\r\n      set(value) {\r\n        this._internal.urlPath = value;\r\n      },\r\n    },\r\n    clip: {\r\n      displayName: \"Clip Behavior\",\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { value: \"contentHeight\", label: \"Expand to content size\" },\r\n          { value: \"scroll\", label: \"Scroll\" },\r\n          { value: \"clip\", label: \"Clip content\" },\r\n        ],\r\n      },\r\n      group: \"Layout\",\r\n      default: \"contentHeight\",\r\n      set(value) {\r\n        switch (value) {\r\n          case \"scroll\":\r\n            // @ts-expect-error\r\n            this.setStyle({ overflow: \"auto\" });\r\n            break;\r\n          case \"clip\":\r\n            // @ts-expect-error\r\n            this.setStyle({ overflow: \"hidden\" });\r\n            break;\r\n          default:\r\n            // @ts-expect-error\r\n            this.removeStyle([\"overflow\"]);\r\n            break;\r\n        }\r\n      },\r\n    },\r\n    reset: {\r\n      type: \"signal\",\r\n      displayName: \"Reset\",\r\n      group: \"Actions\",\r\n      valueChangedToTrue() {\r\n        // @ts-expect-error\r\n        this.scheduleReset();\r\n      },\r\n    },\r\n  },\r\n  inputCss: {\r\n    backgroundColor: {\r\n      type: \"color\",\r\n      displayName: \"Background Color\",\r\n      group: \"Style\",\r\n      default: \"transparent\",\r\n      applyDefault: false,\r\n    },\r\n  },\r\n  outputs: {\r\n    currentPageTitle: {\r\n      type: \"string\",\r\n      group: \"General\",\r\n      displayName: \"Current Page Title\",\r\n      getter() {\r\n        return this._internal.currentPage !== undefined\r\n          ? this._internal.currentPage.title\r\n          : undefined;\r\n      },\r\n    },\r\n    currentPageComponent: {\r\n      type: \"string\",\r\n      group: \"General\",\r\n      displayName: \"Current Page Component\",\r\n      getter() {\r\n        return this._internal.currentPage !== undefined\r\n          ? this._internal.currentPage.component\r\n          : undefined;\r\n      },\r\n    },\r\n  },\r\n  methods: {\r\n    _registerRouter() {\r\n      RouterHandler.instance.registerRouter(this._internal.name, this);\r\n    },\r\n    _deregisterRouter() {\r\n      RouterHandler.instance.deregisterRouter(this._internal.name, this);\r\n    },\r\n    setPageOutputs(outputs) {\r\n      for (const prop in outputs) {\r\n        this._internal[prop] = outputs[prop];\r\n        this.flagOutputDirty(prop);\r\n      }\r\n    },\r\n    scheduleReset() {\r\n      const internal = this._internal;\r\n      if (!internal.hasScheduledReset) {\r\n        internal.hasScheduledReset = true;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          internal.hasScheduledReset = false;\r\n          // @ts-expect-error\r\n          this.reset();\r\n        });\r\n      }\r\n    },\r\n    createPageContainer() {\r\n      const group = this.nodeScope!.createPrimitiveNode(\"Group\");\r\n      group.setStyle({ flex: \"1 0 100%\" });\r\n      return group;\r\n    },\r\n    reset() {\r\n      // @ts-expect-error\r\n      this._internal.asyncQueue.enqueue(this.resetAsync.bind(this));\r\n    },\r\n    scrollToTop() {\r\n      // @ts-expect-error\r\n      const dom = this.getDOMElement();\r\n      if (dom) {\r\n        dom.scrollTop = 0;\r\n\r\n        if (NoodlRuntime.instance.getProjectSettings().bodyScroll) {\r\n          //Automatically scroll the page router into view in case it's currently outside the viewport\r\n          //Might want to add an option to disable this\r\n          dom.scrollIntoView();\r\n        }\r\n      }\r\n    },\r\n    async resetAsync() {\r\n      let component: string;\r\n      let params = {};\r\n\r\n      // @ts-expect-error\r\n      const matchFromUrl = this.matchPageFromUrl();\r\n      if (matchFromUrl) {\r\n        if (!matchFromUrl.page) {\r\n          // Use the start page\r\n          component =\r\n            // @ts-expect-error\r\n            this._internal.pages !== undefined\r\n              ? // @ts-expect-error\r\n                this._internal.pages.startPage\r\n              : undefined;\r\n          params = Object.assign({}, matchFromUrl.params, matchFromUrl.query);\r\n        } else {\r\n          // Use the matching page\r\n          component = matchFromUrl.page.component;\r\n          params = Object.assign({}, matchFromUrl.params, matchFromUrl.query);\r\n        }\r\n      } else {\r\n        // TODO: Clean up matchPageFromUrl, in this case it returns undefined.\r\n        //       remainingNavigationPath is undefined, since it have to run\r\n        //       matchPageFromUrl to get the path. So it feels like it needs\r\n        //       some bigger refactoring to make it understandable.\r\n        // @ts-expect-error\r\n        component = this._internal.pages.startPage;\r\n        params = {};\r\n      }\r\n\r\n      if (component === undefined) return; // No component specified for page\r\n\r\n      const currentPage =\r\n        RouterHandler.instance.getPageInfoForComponent(component);\r\n\r\n      if (this._internal.currentPage === currentPage) {\r\n        //already at the correct page, keep the current page\r\n        //update page inputs if they have changed\r\n        //TODO: fix if a parameter goes from a value to undefined, the old value will still exist in the connection from previous navigation\r\n        if (!shallowObjectsEqual(this._internal.currentParams, params)) {\r\n          this._internal.currentParams = params;\r\n          // @ts-expect-error\r\n          this._updatePageInputs(\r\n            // @ts-expect-error\r\n            this._internal.currentPageComponent.nodeScope,\r\n            params\r\n          );\r\n        }\r\n        return;\r\n      }\r\n\r\n      // @ts-expect-error\r\n      this.scrollToTop();\r\n\r\n      // Reset the current page for this router\r\n      // First remove all children\r\n      // @ts-expect-error\r\n      const children = this.getChildren();\r\n      for (const i in children) {\r\n        const c = children[i];\r\n        // @ts-expect-error\r\n        this.removeChild(c);\r\n        // @ts-expect-error\r\n        this.nodeScope.deleteNode(c);\r\n      }\r\n\r\n      const content = await this.nodeScope!.createNode(component, guid());\r\n      this._internal.currentPageComponent = content;\r\n\r\n      // Find the root page node\r\n      const pageNodes = content.nodeScope.getNodesWithType(\"Page\");\r\n      if (pageNodes === undefined || pageNodes.length !== 1) {\r\n        return; // Should be only one page root\r\n      }\r\n\r\n      // @ts-expect-error\r\n      this._internal.currentPage =\r\n        RouterHandler.instance.getPageInfoForComponent(component);\r\n      this._internal.currentParams = params;\r\n\r\n      this.flagOutputDirty(\"currentPageTitle\");\r\n      this.flagOutputDirty(\"currentPageComponent\");\r\n      // @ts-expect-error Noodl is not defined\r\n      Noodl.SEO.setTitle(this._internal.currentPage.title);\r\n\r\n      // @ts-expect-error\r\n      this._updatePageInputs(\r\n        // @ts-expect-error\r\n        this._internal.currentPageComponent.nodeScope,\r\n        params\r\n      );\r\n\r\n      // @ts-expect-error\r\n      const group = this.createPageContainer();\r\n      group.addChild(content);\r\n\r\n      // @ts-expect-error\r\n      this.addChild(group);\r\n\r\n      /*\tthis.setPageOutputs({\r\n\t\t\t\tcurrentUrl: pageInfo.path,\r\n\t\t\t\tcurrentTitle: pageInfo.title\r\n\t\t\t});*/\r\n    },\r\n    _updatePageInputs(nodeScope, params) {\r\n      for (const pageInputNode of nodeScope.getNodesWithType(\"PageInputs\")) {\r\n        pageInputNode._setPageParams(params);\r\n      }\r\n    },\r\n    getRelativeURL(\r\n      targetPage: ComponentPageInfo,\r\n      pageParams: NavigateArgs[\"params\"]\r\n    ) {\r\n      if (!targetPage) return;\r\n\r\n      let urlPath = targetPage.path;\r\n      if (urlPath === undefined) return;\r\n\r\n      // First add matching parameters to path\r\n      const paramsInPath = urlPath.match(/{([^}]+)}/g);\r\n\r\n      const params = Object.assign({}, pageParams);\r\n      if (paramsInPath) {\r\n        for (const param of paramsInPath) {\r\n          const key = param.replace(/[{}]/g, \"\");\r\n          if (pageParams[key] !== undefined) {\r\n            urlPath = urlPath.replace(param, encodeURIComponent(params[key]));\r\n            delete params[key];\r\n          }\r\n        }\r\n      }\r\n\r\n      // Add other paramters as query\r\n      const query = [];\r\n      for (const key in params) {\r\n        // @ts-expect-error\r\n        query.push({\r\n          name: key,\r\n          value: encodeURIComponent(params[key]),\r\n        });\r\n      }\r\n\r\n      urlPath = _trimUrlPart(urlPath);\r\n\r\n      // Prepend this routers url path if there is one\r\n      if (this._internal.urlPath !== undefined)\r\n        urlPath = _trimUrlPart(this._internal.urlPath) + \"/\" + urlPath;\r\n\r\n      return {\r\n        path: urlPath,\r\n        query: query,\r\n      };\r\n    },\r\n    getNavigationAbsoluteURL(\r\n      targetPage: ComponentPageInfo,\r\n      pageParams: NavigateArgs[\"params\"]\r\n    ) {\r\n      // @ts-expect-error\r\n      let parent = this.parent;\r\n      let parentUrl = { path: \"\", query: [] };\r\n\r\n      while (\r\n        parent !== undefined &&\r\n        typeof parent.getNavigationAbsoluteURL !== \"function\"\r\n      ) {\r\n        parent = parent.getVisualParentNode();\r\n      }\r\n\r\n      if (parent) {\r\n        parentUrl = parent.getNavigationAbsoluteURL(\r\n          parent._internal.currentPage,\r\n          parent._internal.currentParams\r\n        );\r\n      }\r\n\r\n      // @ts-expect-error\r\n      const thisUrl = this.getRelativeURL(targetPage, pageParams);\r\n      if (thisUrl) {\r\n        const haveForwardSlash =\r\n          parentUrl.path.endsWith(\"/\") || thisUrl.path.startsWith(\"/\");\r\n        return {\r\n          path: parentUrl.path + (haveForwardSlash ? \"\" : \"/\") + thisUrl.path,\r\n          query: parentUrl.query.concat(thisUrl.query),\r\n        };\r\n      }\r\n\r\n      return parentUrl;\r\n    },\r\n    _getLocationPath: function () {\r\n      const navigationPathType =\r\n        NoodlRuntime.instance.getProjectSettings()[\"navigationPathType\"];\r\n      if (navigationPathType === undefined || navigationPathType === \"hash\") {\r\n        // Use hash as path\r\n        let hash = location.hash;\r\n        if (hash) {\r\n          if (hash[0] === \"#\") hash = hash.substring(1);\r\n          if (hash[0] === \"/\") hash = hash.substring(1);\r\n        }\r\n        return decodeURI(hash);\r\n      } else {\r\n        // Use url as path\r\n        let path = location.pathname;\r\n        if (path) {\r\n          if (path[0] === \"/\") {\r\n            // @ts-expect-error missing Noodl typings\r\n            const baseUrl = Noodl.Env[\"BaseUrl\"];\r\n            if (baseUrl) {\r\n              const pathnameLength = getBaseUrlLength(baseUrl);\r\n              path = path.substring(pathnameLength);\r\n            } else {\r\n              path = path.substring(1);\r\n            }\r\n          }\r\n        }\r\n        return decodeURI(path);\r\n      }\r\n    },\r\n    _getSearchParams: function () {\r\n      // Regex for replacing addition symbol with a space\r\n      const pl = /\\+/g;\r\n      const search = /([^&=]+)=?([^&]*)/g;\r\n      const decode = function (s) {\r\n        return decodeURIComponent(s.replace(pl, \" \"));\r\n      };\r\n      const query = location.search.substring(1);\r\n\r\n      let match: RegExpExecArray;\r\n\r\n      const urlParams = {};\r\n      // @ts-expect-error\r\n      while ((match = search.exec(query)))\r\n        urlParams[decode(match[1])] = decode(match[2]);\r\n\r\n      return urlParams;\r\n    },\r\n    getNavigationRemainingPath() {\r\n      return this._internal.remainingNavigationPath;\r\n    },\r\n    matchPageFromUrl() {\r\n      // Attempt to find relative path from closest navigation parent\r\n      // @ts-expect-error\r\n      let parent = this.parent;\r\n      while (\r\n        parent !== undefined &&\r\n        typeof parent.getNavigationRemainingPath !== \"function\"\r\n      ) {\r\n        parent = parent.getVisualParentNode();\r\n      }\r\n\r\n      let pathParts = undefined;\r\n\r\n      // Either use current browser location if we have no parent, or use remaining path\r\n      // from parent\r\n      if (parent === undefined) {\r\n        // @ts-expect-error\r\n        let urlPath = this._getLocationPath();\r\n        if (urlPath[0] === \"/\") urlPath = urlPath.substring(1);\r\n        pathParts = urlPath.split(\"/\");\r\n      } else {\r\n        pathParts = parent.getNavigationRemainingPath();\r\n      }\r\n      if (pathParts === undefined) return;\r\n\r\n      // @ts-expect-error\r\n      const urlQuery = this._getSearchParams();\r\n\r\n      function _matchPathParts(path, pattern) {\r\n        const params = {};\r\n        for (let i = 0; i < pattern.length; i++) {\r\n          const _p = pattern[i];\r\n          if (_p[0] === \"{\" && _p[_p.length - 1] === \"}\") {\r\n            // This is a param, collect it\r\n            if (path[i] !== undefined) {\r\n              params[_p.substring(1, _p.length - 1)] = decodeURIComponent(\r\n                path[i]\r\n              );\r\n            }\r\n          } else if (path[i] === undefined || _p !== path[i]) return;\r\n        }\r\n        return {\r\n          params: params,\r\n          remainingPathParts: path.slice().splice(pattern.length), // Make copy\r\n        };\r\n      }\r\n\r\n      const pages = RouterHandler.instance.getPagesForRouter(\r\n        this._internal.name\r\n      );\r\n      if (pages === undefined || pages.length === 0) return;\r\n\r\n      let matchedPage,\r\n        bestMatchLength = 9999;\r\n      for (const pageInfo of pages) {\r\n        let pagePattern = pageInfo!.path;\r\n        if (pagePattern === undefined) continue;\r\n        pagePattern = _trimUrlPart(pagePattern);\r\n\r\n        // Prepend this routers url path if there is one\r\n        if (this._internal.urlPath !== undefined)\r\n          pagePattern =\r\n            _trimUrlPart(this._internal.urlPath) + \"/\" + pagePattern;\r\n\r\n        const pagePatternParts = pagePattern.split(\"/\");\r\n        const match = _matchPathParts(pathParts, pagePatternParts);\r\n\r\n        // @ts-expect-error\r\n        const dist = Math.abs(pagePatternParts.length - pathParts.length);\r\n        if (match && bestMatchLength > dist) {\r\n          // This page is a match\r\n          matchedPage = { match, pageInfo };\r\n          bestMatchLength = dist;\r\n        }\r\n      }\r\n\r\n      if (matchedPage) {\r\n        this._internal.remainingNavigationPath =\r\n          matchedPage.match.remainingPathParts;\r\n        return {\r\n          page: matchedPage.pageInfo,\r\n          params: matchedPage.match.params,\r\n          query: urlQuery,\r\n        };\r\n      } else {\r\n        return {\r\n          page: undefined, // no matched page\r\n          params: {},\r\n          query: urlQuery,\r\n        };\r\n      }\r\n    },\r\n    _getCompleteUrlToPage(\r\n      page: ComponentPageInfo,\r\n      pageParams: NavigateArgs[\"params\"]\r\n    ) {\r\n      // @ts-expect-error\r\n      const url = this.getNavigationAbsoluteURL(page, pageParams);\r\n\r\n      let urlPath, hashPath;\r\n      const navigationPathType =\r\n        NoodlRuntime.instance.getProjectSettings()[\"navigationPathType\"];\r\n      if (navigationPathType === undefined || navigationPathType === \"hash\") {\r\n        hashPath = url.path;\r\n      } else {\r\n        urlPath = url.path;\r\n      }\r\n\r\n      const query = url.query.map((q) => q.name + \"=\" + q.value);\r\n      const compiledUrl =\r\n        (urlPath !== undefined ? urlPath : \"\") +\r\n        (query.length >= 1 ? \"?\" + query.join(\"&\") : \"\") +\r\n        (hashPath !== undefined ? \"#\" + hashPath : \"\");\r\n\r\n      return compiledUrl;\r\n    },\r\n    _updateUrlWithTopPage() {\r\n      // Push the state to the browser url\r\n      if (window.history !== undefined) {\r\n        // @ts-expect-error\r\n        this._internal.remainingNavigationPath = undefined; // Reset remaining nav path\r\n\r\n        // @ts-expect-error\r\n        const url = this._getCompleteUrlToPage(\r\n          this._internal.currentPage,\r\n          this._internal.currentParams\r\n        );\r\n        window.history.pushState({}, \"\", url);\r\n      }\r\n    },\r\n    navigate(args) {\r\n      // @ts-expect-error\r\n      this._internal.asyncQueue.enqueue(this.navigateAsync.bind(this, args));\r\n    },\r\n    async navigateAsync(args: NavigateArgs) {\r\n      if (args.target === undefined) return;\r\n\r\n      const newPage = RouterHandler.instance.getPageInfoForComponent(\r\n        args.target\r\n      );\r\n      if (!newPage) return; //TODO: send error to editor, \"invalid page component name\"\r\n\r\n      if (args.openInNewTab) {\r\n        // @ts-expect-error\r\n        const url = this._getCompleteUrlToPage(newPage, args.params);\r\n        window.open(url, \"_blank\");\r\n        args.hasNavigated && args.hasNavigated();\r\n      } else {\r\n        // @ts-expect-error\r\n        await this._navigateInCurrentWindow(newPage, args);\r\n      }\r\n    },\r\n    async _navigateInCurrentWindow(\r\n      newPage: ComponentPageInfo,\r\n      args: NavigateArgs\r\n    ) {\r\n      // @ts-expect-error\r\n      this.scrollToTop();\r\n\r\n      // Remove all current pages in the stack\r\n      // @ts-expect-error\r\n      const children = this.getChildren();\r\n      for (const i in children) {\r\n        const c = children[i];\r\n        // @ts-expect-error\r\n        this.removeChild(c);\r\n        // @ts-expect-error\r\n        this.nodeScope.deleteNode(c);\r\n      }\r\n\r\n      // @ts-expect-error\r\n      const group = this.createPageContainer();\r\n\r\n      // Create the page content\r\n      // @ts-expect-error\r\n      const content = await this.nodeScope.createNode(args.target, guid());\r\n\r\n      this._internal.currentPage = newPage;\r\n      this._internal.currentParams = args.params;\r\n\r\n      this.flagOutputDirty(\"currentPageTitle\");\r\n      this.flagOutputDirty(\"currentPageComponent\");\r\n      // @ts-expect-error Noodl is not defined\r\n      Noodl.SEO.setTitle(this._internal.currentPage.title);\r\n\r\n      const pageInputNodes = content.nodeScope.getNodesWithType(\"PageInputs\");\r\n      if (pageInputNodes !== undefined && pageInputNodes.length > 0) {\r\n        pageInputNodes.forEach((node) => {\r\n          node._setPageParams(args.params);\r\n        });\r\n      }\r\n\r\n      group.addChild(content);\r\n      // @ts-expect-error\r\n      this.addChild(group);\r\n\r\n      // @ts-expect-error\r\n      this._updateUrlWithTopPage();\r\n\r\n      args.hasNavigated && args.hasNavigated();\r\n      RouterHandler.instance.onNavigated(this._internal.name, newPage);\r\n    },\r\n    registerInputIfNeeded(name) {\r\n      if (this.hasInput(name)) {\r\n        return;\r\n      }\r\n    },\r\n  },\r\n};\r\n\r\nfunction shallowObjectsEqual(object1, object2) {\r\n  const keys1 = Object.keys(object1 || {});\r\n  const keys2 = Object.keys(object2 || {});\r\n\r\n  if (keys1.length !== keys2.length) {\r\n    return false;\r\n  }\r\n\r\n  return keys1.every((key) => object1[key] === object2[key]);\r\n}\r\n\r\nexport default createNodeFromReactComponent(RouterNode);\r\n","import { NodeDefinition } from \"@fluxscape/runtime\";\r\n\r\ninterface Internal {\r\n  // Define any internal state if needed\r\n}\r\n\r\nexport const node: NodeDefinition<Internal> = {\r\n  name: \"net.noodl.externallink\",\r\n  displayNodeName: \"External Link\",\r\n  docs: \"https://docs.noodl.net/nodes/navigation/external-link\",\r\n  category: \"Navigation\",\r\n  nodeDoubleClickAction: {\r\n    focusPort: \"link\",\r\n  },\r\n  inputs: {\r\n    link: {\r\n      type: \"string\",\r\n      displayName: \"Link\",\r\n    },\r\n    openInNewTab: {\r\n      type: \"boolean\",\r\n      displayName: \"Open In New Tab\",\r\n      default: true,\r\n    },\r\n    do: {\r\n      type: \"signal\",\r\n      displayName: \"Do\",\r\n      valueChangedToTrue() {\r\n        const openInNewTab = this.getInputValue(\"openInNewTab\");\r\n        const params = openInNewTab ? \"noopener,noreferrer\" : \"\";\r\n        const target =\r\n          openInNewTab === true || openInNewTab === undefined\r\n            ? \"_blank\"\r\n            : \"_self\";\r\n\r\n        window.open(this.getInputValue(\"link\"), target, params);\r\n      },\r\n    },\r\n  },\r\n};\r\n","import React from \"react\";\r\n\r\nimport Layout from \"../../../layout\";\r\nimport PointerListeners from \"../../../pointerlisteners\";\r\nimport { Noodl } from \"../../../types\";\r\n\r\nexport interface CircleProps extends Noodl.ReactProps {\r\n  size: number;\r\n  startAngle: number;\r\n  endAngle: number;\r\n\r\n  fillEnabled: boolean;\r\n  fillColor: Noodl.Color;\r\n\r\n  strokeEnabled: boolean;\r\n  strokeColor: Noodl.Color;\r\n  strokeWidth: number;\r\n  strokeLineCap: \"butt\" | \"round\";\r\n\r\n  dom: any;\r\n}\r\n\r\nfunction polarToCartesian(\r\n  centerX: number,\r\n  centerY: number,\r\n  radius: number,\r\n  angleInDegrees: number\r\n): { x: number; y: number } {\r\n  const angleInRadians = ((angleInDegrees - 90) * Math.PI) / 180.0;\r\n\r\n  return {\r\n    x: centerX + radius * Math.cos(angleInRadians),\r\n    y: centerY + radius * Math.sin(angleInRadians),\r\n  };\r\n}\r\n\r\nfunction filledArc(\r\n  x: number,\r\n  y: number,\r\n  radius: number,\r\n  startAngle: number,\r\n  endAngle: number\r\n): string {\r\n  if (endAngle % 360 === startAngle % 360) {\r\n    endAngle -= 0.0001;\r\n  }\r\n\r\n  const start = polarToCartesian(x, y, radius, endAngle);\r\n  const end = polarToCartesian(x, y, radius, startAngle);\r\n\r\n  const arcSweep = endAngle - startAngle <= 180 ? \"0\" : \"1\";\r\n\r\n  return [\r\n    \"M\",\r\n    start.x,\r\n    start.y,\r\n    \"A\",\r\n    radius,\r\n    radius,\r\n    0,\r\n    arcSweep,\r\n    0,\r\n    end.x,\r\n    end.y,\r\n    \"L\",\r\n    x,\r\n    y,\r\n    \"L\",\r\n    start.x,\r\n    start.y,\r\n  ].join(\" \");\r\n}\r\n\r\nfunction arc(\r\n  x: number,\r\n  y: number,\r\n  radius: number,\r\n  startAngle: number,\r\n  endAngle: number\r\n): string {\r\n  if (endAngle % 360 === startAngle % 360) {\r\n    endAngle -= 0.0001;\r\n  }\r\n\r\n  const start = polarToCartesian(x, y, radius, endAngle);\r\n  const end = polarToCartesian(x, y, radius, startAngle);\r\n\r\n  const arcSweep = endAngle - startAngle <= 180 ? \"0\" : \"1\";\r\n\r\n  return [\r\n    \"M\",\r\n    start.x,\r\n    start.y,\r\n    \"A\",\r\n    radius,\r\n    radius,\r\n    0,\r\n    arcSweep,\r\n    0,\r\n    end.x,\r\n    end.y,\r\n  ].join(\" \");\r\n}\r\n\r\nexport class Circle extends React.Component<CircleProps> {\r\n  constructor(props: CircleProps) {\r\n    super(props);\r\n  }\r\n\r\n  render(): React.ReactNode {\r\n    //SVG can only do strokes centered on a path, and we want to render it inside.\r\n    //We'll do it manually by adding another path on top of the filled circle\r\n\r\n    let fill: React.ReactNode;\r\n    let stroke: React.ReactNode;\r\n\r\n    const r = this.props.size / 2;\r\n    const { startAngle, endAngle } = this.props;\r\n\r\n    if (this.props.fillEnabled) {\r\n      const r = this.props.size / 2;\r\n      fill = (\r\n        <path\r\n          d={filledArc(r, r, r, startAngle, endAngle)}\r\n          fill={this.props.fillColor}\r\n        />\r\n      );\r\n    }\r\n\r\n    if (this.props.strokeEnabled) {\r\n      const { strokeColor, strokeWidth, strokeLineCap } = this.props;\r\n      const strokeRadius = r - this.props.strokeWidth / 2;\r\n      const path = arc(r, r, strokeRadius, startAngle, endAngle);\r\n      stroke = (\r\n        <path\r\n          d={path}\r\n          stroke={strokeColor}\r\n          strokeWidth={strokeWidth}\r\n          fill=\"transparent\"\r\n          strokeLinecap={strokeLineCap}\r\n        />\r\n      );\r\n    }\r\n\r\n    const style: React.CSSProperties = { ...this.props.style };\r\n    Layout.size(style, this.props);\r\n    Layout.align(style, this.props);\r\n\r\n    if (style.opacity === 0) {\r\n      style.pointerEvents = \"none\";\r\n    }\r\n\r\n    //the SVG element lack some properties like offsetLeft, offsetTop that the drag node depends on.\r\n    //Let's wrap it in a div to make it work properly\r\n    return (\r\n      <div\r\n        className={this.props.className}\r\n        {...this.props.dom}\r\n        {...PointerListeners(this.props)}\r\n        style={style}\r\n      >\r\n        <svg\r\n          xmlns=\"http://www.w3.org/2000/svg\"\r\n          width={this.props.size}\r\n          height={this.props.size}\r\n        >\r\n          {fill}\r\n          {stroke}\r\n        </svg>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import { Circle } from \"../../components/visual/Circle\";\r\nimport NodeSharedPortDefinitions from \"../../node-shared-port-definitions\";\r\nimport { createNodeFromReactComponent } from \"../../react-component-node\";\r\nimport { ReactNodeDefinition } from \"../../ReactNodeDefinition\";\r\n\r\ninterface Internal {\r\n  size?: number;\r\n  fillEnabled?: boolean;\r\n  fillColor?: string;\r\n  strokeEnabled?: boolean;\r\n  strokeWidth?: number;\r\n  strokeColor?: string;\r\n  strokeLineCap?: \"butt\" | \"round\";\r\n  startAngle?: number;\r\n  endAngle?: number;\r\n}\r\n\r\nconst CircleNode: ReactNodeDefinition<Internal> = {\r\n  name: \"Circle\",\r\n  docs: \"https://docs.noodl.net/nodes/basic-elements/circle\",\r\n  connectionPanel: {\r\n    groupPriority: [\r\n      \"General\",\r\n      \"Fill\",\r\n      \"Stroke\",\r\n      \"Dimensions\",\r\n      \"Style\",\r\n      \"Actions\",\r\n      \"Events\",\r\n      \"Mounted\",\r\n      \"Margin and padding\",\r\n      \"Pointer Events\",\r\n      \"Hover Events\",\r\n    ],\r\n  },\r\n  // @ts-expect-error\r\n  getReactComponent() {\r\n    return Circle;\r\n  },\r\n  noodlNodeAsProp: true,\r\n  allowChildren: false,\r\n  defaultCss: {\r\n    // @ts-expect-error\r\n    flexShrink: 0,\r\n    position: \"relative\",\r\n    display: \"flex\",\r\n  },\r\n  inputProps: {\r\n    size: {\r\n      displayName: \"Size\",\r\n      default: \"100\",\r\n      group: \"Dimension\",\r\n      type: {\r\n        name: \"number\",\r\n      },\r\n      index: 10,\r\n      allowVisualStates: true,\r\n    },\r\n    fillEnabled: {\r\n      group: \"Fill\",\r\n      displayName: \"Fill\",\r\n      default: true,\r\n      type: \"boolean\",\r\n      index: 20,\r\n      allowVisualStates: true,\r\n    },\r\n    fillColor: {\r\n      group: \"Fill\",\r\n      displayName: \"Fill Color\",\r\n      default: \"red\",\r\n      type: \"color\",\r\n      index: 21,\r\n      allowVisualStates: true,\r\n    },\r\n    strokeEnabled: {\r\n      index: 23,\r\n      group: \"Stroke\",\r\n      default: false,\r\n      displayName: \"Stroke\",\r\n      type: \"boolean\",\r\n      allowVisualStates: true,\r\n    },\r\n    strokeWidth: {\r\n      index: 24,\r\n      group: \"Stroke\",\r\n      displayName: \"Stroke Width\",\r\n      default: 10,\r\n      type: {\r\n        name: \"number\",\r\n      },\r\n      allowVisualStates: true,\r\n    },\r\n    strokeColor: {\r\n      index: 25,\r\n      group: \"Stroke\",\r\n      displayName: \"Stroke Color\",\r\n      type: \"color\",\r\n      default: \"black\",\r\n      allowVisualStates: true,\r\n    },\r\n    strokeLineCap: {\r\n      index: 26,\r\n      group: \"Stroke\",\r\n      displayName: \"Line Cap\",\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"Butt\", value: \"butt\" },\r\n          { label: \"Round\", value: \"round\" },\r\n        ],\r\n      },\r\n      default: \"butt\",\r\n      allowVisualStates: true,\r\n    },\r\n    startAngle: {\r\n      displayName: \"Start Angle\",\r\n      type: \"number\",\r\n      default: 0,\r\n      group: \"Style\",\r\n      index: 198,\r\n      allowVisualStates: true,\r\n    },\r\n    endAngle: {\r\n      displayName: \"End Angle\",\r\n      type: \"number\",\r\n      default: 360,\r\n      group: \"Style\",\r\n      index: 199,\r\n      allowVisualStates: true,\r\n    },\r\n  },\r\n  setup(context, graphModel) {\r\n    NodeSharedPortDefinitions.addTransformInputs(CircleNode);\r\n    NodeSharedPortDefinitions.addMarginInputs(CircleNode);\r\n    NodeSharedPortDefinitions.addSharedVisualInputs(CircleNode);\r\n    NodeSharedPortDefinitions.addAlignInputs(CircleNode);\r\n    NodeSharedPortDefinitions.addPointerEventOutputs(CircleNode);\r\n  },\r\n};\r\n\r\nexport default createNodeFromReactComponent(CircleNode);\r\n","import React, { useRef, useState, useEffect } from \"react\";\r\n\r\nimport { node as ForEachComponent } from \"../../../nodes/std-library/data/foreach\";\r\nimport { Noodl, Slot } from \"../../../types\";\r\nimport { Node } from \"@fluxscape/runtime\";\r\n\r\nexport interface ColumnsProps extends Noodl.ReactProps {\r\n  marginX: string;\r\n  marginY: string;\r\n\r\n  attrs: React.Attributes;\r\n\r\n  justifyContent: \"flex-start\" | \"flex-end\" | \"center\";\r\n  direction: \"row\" | \"column\";\r\n  minWidth: string;\r\n  layoutString: string;\r\n\r\n  children: Slot;\r\n}\r\n\r\nfunction calcAutofold(layout, minWidths, containerWidth, marginX) {\r\n  const first = _calcAutofold(layout, minWidths, containerWidth, marginX);\r\n  const second = _calcAutofold(\r\n    first.layout,\r\n    minWidths,\r\n    containerWidth,\r\n    marginX\r\n  );\r\n\r\n  if (first.totalFractions === second.totalFractions) {\r\n    return first;\r\n  } else {\r\n    return calcAutofold(second.layout, minWidths, containerWidth, marginX);\r\n  }\r\n}\r\n\r\nfunction _calcAutofold(layout, minWidth, containerWidth, marginX) {\r\n  const totalFractions = layout.reduce((a, b) => a + b, 0);\r\n  const fractionSize = 100 / totalFractions;\r\n\r\n  const rowWidth = layout.reduce(\r\n    (acc, curr, i) => {\r\n      return {\r\n        expected: acc.expected + (fractionSize / 100) * containerWidth * curr,\r\n        min: acc.min + parseFloat(minWidth) + marginX,\r\n      };\r\n    },\r\n    { expected: 0, min: 0, max: null }\r\n  );\r\n\r\n  const newLayout = layout;\r\n\r\n  if (rowWidth.expected < rowWidth.min) {\r\n    newLayout.pop();\r\n  }\r\n\r\n  const newTotalFractions = newLayout.reduce((a, b) => a + b, 0);\r\n  const newFractionSize = 100 / newTotalFractions;\r\n  const newColumnAmount = newLayout.length;\r\n\r\n  return {\r\n    layout: newLayout,\r\n    totalFractions: newTotalFractions,\r\n    fractionSize: newFractionSize,\r\n    columnAmount: newColumnAmount,\r\n  };\r\n}\r\n\r\nexport function Columns(props: ColumnsProps) {\r\n  if (!props.children) return null;\r\n  let columnLayout: string | null = null;\r\n\r\n  const containerRef = useRef<HTMLDivElement | null>(null);\r\n  const [containerWidth, setContainerWidth] = useState<number | null>(null);\r\n\r\n  useEffect(() => {\r\n    const container = containerRef.current;\r\n    if (!container) return;\r\n\r\n    const observer = new ResizeObserver(() => {\r\n      const container = containerRef.current;\r\n      if (!container) return;\r\n      setContainerWidth(container.offsetWidth);\r\n    });\r\n\r\n    observer.observe(container);\r\n\r\n    return () => {\r\n      observer.disconnect();\r\n    };\r\n  }, []);\r\n\r\n  switch (typeof props.layoutString) {\r\n    case \"string\":\r\n      columnLayout = props.layoutString.trim();\r\n      break;\r\n\r\n    case \"number\":\r\n      columnLayout = String(props.layoutString).trim();\r\n      break;\r\n\r\n    default:\r\n      columnLayout = null;\r\n  }\r\n\r\n  if (!columnLayout) {\r\n    return <>{props.children}</>;\r\n  }\r\n\r\n  // all data for childrens width calculation\r\n  const targetLayout = columnLayout\r\n    .split(\" \")\r\n    .map((number) => parseInt(number));\r\n\r\n  // constraints\r\n  const { layout, columnAmount, fractionSize } = calcAutofold(\r\n    targetLayout,\r\n    props.minWidth,\r\n    containerWidth || 0,\r\n    props.marginX\r\n  );\r\n\r\n  let children: React.ReactNode[] = [];\r\n  let forEachComponent = null;\r\n\r\n  // ForEachCompoent breaks the layout but is needed to send onMount/onUnmount\r\n  if (!Array.isArray(props.children)) {\r\n    // @ts-expect-error props.children.type is any\r\n    if (props.children.type !== ForEachComponent) {\r\n      children = [props.children];\r\n    }\r\n  } else {\r\n    children = props.children.filter((child: React.ReactNode | Node) => {\r\n      // @ts-expect-error\r\n      return React.isValidElement(child) && child.type !== ForEachComponent;\r\n    });\r\n    forEachComponent = props.children.find(\r\n      // @ts-expect-error\r\n      (child) => React.isValidElement(child) && child.type === ForEachComponent\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      {...props.attrs}\r\n      className={[\"columns-container\", props.className].join(\" \")}\r\n      ref={containerRef}\r\n      style={{\r\n        visibility: containerWidth === null ? \"hidden\" : \"visible\",\r\n        marginTop: parseFloat(props.marginY) * -1,\r\n        marginLeft: parseFloat(props.marginX) * -1,\r\n        display: \"flex\",\r\n        flexWrap: \"wrap\",\r\n        alignItems: \"stretch\",\r\n        justifyContent: props.justifyContent,\r\n        flexDirection: props.direction,\r\n        width: `calc(100% + (${parseFloat(props.marginX)}px)`,\r\n        boxSizing: \"border-box\",\r\n        ...props.style,\r\n      }}\r\n    >\r\n      {forEachComponent && forEachComponent}\r\n\r\n      {children.map((child, i) => {\r\n        if (React.isValidElement(child)) {\r\n          return (\r\n            <div\r\n              className=\"column-item\"\r\n              key={i}\r\n              style={{\r\n                boxSizing: \"border-box\",\r\n                paddingTop: props.marginY,\r\n                paddingLeft: props.marginX,\r\n                width: layout[i % columnAmount] * fractionSize + \"%\",\r\n                flexShrink: 0,\r\n                flexGrow: 0,\r\n                minWidth: props.minWidth,\r\n              }}\r\n            >\r\n              {React.cloneElement(child)}\r\n            </div>\r\n          );\r\n        }\r\n        return null;\r\n      })}\r\n    </div>\r\n  );\r\n}\r\n","import { Columns } from '../../components/visual/Columns';\r\nimport { createNodeFromReactComponent } from '../../react-component-node';\r\n\r\nconst ColumnsNode = {\r\n  name: 'net.noodl.visual.columns',\r\n  displayName: 'Columns',\r\n  docs: 'https://docs.noodl.net/nodes/basic-elements/columns',\r\n  allowChildren: true,\r\n  noodlNodeAsProp: true,\r\n  connectionPanel: {\r\n    groupPriority: [\r\n      'General',\r\n      'Style',\r\n      'Actions',\r\n      'Events',\r\n      'States',\r\n      'Mounted',\r\n      'Label',\r\n      'Label Text Style',\r\n      'Hover Events',\r\n      'Pointer Events',\r\n      'Focus Events'\r\n    ]\r\n  },\r\n\r\n  initialize() {    this.props.attrs = {};\r\n    this.props.layoutString = '1 2 1';\r\n    this.props.minWidth = 0;\r\n    this.props.marginX = 16;\r\n    this.props.marginY = 16;\r\n    this.props.direction = 'row';\r\n    this.props.justifyContent = 'flex-start';\r\n  },\r\n\r\n  getReactComponent() {\r\n    return Columns;\r\n  },\r\n\r\n  inputs: {\r\n    layoutString: {\r\n      group: 'Layout Settings',\r\n      displayName: 'Layout String',\r\n      type: 'string',\r\n      default: '1 2 1',\r\n      set(value) {\r\n        this.props.layoutString = value;\r\n\r\n        if (typeof value !== 'string') {\r\n          this.context.editorConnection.sendWarning(\r\n            this.nodeScope.componentOwner.name,\r\n            this.id,\r\n            'layout-type-warning',\r\n            {\r\n              message: 'Layout String needs to be a string.'\r\n            }\r\n          );\r\n        } else {\r\n          this.context.editorConnection.clearWarning(\r\n            this.nodeScope.componentOwner.name,\r\n            this.id,\r\n            'layout-type-warning'\r\n          );\r\n        }\r\n\r\n        this.forceUpdate();\r\n      }\r\n    },\r\n    testId: {\r\n      index: 100009,\r\n      displayName: 'Test ID Attribute',\r\n      group: 'Advanced HTML',\r\n      type: 'string',\r\n      set(value) {\r\n        this.props.attrs[\"data-testid\"] = value;\r\n        this.forceUpdate();\r\n      }\r\n    }\r\n  },\r\n\r\n  inputProps: {\r\n    marginX: {\r\n      group: 'Layout Settings',\r\n      displayName: 'Horizontal Gap',\r\n      type: {\r\n        name: 'number',\r\n        units: ['px'],\r\n        defaultUnit: 'px'\r\n      },\r\n      default: 16\r\n    },\r\n    marginY: {\r\n      group: 'Layout Settings',\r\n      displayName: 'Vertical Gap',\r\n      type: {\r\n        name: 'number',\r\n        units: ['px'],\r\n        defaultUnit: 'px'\r\n      },\r\n      default: 16\r\n    },\r\n    minWidth: {\r\n      group: 'Constraints',\r\n      displayName: 'Min Column Width',\r\n      type: {\r\n        name: 'number',\r\n        units: ['px'],\r\n        defaultUnit: 'px'\r\n      },\r\n      default: 0\r\n    },\r\n    direction: {\r\n      group: 'Layout Settings',\r\n      displayName: 'Layout Direction',\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          {\r\n            label: 'Horizontal',\r\n            value: 'row'\r\n          },\r\n          {\r\n            label: 'Vertical',\r\n            value: 'column'\r\n          }\r\n        ]\r\n      },\r\n      default: 'row'\r\n    },\r\n    justifyContent: {\r\n      group: 'Justify Content',\r\n      displayName: 'Justify Content',\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: 'Start', value: 'flex-start' },\r\n          { label: 'End', value: 'flex-end' },\r\n          { label: 'Center', value: 'center' }\r\n        ],\r\n        alignComp: 'align-items'\r\n      },\r\n      default: 'flex-start'\r\n    }\r\n  }\r\n};\r\n\r\nexport default createNodeFromReactComponent(ColumnsNode);\r\n","import React from 'react';\r\nimport Draggable from 'react-draggable';\r\n\r\nimport EaseCurves from '../../../easecurves';\r\nimport { Noodl } from '../../../types';\r\n\r\nexport interface DragProps extends Noodl.ReactProps {\r\n  inputPositionX: number;\r\n  inputPositionY: number;\r\n\r\n  enabled: boolean;\r\n  scale: number;\r\n  axis: 'x' | 'y' | 'both';\r\n\r\n  useParentBounds: boolean;\r\n\r\n  onStart?: () => void;\r\n  onStop?: () => void;\r\n  onDrag?: () => void;\r\n\r\n  positionX?: (value: number) => void;\r\n  positionY?: (value: number) => void;\r\n  deltaX?: (value: number) => void;\r\n  deltaY?: (value: number) => void;\r\n}\r\n\r\nfunction setDragValues(event, props) {\r\n  props.positionX && props.positionX(event.x);\r\n  props.positionY && props.positionY(event.y);\r\n  props.deltaX && props.deltaX(event.deltaX);\r\n  props.deltaY && props.deltaY(event.deltaY);\r\n}\r\n\r\ntype State = {\r\n  x: number\r\n  y: number\r\n}\r\n\r\nexport class Drag extends React.Component<DragProps, State> {\r\n  snapToPositionXTimer: any;\r\n  snapToPositionYTimer: any;\r\n\r\n  constructor(props: DragProps) {\r\n    super(props);\r\n    this.state = { x: 0, y: 0 } satisfies State;\r\n  }\r\n\r\n  snapToPosition({ timerScheduler, propCallback, duration, axis, endValue }) {\r\n    const _this = this;\r\n    return timerScheduler\r\n      .createTimer({\r\n        duration: duration === undefined ? 300 : duration,\r\n        startValue: this.state[axis],\r\n        endValue: endValue,\r\n        ease: EaseCurves.easeOut,\r\n        onRunning: function (t) {\r\n          const value = this.ease(this.startValue, this.endValue, t);\r\n          // @ts-expect-error Either x or y...\r\n          _this.setState({ [axis]: value });\r\n          propCallback && propCallback(value);\r\n        }\r\n      })\r\n      .start();\r\n  }\r\n\r\n  componentDidMount() {\r\n    const x = this.props.inputPositionX ? this.props.inputPositionX : 0;\r\n    const y = this.props.inputPositionY ? this.props.inputPositionY : 0;\r\n\r\n    this.setState({ x, y });\r\n    setDragValues({ x, y, deltaX: 0, deltaY: 0 }, this.props);\r\n  }\r\n\r\n  UNSAFE_componentWillReceiveProps(nextProps: DragProps) {\r\n    const props = this.props;\r\n\r\n    if (props.inputPositionX !== nextProps.inputPositionX) {\r\n      this.setState({ x: nextProps.inputPositionX });\r\n      props.positionX && props.positionX(nextProps.inputPositionX);\r\n      props.deltaX && props.deltaX(nextProps.inputPositionX - props.inputPositionX);\r\n    }\r\n    if (props.inputPositionY !== nextProps.inputPositionY) {\r\n      this.setState({ y: nextProps.inputPositionY });\r\n      props.positionY && props.positionY(nextProps.inputPositionY);\r\n      props.deltaY && props.deltaY(nextProps.inputPositionY - props.inputPositionY);\r\n    }\r\n  }\r\n\r\n  snapToPositionX(x, duration) {\r\n    if (this.state.x === x) return;\r\n\r\n    this.snapToPositionXTimer && this.snapToPositionXTimer.stop();\r\n    this.snapToPositionXTimer = this.snapToPosition({\r\n      timerScheduler: this.props.noodlNode.context.timerScheduler,\r\n      propCallback: this.props.positionX,\r\n      duration,\r\n      axis: 'x',\r\n      endValue: x\r\n    });\r\n  }\r\n\r\n  snapToPositionY(y, duration) {\r\n    if (this.state.y === y) return;\r\n\r\n    this.snapToPositionYTimer && this.snapToPositionYTimer.stop();\r\n    this.snapToPositionYTimer = this.snapToPosition({\r\n      timerScheduler: this.props.noodlNode.context.timerScheduler,\r\n      propCallback: this.props.positionY,\r\n      duration,\r\n      axis: 'y',\r\n      endValue: y\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const props = this.props;\r\n    const bounds = props.useParentBounds ? 'parent' : undefined;\r\n\r\n    let child;\r\n    if (React.Children.count(props.children) > 0) {\r\n      child = React.Children.toArray(props.children)[0];\r\n    } else {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <Draggable\r\n        axis={props.axis}\r\n        bounds={bounds}\r\n        disabled={props.enabled === false}\r\n        scale={props.scale || 0}\r\n        position={{ x: this.state.x, y: this.state.y }}\r\n        onStart={(e, data) => {\r\n          setDragValues(data, props);\r\n          props.onStart && props.onStart();\r\n          this.snapToPositionXTimer && this.snapToPositionXTimer.stop();\r\n          this.snapToPositionYTimer && this.snapToPositionYTimer.stop();\r\n        }}\r\n        onStop={(e, data) => {\r\n          if (props.axis === 'x' || props.axis === 'both') {\r\n            this.setState({ x: data.x });\r\n          }\r\n          if (props.axis === 'y' || props.axis === 'both') {\r\n            this.setState({ y: data.y });\r\n          }\r\n          props.positionX && props.positionX(data.x);\r\n          props.positionY && props.positionY(data.y);\r\n          props.onStop && props.onStop();\r\n        }}\r\n        onDrag={(e, data) => {\r\n          setDragValues(data, props);\r\n          props.onDrag && props.onDrag();\r\n        }}\r\n      >\r\n        {React.cloneElement(child, { parentLayout: props.parentLayout })}\r\n      </Draggable>\r\n    );\r\n  }\r\n}\r\n","import { Drag } from '../../components/visual/Drag';\r\nimport { createNodeFromReactComponent } from '../../react-component-node';\r\n\r\nconst DragNode = {\r\n  name: 'Drag',\r\n  docs: 'https://docs.noodl.net/nodes/utilities/drag',\r\n  allowChildren: true,\r\n  noodlNodeAsProp: true,\r\n  getReactComponent() {\r\n    return Drag;\r\n  },\r\n  initialize() {\r\n    this._internal.snapPositionX = 0;\r\n    this._internal.snapPositionY = 0;\r\n    this._internal.snapDurationX = 300;\r\n    this._internal.snapDurationY = 300;\r\n  },\r\n  inputs: {\r\n    'snapToPositionX.do': {\r\n      group: 'Snap To Position X',\r\n      displayName: 'Do',\r\n      editorName: 'Do|Snap To Position X',\r\n      type: 'signal',\r\n      valueChangedToTrue() {\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          const { snapPositionX, snapDurationX } = this._internal;\r\n          this.innerReactComponentRef && this.innerReactComponentRef.snapToPositionX(snapPositionX, snapDurationX);\r\n        });\r\n      }\r\n    },\r\n    'snapToPositionX.value': {\r\n      default: 0,\r\n      group: 'Snap To Position X',\r\n      displayName: 'Value',\r\n      editorName: 'Value|Snap To Position X',\r\n      type: 'number',\r\n      set(value) {\r\n        this._internal.snapPositionX = value;\r\n      }\r\n    },\r\n    'snapToPositionX.duration': {\r\n      default: 300,\r\n      group: 'Snap To Position X',\r\n      displayName: 'Duration',\r\n      editorName: 'Duration|Snap To Position X',\r\n      type: 'number',\r\n      set(value) {\r\n        this._internal.snapDurationX = value;\r\n      }\r\n    },\r\n    'snapToPositionY.do': {\r\n      group: 'Snap To Position Y',\r\n      displayName: 'Do',\r\n      editorName: 'Do|Snap To Position Y',\r\n      type: 'signal',\r\n      valueChangedToTrue() {\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          const { snapPositionY, snapDurationY } = this._internal;\r\n          this.innerReactComponentRef && this.innerReactComponentRef.snapToPositionY(snapPositionY, snapDurationY);\r\n        });\r\n      }\r\n    },\r\n    'snapToPositionY.value': {\r\n      default: 0,\r\n      group: 'Snap To Position Y',\r\n      displayName: 'Value',\r\n      editorName: 'Value|Snap To Position Y',\r\n      type: 'number',\r\n      set(value) {\r\n        this._internal.snapPositionY = value;\r\n      }\r\n    },\r\n    'snapToPositionY.duration': {\r\n      default: 300,\r\n      group: 'Snap To Position Y',\r\n      displayName: 'Duration',\r\n      editorName: 'Duration|Snap To Position Y',\r\n      type: 'number',\r\n      set(value) {\r\n        this._internal.snapDurationY = value;\r\n      }\r\n    }\r\n  },\r\n  inputProps: {\r\n    enabled: {\r\n      group: 'Drag',\r\n      displayName: 'Enabled',\r\n      type: 'boolean',\r\n      default: true\r\n    },\r\n    axis: {\r\n      group: 'Drag',\r\n      displayName: 'Axis',\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: 'X', value: 'x' },\r\n          { label: 'Y', value: 'y' },\r\n          { label: 'Both', value: 'both' }\r\n        ]\r\n      },\r\n      default: 'x'\r\n    },\r\n    useParentBounds: {\r\n      group: 'Drag',\r\n      displayName: 'Constrain to parent',\r\n      type: 'boolean',\r\n      default: true\r\n    },\r\n    inputPositionX: {\r\n      displayName: 'Start Drag X',\r\n      type: {\r\n        name: 'number'\r\n      }\r\n    },\r\n    inputPositionY: {\r\n      displayName: 'Start Drag Y',\r\n      type: {\r\n        name: 'number'\r\n      }\r\n    },\r\n    scale: {\r\n      displayName: 'Scale',\r\n      default: 1.0,\r\n      type: {\r\n        name: 'number'\r\n      }\r\n    }\r\n  },\r\n  outputProps: {\r\n    onStart: {\r\n      group: 'Signals',\r\n      type: 'signal',\r\n      displayName: 'Drag Started'\r\n    },\r\n    onStop: {\r\n      group: 'Signals',\r\n      type: 'signal',\r\n      displayName: 'Drag Ended'\r\n    },\r\n    onDrag: {\r\n      group: 'Signals',\r\n      type: 'signal',\r\n      displayName: 'Drag Moved'\r\n    },\r\n    positionX: {\r\n      group: 'Values',\r\n      displayName: 'Drag X',\r\n      type: 'number'\r\n    },\r\n    positionY: {\r\n      group: 'Values',\r\n      displayName: 'Drag Y',\r\n      type: 'number'\r\n    },\r\n    deltaX: {\r\n      group: 'Values',\r\n      displayName: 'Delta X',\r\n      type: 'number'\r\n    },\r\n    deltaY: {\r\n      group: 'Values',\r\n      displayName: 'Delta Y',\r\n      type: 'number'\r\n    }\r\n  }\r\n};\r\n\r\nexport default createNodeFromReactComponent(DragNode);\r\n","/*!\n * better-scroll / core\n * (c) 2016-2023 ustbhuangyi\n * Released under the MIT License.\n */\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nfunction __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\n\nvar propertiesConfig = [\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorX.currentPos',\r\n        key: 'x'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorY.currentPos',\r\n        key: 'y'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorX.hasScroll',\r\n        key: 'hasHorizontalScroll'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorY.hasScroll',\r\n        key: 'hasVerticalScroll'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorX.contentSize',\r\n        key: 'scrollerWidth'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorY.contentSize',\r\n        key: 'scrollerHeight'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorX.maxScrollPos',\r\n        key: 'maxScrollX'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorY.maxScrollPos',\r\n        key: 'maxScrollY'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorX.minScrollPos',\r\n        key: 'minScrollX'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorY.minScrollPos',\r\n        key: 'minScrollY'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorX.movingDirection',\r\n        key: 'movingDirectionX'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorY.movingDirection',\r\n        key: 'movingDirectionY'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorX.direction',\r\n        key: 'directionX'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBehaviorY.direction',\r\n        key: 'directionY'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.actions.enabled',\r\n        key: 'enabled'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.animater.pending',\r\n        key: 'pending'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.animater.stop',\r\n        key: 'stop'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollTo',\r\n        key: 'scrollTo'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollBy',\r\n        key: 'scrollBy'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.scrollToElement',\r\n        key: 'scrollToElement'\r\n    },\r\n    {\r\n        sourceKey: 'scroller.resetPosition',\r\n        key: 'resetPosition'\r\n    }\r\n];\n\nfunction warn(msg) {\r\n    console.error(\"[BScroll warn]: \" + msg);\r\n}\n\n// ssr support\r\nvar inBrowser = typeof window !== 'undefined';\r\nvar ua = inBrowser && navigator.userAgent.toLowerCase();\r\nvar isWeChatDevTools = !!(ua && /wechatdevtools/.test(ua));\r\nvar isAndroid = ua && ua.indexOf('android') > 0;\r\n/* istanbul ignore next */\r\nvar isIOSBadVersion = (function () {\r\n    if (typeof ua === 'string') {\r\n        var regex = /os (\\d\\d?_\\d(_\\d)?)/;\r\n        var matches = regex.exec(ua);\r\n        if (!matches)\r\n            return false;\r\n        var parts = matches[1].split('_').map(function (item) {\r\n            return parseInt(item, 10);\r\n        });\r\n        // ios version >= 13.4 issue 982\r\n        return !!(parts[0] === 13 && parts[1] >= 4);\r\n    }\r\n    return false;\r\n})();\r\n/* istanbul ignore next */\r\nvar supportsPassive = false;\r\n/* istanbul ignore next */\r\nif (inBrowser) {\r\n    var EventName = 'test-passive';\r\n    try {\r\n        var opts = {};\r\n        Object.defineProperty(opts, 'passive', {\r\n            get: function () {\r\n                supportsPassive = true;\r\n            },\r\n        }); // https://github.com/facebook/flow/issues/285\r\n        window.addEventListener(EventName, function () { }, opts);\r\n    }\r\n    catch (e) { }\r\n}\n\nfunction getNow() {\r\n    return window.performance &&\r\n        window.performance.now &&\r\n        window.performance.timing\r\n        ? window.performance.now() + window.performance.timing.navigationStart\r\n        : +new Date();\r\n}\r\nvar extend = function (target, source) {\r\n    for (var key in source) {\r\n        target[key] = source[key];\r\n    }\r\n    return target;\r\n};\r\nfunction isUndef(v) {\r\n    return v === undefined || v === null;\r\n}\r\nfunction between(x, min, max) {\r\n    if (x < min) {\r\n        return min;\r\n    }\r\n    if (x > max) {\r\n        return max;\r\n    }\r\n    return x;\r\n}\n\nvar elementStyle = (inBrowser &&\r\n    document.createElement('div').style);\r\nvar vendor = (function () {\r\n    /* istanbul ignore if  */\r\n    if (!inBrowser) {\r\n        return false;\r\n    }\r\n    var transformNames = [\r\n        {\r\n            key: 'standard',\r\n            value: 'transform',\r\n        },\r\n        {\r\n            key: 'webkit',\r\n            value: 'webkitTransform',\r\n        },\r\n        {\r\n            key: 'Moz',\r\n            value: 'MozTransform',\r\n        },\r\n        {\r\n            key: 'O',\r\n            value: 'OTransform',\r\n        },\r\n        {\r\n            key: 'ms',\r\n            value: 'msTransform',\r\n        },\r\n    ];\r\n    for (var _i = 0, transformNames_1 = transformNames; _i < transformNames_1.length; _i++) {\r\n        var obj = transformNames_1[_i];\r\n        if (elementStyle[obj.value] !== undefined) {\r\n            return obj.key;\r\n        }\r\n    }\r\n    /* istanbul ignore next  */\r\n    return false;\r\n})();\r\n/* istanbul ignore next  */\r\nfunction prefixStyle(style) {\r\n    if (vendor === false) {\r\n        return style;\r\n    }\r\n    if (vendor === 'standard') {\r\n        if (style === 'transitionEnd') {\r\n            return 'transitionend';\r\n        }\r\n        return style;\r\n    }\r\n    return vendor + style.charAt(0).toUpperCase() + style.substr(1);\r\n}\r\nfunction getElement(el) {\r\n    return (typeof el === 'string' ? document.querySelector(el) : el);\r\n}\r\nfunction addEvent(el, type, fn, capture) {\r\n    var useCapture = supportsPassive\r\n        ? {\r\n            passive: false,\r\n            capture: !!capture,\r\n        }\r\n        : !!capture;\r\n    el.addEventListener(type, fn, useCapture);\r\n}\r\nfunction removeEvent(el, type, fn, capture) {\r\n    el.removeEventListener(type, fn, {\r\n        capture: !!capture,\r\n    });\r\n}\r\nfunction maybePrevent(e) {\r\n    if (e.cancelable) {\r\n        e.preventDefault();\r\n    }\r\n}\r\nfunction offset(el) {\r\n    var left = 0;\r\n    var top = 0;\r\n    while (el) {\r\n        left -= el.offsetLeft;\r\n        top -= el.offsetTop;\r\n        el = el.offsetParent;\r\n    }\r\n    return {\r\n        left: left,\r\n        top: top,\r\n    };\r\n}\r\nvendor && vendor !== 'standard' ? '-' + vendor.toLowerCase() + '-' : '';\r\nvar transform = prefixStyle('transform');\r\nvar transition = prefixStyle('transition');\r\nvar hasPerspective = inBrowser && prefixStyle('perspective') in elementStyle;\r\n// fix issue #361\r\nvar hasTouch = inBrowser && ('ontouchstart' in window || isWeChatDevTools);\r\nvar hasTransition = inBrowser && transition in elementStyle;\r\nvar style = {\r\n    transform: transform,\r\n    transition: transition,\r\n    transitionTimingFunction: prefixStyle('transitionTimingFunction'),\r\n    transitionDuration: prefixStyle('transitionDuration'),\r\n    transitionDelay: prefixStyle('transitionDelay'),\r\n    transformOrigin: prefixStyle('transformOrigin'),\r\n    transitionEnd: prefixStyle('transitionEnd'),\r\n    transitionProperty: prefixStyle('transitionProperty'),\r\n};\r\nvar eventTypeMap = {\r\n    touchstart: 1,\r\n    touchmove: 1,\r\n    touchend: 1,\r\n    touchcancel: 1,\r\n    mousedown: 2,\r\n    mousemove: 2,\r\n    mouseup: 2,\r\n};\r\nfunction getRect(el) {\r\n    /* istanbul ignore if  */\r\n    if (el instanceof window.SVGElement) {\r\n        var rect = el.getBoundingClientRect();\r\n        return {\r\n            top: rect.top,\r\n            left: rect.left,\r\n            width: rect.width,\r\n            height: rect.height,\r\n        };\r\n    }\r\n    else {\r\n        return {\r\n            top: el.offsetTop,\r\n            left: el.offsetLeft,\r\n            width: el.offsetWidth,\r\n            height: el.offsetHeight,\r\n        };\r\n    }\r\n}\r\nfunction preventDefaultExceptionFn(el, exceptions) {\r\n    for (var i in exceptions) {\r\n        if (exceptions[i].test(el[i])) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nvar tagExceptionFn = preventDefaultExceptionFn;\r\nfunction tap(e, eventName) {\r\n    var ev = document.createEvent('Event');\r\n    ev.initEvent(eventName, true, true);\r\n    ev.pageX = e.pageX;\r\n    ev.pageY = e.pageY;\r\n    e.target.dispatchEvent(ev);\r\n}\r\nfunction click(e, event) {\r\n    if (event === void 0) { event = 'click'; }\r\n    var eventSource;\r\n    if (e.type === 'mouseup') {\r\n        eventSource = e;\r\n    }\r\n    else if (e.type === 'touchend' || e.type === 'touchcancel') {\r\n        eventSource = e.changedTouches[0];\r\n    }\r\n    var posSrc = {};\r\n    if (eventSource) {\r\n        posSrc.screenX = eventSource.screenX || 0;\r\n        posSrc.screenY = eventSource.screenY || 0;\r\n        posSrc.clientX = eventSource.clientX || 0;\r\n        posSrc.clientY = eventSource.clientY || 0;\r\n    }\r\n    var ev;\r\n    var bubbles = true;\r\n    var cancelable = true;\r\n    var ctrlKey = e.ctrlKey, shiftKey = e.shiftKey, altKey = e.altKey, metaKey = e.metaKey;\r\n    var pressedKeysMap = {\r\n        ctrlKey: ctrlKey,\r\n        shiftKey: shiftKey,\r\n        altKey: altKey,\r\n        metaKey: metaKey,\r\n    };\r\n    if (typeof MouseEvent !== 'undefined') {\r\n        try {\r\n            ev = new MouseEvent(event, extend(__assign({ bubbles: bubbles,\r\n                cancelable: cancelable }, pressedKeysMap), posSrc));\r\n        }\r\n        catch (e) {\r\n            /* istanbul ignore next */\r\n            createEvent();\r\n        }\r\n    }\r\n    else {\r\n        createEvent();\r\n    }\r\n    function createEvent() {\r\n        ev = document.createEvent('Event');\r\n        ev.initEvent(event, bubbles, cancelable);\r\n        extend(ev, posSrc);\r\n    }\r\n    // forwardedTouchEvent set to true in case of the conflict with fastclick\r\n    ev.forwardedTouchEvent = true;\r\n    ev._constructed = true;\r\n    e.target.dispatchEvent(ev);\r\n}\r\nfunction dblclick(e) {\r\n    click(e, 'dblclick');\r\n}\n\nvar ease = {\r\n    // easeOutQuint\r\n    swipe: {\r\n        style: 'cubic-bezier(0.23, 1, 0.32, 1)',\r\n        fn: function (t) {\r\n            return 1 + --t * t * t * t * t;\r\n        }\r\n    },\r\n    // easeOutQuard\r\n    swipeBounce: {\r\n        style: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)',\r\n        fn: function (t) {\r\n            return t * (2 - t);\r\n        }\r\n    },\r\n    // easeOutQuart\r\n    bounce: {\r\n        style: 'cubic-bezier(0.165, 0.84, 0.44, 1)',\r\n        fn: function (t) {\r\n            return 1 - --t * t * t * t;\r\n        }\r\n    }\r\n};\n\nvar DEFAULT_INTERVAL = 1000 / 60;\r\nvar windowCompat = inBrowser && window;\r\n/* istanbul ignore next */\r\nfunction noop$1() { }\r\nvar requestAnimationFrame = (function () {\r\n    /* istanbul ignore if  */\r\n    if (!inBrowser) {\r\n        return noop$1;\r\n    }\r\n    return (windowCompat.requestAnimationFrame ||\r\n        windowCompat.webkitRequestAnimationFrame ||\r\n        windowCompat.mozRequestAnimationFrame ||\r\n        windowCompat.oRequestAnimationFrame ||\r\n        // if all else fails, use setTimeout\r\n        function (callback) {\r\n            return window.setTimeout(callback, callback.interval || DEFAULT_INTERVAL); // make interval as precise as possible.\r\n        });\r\n})();\r\nvar cancelAnimationFrame = (function () {\r\n    /* istanbul ignore if  */\r\n    if (!inBrowser) {\r\n        return noop$1;\r\n    }\r\n    return (windowCompat.cancelAnimationFrame ||\r\n        windowCompat.webkitCancelAnimationFrame ||\r\n        windowCompat.mozCancelAnimationFrame ||\r\n        windowCompat.oCancelAnimationFrame ||\r\n        function (id) {\r\n            window.clearTimeout(id);\r\n        });\r\n})();\n\n/* istanbul ignore next */\r\nvar noop = function (val) { };\r\nvar sharedPropertyDefinition = {\r\n    enumerable: true,\r\n    configurable: true,\r\n    get: noop,\r\n    set: noop,\r\n};\r\nvar getProperty = function (obj, key) {\r\n    var keys = key.split('.');\r\n    for (var i = 0; i < keys.length - 1; i++) {\r\n        obj = obj[keys[i]];\r\n        if (typeof obj !== 'object' || !obj)\r\n            return;\r\n    }\r\n    var lastKey = keys.pop();\r\n    if (typeof obj[lastKey] === 'function') {\r\n        return function () {\r\n            return obj[lastKey].apply(obj, arguments);\r\n        };\r\n    }\r\n    else {\r\n        return obj[lastKey];\r\n    }\r\n};\r\nvar setProperty = function (obj, key, value) {\r\n    var keys = key.split('.');\r\n    var temp;\r\n    for (var i = 0; i < keys.length - 1; i++) {\r\n        temp = keys[i];\r\n        if (!obj[temp])\r\n            obj[temp] = {};\r\n        obj = obj[temp];\r\n    }\r\n    obj[keys.pop()] = value;\r\n};\r\nfunction propertiesProxy(target, sourceKey, key) {\r\n    sharedPropertyDefinition.get = function proxyGetter() {\r\n        return getProperty(this, sourceKey);\r\n    };\r\n    sharedPropertyDefinition.set = function proxySetter(val) {\r\n        setProperty(this, sourceKey, val);\r\n    };\r\n    Object.defineProperty(target, key, sharedPropertyDefinition);\r\n}\n\nvar EventEmitter = /** @class */ (function () {\r\n    function EventEmitter(names) {\r\n        this.events = {};\r\n        this.eventTypes = {};\r\n        this.registerType(names);\r\n    }\r\n    EventEmitter.prototype.on = function (type, fn, context) {\r\n        if (context === void 0) { context = this; }\r\n        this.hasType(type);\r\n        if (!this.events[type]) {\r\n            this.events[type] = [];\r\n        }\r\n        this.events[type].push([fn, context]);\r\n        return this;\r\n    };\r\n    EventEmitter.prototype.once = function (type, fn, context) {\r\n        var _this = this;\r\n        if (context === void 0) { context = this; }\r\n        this.hasType(type);\r\n        var magic = function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n            _this.off(type, magic);\r\n            var ret = fn.apply(context, args);\r\n            if (ret === true) {\r\n                return ret;\r\n            }\r\n        };\r\n        magic.fn = fn;\r\n        this.on(type, magic);\r\n        return this;\r\n    };\r\n    EventEmitter.prototype.off = function (type, fn) {\r\n        if (!type && !fn) {\r\n            this.events = {};\r\n            return this;\r\n        }\r\n        if (type) {\r\n            this.hasType(type);\r\n            if (!fn) {\r\n                this.events[type] = [];\r\n                return this;\r\n            }\r\n            var events = this.events[type];\r\n            if (!events) {\r\n                return this;\r\n            }\r\n            var count = events.length;\r\n            while (count--) {\r\n                if (events[count][0] === fn ||\r\n                    (events[count][0] && events[count][0].fn === fn)) {\r\n                    events.splice(count, 1);\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n    };\r\n    EventEmitter.prototype.trigger = function (type) {\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        this.hasType(type);\r\n        var events = this.events[type];\r\n        if (!events) {\r\n            return;\r\n        }\r\n        var len = events.length;\r\n        var eventsCopy = __spreadArrays(events);\r\n        var ret;\r\n        for (var i = 0; i < len; i++) {\r\n            var event_1 = eventsCopy[i];\r\n            var fn = event_1[0], context = event_1[1];\r\n            if (fn) {\r\n                ret = fn.apply(context, args);\r\n                if (ret === true) {\r\n                    return ret;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    EventEmitter.prototype.registerType = function (names) {\r\n        var _this = this;\r\n        names.forEach(function (type) {\r\n            _this.eventTypes[type] = type;\r\n        });\r\n    };\r\n    EventEmitter.prototype.destroy = function () {\r\n        this.events = {};\r\n        this.eventTypes = {};\r\n    };\r\n    EventEmitter.prototype.hasType = function (type) {\r\n        var types = this.eventTypes;\r\n        var isType = types[type] === type;\r\n        if (!isType) {\r\n            warn(\"EventEmitter has used unknown event type: \\\"\" + type + \"\\\", should be oneof [\" +\r\n                (\"\" + Object.keys(types).map(function (_) { return JSON.stringify(_); })) +\r\n                \"]\");\r\n        }\r\n    };\r\n    return EventEmitter;\r\n}());\r\nvar EventRegister = /** @class */ (function () {\r\n    function EventRegister(wrapper, events) {\r\n        this.wrapper = wrapper;\r\n        this.events = events;\r\n        this.addDOMEvents();\r\n    }\r\n    EventRegister.prototype.destroy = function () {\r\n        this.removeDOMEvents();\r\n        this.events = [];\r\n    };\r\n    EventRegister.prototype.addDOMEvents = function () {\r\n        this.handleDOMEvents(addEvent);\r\n    };\r\n    EventRegister.prototype.removeDOMEvents = function () {\r\n        this.handleDOMEvents(removeEvent);\r\n    };\r\n    EventRegister.prototype.handleDOMEvents = function (eventOperation) {\r\n        var _this = this;\r\n        var wrapper = this.wrapper;\r\n        this.events.forEach(function (event) {\r\n            eventOperation(wrapper, event.name, _this, !!event.capture);\r\n        });\r\n    };\r\n    EventRegister.prototype.handleEvent = function (e) {\r\n        var eventType = e.type;\r\n        this.events.some(function (event) {\r\n            if (event.name === eventType) {\r\n                event.handler(e);\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n    };\r\n    return EventRegister;\r\n}());\n\nvar CustomOptions = /** @class */ (function () {\r\n    function CustomOptions() {\r\n    }\r\n    return CustomOptions;\r\n}());\r\nvar OptionsConstructor = /** @class */ (function (_super) {\r\n    __extends(OptionsConstructor, _super);\r\n    function OptionsConstructor() {\r\n        var _this = _super.call(this) || this;\r\n        _this.startX = 0;\r\n        _this.startY = 0;\r\n        _this.scrollX = false;\r\n        _this.scrollY = true;\r\n        _this.freeScroll = false;\r\n        _this.directionLockThreshold = 0;\r\n        _this.eventPassthrough = \"\" /* None */;\r\n        _this.click = false;\r\n        _this.dblclick = false;\r\n        _this.tap = '';\r\n        _this.bounce = {\r\n            top: true,\r\n            bottom: true,\r\n            left: true,\r\n            right: true,\r\n        };\r\n        _this.bounceTime = 800;\r\n        _this.momentum = true;\r\n        _this.momentumLimitTime = 300;\r\n        _this.momentumLimitDistance = 15;\r\n        _this.swipeTime = 2500;\r\n        _this.swipeBounceTime = 500;\r\n        _this.deceleration = 0.0015;\r\n        _this.flickLimitTime = 200;\r\n        _this.flickLimitDistance = 100;\r\n        _this.resizePolling = 60;\r\n        _this.probeType = 0 /* Default */;\r\n        _this.stopPropagation = false;\r\n        _this.preventDefault = true;\r\n        _this.preventDefaultException = {\r\n            tagName: /^(INPUT|TEXTAREA|BUTTON|SELECT|AUDIO)$/,\r\n        };\r\n        _this.tagException = {\r\n            tagName: /^TEXTAREA$/,\r\n        };\r\n        _this.HWCompositing = true;\r\n        _this.useTransition = true;\r\n        _this.bindToWrapper = false;\r\n        _this.bindToTarget = false;\r\n        _this.disableMouse = hasTouch;\r\n        _this.disableTouch = !hasTouch;\r\n        _this.autoBlur = true;\r\n        _this.autoEndDistance = 5;\r\n        _this.outOfBoundaryDampingFactor = 1 / 3;\r\n        _this.specifiedIndexAsContent = 0;\r\n        _this.quadrant = 1 /* First */;\r\n        return _this;\r\n    }\r\n    OptionsConstructor.prototype.merge = function (options) {\r\n        if (!options)\r\n            return this;\r\n        for (var key in options) {\r\n            if (key === 'bounce') {\r\n                this.bounce = this.resolveBounce(options[key]);\r\n                continue;\r\n            }\r\n            this[key] = options[key];\r\n        }\r\n        return this;\r\n    };\r\n    OptionsConstructor.prototype.process = function () {\r\n        this.translateZ =\r\n            this.HWCompositing && hasPerspective ? ' translateZ(1px)' : '';\r\n        this.useTransition = this.useTransition && hasTransition;\r\n        this.preventDefault = !this.eventPassthrough && this.preventDefault;\r\n        // If you want eventPassthrough I have to lock one of the axes\r\n        this.scrollX =\r\n            this.eventPassthrough === \"horizontal\" /* Horizontal */\r\n                ? false\r\n                : this.scrollX;\r\n        this.scrollY =\r\n            this.eventPassthrough === \"vertical\" /* Vertical */ ? false : this.scrollY;\r\n        // With eventPassthrough we also need lockDirection mechanism\r\n        this.freeScroll = this.freeScroll && !this.eventPassthrough;\r\n        // force true when freeScroll is true\r\n        this.scrollX = this.freeScroll ? true : this.scrollX;\r\n        this.scrollY = this.freeScroll ? true : this.scrollY;\r\n        this.directionLockThreshold = this.eventPassthrough\r\n            ? 0\r\n            : this.directionLockThreshold;\r\n        return this;\r\n    };\r\n    OptionsConstructor.prototype.resolveBounce = function (bounceOptions) {\r\n        var DEFAULT_BOUNCE = {\r\n            top: true,\r\n            right: true,\r\n            bottom: true,\r\n            left: true,\r\n        };\r\n        var NEGATED_BOUNCE = {\r\n            top: false,\r\n            right: false,\r\n            bottom: false,\r\n            left: false,\r\n        };\r\n        var ret;\r\n        if (typeof bounceOptions === 'object') {\r\n            ret = extend(DEFAULT_BOUNCE, bounceOptions);\r\n        }\r\n        else {\r\n            ret = bounceOptions ? DEFAULT_BOUNCE : NEGATED_BOUNCE;\r\n        }\r\n        return ret;\r\n    };\r\n    return OptionsConstructor;\r\n}(CustomOptions));\n\nvar ActionsHandler = /** @class */ (function () {\r\n    function ActionsHandler(wrapper, options) {\r\n        this.wrapper = wrapper;\r\n        this.options = options;\r\n        this.hooks = new EventEmitter([\r\n            'beforeStart',\r\n            'start',\r\n            'move',\r\n            'end',\r\n            'click',\r\n        ]);\r\n        this.handleDOMEvents();\r\n    }\r\n    ActionsHandler.prototype.handleDOMEvents = function () {\r\n        var _a = this.options, bindToWrapper = _a.bindToWrapper, disableMouse = _a.disableMouse, disableTouch = _a.disableTouch, click = _a.click;\r\n        var wrapper = this.wrapper;\r\n        var target = bindToWrapper ? wrapper : window;\r\n        var wrapperEvents = [];\r\n        var targetEvents = [];\r\n        var shouldRegisterTouch = !disableTouch;\r\n        var shouldRegisterMouse = !disableMouse;\r\n        if (click) {\r\n            wrapperEvents.push({\r\n                name: 'click',\r\n                handler: this.click.bind(this),\r\n                capture: true,\r\n            });\r\n        }\r\n        if (shouldRegisterTouch) {\r\n            wrapperEvents.push({\r\n                name: 'touchstart',\r\n                handler: this.start.bind(this),\r\n            });\r\n            targetEvents.push({\r\n                name: 'touchmove',\r\n                handler: this.move.bind(this),\r\n            }, {\r\n                name: 'touchend',\r\n                handler: this.end.bind(this),\r\n            }, {\r\n                name: 'touchcancel',\r\n                handler: this.end.bind(this),\r\n            });\r\n        }\r\n        if (shouldRegisterMouse) {\r\n            wrapperEvents.push({\r\n                name: 'mousedown',\r\n                handler: this.start.bind(this),\r\n            });\r\n            targetEvents.push({\r\n                name: 'mousemove',\r\n                handler: this.move.bind(this),\r\n            }, {\r\n                name: 'mouseup',\r\n                handler: this.end.bind(this),\r\n            });\r\n        }\r\n        this.wrapperEventRegister = new EventRegister(wrapper, wrapperEvents);\r\n        this.targetEventRegister = new EventRegister(target, targetEvents);\r\n    };\r\n    ActionsHandler.prototype.beforeHandler = function (e, type) {\r\n        var _a = this.options, preventDefault = _a.preventDefault, stopPropagation = _a.stopPropagation, preventDefaultException = _a.preventDefaultException;\r\n        var preventDefaultConditions = {\r\n            start: function () {\r\n                return (preventDefault &&\r\n                    !preventDefaultExceptionFn(e.target, preventDefaultException));\r\n            },\r\n            end: function () {\r\n                return (preventDefault &&\r\n                    !preventDefaultExceptionFn(e.target, preventDefaultException));\r\n            },\r\n            move: function () {\r\n                return preventDefault;\r\n            },\r\n        };\r\n        if (preventDefaultConditions[type]()) {\r\n            e.preventDefault();\r\n        }\r\n        if (stopPropagation) {\r\n            e.stopPropagation();\r\n        }\r\n    };\r\n    ActionsHandler.prototype.setInitiated = function (type) {\r\n        if (type === void 0) { type = 0; }\r\n        this.initiated = type;\r\n    };\r\n    ActionsHandler.prototype.start = function (e) {\r\n        var _eventType = eventTypeMap[e.type];\r\n        if (this.initiated && this.initiated !== _eventType) {\r\n            return;\r\n        }\r\n        this.setInitiated(_eventType);\r\n        // if textarea or other html tags in options.tagException is manipulated\r\n        // do not make bs scroll\r\n        if (tagExceptionFn(e.target, this.options.tagException)) {\r\n            this.setInitiated();\r\n            return;\r\n        }\r\n        // only allow mouse left button\r\n        if (_eventType === 2 /* Mouse */ && e.button !== 0 /* Left */)\r\n            return;\r\n        if (this.hooks.trigger(this.hooks.eventTypes.beforeStart, e)) {\r\n            return;\r\n        }\r\n        this.beforeHandler(e, 'start');\r\n        var point = (e.touches ? e.touches[0] : e);\r\n        this.pointX = point.pageX;\r\n        this.pointY = point.pageY;\r\n        this.hooks.trigger(this.hooks.eventTypes.start, e);\r\n    };\r\n    ActionsHandler.prototype.move = function (e) {\r\n        if (eventTypeMap[e.type] !== this.initiated) {\r\n            return;\r\n        }\r\n        this.beforeHandler(e, 'move');\r\n        var point = (e.touches ? e.touches[0] : e);\r\n        var deltaX = point.pageX - this.pointX;\r\n        var deltaY = point.pageY - this.pointY;\r\n        this.pointX = point.pageX;\r\n        this.pointY = point.pageY;\r\n        if (this.hooks.trigger(this.hooks.eventTypes.move, {\r\n            deltaX: deltaX,\r\n            deltaY: deltaY,\r\n            e: e,\r\n        })) {\r\n            return;\r\n        }\r\n        // auto end when out of viewport\r\n        var scrollLeft = document.documentElement.scrollLeft ||\r\n            window.pageXOffset ||\r\n            document.body.scrollLeft;\r\n        var scrollTop = document.documentElement.scrollTop ||\r\n            window.pageYOffset ||\r\n            document.body.scrollTop;\r\n        var pX = this.pointX - scrollLeft;\r\n        var pY = this.pointY - scrollTop;\r\n        var autoEndDistance = this.options.autoEndDistance;\r\n        if (pX > document.documentElement.clientWidth - autoEndDistance ||\r\n            pY > document.documentElement.clientHeight - autoEndDistance ||\r\n            pX < autoEndDistance ||\r\n            pY < autoEndDistance) {\r\n            this.end(e);\r\n        }\r\n    };\r\n    ActionsHandler.prototype.end = function (e) {\r\n        if (eventTypeMap[e.type] !== this.initiated) {\r\n            return;\r\n        }\r\n        this.setInitiated();\r\n        this.beforeHandler(e, 'end');\r\n        this.hooks.trigger(this.hooks.eventTypes.end, e);\r\n    };\r\n    ActionsHandler.prototype.click = function (e) {\r\n        this.hooks.trigger(this.hooks.eventTypes.click, e);\r\n    };\r\n    ActionsHandler.prototype.setContent = function (content) {\r\n        if (content !== this.wrapper) {\r\n            this.wrapper = content;\r\n            this.rebindDOMEvents();\r\n        }\r\n    };\r\n    ActionsHandler.prototype.rebindDOMEvents = function () {\r\n        this.wrapperEventRegister.destroy();\r\n        this.targetEventRegister.destroy();\r\n        this.handleDOMEvents();\r\n    };\r\n    ActionsHandler.prototype.destroy = function () {\r\n        this.wrapperEventRegister.destroy();\r\n        this.targetEventRegister.destroy();\r\n        this.hooks.destroy();\r\n    };\r\n    return ActionsHandler;\r\n}());\n\nvar translaterMetaData = {\r\n    x: ['translateX', 'px'],\r\n    y: ['translateY', 'px'],\r\n};\r\nvar Translater = /** @class */ (function () {\r\n    function Translater(content) {\r\n        this.setContent(content);\r\n        this.hooks = new EventEmitter(['beforeTranslate', 'translate']);\r\n    }\r\n    Translater.prototype.getComputedPosition = function () {\r\n        var cssStyle = window.getComputedStyle(this.content, null);\r\n        var matrix = cssStyle[style.transform].split(')')[0].split(', ');\r\n        var x = +(matrix[12] || matrix[4]) || 0;\r\n        var y = +(matrix[13] || matrix[5]) || 0;\r\n        return {\r\n            x: x,\r\n            y: y,\r\n        };\r\n    };\r\n    Translater.prototype.translate = function (point) {\r\n        var transformStyle = [];\r\n        Object.keys(point).forEach(function (key) {\r\n            if (!translaterMetaData[key]) {\r\n                return;\r\n            }\r\n            var transformFnName = translaterMetaData[key][0];\r\n            if (transformFnName) {\r\n                var transformFnArgUnit = translaterMetaData[key][1];\r\n                var transformFnArg = point[key];\r\n                transformStyle.push(transformFnName + \"(\" + transformFnArg + transformFnArgUnit + \")\");\r\n            }\r\n        });\r\n        this.hooks.trigger(this.hooks.eventTypes.beforeTranslate, transformStyle, point);\r\n        this.style[style.transform] = transformStyle.join(' ');\r\n        this.hooks.trigger(this.hooks.eventTypes.translate, point);\r\n    };\r\n    Translater.prototype.setContent = function (content) {\r\n        if (this.content !== content) {\r\n            this.content = content;\r\n            this.style = content.style;\r\n        }\r\n    };\r\n    Translater.prototype.destroy = function () {\r\n        this.hooks.destroy();\r\n    };\r\n    return Translater;\r\n}());\n\nvar Base = /** @class */ (function () {\r\n    function Base(content, translater, options) {\r\n        this.translater = translater;\r\n        this.options = options;\r\n        this.timer = 0;\r\n        this.hooks = new EventEmitter([\r\n            'move',\r\n            'end',\r\n            'beforeForceStop',\r\n            'forceStop',\r\n            'callStop',\r\n            'time',\r\n            'timeFunction',\r\n        ]);\r\n        this.setContent(content);\r\n    }\r\n    Base.prototype.translate = function (endPoint) {\r\n        this.translater.translate(endPoint);\r\n    };\r\n    Base.prototype.setPending = function (pending) {\r\n        this.pending = pending;\r\n    };\r\n    Base.prototype.setForceStopped = function (forceStopped) {\r\n        this.forceStopped = forceStopped;\r\n    };\r\n    Base.prototype.setCallStop = function (called) {\r\n        this.callStopWhenPending = called;\r\n    };\r\n    Base.prototype.setContent = function (content) {\r\n        if (this.content !== content) {\r\n            this.content = content;\r\n            this.style = content.style;\r\n            this.stop();\r\n        }\r\n    };\r\n    Base.prototype.clearTimer = function () {\r\n        if (this.timer) {\r\n            cancelAnimationFrame(this.timer);\r\n            this.timer = 0;\r\n        }\r\n    };\r\n    Base.prototype.destroy = function () {\r\n        this.hooks.destroy();\r\n        cancelAnimationFrame(this.timer);\r\n    };\r\n    return Base;\r\n}());\n\n// iOS 13.6 - 14.x, window.getComputedStyle sometimes will get wrong transform value\r\n// when bs use transition mode\r\n// eg: translateY -100px -> -200px, when the last frame which is about to scroll to -200px\r\n// window.getComputedStyle(this.content) will calculate transformY to be -100px(startPoint)\r\n// it is weird\r\n// so we should validate position caculated by 'window.getComputedStyle'\r\nvar isValidPostion = function (startPoint, endPoint, currentPos, prePos) {\r\n    var computeDirection = function (endValue, startValue) {\r\n        var delta = endValue - startValue;\r\n        var direction = delta > 0\r\n            ? -1 /* Negative */\r\n            : delta < 0\r\n                ? 1 /* Positive */\r\n                : 0 /* Default */;\r\n        return direction;\r\n    };\r\n    var directionX = computeDirection(endPoint.x, startPoint.x);\r\n    var directionY = computeDirection(endPoint.y, startPoint.y);\r\n    var deltaX = currentPos.x - prePos.x;\r\n    var deltaY = currentPos.y - prePos.y;\r\n    return directionX * deltaX <= 0 && directionY * deltaY <= 0;\r\n};\n\nvar Transition = /** @class */ (function (_super) {\r\n    __extends(Transition, _super);\r\n    function Transition() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    Transition.prototype.startProbe = function (startPoint, endPoint) {\r\n        var _this = this;\r\n        var prePos = startPoint;\r\n        var probe = function () {\r\n            var pos = _this.translater.getComputedPosition();\r\n            if (isValidPostion(startPoint, endPoint, pos, prePos)) {\r\n                _this.hooks.trigger(_this.hooks.eventTypes.move, pos);\r\n            }\r\n            // call bs.stop() should not dispatch end hook again.\r\n            // forceStop hook will do this.\r\n            /* istanbul ignore if  */\r\n            if (!_this.pending) {\r\n                if (_this.callStopWhenPending) {\r\n                    _this.callStopWhenPending = false;\r\n                }\r\n                else {\r\n                    // transition ends should dispatch end hook.\r\n                    _this.hooks.trigger(_this.hooks.eventTypes.end, pos);\r\n                }\r\n            }\r\n            prePos = pos;\r\n            if (_this.pending) {\r\n                _this.timer = requestAnimationFrame(probe);\r\n            }\r\n        };\r\n        // when manually call bs.stop(), then bs.scrollTo()\r\n        // we should reset callStopWhenPending to dispatch end hook\r\n        if (this.callStopWhenPending) {\r\n            this.setCallStop(false);\r\n        }\r\n        cancelAnimationFrame(this.timer);\r\n        probe();\r\n    };\r\n    Transition.prototype.transitionTime = function (time) {\r\n        if (time === void 0) { time = 0; }\r\n        this.style[style.transitionDuration] = time + 'ms';\r\n        this.hooks.trigger(this.hooks.eventTypes.time, time);\r\n    };\r\n    Transition.prototype.transitionTimingFunction = function (easing) {\r\n        this.style[style.transitionTimingFunction] = easing;\r\n        this.hooks.trigger(this.hooks.eventTypes.timeFunction, easing);\r\n    };\r\n    Transition.prototype.transitionProperty = function () {\r\n        this.style[style.transitionProperty] = style.transform;\r\n    };\r\n    Transition.prototype.move = function (startPoint, endPoint, time, easingFn) {\r\n        this.setPending(time > 0);\r\n        this.transitionTimingFunction(easingFn);\r\n        this.transitionProperty();\r\n        this.transitionTime(time);\r\n        this.translate(endPoint);\r\n        var isRealtimeProbeType = this.options.probeType === 3 /* Realtime */;\r\n        if (time && isRealtimeProbeType) {\r\n            this.startProbe(startPoint, endPoint);\r\n        }\r\n        // if we change content's transformY in a tick\r\n        // such as: 0 -> 50px -> 0\r\n        // transitionend will not be triggered\r\n        // so we forceupdate by reflow\r\n        if (!time) {\r\n            this._reflow = this.content.offsetHeight;\r\n            if (isRealtimeProbeType) {\r\n                this.hooks.trigger(this.hooks.eventTypes.move, endPoint);\r\n            }\r\n            this.hooks.trigger(this.hooks.eventTypes.end, endPoint);\r\n        }\r\n    };\r\n    Transition.prototype.doStop = function () {\r\n        var pending = this.pending;\r\n        this.setForceStopped(false);\r\n        this.setCallStop(false);\r\n        // still in transition\r\n        if (pending) {\r\n            this.setPending(false);\r\n            cancelAnimationFrame(this.timer);\r\n            var _a = this.translater.getComputedPosition(), x = _a.x, y = _a.y;\r\n            this.transitionTime();\r\n            this.translate({ x: x, y: y });\r\n            this.setForceStopped(true);\r\n            this.setCallStop(true);\r\n            this.hooks.trigger(this.hooks.eventTypes.forceStop, { x: x, y: y });\r\n        }\r\n        return pending;\r\n    };\r\n    Transition.prototype.stop = function () {\r\n        var stopFromTransition = this.doStop();\r\n        if (stopFromTransition) {\r\n            this.hooks.trigger(this.hooks.eventTypes.callStop);\r\n        }\r\n    };\r\n    return Transition;\r\n}(Base));\n\nvar Animation = /** @class */ (function (_super) {\r\n    __extends(Animation, _super);\r\n    function Animation() {\r\n        return _super !== null && _super.apply(this, arguments) || this;\r\n    }\r\n    Animation.prototype.move = function (startPoint, endPoint, time, easingFn) {\r\n        // time is 0\r\n        if (!time) {\r\n            this.translate(endPoint);\r\n            if (this.options.probeType === 3 /* Realtime */) {\r\n                this.hooks.trigger(this.hooks.eventTypes.move, endPoint);\r\n            }\r\n            this.hooks.trigger(this.hooks.eventTypes.end, endPoint);\r\n            return;\r\n        }\r\n        this.animate(startPoint, endPoint, time, easingFn);\r\n    };\r\n    Animation.prototype.animate = function (startPoint, endPoint, duration, easingFn) {\r\n        var _this = this;\r\n        var startTime = getNow();\r\n        var destTime = startTime + duration;\r\n        var isRealtimeProbeType = this.options.probeType === 3 /* Realtime */;\r\n        var step = function () {\r\n            var now = getNow();\r\n            // js animation end\r\n            if (now >= destTime) {\r\n                _this.translate(endPoint);\r\n                if (isRealtimeProbeType) {\r\n                    _this.hooks.trigger(_this.hooks.eventTypes.move, endPoint);\r\n                }\r\n                _this.hooks.trigger(_this.hooks.eventTypes.end, endPoint);\r\n                return;\r\n            }\r\n            now = (now - startTime) / duration;\r\n            var easing = easingFn(now);\r\n            var newPoint = {};\r\n            Object.keys(endPoint).forEach(function (key) {\r\n                var startValue = startPoint[key];\r\n                var endValue = endPoint[key];\r\n                newPoint[key] = (endValue - startValue) * easing + startValue;\r\n            });\r\n            _this.translate(newPoint);\r\n            if (isRealtimeProbeType) {\r\n                _this.hooks.trigger(_this.hooks.eventTypes.move, newPoint);\r\n            }\r\n            if (_this.pending) {\r\n                _this.timer = requestAnimationFrame(step);\r\n            }\r\n            // call bs.stop() should not dispatch end hook again.\r\n            // forceStop hook will do this.\r\n            /* istanbul ignore if  */\r\n            if (!_this.pending) {\r\n                if (_this.callStopWhenPending) {\r\n                    _this.callStopWhenPending = false;\r\n                }\r\n                else {\r\n                    // raf ends should dispatch end hook.\r\n                    _this.hooks.trigger(_this.hooks.eventTypes.end, endPoint);\r\n                }\r\n            }\r\n        };\r\n        this.setPending(true);\r\n        // when manually call bs.stop(), then bs.scrollTo()\r\n        // we should reset callStopWhenPending to dispatch end hook\r\n        if (this.callStopWhenPending) {\r\n            this.setCallStop(false);\r\n        }\r\n        cancelAnimationFrame(this.timer);\r\n        step();\r\n    };\r\n    Animation.prototype.doStop = function () {\r\n        var pending = this.pending;\r\n        this.setForceStopped(false);\r\n        this.setCallStop(false);\r\n        // still in requestFrameAnimation\r\n        if (pending) {\r\n            this.setPending(false);\r\n            cancelAnimationFrame(this.timer);\r\n            var pos = this.translater.getComputedPosition();\r\n            this.setForceStopped(true);\r\n            this.setCallStop(true);\r\n            this.hooks.trigger(this.hooks.eventTypes.forceStop, pos);\r\n        }\r\n        return pending;\r\n    };\r\n    Animation.prototype.stop = function () {\r\n        var stopFromAnimation = this.doStop();\r\n        if (stopFromAnimation) {\r\n            this.hooks.trigger(this.hooks.eventTypes.callStop);\r\n        }\r\n    };\r\n    return Animation;\r\n}(Base));\n\nfunction createAnimater(element, translater, options) {\r\n    var useTransition = options.useTransition;\r\n    var animaterOptions = {};\r\n    Object.defineProperty(animaterOptions, 'probeType', {\r\n        enumerable: true,\r\n        configurable: false,\r\n        get: function () {\r\n            return options.probeType;\r\n        },\r\n    });\r\n    if (useTransition) {\r\n        return new Transition(element, translater, animaterOptions);\r\n    }\r\n    else {\r\n        return new Animation(element, translater, animaterOptions);\r\n    }\r\n}\n\nvar Behavior = /** @class */ (function () {\r\n    function Behavior(wrapper, content, options) {\r\n        this.wrapper = wrapper;\r\n        this.options = options;\r\n        this.hooks = new EventEmitter([\r\n            'beforeComputeBoundary',\r\n            'computeBoundary',\r\n            'momentum',\r\n            'end',\r\n            'ignoreHasScroll'\r\n        ]);\r\n        this.refresh(content);\r\n    }\r\n    Behavior.prototype.start = function () {\r\n        this.dist = 0;\r\n        this.setMovingDirection(0 /* Default */);\r\n        this.setDirection(0 /* Default */);\r\n    };\r\n    Behavior.prototype.move = function (delta) {\r\n        delta = this.hasScroll ? delta : 0;\r\n        this.setMovingDirection(delta);\r\n        return this.performDampingAlgorithm(delta, this.options.outOfBoundaryDampingFactor);\r\n    };\r\n    Behavior.prototype.setMovingDirection = function (delta) {\r\n        this.movingDirection =\r\n            delta > 0\r\n                ? -1 /* Negative */\r\n                : delta < 0\r\n                    ? 1 /* Positive */\r\n                    : 0 /* Default */;\r\n    };\r\n    Behavior.prototype.setDirection = function (delta) {\r\n        this.direction =\r\n            delta > 0\r\n                ? -1 /* Negative */\r\n                : delta < 0\r\n                    ? 1 /* Positive */\r\n                    : 0 /* Default */;\r\n    };\r\n    Behavior.prototype.performDampingAlgorithm = function (delta, dampingFactor) {\r\n        var newPos = this.currentPos + delta;\r\n        // Slow down or stop if outside of the boundaries\r\n        if (newPos > this.minScrollPos || newPos < this.maxScrollPos) {\r\n            if ((newPos > this.minScrollPos && this.options.bounces[0]) ||\r\n                (newPos < this.maxScrollPos && this.options.bounces[1])) {\r\n                newPos = this.currentPos + delta * dampingFactor;\r\n            }\r\n            else {\r\n                newPos =\r\n                    newPos > this.minScrollPos ? this.minScrollPos : this.maxScrollPos;\r\n            }\r\n        }\r\n        return newPos;\r\n    };\r\n    Behavior.prototype.end = function (duration) {\r\n        var momentumInfo = {\r\n            duration: 0\r\n        };\r\n        var absDist = Math.abs(this.currentPos - this.startPos);\r\n        // start momentum animation if needed\r\n        if (this.options.momentum &&\r\n            duration < this.options.momentumLimitTime &&\r\n            absDist > this.options.momentumLimitDistance) {\r\n            var wrapperSize = (this.direction === -1 /* Negative */ && this.options.bounces[0]) ||\r\n                (this.direction === 1 /* Positive */ && this.options.bounces[1])\r\n                ? this.wrapperSize\r\n                : 0;\r\n            momentumInfo = this.hasScroll\r\n                ? this.momentum(this.currentPos, this.startPos, duration, this.maxScrollPos, this.minScrollPos, wrapperSize, this.options)\r\n                : { destination: this.currentPos, duration: 0 };\r\n        }\r\n        else {\r\n            this.hooks.trigger(this.hooks.eventTypes.end, momentumInfo);\r\n        }\r\n        return momentumInfo;\r\n    };\r\n    Behavior.prototype.momentum = function (current, start, time, lowerMargin, upperMargin, wrapperSize, options) {\r\n        if (options === void 0) { options = this.options; }\r\n        var distance = current - start;\r\n        var speed = Math.abs(distance) / time;\r\n        var deceleration = options.deceleration, swipeBounceTime = options.swipeBounceTime, swipeTime = options.swipeTime;\r\n        var duration = Math.min(swipeTime, (speed * 2) / deceleration);\r\n        var momentumData = {\r\n            destination: current + ((speed * speed) / deceleration) * (distance < 0 ? -1 : 1),\r\n            duration: duration,\r\n            rate: 15\r\n        };\r\n        this.hooks.trigger(this.hooks.eventTypes.momentum, momentumData, distance);\r\n        if (momentumData.destination < lowerMargin) {\r\n            momentumData.destination = wrapperSize\r\n                ? Math.max(lowerMargin - wrapperSize / 4, lowerMargin - (wrapperSize / momentumData.rate) * speed)\r\n                : lowerMargin;\r\n            momentumData.duration = swipeBounceTime;\r\n        }\r\n        else if (momentumData.destination > upperMargin) {\r\n            momentumData.destination = wrapperSize\r\n                ? Math.min(upperMargin + wrapperSize / 4, upperMargin + (wrapperSize / momentumData.rate) * speed)\r\n                : upperMargin;\r\n            momentumData.duration = swipeBounceTime;\r\n        }\r\n        momentumData.destination = Math.round(momentumData.destination);\r\n        return momentumData;\r\n    };\r\n    Behavior.prototype.updateDirection = function () {\r\n        var absDist = this.currentPos - this.absStartPos;\r\n        this.setDirection(absDist);\r\n    };\r\n    Behavior.prototype.refresh = function (content) {\r\n        var _a = this.options.rect, size = _a.size, position = _a.position;\r\n        var isWrapperStatic = window.getComputedStyle(this.wrapper, null).position === 'static';\r\n        // Force reflow\r\n        var wrapperRect = getRect(this.wrapper);\r\n        // use client is more fair than offset\r\n        this.wrapperSize = this.wrapper[size === 'width' ? 'clientWidth' : 'clientHeight'];\r\n        this.setContent(content);\r\n        var contentRect = getRect(this.content);\r\n        this.contentSize = contentRect[size];\r\n        this.relativeOffset = contentRect[position];\r\n        /* istanbul ignore if  */\r\n        if (isWrapperStatic) {\r\n            this.relativeOffset -= wrapperRect[position];\r\n        }\r\n        this.computeBoundary();\r\n        this.setDirection(0 /* Default */);\r\n    };\r\n    Behavior.prototype.setContent = function (content) {\r\n        if (content !== this.content) {\r\n            this.content = content;\r\n            this.resetState();\r\n        }\r\n    };\r\n    Behavior.prototype.resetState = function () {\r\n        this.currentPos = 0;\r\n        this.startPos = 0;\r\n        this.dist = 0;\r\n        this.setDirection(0 /* Default */);\r\n        this.setMovingDirection(0 /* Default */);\r\n        this.resetStartPos();\r\n    };\r\n    Behavior.prototype.computeBoundary = function () {\r\n        this.hooks.trigger(this.hooks.eventTypes.beforeComputeBoundary);\r\n        var boundary = {\r\n            minScrollPos: 0,\r\n            maxScrollPos: this.wrapperSize - this.contentSize\r\n        };\r\n        if (boundary.maxScrollPos < 0) {\r\n            boundary.maxScrollPos -= this.relativeOffset;\r\n            if (this.options.specifiedIndexAsContent === 0) {\r\n                boundary.minScrollPos = -this.relativeOffset;\r\n            }\r\n        }\r\n        this.hooks.trigger(this.hooks.eventTypes.computeBoundary, boundary);\r\n        this.minScrollPos = boundary.minScrollPos;\r\n        this.maxScrollPos = boundary.maxScrollPos;\r\n        this.hasScroll =\r\n            this.options.scrollable && this.maxScrollPos < this.minScrollPos;\r\n        if (!this.hasScroll && this.minScrollPos < this.maxScrollPos) {\r\n            this.maxScrollPos = this.minScrollPos;\r\n            this.contentSize = this.wrapperSize;\r\n        }\r\n    };\r\n    Behavior.prototype.updatePosition = function (pos) {\r\n        this.currentPos = pos;\r\n    };\r\n    Behavior.prototype.getCurrentPos = function () {\r\n        return this.currentPos;\r\n    };\r\n    Behavior.prototype.checkInBoundary = function () {\r\n        var position = this.adjustPosition(this.currentPos);\r\n        var inBoundary = position === this.getCurrentPos();\r\n        return {\r\n            position: position,\r\n            inBoundary: inBoundary\r\n        };\r\n    };\r\n    // adjust position when out of boundary\r\n    Behavior.prototype.adjustPosition = function (pos) {\r\n        if (!this.hasScroll &&\r\n            !this.hooks.trigger(this.hooks.eventTypes.ignoreHasScroll)) {\r\n            pos = this.minScrollPos;\r\n        }\r\n        else if (pos > this.minScrollPos) {\r\n            pos = this.minScrollPos;\r\n        }\r\n        else if (pos < this.maxScrollPos) {\r\n            pos = this.maxScrollPos;\r\n        }\r\n        return pos;\r\n    };\r\n    Behavior.prototype.updateStartPos = function () {\r\n        this.startPos = this.currentPos;\r\n    };\r\n    Behavior.prototype.updateAbsStartPos = function () {\r\n        this.absStartPos = this.currentPos;\r\n    };\r\n    Behavior.prototype.resetStartPos = function () {\r\n        this.updateStartPos();\r\n        this.updateAbsStartPos();\r\n    };\r\n    Behavior.prototype.getAbsDist = function (delta) {\r\n        this.dist += delta;\r\n        return Math.abs(this.dist);\r\n    };\r\n    Behavior.prototype.destroy = function () {\r\n        this.hooks.destroy();\r\n    };\r\n    return Behavior;\r\n}());\n\nvar _a, _b, _c, _d;\r\nvar PassthroughHandlers = (_a = {},\r\n    _a[\"yes\" /* Yes */] = function (e) {\r\n        return true;\r\n    },\r\n    _a[\"no\" /* No */] = function (e) {\r\n        maybePrevent(e);\r\n        return false;\r\n    },\r\n    _a);\r\nvar DirectionMap = (_b = {},\r\n    _b[\"horizontal\" /* Horizontal */] = (_c = {},\r\n        _c[\"yes\" /* Yes */] = \"horizontal\" /* Horizontal */,\r\n        _c[\"no\" /* No */] = \"vertical\" /* Vertical */,\r\n        _c),\r\n    _b[\"vertical\" /* Vertical */] = (_d = {},\r\n        _d[\"yes\" /* Yes */] = \"vertical\" /* Vertical */,\r\n        _d[\"no\" /* No */] = \"horizontal\" /* Horizontal */,\r\n        _d),\r\n    _b);\r\nvar DirectionLockAction = /** @class */ (function () {\r\n    function DirectionLockAction(directionLockThreshold, freeScroll, eventPassthrough) {\r\n        this.directionLockThreshold = directionLockThreshold;\r\n        this.freeScroll = freeScroll;\r\n        this.eventPassthrough = eventPassthrough;\r\n        this.reset();\r\n    }\r\n    DirectionLockAction.prototype.reset = function () {\r\n        this.directionLocked = \"\" /* Default */;\r\n    };\r\n    DirectionLockAction.prototype.checkMovingDirection = function (absDistX, absDistY, e) {\r\n        this.computeDirectionLock(absDistX, absDistY);\r\n        return this.handleEventPassthrough(e);\r\n    };\r\n    DirectionLockAction.prototype.adjustDelta = function (deltaX, deltaY) {\r\n        if (this.directionLocked === \"horizontal\" /* Horizontal */) {\r\n            deltaY = 0;\r\n        }\r\n        else if (this.directionLocked === \"vertical\" /* Vertical */) {\r\n            deltaX = 0;\r\n        }\r\n        return {\r\n            deltaX: deltaX,\r\n            deltaY: deltaY,\r\n        };\r\n    };\r\n    DirectionLockAction.prototype.computeDirectionLock = function (absDistX, absDistY) {\r\n        // If you are scrolling in one direction, lock it\r\n        if (this.directionLocked === \"\" /* Default */ && !this.freeScroll) {\r\n            if (absDistX > absDistY + this.directionLockThreshold) {\r\n                this.directionLocked = \"horizontal\" /* Horizontal */; // lock horizontally\r\n            }\r\n            else if (absDistY >= absDistX + this.directionLockThreshold) {\r\n                this.directionLocked = \"vertical\" /* Vertical */; // lock vertically\r\n            }\r\n            else {\r\n                this.directionLocked = \"none\" /* None */; // no lock\r\n            }\r\n        }\r\n    };\r\n    DirectionLockAction.prototype.handleEventPassthrough = function (e) {\r\n        var handleMap = DirectionMap[this.directionLocked];\r\n        if (handleMap) {\r\n            if (this.eventPassthrough === handleMap[\"yes\" /* Yes */]) {\r\n                return PassthroughHandlers[\"yes\" /* Yes */](e);\r\n            }\r\n            else if (this.eventPassthrough === handleMap[\"no\" /* No */]) {\r\n                return PassthroughHandlers[\"no\" /* No */](e);\r\n            }\r\n        }\r\n        return false;\r\n    };\r\n    return DirectionLockAction;\r\n}());\n\nvar applyQuadrantTransformation = function (deltaX, deltaY, quadrant) {\r\n    if (quadrant === 2 /* Second */) {\r\n        return [deltaY, -deltaX];\r\n    }\r\n    else if (quadrant === 3 /* Third */) {\r\n        return [-deltaX, -deltaY];\r\n    }\r\n    else if (quadrant === 4 /* Forth */) {\r\n        return [-deltaY, deltaX];\r\n    }\r\n    else {\r\n        return [deltaX, deltaY];\r\n    }\r\n};\r\nvar ScrollerActions = /** @class */ (function () {\r\n    function ScrollerActions(scrollBehaviorX, scrollBehaviorY, actionsHandler, animater, options) {\r\n        this.hooks = new EventEmitter([\r\n            'start',\r\n            'beforeMove',\r\n            'scrollStart',\r\n            'scroll',\r\n            'beforeEnd',\r\n            'end',\r\n            'scrollEnd',\r\n            'contentNotMoved',\r\n            'detectMovingDirection',\r\n            'coordinateTransformation',\r\n        ]);\r\n        this.scrollBehaviorX = scrollBehaviorX;\r\n        this.scrollBehaviorY = scrollBehaviorY;\r\n        this.actionsHandler = actionsHandler;\r\n        this.animater = animater;\r\n        this.options = options;\r\n        this.directionLockAction = new DirectionLockAction(options.directionLockThreshold, options.freeScroll, options.eventPassthrough);\r\n        this.enabled = true;\r\n        this.bindActionsHandler();\r\n    }\r\n    ScrollerActions.prototype.bindActionsHandler = function () {\r\n        var _this = this;\r\n        // [mouse|touch]start event\r\n        this.actionsHandler.hooks.on(this.actionsHandler.hooks.eventTypes.start, function (e) {\r\n            if (!_this.enabled)\r\n                return true;\r\n            return _this.handleStart(e);\r\n        });\r\n        // [mouse|touch]move event\r\n        this.actionsHandler.hooks.on(this.actionsHandler.hooks.eventTypes.move, function (_a) {\r\n            var deltaX = _a.deltaX, deltaY = _a.deltaY, e = _a.e;\r\n            if (!_this.enabled)\r\n                return true;\r\n            var _b = applyQuadrantTransformation(deltaX, deltaY, _this.options.quadrant), transformateDeltaX = _b[0], transformateDeltaY = _b[1];\r\n            var transformateDeltaData = {\r\n                deltaX: transformateDeltaX,\r\n                deltaY: transformateDeltaY,\r\n            };\r\n            _this.hooks.trigger(_this.hooks.eventTypes.coordinateTransformation, transformateDeltaData);\r\n            return _this.handleMove(transformateDeltaData.deltaX, transformateDeltaData.deltaY, e);\r\n        });\r\n        // [mouse|touch]end event\r\n        this.actionsHandler.hooks.on(this.actionsHandler.hooks.eventTypes.end, function (e) {\r\n            if (!_this.enabled)\r\n                return true;\r\n            return _this.handleEnd(e);\r\n        });\r\n        // click\r\n        this.actionsHandler.hooks.on(this.actionsHandler.hooks.eventTypes.click, function (e) {\r\n            // handle native click event\r\n            if (_this.enabled && !e._constructed) {\r\n                _this.handleClick(e);\r\n            }\r\n        });\r\n    };\r\n    ScrollerActions.prototype.handleStart = function (e) {\r\n        var timestamp = getNow();\r\n        this.fingerMoved = false;\r\n        this.contentMoved = false;\r\n        this.startTime = timestamp;\r\n        this.directionLockAction.reset();\r\n        this.scrollBehaviorX.start();\r\n        this.scrollBehaviorY.start();\r\n        // force stopping last transition or animation\r\n        this.animater.doStop();\r\n        this.scrollBehaviorX.resetStartPos();\r\n        this.scrollBehaviorY.resetStartPos();\r\n        this.hooks.trigger(this.hooks.eventTypes.start, e);\r\n    };\r\n    ScrollerActions.prototype.handleMove = function (deltaX, deltaY, e) {\r\n        if (this.hooks.trigger(this.hooks.eventTypes.beforeMove, e)) {\r\n            return;\r\n        }\r\n        var absDistX = this.scrollBehaviorX.getAbsDist(deltaX);\r\n        var absDistY = this.scrollBehaviorY.getAbsDist(deltaY);\r\n        var timestamp = getNow();\r\n        // We need to move at least momentumLimitDistance pixels\r\n        // for the scrolling to initiate\r\n        if (this.checkMomentum(absDistX, absDistY, timestamp)) {\r\n            return true;\r\n        }\r\n        if (this.directionLockAction.checkMovingDirection(absDistX, absDistY, e)) {\r\n            this.actionsHandler.setInitiated();\r\n            return true;\r\n        }\r\n        var delta = this.directionLockAction.adjustDelta(deltaX, deltaY);\r\n        var prevX = this.scrollBehaviorX.getCurrentPos();\r\n        var newX = this.scrollBehaviorX.move(delta.deltaX);\r\n        var prevY = this.scrollBehaviorY.getCurrentPos();\r\n        var newY = this.scrollBehaviorY.move(delta.deltaY);\r\n        if (this.hooks.trigger(this.hooks.eventTypes.detectMovingDirection)) {\r\n            return;\r\n        }\r\n        if (!this.fingerMoved) {\r\n            this.fingerMoved = true;\r\n        }\r\n        var positionChanged = newX !== prevX || newY !== prevY;\r\n        if (!this.contentMoved && !positionChanged) {\r\n            this.hooks.trigger(this.hooks.eventTypes.contentNotMoved);\r\n        }\r\n        if (!this.contentMoved && positionChanged) {\r\n            this.contentMoved = true;\r\n            this.hooks.trigger(this.hooks.eventTypes.scrollStart);\r\n        }\r\n        if (this.contentMoved && positionChanged) {\r\n            this.animater.translate({\r\n                x: newX,\r\n                y: newY,\r\n            });\r\n            this.dispatchScroll(timestamp);\r\n        }\r\n    };\r\n    ScrollerActions.prototype.dispatchScroll = function (timestamp) {\r\n        // dispatch scroll in interval time\r\n        if (timestamp - this.startTime > this.options.momentumLimitTime) {\r\n            // refresh time and starting position to initiate a momentum\r\n            this.startTime = timestamp;\r\n            this.scrollBehaviorX.updateStartPos();\r\n            this.scrollBehaviorY.updateStartPos();\r\n            if (this.options.probeType === 1 /* Throttle */) {\r\n                this.hooks.trigger(this.hooks.eventTypes.scroll, this.getCurrentPos());\r\n            }\r\n        }\r\n        // dispatch scroll all the time\r\n        if (this.options.probeType > 1 /* Throttle */) {\r\n            this.hooks.trigger(this.hooks.eventTypes.scroll, this.getCurrentPos());\r\n        }\r\n    };\r\n    ScrollerActions.prototype.checkMomentum = function (absDistX, absDistY, timestamp) {\r\n        return (timestamp - this.endTime > this.options.momentumLimitTime &&\r\n            absDistY < this.options.momentumLimitDistance &&\r\n            absDistX < this.options.momentumLimitDistance);\r\n    };\r\n    ScrollerActions.prototype.handleEnd = function (e) {\r\n        if (this.hooks.trigger(this.hooks.eventTypes.beforeEnd, e)) {\r\n            return;\r\n        }\r\n        var currentPos = this.getCurrentPos();\r\n        this.scrollBehaviorX.updateDirection();\r\n        this.scrollBehaviorY.updateDirection();\r\n        if (this.hooks.trigger(this.hooks.eventTypes.end, e, currentPos)) {\r\n            return true;\r\n        }\r\n        currentPos = this.ensureIntegerPos(currentPos);\r\n        this.animater.translate(currentPos);\r\n        this.endTime = getNow();\r\n        var duration = this.endTime - this.startTime;\r\n        this.hooks.trigger(this.hooks.eventTypes.scrollEnd, currentPos, duration);\r\n    };\r\n    ScrollerActions.prototype.ensureIntegerPos = function (currentPos) {\r\n        this.ensuringInteger = true;\r\n        var x = currentPos.x, y = currentPos.y;\r\n        var _a = this.scrollBehaviorX, minScrollPosX = _a.minScrollPos, maxScrollPosX = _a.maxScrollPos;\r\n        var _b = this.scrollBehaviorY, minScrollPosY = _b.minScrollPos, maxScrollPosY = _b.maxScrollPos;\r\n        x = x > 0 ? Math.ceil(x) : Math.floor(x);\r\n        y = y > 0 ? Math.ceil(y) : Math.floor(y);\r\n        x = between(x, maxScrollPosX, minScrollPosX);\r\n        y = between(y, maxScrollPosY, minScrollPosY);\r\n        return { x: x, y: y };\r\n    };\r\n    ScrollerActions.prototype.handleClick = function (e) {\r\n        if (!preventDefaultExceptionFn(e.target, this.options.preventDefaultException)) {\r\n            maybePrevent(e);\r\n            e.stopPropagation();\r\n        }\r\n    };\r\n    ScrollerActions.prototype.getCurrentPos = function () {\r\n        return {\r\n            x: this.scrollBehaviorX.getCurrentPos(),\r\n            y: this.scrollBehaviorY.getCurrentPos(),\r\n        };\r\n    };\r\n    ScrollerActions.prototype.refresh = function () {\r\n        this.endTime = 0;\r\n    };\r\n    ScrollerActions.prototype.destroy = function () {\r\n        this.hooks.destroy();\r\n    };\r\n    return ScrollerActions;\r\n}());\n\nfunction createActionsHandlerOptions(bsOptions) {\r\n    var options = [\r\n        'click',\r\n        'bindToWrapper',\r\n        'disableMouse',\r\n        'disableTouch',\r\n        'preventDefault',\r\n        'stopPropagation',\r\n        'tagException',\r\n        'preventDefaultException',\r\n        'autoEndDistance',\r\n    ].reduce(function (prev, cur) {\r\n        prev[cur] = bsOptions[cur];\r\n        return prev;\r\n    }, {});\r\n    return options;\r\n}\r\nfunction createBehaviorOptions(bsOptions, extraProp, bounces, rect) {\r\n    var options = [\r\n        'momentum',\r\n        'momentumLimitTime',\r\n        'momentumLimitDistance',\r\n        'deceleration',\r\n        'swipeBounceTime',\r\n        'swipeTime',\r\n        'outOfBoundaryDampingFactor',\r\n        'specifiedIndexAsContent',\r\n    ].reduce(function (prev, cur) {\r\n        prev[cur] = bsOptions[cur];\r\n        return prev;\r\n    }, {});\r\n    // add extra property\r\n    options.scrollable = !!bsOptions[extraProp];\r\n    options.bounces = bounces;\r\n    options.rect = rect;\r\n    return options;\r\n}\n\nfunction bubbling(source, target, events) {\r\n    events.forEach(function (event) {\r\n        var sourceEvent;\r\n        var targetEvent;\r\n        if (typeof event === 'string') {\r\n            sourceEvent = targetEvent = event;\r\n        }\r\n        else {\r\n            sourceEvent = event.source;\r\n            targetEvent = event.target;\r\n        }\r\n        source.on(sourceEvent, function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n            return target.trigger.apply(target, __spreadArrays([targetEvent], args));\r\n        });\r\n    });\r\n}\n\nfunction isSamePoint(startPoint, endPoint) {\r\n    // keys of startPoint and endPoint should be equal\r\n    var keys = Object.keys(startPoint);\r\n    for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\r\n        var key = keys_1[_i];\r\n        if (startPoint[key] !== endPoint[key])\r\n            return false;\r\n    }\r\n    return true;\r\n}\n\nvar MIN_SCROLL_DISTANCE = 1;\r\nvar Scroller = /** @class */ (function () {\r\n    function Scroller(wrapper, content, options) {\r\n        this.wrapper = wrapper;\r\n        this.content = content;\r\n        this.resizeTimeout = 0;\r\n        this.hooks = new EventEmitter([\r\n            'beforeStart',\r\n            'beforeMove',\r\n            'beforeScrollStart',\r\n            'scrollStart',\r\n            'scroll',\r\n            'beforeEnd',\r\n            'scrollEnd',\r\n            'resize',\r\n            'touchEnd',\r\n            'end',\r\n            'flick',\r\n            'scrollCancel',\r\n            'momentum',\r\n            'scrollTo',\r\n            'minDistanceScroll',\r\n            'scrollToElement',\r\n            'beforeRefresh',\r\n        ]);\r\n        this.options = options;\r\n        var _a = this.options.bounce, left = _a.left, right = _a.right, top = _a.top, bottom = _a.bottom;\r\n        // direction X\r\n        this.scrollBehaviorX = new Behavior(wrapper, content, createBehaviorOptions(options, 'scrollX', [left, right], {\r\n            size: 'width',\r\n            position: 'left',\r\n        }));\r\n        // direction Y\r\n        this.scrollBehaviorY = new Behavior(wrapper, content, createBehaviorOptions(options, 'scrollY', [top, bottom], {\r\n            size: 'height',\r\n            position: 'top',\r\n        }));\r\n        this.translater = new Translater(this.content);\r\n        this.animater = createAnimater(this.content, this.translater, this.options);\r\n        this.actionsHandler = new ActionsHandler(this.options.bindToTarget ? this.content : wrapper, createActionsHandlerOptions(this.options));\r\n        this.actions = new ScrollerActions(this.scrollBehaviorX, this.scrollBehaviorY, this.actionsHandler, this.animater, this.options);\r\n        var resizeHandler = this.resize.bind(this);\r\n        this.resizeRegister = new EventRegister(window, [\r\n            {\r\n                name: 'orientationchange',\r\n                handler: resizeHandler,\r\n            },\r\n            {\r\n                name: 'resize',\r\n                handler: resizeHandler,\r\n            },\r\n        ]);\r\n        this.registerTransitionEnd();\r\n        this.init();\r\n    }\r\n    Scroller.prototype.init = function () {\r\n        var _this = this;\r\n        this.bindTranslater();\r\n        this.bindAnimater();\r\n        this.bindActions();\r\n        // enable pointer events when scrolling ends\r\n        this.hooks.on(this.hooks.eventTypes.scrollEnd, function () {\r\n            _this.togglePointerEvents(true);\r\n        });\r\n    };\r\n    Scroller.prototype.registerTransitionEnd = function () {\r\n        this.transitionEndRegister = new EventRegister(this.content, [\r\n            {\r\n                name: style.transitionEnd,\r\n                handler: this.transitionEnd.bind(this),\r\n            },\r\n        ]);\r\n    };\r\n    Scroller.prototype.bindTranslater = function () {\r\n        var _this = this;\r\n        var hooks = this.translater.hooks;\r\n        hooks.on(hooks.eventTypes.beforeTranslate, function (transformStyle) {\r\n            if (_this.options.translateZ) {\r\n                transformStyle.push(_this.options.translateZ);\r\n            }\r\n        });\r\n        // disable pointer events when scrolling\r\n        hooks.on(hooks.eventTypes.translate, function (pos) {\r\n            var prevPos = _this.getCurrentPos();\r\n            _this.updatePositions(pos);\r\n            // scrollEnd will dispatch when scroll is force stopping in touchstart handler\r\n            // so in touchend handler, don't toggle pointer-events\r\n            if (_this.actions.ensuringInteger === true) {\r\n                _this.actions.ensuringInteger = false;\r\n                return;\r\n            }\r\n            // a valid translate\r\n            if (pos.x !== prevPos.x || pos.y !== prevPos.y) {\r\n                _this.togglePointerEvents(false);\r\n            }\r\n        });\r\n    };\r\n    Scroller.prototype.bindAnimater = function () {\r\n        var _this = this;\r\n        // reset position\r\n        this.animater.hooks.on(this.animater.hooks.eventTypes.end, function (pos) {\r\n            if (!_this.resetPosition(_this.options.bounceTime)) {\r\n                _this.animater.setPending(false);\r\n                _this.hooks.trigger(_this.hooks.eventTypes.scrollEnd, pos);\r\n            }\r\n        });\r\n        bubbling(this.animater.hooks, this.hooks, [\r\n            {\r\n                source: this.animater.hooks.eventTypes.move,\r\n                target: this.hooks.eventTypes.scroll,\r\n            },\r\n            {\r\n                source: this.animater.hooks.eventTypes.forceStop,\r\n                target: this.hooks.eventTypes.scrollEnd,\r\n            },\r\n        ]);\r\n    };\r\n    Scroller.prototype.bindActions = function () {\r\n        var _this = this;\r\n        var actions = this.actions;\r\n        bubbling(actions.hooks, this.hooks, [\r\n            {\r\n                source: actions.hooks.eventTypes.start,\r\n                target: this.hooks.eventTypes.beforeStart,\r\n            },\r\n            {\r\n                source: actions.hooks.eventTypes.start,\r\n                target: this.hooks.eventTypes.beforeScrollStart,\r\n            },\r\n            {\r\n                source: actions.hooks.eventTypes.beforeMove,\r\n                target: this.hooks.eventTypes.beforeMove,\r\n            },\r\n            {\r\n                source: actions.hooks.eventTypes.scrollStart,\r\n                target: this.hooks.eventTypes.scrollStart,\r\n            },\r\n            {\r\n                source: actions.hooks.eventTypes.scroll,\r\n                target: this.hooks.eventTypes.scroll,\r\n            },\r\n            {\r\n                source: actions.hooks.eventTypes.beforeEnd,\r\n                target: this.hooks.eventTypes.beforeEnd,\r\n            },\r\n        ]);\r\n        actions.hooks.on(actions.hooks.eventTypes.end, function (e, pos) {\r\n            _this.hooks.trigger(_this.hooks.eventTypes.touchEnd, pos);\r\n            if (_this.hooks.trigger(_this.hooks.eventTypes.end, pos)) {\r\n                return true;\r\n            }\r\n            // check if it is a click operation\r\n            if (!actions.fingerMoved) {\r\n                _this.hooks.trigger(_this.hooks.eventTypes.scrollCancel);\r\n                if (_this.checkClick(e)) {\r\n                    return true;\r\n                }\r\n            }\r\n            // reset if we are outside of the boundaries\r\n            if (_this.resetPosition(_this.options.bounceTime, ease.bounce)) {\r\n                _this.animater.setForceStopped(false);\r\n                return true;\r\n            }\r\n        });\r\n        actions.hooks.on(actions.hooks.eventTypes.scrollEnd, function (pos, duration) {\r\n            var deltaX = Math.abs(pos.x - _this.scrollBehaviorX.startPos);\r\n            var deltaY = Math.abs(pos.y - _this.scrollBehaviorY.startPos);\r\n            if (_this.checkFlick(duration, deltaX, deltaY)) {\r\n                _this.animater.setForceStopped(false);\r\n                _this.hooks.trigger(_this.hooks.eventTypes.flick);\r\n                return;\r\n            }\r\n            if (_this.momentum(pos, duration)) {\r\n                _this.animater.setForceStopped(false);\r\n                return;\r\n            }\r\n            if (actions.contentMoved) {\r\n                _this.hooks.trigger(_this.hooks.eventTypes.scrollEnd, pos);\r\n            }\r\n            if (_this.animater.forceStopped) {\r\n                _this.animater.setForceStopped(false);\r\n            }\r\n        });\r\n    };\r\n    Scroller.prototype.checkFlick = function (duration, deltaX, deltaY) {\r\n        var flickMinMovingDistance = 1; // distinguish flick from click\r\n        if (this.hooks.events.flick.length > 1 &&\r\n            duration < this.options.flickLimitTime &&\r\n            deltaX < this.options.flickLimitDistance &&\r\n            deltaY < this.options.flickLimitDistance &&\r\n            (deltaY > flickMinMovingDistance || deltaX > flickMinMovingDistance)) {\r\n            return true;\r\n        }\r\n    };\r\n    Scroller.prototype.momentum = function (pos, duration) {\r\n        var meta = {\r\n            time: 0,\r\n            easing: ease.swiper,\r\n            newX: pos.x,\r\n            newY: pos.y,\r\n        };\r\n        // start momentum animation if needed\r\n        var momentumX = this.scrollBehaviorX.end(duration);\r\n        var momentumY = this.scrollBehaviorY.end(duration);\r\n        meta.newX = isUndef(momentumX.destination)\r\n            ? meta.newX\r\n            : momentumX.destination;\r\n        meta.newY = isUndef(momentumY.destination)\r\n            ? meta.newY\r\n            : momentumY.destination;\r\n        meta.time = Math.max(momentumX.duration, momentumY.duration);\r\n        this.hooks.trigger(this.hooks.eventTypes.momentum, meta, this);\r\n        // when x or y changed, do momentum animation now!\r\n        if (meta.newX !== pos.x || meta.newY !== pos.y) {\r\n            // change easing function when scroller goes out of the boundaries\r\n            if (meta.newX > this.scrollBehaviorX.minScrollPos ||\r\n                meta.newX < this.scrollBehaviorX.maxScrollPos ||\r\n                meta.newY > this.scrollBehaviorY.minScrollPos ||\r\n                meta.newY < this.scrollBehaviorY.maxScrollPos) {\r\n                meta.easing = ease.swipeBounce;\r\n            }\r\n            this.scrollTo(meta.newX, meta.newY, meta.time, meta.easing);\r\n            return true;\r\n        }\r\n    };\r\n    Scroller.prototype.checkClick = function (e) {\r\n        var cancelable = {\r\n            preventClick: this.animater.forceStopped,\r\n        };\r\n        // we scrolled less than momentumLimitDistance pixels\r\n        if (this.hooks.trigger(this.hooks.eventTypes.checkClick)) {\r\n            this.animater.setForceStopped(false);\r\n            return true;\r\n        }\r\n        if (!cancelable.preventClick) {\r\n            var _dblclick = this.options.dblclick;\r\n            var dblclickTrigged = false;\r\n            if (_dblclick && this.lastClickTime) {\r\n                var _a = _dblclick.delay, delay = _a === void 0 ? 300 : _a;\r\n                if (getNow() - this.lastClickTime < delay) {\r\n                    dblclickTrigged = true;\r\n                    dblclick(e);\r\n                }\r\n            }\r\n            if (this.options.tap) {\r\n                tap(e, this.options.tap);\r\n            }\r\n            if (this.options.click &&\r\n                !preventDefaultExceptionFn(e.target, this.options.preventDefaultException)) {\r\n                click(e);\r\n            }\r\n            this.lastClickTime = dblclickTrigged ? null : getNow();\r\n            return true;\r\n        }\r\n        return false;\r\n    };\r\n    Scroller.prototype.resize = function () {\r\n        var _this = this;\r\n        if (!this.actions.enabled) {\r\n            return;\r\n        }\r\n        // fix a scroll problem under Android condition\r\n        /* istanbul ignore if  */\r\n        if (isAndroid) {\r\n            this.wrapper.scrollTop = 0;\r\n        }\r\n        clearTimeout(this.resizeTimeout);\r\n        this.resizeTimeout = window.setTimeout(function () {\r\n            _this.hooks.trigger(_this.hooks.eventTypes.resize);\r\n        }, this.options.resizePolling);\r\n    };\r\n    /* istanbul ignore next */\r\n    Scroller.prototype.transitionEnd = function (e) {\r\n        if (e.target !== this.content || !this.animater.pending) {\r\n            return;\r\n        }\r\n        var animater = this.animater;\r\n        animater.transitionTime();\r\n        if (!this.resetPosition(this.options.bounceTime, ease.bounce)) {\r\n            this.animater.setPending(false);\r\n            if (this.options.probeType !== 3 /* Realtime */) {\r\n                this.hooks.trigger(this.hooks.eventTypes.scrollEnd, this.getCurrentPos());\r\n            }\r\n        }\r\n    };\r\n    Scroller.prototype.togglePointerEvents = function (enabled) {\r\n        if (enabled === void 0) { enabled = true; }\r\n        var el = this.content.children.length\r\n            ? this.content.children\r\n            : [this.content];\r\n        var pointerEvents = enabled ? 'auto' : 'none';\r\n        for (var i = 0; i < el.length; i++) {\r\n            var node = el[i];\r\n            // ignore BetterScroll instance's wrapper DOM\r\n            /* istanbul ignore if  */\r\n            if (node.isBScrollContainer) {\r\n                continue;\r\n            }\r\n            node.style.pointerEvents = pointerEvents;\r\n        }\r\n    };\r\n    Scroller.prototype.refresh = function (content) {\r\n        var contentChanged = this.setContent(content);\r\n        this.hooks.trigger(this.hooks.eventTypes.beforeRefresh);\r\n        this.scrollBehaviorX.refresh(content);\r\n        this.scrollBehaviorY.refresh(content);\r\n        if (contentChanged) {\r\n            this.translater.setContent(content);\r\n            this.animater.setContent(content);\r\n            this.transitionEndRegister.destroy();\r\n            this.registerTransitionEnd();\r\n            if (this.options.bindToTarget) {\r\n                this.actionsHandler.setContent(content);\r\n            }\r\n        }\r\n        this.actions.refresh();\r\n        this.wrapperOffset = offset(this.wrapper);\r\n    };\r\n    Scroller.prototype.setContent = function (content) {\r\n        var contentChanged = content !== this.content;\r\n        if (contentChanged) {\r\n            this.content = content;\r\n        }\r\n        return contentChanged;\r\n    };\r\n    Scroller.prototype.scrollBy = function (deltaX, deltaY, time, easing) {\r\n        if (time === void 0) { time = 0; }\r\n        var _a = this.getCurrentPos(), x = _a.x, y = _a.y;\r\n        easing = !easing ? ease.bounce : easing;\r\n        deltaX += x;\r\n        deltaY += y;\r\n        this.scrollTo(deltaX, deltaY, time, easing);\r\n    };\r\n    Scroller.prototype.scrollTo = function (x, y, time, easing, extraTransform) {\r\n        if (time === void 0) { time = 0; }\r\n        if (easing === void 0) { easing = ease.bounce; }\r\n        if (extraTransform === void 0) { extraTransform = {\r\n            start: {},\r\n            end: {},\r\n        }; }\r\n        var easingFn = this.options.useTransition ? easing.style : easing.fn;\r\n        var currentPos = this.getCurrentPos();\r\n        var startPoint = __assign({ x: currentPos.x, y: currentPos.y }, extraTransform.start);\r\n        var endPoint = __assign({ x: x,\r\n            y: y }, extraTransform.end);\r\n        this.hooks.trigger(this.hooks.eventTypes.scrollTo, endPoint);\r\n        // it is an useless move\r\n        if (isSamePoint(startPoint, endPoint))\r\n            return;\r\n        var deltaX = Math.abs(endPoint.x - startPoint.x);\r\n        var deltaY = Math.abs(endPoint.y - startPoint.y);\r\n        // considering of browser compatibility for decimal transform value\r\n        // force translating immediately\r\n        if (deltaX < MIN_SCROLL_DISTANCE && deltaY < MIN_SCROLL_DISTANCE) {\r\n            time = 0;\r\n            this.hooks.trigger(this.hooks.eventTypes.minDistanceScroll);\r\n        }\r\n        this.animater.move(startPoint, endPoint, time, easingFn);\r\n    };\r\n    Scroller.prototype.scrollToElement = function (el, time, offsetX, offsetY, easing) {\r\n        var targetEle = getElement(el);\r\n        var pos = offset(targetEle);\r\n        var getOffset = function (offset, size, wrapperSize) {\r\n            if (typeof offset === 'number') {\r\n                return offset;\r\n            }\r\n            // if offsetX/Y are true we center the element to the screen\r\n            return offset ? Math.round(size / 2 - wrapperSize / 2) : 0;\r\n        };\r\n        offsetX = getOffset(offsetX, targetEle.offsetWidth, this.wrapper.offsetWidth);\r\n        offsetY = getOffset(offsetY, targetEle.offsetHeight, this.wrapper.offsetHeight);\r\n        var getPos = function (pos, wrapperPos, offset, scrollBehavior) {\r\n            pos -= wrapperPos;\r\n            pos = scrollBehavior.adjustPosition(pos - offset);\r\n            return pos;\r\n        };\r\n        pos.left = getPos(pos.left, this.wrapperOffset.left, offsetX, this.scrollBehaviorX);\r\n        pos.top = getPos(pos.top, this.wrapperOffset.top, offsetY, this.scrollBehaviorY);\r\n        if (this.hooks.trigger(this.hooks.eventTypes.scrollToElement, targetEle, pos)) {\r\n            return;\r\n        }\r\n        this.scrollTo(pos.left, pos.top, time, easing);\r\n    };\r\n    Scroller.prototype.resetPosition = function (time, easing) {\r\n        if (time === void 0) { time = 0; }\r\n        if (easing === void 0) { easing = ease.bounce; }\r\n        var _a = this.scrollBehaviorX.checkInBoundary(), x = _a.position, xInBoundary = _a.inBoundary;\r\n        var _b = this.scrollBehaviorY.checkInBoundary(), y = _b.position, yInBoundary = _b.inBoundary;\r\n        if (xInBoundary && yInBoundary) {\r\n            return false;\r\n        }\r\n        /* istanbul ignore if  */\r\n        if (isIOSBadVersion) {\r\n            // fix ios 13.4 bouncing\r\n            // see it in issues 982\r\n            this.reflow();\r\n        }\r\n        // out of boundary\r\n        this.scrollTo(x, y, time, easing);\r\n        return true;\r\n    };\r\n    /* istanbul ignore next */\r\n    Scroller.prototype.reflow = function () {\r\n        this._reflow = this.content.offsetHeight;\r\n    };\r\n    Scroller.prototype.updatePositions = function (pos) {\r\n        this.scrollBehaviorX.updatePosition(pos.x);\r\n        this.scrollBehaviorY.updatePosition(pos.y);\r\n    };\r\n    Scroller.prototype.getCurrentPos = function () {\r\n        return this.actions.getCurrentPos();\r\n    };\r\n    Scroller.prototype.enable = function () {\r\n        this.actions.enabled = true;\r\n    };\r\n    Scroller.prototype.disable = function () {\r\n        cancelAnimationFrame(this.animater.timer);\r\n        this.actions.enabled = false;\r\n    };\r\n    Scroller.prototype.destroy = function () {\r\n        var _this = this;\r\n        var keys = [\r\n            'resizeRegister',\r\n            'transitionEndRegister',\r\n            'actionsHandler',\r\n            'actions',\r\n            'hooks',\r\n            'animater',\r\n            'translater',\r\n            'scrollBehaviorX',\r\n            'scrollBehaviorY',\r\n        ];\r\n        keys.forEach(function (key) { return _this[key].destroy(); });\r\n    };\r\n    return Scroller;\r\n}());\n\nvar BScrollConstructor = /** @class */ (function (_super) {\r\n    __extends(BScrollConstructor, _super);\r\n    function BScrollConstructor(el, options) {\r\n        var _this = _super.call(this, [\r\n            'refresh',\r\n            'contentChanged',\r\n            'enable',\r\n            'disable',\r\n            'beforeScrollStart',\r\n            'scrollStart',\r\n            'scroll',\r\n            'scrollEnd',\r\n            'scrollCancel',\r\n            'touchEnd',\r\n            'flick',\r\n            'destroy'\r\n        ]) || this;\r\n        var wrapper = getElement(el);\r\n        if (!wrapper) {\r\n            warn('Can not resolve the wrapper DOM.');\r\n            return _this;\r\n        }\r\n        _this.plugins = {};\r\n        _this.options = new OptionsConstructor().merge(options).process();\r\n        if (!_this.setContent(wrapper).valid) {\r\n            return _this;\r\n        }\r\n        _this.hooks = new EventEmitter([\r\n            'refresh',\r\n            'enable',\r\n            'disable',\r\n            'destroy',\r\n            'beforeInitialScrollTo',\r\n            'contentChanged'\r\n        ]);\r\n        _this.init(wrapper);\r\n        return _this;\r\n    }\r\n    BScrollConstructor.use = function (ctor) {\r\n        var name = ctor.pluginName;\r\n        var installed = BScrollConstructor.plugins.some(function (plugin) { return ctor === plugin.ctor; });\r\n        if (installed)\r\n            return BScrollConstructor;\r\n        if (isUndef(name)) {\r\n            warn(\"Plugin Class must specify plugin's name in static property by 'pluginName' field.\");\r\n            return BScrollConstructor;\r\n        }\r\n        BScrollConstructor.pluginsMap[name] = true;\r\n        BScrollConstructor.plugins.push({\r\n            name: name,\r\n            applyOrder: ctor.applyOrder,\r\n            ctor: ctor\r\n        });\r\n        return BScrollConstructor;\r\n    };\r\n    BScrollConstructor.prototype.setContent = function (wrapper) {\r\n        var contentChanged = false;\r\n        var valid = true;\r\n        var content = wrapper.children[this.options.specifiedIndexAsContent];\r\n        if (!content) {\r\n            warn('The wrapper need at least one child element to be content element to scroll.');\r\n            valid = false;\r\n        }\r\n        else {\r\n            contentChanged = this.content !== content;\r\n            if (contentChanged) {\r\n                this.content = content;\r\n            }\r\n        }\r\n        return {\r\n            valid: valid,\r\n            contentChanged: contentChanged\r\n        };\r\n    };\r\n    BScrollConstructor.prototype.init = function (wrapper) {\r\n        var _this = this;\r\n        this.wrapper = wrapper;\r\n        // mark wrapper to recognize bs instance by DOM attribute\r\n        wrapper.isBScrollContainer = true;\r\n        this.scroller = new Scroller(wrapper, this.content, this.options);\r\n        this.scroller.hooks.on(this.scroller.hooks.eventTypes.resize, function () {\r\n            _this.refresh();\r\n        });\r\n        this.eventBubbling();\r\n        this.handleAutoBlur();\r\n        this.enable();\r\n        this.proxy(propertiesConfig);\r\n        this.applyPlugins();\r\n        // maybe boundary has changed, should refresh\r\n        this.refreshWithoutReset(this.content);\r\n        var _a = this.options, startX = _a.startX, startY = _a.startY;\r\n        var position = {\r\n            x: startX,\r\n            y: startY\r\n        };\r\n        // maybe plugins want to control scroll position\r\n        if (this.hooks.trigger(this.hooks.eventTypes.beforeInitialScrollTo, position)) {\r\n            return;\r\n        }\r\n        this.scroller.scrollTo(position.x, position.y);\r\n    };\r\n    BScrollConstructor.prototype.applyPlugins = function () {\r\n        var _this = this;\r\n        var options = this.options;\r\n        BScrollConstructor.plugins\r\n            .sort(function (a, b) {\r\n            var _a;\r\n            var applyOrderMap = (_a = {},\r\n                _a[\"pre\" /* Pre */] = -1,\r\n                _a[\"post\" /* Post */] = 1,\r\n                _a);\r\n            var aOrder = a.applyOrder ? applyOrderMap[a.applyOrder] : 0;\r\n            var bOrder = b.applyOrder ? applyOrderMap[b.applyOrder] : 0;\r\n            return aOrder - bOrder;\r\n        })\r\n            .forEach(function (item) {\r\n            var ctor = item.ctor;\r\n            if (options[item.name] && typeof ctor === 'function') {\r\n                _this.plugins[item.name] = new ctor(_this);\r\n            }\r\n        });\r\n    };\r\n    BScrollConstructor.prototype.handleAutoBlur = function () {\r\n        /* istanbul ignore if  */\r\n        if (this.options.autoBlur) {\r\n            this.on(this.eventTypes.beforeScrollStart, function () {\r\n                var activeElement = document.activeElement;\r\n                if (activeElement &&\r\n                    (activeElement.tagName === 'INPUT' ||\r\n                        activeElement.tagName === 'TEXTAREA')) {\r\n                    activeElement.blur();\r\n                }\r\n            });\r\n        }\r\n    };\r\n    BScrollConstructor.prototype.eventBubbling = function () {\r\n        bubbling(this.scroller.hooks, this, [\r\n            this.eventTypes.beforeScrollStart,\r\n            this.eventTypes.scrollStart,\r\n            this.eventTypes.scroll,\r\n            this.eventTypes.scrollEnd,\r\n            this.eventTypes.scrollCancel,\r\n            this.eventTypes.touchEnd,\r\n            this.eventTypes.flick\r\n        ]);\r\n    };\r\n    BScrollConstructor.prototype.refreshWithoutReset = function (content) {\r\n        this.scroller.refresh(content);\r\n        this.hooks.trigger(this.hooks.eventTypes.refresh, content);\r\n        this.trigger(this.eventTypes.refresh, content);\r\n    };\r\n    BScrollConstructor.prototype.proxy = function (propertiesConfig) {\r\n        var _this = this;\r\n        propertiesConfig.forEach(function (_a) {\r\n            var key = _a.key, sourceKey = _a.sourceKey;\r\n            propertiesProxy(_this, sourceKey, key);\r\n        });\r\n    };\r\n    BScrollConstructor.prototype.refresh = function () {\r\n        var _a = this.setContent(this.wrapper), contentChanged = _a.contentChanged, valid = _a.valid;\r\n        if (valid) {\r\n            var content = this.content;\r\n            this.refreshWithoutReset(content);\r\n            if (contentChanged) {\r\n                this.hooks.trigger(this.hooks.eventTypes.contentChanged, content);\r\n                this.trigger(this.eventTypes.contentChanged, content);\r\n            }\r\n            this.scroller.resetPosition();\r\n        }\r\n    };\r\n    BScrollConstructor.prototype.enable = function () {\r\n        this.scroller.enable();\r\n        this.hooks.trigger(this.hooks.eventTypes.enable);\r\n        this.trigger(this.eventTypes.enable);\r\n    };\r\n    BScrollConstructor.prototype.disable = function () {\r\n        this.scroller.disable();\r\n        this.hooks.trigger(this.hooks.eventTypes.disable);\r\n        this.trigger(this.eventTypes.disable);\r\n    };\r\n    BScrollConstructor.prototype.destroy = function () {\r\n        this.hooks.trigger(this.hooks.eventTypes.destroy);\r\n        this.trigger(this.eventTypes.destroy);\r\n        this.scroller.destroy();\r\n    };\r\n    BScrollConstructor.prototype.eventRegister = function (names) {\r\n        this.registerType(names);\r\n    };\r\n    BScrollConstructor.plugins = [];\r\n    BScrollConstructor.pluginsMap = {};\r\n    return BScrollConstructor;\r\n}(EventEmitter));\r\nfunction createBScroll(el, options) {\r\n    var bs = new BScrollConstructor(el, options);\r\n    return bs;\r\n}\r\ncreateBScroll.use = BScrollConstructor.use;\r\ncreateBScroll.plugins = BScrollConstructor.plugins;\r\ncreateBScroll.pluginsMap = BScrollConstructor.pluginsMap;\r\nvar BScroll = createBScroll;\n\nexport { Behavior, CustomOptions, createBScroll, BScroll as default };\n","/*!\n * better-scroll / mouse-wheel\n * (c) 2016-2023 ustbhuangyi\n * Released under the MIT License.\n */\nfunction warn(msg) {\r\n    console.error(\"[BScroll warn]: \" + msg);\r\n}\n\n// ssr support\r\nvar inBrowser = typeof window !== 'undefined';\r\nvar ua = inBrowser && navigator.userAgent.toLowerCase();\r\n!!(ua && /wechatdevtools/.test(ua));\r\nua && ua.indexOf('android') > 0;\r\n/* istanbul ignore next */\r\n((function () {\r\n    if (typeof ua === 'string') {\r\n        var regex = /os (\\d\\d?_\\d(_\\d)?)/;\r\n        var matches = regex.exec(ua);\r\n        if (!matches)\r\n            return false;\r\n        var parts = matches[1].split('_').map(function (item) {\r\n            return parseInt(item, 10);\r\n        });\r\n        // ios version >= 13.4 issue 982\r\n        return !!(parts[0] === 13 && parts[1] >= 4);\r\n    }\r\n    return false;\r\n}))();\r\n/* istanbul ignore next */\r\nvar supportsPassive = false;\r\n/* istanbul ignore next */\r\nif (inBrowser) {\r\n    var EventName = 'test-passive';\r\n    try {\r\n        var opts = {};\r\n        Object.defineProperty(opts, 'passive', {\r\n            get: function () {\r\n                supportsPassive = true;\r\n            },\r\n        }); // https://github.com/facebook/flow/issues/285\r\n        window.addEventListener(EventName, function () { }, opts);\r\n    }\r\n    catch (e) { }\r\n}\n\nvar extend = function (target, source) {\r\n    for (var key in source) {\r\n        target[key] = source[key];\r\n    }\r\n    return target;\r\n};\n\nvar elementStyle = (inBrowser &&\r\n    document.createElement('div').style);\r\nvar vendor = (function () {\r\n    /* istanbul ignore if  */\r\n    if (!inBrowser) {\r\n        return false;\r\n    }\r\n    var transformNames = [\r\n        {\r\n            key: 'standard',\r\n            value: 'transform',\r\n        },\r\n        {\r\n            key: 'webkit',\r\n            value: 'webkitTransform',\r\n        },\r\n        {\r\n            key: 'Moz',\r\n            value: 'MozTransform',\r\n        },\r\n        {\r\n            key: 'O',\r\n            value: 'OTransform',\r\n        },\r\n        {\r\n            key: 'ms',\r\n            value: 'msTransform',\r\n        },\r\n    ];\r\n    for (var _i = 0, transformNames_1 = transformNames; _i < transformNames_1.length; _i++) {\r\n        var obj = transformNames_1[_i];\r\n        if (elementStyle[obj.value] !== undefined) {\r\n            return obj.key;\r\n        }\r\n    }\r\n    /* istanbul ignore next  */\r\n    return false;\r\n})();\r\n/* istanbul ignore next  */\r\nfunction prefixStyle(style) {\r\n    if (vendor === false) {\r\n        return style;\r\n    }\r\n    if (vendor === 'standard') {\r\n        if (style === 'transitionEnd') {\r\n            return 'transitionend';\r\n        }\r\n        return style;\r\n    }\r\n    return vendor + style.charAt(0).toUpperCase() + style.substr(1);\r\n}\r\nfunction addEvent(el, type, fn, capture) {\r\n    var useCapture = supportsPassive\r\n        ? {\r\n            passive: false,\r\n            capture: !!capture,\r\n        }\r\n        : !!capture;\r\n    el.addEventListener(type, fn, useCapture);\r\n}\r\nfunction removeEvent(el, type, fn, capture) {\r\n    el.removeEventListener(type, fn, {\r\n        capture: !!capture,\r\n    });\r\n}\r\nfunction maybePrevent(e) {\r\n    if (e.cancelable) {\r\n        e.preventDefault();\r\n    }\r\n}\r\nvendor && vendor !== 'standard' ? '-' + vendor.toLowerCase() + '-' : '';\r\nvar transform = prefixStyle('transform');\r\nvar transition = prefixStyle('transition');\r\ninBrowser && prefixStyle('perspective') in elementStyle;\r\n({\r\n    transform: transform,\r\n    transition: transition,\r\n    transitionTimingFunction: prefixStyle('transitionTimingFunction'),\r\n    transitionDuration: prefixStyle('transitionDuration'),\r\n    transitionDelay: prefixStyle('transitionDelay'),\r\n    transformOrigin: prefixStyle('transformOrigin'),\r\n    transitionEnd: prefixStyle('transitionEnd'),\r\n    transitionProperty: prefixStyle('transitionProperty'),\r\n});\r\nfunction preventDefaultExceptionFn(el, exceptions) {\r\n    for (var i in exceptions) {\r\n        if (exceptions[i].test(el[i])) {\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n}\n\nvar EventRegister = /** @class */ (function () {\r\n    function EventRegister(wrapper, events) {\r\n        this.wrapper = wrapper;\r\n        this.events = events;\r\n        this.addDOMEvents();\r\n    }\r\n    EventRegister.prototype.destroy = function () {\r\n        this.removeDOMEvents();\r\n        this.events = [];\r\n    };\r\n    EventRegister.prototype.addDOMEvents = function () {\r\n        this.handleDOMEvents(addEvent);\r\n    };\r\n    EventRegister.prototype.removeDOMEvents = function () {\r\n        this.handleDOMEvents(removeEvent);\r\n    };\r\n    EventRegister.prototype.handleDOMEvents = function (eventOperation) {\r\n        var _this = this;\r\n        var wrapper = this.wrapper;\r\n        this.events.forEach(function (event) {\r\n            eventOperation(wrapper, event.name, _this, !!event.capture);\r\n        });\r\n    };\r\n    EventRegister.prototype.handleEvent = function (e) {\r\n        var eventType = e.type;\r\n        this.events.some(function (event) {\r\n            if (event.name === eventType) {\r\n                event.handler(e);\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n    };\r\n    return EventRegister;\r\n}());\n\nvar MouseWheel = /** @class */ (function () {\r\n    function MouseWheel(scroll) {\r\n        this.scroll = scroll;\r\n        this.wheelEndTimer = 0;\r\n        this.wheelMoveTimer = 0;\r\n        this.wheelStart = false;\r\n        this.init();\r\n    }\r\n    MouseWheel.prototype.init = function () {\r\n        this.handleBScroll();\r\n        this.handleOptions();\r\n        this.handleHooks();\r\n        this.registerEvent();\r\n    };\r\n    MouseWheel.prototype.handleBScroll = function () {\r\n        this.scroll.registerType([\r\n            'alterOptions',\r\n            'mousewheelStart',\r\n            'mousewheelMove',\r\n            'mousewheelEnd',\r\n        ]);\r\n    };\r\n    MouseWheel.prototype.handleOptions = function () {\r\n        var userOptions = (this.scroll.options.mouseWheel === true\r\n            ? {}\r\n            : this.scroll.options.mouseWheel);\r\n        var defaultOptions = {\r\n            speed: 20,\r\n            invert: false,\r\n            easeTime: 300,\r\n            discreteTime: 400,\r\n            throttleTime: 0,\r\n            dampingFactor: 0.1,\r\n        };\r\n        this.mouseWheelOpt = extend(defaultOptions, userOptions);\r\n    };\r\n    MouseWheel.prototype.handleHooks = function () {\r\n        this.hooksFn = [];\r\n        this.registerHooks(this.scroll.hooks, 'destroy', this.destroy);\r\n    };\r\n    MouseWheel.prototype.registerEvent = function () {\r\n        this.eventRegister = new EventRegister(this.scroll.scroller.wrapper, [\r\n            {\r\n                name: 'wheel',\r\n                handler: this.wheelHandler.bind(this),\r\n            },\r\n            {\r\n                name: 'mousewheel',\r\n                handler: this.wheelHandler.bind(this),\r\n            },\r\n            {\r\n                name: 'DOMMouseScroll',\r\n                handler: this.wheelHandler.bind(this),\r\n            },\r\n        ]);\r\n    };\r\n    MouseWheel.prototype.registerHooks = function (hooks, name, handler) {\r\n        hooks.on(name, handler, this);\r\n        this.hooksFn.push([hooks, name, handler]);\r\n    };\r\n    MouseWheel.prototype.wheelHandler = function (e) {\r\n        if (!this.scroll.enabled) {\r\n            return;\r\n        }\r\n        this.beforeHandler(e);\r\n        // start\r\n        if (!this.wheelStart) {\r\n            this.wheelStartHandler(e);\r\n            this.wheelStart = true;\r\n        }\r\n        // move\r\n        var delta = this.getWheelDelta(e);\r\n        this.wheelMoveHandler(delta);\r\n        // end\r\n        this.wheelEndDetector(delta);\r\n    };\r\n    MouseWheel.prototype.wheelStartHandler = function (e) {\r\n        this.cleanCache();\r\n        var _a = this.scroll.scroller, scrollBehaviorX = _a.scrollBehaviorX, scrollBehaviorY = _a.scrollBehaviorY;\r\n        scrollBehaviorX.setMovingDirection(0 /* Default */);\r\n        scrollBehaviorY.setMovingDirection(0 /* Default */);\r\n        scrollBehaviorX.setDirection(0 /* Default */);\r\n        scrollBehaviorY.setDirection(0 /* Default */);\r\n        this.scroll.trigger(this.scroll.eventTypes.alterOptions, this.mouseWheelOpt);\r\n        this.scroll.trigger(this.scroll.eventTypes.mousewheelStart);\r\n    };\r\n    MouseWheel.prototype.cleanCache = function () {\r\n        this.deltaCache = [];\r\n    };\r\n    MouseWheel.prototype.wheelMoveHandler = function (delta) {\r\n        var _this = this;\r\n        var _a = this.mouseWheelOpt, throttleTime = _a.throttleTime, dampingFactor = _a.dampingFactor;\r\n        if (throttleTime && this.wheelMoveTimer) {\r\n            this.deltaCache.push(delta);\r\n        }\r\n        else {\r\n            var cachedDelta = this.deltaCache.reduce(function (prev, current) {\r\n                return {\r\n                    x: prev.x + current.x,\r\n                    y: prev.y + current.y,\r\n                };\r\n            }, { x: 0, y: 0 });\r\n            this.cleanCache();\r\n            var _b = this.scroll.scroller, scrollBehaviorX = _b.scrollBehaviorX, scrollBehaviorY = _b.scrollBehaviorY;\r\n            scrollBehaviorX.setMovingDirection(-delta.directionX);\r\n            scrollBehaviorY.setMovingDirection(-delta.directionY);\r\n            scrollBehaviorX.setDirection(delta.x);\r\n            scrollBehaviorY.setDirection(delta.y);\r\n            // when out of boundary, perform a damping scroll\r\n            var newX = scrollBehaviorX.performDampingAlgorithm(Math.round(delta.x) + cachedDelta.x, dampingFactor);\r\n            var newY = scrollBehaviorY.performDampingAlgorithm(Math.round(delta.y) + cachedDelta.x, dampingFactor);\r\n            if (!this.scroll.trigger(this.scroll.eventTypes.mousewheelMove, {\r\n                x: newX,\r\n                y: newY,\r\n            })) {\r\n                var easeTime = this.getEaseTime();\r\n                if (newX !== this.scroll.x || newY !== this.scroll.y) {\r\n                    this.scroll.scrollTo(newX, newY, easeTime);\r\n                }\r\n            }\r\n            if (throttleTime) {\r\n                this.wheelMoveTimer = window.setTimeout(function () {\r\n                    _this.wheelMoveTimer = 0;\r\n                }, throttleTime);\r\n            }\r\n        }\r\n    };\r\n    MouseWheel.prototype.wheelEndDetector = function (delta) {\r\n        var _this = this;\r\n        window.clearTimeout(this.wheelEndTimer);\r\n        this.wheelEndTimer = window.setTimeout(function () {\r\n            _this.wheelStart = false;\r\n            window.clearTimeout(_this.wheelMoveTimer);\r\n            _this.wheelMoveTimer = 0;\r\n            _this.scroll.trigger(_this.scroll.eventTypes.mousewheelEnd, delta);\r\n        }, this.mouseWheelOpt.discreteTime);\r\n    };\r\n    MouseWheel.prototype.getWheelDelta = function (e) {\r\n        var _a = this.mouseWheelOpt, speed = _a.speed, invert = _a.invert;\r\n        var wheelDeltaX = 0;\r\n        var wheelDeltaY = 0;\r\n        var direction = invert ? -1 /* Negative */ : 1 /* Positive */;\r\n        switch (true) {\r\n            case 'deltaX' in e:\r\n                if (e.deltaMode === 1) {\r\n                    wheelDeltaX = -e.deltaX * speed;\r\n                    wheelDeltaY = -e.deltaY * speed;\r\n                }\r\n                else {\r\n                    wheelDeltaX = -e.deltaX;\r\n                    wheelDeltaY = -e.deltaY;\r\n                }\r\n                break;\r\n            case 'wheelDeltaX' in e:\r\n                wheelDeltaX = (e.wheelDeltaX / 120) * speed;\r\n                wheelDeltaY = (e.wheelDeltaY / 120) * speed;\r\n                break;\r\n            case 'wheelDelta' in e:\r\n                wheelDeltaX = wheelDeltaY = (e.wheelDelta / 120) * speed;\r\n                break;\r\n            case 'detail' in e:\r\n                wheelDeltaX = wheelDeltaY = (-e.detail / 3) * speed;\r\n                break;\r\n        }\r\n        wheelDeltaX *= direction;\r\n        wheelDeltaY *= direction;\r\n        if (!this.scroll.hasVerticalScroll) {\r\n            if (Math.abs(wheelDeltaY) > Math.abs(wheelDeltaX)) {\r\n                wheelDeltaX = wheelDeltaY;\r\n            }\r\n            wheelDeltaY = 0;\r\n        }\r\n        if (!this.scroll.hasHorizontalScroll) {\r\n            wheelDeltaX = 0;\r\n        }\r\n        var directionX = wheelDeltaX > 0\r\n            ? -1 /* Negative */\r\n            : wheelDeltaX < 0\r\n                ? 1 /* Positive */\r\n                : 0 /* Default */;\r\n        var directionY = wheelDeltaY > 0\r\n            ? -1 /* Negative */\r\n            : wheelDeltaY < 0\r\n                ? 1 /* Positive */\r\n                : 0 /* Default */;\r\n        return {\r\n            x: wheelDeltaX,\r\n            y: wheelDeltaY,\r\n            directionX: directionX,\r\n            directionY: directionY,\r\n        };\r\n    };\r\n    MouseWheel.prototype.beforeHandler = function (e) {\r\n        var _a = this.scroll.options, preventDefault = _a.preventDefault, stopPropagation = _a.stopPropagation, preventDefaultException = _a.preventDefaultException;\r\n        if (preventDefault &&\r\n            !preventDefaultExceptionFn(e.target, preventDefaultException)) {\r\n            maybePrevent(e);\r\n        }\r\n        if (stopPropagation) {\r\n            e.stopPropagation();\r\n        }\r\n    };\r\n    MouseWheel.prototype.getEaseTime = function () {\r\n        var SAFE_EASETIME = 100;\r\n        var easeTime = this.mouseWheelOpt.easeTime;\r\n        // scrollEnd event will be triggered in every calling of scrollTo when easeTime is too small\r\n        // easeTime needs to be greater than 100\r\n        if (easeTime < SAFE_EASETIME) {\r\n            warn(\"easeTime should be greater than 100.\" +\r\n                \"If mouseWheel easeTime is too small,\" +\r\n                \"scrollEnd will be triggered many times.\");\r\n        }\r\n        return Math.max(easeTime, SAFE_EASETIME);\r\n    };\r\n    MouseWheel.prototype.destroy = function () {\r\n        this.eventRegister.destroy();\r\n        window.clearTimeout(this.wheelEndTimer);\r\n        window.clearTimeout(this.wheelMoveTimer);\r\n        this.hooksFn.forEach(function (item) {\r\n            var hooks = item[0];\r\n            var hooksName = item[1];\r\n            var handlerFn = item[2];\r\n            hooks.off(hooksName, handlerFn);\r\n        });\r\n    };\r\n    MouseWheel.pluginName = 'mouseWheel';\r\n    MouseWheel.applyOrder = \"pre\" /* Pre */;\r\n    return MouseWheel;\r\n}());\n\nexport { MouseWheel as default };\n","/*!\n * better-scroll / scroll-bar\n * (c) 2016-2023 ustbhuangyi\n * Released under the MIT License.\n */\n/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n\r\nvar __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    };\r\n    return __assign.apply(this, arguments);\r\n};\r\n\r\nfunction __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\n\nfunction warn(msg) {\r\n    console.error(\"[BScroll warn]: \" + msg);\r\n}\n\n// ssr support\r\nvar inBrowser = typeof window !== 'undefined';\r\nvar ua = inBrowser && navigator.userAgent.toLowerCase();\r\n!!(ua && /wechatdevtools/.test(ua));\r\nua && ua.indexOf('android') > 0;\r\n/* istanbul ignore next */\r\n((function () {\r\n    if (typeof ua === 'string') {\r\n        var regex = /os (\\d\\d?_\\d(_\\d)?)/;\r\n        var matches = regex.exec(ua);\r\n        if (!matches)\r\n            return false;\r\n        var parts = matches[1].split('_').map(function (item) {\r\n            return parseInt(item, 10);\r\n        });\r\n        // ios version >= 13.4 issue 982\r\n        return !!(parts[0] === 13 && parts[1] >= 4);\r\n    }\r\n    return false;\r\n}))();\r\n/* istanbul ignore next */\r\nvar supportsPassive = false;\r\n/* istanbul ignore next */\r\nif (inBrowser) {\r\n    var EventName = 'test-passive';\r\n    try {\r\n        var opts = {};\r\n        Object.defineProperty(opts, 'passive', {\r\n            get: function () {\r\n                supportsPassive = true;\r\n            },\r\n        }); // https://github.com/facebook/flow/issues/285\r\n        window.addEventListener(EventName, function () { }, opts);\r\n    }\r\n    catch (e) { }\r\n}\n\nfunction getNow() {\r\n    return window.performance &&\r\n        window.performance.now &&\r\n        window.performance.timing\r\n        ? window.performance.now() + window.performance.timing.navigationStart\r\n        : +new Date();\r\n}\r\nvar extend = function (target, source) {\r\n    for (var key in source) {\r\n        target[key] = source[key];\r\n    }\r\n    return target;\r\n};\r\nfunction between(x, min, max) {\r\n    if (x < min) {\r\n        return min;\r\n    }\r\n    if (x > max) {\r\n        return max;\r\n    }\r\n    return x;\r\n}\n\nvar elementStyle = (inBrowser &&\r\n    document.createElement('div').style);\r\nvar vendor = (function () {\r\n    /* istanbul ignore if  */\r\n    if (!inBrowser) {\r\n        return false;\r\n    }\r\n    var transformNames = [\r\n        {\r\n            key: 'standard',\r\n            value: 'transform',\r\n        },\r\n        {\r\n            key: 'webkit',\r\n            value: 'webkitTransform',\r\n        },\r\n        {\r\n            key: 'Moz',\r\n            value: 'MozTransform',\r\n        },\r\n        {\r\n            key: 'O',\r\n            value: 'OTransform',\r\n        },\r\n        {\r\n            key: 'ms',\r\n            value: 'msTransform',\r\n        },\r\n    ];\r\n    for (var _i = 0, transformNames_1 = transformNames; _i < transformNames_1.length; _i++) {\r\n        var obj = transformNames_1[_i];\r\n        if (elementStyle[obj.value] !== undefined) {\r\n            return obj.key;\r\n        }\r\n    }\r\n    /* istanbul ignore next  */\r\n    return false;\r\n})();\r\n/* istanbul ignore next  */\r\nfunction prefixStyle(style) {\r\n    if (vendor === false) {\r\n        return style;\r\n    }\r\n    if (vendor === 'standard') {\r\n        if (style === 'transitionEnd') {\r\n            return 'transitionend';\r\n        }\r\n        return style;\r\n    }\r\n    return vendor + style.charAt(0).toUpperCase() + style.substr(1);\r\n}\r\nfunction addEvent(el, type, fn, capture) {\r\n    var useCapture = supportsPassive\r\n        ? {\r\n            passive: false,\r\n            capture: !!capture,\r\n        }\r\n        : !!capture;\r\n    el.addEventListener(type, fn, useCapture);\r\n}\r\nfunction removeEvent(el, type, fn, capture) {\r\n    el.removeEventListener(type, fn, {\r\n        capture: !!capture,\r\n    });\r\n}\r\nfunction maybePrevent(e) {\r\n    if (e.cancelable) {\r\n        e.preventDefault();\r\n    }\r\n}\r\nvendor && vendor !== 'standard' ? '-' + vendor.toLowerCase() + '-' : '';\r\nvar transform = prefixStyle('transform');\r\nvar transition = prefixStyle('transition');\r\ninBrowser && prefixStyle('perspective') in elementStyle;\r\nvar style = {\r\n    transform: transform,\r\n    transition: transition,\r\n    transitionTimingFunction: prefixStyle('transitionTimingFunction'),\r\n    transitionDuration: prefixStyle('transitionDuration'),\r\n    transitionDelay: prefixStyle('transitionDelay'),\r\n    transformOrigin: prefixStyle('transformOrigin'),\r\n    transitionEnd: prefixStyle('transitionEnd'),\r\n    transitionProperty: prefixStyle('transitionProperty'),\r\n};\n\nvar EventEmitter = /** @class */ (function () {\r\n    function EventEmitter(names) {\r\n        this.events = {};\r\n        this.eventTypes = {};\r\n        this.registerType(names);\r\n    }\r\n    EventEmitter.prototype.on = function (type, fn, context) {\r\n        if (context === void 0) { context = this; }\r\n        this.hasType(type);\r\n        if (!this.events[type]) {\r\n            this.events[type] = [];\r\n        }\r\n        this.events[type].push([fn, context]);\r\n        return this;\r\n    };\r\n    EventEmitter.prototype.once = function (type, fn, context) {\r\n        var _this = this;\r\n        if (context === void 0) { context = this; }\r\n        this.hasType(type);\r\n        var magic = function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n            _this.off(type, magic);\r\n            var ret = fn.apply(context, args);\r\n            if (ret === true) {\r\n                return ret;\r\n            }\r\n        };\r\n        magic.fn = fn;\r\n        this.on(type, magic);\r\n        return this;\r\n    };\r\n    EventEmitter.prototype.off = function (type, fn) {\r\n        if (!type && !fn) {\r\n            this.events = {};\r\n            return this;\r\n        }\r\n        if (type) {\r\n            this.hasType(type);\r\n            if (!fn) {\r\n                this.events[type] = [];\r\n                return this;\r\n            }\r\n            var events = this.events[type];\r\n            if (!events) {\r\n                return this;\r\n            }\r\n            var count = events.length;\r\n            while (count--) {\r\n                if (events[count][0] === fn ||\r\n                    (events[count][0] && events[count][0].fn === fn)) {\r\n                    events.splice(count, 1);\r\n                }\r\n            }\r\n            return this;\r\n        }\r\n    };\r\n    EventEmitter.prototype.trigger = function (type) {\r\n        var args = [];\r\n        for (var _i = 1; _i < arguments.length; _i++) {\r\n            args[_i - 1] = arguments[_i];\r\n        }\r\n        this.hasType(type);\r\n        var events = this.events[type];\r\n        if (!events) {\r\n            return;\r\n        }\r\n        var len = events.length;\r\n        var eventsCopy = __spreadArrays(events);\r\n        var ret;\r\n        for (var i = 0; i < len; i++) {\r\n            var event_1 = eventsCopy[i];\r\n            var fn = event_1[0], context = event_1[1];\r\n            if (fn) {\r\n                ret = fn.apply(context, args);\r\n                if (ret === true) {\r\n                    return ret;\r\n                }\r\n            }\r\n        }\r\n    };\r\n    EventEmitter.prototype.registerType = function (names) {\r\n        var _this = this;\r\n        names.forEach(function (type) {\r\n            _this.eventTypes[type] = type;\r\n        });\r\n    };\r\n    EventEmitter.prototype.destroy = function () {\r\n        this.events = {};\r\n        this.eventTypes = {};\r\n    };\r\n    EventEmitter.prototype.hasType = function (type) {\r\n        var types = this.eventTypes;\r\n        var isType = types[type] === type;\r\n        if (!isType) {\r\n            warn(\"EventEmitter has used unknown event type: \\\"\" + type + \"\\\", should be oneof [\" +\r\n                (\"\" + Object.keys(types).map(function (_) { return JSON.stringify(_); })) +\r\n                \"]\");\r\n        }\r\n    };\r\n    return EventEmitter;\r\n}());\r\nvar EventRegister = /** @class */ (function () {\r\n    function EventRegister(wrapper, events) {\r\n        this.wrapper = wrapper;\r\n        this.events = events;\r\n        this.addDOMEvents();\r\n    }\r\n    EventRegister.prototype.destroy = function () {\r\n        this.removeDOMEvents();\r\n        this.events = [];\r\n    };\r\n    EventRegister.prototype.addDOMEvents = function () {\r\n        this.handleDOMEvents(addEvent);\r\n    };\r\n    EventRegister.prototype.removeDOMEvents = function () {\r\n        this.handleDOMEvents(removeEvent);\r\n    };\r\n    EventRegister.prototype.handleDOMEvents = function (eventOperation) {\r\n        var _this = this;\r\n        var wrapper = this.wrapper;\r\n        this.events.forEach(function (event) {\r\n            eventOperation(wrapper, event.name, _this, !!event.capture);\r\n        });\r\n    };\r\n    EventRegister.prototype.handleEvent = function (e) {\r\n        var eventType = e.type;\r\n        this.events.some(function (event) {\r\n            if (event.name === eventType) {\r\n                event.handler(e);\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n    };\r\n    return EventRegister;\r\n}());\n\nvar EventHandler = /** @class */ (function () {\r\n    function EventHandler(indicator, options) {\r\n        this.indicator = indicator;\r\n        this.options = options;\r\n        this.hooks = new EventEmitter(['touchStart', 'touchMove', 'touchEnd']);\r\n        this.registerEvents();\r\n    }\r\n    EventHandler.prototype.registerEvents = function () {\r\n        var _a = this.options, disableMouse = _a.disableMouse, disableTouch = _a.disableTouch;\r\n        var startEvents = [];\r\n        var moveEvents = [];\r\n        var endEvents = [];\r\n        if (!disableMouse) {\r\n            startEvents.push({\r\n                name: 'mousedown',\r\n                handler: this.start.bind(this),\r\n            });\r\n            moveEvents.push({\r\n                name: 'mousemove',\r\n                handler: this.move.bind(this),\r\n            });\r\n            endEvents.push({\r\n                name: 'mouseup',\r\n                handler: this.end.bind(this),\r\n            });\r\n        }\r\n        if (!disableTouch) {\r\n            startEvents.push({\r\n                name: 'touchstart',\r\n                handler: this.start.bind(this),\r\n            });\r\n            moveEvents.push({\r\n                name: 'touchmove',\r\n                handler: this.move.bind(this),\r\n            });\r\n            endEvents.push({\r\n                name: 'touchend',\r\n                handler: this.end.bind(this),\r\n            }, {\r\n                name: 'touchcancel',\r\n                handler: this.end.bind(this),\r\n            });\r\n        }\r\n        this.startEventRegister = new EventRegister(this.indicator.indicatorEl, startEvents);\r\n        this.moveEventRegister = new EventRegister(window, moveEvents);\r\n        this.endEventRegister = new EventRegister(window, endEvents);\r\n    };\r\n    EventHandler.prototype.BScrollIsDisabled = function () {\r\n        return !this.indicator.scroll.enabled;\r\n    };\r\n    EventHandler.prototype.start = function (e) {\r\n        if (this.BScrollIsDisabled()) {\r\n            return;\r\n        }\r\n        var point = (e.touches ? e.touches[0] : e);\r\n        maybePrevent(e);\r\n        e.stopPropagation();\r\n        this.initiated = true;\r\n        this.lastPoint = point[this.indicator.keysMap.point];\r\n        this.hooks.trigger(this.hooks.eventTypes.touchStart);\r\n    };\r\n    EventHandler.prototype.move = function (e) {\r\n        if (!this.initiated) {\r\n            return;\r\n        }\r\n        var point = (e.touches ? e.touches[0] : e);\r\n        var pointPos = point[this.indicator.keysMap.point];\r\n        maybePrevent(e);\r\n        e.stopPropagation();\r\n        var delta = pointPos - this.lastPoint;\r\n        this.lastPoint = pointPos;\r\n        this.hooks.trigger(this.hooks.eventTypes.touchMove, delta);\r\n    };\r\n    EventHandler.prototype.end = function (e) {\r\n        if (!this.initiated) {\r\n            return;\r\n        }\r\n        this.initiated = false;\r\n        maybePrevent(e);\r\n        e.stopPropagation();\r\n        this.hooks.trigger(this.hooks.eventTypes.touchEnd);\r\n    };\r\n    EventHandler.prototype.destroy = function () {\r\n        this.startEventRegister.destroy();\r\n        this.moveEventRegister.destroy();\r\n        this.endEventRegister.destroy();\r\n    };\r\n    return EventHandler;\r\n}());\n\nvar Indicator = /** @class */ (function () {\r\n    function Indicator(scroll, options) {\r\n        this.scroll = scroll;\r\n        this.options = options;\r\n        this.hooksFn = [];\r\n        this.wrapper = options.wrapper;\r\n        this.direction = options.direction;\r\n        this.indicatorEl = this.wrapper.children[0];\r\n        this.keysMap = this.getKeysMap();\r\n        this.handleFade();\r\n        this.handleHooks();\r\n    }\r\n    Indicator.prototype.handleFade = function () {\r\n        if (this.options.fade) {\r\n            this.wrapper.style.opacity = '0';\r\n        }\r\n    };\r\n    Indicator.prototype.handleHooks = function () {\r\n        var _this = this;\r\n        var _a = this.options, fade = _a.fade, interactive = _a.interactive, scrollbarTrackClickable = _a.scrollbarTrackClickable;\r\n        var scroll = this.scroll;\r\n        var scrollHooks = scroll.hooks;\r\n        var translaterHooks = scroll.scroller.translater.hooks;\r\n        var animaterHooks = scroll.scroller.animater.hooks;\r\n        this.registerHooks(scrollHooks, scrollHooks.eventTypes.refresh, this.refresh);\r\n        this.registerHooks(translaterHooks, translaterHooks.eventTypes.translate, function (pos) {\r\n            var hasScrollKey = _this.keysMap.hasScroll;\r\n            if (_this.scroll[hasScrollKey]) {\r\n                _this.updatePosition(pos);\r\n            }\r\n        });\r\n        this.registerHooks(animaterHooks, animaterHooks.eventTypes.time, this.transitionTime);\r\n        this.registerHooks(animaterHooks, animaterHooks.eventTypes.timeFunction, this.transitionTimingFunction);\r\n        if (fade) {\r\n            this.registerHooks(scroll, scroll.eventTypes.scrollEnd, function () {\r\n                _this.fade();\r\n            });\r\n            this.registerHooks(scroll, scroll.eventTypes.scrollStart, function () {\r\n                _this.fade(true);\r\n            });\r\n            // for mousewheel event\r\n            if (scroll.eventTypes.mousewheelStart &&\r\n                scroll.eventTypes.mousewheelEnd) {\r\n                this.registerHooks(scroll, scroll.eventTypes.mousewheelStart, function () {\r\n                    _this.fade(true);\r\n                });\r\n                this.registerHooks(scroll, scroll.eventTypes.mousewheelMove, function () {\r\n                    _this.fade(true);\r\n                });\r\n                this.registerHooks(scroll, scroll.eventTypes.mousewheelEnd, function () {\r\n                    _this.fade();\r\n                });\r\n            }\r\n        }\r\n        if (interactive) {\r\n            var _b = this.scroll.options, disableMouse = _b.disableMouse, disableTouch = _b.disableTouch;\r\n            this.eventHandler = new EventHandler(this, {\r\n                disableMouse: disableMouse,\r\n                disableTouch: disableTouch,\r\n            });\r\n            var eventHandlerHooks = this.eventHandler.hooks;\r\n            this.registerHooks(eventHandlerHooks, eventHandlerHooks.eventTypes.touchStart, this.startHandler);\r\n            this.registerHooks(eventHandlerHooks, eventHandlerHooks.eventTypes.touchMove, this.moveHandler);\r\n            this.registerHooks(eventHandlerHooks, eventHandlerHooks.eventTypes.touchEnd, this.endHandler);\r\n        }\r\n        if (scrollbarTrackClickable) {\r\n            this.bindClick();\r\n        }\r\n    };\r\n    Indicator.prototype.registerHooks = function (hooks, name, handler) {\r\n        hooks.on(name, handler, this);\r\n        this.hooksFn.push([hooks, name, handler]);\r\n    };\r\n    Indicator.prototype.bindClick = function () {\r\n        var wrapper = this.wrapper;\r\n        this.clickEventRegister = new EventRegister(wrapper, [\r\n            {\r\n                name: 'click',\r\n                handler: this.handleClick.bind(this),\r\n            },\r\n        ]);\r\n    };\r\n    Indicator.prototype.handleClick = function (e) {\r\n        var newPos = this.calculateclickOffsetPos(e);\r\n        var _a = this.scroll, x = _a.x, y = _a.y;\r\n        x = this.direction === \"horizontal\" /* Horizontal */ ? newPos : x;\r\n        y = this.direction === \"vertical\" /* Vertical */ ? newPos : y;\r\n        this.scroll.scrollTo(x, y, this.options.scrollbarTrackOffsetTime);\r\n    };\r\n    Indicator.prototype.calculateclickOffsetPos = function (e) {\r\n        var _a = this.keysMap, poinKey = _a.point, domRectKey = _a.domRect;\r\n        var scrollbarTrackOffsetType = this.options.scrollbarTrackOffsetType;\r\n        var clickPointOffset = e[poinKey] - this.wrapperRect[domRectKey];\r\n        var scrollToWhere = clickPointOffset < this.currentPos ? -1 /* Up */ : 1 /* Down */;\r\n        var delta = 0;\r\n        var currentPos = this.currentPos;\r\n        if (scrollbarTrackOffsetType === \"step\" /* Step */) {\r\n            delta = this.scrollInfo.baseSize * scrollToWhere;\r\n        }\r\n        else {\r\n            delta = 0;\r\n            currentPos = clickPointOffset;\r\n        }\r\n        return this.newPos(currentPos, delta, this.scrollInfo);\r\n    };\r\n    Indicator.prototype.getKeysMap = function () {\r\n        if (this.direction === \"vertical\" /* Vertical */) {\r\n            return {\r\n                hasScroll: 'hasVerticalScroll',\r\n                size: 'height',\r\n                wrapperSize: 'clientHeight',\r\n                scrollerSize: 'scrollerHeight',\r\n                maxScrollPos: 'maxScrollY',\r\n                pos: 'y',\r\n                point: 'pageY',\r\n                translateProperty: 'translateY',\r\n                domRect: 'top',\r\n            };\r\n        }\r\n        return {\r\n            hasScroll: 'hasHorizontalScroll',\r\n            size: 'width',\r\n            wrapperSize: 'clientWidth',\r\n            scrollerSize: 'scrollerWidth',\r\n            maxScrollPos: 'maxScrollX',\r\n            pos: 'x',\r\n            point: 'pageX',\r\n            translateProperty: 'translateX',\r\n            domRect: 'left',\r\n        };\r\n    };\r\n    Indicator.prototype.fade = function (visible) {\r\n        var _a = this.options, fadeInTime = _a.fadeInTime, fadeOutTime = _a.fadeOutTime;\r\n        var time = visible ? fadeInTime : fadeOutTime;\r\n        var wrapper = this.wrapper;\r\n        wrapper.style[style.transitionDuration] = time + 'ms';\r\n        wrapper.style.opacity = visible ? '1' : '0';\r\n    };\r\n    Indicator.prototype.refresh = function () {\r\n        var hasScrollKey = this.keysMap.hasScroll;\r\n        var scroll = this.scroll;\r\n        var x = scroll.x, y = scroll.y;\r\n        this.wrapperRect = this.wrapper.getBoundingClientRect();\r\n        if (this.canScroll(scroll[hasScrollKey])) {\r\n            var _a = this.keysMap, wrapperSizeKey = _a.wrapperSize, scrollerSizeKey = _a.scrollerSize, maxScrollPosKey = _a.maxScrollPos;\r\n            this.scrollInfo = this.refreshScrollInfo(this.wrapper[wrapperSizeKey], scroll[scrollerSizeKey], scroll[maxScrollPosKey], this.indicatorEl[wrapperSizeKey]);\r\n            this.updatePosition({\r\n                x: x,\r\n                y: y,\r\n            });\r\n        }\r\n    };\r\n    Indicator.prototype.transitionTime = function (time) {\r\n        if (time === void 0) { time = 0; }\r\n        this.indicatorEl.style[style.transitionDuration] = time + 'ms';\r\n    };\r\n    Indicator.prototype.transitionTimingFunction = function (easing) {\r\n        this.indicatorEl.style[style.transitionTimingFunction] = easing;\r\n    };\r\n    Indicator.prototype.canScroll = function (hasScroll) {\r\n        this.wrapper.style.display = hasScroll ? 'block' : 'none';\r\n        return hasScroll;\r\n    };\r\n    Indicator.prototype.refreshScrollInfo = function (wrapperSize, scrollerSize, maxScrollPos, indicatorElSize) {\r\n        var baseSize = Math.max(Math.round((wrapperSize * wrapperSize) / (scrollerSize || wrapperSize || 1)), this.options.minSize);\r\n        if (this.options.isCustom) {\r\n            baseSize = indicatorElSize;\r\n        }\r\n        var maxIndicatorScrollPos = wrapperSize - baseSize;\r\n        // sizeRatio is negative\r\n        var sizeRatio = maxIndicatorScrollPos / maxScrollPos;\r\n        return {\r\n            baseSize: baseSize,\r\n            maxScrollPos: maxIndicatorScrollPos,\r\n            minScrollPos: 0,\r\n            sizeRatio: sizeRatio,\r\n        };\r\n    };\r\n    Indicator.prototype.updatePosition = function (point) {\r\n        var _a = this.caculatePosAndSize(point, this.scrollInfo), pos = _a.pos, size = _a.size;\r\n        this.refreshStyle(size, pos);\r\n        this.currentPos = pos;\r\n    };\r\n    Indicator.prototype.caculatePosAndSize = function (point, scrollInfo) {\r\n        var posKey = this.keysMap.pos;\r\n        var sizeRatio = scrollInfo.sizeRatio, baseSize = scrollInfo.baseSize, maxScrollPos = scrollInfo.maxScrollPos, minScrollPos = scrollInfo.minScrollPos;\r\n        var minSize = this.options.minSize;\r\n        var pos = Math.round(sizeRatio * point[posKey]);\r\n        var size;\r\n        // when out of boundary, slow down size reduction\r\n        if (pos < minScrollPos) {\r\n            size = Math.max(baseSize + pos * 3, minSize);\r\n            pos = minScrollPos;\r\n        }\r\n        else if (pos > maxScrollPos) {\r\n            size = Math.max(baseSize - (pos - maxScrollPos) * 3, minSize);\r\n            pos = maxScrollPos + baseSize - size;\r\n        }\r\n        else {\r\n            size = baseSize;\r\n        }\r\n        return {\r\n            pos: pos,\r\n            size: size,\r\n        };\r\n    };\r\n    Indicator.prototype.refreshStyle = function (size, pos) {\r\n        var _a = this.keysMap, translatePropertyKey = _a.translateProperty, sizeKey = _a.size;\r\n        var translateZ = this.scroll.options.translateZ;\r\n        this.indicatorEl.style[sizeKey] = size + \"px\";\r\n        this.indicatorEl.style[style.transform] = translatePropertyKey + \"(\" + pos + \"px)\" + translateZ;\r\n    };\r\n    Indicator.prototype.startHandler = function () {\r\n        this.moved = false;\r\n        this.startTime = getNow();\r\n        this.transitionTime();\r\n        this.scroll.scroller.hooks.trigger(this.scroll.scroller.hooks.eventTypes.beforeScrollStart);\r\n    };\r\n    Indicator.prototype.moveHandler = function (delta) {\r\n        if (!this.moved && !this.indicatorNotMoved(delta)) {\r\n            this.moved = true;\r\n            this.scroll.scroller.hooks.trigger(this.scroll.scroller.hooks.eventTypes.scrollStart);\r\n        }\r\n        if (this.moved) {\r\n            var newPos = this.newPos(this.currentPos, delta, this.scrollInfo);\r\n            this.syncBScroll(newPos);\r\n        }\r\n    };\r\n    Indicator.prototype.endHandler = function () {\r\n        if (this.moved) {\r\n            var _a = this.scroll, x = _a.x, y = _a.y;\r\n            this.scroll.scroller.hooks.trigger(this.scroll.scroller.hooks.eventTypes.scrollEnd, {\r\n                x: x,\r\n                y: y,\r\n            });\r\n        }\r\n    };\r\n    Indicator.prototype.indicatorNotMoved = function (delta) {\r\n        var currentPos = this.currentPos;\r\n        var _a = this.scrollInfo, maxScrollPos = _a.maxScrollPos, minScrollPos = _a.minScrollPos;\r\n        var notMoved = (currentPos === minScrollPos && delta <= 0) ||\r\n            (currentPos === maxScrollPos && delta >= 0);\r\n        return notMoved;\r\n    };\r\n    Indicator.prototype.syncBScroll = function (newPos) {\r\n        var timestamp = getNow();\r\n        var _a = this.scroll, x = _a.x, y = _a.y, options = _a.options, scroller = _a.scroller, maxScrollY = _a.maxScrollY, minScrollY = _a.minScrollY, maxScrollX = _a.maxScrollX, minScrollX = _a.minScrollX;\r\n        var probeType = options.probeType, momentumLimitTime = options.momentumLimitTime;\r\n        var position = { x: x, y: y };\r\n        if (this.direction === \"vertical\" /* Vertical */) {\r\n            position.y = between(newPos, maxScrollY, minScrollY);\r\n        }\r\n        else {\r\n            position.x = between(newPos, maxScrollX, minScrollX);\r\n        }\r\n        scroller.translater.translate(position);\r\n        // dispatch scroll in interval time\r\n        if (timestamp - this.startTime > momentumLimitTime) {\r\n            this.startTime = timestamp;\r\n            if (probeType === 1 /* Throttle */) {\r\n                scroller.hooks.trigger(scroller.hooks.eventTypes.scroll, position);\r\n            }\r\n        }\r\n        // dispatch scroll all the time\r\n        if (probeType > 1 /* Throttle */) {\r\n            scroller.hooks.trigger(scroller.hooks.eventTypes.scroll, position);\r\n        }\r\n    };\r\n    Indicator.prototype.newPos = function (currentPos, delta, scrollInfo) {\r\n        var maxScrollPos = scrollInfo.maxScrollPos, sizeRatio = scrollInfo.sizeRatio, minScrollPos = scrollInfo.minScrollPos;\r\n        var newPos = currentPos + delta;\r\n        newPos = between(newPos, minScrollPos, maxScrollPos);\r\n        return Math.round(newPos / sizeRatio);\r\n    };\r\n    Indicator.prototype.destroy = function () {\r\n        var _a = this.options, interactive = _a.interactive, scrollbarTrackClickable = _a.scrollbarTrackClickable, isCustom = _a.isCustom;\r\n        if (interactive) {\r\n            this.eventHandler.destroy();\r\n        }\r\n        if (scrollbarTrackClickable) {\r\n            this.clickEventRegister.destroy();\r\n        }\r\n        if (!isCustom) {\r\n            this.wrapper.parentNode.removeChild(this.wrapper);\r\n        }\r\n        this.hooksFn.forEach(function (item) {\r\n            var hooks = item[0];\r\n            var hooksName = item[1];\r\n            var handlerFn = item[2];\r\n            hooks.off(hooksName, handlerFn);\r\n        });\r\n        this.hooksFn.length = 0;\r\n    };\r\n    return Indicator;\r\n}());\n\nvar ScrollBar = /** @class */ (function () {\r\n    function ScrollBar(scroll) {\r\n        this.scroll = scroll;\r\n        this.handleOptions();\r\n        this.createIndicators();\r\n        this.handleHooks();\r\n    }\r\n    ScrollBar.prototype.handleHooks = function () {\r\n        var _this = this;\r\n        var scroll = this.scroll;\r\n        scroll.hooks.on(scroll.hooks.eventTypes.destroy, function () {\r\n            for (var _i = 0, _a = _this.indicators; _i < _a.length; _i++) {\r\n                var indicator = _a[_i];\r\n                indicator.destroy();\r\n            }\r\n        });\r\n    };\r\n    ScrollBar.prototype.handleOptions = function () {\r\n        var userOptions = (this.scroll.options.scrollbar === true\r\n            ? {}\r\n            : this.scroll.options.scrollbar);\r\n        var defaultOptions = {\r\n            fade: true,\r\n            fadeInTime: 250,\r\n            fadeOutTime: 500,\r\n            interactive: false,\r\n            customElements: [],\r\n            minSize: 8,\r\n            scrollbarTrackClickable: false,\r\n            scrollbarTrackOffsetType: \"step\" /* Step */,\r\n            scrollbarTrackOffsetTime: 300,\r\n        };\r\n        this.options = extend(defaultOptions, userOptions);\r\n    };\r\n    ScrollBar.prototype.createIndicators = function () {\r\n        var indicatorOptions;\r\n        var scroll = this.scroll;\r\n        var indicators = [];\r\n        var scrollDirectionConfigKeys = ['scrollX', 'scrollY'];\r\n        var indicatorDirections = [\r\n            \"horizontal\" /* Horizontal */,\r\n            \"vertical\" /* Vertical */,\r\n        ];\r\n        var customScrollbarEls = this.options.customElements;\r\n        for (var i = 0; i < scrollDirectionConfigKeys.length; i++) {\r\n            var key = scrollDirectionConfigKeys[i];\r\n            // wanna scroll in specified direction\r\n            if (scroll.options[key]) {\r\n                var customElement = customScrollbarEls.shift();\r\n                var direction = indicatorDirections[i];\r\n                var isCustom = false;\r\n                var scrollbarWrapper = customElement\r\n                    ? customElement\r\n                    : this.createScrollbarElement(direction);\r\n                // internal scrollbar\r\n                if (scrollbarWrapper !== customElement) {\r\n                    scroll.wrapper.appendChild(scrollbarWrapper);\r\n                }\r\n                else {\r\n                    // custom scrollbar passed by users\r\n                    isCustom = true;\r\n                }\r\n                indicatorOptions = __assign(__assign({ wrapper: scrollbarWrapper, direction: direction }, this.options), { isCustom: isCustom });\r\n                indicators.push(new Indicator(scroll, indicatorOptions));\r\n            }\r\n        }\r\n        this.indicators = indicators;\r\n    };\r\n    ScrollBar.prototype.createScrollbarElement = function (direction, scrollbarTrackClickable) {\r\n        if (scrollbarTrackClickable === void 0) { scrollbarTrackClickable = this.options.scrollbarTrackClickable; }\r\n        var scrollbarWrapperEl = document.createElement('div');\r\n        var scrollbarIndicatorEl = document.createElement('div');\r\n        scrollbarWrapperEl.style.cssText =\r\n            'position:absolute;z-index:9999;overflow:hidden;';\r\n        scrollbarIndicatorEl.style.cssText =\r\n            'box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px;';\r\n        scrollbarIndicatorEl.className = 'bscroll-indicator';\r\n        if (direction === \"horizontal\" /* Horizontal */) {\r\n            scrollbarWrapperEl.style.cssText +=\r\n                'height:7px;left:2px;right:2px;bottom:0;';\r\n            scrollbarIndicatorEl.style.height = '100%';\r\n            scrollbarWrapperEl.className = 'bscroll-horizontal-scrollbar';\r\n        }\r\n        else {\r\n            scrollbarWrapperEl.style.cssText +=\r\n                'width:7px;bottom:2px;top:2px;right:1px;';\r\n            scrollbarIndicatorEl.style.width = '100%';\r\n            scrollbarWrapperEl.className = 'bscroll-vertical-scrollbar';\r\n        }\r\n        if (!scrollbarTrackClickable) {\r\n            scrollbarWrapperEl.style.cssText += 'pointer-events:none;';\r\n        }\r\n        scrollbarWrapperEl.appendChild(scrollbarIndicatorEl);\r\n        return scrollbarWrapperEl;\r\n    };\r\n    ScrollBar.pluginName = 'scrollbar';\r\n    return ScrollBar;\r\n}());\n\nexport { ScrollBar as default };\n","/*!\r\n * better-scroll / nested-scroll\r\n * (c) 2016-2020 ustbhuangyi\r\n * Released under the MIT License.\r\n */\r\n\r\n// Slightly modified to for Noodl to fix a problem:\r\n// - click bug. Click could be disabled and never enabled again when scrolling\r\n// - click bug 2. Click option didn't support the scroller being moved around in the dom tree\r\n//                It assumed the nested scroll relationships always stay the same\r\n//                (so doesn't work with delta updates)\r\n\r\nvar compatibleFeatures = {\r\n  duplicateClick: function (_a) {\r\n    var parentScroll = _a[0],\r\n      childScroll = _a[1];\r\n    // no need to make childScroll's click true\r\n    if (parentScroll.options.click && childScroll.options.click) {\r\n      childScroll.options.click = false;\r\n    }\r\n  },\r\n  nestedScroll: function (scrollsPair) {\r\n    var parentScroll = scrollsPair[0],\r\n      childScroll = scrollsPair[1];\r\n    var parentScrollX = parentScroll.options.scrollX;\r\n    var parentScrollY = parentScroll.options.scrollY;\r\n    var childScrollX = childScroll.options.scrollX;\r\n    var childScrollY = childScroll.options.scrollY;\r\n    // vertical nested in vertical scroll and horizontal nested in horizontal\r\n    // otherwise, no need to handle.\r\n    if (parentScrollX === childScrollX || parentScrollY === childScrollY) {\r\n      scrollsPair.forEach(function (scroll, index) {\r\n        var oppositeScroll = scrollsPair[(index + 1) % 2];\r\n        scroll.on('scrollStart', function () {\r\n          if (oppositeScroll.pending) {\r\n            oppositeScroll.stop();\r\n            oppositeScroll.resetPosition();\r\n          }\r\n          setupData(oppositeScroll);\r\n          oppositeScroll.disable();\r\n        });\r\n        scroll.on('touchEnd', function () {\r\n          oppositeScroll.enable();\r\n        });\r\n      });\r\n      childScroll.on('scrollStart', function () {\r\n        if (checkBeyondBoundary(childScroll)) {\r\n          childScroll.disable();\r\n          parentScroll.enable();\r\n        }\r\n      });\r\n    }\r\n  }\r\n};\r\nvar NestedScroll = /** @class */ (function () {\r\n  function NestedScroll(scroll) {\r\n    var singleton = NestedScroll.nestedScroll;\r\n    if (!(singleton instanceof NestedScroll)) {\r\n      singleton = NestedScroll.nestedScroll = this;\r\n      singleton.stores = [];\r\n    }\r\n    singleton.setup(scroll);\r\n    singleton.addHooks(scroll);\r\n    return singleton;\r\n  }\r\n  NestedScroll.prototype.setup = function (scroll) {\r\n    this.appendBScroll(scroll);\r\n    this.handleContainRelationship();\r\n    this.handleCompatible();\r\n  };\r\n  NestedScroll.prototype.addHooks = function (scroll) {\r\n    var _this = this;\r\n    scroll.on('destroy', function () {\r\n      _this.teardown(scroll);\r\n    });\r\n  };\r\n  NestedScroll.prototype.teardown = function (scroll) {\r\n    this.removeBScroll(scroll);\r\n    this.handleContainRelationship();\r\n    this.handleCompatible();\r\n  };\r\n  NestedScroll.prototype.appendBScroll = function (scroll) {\r\n    this.stores.push(scroll);\r\n  };\r\n  NestedScroll.prototype.removeBScroll = function (scroll) {\r\n    var index = this.stores.indexOf(scroll);\r\n    if (index === -1) return;\r\n    scroll.wrapper.isBScrollContainer = undefined;\r\n    this.stores.splice(index, 1);\r\n  };\r\n  NestedScroll.prototype.handleContainRelationship = function () {\r\n    // bs's length <= 1\r\n    var stores = this.stores;\r\n    if (stores.length <= 1) {\r\n      // there is only a childBScroll left.\r\n      if (stores[0] && stores[0].__parentInfo) {\r\n        stores[0].__parentInfo = undefined;\r\n      }\r\n      return;\r\n    }\r\n    var outerBS;\r\n    var outerBSWrapper;\r\n    var innerBS;\r\n    var innerBSWrapper;\r\n    // Need two layers of \"For loop\" to calculate parent-child relationship\r\n    for (var i = 0; i < stores.length; i++) {\r\n      outerBS = stores[i];\r\n      outerBSWrapper = outerBS.wrapper;\r\n      for (var j = 0; j < stores.length; j++) {\r\n        innerBS = stores[j];\r\n        innerBSWrapper = innerBS.wrapper;\r\n        // same bs\r\n        if (outerBS === innerBS) continue;\r\n        // now start calculating\r\n        if (!innerBSWrapper.contains(outerBSWrapper)) continue;\r\n        // now innerBS contains outerBS\r\n        // no parentInfo yet\r\n        if (!outerBS.__parentInfo) {\r\n          outerBS.__parentInfo = {\r\n            parent: innerBS,\r\n            depth: calculateDepths(outerBSWrapper, innerBSWrapper)\r\n          };\r\n        } else {\r\n          // has parentInfo already!\r\n          // just judge the \"true\" parent by depth\r\n          // we regard the latest node as parent, not the furthest\r\n          var currentDepths = calculateDepths(outerBSWrapper, innerBSWrapper);\r\n          var prevDepths = outerBS.__parentInfo.depth;\r\n          // refresh currentBS as parentScroll\r\n          if (prevDepths > currentDepths) {\r\n            outerBS.__parentInfo = {\r\n              parent: innerBS,\r\n              depth: currentDepths\r\n            };\r\n          }\r\n        }\r\n      }\r\n    }\r\n  };\r\n  NestedScroll.prototype.handleCompatible = function () {\r\n    var pairs = this.availableBScrolls();\r\n    var keys = ['duplicateClick', 'nestedScroll'];\r\n    pairs.forEach(function (pair) {\r\n      keys.forEach(function (key) {\r\n        compatibleFeatures[key](pair);\r\n      });\r\n    });\r\n  };\r\n  NestedScroll.prototype.availableBScrolls = function () {\r\n    var ret = [];\r\n    ret = this.stores\r\n      .filter(function (bs) {\r\n        return !!bs.__parentInfo;\r\n      })\r\n      .map(function (bs) {\r\n        return [bs.__parentInfo.parent, bs];\r\n      });\r\n    return ret;\r\n  };\r\n  NestedScroll.pluginName = 'nestedScroll';\r\n  return NestedScroll;\r\n})();\r\nfunction calculateDepths(childNode, parentNode) {\r\n  var depth = 0;\r\n  var parent = childNode.parentNode;\r\n  while (parent && parent !== parentNode) {\r\n    depth++;\r\n    parent = parent.parentNode;\r\n  }\r\n  return depth;\r\n}\r\nfunction checkBeyondBoundary(scroll) {\r\n  var _a = hasScroll(scroll),\r\n    hasHorizontalScroll = _a.hasHorizontalScroll,\r\n    hasVerticalScroll = _a.hasVerticalScroll;\r\n  var _b = scroll.scroller,\r\n    scrollBehaviorX = _b.scrollBehaviorX,\r\n    scrollBehaviorY = _b.scrollBehaviorY;\r\n  var hasReachLeft = scroll.x >= scroll.minScrollX && scrollBehaviorX.movingDirection === -1;\r\n  var hasReachRight = scroll.x <= scroll.maxScrollX && scrollBehaviorX.movingDirection === 1;\r\n  var hasReachTop = scroll.y >= scroll.minScrollY && scrollBehaviorY.movingDirection === -1;\r\n  var hasReachBottom = scroll.y <= scroll.maxScrollY && scrollBehaviorY.movingDirection === 1;\r\n  if (hasVerticalScroll) {\r\n    return hasReachTop || hasReachBottom;\r\n  } else if (hasHorizontalScroll) {\r\n    return hasReachLeft || hasReachRight;\r\n  }\r\n  return false;\r\n}\r\nfunction setupData(scroll) {\r\n  var _a = hasScroll(scroll),\r\n    hasHorizontalScroll = _a.hasHorizontalScroll,\r\n    hasVerticalScroll = _a.hasVerticalScroll;\r\n  var _b = scroll.scroller,\r\n    actions = _b.actions,\r\n    scrollBehaviorX = _b.scrollBehaviorX,\r\n    scrollBehaviorY = _b.scrollBehaviorY;\r\n  actions.startTime = +new Date();\r\n  if (hasVerticalScroll) {\r\n    scrollBehaviorY.startPos = scrollBehaviorY.currentPos;\r\n  } else if (hasHorizontalScroll) {\r\n    scrollBehaviorX.startPos = scrollBehaviorX.currentPos;\r\n  }\r\n}\r\nfunction hasScroll(scroll) {\r\n  return {\r\n    hasHorizontalScroll: scroll.scroller.scrollBehaviorX.hasScroll,\r\n    hasVerticalScroll: scroll.scroller.scrollBehaviorY.hasScroll\r\n  };\r\n}\r\n\r\nexport default NestedScroll;\r\n","/*!\r\n * better-scroll / slide\r\n * (c) 2016-2020 ustbhuangyi\r\n * Released under the MIT License.\r\n */\r\n\r\n//adapted to Noodl's more dynamic delta update environment:\r\n// - A scroll refresh doesn't reset the current slide page position\r\n// - Horizontal slider doesn't break when there are no children\r\n\r\nfunction warn(msg) {\r\n  console.error('[BScroll warn]: ' + msg);\r\n}\r\n\r\n// ssr support\r\nvar inBrowser = typeof window !== 'undefined';\r\nvar ua = inBrowser && navigator.userAgent.toLowerCase();\r\nvar isWeChatDevTools = ua && /wechatdevtools/.test(ua);\r\nvar isAndroid = ua && ua.indexOf('android') > 0;\r\n\r\nfunction extend(target) {\r\n  var rest = [];\r\n  for (var _i = 1; _i < arguments.length; _i++) {\r\n    rest[_i - 1] = arguments[_i];\r\n  }\r\n  for (var i = 0; i < rest.length; i++) {\r\n    var source = rest[i];\r\n    for (var key in source) {\r\n      target[key] = source[key];\r\n    }\r\n  }\r\n  return target;\r\n}\r\nfunction fixInboundValue(x, min, max) {\r\n  if (x < min) {\r\n    return min;\r\n  }\r\n  if (x > max) {\r\n    return max;\r\n  }\r\n  return x;\r\n}\r\n\r\nvar elementStyle = inBrowser && document.createElement('div').style;\r\nvar vendor = (function () {\r\n  if (!inBrowser) {\r\n    return false;\r\n  }\r\n  var transformNames = {\r\n    webkit: 'webkitTransform',\r\n    Moz: 'MozTransform',\r\n    O: 'OTransform',\r\n    ms: 'msTransform',\r\n    standard: 'transform'\r\n  };\r\n  for (var key in transformNames) {\r\n    if (elementStyle[transformNames[key]] !== undefined) {\r\n      return key;\r\n    }\r\n  }\r\n  return false;\r\n})();\r\nfunction prefixStyle(style) {\r\n  if (vendor === false) {\r\n    return style;\r\n  }\r\n  if (vendor === 'standard') {\r\n    if (style === 'transitionEnd') {\r\n      return 'transitionend';\r\n    }\r\n    return style;\r\n  }\r\n  return vendor + style.charAt(0).toUpperCase() + style.substr(1);\r\n}\r\nvar cssVendor = vendor && vendor !== 'standard' ? '-' + vendor.toLowerCase() + '-' : '';\r\nvar transform = prefixStyle('transform');\r\nvar transition = prefixStyle('transition');\r\nvar hasPerspective = inBrowser && prefixStyle('perspective') in elementStyle;\r\nvar style = {\r\n  transform: transform,\r\n  transition: transition,\r\n  transitionTimingFunction: prefixStyle('transitionTimingFunction'),\r\n  transitionDuration: prefixStyle('transitionDuration'),\r\n  transitionDelay: prefixStyle('transitionDelay'),\r\n  transformOrigin: prefixStyle('transformOrigin'),\r\n  transitionEnd: prefixStyle('transitionEnd')\r\n};\r\nfunction getRect(el) {\r\n  if (el instanceof window.SVGElement) {\r\n    var rect = el.getBoundingClientRect();\r\n    return {\r\n      top: rect.top,\r\n      left: rect.left,\r\n      width: rect.width,\r\n      height: rect.height\r\n    };\r\n  } else {\r\n    return {\r\n      top: el.offsetTop,\r\n      left: el.offsetLeft,\r\n      width: el.offsetWidth,\r\n      height: el.offsetHeight\r\n    };\r\n  }\r\n}\r\nfunction prepend(el, target) {\r\n  var firstChild = target.firstChild;\r\n  if (firstChild) {\r\n    before(el, firstChild);\r\n  } else {\r\n    target.appendChild(el);\r\n  }\r\n}\r\nfunction before(el, target) {\r\n  target.parentNode.insertBefore(el, target);\r\n}\r\nfunction removeChild(el, child) {\r\n  el.removeChild(child);\r\n}\r\n\r\nvar ease = {\r\n  // easeOutQuint\r\n  swipe: {\r\n    style: 'cubic-bezier(0.23, 1, 0.32, 1)',\r\n    fn: function (t) {\r\n      return 1 + --t * t * t * t * t;\r\n    }\r\n  },\r\n  // easeOutQuard\r\n  swipeBounce: {\r\n    style: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)',\r\n    fn: function (t) {\r\n      return t * (2 - t);\r\n    }\r\n  },\r\n  // easeOutQuart\r\n  bounce: {\r\n    style: 'cubic-bezier(0.165, 0.84, 0.44, 1)',\r\n    fn: function (t) {\r\n      return 1 - --t * t * t * t;\r\n    }\r\n  }\r\n};\r\n\r\nvar DEFAULT_INTERVAL = 100 / 60;\r\nvar windowCompat = inBrowser && window;\r\nfunction noop() {}\r\nvar requestAnimationFrame = (function () {\r\n  if (!inBrowser) {\r\n    /* istanbul ignore if */\r\n    return noop;\r\n  }\r\n  return (\r\n    windowCompat.requestAnimationFrame ||\r\n    windowCompat.webkitRequestAnimationFrame ||\r\n    windowCompat.mozRequestAnimationFrame ||\r\n    windowCompat.oRequestAnimationFrame ||\r\n    // if all else fails, use setTimeout\r\n    function (callback) {\r\n      return window.setTimeout(callback, (callback.interval || DEFAULT_INTERVAL) / 2); // make interval as precise as possible.\r\n    }\r\n  );\r\n})();\r\nvar cancelAnimationFrame = (function () {\r\n  if (!inBrowser) {\r\n    /* istanbul ignore if */\r\n    return noop;\r\n  }\r\n  return (\r\n    windowCompat.cancelAnimationFrame ||\r\n    windowCompat.webkitCancelAnimationFrame ||\r\n    windowCompat.mozCancelAnimationFrame ||\r\n    windowCompat.oCancelAnimationFrame ||\r\n    function (id) {\r\n      window.clearTimeout(id);\r\n    }\r\n  );\r\n})();\r\n\r\nvar PagesPos = /** @class */ (function () {\r\n  function PagesPos(scroll, slideOpt) {\r\n    this.scroll = scroll;\r\n    this.slideOpt = slideOpt;\r\n    this.slideEl = null;\r\n    this.init();\r\n  }\r\n  PagesPos.prototype.init = function () {\r\n    var scrollerIns = this.scroll.scroller;\r\n    var scrollBehaviorX = scrollerIns.scrollBehaviorX;\r\n    var scrollBehaviorY = scrollerIns.scrollBehaviorY;\r\n    var wrapper = getRect(scrollerIns.wrapper);\r\n    var scroller = getRect(scrollerIns.content);\r\n    this.wrapperWidth = wrapper.width;\r\n    this.wrapperHeight = wrapper.height;\r\n    this.scrollerHeight = scrollBehaviorY.hasScroll ? scroller.height : wrapper.height;\r\n    this.scrollerWidth = scrollBehaviorX.hasScroll ? scroller.width : wrapper.width;\r\n    var stepX = this.slideOpt.stepX || this.wrapperWidth;\r\n    var stepY = this.slideOpt.stepY || this.wrapperHeight;\r\n    var slideEls = scrollerIns.content;\r\n    var el = this.slideOpt.el;\r\n    if (typeof el === 'string') {\r\n      this.slideEl = slideEls.querySelectorAll(el);\r\n    }\r\n    this.pages = this.slideEl ? this.computePagePosInfoByEl(this.slideEl) : this.computePagePosInfo(stepX, stepY);\r\n    this.xLen = this.pages ? this.pages.length : 0;\r\n    this.yLen = this.pages && this.pages[0] ? this.pages[0].length : 0;\r\n  };\r\n  PagesPos.prototype.hasInfo = function () {\r\n    if (!this.pages || !this.pages.length) {\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n  PagesPos.prototype.getPos = function (x, y) {\r\n    return this.pages[x] ? this.pages[x][y] : null;\r\n  };\r\n  PagesPos.prototype.getNearestPage = function (x, y) {\r\n    if (!this.hasInfo()) {\r\n      return;\r\n    }\r\n    var pageX = 0;\r\n    var pageY = 0;\r\n    var l = this.pages.length;\r\n    for (; pageX < l - 1; pageX++) {\r\n      if (x >= this.pages[pageX][0].cx) {\r\n        break;\r\n      }\r\n    }\r\n    l = this.pages[pageX].length;\r\n    for (; pageY < l - 1; pageY++) {\r\n      if (y >= this.pages[0][pageY].cy) {\r\n        break;\r\n      }\r\n    }\r\n    return {\r\n      pageX: pageX,\r\n      pageY: pageY\r\n    };\r\n  };\r\n  PagesPos.prototype.computePagePosInfo = function (stepX, stepY) {\r\n    var pages = [];\r\n    var x = 0;\r\n    var y;\r\n    var cx;\r\n    var cy;\r\n    var i = 0;\r\n    var l;\r\n    var maxScrollPosX = this.scroll.scroller.scrollBehaviorX.maxScrollPos;\r\n    var maxScrollPosY = this.scroll.scroller.scrollBehaviorY.maxScrollPos;\r\n    cx = Math.round(stepX / 2);\r\n    cy = Math.round(stepY / 2);\r\n    while (x > -this.scrollerWidth) {\r\n      pages[i] = [];\r\n      l = 0;\r\n      y = 0;\r\n      while (y > -this.scrollerHeight) {\r\n        pages[i][l] = {\r\n          x: Math.max(x, maxScrollPosX),\r\n          y: Math.max(y, maxScrollPosY),\r\n          width: stepX,\r\n          height: stepY,\r\n          cx: x - cx,\r\n          cy: y - cy\r\n        };\r\n        y -= stepY;\r\n        l++;\r\n      }\r\n      x -= stepX;\r\n      i++;\r\n    }\r\n    return pages;\r\n  };\r\n  PagesPos.prototype.computePagePosInfoByEl = function (el) {\r\n    var pages = [];\r\n    var x = 0;\r\n    var y = 0;\r\n    var cx;\r\n    var cy;\r\n    var i = 0;\r\n    var l = el.length;\r\n    var m = 0;\r\n    var n = -1;\r\n    var rect;\r\n    var maxScrollX = this.scroll.scroller.scrollBehaviorX.maxScrollPos;\r\n    var maxScrollY = this.scroll.scroller.scrollBehaviorY.maxScrollPos;\r\n    for (; i < l; i++) {\r\n      rect = getRect(el[i]);\r\n      if (i === 0 || rect.left <= getRect(el[i - 1]).left) {\r\n        m = 0;\r\n        n++;\r\n      }\r\n      if (!pages[m]) {\r\n        pages[m] = [];\r\n      }\r\n      x = Math.max(-rect.left, maxScrollX);\r\n      y = Math.max(-rect.top, maxScrollY);\r\n      cx = x - Math.round(rect.width / 2);\r\n      cy = y - Math.round(rect.height / 2);\r\n      pages[m][n] = {\r\n        x: x,\r\n        y: y,\r\n        width: rect.width,\r\n        height: rect.height,\r\n        cx: cx,\r\n        cy: cy\r\n      };\r\n      if (x > maxScrollX) {\r\n        m++;\r\n      }\r\n    }\r\n    return pages;\r\n  };\r\n  return PagesPos;\r\n})();\r\n\r\nvar PageInfo = /** @class */ (function () {\r\n  function PageInfo(scroll, slideOpt) {\r\n    this.scroll = scroll;\r\n    this.slideOpt = slideOpt;\r\n  }\r\n  PageInfo.prototype.init = function () {\r\n    this.currentPage = {\r\n      x: 0,\r\n      y: 0,\r\n      pageX: 0,\r\n      pageY: 0\r\n    };\r\n    this.pagesPos = new PagesPos(this.scroll, this.slideOpt);\r\n    this.checkSlideLoop();\r\n  };\r\n  PageInfo.prototype.changeCurrentPage = function (newPage) {\r\n    this.currentPage = newPage;\r\n  };\r\n  PageInfo.prototype.change2safePage = function (pageX, pageY) {\r\n    if (!this.pagesPos.hasInfo()) {\r\n      return;\r\n    }\r\n    if (pageX >= this.pagesPos.xLen) {\r\n      pageX = this.pagesPos.xLen - 1;\r\n    } else if (pageX < 0) {\r\n      pageX = 0;\r\n    }\r\n    if (pageY >= this.pagesPos.yLen) {\r\n      pageY = this.pagesPos.yLen - 1;\r\n    } else if (pageY < 0) {\r\n      pageY = 0;\r\n    }\r\n    var _a = this.pagesPos.getPos(pageX, pageY);\r\n    return {\r\n      pageX: pageX,\r\n      pageY: pageY,\r\n      x: _a ? _a.x : 0,\r\n      y: _a ? _a.y : 0\r\n    };\r\n  };\r\n  PageInfo.prototype.getInitPage = function () {\r\n    var initPageX = this.loopX ? 1 : 0;\r\n    var initPageY = this.loopY ? 1 : 0;\r\n    return {\r\n      pageX: initPageX,\r\n      pageY: initPageY\r\n    };\r\n  };\r\n  PageInfo.prototype.getRealPage = function (page) {\r\n    var fixedPage = function (page, realPageLen) {\r\n      var pageIndex = [];\r\n      for (var i = 0; i < realPageLen; i++) {\r\n        pageIndex.push(i);\r\n      }\r\n      pageIndex.unshift(realPageLen - 1);\r\n      pageIndex.push(0);\r\n      return pageIndex[page];\r\n    };\r\n    var currentPage = page ? extend({}, page) : extend({}, this.currentPage);\r\n    if (this.loopX) {\r\n      currentPage.pageX = fixedPage(currentPage.pageX, this.pagesPos.xLen - 2);\r\n    }\r\n    if (this.loopY) {\r\n      currentPage.pageY = fixedPage(currentPage.pageY, this.pagesPos.yLen - 2);\r\n    }\r\n    return {\r\n      pageX: currentPage.pageX,\r\n      pageY: currentPage.pageY\r\n    };\r\n  };\r\n  PageInfo.prototype.getPageSize = function () {\r\n    return this.pagesPos.getPos(this.currentPage.pageX, this.currentPage.pageY);\r\n  };\r\n  PageInfo.prototype.realPage2Page = function (x, y) {\r\n    if (!this.pagesPos.hasInfo()) {\r\n      return;\r\n    }\r\n    var lastX = this.pagesPos.xLen - 1;\r\n    var lastY = this.pagesPos.yLen - 1;\r\n    var firstX = 0;\r\n    var firstY = 0;\r\n    if (this.loopX) {\r\n      x += 1;\r\n      firstX = firstX + 1;\r\n      lastX = lastX - 1;\r\n    }\r\n    if (this.loopY) {\r\n      y += 1;\r\n      firstY = firstY + 1;\r\n      lastY = lastY - 1;\r\n    }\r\n    x = fixInboundValue(x, firstX, lastX);\r\n    y = fixInboundValue(y, firstY, lastY);\r\n    return {\r\n      realX: x,\r\n      realY: y\r\n    };\r\n  };\r\n  PageInfo.prototype.nextPage = function () {\r\n    return this.changedPageNum('positive' /* Positive */);\r\n  };\r\n  PageInfo.prototype.prevPage = function () {\r\n    return this.changedPageNum('negative' /* Negative */);\r\n  };\r\n  PageInfo.prototype.nearestPage = function (x, y, directionX, directionY) {\r\n    var pageInfo = this.pagesPos.getNearestPage(x, y);\r\n    if (!pageInfo) {\r\n      return {\r\n        x: 0,\r\n        y: 0,\r\n        pageX: 0,\r\n        pageY: 0\r\n      };\r\n    }\r\n    var pageX = pageInfo.pageX;\r\n    var pageY = pageInfo.pageY;\r\n    var newX;\r\n    var newY;\r\n    if (pageX === this.currentPage.pageX) {\r\n      pageX += directionX;\r\n      pageX = fixInboundValue(pageX, 0, this.pagesPos.xLen - 1);\r\n    }\r\n    if (pageY === this.currentPage.pageY) {\r\n      pageY += directionY;\r\n      pageY = fixInboundValue(pageInfo.pageY, 0, this.pagesPos.yLen - 1);\r\n    }\r\n    newX = this.pagesPos.getPos(pageX, 0).x;\r\n    newY = this.pagesPos.getPos(0, pageY).y;\r\n    return {\r\n      x: newX,\r\n      y: newY,\r\n      pageX: pageX,\r\n      pageY: pageY\r\n    };\r\n  };\r\n  PageInfo.prototype.getLoopStage = function () {\r\n    if (!this.needLoop) {\r\n      return 'middle' /* Middle */;\r\n    }\r\n    if (this.loopX) {\r\n      if (this.currentPage.pageX === 0) {\r\n        return 'head' /* Head */;\r\n      }\r\n      if (this.currentPage.pageX === this.pagesPos.xLen - 1) {\r\n        return 'tail' /* Tail */;\r\n      }\r\n    }\r\n    if (this.loopY) {\r\n      if (this.currentPage.pageY === 0) {\r\n        return 'head' /* Head */;\r\n      }\r\n      if (this.currentPage.pageY === this.pagesPos.yLen - 1) {\r\n        return 'tail' /* Tail */;\r\n      }\r\n    }\r\n    return 'middle' /* Middle */;\r\n  };\r\n  PageInfo.prototype.resetLoopPage = function () {\r\n    if (this.loopX) {\r\n      if (this.currentPage.pageX === 0) {\r\n        return {\r\n          pageX: this.pagesPos.xLen - 2,\r\n          pageY: this.currentPage.pageY\r\n        };\r\n      }\r\n      if (this.currentPage.pageX === this.pagesPos.xLen - 1) {\r\n        return {\r\n          pageX: 1,\r\n          pageY: this.currentPage.pageY\r\n        };\r\n      }\r\n    }\r\n    if (this.loopY) {\r\n      if (this.currentPage.pageY === 0) {\r\n        return {\r\n          pageX: this.currentPage.pageX,\r\n          pageY: this.pagesPos.yLen - 2\r\n        };\r\n      }\r\n      if (this.currentPage.pageY === this.pagesPos.yLen - 1) {\r\n        return {\r\n          pageX: this.currentPage.pageX,\r\n          pageY: 1\r\n        };\r\n      }\r\n    }\r\n  };\r\n  PageInfo.prototype.isSameWithCurrent = function (page) {\r\n    if (page.pageX !== this.currentPage.pageX || page.pageY !== this.currentPage.pageY) {\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n  PageInfo.prototype.changedPageNum = function (direction) {\r\n    var x = this.currentPage.pageX;\r\n    var y = this.currentPage.pageY;\r\n    if (this.slideX) {\r\n      x = direction === 'negative' /* Negative */ ? x - 1 : x + 1;\r\n    }\r\n    if (this.slideY) {\r\n      y = direction === 'negative' /* Negative */ ? y - 1 : y + 1;\r\n    }\r\n    return {\r\n      pageX: x,\r\n      pageY: y\r\n    };\r\n  };\r\n  PageInfo.prototype.checkSlideLoop = function () {\r\n    this.needLoop = this.slideOpt.loop;\r\n    if (this.pagesPos.xLen > 1) {\r\n      this.slideX = true;\r\n    }\r\n    if (this.pagesPos.pages[0] && this.pagesPos.yLen > 1) {\r\n      this.slideY = true;\r\n    }\r\n    this.loopX = this.needLoop && this.slideX;\r\n    this.loopY = this.needLoop && this.slideY;\r\n    if (this.slideX && this.slideY) {\r\n      warn('slide does not support two direction at the same time.');\r\n    }\r\n  };\r\n  return PageInfo;\r\n})();\r\n\r\nvar sourcePrefix = 'plugins.slide';\r\nvar propertiesMap = [\r\n  {\r\n    key: 'next',\r\n    name: 'next'\r\n  },\r\n  {\r\n    key: 'prev',\r\n    name: 'prev'\r\n  },\r\n  {\r\n    key: 'goToPage',\r\n    name: 'goToPage'\r\n  },\r\n  {\r\n    key: 'getCurrentPage',\r\n    name: 'getCurrentPage'\r\n  }\r\n];\r\nvar propertiesConfig = propertiesMap.map(function (item) {\r\n  return {\r\n    key: item.key,\r\n    sourceKey: sourcePrefix + '.' + item.name\r\n  };\r\n});\r\n\r\nvar Slide = /** @class */ (function () {\r\n  function Slide(scroll) {\r\n    this.scroll = scroll;\r\n    this.resetLooping = false;\r\n    this.isTouching = false;\r\n    this.scroll.proxy(propertiesConfig);\r\n    this.scroll.registerType(['slideWillChange']);\r\n    this.slideOpt = this.scroll.options.slide;\r\n    this.page = new PageInfo(scroll, this.slideOpt);\r\n    this.hooksFn = [];\r\n    this.willChangeToPage = {\r\n      pageX: 0,\r\n      pageY: 0\r\n    };\r\n    this.init();\r\n  }\r\n  Slide.prototype.init = function () {\r\n    var _this = this;\r\n    var slide = this.slideOpt;\r\n    var slideEls = this.scroll.scroller.content;\r\n    var lazyInitByRefresh = false;\r\n    if (slide.loop) {\r\n      var children = slideEls.children;\r\n      if (children.length > 1) {\r\n        this.cloneSlideEleForLoop(slideEls);\r\n        lazyInitByRefresh = true;\r\n      } else {\r\n        // Loop does not make any sense if there is only one child.\r\n        slide.loop = false;\r\n      }\r\n    }\r\n    var shouldRefreshByWidth = this.setSlideWidth(slideEls);\r\n    var shouldRefreshByHeight = this.setSlideHeight(this.scroll.scroller.wrapper, slideEls);\r\n    var shouldRefresh = shouldRefreshByWidth || shouldRefreshByHeight;\r\n    var scrollHooks = this.scroll.hooks;\r\n    var scrollerHooks = this.scroll.scroller.hooks;\r\n    this.registorHooks(scrollHooks, 'refresh', this.initSlideState);\r\n    this.registorHooks(scrollHooks, 'destroy', this.destroy);\r\n    this.registorHooks(scrollerHooks, 'momentum', this.modifyScrollMetaHandler);\r\n    // scrollEnd handler should be called before customized handlers\r\n    this.registorHooks(this.scroll, 'scrollEnd', this.amendCurrentPage);\r\n    this.registorHooks(scrollerHooks, 'beforeStart', this.setTouchFlag);\r\n    this.registorHooks(scrollerHooks, 'scroll', this.scrollMoving);\r\n    this.registorHooks(scrollerHooks, 'resize', this.resize);\r\n    // for mousewheel event\r\n    if (this.scroll.eventTypes.mousewheelMove && this.scroll.eventTypes.mousewheelEnd) {\r\n      this.registorHooks(this.scroll, 'mousewheelMove', function () {\r\n        // prevent default action of mousewheelMove\r\n        return true;\r\n      });\r\n      this.registorHooks(this.scroll, 'mousewheelEnd', function (delta) {\r\n        if (delta.directionX === 1 /* Positive */ || delta.directionY === 1 /* Positive */) {\r\n          _this.next();\r\n        }\r\n        if (delta.directionX === -1 /* Negative */ || delta.directionY === -1 /* Negative */) {\r\n          _this.prev();\r\n        }\r\n      });\r\n    }\r\n    if (slide.listenFlick !== false) {\r\n      this.registorHooks(scrollerHooks, 'flick', this.flickHandler);\r\n    }\r\n    if (!lazyInitByRefresh && !shouldRefresh) {\r\n      this.initSlideState();\r\n    } else {\r\n      this.scroll.refresh();\r\n    }\r\n  };\r\n  Slide.prototype.resize = function () {\r\n    var _this = this;\r\n    var slideEls = this.scroll.scroller.content;\r\n    var slideWrapper = this.scroll.scroller.wrapper;\r\n    clearTimeout(this.resizeTimeout);\r\n    this.resizeTimeout = window.setTimeout(function () {\r\n      _this.clearSlideWidth(slideEls);\r\n      _this.clearSlideHeight(slideEls);\r\n      _this.setSlideWidth(slideEls);\r\n      _this.setSlideHeight(slideWrapper, slideEls);\r\n      _this.scroll.refresh();\r\n    }, this.scroll.options.resizePolling);\r\n    return true;\r\n  };\r\n  Slide.prototype.next = function (time, easing) {\r\n    var _a = this.page.nextPage(),\r\n      pageX = _a.pageX,\r\n      pageY = _a.pageY;\r\n    this.goTo(pageX, pageY, time, easing);\r\n  };\r\n  Slide.prototype.prev = function (time, easing) {\r\n    var _a = this.page.prevPage(),\r\n      pageX = _a.pageX,\r\n      pageY = _a.pageY;\r\n    this.goTo(pageX, pageY, time, easing);\r\n  };\r\n  Slide.prototype.goToPage = function (x, y, time, easing) {\r\n    var pageInfo = this.page.realPage2Page(x, y);\r\n    if (!pageInfo) {\r\n      return;\r\n    }\r\n    this.goTo(pageInfo.realX, pageInfo.realY, time, easing);\r\n  };\r\n  Slide.prototype.getCurrentPage = function () {\r\n    return this.page.getRealPage();\r\n  };\r\n  Slide.prototype.nearestPage = function (x, y) {\r\n    var scrollBehaviorX = this.scroll.scroller.scrollBehaviorX;\r\n    var scrollBehaviorY = this.scroll.scroller.scrollBehaviorY;\r\n    var triggerThreshold = true;\r\n    if (\r\n      Math.abs(x - scrollBehaviorX.absStartPos) <= this.thresholdX &&\r\n      Math.abs(y - scrollBehaviorY.absStartPos) <= this.thresholdY\r\n    ) {\r\n      triggerThreshold = false;\r\n    }\r\n    if (!triggerThreshold) {\r\n      return this.page.currentPage;\r\n    }\r\n    return this.page.nearestPage(\r\n      fixInboundValue(x, scrollBehaviorX.maxScrollPos, scrollBehaviorX.minScrollPos),\r\n      fixInboundValue(y, scrollBehaviorY.maxScrollPos, scrollBehaviorY.minScrollPos),\r\n      scrollBehaviorX.direction,\r\n      scrollBehaviorY.direction\r\n    );\r\n  };\r\n  Slide.prototype.destroy = function () {\r\n    var slideEls = this.scroll.scroller.content;\r\n    if (this.slideOpt.loop) {\r\n      var children = slideEls.children;\r\n      if (children.length > 2) {\r\n        removeChild(slideEls, children[children.length - 1]);\r\n        removeChild(slideEls, children[0]);\r\n      }\r\n    }\r\n    this.hooksFn.forEach(function (item) {\r\n      var hooks = item[0];\r\n      var hooksName = item[1];\r\n      var handlerFn = item[2];\r\n      if (hooks.eventTypes[hooksName]) {\r\n        hooks.off(hooksName, handlerFn);\r\n      }\r\n    });\r\n    this.hooksFn.length = 0;\r\n  };\r\n  Slide.prototype.initSlideState = function () {\r\n    const prevPage = this.page.currentPage;\r\n    this.page.init();\r\n    if (prevPage) {\r\n      this.page.currentPage = prevPage;\r\n    } else {\r\n      var initPage = this.page.getInitPage();\r\n      this.goTo(initPage.pageX, initPage.pageY, 0);\r\n    }\r\n\r\n    this.initThreshold();\r\n  };\r\n  Slide.prototype.initThreshold = function () {\r\n    var slideThreshold = this.slideOpt.threshold || 0.1;\r\n    if (slideThreshold % 1 === 0) {\r\n      this.thresholdX = slideThreshold;\r\n      this.thresholdY = slideThreshold;\r\n    } else {\r\n      var pageSize = this.page.getPageSize();\r\n      if (pageSize) {\r\n        this.thresholdX = Math.round(pageSize.width * slideThreshold);\r\n        this.thresholdY = Math.round(pageSize.height * slideThreshold);\r\n      }\r\n    }\r\n  };\r\n  Slide.prototype.cloneSlideEleForLoop = function (slideEls) {\r\n    var children = slideEls.children;\r\n    prepend(children[children.length - 1].cloneNode(true), slideEls);\r\n    slideEls.appendChild(children[1].cloneNode(true));\r\n  };\r\n  Slide.prototype.amendCurrentPage = function () {\r\n    this.isTouching = false;\r\n    if (!this.slideOpt.loop) {\r\n      return;\r\n    }\r\n    // triggered by resetLoop\r\n    if (this.resetLooping) {\r\n      this.resetLooping = false;\r\n      return;\r\n    }\r\n    // fix bug: scroll two page or even more page at once and fetch the boundary.\r\n    // In this case, momentum won't be trigger, so the pageIndex will be wrong and won't be trigger reset.\r\n    var isScrollToBoundary = false;\r\n    if (\r\n      this.page.loopX &&\r\n      (this.scroll.x === this.scroll.scroller.scrollBehaviorX.minScrollPos ||\r\n        this.scroll.x === this.scroll.scroller.scrollBehaviorX.maxScrollPos)\r\n    ) {\r\n      isScrollToBoundary = true;\r\n    }\r\n    if (\r\n      this.page.loopY &&\r\n      (this.scroll.y === this.scroll.scroller.scrollBehaviorY.minScrollPos ||\r\n        this.scroll.y === this.scroll.scroller.scrollBehaviorY.maxScrollPos)\r\n    ) {\r\n      isScrollToBoundary = true;\r\n    }\r\n    if (isScrollToBoundary) {\r\n      var scrollBehaviorX = this.scroll.scroller.scrollBehaviorX;\r\n      var scrollBehaviorY = this.scroll.scroller.scrollBehaviorY;\r\n      var newPos = this.page.nearestPage(\r\n        fixInboundValue(this.scroll.x, scrollBehaviorX.maxScrollPos, scrollBehaviorX.minScrollPos),\r\n        fixInboundValue(this.scroll.y, scrollBehaviorY.maxScrollPos, scrollBehaviorY.minScrollPos),\r\n        0,\r\n        0\r\n      );\r\n      var newPage = {\r\n        x: newPos.x,\r\n        y: newPos.y,\r\n        pageX: newPos.pageX,\r\n        pageY: newPos.pageY\r\n      };\r\n      if (!this.page.isSameWithCurrent(newPage)) {\r\n        this.page.changeCurrentPage(newPage);\r\n      }\r\n    }\r\n    var changePage = this.page.resetLoopPage();\r\n    if (changePage) {\r\n      this.resetLooping = true;\r\n      this.goTo(changePage.pageX, changePage.pageY, 0);\r\n      return true; // stop trigger chain\r\n    }\r\n    // amend willChangeToPage, because willChangeToPage maybe wrong when sliding quickly\r\n    this.pageWillChangeTo(this.page.currentPage);\r\n  };\r\n  Slide.prototype.shouldSetWidthHeight = function (checkType) {\r\n    var checkMap = {\r\n      width: ['scrollX', 'disableSetWidth'],\r\n      height: ['scrollY', 'disableSetHeight']\r\n    };\r\n    var checkOption = checkMap[checkType];\r\n    if (!this.scroll.options[checkOption[0]]) {\r\n      return false;\r\n    }\r\n    if (this.slideOpt[checkOption[1]]) {\r\n      return false;\r\n    }\r\n    return true;\r\n  };\r\n  Slide.prototype.clearSlideWidth = function (slideEls) {\r\n    if (!this.shouldSetWidthHeight('width')) {\r\n      return;\r\n    }\r\n    var children = slideEls.children;\r\n    for (var i = 0; i < children.length; i++) {\r\n      var slideItemDom = children[i];\r\n      slideItemDom.removeAttribute('style');\r\n    }\r\n    slideEls.removeAttribute('style');\r\n  };\r\n  Slide.prototype.setSlideWidth = function (slideEls) {\r\n    if (!this.shouldSetWidthHeight('width')) {\r\n      return false;\r\n    }\r\n    var children = slideEls.children;\r\n    var slideItemWidth = children[0].clientWidth;\r\n    for (var i = 0; i < children.length; i++) {\r\n      var slideItemDom = children[i];\r\n      slideItemDom.style.width = slideItemWidth + 'px';\r\n    }\r\n    slideEls.style.width = slideItemWidth * children.length + 'px';\r\n    return true;\r\n  };\r\n  Slide.prototype.clearSlideHeight = function (slideEls) {\r\n    if (!this.shouldSetWidthHeight('height')) {\r\n      return;\r\n    }\r\n    var children = slideEls.children;\r\n    for (var i = 0; i < children.length; i++) {\r\n      var slideItemDom = children[i];\r\n      slideItemDom.removeAttribute('style');\r\n    }\r\n    slideEls.removeAttribute('style');\r\n  };\r\n  // height change will not effect minScrollY & maxScrollY\r\n  Slide.prototype.setSlideHeight = function (slideWrapper, slideEls) {\r\n    if (!this.shouldSetWidthHeight('height')) {\r\n      return false;\r\n    }\r\n    var wrapperHeight = slideWrapper.clientHeight;\r\n    var children = slideEls.children;\r\n    for (var i = 0; i < children.length; i++) {\r\n      var slideItemDom = children[i];\r\n      slideItemDom.style.height = wrapperHeight + 'px';\r\n    }\r\n    slideEls.style.height = wrapperHeight * children.length + 'px';\r\n    return true;\r\n  };\r\n  Slide.prototype.goTo = function (pageX, pageY, time, easing) {\r\n    if (pageY === void 0) {\r\n      pageY = 0;\r\n    }\r\n    var newPageInfo = this.page.change2safePage(pageX, pageY);\r\n    if (!newPageInfo) {\r\n      return;\r\n    }\r\n    var scrollEasing = easing || this.slideOpt.easing || ease.bounce;\r\n    var posX = newPageInfo.x;\r\n    var posY = newPageInfo.y;\r\n    var deltaX = posX - this.scroll.scroller.scrollBehaviorX.currentPos;\r\n    var deltaY = posY - this.scroll.scroller.scrollBehaviorY.currentPos;\r\n    if (!deltaX && !deltaY) {\r\n      return;\r\n    }\r\n    time = time === undefined ? this.getAnimateTime(deltaX, deltaY) : time;\r\n    this.page.changeCurrentPage({\r\n      x: posX,\r\n      y: posY,\r\n      pageX: newPageInfo.pageX,\r\n      pageY: newPageInfo.pageY\r\n    });\r\n    this.pageWillChangeTo(this.page.currentPage);\r\n    this.scroll.scroller.scrollTo(posX, posY, time, scrollEasing);\r\n  };\r\n  Slide.prototype.flickHandler = function () {\r\n    var scrollBehaviorX = this.scroll.scroller.scrollBehaviorX;\r\n    var scrollBehaviorY = this.scroll.scroller.scrollBehaviorY;\r\n    var deltaX = scrollBehaviorX.currentPos - scrollBehaviorX.startPos;\r\n    var deltaY = scrollBehaviorY.currentPos - scrollBehaviorY.startPos;\r\n    var time = this.getAnimateTime(deltaX, deltaY);\r\n    this.goTo(\r\n      this.page.currentPage.pageX + scrollBehaviorX.direction,\r\n      this.page.currentPage.pageY + scrollBehaviorY.direction,\r\n      time\r\n    );\r\n  };\r\n  Slide.prototype.getAnimateTime = function (deltaX, deltaY) {\r\n    if (this.slideOpt.speed) {\r\n      return this.slideOpt.speed;\r\n    }\r\n    return Math.max(Math.max(Math.min(Math.abs(deltaX), 1000), Math.min(Math.abs(deltaY), 1000)), 300);\r\n  };\r\n  Slide.prototype.modifyScrollMetaHandler = function (scrollMeta) {\r\n    var newPos = this.nearestPage(scrollMeta.newX, scrollMeta.newY);\r\n    scrollMeta.time = this.getAnimateTime(scrollMeta.newX - newPos.x, scrollMeta.newY - newPos.y);\r\n    scrollMeta.newX = newPos.x;\r\n    scrollMeta.newY = newPos.y;\r\n    scrollMeta.easing = this.slideOpt.easing || ease.bounce;\r\n    this.page.changeCurrentPage({\r\n      x: scrollMeta.newX,\r\n      y: scrollMeta.newY,\r\n      pageX: newPos.pageX,\r\n      pageY: newPos.pageY\r\n    });\r\n    this.pageWillChangeTo(this.page.currentPage);\r\n  };\r\n  Slide.prototype.scrollMoving = function (point) {\r\n    if (this.isTouching) {\r\n      var newPos = this.nearestPage(point.x, point.y);\r\n      this.pageWillChangeTo(newPos);\r\n    }\r\n  };\r\n  Slide.prototype.pageWillChangeTo = function (newPage) {\r\n    var changeToPage = this.page.getRealPage(newPage);\r\n    if (changeToPage.pageX === this.willChangeToPage.pageX && changeToPage.pageY === this.willChangeToPage.pageY) {\r\n      return;\r\n    }\r\n    this.willChangeToPage = changeToPage;\r\n    this.scroll.trigger('slideWillChange', this.willChangeToPage);\r\n  };\r\n  Slide.prototype.setTouchFlag = function () {\r\n    this.isTouching = true;\r\n  };\r\n  Slide.prototype.registorHooks = function (hooks, name, handler) {\r\n    hooks.on(name, handler, this);\r\n    this.hooksFn.push([hooks, name, handler]);\r\n  };\r\n  Slide.pluginName = 'slide';\r\n  return Slide;\r\n})();\r\n\r\nexport default Slide;\r\n","import React, { JSX } from \"react\";\r\nimport BScroll from \"@better-scroll/core\";\r\nimport MouseWheel from \"@better-scroll/mouse-wheel\";\r\nimport ScrollBar from \"@better-scroll/scroll-bar\";\r\nimport ReactDOM from \"react-dom\";\r\n\r\nimport Layout from \"../../../layout\";\r\nimport PointerListeners from \"../../../pointerlisteners\";\r\nimport { Noodl } from \"../../../types\";\r\nimport NestedScroll from \"./scroll-plugins/nested-scroll-plugin\";\r\nimport patchedMomentum from \"./scroll-plugins/patched-momentum-scroll\";\r\nimport Slide from \"./scroll-plugins/slide-scroll-plugin\";\r\n\r\nBScroll.use(ScrollBar);\r\nBScroll.use(NestedScroll);\r\nBScroll.use(MouseWheel);\r\nBScroll.use(Slide);\r\n\r\nexport interface GroupProps extends Noodl.ReactProps {\r\n  as?: keyof JSX.IntrinsicElements | React.ComponentType<unknown>;\r\n  children?: React.ReactNode;\r\n\r\n  attrs: React.Attributes;\r\n\r\n  scrollSnapEnabled: boolean;\r\n  showScrollbar: boolean;\r\n  scrollEnabled: boolean;\r\n  nativeScroll: boolean;\r\n  scrollSnapToEveryItem: boolean;\r\n  flexWrap: \"nowrap\" | \"wrap\" | \"wrap-reverse\";\r\n  scrollBounceEnabled: boolean;\r\n  clip: boolean;\r\n\r\n  layout: \"none\" | \"row\" | \"column\";\r\n  dom;\r\n\r\n  onScrollPositionChanged?: (value: number) => void;\r\n  onScrollStart?: () => void;\r\n  onScrollEnd?: () => void;\r\n}\r\n\r\ntype ScrollRef = HTMLDivElement & { noodlNode?: Noodl.ReactProps[\"noodlNode\"] };\r\n\r\nexport class Group extends React.Component<GroupProps> {\r\n  scrollNeedsToInit: boolean;\r\n  scrollRef: React.RefObject<ScrollRef>;\r\n  iScroll?: BScroll;\r\n\r\n  constructor(props: GroupProps) {\r\n    super(props);\r\n    this.scrollNeedsToInit = false;\r\n    this.scrollRef = React.createRef();\r\n  }\r\n\r\n  componentDidMount() {\r\n    if (this.props.scrollEnabled && this.props.nativeScroll !== true) {\r\n      this.setupIScroll();\r\n    }\r\n\r\n    // Plumbing for the focused signals\r\n    if (this.scrollRef.current) {\r\n      this.scrollRef.current.noodlNode = this.props.noodlNode;\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    if (this.iScroll) {\r\n      this.iScroll.destroy();\r\n      this.iScroll = undefined;\r\n    }\r\n\r\n    this.props.noodlNode.context.setNodeFocused(this.props.noodlNode, false);\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    if (this.scrollNeedsToInit) {\r\n      this.setupIScroll();\r\n      this.scrollNeedsToInit = false;\r\n    }\r\n\r\n    if (this.iScroll) {\r\n      setTimeout(() => {\r\n        this.iScroll && this.iScroll.refresh();\r\n      }, 0);\r\n    }\r\n  }\r\n\r\n  scrollToIndex(index, duration) {\r\n    if (this.iScroll) {\r\n      const child = this.scrollRef.current?.children[0].children[\r\n        index\r\n      ] as HTMLElement;\r\n      if (child) {\r\n        this.iScroll.scrollToElement(child, duration, 0, 0);\r\n      }\r\n    } else {\r\n      const child = this.scrollRef.current?.children[index];\r\n      child &&\r\n        child.scrollIntoView({\r\n          behavior: \"smooth\",\r\n        });\r\n    }\r\n  }\r\n\r\n  scrollToElement(noodlChild, duration) {\r\n    if (!noodlChild) return;\r\n    // eslint-disable-next-line react/no-find-dom-node\r\n    const element = ReactDOM.findDOMNode(noodlChild.getRef()) as HTMLElement;\r\n    if (element && element.scrollIntoView) {\r\n      if (this.iScroll) {\r\n        this.iScroll.scrollToElement(element, duration, 0, 0);\r\n      } else {\r\n        element.scrollIntoView({\r\n          behavior: \"smooth\",\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  setupIScroll() {\r\n    const { scrollSnapEnabled } = this.props;\r\n    const scrollDirection = this.getScrollDirection();\r\n\r\n    const snapOptions = {\r\n      disableSetWidth: true,\r\n      disableSetHeight: true,\r\n      loop: false,\r\n    };\r\n\r\n    const domElement = this.scrollRef.current;\r\n    this.iScroll = new BScroll(domElement!, {\r\n      bounceTime: 500,\r\n      swipeBounceTime: 300,\r\n      scrollbar: this.props.showScrollbar ? {} : undefined,\r\n      momentum: scrollSnapEnabled ? !this.props.scrollSnapToEveryItem : true,\r\n      bounce:\r\n        this.props.scrollBounceEnabled &&\r\n        !(scrollSnapEnabled && snapOptions.loop),\r\n      scrollX: scrollDirection === \"x\" || scrollDirection === \"both\",\r\n      scrollY: scrollDirection === \"y\" || scrollDirection === \"both\",\r\n      slide: scrollSnapEnabled ? snapOptions : undefined,\r\n      probeType: this.props.onScrollPositionChanged ? 3 : 1,\r\n      click: true,\r\n      nestedScroll: true,\r\n      //disable CSS animation, they can cause a flicker on iOS,\r\n      //and cause problems with probing the scroll position during an animation\r\n      useTransition: false,\r\n    });\r\n\r\n    //the scroll behavior when doing a momentum scroll that reaches outside the bounds\r\n    //does a slow and unpleasant animation. Let's patch it to make it behave more like iScroll.\r\n    const scroller = this.iScroll.scroller;\r\n    scroller.scrollBehaviorX &&\r\n      // @ts-expect-error momentum does exist\r\n      (scroller.scrollBehaviorX.momentum = patchedMomentum.bind(\r\n        scroller.scrollBehaviorX\r\n      ));\r\n    scroller.scrollBehaviorY &&\r\n      // @ts-expect-error momentum does exist\r\n      (scroller.scrollBehaviorY.momentum = patchedMomentum.bind(\r\n        scroller.scrollBehaviorY\r\n      ));\r\n\r\n    //refresh the scroll view in case a child has changed height, e.g. an image loaded\r\n    //seem to be very performant, no observed problem so far\r\n    this.iScroll.on(\"beforeScrollStart\", () => {\r\n      this.iScroll!.refresh();\r\n    });\r\n\r\n    this.iScroll.on(\"scrollStart\", () => {\r\n      this.props.onScrollStart && this.props.onScrollStart();\r\n    });\r\n\r\n    this.iScroll.on(\"scrollEnd\", () => {\r\n      this.props.onScrollEnd && this.props.onScrollEnd();\r\n    });\r\n\r\n    if (this.props.onScrollPositionChanged) {\r\n      this.iScroll.on(\"scroll\", () => {\r\n        // @ts-expect-error\r\n        this.props.onScrollPositionChanged(\r\n          // @ts-expect-error\r\n          scrollDirection === \"x\" ? -this.iScroll.x : -this.iScroll.y\r\n        );\r\n      });\r\n    }\r\n  }\r\n\r\n  UNSAFE_componentWillReceiveProps(nextProps: GroupProps) {\r\n    const scrollHasUpdated =\r\n      this.props.scrollSnapEnabled !== nextProps.scrollSnapEnabled ||\r\n      this.props.onScrollPositionChanged !==\r\n        nextProps.onScrollPositionChanged ||\r\n      this.props.onScrollStart !== nextProps.onScrollStart ||\r\n      this.props.onScrollEnd !== nextProps.onScrollEnd ||\r\n      this.props.showScrollbar !== nextProps.showScrollbar ||\r\n      this.props.scrollEnabled !== nextProps.scrollEnabled ||\r\n      this.props.nativeScroll !== nextProps.nativeScroll ||\r\n      this.props.scrollSnapToEveryItem !== nextProps.scrollSnapToEveryItem ||\r\n      this.props.layout !== nextProps.layout ||\r\n      this.props.flexWrap !== nextProps.flexWrap ||\r\n      this.props.scrollBounceEnabled !== nextProps.scrollBounceEnabled;\r\n\r\n    if (scrollHasUpdated) {\r\n      if (this.iScroll) {\r\n        this.iScroll.destroy();\r\n        this.iScroll = undefined;\r\n      }\r\n\r\n      this.scrollNeedsToInit =\r\n        nextProps.scrollEnabled && !nextProps.nativeScroll;\r\n    }\r\n  }\r\n\r\n  renderIScroll() {\r\n    const { flexDirection, flexWrap } = this.props.style;\r\n\r\n    const childStyle: React.CSSProperties = {\r\n      display: \"inline-flex\",\r\n      flexShrink: 0,\r\n      flexDirection,\r\n      flexWrap,\r\n      touchAction: \"none\",\r\n      // pointerEvents: this.state.isScrolling ? 'none' : undefined\r\n    };\r\n\r\n    if (flexDirection === \"row\") {\r\n      if (flexWrap === \"wrap\") {\r\n        childStyle.width = \"100%\";\r\n      } else {\r\n        childStyle.height = \"100%\";\r\n      }\r\n    } else {\r\n      if (flexWrap === \"wrap\") {\r\n        childStyle.height = \"100%\";\r\n      } else {\r\n        childStyle.width = \"100%\";\r\n      }\r\n    }\r\n\r\n    return (\r\n      <div className=\"scroll-wrapper-internal\" style={childStyle}>\r\n        {this.props.children}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  getScrollDirection(): \"x\" | \"y\" | \"both\" {\r\n    // TODO: This never returns both, why?\r\n\r\n    if (\r\n      this.props.flexWrap === \"wrap\" ||\r\n      this.props.flexWrap === \"wrap-reverse\"\r\n    ) {\r\n      return this.props.layout === \"row\" ? \"y\" : \"x\";\r\n    }\r\n\r\n    return this.props.layout === \"row\" ? \"x\" : \"y\";\r\n  }\r\n\r\n  render() {\r\n    const { as: Component = \"div\", ...props } = this.props;\r\n\r\n    const children =\r\n      props.scrollEnabled && !props.nativeScroll\r\n        ? this.renderIScroll()\r\n        : props.children;\r\n\r\n    const style = { ...props.style };\r\n    Layout.size(style, props);\r\n    Layout.align(style, props);\r\n\r\n    if (props.clip) {\r\n      style.overflowX = \"hidden\";\r\n      style.overflowY = \"hidden\";\r\n    }\r\n\r\n    if (props.scrollEnabled && props.nativeScroll) {\r\n      const scrollDirection = this.getScrollDirection();\r\n      if (scrollDirection === \"y\") {\r\n        style.overflowY = \"auto\";\r\n      } else if (scrollDirection === \"x\") {\r\n        style.overflowX = \"auto\";\r\n      } else if (scrollDirection === \"both\") {\r\n        style.overflowX = \"auto\";\r\n        style.overflowY = \"auto\";\r\n      }\r\n    }\r\n\r\n    if (style.opacity === 0) {\r\n      style.pointerEvents = \"none\";\r\n    }\r\n\r\n    return (\r\n      <Component\r\n        // @ts-ignore\r\n        className={props.className}\r\n        {...props.attrs}\r\n        {...props.dom}\r\n        {...PointerListeners(props)}\r\n        style={style}\r\n        ref={this.scrollRef}\r\n      >\r\n        {children}\r\n      </Component>\r\n    );\r\n  }\r\n}\r\n","import { Group } from '../../components/visual/Group';\r\nimport { flexDirectionValues } from '../../constants/flex';\r\nimport NodeSharedPortDefinitions from '../../node-shared-port-definitions';\r\nimport { createNodeFromReactComponent } from '../../react-component-node';\r\nimport { createTooltip } from '../../tooltips';\r\n\r\nconst GroupNode = {\r\n  name: 'Group',\r\n  docs: 'https://docs.noodl.net/nodes/basic-elements/group',\r\n  connectionPanel: {\r\n    groupPriority: ['General', 'Style', 'Events', 'Mounted', 'Hover Events', 'Pointer Events', 'Focus', 'Scroll']\r\n  },\r\n  initialize() {\r\n    this.props.attrs = {};\r\n    this._internal = {\r\n      scrollElementDuration: 500,\r\n      scrollIndexDuration: 500,\r\n      scrollIndex: 0\r\n    };\r\n    this.props.layout = 'column';\r\n  },\r\n  getReactComponent() {\r\n    return Group;\r\n  },\r\n  noodlNodeAsProp: true,\r\n  visualStates: [\r\n    { name: 'neutral', label: 'Neutral' },\r\n    { name: 'hover', label: 'Hover' }\r\n  ],\r\n  defaultCss: {\r\n    display: 'flex',\r\n    position: 'relative',\r\n    flexDirection: 'column'\r\n  },\r\n  inputs: {\r\n    flexDirection: {\r\n      //don't rename for backwards compat\r\n      index: 12,\r\n      displayName: 'Layout',\r\n      group: 'Layout',\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: 'None', value: 'none' },\r\n          { label: 'Vertical', value: 'column' },\r\n          { label: 'Horizontal', value: 'row' }\r\n        ]\r\n      },\r\n      default: 'column',\r\n      set(value) {\r\n        this.props.layout = value;\r\n\r\n        if (value !== 'none') {\r\n          this.setStyle({ flexDirection: value });\r\n        } else {\r\n          this.removeStyle(['flexDirection']);\r\n        }\r\n\r\n        if (this.context.editorConnection) {\r\n          // Send warning if the value is wrong\r\n          if (value !== 'none' && !flexDirectionValues.includes(value)) {\r\n            this.context.editorConnection.sendWarning(this.nodeScope.componentOwner.name, this.id, 'layout-warning', {\r\n              message: 'Invalid Layout value has to be a valid flex-direction value.'\r\n            });\r\n          } else {\r\n            this.context.editorConnection.clearWarning(this.nodeScope.componentOwner.name, this.id, 'layout-warning');\r\n          }\r\n        }\r\n\r\n        this.forceUpdate();\r\n      }\r\n    },\r\n    'scrollToIndex.do': {\r\n      displayName: 'Scroll To Index - Do',\r\n      group: 'Scroll To Index',\r\n      type: 'signal',\r\n      index: 505,\r\n      valueChangedToTrue() {\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          if (!this.innerReactComponentRef) return;\r\n          const childIndex = this._internal.scrollIndex;\r\n          const duration = this._internal.scrollIndexDuration;\r\n          this.innerReactComponentRef.scrollToIndex(childIndex, duration);\r\n        });\r\n      }\r\n    },\r\n    'scrollToElement.do': {\r\n      displayName: 'Scroll To Element - Do',\r\n      group: 'Scroll To Element',\r\n      type: 'signal',\r\n      index: 500,\r\n      valueChangedToTrue() {\r\n        if (!this.innerReactComponentRef) return;\r\n        this.scheduleAfterInputsHaveUpdated(() => {\r\n          const element = this._internal.scrollElement;\r\n          const duration = this._internal.scrollElementDuration;\r\n          this.innerReactComponentRef.scrollToElement(element, duration);\r\n        });\r\n      }\r\n    },\r\n    'scrollToElement.element': {\r\n      displayName: 'Scroll To Element - Element',\r\n      group: 'Scroll To Element',\r\n      type: 'reference',\r\n      index: 501,\r\n      set(value) {\r\n        this._internal.scrollElement = value;\r\n      }\r\n    },\r\n    'scrollToElement.duration': {\r\n      displayName: 'Scroll To Element - Duration',\r\n      group: 'Scroll To Element',\r\n      type: 'number',\r\n      default: 500,\r\n      index: 502,\r\n      set(value) {\r\n        this._internal.scrollElementDuration = value;\r\n      }\r\n    },\r\n    'scrollToIndex.index': {\r\n      displayName: 'Scroll To Index - Index',\r\n      group: 'Scroll To Index',\r\n      type: 'number',\r\n      default: 0,\r\n      index: 506,\r\n      set(value) {\r\n        this._internal.scrollIndex = value;\r\n      }\r\n    },\r\n    'scrollToIndex.duration': {\r\n      displayName: 'Scroll To Index - Duration',\r\n      group: 'Scroll To Index',\r\n      type: 'number',\r\n      default: 500,\r\n      index: 507,\r\n      set(value) {\r\n        this._internal.scrollIndexDuration = value;\r\n      }\r\n    },\r\n    focus: {\r\n      displayName: 'Focus',\r\n      type: 'signal',\r\n      group: 'Focus',\r\n      valueChangedToTrue() {\r\n        this.context.setNodeFocused(this, true);\r\n      }\r\n    },\r\n    testId: {\r\n      index: 100009,\r\n      displayName: 'Test ID Attribute',\r\n      group: 'Advanced HTML',\r\n      type: 'string',\r\n      set(value) {\r\n        this.props.attrs[\"data-testid\"] = value;\r\n        this.forceUpdate();\r\n      }\r\n    }\r\n  },\r\n  inputProps: {\r\n    clip: {\r\n      index: 19,\r\n      displayName: 'Clip Content',\r\n      type: 'boolean',\r\n      group: 'Layout',\r\n      default: false\r\n    },\r\n    scrollEnabled: {\r\n      index: 54,\r\n      group: 'Scroll',\r\n      displayName: 'Enable Scroll',\r\n      type: 'boolean',\r\n      default: false\r\n    },\r\n    scrollSnapEnabled: {\r\n      index: 55,\r\n      displayName: 'Snap',\r\n      group: 'Scroll',\r\n      type: 'boolean',\r\n      default: false\r\n    },\r\n    scrollSnapToEveryItem: {\r\n      index: 56,\r\n      displayName: 'Snap To Every Item',\r\n      group: 'Scroll',\r\n      type: 'boolean',\r\n      default: false\r\n    },\r\n    showScrollbar: {\r\n      index: 57,\r\n      displayName: 'Show Scrollbar',\r\n      group: 'Scroll',\r\n      type: 'boolean',\r\n      default: false\r\n    },\r\n    scrollBounceEnabled: {\r\n      index: 58,\r\n      displayName: 'Bounce at boundaries',\r\n      group: 'Scroll',\r\n      type: 'boolean',\r\n      default: true\r\n    },\r\n    nativeScroll: {\r\n      index: 60,\r\n      group: 'Scroll',\r\n      displayName: 'Native platform scroll',\r\n      type: 'boolean',\r\n      default: true\r\n    },\r\n    as: {\r\n      index: 100000,\r\n      group: 'Advanced HTML',\r\n      displayName: 'Tag',\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: '<div>', value: 'div' },\r\n          { label: '<section>', value: 'section' },\r\n          { label: '<article>', value: 'article' },\r\n          { label: '<aside>', value: 'aside' },\r\n          { label: '<nav>', value: 'nav' },\r\n          { label: '<header>', value: 'header' },\r\n          { label: '<footer>', value: 'footer' },\r\n          { label: '<main>', value: 'main' },\r\n          { label: '<span>', value: 'span' }\r\n        ]\r\n      },\r\n      default: 'div'\r\n    }\r\n  },\r\n  inputCss: {\r\n    alignItems: {\r\n      index: 13,\r\n      group: 'Align and justify content',\r\n      displayName: 'Align Items',\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: 'Start', value: 'flex-start' },\r\n          { label: 'End', value: 'flex-end' },\r\n          { label: 'Center', value: 'center' }\r\n        ],\r\n        alignComp: 'align-items'\r\n      },\r\n      default: 'flex-start'\r\n    },\r\n    justifyContent: {\r\n      index: 14,\r\n      group: 'Align and justify content',\r\n      displayName: 'Justify Content',\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: 'Start', value: 'flex-start' },\r\n          { label: 'End', value: 'flex-end' },\r\n          { label: 'Center', value: 'center' },\r\n          { label: 'Space Between', value: 'space-between' },\r\n          { label: 'Space Around', value: 'space-around' },\r\n          { label: 'Space Evenly', value: 'space-evenly' }\r\n        ],\r\n        alignComp: 'justify-content'\r\n      },\r\n      default: 'flex-start',\r\n      applyDefault: false\r\n    },\r\n    flexWrap: {\r\n      index: 15,\r\n      displayName: 'Multi Line Wrap',\r\n      group: 'Layout',\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: 'Off', value: 'nowrap' },\r\n          { label: 'On', value: 'wrap' },\r\n          { label: 'On Reverse', value: 'wrap-reverse' }\r\n        ]\r\n      },\r\n      default: 'nowrap',\r\n      onChange(value) {\r\n        this.props.flexWrap = value;\r\n        this.forceUpdate(); //scroll direction needs to be recomputed\r\n      },\r\n      applyDefault: false\r\n    },\r\n    alignContent: {\r\n      index: 16,\r\n      group: 'Layout',\r\n      displayName: 'Align Content',\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: 'Start', value: 'flex-start' },\r\n          { label: 'End', value: 'flex-end' },\r\n          { label: 'Center', value: 'center' },\r\n          { label: 'Space Between', value: 'space-between' },\r\n          { label: 'Space Around', value: 'space-around' },\r\n          { label: 'Space Evenly', value: 'space-evenly' }\r\n        ],\r\n        alignComp: 'align-content'\r\n      }\r\n      // default: 'flex-start'\r\n    },\r\n    rowGap: {\r\n      index: 17,\r\n      displayName: 'Vertical Gap',\r\n      group: 'Layout',\r\n      type: {\r\n        name: 'number',\r\n        units: ['px', '%', 'em'],\r\n        defaultUnit: 'px'\r\n      },\r\n      default: 0,\r\n      applyDefault: false\r\n    },\r\n    columnGap: {\r\n      index: 18,\r\n      displayName: 'Horizontal Gap',\r\n      group: 'Layout',\r\n      type: {\r\n        name: 'number',\r\n        units: ['px', '%', 'em'],\r\n        defaultUnit: 'px'\r\n      },\r\n      default: 0,\r\n      applyDefault: false\r\n    },\r\n    backgroundColor: {\r\n      index: 201,\r\n      displayName: 'Background Color',\r\n      group: 'Style',\r\n      type: 'color',\r\n      default: 'transparent',\r\n      applyDefault: false,\r\n      allowVisualStates: true\r\n    }\r\n  },\r\n  outputProps: {\r\n    onScrollPositionChanged: {\r\n      displayName: 'Scroll Position',\r\n      type: 'number',\r\n      group: 'Scroll'\r\n    },\r\n    onScrollStart: {\r\n      displayName: 'Scroll Start',\r\n      type: 'signal',\r\n      group: 'Scroll'\r\n    },\r\n    onScrollEnd: {\r\n      displayName: 'Scroll End',\r\n      type: 'signal',\r\n      group: 'Scroll'\r\n    }\r\n  },\r\n  outputs: {\r\n    focused: {\r\n      displayName: 'Focused',\r\n      type: 'signal',\r\n      group: 'Focus'\r\n    },\r\n    focusLost: {\r\n      displayName: 'Focus Lost',\r\n      type: 'signal',\r\n      group: 'Focus'\r\n    }\r\n  },\r\n  dynamicports: [\r\n    {\r\n      condition: 'flexDirection != none',\r\n      inputs: ['scrollEnabled']\r\n    },\r\n    {\r\n      condition: 'flexDirection != none AND scrollEnabled = true',\r\n      inputs: ['nativeScroll']\r\n    },\r\n    {\r\n      condition: 'flexDirection != none AND scrollEnabled = true AND nativeScroll = false',\r\n      inputs: [\r\n        'scrollBounceEnabled',\r\n        'scrollSnapEnabled',\r\n        'showScrollbar',\r\n        'scrollToElement.do',\r\n        'scrollToElement.element',\r\n        'scrollToElement.duration',\r\n        'scrollToIndex.do',\r\n        'scrollToIndex.index',\r\n        'scrollToIndex.duration'\r\n      ]\r\n    },\r\n    {\r\n      condition: 'flexDirection != none AND scrollEnabled = true AND scrollSnapEnabled = true',\r\n      inputs: ['scrollSnapToEveryItem']\r\n    },\r\n    {\r\n      condition: 'flexDirection != none',\r\n      inputs: ['flexWrap']\r\n    },\r\n    {\r\n      condition: 'flexWrap = wrap OR flexWrap = wrap-reverse',\r\n      inputs: ['alignContent']\r\n    },\r\n    {\r\n      condition: 'flexDirection = row OR flexWrap = wrap OR flexWrap = wrap-reverse',\r\n      inputs: ['columnGap']\r\n    },\r\n    {\r\n      condition: 'flexDirection = column OR flexWrap = wrap OR flexWrap = wrap-reverse',\r\n      inputs: ['rowGap']\r\n    }\r\n  ],\r\n  methods: {\r\n    _focus() {\r\n      this.sendSignalOnOutput('focused');\r\n    },\r\n    _blur() {\r\n      this.sendSignalOnOutput('focusLost');\r\n    }\r\n  }\r\n};\r\n\r\nNodeSharedPortDefinitions.addDimensions(GroupNode);\r\nNodeSharedPortDefinitions.addTransformInputs(GroupNode);\r\nNodeSharedPortDefinitions.addSharedVisualInputs(GroupNode);\r\nNodeSharedPortDefinitions.addPaddingInputs(GroupNode);\r\nNodeSharedPortDefinitions.addMarginInputs(GroupNode);\r\nNodeSharedPortDefinitions.addAlignInputs(GroupNode);\r\nNodeSharedPortDefinitions.addPointerEventOutputs(GroupNode);\r\nNodeSharedPortDefinitions.addBorderInputs(GroupNode);\r\nNodeSharedPortDefinitions.addShadowInputs(GroupNode);\r\n\r\nfunction defineTooltips(node) {\r\n  node.inputProps.clip.tooltip = createTooltip({\r\n    title: 'Clip content',\r\n    body: 'Controls if elements that are too big to fit will be clipped',\r\n    images: [\r\n      { src: 'clip-enabled.svg', label: 'Enabled' },\r\n      { src: 'clip-disabled.svg', label: 'Disabled' }\r\n    ]\r\n  });\r\n\r\n  node.inputCss.flexWrap.tooltip = createTooltip({\r\n    title: 'Multiline wrap',\r\n    body: \"Elements will wrap to the next line when there's not enough space\",\r\n    images: [\r\n      { src: 'multiline-h.svg', body: 'Using a horizontal layout' },\r\n      { src: 'multiline-v.svg', body: 'Using a vertical layout' }\r\n    ]\r\n  });\r\n}\r\n\r\n// eslint-disable-next-line no-undef\r\nif (!Noodl.runDeployed) {\r\n  defineTooltips(GroupNode);\r\n}\r\n\r\nexport default createNodeFromReactComponent(GroupNode);\r\n","import React from \"react\";\r\n\r\nimport Layout from \"../../../layout\";\r\nimport { Noodl } from \"../../../types\";\r\n\r\nexport interface IconProps extends Noodl.ReactProps {\r\n  iconSourceType: \"image\" | \"icon\";\r\n  iconImageSource: Noodl.Image;\r\n  iconIconSource: Noodl.Icon;\r\n  iconSize: string;\r\n  iconColor: Noodl.Color;\r\n}\r\n\r\nexport function Icon(props: IconProps) {\r\n  const style: React.CSSProperties = { userSelect: \"none\", ...props.style };\r\n  Layout.size(style, props);\r\n  Layout.align(style, props);\r\n\r\n  function _renderIcon() {\r\n    const style: React.CSSProperties = {};\r\n    if (\r\n      props.iconSourceType === \"image\" &&\r\n      props.iconImageSource !== undefined\r\n    ) {\r\n      style.width = props.iconSize;\r\n      style.height = props.iconSize;\r\n      return <img alt=\"\" src={props.iconImageSource} style={style} />;\r\n    } else if (\r\n      props.iconSourceType === \"icon\" &&\r\n      props.iconIconSource !== undefined\r\n    ) {\r\n      style.fontSize = props.iconSize;\r\n      style.color = props.iconColor;\r\n      style.lineHeight = 1;\r\n      return (\r\n        <div style={{ lineHeight: 0 }}>\r\n          {props.iconIconSource.codeAsClass === true ? (\r\n            <span\r\n              className={[\r\n                props.iconIconSource.class,\r\n                props.iconIconSource.code,\r\n              ].join(\" \")}\r\n              style={style}\r\n            ></span>\r\n          ) : (\r\n            <span className={props.iconIconSource.class} style={style}>\r\n              {props.iconIconSource.code}\r\n            </span>\r\n          )}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  let className = \"ndl-visual-icon\";\r\n  if (props.className) className = className + \" \" + props.className;\r\n\r\n  return (\r\n    <div className={className} style={style}>\r\n      {_renderIcon()}\r\n    </div>\r\n  );\r\n}\r\n","import { Icon } from '../../components/visual/Icon';\r\nimport NodeSharedPortDefinitions from '../../node-shared-port-definitions';\r\nimport { createNodeFromReactComponent } from '../../react-component-node';\r\n\r\nconst IconNode = {\r\n  name: 'net.noodl.visual.icon',\r\n  displayName: 'Icon',\r\n  docs: 'https://docs.noodl.net/nodes/basic-elements/icon',\r\n  allowChildren: false,\r\n  noodlNodeAsProp: true,\r\n  connectionPanel: {\r\n    groupPriority: [\r\n      'General',\r\n      'Style',\r\n      'Actions',\r\n      'Events',\r\n      'States',\r\n      'Mounted',\r\n      'Hover Events',\r\n      'Pointer Events',\r\n      'Focus Events'\r\n    ]\r\n  },\r\n  getReactComponent() {\r\n    return Icon;\r\n  }\r\n};\r\nNodeSharedPortDefinitions.addAlignInputs(IconNode);\r\nNodeSharedPortDefinitions.addTransformInputs(IconNode);\r\nNodeSharedPortDefinitions.addPaddingInputs(IconNode, {\r\n  defaults: {\r\n    paddingTop: 5,\r\n    paddingRight: 5,\r\n    paddingBottom: 5,\r\n    paddingLeft: 5\r\n  }\r\n});\r\nNodeSharedPortDefinitions.addMarginInputs(IconNode);\r\nNodeSharedPortDefinitions.addIconInputs(IconNode, {\r\n  hideEnableIconInput: true,\r\n  defaults: { useIcon: true }\r\n});\r\nNodeSharedPortDefinitions.addSharedVisualInputs(IconNode);\r\n\r\nexport default createNodeFromReactComponent(IconNode);\r\n","import React from \"react\";\r\n\r\nimport Layout from \"../../../layout\";\r\nimport PointerListeners from \"../../../pointerlisteners\";\r\nimport { Noodl } from \"../../../types\";\r\n\r\nexport interface ImageProps extends Noodl.ReactProps {\r\n  dom: {\r\n    alt?: string;\r\n    src: string;\r\n    onLoad?: () => void;\r\n  };\r\n  attrs: React.Attributes;\r\n}\r\n\r\nexport function Image(props: ImageProps) {\r\n  const style = { ...props.style };\r\n\r\n  Layout.size(style, props);\r\n  Layout.align(style, props);\r\n\r\n  if (style.opacity === 0) {\r\n    style.pointerEvents = \"none\";\r\n  }\r\n\r\n  if (props.dom?.src?.startsWith(\"/\")) {\r\n    // @ts-expect-error missing Noodl typings\r\n    const baseUrl = Noodl.Env[\"BaseUrl\"];\r\n    if (baseUrl) {\r\n      props.dom.src = baseUrl + props.dom.src.substring(1);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <img\r\n      {...props.attrs}\r\n      className={props.className}\r\n      {...props.dom}\r\n      {...PointerListeners(props)}\r\n      style={style}\r\n    />\r\n  );\r\n}\r\n","import { getAbsoluteUrl } from \"@fluxscape/runtime\";\r\n\r\nimport { Image } from \"../../components/visual/Image\";\r\nimport NodeSharedPortDefinitions from \"../../node-shared-port-definitions\";\r\nimport { createNodeFromReactComponent } from \"../../react-component-node\";\r\n\r\nconst ImageNode = {\r\n  name: \"Image\",\r\n  docs: \"https://docs.noodl.net/nodes/basic-elements/image\",\r\n  noodlNodeAsProp: true,\r\n  visualStates: [\r\n    { name: \"neutral\", label: \"Neutral\" },\r\n    { name: \"hover\", label: \"Hover\" },\r\n  ],\r\n  connectionPanel: {\r\n    groupPriority: [\r\n      \"General\",\r\n      \"Image\",\r\n      \"Style\",\r\n      \"Actions\",\r\n      \"Events\",\r\n      \"Mounted\",\r\n      \"Pointer Events\",\r\n      \"Hover Events\",\r\n      \"Dimensions\",\r\n      \"Margin and padding\",\r\n    ],\r\n  },\r\n  initialize() {\r\n    this.props.attrs = {};\r\n    this.props.default = \"\";\r\n  },\r\n  getReactComponent() {\r\n    return Image;\r\n  },\r\n  getInspectInfo() {\r\n    if (this.props.dom.srcSet) {\r\n      return this.props.dom.srcSet;\r\n    } else if (this.props.dom.src) {\r\n      const src = this.props.dom.src.toString();\r\n      return [\r\n        { type: \"text\", value: src },\r\n        { type: \"image\", value: src },\r\n      ];\r\n    }\r\n  },\r\n  allowChildren: false,\r\n  defaultCss: {\r\n    display: \"block\",\r\n    flexShrink: 0,\r\n  },\r\n  inputCss: {\r\n    objectFit: {\r\n      displayName: \"Image Fit\",\r\n      group: \"Dimensions\",\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          { label: \"Fill\", value: \"fill\" },\r\n          { label: \"Contain\", value: \"contain\" },\r\n          { label: \"Cover\", value: \"cover\" },\r\n          { label: \"None\", value: \"none\" },\r\n          { label: \"Scale Down\", value: \"scale-down\" },\r\n        ],\r\n      },\r\n      default: \"contain\",\r\n      allowVisualStates: true,\r\n    },\r\n  },\r\n  dynamicports: [\r\n    {\r\n      condition: \"sizeMode = explicit\",\r\n      inputs: [\"objectFit\"],\r\n    },\r\n  ],\r\n  inputs: {\r\n    src: {\r\n      displayName: \"Source\",\r\n      group: \"Image\",\r\n      propPath: \"dom\",\r\n      type: {\r\n        name: \"image\",\r\n      },\r\n      index: 30,\r\n      allowVisualStates: true,\r\n      set(url) {\r\n        this.props.dom.src = getAbsoluteUrl(url);\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n    testId: {\r\n      index: 100009,\r\n      displayName: \"Test ID Attribute\",\r\n      group: \"Advanced HTML\",\r\n      type: \"string\",\r\n      set(value) {\r\n        this.props.attrs[\"data-testid\"] = value;\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n  },\r\n  inputProps: {\r\n    srcSet: {\r\n      displayName: \"Source Set\",\r\n      group: \"Image\",\r\n      propPath: \"dom\",\r\n      type: {\r\n        name: \"string\",\r\n      },\r\n      index: 31,\r\n      allowVisualStates: true,\r\n    },\r\n    alt: {\r\n      displayName: \"Alternate text\",\r\n      tooltip:\r\n        \"The alt text is used by screen readers, or if the image can't be downloaded or displayed\",\r\n      type: \"string\",\r\n      propPath: \"dom\",\r\n      index: 1000,\r\n      default: \"\",\r\n    },\r\n  },\r\n  outputProps: {\r\n    onLoad: {\r\n      displayName: \"On Load\",\r\n      propPath: \"dom\",\r\n      type: \"signal\",\r\n      group: \"Events\",\r\n    },\r\n    onError: {\r\n      displayName: \"On Error\",\r\n      propPath: \"dom\",\r\n      type: \"signal\",\r\n      group: \"Events\",\r\n    },\r\n  },\r\n};\r\n\r\nNodeSharedPortDefinitions.addDimensions(ImageNode, {\r\n  defaultSizeMode: \"contentSize\",\r\n  contentLabel: \"Image\",\r\n});\r\nNodeSharedPortDefinitions.addTransformInputs(ImageNode);\r\nNodeSharedPortDefinitions.addMarginInputs(ImageNode);\r\nNodeSharedPortDefinitions.addSharedVisualInputs(ImageNode);\r\nNodeSharedPortDefinitions.addAlignInputs(ImageNode);\r\nNodeSharedPortDefinitions.addPointerEventOutputs(ImageNode);\r\nNodeSharedPortDefinitions.addBorderInputs(ImageNode);\r\nNodeSharedPortDefinitions.addShadowInputs(ImageNode);\r\n\r\nexport default createNodeFromReactComponent(ImageNode);\r\n","import React, { JSX } from \"react\";\r\n\r\nimport Layout from \"../../../layout\";\r\nimport PointerListeners from \"../../../pointerlisteners\";\r\nimport { Noodl } from \"../../../types\";\r\n\r\nexport interface TextProps extends Noodl.ReactProps {\r\n  as?: keyof JSX.IntrinsicElements | React.ComponentType<any>;\r\n\r\n  attrs: React.Attributes;\r\n\r\n  textStyle: Noodl.TextStyle;\r\n  text: string;\r\n\r\n  sizeMode?: Noodl.SizeMode;\r\n  width?: string;\r\n  height?: string;\r\n  fixedWidth?: boolean;\r\n  fixedHeight?: boolean;\r\n\r\n  // Extra Attributes\r\n  dom: Record<string, unknown>;\r\n}\r\n\r\nexport function Text(props: TextProps) {\r\n  const { as: Component = \"div\" } = props;\r\n\r\n  const style = {\r\n    ...props.textStyle,\r\n    ...props.style,\r\n  };\r\n\r\n  Layout.size(style, props);\r\n  Layout.align(style, props);\r\n\r\n  style.color = props.noodlNode.context.styles.resolveColor(style.color);\r\n\r\n  // Respect '\\n' in the string\r\n  if (props.sizeMode === \"contentSize\" || props.sizeMode === \"contentWidth\") {\r\n    style.whiteSpace = \"pre\";\r\n  } else {\r\n    style.whiteSpace = \"pre-wrap\";\r\n    style.overflowWrap = \"anywhere\";\r\n  }\r\n\r\n  if (style.opacity === 0) {\r\n    style.pointerEvents = \"none\";\r\n  }\r\n\r\n  return (\r\n    <Component\r\n      className={[\"ndl-visual-text\", props.className].join(\" \")}\r\n      {...props.attrs}\r\n      {...props.dom}\r\n      {...PointerListeners(props)}\r\n      style={style}\r\n    >\r\n      {String(props.text)}\r\n    </Component>\r\n  );\r\n}\r\n","import { Text } from '../../components/visual/Text';\r\nimport NodeSharedPortDefinitions from '../../node-shared-port-definitions';\r\nimport { createNodeFromReactComponent } from '../../react-component-node';\r\nimport { createTooltip } from '../../tooltips';\r\n\r\nconst TextNode = {\r\n  name: 'Text',\r\n  docs: 'https://docs.noodl.net/nodes/basic-elements/text',\r\n  visualStates: [\r\n    { name: 'neutral', label: 'Neutral' },\r\n    { name: 'hover', label: 'Hover' }\r\n  ],\r\n  allowChildren: false,\r\n  noodlNodeAsProp: true,\r\n  usePortAsLabel: 'text',\r\n  portLabelTruncationMode: 'length',\r\n  connectionPanel: {\r\n    groupPriority: ['General', 'Text', 'Text Style', 'Style', 'Events', 'Mounted', 'Hover Events', 'Pointer Events']\r\n  },\r\n  nodeDoubleClickAction: {\r\n    focusPort: 'text'\r\n  },\r\n  initialize() {\r\n    this.props.attrs = {};\r\n  },\r\n  getReactComponent() {\r\n    return Text;\r\n  },\r\n  getInspectInfo() {\r\n    return this.props.text;\r\n  },\r\n  defaultCss: {\r\n    position: 'relative',\r\n    display: 'flex'\r\n  },\r\n  inputProps: {\r\n    text: {\r\n      index: 19,\r\n      group: 'Text',\r\n      displayName: 'Text',\r\n      default: 'Text',\r\n      type: {\r\n        name: 'string',\r\n        multiline: true\r\n      }\r\n    },\r\n    as: {\r\n      index: 100000,\r\n      group: 'Advanced HTML',\r\n      displayName: 'Tag',\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: '<div>', value: 'div' },\r\n          { label: '<h1>', value: 'h1' },\r\n          { label: '<h2>', value: 'h2' },\r\n          { label: '<h3>', value: 'h3' },\r\n          { label: '<h4>', value: 'h4' },\r\n          { label: '<h5>', value: 'h5' },\r\n          { label: '<h6>', value: 'h6' },\r\n          { label: '<p>', value: 'p' },\r\n          { label: '<span>', value: 'span' }\r\n          // { label: '<a>', value: 'a' },\r\n        ]\r\n      },\r\n      default: 'div'\r\n    }\r\n  },\r\n  inputCss: {\r\n    wordBreak: {\r\n      index: 27,\r\n      group: 'Text',\r\n      displayName: 'Word Break',\r\n      applyDefault: false,\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: 'Normal', value: 'normal' },\r\n          { label: 'Break All', value: 'break-all' }\r\n        ]\r\n      },\r\n      default: 'normal'\r\n    }\r\n  },\r\n  inputs: {\r\n    textAlignX: {\r\n      group: 'Text Alignment',\r\n      index: 13,\r\n      displayName: 'Text Horizontal Align',\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: 'left', value: 'left' },\r\n          { label: 'center', value: 'center' },\r\n          { label: 'right', value: 'right' }\r\n        ],\r\n        alignComp: 'justify'\r\n      },\r\n      default: 'left',\r\n      set(value) {\r\n        switch (value) {\r\n          case 'left':\r\n            this.setStyle({ textAlign: 'left', justifyContent: 'flex-start' });\r\n            break;\r\n          case 'center':\r\n            this.setStyle({ textAlign: 'center', justifyContent: 'center' });\r\n            break;\r\n          case 'right':\r\n            this.setStyle({ textAlign: 'right', justifyContent: 'flex-end' });\r\n            break;\r\n        }\r\n      }\r\n    },\r\n    textAlignY: {\r\n      group: 'Text Alignment',\r\n      index: 14,\r\n      displayName: 'Text Vertical Align',\r\n      type: {\r\n        name: 'enum',\r\n        enums: [\r\n          { label: 'Top', value: 'top' },\r\n          { label: 'Center', value: 'center' },\r\n          { label: 'Bottom', value: 'bottom' }\r\n        ],\r\n        alignComp: 'vertical'\r\n      },\r\n      default: 'top',\r\n      set(value) {\r\n        switch (value) {\r\n          case 'top':\r\n            this.setStyle({ alignItems: 'flex-start' });\r\n            break;\r\n          case 'center':\r\n            this.setStyle({ alignItems: 'center' });\r\n            break;\r\n          case 'bottom':\r\n            this.setStyle({ alignItems: 'flex-end' });\r\n            break;\r\n        }\r\n      }\r\n    },\r\n    testId: {\r\n      index: 100009,\r\n      displayName: 'Test ID Attribute',\r\n      group: 'Advanced HTML',\r\n      type: 'string',\r\n      set(value) {\r\n        this.props.attrs[\"data-testid\"] = value;\r\n        this.forceUpdate();\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nNodeSharedPortDefinitions.addDimensions(TextNode, {\r\n  defaultSizeMode: 'contentHeight',\r\n  contentLabel: 'Text'\r\n});\r\nNodeSharedPortDefinitions.addTextStyleInputs(TextNode);\r\nNodeSharedPortDefinitions.addAlignInputs(TextNode);\r\nNodeSharedPortDefinitions.addTransformInputs(TextNode);\r\nNodeSharedPortDefinitions.addMarginInputs(TextNode);\r\nNodeSharedPortDefinitions.addSharedVisualInputs(TextNode);\r\nNodeSharedPortDefinitions.addPointerEventOutputs(TextNode);\r\n\r\nfunction defineTooltips(node) {\r\n  node.inputCss.wordBreak.tooltip = createTooltip({\r\n    title: 'Word break',\r\n    body: [\r\n      'Control where line breaks are allowed',\r\n      '- Normal: Break on spaces and other whitespace characters',\r\n      '- Break All: Allow line breaks between any two characters, including inside words'\r\n    ]\r\n  });\r\n}\r\n\r\n// eslint-disable-next-line no-undef\r\nif (!Noodl.runDeployed) {\r\n  defineTooltips(TextNode);\r\n}\r\n\r\nexport default createNodeFromReactComponent(TextNode);\r\n","import React from \"react\";\r\n\r\nimport Layout from \"../../../layout\";\r\nimport PointerListeners from \"../../../pointerlisteners\";\r\nimport { Noodl } from \"../../../types\";\r\n\r\nexport interface VideoProps extends Noodl.ReactProps {\r\n  objectPositionX: string;\r\n  objectPositionY: string;\r\n\r\n  dom: Exclude<CachedVideoProps, \"innerRef\" | \"onCanPlay\">;\r\n\r\n  onCanPlay?: () => void;\r\n  videoWidth?: (value: number) => void;\r\n  videoHeight?: (value: number) => void;\r\n  onVideoElementCreated?: (video) => void;\r\n}\r\n\r\nexport interface CachedVideoProps {\r\n  className?: string;\r\n  style?: React.CSSProperties;\r\n\r\n  muted?: boolean;\r\n  loop?: boolean;\r\n  volume?: number;\r\n  autoplay?: boolean;\r\n  controls?: boolean;\r\n  src: string;\r\n\r\n  innerRef: (video: HTMLVideoElement) => void;\r\n  onCanPlay: () => void;\r\n}\r\n\r\nclass CachedVideo extends React.PureComponent<CachedVideoProps> {\r\n  video: HTMLVideoElement | null = null;\r\n\r\n  componentDidUpdate() {\r\n    if (this.video) {\r\n      this.video.muted = this.props.muted ?? false;\r\n      this.video.loop = this.props.loop ?? false;\r\n      this.video.volume = this.props.volume ?? 1;\r\n      this.video.autoplay = this.props.autoplay ?? false;\r\n      this.video.controls = this.props.controls ?? false;\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let src = this.props.src ? this.props.src.toString() : undefined;\r\n\r\n    if (src) {\r\n      if (src.indexOf(\"#t=\") === -1) {\r\n        src += \"#t=0.01\"; //force Android to render the first frame\r\n      }\r\n      if (src.startsWith(\"/\")) {\r\n        // @ts-expect-error missing Noodl typings\r\n        const baseUrl = Noodl.Env[\"BaseUrl\"];\r\n        if (baseUrl) {\r\n          src = baseUrl + src.substring(1);\r\n        }\r\n      }\r\n    }\r\n\r\n    return (\r\n      <video\r\n        {...this.props}\r\n        playsInline={true}\r\n        src={src}\r\n        {...PointerListeners(this.props)}\r\n        ref={(video) => {\r\n          this.video = video;\r\n          this.props.innerRef(video!);\r\n        }}\r\n      />\r\n    );\r\n  }\r\n}\r\n\r\nexport class Video extends React.Component<VideoProps> {\r\n  wantToPlay: boolean;\r\n  canPlay: boolean;\r\n  video: HTMLVideoElement | null = null;\r\n\r\n  constructor(props: VideoProps) {\r\n    super(props);\r\n\r\n    this.wantToPlay = false;\r\n    this.canPlay = false;\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.canPlay = false;\r\n  }\r\n\r\n  setSourceObject(src) {\r\n    if (this.video && this.video.srcObject !== src) {\r\n      this.video.srcObject = src;\r\n      this.canPlay = false; //wait for can play event\r\n    }\r\n  }\r\n\r\n  play() {\r\n    this.wantToPlay = true;\r\n    if (this.video && this.canPlay) {\r\n      this.video.play();\r\n    }\r\n  }\r\n\r\n  restart() {\r\n    this.wantToPlay = true;\r\n    if (this.video && this.canPlay) {\r\n      this.video.currentTime = 0;\r\n      this.video.play();\r\n    }\r\n  }\r\n\r\n  pause() {\r\n    this.wantToPlay = false;\r\n    this.video && this.video.pause();\r\n  }\r\n\r\n  reset() {\r\n    this.wantToPlay = false;\r\n    if (this.video) {\r\n      this.video.currentTime = 0;\r\n      this.video.pause();\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const props = this.props;\r\n    const style = {\r\n      ...props.style,\r\n    };\r\n\r\n    Layout.size(style, props);\r\n    Layout.align(style, props);\r\n\r\n    if (style.opacity === 0) {\r\n      style.pointerEvents = \"none\";\r\n    }\r\n\r\n    style.objectPosition = `${props.objectPositionX} ${props.objectPositionY}`;\r\n\r\n    return (\r\n      <CachedVideo\r\n        {...props.dom}\r\n        className={props.className}\r\n        style={style}\r\n        innerRef={(video) => {\r\n          this.video = video;\r\n          this.props.onVideoElementCreated &&\r\n            this.props.onVideoElementCreated(video);\r\n        }}\r\n        onCanPlay={() => {\r\n          this.canPlay = true;\r\n          if (this.wantToPlay) {\r\n            this.video!.play();\r\n          }\r\n          this.props.onCanPlay && this.props.onCanPlay();\r\n          this.props.videoWidth &&\r\n            this.props.videoWidth(this.video!.videoWidth);\r\n          this.props.videoHeight &&\r\n            this.props.videoHeight(this.video!.videoHeight);\r\n        }}\r\n      />\r\n    );\r\n  }\r\n}\r\n","import { getAbsoluteUrl } from \"@fluxscape/runtime\";\r\n\r\nimport { Video } from \"../../components/visual/Video\";\r\nimport NodeSharedPortDefinitions from \"../../node-shared-port-definitions\";\r\nimport { createNodeFromReactComponent } from \"../../react-component-node\";\r\n\r\nconst VideoNode = {\r\n  name: \"Video\",\r\n  docs: \"https://docs.noodl.net/nodes/basic-elements/video\",\r\n  connectionPanel: {\r\n    groupPriority: [\r\n      \"General\",\r\n      \"Video\",\r\n      \"Video Actions\",\r\n      \"Style\",\r\n      \"Actions\",\r\n      \"Events\",\r\n      \"Mounted\",\r\n      \"Playback\",\r\n      \"Pointer Events\",\r\n      \"Hover Events\",\r\n      \"Dimensions\",\r\n      \"Margin and padding\",\r\n    ],\r\n  },\r\n  getReactComponent() {\r\n    return Video;\r\n  },\r\n  allowChildren: false,\r\n  noodlNodeAsProp: true,\r\n  defaultCss: {\r\n    display: \"block\",\r\n  },\r\n  inputs: {\r\n    srcObject: {\r\n      displayName: \"Source Object\",\r\n      group: \"Video\",\r\n      type: \"mediastream\",\r\n      default: null,\r\n      set(value) {\r\n        this.innerReactComponentRef &&\r\n          this.innerReactComponentRef.setSourceObject(value);\r\n      },\r\n    },\r\n    play: {\r\n      type: \"signal\",\r\n      group: \"Video Actions\",\r\n      displayName: \"Play\",\r\n      tooltip: {\r\n        standard: \"Play the video\",\r\n      },\r\n      valueChangedToTrue() {\r\n        this.innerReactComponentRef && this.innerReactComponentRef.play();\r\n      },\r\n    },\r\n    restart: {\r\n      type: \"signal\",\r\n      group: \"Video Actions\",\r\n      displayName: \"Restart\",\r\n      tooltip: {\r\n        standard: \"Restart the video from the beginning\",\r\n      },\r\n      valueChangedToTrue() {\r\n        this.innerReactComponentRef && this.innerReactComponentRef.restart();\r\n      },\r\n    },\r\n    pause: {\r\n      type: \"boolean\",\r\n      group: \"Video Actions\",\r\n      displayName: \"Pause\",\r\n      valueChangedToTrue() {\r\n        this.innerReactComponentRef && this.innerReactComponentRef.pause();\r\n      },\r\n    },\r\n    reset: {\r\n      type: \"boolean\",\r\n      group: \"Video Actions\",\r\n      displayName: \"Reset\",\r\n      valueChangedToTrue() {\r\n        this.innerReactComponentRef && this.innerReactComponentRef.reset();\r\n      },\r\n    },\r\n    src: {\r\n      displayName: \"Source\",\r\n      group: \"Video\",\r\n      type: \"string\",\r\n      set(src) {\r\n        this.props.dom.src = getAbsoluteUrl(src);\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n    poster: {\r\n      displayName: \"Poster\",\r\n      group: \"Video\",\r\n      type: \"image\",\r\n      set(src) {\r\n        this.props.dom.poster = getAbsoluteUrl(src);\r\n        this.forceUpdate();\r\n      },\r\n    },\r\n  },\r\n  inputProps: {\r\n    autoplay: {\r\n      displayName: \"Autoplay\",\r\n      propPath: \"dom\",\r\n      group: \"Video\",\r\n      type: \"boolean\",\r\n    },\r\n    controls: {\r\n      displayName: \"Controls\",\r\n      propPath: \"dom\",\r\n      group: \"Video\",\r\n      type: \"boolean\",\r\n    },\r\n    volume: {\r\n      displayName: \"Volume\",\r\n      propPath: \"dom\",\r\n      group: \"Video\",\r\n      type: \"number\",\r\n      default: 1,\r\n    },\r\n    muted: {\r\n      displayName: \"Muted\",\r\n      propPath: \"dom\",\r\n      group: \"Video\",\r\n      type: \"boolean\",\r\n    },\r\n    loop: {\r\n      displayName: \"Loop\",\r\n      propPath: \"dom\",\r\n      group: \"Video\",\r\n      type: \"boolean\",\r\n    },\r\n    objectPositionX: {\r\n      displayName: \"Video Position X\",\r\n      group: \"Video Layout\",\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"%\", \"px\"],\r\n        defaultUnit: \"%\",\r\n      },\r\n      default: 50,\r\n    },\r\n    objectPositionY: {\r\n      displayName: \"Video Position Y\",\r\n      group: \"Video Layout\",\r\n      type: {\r\n        name: \"number\",\r\n        units: [\"%\", \"px\"],\r\n        defaultUnit: \"%\",\r\n      },\r\n      default: 50,\r\n    },\r\n  },\r\n  inputCss: {\r\n    objectFit: {\r\n      displayName: \"Object Fit\",\r\n      group: \"Video Layout\",\r\n      type: {\r\n        name: \"enum\",\r\n        enums: [\r\n          {\r\n            label: \"Contain\",\r\n            value: \"contain\",\r\n          },\r\n          {\r\n            label: \"Cover\",\r\n            value: \"cover\",\r\n          },\r\n          {\r\n            label: \"Fill\",\r\n            value: \"fill\",\r\n          },\r\n          {\r\n            label: \"None\",\r\n            value: \"none\",\r\n          },\r\n        ],\r\n      },\r\n      default: \"contain\",\r\n    },\r\n  },\r\n  outputProps: {\r\n    onCanPlay: {\r\n      type: \"signal\",\r\n      group: \"Events\",\r\n      displayName: \"On Can Play\",\r\n    },\r\n    onTimeUpdate: {\r\n      group: \"Playback\",\r\n      displayName: \"Playback Position\",\r\n      type: \"number\",\r\n      propPath: \"dom\",\r\n      getValue(event) {\r\n        return event.target.currentTime;\r\n      },\r\n    },\r\n    onPlay: {\r\n      group: \"Events\",\r\n      displayName: \"On Play\",\r\n      type: \"signal\",\r\n      propPath: \"dom\",\r\n    },\r\n    onPause: {\r\n      group: \"Events\",\r\n      displayName: \"On Pause\",\r\n      type: \"signal\",\r\n      propPath: \"dom\",\r\n    },\r\n    onVideoElementCreated: {\r\n      type: \"domelement\",\r\n      displayName: \"DOM Element\",\r\n    },\r\n    videoWidth: {\r\n      group: \"Playback\",\r\n      type: \"number\",\r\n      displayName: \"Video Width\",\r\n    },\r\n    videoHeight: {\r\n      group: \"Playback\",\r\n      type: \"number\",\r\n      displayName: \"Video Height\",\r\n    },\r\n  },\r\n};\r\n\r\nNodeSharedPortDefinitions.addDimensions(VideoNode, {\r\n  defaultSizeMode: \"contentSize\",\r\n  contentLabel: \"Video\",\r\n});\r\nNodeSharedPortDefinitions.addTransformInputs(VideoNode);\r\nNodeSharedPortDefinitions.addMarginInputs(VideoNode);\r\nNodeSharedPortDefinitions.addSharedVisualInputs(VideoNode);\r\nNodeSharedPortDefinitions.addAlignInputs(VideoNode);\r\nNodeSharedPortDefinitions.addPointerEventOutputs(VideoNode);\r\nNodeSharedPortDefinitions.addBorderInputs(VideoNode);\r\n\r\nexport default createNodeFromReactComponent(VideoNode);\r\n","import api from \"!../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n            import content from \"!!../../node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[2].use[1]!./style.css\";\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\n\n\nexport default content.locals || {};","import { NodeScope } from \"@fluxscape/runtime\";\r\nimport type { NodeRegister, GraphModel, TSFixme } from \"../typings/global\";\r\nimport { FontLoader } from \"./fontloader\";\r\n\r\nfunction getInputsWithType(nodeScope: NodeScope, inputType) {\r\n  const result = [];\r\n\r\n  const nodes = nodeScope.getAllNodesRecursive();\r\n  nodes.forEach((node) => {\r\n    const inputs = [];\r\n\r\n    for (const inputName in node._inputs) {\r\n      const input = node._inputs[inputName];\r\n      if (input.type === inputType) {\r\n        // @ts-expect-error\r\n        inputs.push(inputName);\r\n      }\r\n    }\r\n\r\n    if (inputs.length) {\r\n      // @ts-expect-error\r\n      result.push({ node, inputs });\r\n    }\r\n  });\r\n\r\n  return result;\r\n}\r\n\r\ntype TextStyleData = {\r\n  letterSpacing: string;\r\n  lineHeight: { value: string; unit: string };\r\n  textTransform: string;\r\n  fontSize: { value: string; unit: string };\r\n  fontFamily: string;\r\n  color: string;\r\n};\r\n\r\ntype StylesData = {\r\n  text?: Record<string, TextStyleData>;\r\n  colors?: Record<string, string>;\r\n};\r\n\r\nexport default class Styles {\r\n  getNodeScope: () => TSFixme;\r\n  graphModel: GraphModel;\r\n  nodeRegister: NodeRegister;\r\n  // @ts-expect-error\r\n  styles: StylesData;\r\n\r\n  constructor({ graphModel, nodeRegister, getNodeScope }) {\r\n    this.getNodeScope = getNodeScope;\r\n    this.graphModel = graphModel;\r\n    this.nodeRegister = nodeRegister;\r\n\r\n    this.setStyles(graphModel.getMetaData(\"styles\") || {});\r\n    graphModel.on(\"metadataChanged.styles\", (styles) => this.setStyles(styles));\r\n  }\r\n\r\n  setStyles(styles: StylesData) {\r\n    // Brute force update all styles, no delta check\r\n    this.styles = styles;\r\n\r\n    // Process text styles\r\n    const textStyles = styles.text || {};\r\n\r\n    // Format font family\r\n    Object.values(textStyles)\r\n      .filter((style) => style.fontFamily)\r\n      .forEach((textStyle) => {\r\n        let family = textStyle.fontFamily;\r\n\r\n        // Load files and create font css\r\n        if (family.split(\".\").length > 1) {\r\n          FontLoader.instance.loadFont(family);\r\n          family = family.replace(/\\.[^/.]+$/, \"\");\r\n          // @ts-expect-error\r\n          family = family.split(\"/\").pop();\r\n\r\n          // Update the style to the font css instead of the file name\r\n          textStyle.fontFamily = family;\r\n        }\r\n      });\r\n\r\n    // Format values with units (to css strings)\r\n    for (const name in textStyles) {\r\n      const style = textStyles[name];\r\n      for (const prop in style) {\r\n        const value = style[prop];\r\n        if (typeof value === \"object\") {\r\n          style[prop] = value.value + value.unit;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Remove colors with empty strings\r\n    for (const name in textStyles) {\r\n      const style = textStyles[name];\r\n      if (style.hasOwnProperty(\"color\") && !style.color) {\r\n        // @ts-expect-error\r\n        delete style.color;\r\n      }\r\n    }\r\n\r\n    const nodeScope = this.getNodeScope && this.getNodeScope();\r\n    if (!nodeScope) return;\r\n\r\n    const variants = this.graphModel.getVariants();\r\n    for (const variant of variants) {\r\n      if (this._variantHasInputsWithTypes(variant, [\"color\", \"textStyle\"])) {\r\n        const nodes = nodeScope.getAllNodesWithVariantRecursive(variant);\r\n        nodes.forEach((node) => node.setVariant(variant));\r\n      }\r\n    }\r\n\r\n    //set all inputs with types using styles\r\n    //just re-apply the previous value to trigger a new style resolve\r\n    [\"color\", \"textStyle\"].forEach((inputType) => {\r\n      getInputsWithType(nodeScope, inputType).forEach(({ node, inputs }) => {\r\n        // @ts-expect-error\r\n        inputs.forEach((inputName) => {\r\n          // @ts-expect-error\r\n          if (node.getInputValue(inputName)) {\r\n            // @ts-expect-error\r\n            node.setInputValue(inputName, node.getInputValue(inputName));\r\n          }\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  resolveColor(color: string) {\r\n    if (!this.styles.colors) return color;\r\n\r\n    const resolvedColor = this.styles.colors[color];\r\n    return resolvedColor ? resolvedColor : color;\r\n  }\r\n\r\n  getTextStyle(styleName: string) {\r\n    if (!this.styles.text) return {};\r\n    return this.styles.text[styleName] || {};\r\n  }\r\n\r\n  //checks if a variant includes inputs with the specified types\r\n  _variantHasInputsWithTypes(variant, types) {\r\n    if (!this.nodeRegister.hasNode(variant.typename)) return;\r\n\r\n    //get the metadata for the node this variant is used by\r\n    const metadata = this.nodeRegister.getNodeMetadata(variant.typename);\r\n\r\n    //get all the inputs this variant affects...\r\n    const parameterNames = new Set(Object.keys(variant.parameters));\r\n    for (const state in variant.stateParameters) {\r\n      Object.keys(variant.stateParameters[state]).forEach((param) =>\r\n        parameterNames.add(param)\r\n      );\r\n    }\r\n\r\n    //...and check if the inputs are of the supplied types\r\n    for (const param of Array.from(parameterNames)) {\r\n      const inputType = metadata.inputs[param] && metadata.inputs[param].type;\r\n      if (types.includes(inputType)) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n}\r\n","import React from \"react\";\r\n\r\nimport { NoHomeError } from \"./components/common/NoHomeError\";\r\nimport GraphWarnings from \"./graph-warnings\";\r\nimport { Highlighter } from \"./highlighter\";\r\nimport { Inspector } from \"./inspector\";\r\nimport NoodlJSAPI from \"./noodl-js-api\";\r\nimport projectSettings from \"./project-settings\";\r\nimport { createNodeFromReactComponent } from \"./react-component-node\";\r\nimport registerNodes from \"./register-nodes\";\r\nimport Styles from \"./styles\";\r\n\r\nif (typeof window !== \"undefined\" && window.NoodlEditor) {\r\n  window.NoodlEditorInspectorAPI = {\r\n    enabled: false,\r\n    inspector: null,\r\n    setInspector(inspector) {\r\n      this.inspector = inspector;\r\n      this.enabled ? this.inspector.enable() : this.inspector.disable();\r\n    },\r\n    setEnabled(enabled) {\r\n      this.enabled = enabled;\r\n      if (this.inspector) {\r\n        this.enabled ? this.inspector.enable() : this.inspector.disable();\r\n      }\r\n\r\n      if (window.NoodlEditorHighlightAPI.highlighter) {\r\n        window.NoodlEditorHighlightAPI.highlighter.setWindowSelected(enabled);\r\n      }\r\n    },\r\n  };\r\n\r\n  window.NoodlEditorHighlightAPI = {\r\n    highlighter: null,\r\n    setHighlighter(highlighter) {\r\n      this.highlighter = highlighter;\r\n\r\n      this.highlighter.setWindowSelected(\r\n        window.NoodlEditorInspectorAPI.enabled\r\n      );\r\n    },\r\n    selectNode(nodeId) {\r\n      this.highlighter.deselectNodes();\r\n\r\n      if (nodeId && nodeId !== \"null\") {\r\n        this.highlighter.selectNodesWithId(nodeId);\r\n      } else if (window.NoodlEditorInspectorAPI.enabled) {\r\n        this.highlighter.setWindowSelected(true);\r\n      }\r\n    },\r\n  };\r\n}\r\n\r\nexport function ssrSetupRuntime(noodlRuntime, noodlModules, projectData) {\r\n  registerNodes(noodlRuntime);\r\n\r\n  // Noodl static API\r\n  NoodlJSAPI(noodlRuntime);\r\n\r\n  noodlRuntime.setProjectSettings(projectSettings);\r\n\r\n  // Register module nodes\r\n  if (noodlModules) {\r\n    for (const module of noodlModules) {\r\n      if (module.reactNodes) {\r\n        const reactNodes = [];\r\n        for (const nodeDefinition of module.reactNodes) {\r\n          reactNodes.push(createNodeFromReactComponent(nodeDefinition));\r\n        }\r\n        const nodes = module.nodes || [];\r\n        module.nodes = nodes.concat(reactNodes);\r\n      }\r\n      noodlRuntime.registerModule(module);\r\n    }\r\n  }\r\n\r\n  const styles = new Styles({\r\n    graphModel: noodlRuntime.graphModel,\r\n    getNodeScope: () =>\r\n      noodlRuntime.context.rootComponent &&\r\n      noodlRuntime.context.rootComponent.nodeScope,\r\n    nodeRegister: noodlRuntime.context.nodeRegister,\r\n  });\r\n\r\n  //make the styles available to all nodes via `this.context.styles`\r\n  noodlRuntime.context.styles = styles;\r\n\r\n  noodlRuntime.setData(projectData);\r\n  noodlRuntime._disableLoad = true;\r\n}\r\n\r\nexport default class Viewer extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      popups: [],\r\n    };\r\n\r\n    const { noodlRuntime } = props;\r\n    this.runningDeployed = this.props.projectData !== undefined;\r\n    this.focusedNoodlNodes = [];\r\n\r\n    noodlRuntime.context.setNodeFocused = this.setNodeFocused.bind(this);\r\n\r\n    const enableDebugInspectors =\r\n      (typeof document !== \"undefined\" &&\r\n        document.location.href.indexOf(\"forceDebugger=true\") !== -1) ||\r\n      Noodl.enableDebugInspectors;\r\n    noodlRuntime.setDebugInspectorsEnabled(enableDebugInspectors);\r\n\r\n    noodlRuntime.context.setPopupCallbacks({\r\n      onShow: (popup) => {\r\n        const newPopupArray = this.state.popups.concat([popup]);\r\n\r\n        const bodyScroll = noodlRuntime.getProjectSettings().bodyScroll;\r\n\r\n        //Disable body scroll when showing a popup\r\n        if (bodyScroll && newPopupArray.length === 1) {\r\n          document.body.style.width = document.body.clientWidth + \"px\";\r\n          document.body.style.top = `-${window.scrollY}px`;\r\n          document.body.style.position = \"fixed\";\r\n        }\r\n\r\n        this.setState({\r\n          popups: newPopupArray,\r\n        });\r\n      },\r\n      onClose: (popup) => {\r\n        const newPopupArray = this.state.popups.filter((p) => p !== popup);\r\n\r\n        this.setState({\r\n          popups: newPopupArray,\r\n        });\r\n\r\n        const bodyScroll = noodlRuntime.getProjectSettings().bodyScroll;\r\n\r\n        //Enable body scroll when hiding all popups\r\n        if (bodyScroll && newPopupArray.length === 0) {\r\n          const scrollY = document.body.style.top;\r\n          document.body.style.position = \"\";\r\n          document.body.style.top = \"\";\r\n          document.body.style.width = \"100%\";\r\n          window.scrollTo(0, parseInt(scrollY || \"0\") * -1);\r\n        }\r\n      },\r\n    });\r\n\r\n    registerNodes(noodlRuntime);\r\n\r\n    // Noodl static API\r\n    NoodlJSAPI(noodlRuntime);\r\n\r\n    noodlRuntime.setProjectSettings(projectSettings);\r\n\r\n    // Register module nodes\r\n    if (this.props.noodlModules) {\r\n      for (const module of this.props.noodlModules) {\r\n        if (module.reactNodes) {\r\n          const reactNodes = [];\r\n          for (const nodeDefinition of module.reactNodes) {\r\n            reactNodes.push(createNodeFromReactComponent(nodeDefinition));\r\n          }\r\n          const nodes = module.nodes || [];\r\n          module.nodes = nodes.concat(reactNodes);\r\n        }\r\n        noodlRuntime.registerModule(module);\r\n      }\r\n    }\r\n\r\n    noodlRuntime.eventEmitter.on(\"rootComponentUpdated\", () => {\r\n      //wait until next frame to trigger a react update, so inputs etc have a chance to settle\r\n      //(forceUpdate is synchronous)\r\n      requestAnimationFrame(() => this.forceUpdate());\r\n    });\r\n\r\n    noodlRuntime.graphModel.on(\"projectSettingsChanged\", (settings) => {\r\n      // Suppport SSR\r\n      if (typeof document === \"undefined\") return;\r\n\r\n      if (settings.bodyScroll) {\r\n        document.body.classList.add(\"body-scroll\");\r\n      } else {\r\n        document.body.classList.remove(\"body-scroll\");\r\n      }\r\n    });\r\n\r\n    this.styles = new Styles({\r\n      graphModel: noodlRuntime.graphModel,\r\n      getNodeScope: () =>\r\n        noodlRuntime.context.rootComponent &&\r\n        noodlRuntime.context.rootComponent.nodeScope,\r\n      nodeRegister: noodlRuntime.context.nodeRegister,\r\n    });\r\n\r\n    //make the styles available to all nodes via `this.context.styles`\r\n    noodlRuntime.context.styles = this.styles;\r\n\r\n    this.state.waitingForExport = !this.runningDeployed;\r\n\r\n    if (this.runningDeployed) {\r\n      this.props.noodlRuntime.setData(this.props.projectData);\r\n\r\n      //start pre-fetching the rest of the bundles after a while, if there arent too many of them\r\n      const allBundles = Object.keys(this.props.projectData.componentIndex);\r\n      if (allBundles.length < 30) {\r\n        setTimeout(() => {\r\n          this.props.noodlRuntime.prefetchBundles(allBundles, 3);\r\n        }, 10000);\r\n      }\r\n    } else {\r\n      noodlRuntime.graphModel.on(\"editorImportComplete\", () => {\r\n        this.setState({ waitingForExport: false });\r\n      });\r\n      this.connectToEditor();\r\n    }\r\n\r\n    this.focusedNoodlNodes = [];\r\n  }\r\n\r\n  connectToEditor() {\r\n    const { noodlRuntime } = this.props;\r\n\r\n    // Remove hash if it is in location href\r\n    var href =\r\n      (Noodl.host || location.protocol + \"//\" + location.host) +\r\n      location.pathname +\r\n      (location.search ? location.search : \"\");\r\n\r\n    const address = href.replace(\"http\", \"ws\");\r\n    noodlRuntime.connectToEditor(address);\r\n\r\n    this.highlightedNodes = new Map();\r\n    this.isUpdatingHighlights = false;\r\n\r\n    if (typeof window !== \"undefined\" && window.NoodlEditor) {\r\n      this.highlighter = new Highlighter(noodlRuntime);\r\n      NoodlEditorHighlightAPI.setHighlighter(this.highlighter);\r\n\r\n      noodlRuntime.editorConnection.on(\"hoverStart\", (id) => {\r\n        this.highlighter.highlightNodesWithId(id);\r\n      });\r\n      noodlRuntime.editorConnection.on(\"hoverEnd\", (id) => {\r\n        this.highlighter.disableHighlight();\r\n      });\r\n\r\n      this.inspector = new Inspector({\r\n        onDisableHighlight: () => this.highlighter.disableHighlight(),\r\n        onHighlight: (id) => this.highlighter.highlightNodesWithId(id),\r\n        onInspect: (ids) => {\r\n          NoodlEditor.inspectNodes(ids);\r\n        },\r\n      });\r\n      NoodlEditorInspectorAPI.setInspector(this.inspector);\r\n    }\r\n\r\n    noodlRuntime.editorConnection.on(\"debuggingEnabledChanged\", (enabled) => {\r\n      noodlRuntime.setDebugInspectorsEnabled(enabled);\r\n    });\r\n\r\n    this.graphWarnings = new GraphWarnings(\r\n      noodlRuntime.graphModel,\r\n      noodlRuntime.editorConnection\r\n    );\r\n  }\r\n\r\n  setNodeFocused(node, focused) {\r\n    if (focused && this.focusedNoodlNodes.indexOf(node) === -1) {\r\n      //blur nodes that don't contain this new node\r\n      this.focusedNoodlNodes\r\n        .filter((focusedNode) => !focusedNode.contains(node))\r\n        .forEach((blurredNode) => {\r\n          blurredNode._blur();\r\n        });\r\n\r\n      node._focus();\r\n      this.focusedNoodlNodes.push(node);\r\n    } else if (!focused) {\r\n      const index = this.focusedNoodlNodes.indexOf(node);\r\n      if (index !== -1) {\r\n        return;\r\n      }\r\n\r\n      node._blur();\r\n\r\n      //also blur nodes that contain this node\r\n      this.focusedNoodlNodes\r\n        .filter((focusedNode) => focusedNode.contains(node))\r\n        .forEach((blurredNode) => {\r\n          blurredNode._blur();\r\n        });\r\n\r\n      this.focusedNoodlNodes.splice(index, 1);\r\n    }\r\n  }\r\n\r\n  onClickCapture(e) {\r\n    const focusedNoodlNodes = [];\r\n\r\n    //walk up the dom tree and collect all noodl nodes\r\n    let elem = e.target;\r\n    while (elem) {\r\n      if (elem.noodlNode && elem.noodlNode._focus)\r\n        focusedNoodlNodes.push(elem.noodlNode);\r\n      elem = elem.parentNode;\r\n    }\r\n\r\n    //blur nodes that weren't part of this click\r\n    this.focusedNoodlNodes\r\n      .filter((node) => focusedNoodlNodes.indexOf(node) === -1)\r\n      .forEach((node) => node._blur());\r\n\r\n    //focus all new focused nodes\r\n    focusedNoodlNodes\r\n      .filter((node) => this.focusedNoodlNodes.indexOf(node) === -1)\r\n      .forEach((node) => node._focus());\r\n\r\n    this.focusedNoodlNodes = focusedNoodlNodes;\r\n  }\r\n\r\n  render() {\r\n    const rootComponent = this.props.noodlRuntime.rootComponent;\r\n    if (this.state.waitingForExport) return null;\r\n\r\n    if (!rootComponent) {\r\n      if (this.runningDeployed) {\r\n        return null;\r\n      } else {\r\n        return NoHomeError();\r\n      }\r\n    }\r\n\r\n    const bodyScroll = this.props.noodlRuntime.getProjectSettings().bodyScroll;\r\n\r\n    if (bodyScroll) {\r\n      const style = {\r\n        margin: 0,\r\n        padding: 0,\r\n        minHeight: \"100vh\",\r\n        alignSelf: \"stretch\",\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n      };\r\n      return (\r\n        <div style={style} onClickCapture={(e) => this.onClickCapture(e)}>\r\n          <div style={{ ...style, isolation: \"isolate\" }}>\r\n            {rootComponent.render()}\r\n          </div>\r\n          {this.state.popups.length ? (\r\n            <div style={{ ...style, isolation: \"isolate\" }}>\r\n              {this.state.popups.map((p) => p.render())}\r\n            </div>\r\n          ) : null}\r\n        </div>\r\n      );\r\n    } else {\r\n      return (\r\n        <div\r\n          style={{\r\n            margin: 0,\r\n            padding: 0,\r\n            overflow: \"hidden\",\r\n            width: \"100%\",\r\n            height: \"100%\",\r\n          }}\r\n          onClickCapture={(e) => this.onClickCapture(e)}\r\n        >\r\n          {rootComponent.render()}\r\n          {this.state.popups.map((p) => p.render())}\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n","// Controls\r\nimport Button from \"./nodes/controls/button\";\r\nimport CheckBox from \"./nodes/controls/checkbox\";\r\nimport Options from \"./nodes/controls/options\";\r\nimport RadioButton from \"./nodes/controls/radiobutton\";\r\nimport RadioButtonGroup from \"./nodes/controls/radiobuttongroup\";\r\nimport Range from \"./nodes/controls/slider\";\r\nimport TextInput from \"./nodes/controls/text-input\";\r\nimport NavigationStack from \"./nodes/navigation/navigation-stack\";\r\nimport Page from \"./nodes/navigation/page\";\r\nimport Router from \"./nodes/navigation/router\";\r\nimport * as ExternalLink from \"./nodes/std-library/externallink\";\r\nimport Circle from \"./nodes/visual/circle\";\r\nimport Columns from \"./nodes/visual/columns.js\";\r\nimport CSSDefinition from \"./nodes/visual/css-definition.js\";\r\nimport DragNode from \"./nodes/visual/drag.js\";\r\nimport Group from \"./nodes/visual/group.js\";\r\nimport Icon from \"./nodes/visual/icon.js\";\r\nimport Image from \"./nodes/visual/image.js\";\r\nimport TextNode from \"./nodes/visual/text.js\";\r\nimport Video from \"./nodes/visual/video.js\";\r\nimport \"./assets/style.css\";\r\nimport NoodlRuntime from \"@fluxscape/runtime\";\r\n\r\nexport default function registerNodes(noodlRuntime: NoodlRuntime) {\r\n  [\r\n    // require('./nodes/std-library/counter'), // moved to runtime\r\n    //  require('./nodes/std-library/expression'), // moved to runtime\r\n    //require('./nodes/std-library/condition'),\r\n    //require('./nodes/std-library/and'),\r\n    //require('./nodes/std-library/or'),\r\n    require(\"./nodes/std-library/switch\"),\r\n    //require('./nodes/std-library/booleantostring'), // moved to runtime\r\n    //require('./nodes/std-library/datetostring'),\r\n    //require('./nodes/std-library/stringmapper'),\r\n    //require('./nodes/std-library/inverter'),\r\n    require(\"./nodes/std-library/timer\"),\r\n    require(\"./nodes/std-library/variables/color\"),\r\n    //require('./nodes/std-library/substring'), // moved to runtime\r\n    require(\"./nodes/std-library/eventsender\"),\r\n    require(\"./nodes/std-library/eventreceiver\"),\r\n    require(\"./nodes/std-library/screenresolution\"),\r\n    require(\"./nodes/std-library/javascript\"),\r\n    //require('./nodes/std-library/simplejavascript'), // moved to runtime\r\n    require(\"./nodes/std-library/numberremapper\"),\r\n    require(\"./nodes/std-library/valuechanged\"),\r\n    require(\"./nodes/std-library/states\"),\r\n    //require('./nodes/std-library/stringformat'), // moved to runtime\r\n    require(\"./nodes/std-library/data/foreach\"),\r\n    require(\"./nodes/std-library/data/foreachactions\"),\r\n    require(\"./nodes/std-library/colorblend\"),\r\n    require(\"./nodes/std-library/animate-to-value\"),\r\n\r\n    //require('./nodes/std-library/variables/number'), // moved to runtime\r\n    //require('./nodes/std-library/variables/string'),\r\n    //require('./nodes/std-library/variables/boolean'),\r\n    require(\"./nodes/std-library/variables/color\"),\r\n\r\n    // Component Object\r\n    require(\"./nodes/std-library/componentutils/componentobject\"),\r\n    require(\"./nodes/std-library/componentutils/parentcomponentobject\"),\r\n    require(\"./nodes/std-library/componentutils/setcomponentobjectproperties\")\r\n      .default,\r\n    require(\"./nodes/std-library/componentutils/setparentcomponentobjectproperties\")\r\n      .default,\r\n\r\n    // Variable\r\n    require(\"./nodes/std-library/data/variablenode2\"),\r\n    require(\"./nodes/std-library/data/setvariablenode\"),\r\n\r\n    // New object\r\n    // require('./nodes/std-library/data/modelnode2'), // moved to runtime\r\n    // require('./nodes/std-library/data/setmodelpropertiesnode'),\r\n    // require('./nodes/std-library/data/newmodelnode'),\r\n\r\n    // New record\r\n    //require('./nodes/std-library/data/dbmodelnode2'), // moved to runtime\r\n    //require('./nodes/std-library/data/dbcollectionnode2'), // moved to runtime\r\n    // require('./nodes/std-library/data/setdbmodelpropertiesnode'),\r\n    // require('./nodes/std-library/data/deletedbmodelpropertiesnode'),\r\n    // require('./nodes/std-library/data/newdbmodelpropertiesnode'),\r\n    // require('./nodes/std-library/data/dbmodelnode-addrelation'),\r\n    // require('./nodes/std-library/data/dbmodelnode-removerelation'),\r\n    // require('./nodes/std-library/data/filterdbmodelsnode'),\r\n\r\n    // New array\r\n    require(\"./nodes/std-library/data/collectionnode2\"),\r\n    require(\"./nodes/std-library/data/collectionnode-insert\"),\r\n    require(\"./nodes/std-library/data/collectionnode-remove\"),\r\n    require(\"./nodes/std-library/data/collectionnode-clear\"),\r\n    require(\"./nodes/std-library/data/collectionnode-new\"),\r\n    require(\"./nodes/std-library/data/filtercollectionnode\"),\r\n\r\n    require(\"./nodes/std-library/data/staticdata\"),\r\n\r\n    require(\"./nodes/std-library/data/mapcollectionnode\"),\r\n    //require('./nodes/std-library/data/restnode'), // moved to runtime\r\n    require(\"./nodes/std-library/data/cloudfunction2\"),\r\n    //require('./nodes/std-library/uniqueid'), // moved to runtime\r\n\r\n    // Files\r\n    require(\"./nodes/std-library/openfilepicker\"),\r\n    require(\"./nodes/std-library/uploadfile\"),\r\n    //require('./nodes/std-library/data/cloudfilenode'), // moved to runtime\r\n\r\n    // Navigation\r\n    require(\"./nodes/navigation/navigate-back\"),\r\n    require(\"./nodes/navigation/navigate-to-path\"),\r\n    require(\"./nodes/navigation/navigate\"),\r\n    require(\"./nodes/navigation/showpopup\"),\r\n    require(\"./nodes/navigation/closepopup\"),\r\n\r\n    require(\"./nodes/navigation/page-inputs\"),\r\n    require(\"./nodes/navigation/router-navigate\"),\r\n\r\n    // User\r\n    require(\"./nodes/std-library/user/login\"),\r\n    require(\"./nodes/std-library/user/logout\"),\r\n    require(\"./nodes/std-library/user/signup\"),\r\n  ].forEach(function (nodeDefinition) {\r\n    noodlRuntime.registerNode(nodeDefinition);\r\n  });\r\n\r\n  noodlRuntime.registerNode(CSSDefinition);\r\n  noodlRuntime.registerNode(Group);\r\n  noodlRuntime.registerNode(TextNode);\r\n  noodlRuntime.registerNode(Image);\r\n  noodlRuntime.registerNode(Icon);\r\n  noodlRuntime.registerNode(Circle);\r\n  noodlRuntime.registerNode(Video);\r\n  noodlRuntime.registerNode(DragNode);\r\n  noodlRuntime.registerNode(ExternalLink);\r\n  noodlRuntime.registerNode(Columns);\r\n\r\n  // UI Controls\r\n  noodlRuntime.registerNode(Button);\r\n  noodlRuntime.registerNode(CheckBox);\r\n  noodlRuntime.registerNode(RadioButtonGroup);\r\n  noodlRuntime.registerNode(RadioButton);\r\n  noodlRuntime.registerNode(Options);\r\n  noodlRuntime.registerNode(Range);\r\n  noodlRuntime.registerNode(TextInput);\r\n\r\n  // Navigation\r\n  noodlRuntime.registerNode(NavigationStack);\r\n  noodlRuntime.registerNode(Page);\r\n  noodlRuntime.registerNode(Router);\r\n}\r\n","import { SeoApi } from \"./api/seo\";\r\n\r\nimport { Model, Collection, createRecordsAPI } from \"@fluxscape/runtime\";\r\nimport { default as users } from \"./api/users\";\r\nimport { default as cloudfunctions } from \"./api/cloudfunctions\";\r\nimport { default as navigation } from \"./api/navigation\";\r\nimport { default as files } from \"./api/files\";\r\n\r\nexport default function createNoodlAPI(noodlRuntime: any): void {\r\n  // Support SSR\r\n  const global: any = typeof window !== \"undefined\" ? window : globalThis;\r\n\r\n  global.Noodl.getProjectSettings =\r\n    noodlRuntime.getProjectSettings.bind(noodlRuntime);\r\n  global.Noodl.getMetaData = noodlRuntime.getMetaData.bind(noodlRuntime);\r\n  global.Noodl.Collection = global.Noodl.Array = Collection;\r\n  global.Noodl.Model = global.Noodl.Object = Model;\r\n  global.Noodl.Variables = global.Noodl.Object.get(\"--ndl--global-variables\");\r\n  global.Noodl.Events = global.Noodl.eventEmitter =\r\n    noodlRuntime.context.eventSenderEmitter;\r\n  global.Noodl.Records = createRecordsAPI();\r\n  global.Noodl.Users = users;\r\n  global.Noodl.CloudFunctions = cloudfunctions;\r\n  global.Noodl.Navigation = navigation;\r\n  global.Noodl.Navigation._noodlRuntime = noodlRuntime;\r\n  global.Noodl.Files = files;\r\n  global.Noodl.SEO = new SeoApi();\r\n  if (!global.Noodl.Env) {\r\n    global.Noodl.Env = {};\r\n  }\r\n\r\n  global.Noodl.Arrays = new Proxy(global.Noodl.Array, {\r\n    get(target: any, prop: string | symbol, receiver: any) {\r\n      // @ts-expect-error\r\n      return Noodl.Array.get(prop);\r\n    },\r\n    set(obj: any, prop: string | symbol, value: any) {\r\n      if (!Array.isArray(value)) {\r\n        throw new Error(\r\n          // @ts-expect-error\r\n          \"Cannot assign non array value to array with id \" + prop\r\n        );\r\n      }\r\n      // @ts-expect-error\r\n      Noodl.Array.get(prop).set(value);\r\n      return true; // Indicate success\r\n    },\r\n  });\r\n\r\n  global.Noodl.Objects = new Proxy(global.Noodl.Object, {\r\n    get(target: any, prop: string | symbol, receiver: any) {\r\n      // @ts-expect-error\r\n      return Noodl.Object.get(prop);\r\n    },\r\n    set(obj: any, prop: string | symbol, value: any) {\r\n      // @ts-expect-error\r\n      Noodl.Object.get(prop).setAll(value);\r\n      return true; // Indicate success\r\n    },\r\n  });\r\n}\r\n","import React from \"react\";\r\n\r\nexport function NoHomeError() {\r\n  return (\r\n    <div\r\n      style={{\r\n        overflowY: \"auto\",\r\n        padding: \"24px\",\r\n        fontFamily: \"Open Sans\",\r\n        fontSize: \"16px\",\r\n        width: \"100vw\",\r\n        height: \"100vh\",\r\n        backgroundColor: \"#F57569\",\r\n      }}\r\n    >\r\n      <div\r\n        style={{\r\n          marginBottom: \"50px\",\r\n          fontWeight: \"bold\",\r\n          display: \"flex\",\r\n          alignItems: \"center\",\r\n        }}\r\n      >\r\n        <span>ERROR</span>\r\n        <img\r\n          src=\"ndl_assets/noodl-logo-black.svg\"\r\n          style={{ marginLeft: \"auto\" }}\r\n        />\r\n      </div>\r\n      <div\r\n        style={{\r\n          margin: \"0 auto\",\r\n          alignItems: \"center\",\r\n          display: \"flex\",\r\n          flexDirection: \"column\",\r\n        }}\r\n      >\r\n        <div\r\n          style={{\r\n            fontSize: \"24px\",\r\n            textAlign: \"center\",\r\n            marginBottom: \"50px\",\r\n          }}\r\n        >\r\n          No{\" \"}\r\n          <img src=\"ndl_assets/home-icon.svg\" style={{ marginRight: \"-6px\" }} />{\" \"}\r\n          <span style={{ fontWeight: \"bold\" }}>HOME</span> component selected\r\n        </div>\r\n\r\n        <div style={{ textAlign: \"center\" }}>\r\n          Click <span style={{ fontWeight: \"bold\" }}>Make home</span> as shown\r\n          below.\r\n        </div>\r\n\r\n        <img\r\n          style={{ marginTop: \"24px\" }}\r\n          srcSet=\"ndl_assets/make-home-instructions@2x.png 2x\"\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { default as NoodlRuntime } from \"@fluxscape/runtime\";\r\n\r\nimport registerPolyfills from \"./src/polyfills\";\r\nimport Viewer, { ssrSetupRuntime } from \"./src/viewer.jsx\";\r\n\r\nregisterPolyfills();\r\n\r\nfunction createArgs() {\r\n  // Support SSR\r\n  if (typeof window === \"undefined\") {\r\n    return {\r\n      type: \"browser\",\r\n      platform: {\r\n        requestUpdate: (callback) => setImmediate(callback),\r\n        getCurrentTime: () => 0,\r\n        objectToString: (o) => JSON.stringify(o, null, 2),\r\n      },\r\n      componentFilter: (c) => !c.name.startsWith(\"/#__cloud__/\"),\r\n    };\r\n  }\r\n\r\n  return {\r\n    type: \"browser\",\r\n    platform: {\r\n      requestUpdate: (callback) => window.requestAnimationFrame(callback),\r\n      getCurrentTime: () => window.performance.now(),\r\n      objectToString: (o) => JSON.stringify(o, null, 2),\r\n    },\r\n    componentFilter: (c) => !c.name.startsWith(\"/#__cloud__/\"),\r\n  };\r\n}\r\n\r\nexport { ssrSetupRuntime };\r\n\r\nexport default {\r\n  render(element, noodlModules, { isLocal = false }) {\r\n    const runtimeArgs = createArgs();\r\n\r\n    if (isLocal) {\r\n      runtimeArgs.platform.isRunningLocally = () => true;\r\n    }\r\n\r\n    const noodlRuntime = new NoodlRuntime(runtimeArgs);\r\n\r\n    ReactDOM.render(\r\n      React.createElement(Viewer, { noodlRuntime, noodlModules }, null),\r\n      element\r\n    );\r\n  },\r\n  renderDeployed(element, noodlModules, projectData) {\r\n    // React SSR adds a 'data-reactroot' attribute on the root element to be able to hydrate the app.\r\n    if (\r\n      element.children.length > 0 &&\r\n      !!element.children[0].hasAttribute(\"data-reactroot\")\r\n    ) {\r\n      ReactDOM.hydrate(this.createElement(noodlModules, projectData), element);\r\n    } else {\r\n      ReactDOM.render(this.createElement(noodlModules, projectData), element);\r\n    }\r\n  },\r\n  /** This can be called for server side rendering too. */\r\n  createElement(noodlModules, projectData) {\r\n    const noodlRuntime = new NoodlRuntime({\r\n      ...createArgs(),\r\n      runDeployed: true,\r\n    });\r\n\r\n    return React.createElement(\r\n      Viewer,\r\n      { noodlRuntime, noodlModules, projectData },\r\n      null\r\n    );\r\n  },\r\n};\r\n","export default function registerPolyfills(): void {\r\n  if (!String.prototype.matchAll) {\r\n    // old iPads and browsers (~2018 or earlier)\r\n    // @ts-ignore\r\n    String.prototype.matchAll = function matchAll(\r\n      this: string,\r\n      pattern: string | RegExp\r\n    ): RegExpMatchArray[] {\r\n      const regex = new RegExp(pattern as string, \"g\");\r\n      const matches: RegExpMatchArray[] = [];\r\n\r\n      const match_result = this.match(regex);\r\n\r\n      if (match_result) {\r\n        for (let index in match_result) {\r\n          const item = match_result[index];\r\n          matches[index] = item.match(new RegExp(pattern as string))!;\r\n        }\r\n      }\r\n      return matches;\r\n    };\r\n  }\r\n}\r\n","import NoodlViewerReact from './noodl-viewer-react';\r\n\r\nwindow.ELECTRON_DISABLE_SECURITY_WARNINGS = true;\r\nwindow.Noodl._viewerReact = NoodlViewerReact;\r\n"],"names":["has","Object","prototype","hasOwnProperty","prefix","Events","EE","fn","context","once","this","addListener","emitter","event","TypeError","listener","evt","_events","push","_eventsCount","clearEvent","EventEmitter","create","__proto__","eventNames","events","name","names","call","slice","getOwnPropertySymbols","concat","listeners","handlers","i","l","length","ee","Array","listenerCount","emit","a1","a2","a3","a4","a5","args","len","arguments","removeListener","undefined","apply","j","on","removeAllListeners","off","prefixed","module","exports","HASH_UNDEFINED","reIsHostCtor","freeGlobal","g","freeSelf","self","root","Function","arrayIncludes","array","value","predicate","index","fromIndex","baseFindIndex","baseIsNaN","baseIndexOf","arrayIncludesWith","comparator","arrayPush","values","offset","cacheHas","cache","key","uid","arrayProto","funcProto","objectProto","coreJsData","maskSrcKey","exec","keys","IE_PROTO","funcToString","toString","objectToString","reIsNative","RegExp","replace","Symbol","propertyIsEnumerable","splice","spreadableSymbol","isConcatSpreadable","nativeMax","Math","max","Map","getNative","nativeCreate","Hash","entries","clear","entry","set","ListCache","MapCache","SetCache","__data__","add","assocIndexOf","other","baseFlatten","depth","isStrict","result","isFlattenable","getMapData","map","type","data","object","getValue","isObject","pattern","isFunction","e","isHostObject","test","func","toSource","baseIsNative","isArray","isArrayLikeObject","isArguments","get","pop","start","difference","iteratee","includes","isCommon","valuesLength","arrayMap","outer","computed","valuesIndex","baseDifference","otherArgs","thisArg","isObjectLike","isLength","isArrayLike","tag","kSampleStepSize","float32ArraySupported","Float32Array","A","aA1","aA2","B","C","calcBezier","aT","getSlope","BezierEasing","points","b","c","d","Error","isNaN","isFinite","_str","_css","_p","_mSampleValues","_precomputed","bind","x","mX1","mY1","mX2","mY2","_precompute","_getTForX","getPoints","toCSS","_calcSampleValues","aX","mSampleValues","intervalStart","currentSample","kSplineTableSize","guessForT","initialSlope","aGuessT","currentSlope","newtonRaphsonIterate","aA","aB","currentX","currentT","abs","binarySubdivide","css","ease","linear","easeIn","easeOut","easeInOut","r","t","f","n","clsx","___CSS_LOADER_EXPORT___","id","cssWithMappingToString","list","item","content","join","modules","mediaQuery","dedupe","alreadyImportedModules","_i","_arrayLikeToArray","arr","arr2","_item","_arrayWithHoles","iterator","_s","_e","_arr","_n","_d","next","done","err","_iterableToArrayLimit","o","minLen","constructor","from","_unsupportedIterableToArray","_nonIterableRest","_slicedToArray","cssMapping","btoa","base64","unescape","encodeURIComponent","JSON","stringify","sourceMapping","sourceURLs","sources","source","sourceRoot","ReflectOwnKeys","R","Reflect","ReflectApply","target","receiver","ownKeys","getOwnPropertyNames","NumberIsNaN","Number","init","Promise","resolve","reject","errorListener","resolver","eventTargetAgnosticAddListener","handler","addErrorHandlerIfEventEmitter","_maxListeners","defaultMaxListeners","checkListener","_getMaxListeners","that","_addListener","prepend","m","existing","warning","newListener","unshift","warned","w","String","count","console","warn","onceWrapper","fired","wrapFn","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","ret","unwrapListeners","arrayClone","copy","flags","addEventListener","wrapListener","arg","removeEventListener","defineProperty","enumerable","RangeError","getPrototypeOf","setMaxListeners","getMaxListeners","doError","error","er","message","prependListener","prependOnceListener","position","originalListener","shift","spliceOne","rawListeners","ReactPropTypesSecret","emptyFunction","emptyFunctionWithReset","resetWarningCache","shim","props","propName","componentName","location","propFullName","secret","getShim","isRequired","ReactPropTypes","bigint","bool","number","string","symbol","any","arrayOf","element","elementType","instanceOf","node","objectOf","oneOf","oneOfType","shape","exact","checkPropTypes","PropTypes","_DraggableCore","default","React","obj","nodeInterop","__esModule","_getRequireWildcardCache","newObj","hasPropertyDescriptor","getOwnPropertyDescriptor","desc","_interopRequireWildcard","_propTypes","_interopRequireDefault","_reactDom","_clsx","_domFns","_positionFns","_shims","_log","WeakMap","cacheBabelInterop","cacheNodeInterop","_extends","assign","_defineProperty","input","prim","toPrimitive","res","hint","_toPrimitive","_toPropertyKey","configurable","writable","Draggable","Component","getDerivedStateFromProps","_ref","_ref2","prevPropsPosition","y","super","coreData","onStart","createDraggableData","setState","dragging","dragged","uiData","newState","slackX","slackY","bounds","newStateX","newStateY","getBoundPosition","deltaX","deltaY","onDrag","onStop","Boolean","defaultPosition","isElementSVG","componentDidMount","window","SVGElement","findDOMNode","componentWillUnmount","_this$props$nodeRef$c","_this$props","nodeRef","current","render","axis","children","defaultClassName","defaultClassNameDragging","defaultClassNameDragged","positionOffset","scale","draggableCoreProps","style","svgTransform","draggable","validPosition","transformOpts","canDragX","canDragY","createSVGTransform","createCSSTransform","className","createElement","onDragStart","onDragStop","cloneElement","Children","only","transform","propTypes","left","right","top","bottom","dontSetMe","defaultProps","eventsFor","move","stop","dragEventFor","DraggableCore","NaN","onMouseDown","allowAnyClick","button","thisNode","ownerDocument","body","disabled","defaultView","Node","handle","matchesSelectorAndParentsTo","cancel","preventDefault","touchIdentifier","getTouchIdentifier","getControlPosition","coreEvent","createCoreData","mounted","enableUserSelectHack","addUserSelectStyles","lastX","lastY","addEvent","handleDrag","handleDragStop","grid","snapToGrid","MouseEvent","document","createEvent","initMouseEvent","removeUserSelectStyles","removeEvent","handleDragStart","onTouchStart","passive","_this$props2","onMouseUp","onTouchEnd","offsetParent","nodeType","addClassName","el","inputOptions","options","capture","attachEvent","doc","styleEl","getElementById","innerHTML","getElementsByTagName","appendChild","controlPos","translation","getTranslation","_getPrefix","browserPrefixToKey","getTouch","identifier","targetTouches","findInArray","changedTouches","innerHeight","height","clientHeight","computedStyle","getComputedStyle","int","paddingTop","paddingBottom","innerWidth","width","clientWidth","paddingLeft","paddingRight","matchesSelector","selector","baseNode","parentNode","offsetXYFromParent","offsetParentRect","getBoundingClientRect","clientX","scrollLeft","clientY","scrollTop","outerHeight","borderTopWidth","borderBottomWidth","outerWidth","borderLeftWidth","borderRightWidth","removeClassName","detachEvent","selection","empty","getSelection","removeAllRanges","matchesSelectorFunc","method","unitSuffix","defaultX","defaultY","classList","match","remove","browserPrefixToStyle","prop","toLowerCase","getPrefix","prefixes","_window$document","documentElement","str","out","shouldCapitalize","toUpperCase","kebabToTitleCase","isStart","isNum","cloneBounds","ownerWindow","boundNode","querySelector","HTMLElement","boundNodeEl","nodeStyle","boundNodeStyle","offsetLeft","marginLeft","offsetTop","marginTop","marginRight","marginBottom","min","draggableCore","touchObj","pendingX","pendingY","round","callback","a","parseInt","num","memo","getTarget","styleTarget","HTMLIFrameElement","contentDocument","head","stylesInDom","getIndexByIdentifier","modulesToDom","idCountMap","identifiers","base","media","sourceMap","references","updater","addStyle","insertStyleElement","attributes","nonce","forEach","setAttribute","insert","textStore","replaceText","replacement","filter","applyToSingletonTag","styleSheet","cssText","cssNode","createTextNode","childNodes","removeChild","insertBefore","applyToTag","removeAttribute","firstChild","singleton","singletonCounter","update","styleIndex","removeStyleElement","all","atob","lastIdentifiers","newList","newLastIdentifiers","_index","CloudFile","url","getUrl","getName","_protectedFields","_common","_User","_removeProtectedFields","_data","CloudStore","instance","_instance","collections","_collections","getMetaData","modelScope","_initCloudServices","_fromJSON","collectionName","_deserializeJSON","_serializeObject","cloudServices","appId","endpoint","dbVersionMajor","_makeRequest","path","_noodl_cloud_runtime_version","xhr","XMLHttpRequest","onreadystatechange","readyState","json","parse","response","responseText","status","success","open","setRequestHeader","_noodl_cloudservices","masterKey","_cu","localStorage","currentUser","sessionToken","onUploadProgress","upload","onprogress","pe","File","send","fetch","headers","then","catch","query","collection","_method","where","limit","skip","include","select","order","sort","results","aggregate","group","grouping","k","_g","_id","objectId","distinct","property","excludeKeys","ACL","acl","_obj","increment","properties","__op","amount","save","createdAt","updatedAt","addRelation","_content","objects","__type","targetObjectId","targetClass","removeRelation","uploadFile","file","contentType","deleteFile","forScope","_cloudStore","invalidateCollections","model","schema","_class","_type","getId","Date","iso","toISOString","cloudFile","exists","_toJSON","latitude","longitude","_isArrayOfObjects","items","src","keyIndex","bItems","aItems","aKeys","bKeys","removeAtIndex","addAtIndex","async","indexOf","contains","notify","idx","Collection","guid","createSetter","currentValue","valueChangedToTrue","Model","models","proxies","Proxy","_modelProxyHandler","modelData","setAll","old","fill","temp","split","v","forceChange","oldValue","silent","toJSON","_models","log","updateOnDirtyFlagging","_internal","_dirty","_inputs","_inputValues","_outputs","_inputConnections","_outputList","_isUpdating","_inputValuesQueue","_afterInputsHaveUpdatedCallbacks","_signalsSentThisUpdate","_deleted","_deleteListeners","_isFirstUpdate","_valuesFromConnections","_updateIteration","getInputValue","registerInput","hasInput","defaultUnit","units","deregisterInput","registerInputs","inputs","getInput","registerInputIfNeeded","_name","setInputValue","parsedValue","styles","resolveColor","eval","editorConnection","clearWarning","nodeScope","componentOwner","sendWarning","showGlobally","hasOutput","registerOutput","output","newOutput","owner","getter","onFirstConnectionAdded","onLastConnectionRemoved","deregisterOutput","hasConnections","registerOutputs","outputs","registerOutputIfNeeded","getOutput","connectInput","inputName","sourceNode","sourcePortName","sourcePort","registerConnection","_setValueFromConnection","outputValue","connectionSentValue","flagDirty","removeInputConnection","sourceNodeId","inputsToPort","deregisterConnection","isInputConnected","some","component","_updatedAtIteration","updateIteration","_cyclicLoop","_updateDependencies","inputNames","hasMoreInputs","queue","afterInputCallbacks","scheduleNextFrame","nodeIsDirty","_cyclicWarningSent","isWarningTypeEnabled","connectedPorts","_performDirtyUpdate","flagDependeesDirty","sendValue","flagOutputDirty","flagAllOutputsDirty","sendSignalOnOutput","outputName","scheduleAfterInputsHaveUpdated","connectionSentSignal","queueInput","_hasInputBeenSetFromAConnection","queueValue","unit","callbackFn","setNodeModel","nodeModel","_onNodeModelParameterUpdated","_onNodeModelVariantUpdated","port","addDeleteListener","_onNodeDeleted","removeListenersWithRef","deleteListener","_getVisualStates","defaultValue","variant","stateParameters","parameters","getDefaultValueForInput","_resetReactVirtualDOM","setVariant","_addBaseInfo","def","category","color","_addModelId","opts","_includeInputs","includeInputs","_includeOutputs","includeOutputs","methods","usePortAsLabel","dynamicports","condition","idSource","enums","label","allowEditOnly","displayName","_forEachModel","parentNodeScope","setModel","modelId","identifierOf","identifierDisplayName","setModelID","getInspectInfo","_addInputProperties","_def","setup","_methods","graphModel","isRunningLocally","_updatePorts","ports","_types","p","plug","sendDynamicPorts","detectRenamed","initialize","internal","inputValues","inputTypes","_pushInputValues","_defaultValueForType","boolean","date","_allKeys","validProperties","keysToSet","scheduleStore","hasScheduledStore","startsWith","_setInputValue","substring","_setInputType","OutputProperty","valuesSendThisIteration","connections","_owner","inputPortName","connection","_lastUpdateIteration","NodeRegister","_constructors","register","nodeDefinition","metadata","createNode","getNodeMetadata","hasNode","getInputType","Timer","scheduler","_hasCalledOnStart","_wasStopped","_start","_durationLeft","duration","_isRunning","repeatCount","delay","scheduleTimer","stopTimer","isRunning","durationLeft","TimerScheduler","requestFrameCallback","requestFrame","runningTimers","newTimers","createTimer","timer","runTimers","currentTime","remainingTimers","finishedTimers","timersThisFrame","localT","floor","onRunning","onFinish","hasPendingTimers","Variants","getNodeScope","onVariantUpdated","getVariant","typename","nodesWithVariant","getNodesWithTypeRecursive","NodeScope","nodes","componentInstanceChildren","verifyData","requiredKeys","addConnection","connectionData","getNodeWithId","sourceId","targetNode","targetId","targetPort","setNodeParameters","variants","nodeRegister","inputA","inputB","inputPriority","createNodeFromModel","parent","parentInstance","setChildRoot","insertNodeInTree","nodeInstance","childIndex","addChild","hasNodeWithId","createPrimitiveNode","extraProps","createComponentInstanceNode","getNodesWithIdRecursive","findNodesWithIdRec","scope","nodeId","ComponentInstanceNode","componentId","getNodesWithType","findNodesWithTypeRec","getAllNodesRecursive","getAllNodesRec","getAllNodesWithVariantRecursive","onNodeModelRemoved","removeConnection","connectionModel","setComponentModel","componentModel","getAllNodes","getAllConnections","conn","nodeScopeDidInitialize","reset","deleteNode","getChildren","child","connectionFrom","getConnectionsFrom","connectionTo","getConnectionsTo","sendEventFromThisScope","eventName","propagation","sendEventInThisScope","eventReceivers","eventReceiver","getChannelName","handleEvent","hasComponentModelWithName","_c","componentIdCounter","childRoot","componentOutputValues","componentOutputs","componentInputs","roots","instanceId","getInputPorts","registerComponentInputPort","getOutputPorts","registerComponentOutputPort","forceUpdate","findIndex","removeNodesWithId","newName","componentInput","setOutputFromComponentOutput","creatorCallbacks","onOutputChanged","prevChildRoot","newChildRoot","isChild","getChildRootIndex","getChildRoot","getRoots","triggerDidMount","setChildIndex","componentOutput","getRef","cachedChildren","getInstanceId","NodeContext","isUpdating","runningInEditor","_dirtyNodes","callbacksAfterUpdate","platform","eventEmitter","eventSenderEmitter","globalValues","globalsEventEmitter","currentFrameTime","frameNumber","timerScheduler","scheduleUpdate","componentModels","debugInspectorsEnabled","connectionsToPulse","connectionsToPulseChanged","debugInspectors","connectionPulsingCallbackScheduled","rootComponent","_outputHistory","_signalHistory","warningTypes","bundleFetchesInFlight","inspectors","onDebugInspectorsUpdated","clientId","connectionId","sendConnectionValue","setRootComponent","getCurrentTime","inspector","fromId","fromProperty","sendDebugInspectorValues","updateDirtyNodes","loop","iterations","dirtyNodes","callbacks","clearDebugInspectors","scheduleAfterUpdate","setGlobalValue","getGlobalValue","registerComponentModel","oldName","deregisterComponentModel","fetchComponentBundle","fetchBundle","bundleUrl","Noodl","Env","hasComponentWithName","importComponentFromEditorData","promise","getComponentModel","bundleName","getBundleContainingComponent","bundleDep","getBundleDependencies","_formatConnectionValue","tagName","isConnected","timestamp","setTimeout","clearOldConnectionPulsing","sendPulsingConnections","now","con","_getDebugInspectorValueForNode","info","valuesToSend","inspectorValue","setDebugInspectorsEnabled","enabled","sendGlobalEventFromEventSender","channelName","setPopupCallbacks","onShowPopup","onShow","onClosePopup","onClose","showPopup","popupComponent","params","popupNode","inputKey","popupParent","senderNode","bodyScroll","getSettings","closePopupNodes","_setCloseCallback","action","requestAnimationFrame","setWarningTypes","inputMetadata","EventSender","listenersWithRefs","ref","delete","ActiveWarnings","currentWarnings","setWarning","warningKeys","clearWarnings","EditorConnection","dynamicPortsHash","serviceRequests","runtimeType","ws","webSocketClass","WebSocket","wsOptions","webSocketOptions","reconnectOnClose","enableDebugger","lastSendTimestamp","sendQueue","sendTimer","activeWarnings","hostname","connect","address","socket","cmd","reconnect","code","reason","text","OPEN","getCircularReplacer","seen","WeakSet","dt","trySend","msg","chunk","sendInspectId","sendSelectComponent","connectionMap","_detectRename","before","after","hash","renamed","patterns","nodeid","sendPatches","patches","requestFullExport","requestNoodlModules","sendServiceRequest","request","token","close","sendNodeLibrary","nodelibrary","sendComponentMetadata","sendProjectMetadata","formatPort","portName","portData","plugType","description","editorName","tooltip","tab","popout","allowVisualStates","NodeModel","inputPorts","outputPorts","setParameter","setParameters","setStateParameters","setStateTransitions","stateTransitions","setStateTransitionParamter","parameter","curve","setDefaultStateTransition","stateTransition","defaultStateTransitions","addInputPort","getInputPort","removeInputPortWithName","updateInputPortTypes","changed","addOutputPort","getOutputPort","removeOutputPortWithName","updateOutputPortTypes","createFromExportData","nodeData","ComponentModel","addNode","getConnectionsFromPort","getConnectionsToPort","targetPortName","addRootId","rootId","removeRootId","removeNodeWithId","setNodeParent","renameInputPortOnNodeWithId","renameOutputPortOnNodeWithId","childModel","newParentModel","importEditorNodeData","parentId","rename","setMetadata","getMetadata","componentData","GraphModel","componentToBundleMap","components","settings","addComponent","getBundlesContainingSheet","sheetName","bundles","Set","isOnDefaultSheet","recurse","bundle","componentIndex","dep","dependencies","importEditorData","exportData","routerIndex","setSettings","setAllMetaData","setRootComponentName","componentNames","getComponentWithName","getAllComponents","_addComponentPorts","_onNodeAdded","_onNodeRemoved","_onNodeWasRemoved","removeComponentWithName","renameComponent","isEmpty","setMetaData","getVariants","find","updateVariant","updateVariantParameter","variantName","variantTypeName","parameterName","parameterValue","updateVariantDefaultStateTransition","transition","updateVariantStateTransition","deleteVariant","array1","array2","valueSet","applyPortDelta","newPorts","existingInputs","inputPortsToRemove","inputPortsToAdd","setInputValueOnNodeInstancesWithModel","existingOutputs","outputPortsToRemove","outputPortsToAdd","eventHandlers","nodeAdded","nodeRemoved","connectionAdded","connectionRemoved","targetNodeModel","parameterChanged","allParams","oldParameters","param","nodeAttached","nodeDetached","componentAdded","componentRemoved","rootAdded","portAdded","portRemoved","nodePortRenamed","componentInstance","componentPortsUpdated","instancePortsChanged","componentRenamed","settingsChanged","metadataChanged","componentMetadataChanged","variantParametersChanged","getParameter","variantDeleted","variantChanged","variantRenamed","oldVariantName","defaultStateTransitionChanged","stateTransitionsChanged","variantDefaultStateTransitionChanged","variantStateTransitionsChanged","routerIndexChanged","Services","registerNumberedInput","oldRegisterInputIfNeeded","defineNode","exportDynamicPorts","useVariants","allowChildren","allowChildrenWithCategory","connectionPanel","allowAsChild","visualStates","panels","portLabelTruncationMode","displayNodeName","deprecated","haveComponentPorts","version","docs","allowAsExportRoot","nodeDoubleClickAction","searchTags","prototypeExtensions","setUnitType","exportToEditor","allowConnectionsOnly","registerOutputsMetadata","NodeConstructor","defineProperties","numberedInputs","registerNumberedInputs","defaultValues","inputsMetadata","setupNumberedInputDynamicPorts","updatePorts","portNames","numPorts","displayPrefix","collectPorts","flat","registerSetupFunctionForNumberedInputs","shortDesc","title","canArrangeInGroups","hidden","queuedOperations","maxRunningTasks","activeTasks","stopOnFailure","taskTemplate","template","run","scheduleRun","abort","scheduleAbort","failure","aborted","hasScheduledRun","_queueOperation","hasScheduledAbort","createTaskComponent","itemNode","_forEachNode","_isInputConnected","itemOutputSignalTriggered","startTask","task","taskComponent","runningTasks","numTasks","failedTasks","completedTasks","queuedTasks","checkDone","op","_runQueueOperations","runningOperations","_deleteAllTasks","outputValues","outputValuesProxy","inspectData","resource","requestScript","codeeditor","script","requestFunc","responseScript","responseFunc","scheduleFetch","cancelFetch","canceled","getScriptOutputValue","setScriptInputValue","hasScheduledFetch","doFetch","doResponse","doExternalFetch","_xhr","header","sentResponse","statusCode","responseType","getResponseHeader","rawResponse","responseData","onerror","onabort","raw","parseScriptForErrors","scriptWithoutComments","unique","managePortsForNode","focusPort","hasScheduledEvaluation","cachedValue","currentExpression","compiledFunction","expression","functionPreamble","newInputs","parsePorts","inputsToAdd","inputsToRemove","_scheduleEvaluateExpression","isTrue","isFalse","isTrueEv","isFalseEv","lastValue","_calculateExpression","_compileFunction","inputValue","compiledFunctionsCache","F","construct","portsToIgnore","addPort","matchAll","editAsType","evalCompileWarnings","userFunctionsCache","JavascriptNodeParser","_initializeAPIs","userCode","getCodePrefix","define","apis","getComponentScopeForNode","_afterSourced","userObject","change","destroy","definedObject","_userObjectExtended","_extended","setOutputs","states","_oldInputs","changedFunction","signals","_scriptExtend","Inputs","Outputs","Signals","Setters","_Node","_this","OnInit","OnDestroy","changedInputs","OnInputsChanged","getPorts","inputPort","parseAndAddPortsFromScript","createFromCode","createFromURL","DONE","_addPortsFromMatch","skipInputs","inputType","inputGroup","inputPrefix","skipOutputs","skipOutputSignals","outputPrefix","skipRegularOutputs","createNoodlAPI","_componentScopes","componentObject","parentComponentObjectId","getParentComponent","getVisualParentNode","_findParentComponentStateModelId","parentComponentObject","ParentObject","RepeaterObject","_findForEachModel","outputTypes","scriptInputs","scriptOutputs","functionScript","parseScript","runScheduled","runScript","_isSignalType","_sendSignal","stack","setScriptInputType","setScriptOutputType","AsyncFunction","inputTypeEnums","_managePortsForNode","_outputTypeEnums","parentItemId","_parseScriptForErrorsAndPorts","convertVisualFilter","queryParameters","combinator","rules","_res","_op","cond","operator","$relatedTo","relatedTo","relationProperty","$exists","$gt","$gte","$lt","$lte","$eq","$ne","$regex","$options","q","compareObjects","convertVisualSorting","sorting","s","_value","convertFilterOp","$in","relationKey","opAndValue","$nin","_v","$text","$search","$term","$caseSensitive","term","$language","language","caseSensitive","$diacriticSensitive","diacriticSensitive","$nearSphere","$maxDistanceInMiles","maxDistanceInMiles","$maxDistanceInKilometers","maxDistanceInKilometers","$maxDistanceInRadians","maxDistanceInRadians","$within","$box","gp","$geoWithin","$polygon","collectionChangedScheduled","collectionChangedCallback","cloudStoreEvents","currentQuery","_addModelAtCorrectIndex","matchesQuery","size","cloudstore","storageSettings","firstItemId","firstItem","fetched","setCollectionName","setCollection","bindCollection","unbindCurrentCollection","setError","fetchScheduled","getStorageFilter","getStorageLimit","getStorageSkip","getStorageFetchTotalCount","storageTotalCount","visualFilter","visualSorting","filterFunc","filterCode","filterVariables","_filter","_sort","_filterCb","_sortCb","filterFuncArgs","setVisualFilter","setVisualSorting","setQueryParameter","dynamicSignals","storageFetch","dynamicSetters","visualSort","_defaultJSONQuery","dbCollections","systemCollections","_findRelations","uniqueInputs","_collectInputs","variables","relations","relationModelIds","onModelChangedCallback","setCollectionID","collectionId","scheduleOnce","cb","userOutputGetter","userInputSetter","_typeMap","_includeInputProperties","includeInputProperties","_includeRelations","includeRelations","checkWarningsBeforeCloudOp","_additionalDynamicPorts","_addRelationProperty","targetModelId","setRelationProperty","_addAccessControl","accessControl","autoName","accessControlRules","_super","ac","setAccessControl","_getACL","_rule","rule","read","write","currentUserId","UserId","cu","_getCurrentUser","userId","userid","role","_parts","SetDbModelPropertiedNodeDefinition","store","storeType","scheduleSave","storeProperties","stored","DeleteDbModelPropertiedNodeDefinition","storageDelete","deleted","ModelScope","NewDbModelPropertiedNodeDefinition","storageInsert","sourceObjectId","created","initValues","AddDbModelRelationNodeDefinition","scheduleAddRelation","relationAdded","validateInputs","_warning","scheduleRemoveRelation","relationRemoved","_key","scheduleFilter","filterSettings","filterParameters","filteredCollection","modified","getLimit","getSkip","filtered","setFilterParameter","_supportedTypes","Pointer","dirtyValues","scheduleSetModel","hasScheduledSetModel","propArray","SetModelPropertiedNodeDefinition","NewModelNodeDefinition","new","scheduleNew","hasScheduledNew","newModel","ConfigService","cacheDuration","_getConfig","config","getConfig","configCachePending","configCache","ttl","clearCache","useDevValue","devValue","configKey","setInternal","configSchema","valueType","isCloud","masterKeyOnly","createDefinition","startValue","latestValue","setValueTo","saveValue","savedValue","cast","onChanged","StringNode","extend","obj1","obj2","oldInit","scheduleEvaluate","ontrue","onfalse","isfalse","and","boolValue","currentSelectedIndex","indexChanged","trueString","falseString","currentInput","inputChanged","formatString","_format","dateString","onError","format","getDate","month","getMonth","monthShort","Intl","DateTimeFormat","year","getFullYear","yearShort","hours","getHours","minutes","getMinutes","seconds","getSeconds","mappings","mappedString","scheduleMapping","inputString","currentInputString","defaultMapping","doMapping","invert","startIndex","endIndex","cachedResult","resultDirty","end","stringValue","substr","formatValue","multiline","scheduleFormat","formatted","matches","formatScheduled","startValueSet","limitsEnabled","limitsMin","limitsMax","increase","decrease","currentCount","countChanged","userProperties","email","username","storeScheduled","NoodlRuntime","UserService","setUserProperties","setUserProperty","_ignoreKeys","userService","setUserModel","authenticated","fetchCurrentUser","getUserProperty","noodlModules","updateScheduled","_currentLoadedData","isWaitingForExport","errorHandlers","dontCreateRootComponent","componentFilter","runDeployed","requestUpdate","noodlRuntime","_setupEditorCommunication","registerGraphModelListeners","registerNode","prefetchBundles","bundleNames","numParallelFetches","poolLimit","iteratorFn","executing","race","asyncPool","objectEquals","every","setData","allBundles","reload","onModelUpdateReceived","onMetaDataUpdateReceived","registerModule","definedNode","_setRootComponent","rootComponentName","graphData","_disableLoad","_doUpdate","setProjectSettings","projectSettings","getNodeLibrary","addModuleSettings","generateProjectSettings","nodeLibrary","typecasts","to","colors","baseHighlighted","headerHighlighted","outline","outlineHighlighted","visual","javascript","signal","normal","highlighted","pulsing","nodetypes","haveComponentChildren","nodeTypes","nodeMetadata","nodeObj","shortDocs","dp","channelPort","dynamicPortGroup","formatDynamicPorts","selectorNames","conditionalPortNames","exportOutput","nodeIndex","coreNodes","subCategories","moduleNodes","generateNodeLibrary","projectsettings","lastSentNodeLibrary","connectToEditor","addErrorHandler","reportError","eh","getProjectSettings","NodeDefinition","EdgeTriggeredInput","getAbsoluteUrl","_url","baseUrl","logJavaScriptNodeError","s4","random","randomString","chars","easeCurves","easeOutQuartic","easeInQuartic","easeInOutQuartic","easeOutCubic","easeInCubic","easeInOutCubic","easeOutQuadratic","easeInQuadratic","easeInOutQuadratic","resultValues","closeActions","scheduleClose","setResultValue","closeCallback","hasScheduledClose","closeAction","closeActionTriggered","resultsArray","closeActionsArray","navigate","scheduleNavigate","backActions","hasScheduledNavigate","_setBackCallback","backCallback","backAction","backActionTriggered","openInNewTab","queryNames","formattedPath","urlPath","hashPath","navigationPathType","compiledUrl","history","pushState","dispatchEvent","PopStateEvent","setParam","setQuery","uniquePorts","transitionParams","pageParams","backResults","mode","navigationMode","navigated","hasNavigated","setTransitionParam","setPageParam","getBackResult","setTargetPageId","pageId","setTransition","pageStack","ps","pages","targetPageId","targetComponentName","backNode","_trackTargetComponent","targetComponent","_trackPageStack","ev","NavigationHandler","_pageStacks","_navigationQueue","_performNavigation","registerPageStack","hasReset","deregisterPageStack","pathParams","queryParams","_setPageParams","getPageParam","uniqueNames","RouterHandler","_routers","routerNames","router","registerRouter","deregisterRouter","getPagesForRouter","routers","matchingRouters","pageComponents","routes","getPageInfoForComponent","onNavigated","routerName","page","setTargetPage","setRouter","popupParams","closeResults","show","scheduleShow","Closed","setPopupParam","getCloseResult","hasScheduledShow","Transition","transitionForward","startTime","timing","dur","_frame","frame","back","performance","_t","forward","Transitions","None","Push","distance","direction","crossfade","darkOverlay","darkoverlay","darkOverlayAmount","darkoverlayamount","zoom","setStyle","opacity","dist","targets","Up","Down","Left","Right","Popup","fadein","currentNumber","numberInitialized","animationStarted","setCurrentNumberEnabled","overrideValue","_animation","endValue","targetValue","easingCurve","atTargetValue","setRGB","hex","componentToHex","rgb0","rgb1","rgb2","resultColor","blendValue","updateColor","getColor","clampedBlendValue","rgb","extendSetComponentObjectProperties","getComponentObjectId","propertyName","graphEventEmitter","onComponentStateNodesChanged","findParentComponentStateModelId","setModelId","updateComponentState","modelInfo","parentComponentName","paramsValues","resultsValues","lastCallResult","scheduleCall","getResultsValue","setParamsValue","setFunctionName","functionName","hasScheduledCall","doCall","deployVersion","modifyId","sourceCollection","sourceCollectionChangedCallback","scheduleCopyItems","pendingSourceCollection","setSourceCollection","scheduleSetCollection","_copySourceItems","hasScheduledSetCollection","hasScheduledCopyItems","sorter","_a","_b","getFilter","filters","option","getSort","applyFilter","filterOps","ForEachComponent","didMount","willUnmount","useEffect","_typeName","itemNodes","itemOutputSignals","itemOutputs","mountedOperations","baseIndex","addItem","removeItem","onItemsCollectionChanged","repeaterDisabledWhenUnmounted","isMounted","_deleteAllItemNodes","templateType","scheduleRefresh","templateScript","templateFunction","refresh","itemActionItemId","updateTarget","newParent","hasScheduledRefresh","getTemplateForModel","pathParts","_mapInputs","inputMapFunc","_forEachModelChangeListener","forEachActions","signalAdded","_forEachRemoveInProgress","findChild","tryRemove","_deleteItem","repeaterCreateComponentsAsync","runOps","getItemActionParameter","itemActionParameters","itemActionSignal","hasScheduledTriggerItemOutputSignal","_output","getItemOutput","setInputMappingScript","inputMappingScript","_collectPortsInTemplateComponent","templateComponentName","defaultMappings","_trackComponentOutputs","removeCompleted","removeCompletedCallback","added","itemId","getItemId","itemActionTriggered","signalItemAction","actionParameters","setItemActionParameter","scheduleMap","mapScript","mapCode","mapFunc","mappedCollection","mappedModels","SetVariableNodeDefinition","variablesModel","setWith","do","setValue","csv","scheduleParseData","hasScheduledParseData","parseData","strData","strDelimiter","objPattern","arrData","arrMatches","prevLastIndex","lastIndex","strMatchedDelimiter","strMatchedValue","CSVToArray","fields","row","setVariableName","outputNames","eventReceived","_isEnabled","consume","onEventReceivedCallback","registerListenersForChannel","eventData","onEventReceived","onEventReceiver","_collectPayloadPorts","matching","portKeys","payload","_trackEventSender","sendEvent","_channelName","outputProperties","setupScheduled","runNextFrameScheduled","isWaitingForExternalFileToLoad","useExternalFile","runFunction","destroyFunction","setupFunction","hasParsedCode","signalScheduled","killed","inputQueue","userFunctionScope","createComponent","deleteComponent","runNextFrame","onFrameStart","_callDestroyFunction","parser","_onCodeParsed","externalFile","scheduleSetup","isSignal","_typename","_callRunFunction","_callSignalFunction","_callSetupFunction","scheduleSignal","_inputTypeEnums","onCodeParsed","_parseAndSourceJavascript","_ports","_currentInputValue","_remappedValue","_minInputValue","_maxInputValue","_minOutputValue","_maxOutputValue","_clampOutput","allowConnectionOnly","_calculateNewOutputValue","minInputValue","maxInputValue","minOutputValue","maxOutputValue","clamp","remappedValue","normalizedValue","inputElement","accept","acceptedFileTypes","onchange","files","click","sizeInBytes","_viewportSizeChanged","aspectRatio","previousStates","previousValues","setRGBA","numComponents","rgbaToHex","rgba","useTransitions","currentValues","stateParameterTypes","startValues","bezierEaseCurves","transitionFuncs","valuesAreInitialised","animation","stateValues","valueTypes","targetValues","transitionCurves","ms","rgba2","rgba0","rgba1","scheduleGoToState","startState","toggle","nextIdx","currentState","stateChanged","parts","valueName","search","setCurrentState","jumpToState","updateAtStatePorts","goToState","hasScheduledGoToState","parameterType","transitionCurve","detectRename","valueArray","stateArray","stateRenamed","valueRenamed","initialized","emitSignals","flip","onFromStart","switched","switchedToOn","switchedToOff","restart","startDelay","timerStarted","timerFinished","progressTotal","total","progressLoaded","loaded","errorStatus","progressChanged","progressTotalBytes","progressLoadedBytes","progressLoadedPercent","login","scheduleLogIn","password","logInScheduled","logIn","scheduleLogOut","logOutScheduled","logOut","signUpScheduled","signup","scheduleSignUp","signUp","_parameters","_event","_modelScope","getUserFromLocalStorage","getUserModel","_iid","additionalUserProps","getCurrentUser","propsToSave","emailVerified","verifyEmail","sendEmailVerification","resetPassword","new_password","newPassword","requestPasswordReset","changeCount","valueChanged","aa","ba","ca","da","FontFace","u","lastChild","z","rel","href","onload","D","E","G","I","J","H","ga","ha","h","classes","L","K","ja","M","N","O","P","Q","fonts","load","fa","clearTimeout","S","T","navigator","userAgent","la","U","offsetWidth","serif","V","ma","W","X","na","oa","qa","xa","vendor","ra","sa","ta","ua","timeout","ia","ka","pa","fontfamily","fontStyle","fontWeight","projectId","api","urls","families","testStrings","ya","za","latin","cyrillic","greek","khmer","Hanuman","Aa","thin","extralight","ultralight","light","regular","book","medium","semibold","demibold","bold","extrabold","ultrabold","black","heavy","Ba","italic","Ca","Ea","Fa","Arimo","Cousine","Tinos","Ga","Ha","va","Da","wa","Typekit","__webfontfontdeckmodule__","weight","ea","Y","custom","fontdeck","monotype","typekit","google","Z","cloudfunctions","users","_currentUser","Properties","_user","time","lowerMargin","upperMargin","wrapperSize","speed","deceleration","momentumData","swipeBounceTime","destination","swipeTime","rate","hooks","trigger","eventTypes","momentum","_refCount","CSSDefinition","styleId","getStyleRefId","removeStyleDeclaration","updateStyle","styleRefId","styleObj","ReactDOM","initializeDefaultValues","node$y","componentinputs","freeze","node$x","componentoutputs","sendSignalOnInput","node$w","runtasks","defaultRequestScript","defaultResponseScript","node$v","setup$a","restnode","node$u","updatePorts$7","setup$9","node$t","setup$8","simplejavascript","NoodlRuntime$1","_f","node$s","matchesQuery$1","updatePorts$6","_collectInputs$1","setup$7","dbcollectionnode2","node$r","userOutputGetter$1","userInputSetter$1","updatePorts$5","setup$6","dbmodelnode2","_addBaseInfo$1","_addModelId$1","_addInputProperties$1","node$q","setdbmodelpropertiesnode","node$p","deletedbmodelpropertiesnode","node$o","newdbmodelpropertiesnode","AddDbModelRelationNodeDefinition$1","node$n","dbmodelnodeAddrelation","node$m","dbmodelnodeRemoverelation","node$l","updatePorts$4","setup$5","filterdbmodelsnode","node$k","updatePorts$3","setup$4","modelnode2","node$j","setmodelpropertiesnode","node$i","newmodelnode","node$h","cloudfilenode","ConfigNodeDefinition","node$g","setup$3","global","dbconfig","node$f","node$e","node$d","node$c","node$b","and$1","node$a","or","node$9","booleantostring","node$8","datetostring","node$7","stringmapper","node$6","inverter","node$5","node$4","updatePorts$2","setup$2","stringformat","node$3","counter","node$2","uniqueid","node$1","updatePorts$1","setup$1","setuserproperties","user","registerNodes","createRecordsAPI","_cloudstore","_results","objectOrId","record","recordId","targetRecordId","targetRecord","targetClassName","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","definition","globalThis","toStringTag","nc","_bindComponentModel","_evaluateWarnings","level","dispose","highlightedNodes","selectedNodes","isUpdatingHighlights","div","overflow","zIndex","pointerEvents","highlightRootDiv","windowBorderDiv","createHighlightDiv","boxShadow","setWindowSelected","updateHighlights","domNode","rect","highlight","highlightNodesWithId","disableHighlight","selectNodesWithId","deselectNodes","onInspect","onHighlight","onDisableHighlight","onMouseMove","noodlNode","findNoodlNode","cursor","stopPropagation","onClick","activeElement","blur","onContextMenu","nodeIds","elementsFromPoint","dom","onMouseOut","blockEvent","setComponent","enable","disable","domFiber","parentElement","GetCompFiber","fiber","parentFiber","return","compFiber","stateNode","_title","_meta","setTitle","meta","clearMeta","metaTag","getMeta","setMeta","newMetaTag","_noodlRuntime","componentPath","targetPageName","navigateToPath","onProgress","ignoreInExport","pollDelay","numBoundingBoxObservers","addObserver","_startObserver","removeObserver","_stopObserver","setTarget","boundingRect","observer","bb","startMargin","endMargin","parentLayout","sizeMode","flexShrink","fixedWidth","flexGrow","fixedHeight","align","alignX","alignY","parentFlexDirection","alignSelf","loadedFontFamilies","fontCssFamiliesAdded","fontCallbacks","fontFamily","removeFileEnding","loadFont","fontURL","family","newStyle","fontactive","loadedFamily","callWhenFontIsActive","images","html","imgHtml","inputCss","defaultCss","attribute","addInputProps","addInputs","addDynamicInputPorts","addInputCss","addSharedVisualInputs","mixBlendMode","applyDefault","visible","removeStyle","visibility","addMarginInputs","marginPaddingComp","addPaddingInputs","defaults","styleTag","addTransformInputs","transformX","transforms","updateTransform","transformY","transformRotation","rotation","transformScale","transformOriginX","updateTransformOrigin","transformOriginY","transformOrigin","addAlignInputs","alignComp","addPointerEventOutputs","pointerEventsMode","pointerEventsEnabled","blockTouch","propPath","pointerDown","pointerUp","onTouchCancel","pointerEnter","onMouseEnter","hoverStart","onMouseOver","setVisualStates","hoverEnd","onMouseLeave","addDimensions","defaultSizeMode","contentLabel","useDimensionConstraints","widthCondition","heightCondition","sizeComp","onChange","isFixed","deployed","inputProps","explicit","standard","extended","contentWidth","contentHeight","contentSize","unitsBodyText","fixedTooltip","dimension","fixed","minWidth","maxWidth","minHeight","maxHeight","_addCornerRadius","defineCornerTab","suffix","tabName","indexOffset","radiusName","borderRadius","_updateCornerRadii","setCorner","corner","addBorderInputs","defineBorderTab","styleName","widthName","colorName","orNotSet","borderStyle","nameWithTab","borders","_updateBorders","borderWidth","borderColor","setBorder","borderTopStyle","borderRightStyle","borderBottomStyle","addShadowInputs","boxShadowEnabled","_updateBoxShadow","boxShadowOffsetX","boxShadowOffsetY","boxShadowBlurRadius","boxShadowSpreadRadius","boxShadowInset","boxShadowColor","addIconInputs","useIcon","iconColor","useIconCondition","useIconPorts","enableIconPlacement","hideEnableIconInput","iconSourceType","iconIconSource","iconImageSource","iconSpacing","iconPlacement","iconSize","addLabelInputs","useLabel","textStylePortPrefix","enableSpacing","labelSpacing","addTextStyleInputs","parentGroup","portPrefix","textStyleInputName","portIndex","prettyName","childPorts","childPortPrefix","getTextStyle","parentPort","targetStyleProperty","fontFamilyPort","_transitions","propCallbacks","prevCb","outputPropValues","currentVisualStates","statesToRemove","vs","otherProps","finalStyle","innerReactComponentRef","noodlNodeAsProp","layout","renderedAtFrame","useFrame","textStyle","reactComponent","renderChildren","rootElement","getAttribute","dimensions","margins","padding","outputProps","startStyle","startStyles","hasDefault","boundingBoxObserverCallback","clientBoundingRect","ReactComponentNode","reactKey","hasChildCountOutput","childrenCount","runningInCanvas","boundingBoxObserver","wantsToBeMounted","reactComponentRef","getReactComponent","cssClassName","styleCss","updateAdvancedStyle","screenPositionX","screenPositionY","boundingWidth","boundingHeight","customCssStyles","errorMessage","rawCss","nextComment","endComment","trim","nameParts","updateChildIndices","updateChildrenCount","scheduleUpdateChildCountAndIndicies","updateChildIndiciesScheduled","forceUpdateScheduled","didCallTriggerDidMount","newStyles","styleObject","domElement","getDOMElement","flexDirection","marginsChanged","clip","forceUpdateAttributes","getStyle","_stopStateTransitions","getParametersForStates","parametersToSet","_getNewState","prevStates","newStates","addedStates","_getDefaultTransition","_getStateTransition","transitions","val","prevStateParams","newStateParams","newValues","defaultTransition","mountedInput","styleTargetName","newProps","pointer","_styleTemplate","o1","o2","checked","_updateVisualState","hoverState","pressedState","focusState","onFocus","onBlur","_renderIcon","iconStyle","alt","fontSize","codeAsClass","class","attrs","buttonType","groupPriority","testId","backgroundColor","setChecked","useState","checkbox","inputWrapperStyle","display","alignItems","justifyContent","checkedChanged","labelStyle","labeltextStyle","htmlFor","check","uncheck","selectedIndex","Value","otherStyles","inset","textTransform","inputWrapper","heightInPercent","Disabled","Label","placeholder","placeholderOpacity","selected","outerWrapperStyle","_itemsChanged","newValue","radioButtonGroup","useContext","radio","fillStyle","fillSpacing","radioButton","wrapperStyle","fillColor","setSelected","Provider","thumbWidth","radius","tl","tr","br","bl","spread","onValueChanged","updateOutputValue","instanceClassId","_nodeId","step","thumbHeight","trackHeight","divStyle","valueFactor","trackStyle","background","trackActiveColor","trackColor","thumbStyle","thumbColor","parseFloat","_updateOutputValuePercent","valuePercent","valuePercentChanged","prefixLabel","propPrefix","groupName","setText","onTextChanged","otherStylesTmp","focus","userSelect","inputContent","inputStyles","maxLength","onKeyDown","resize","inputWithWrapper","which","onEnter","hasFocus","controlId","placeHolderOpacity","setNodeFocused","textAlignX","textAlign","textChanged","_focus","_blur","workingOnPromise","enqueue","dequeue","topPageName","stackDepth","pageInfo","asyncQueue","onScheduleReset","scheduleReset","_registerPageStack","_deregisterPageStack","_findPage","flex","useRoutes","pageIdOrLabel","pageRef","setPageOutputs","hasScheduledReset","createPageContainer","resetAsync","startPageId","pageFromUrl","matchPageFromUrl","startPage","getRelativeURL","pageItem","paramsInPath","getNavigationAbsoluteURL","parentUrl","thisUrl","endsWith","_getLocationPath","pathname","_getSearchParams","pl","decode","decodeURIComponent","urlParams","getNavigationRemainingPath","remainingNavigationPath","urlQuery","_matchPathParts","remainingPathParts","pagePattern","_updateUrlWithTopPage","replaceAsync","isTransitioning","navigateAsync","navigateBackNodes","newTop","setPageComponent","setPagePath","setStartPage","isProperty","metatags","SEO","sitemapIncluded","sitemapChangefreq","sitemapPriority","reduce","getUrlPath","getTitle","setUrlPath","titleParts","defaultUrlPath","_registerRouter","_deregisterRouter","currentUrl","currentPageTitle","currentPage","currentPageComponent","scrollToTop","scrollIntoView","matchFromUrl","object1","object2","keys1","keys2","currentParams","_updatePageInputs","pageNodes","pageInputNode","targetPage","haveForwardSlash","decodeURI","pathnameLength","URL","matchedPage","bestMatchLength","pagePatternParts","_getCompleteUrlToPage","newPage","_navigateInCurrentWindow","pageInputNodes","link","centerX","centerY","angleInDegrees","angleInRadians","PI","cos","sin","startAngle","endAngle","arcSweep","stroke","fillEnabled","strokeEnabled","strokeColor","strokeWidth","strokeLineCap","strokeLinecap","xmlns","minWidths","containerWidth","marginX","first","second","totalFractions","fractionSize","rowWidth","acc","curr","expected","newLayout","newTotalFractions","columnAmount","columnLayout","containerRef","useRef","setContainerWidth","container","ResizeObserver","observe","disconnect","layoutString","targetLayout","forEachComponent","marginY","flexWrap","boxSizing","positionX","positionY","snapToPosition","propCallback","inputPositionX","inputPositionY","UNSAFE_componentWillReceiveProps","nextProps","snapToPositionX","snapToPositionXTimer","snapToPositionY","snapToPositionYTimer","useParentBounds","toArray","snapPositionX","snapPositionY","snapDurationX","snapDurationY","setPrototypeOf","__","il","jl","sourceKey","navigationStart","transformNames_1","charAt","useCapture","cancelable","transitionTimingFunction","transitionDuration","transitionDelay","transitionEnd","transitionProperty","touchstart","touchmove","touchend","touchcancel","mousedown","mousemove","mouseup","offsetHeight","exceptions","eventSource","posSrc","screenX","screenY","bubbles","pressedKeysMap","ctrlKey","shiftKey","altKey","metaKey","initEvent","forwardedTouchEvent","_constructed","swipe","swipeBounce","bounce","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","interval","cancelAnimationFrame","webkitCancelAnimationFrame","mozCancelAnimationFrame","oCancelAnimationFrame","registerType","hasType","magic","eventsCopy","event_1","types","_","EventRegister","wrapper","addDOMEvents","removeDOMEvents","handleDOMEvents","eventOperation","eventType","OptionsConstructor","startX","startY","scrollX","scrollY","freeScroll","directionLockThreshold","eventPassthrough","dblclick","tap","bounceTime","momentumLimitTime","momentumLimitDistance","flickLimitTime","flickLimitDistance","resizePolling","probeType","preventDefaultException","tagException","HWCompositing","useTransition","bindToWrapper","bindToTarget","disableMouse","disableTouch","autoBlur","autoEndDistance","outOfBoundaryDampingFactor","specifiedIndexAsContent","quadrant","merge","resolveBounce","process","translateZ","bounceOptions","DEFAULT_BOUNCE","ActionsHandler","wrapperEvents","targetEvents","shouldRegisterTouch","shouldRegisterMouse","wrapperEventRegister","targetEventRegister","beforeHandler","setInitiated","initiated","_eventType","beforeStart","point","touches","pointX","pageX","pointY","pageY","pageXOffset","pageYOffset","pX","pY","setContent","rebindDOMEvents","Translater","getComputedPosition","matrix","translate","transformStyle","transformFnName","transformFnArgUnit","transformFnArg","beforeTranslate","Base","translater","endPoint","setPending","pending","setForceStopped","forceStopped","setCallStop","called","callStopWhenPending","clearTimer","startProbe","startPoint","prePos","probe","pos","currentPos","computeDirection","delta","directionX","directionY","transitionTime","easing","timeFunction","easingFn","isRealtimeProbeType","_reflow","doStop","forceStop","callStop","Animation","animate","destTime","newPoint","Behavior","setMovingDirection","setDirection","hasScroll","performDampingAlgorithm","movingDirection","dampingFactor","newPos","minScrollPos","maxScrollPos","bounces","momentumInfo","absDist","startPos","updateDirection","absStartPos","isWrapperStatic","wrapperRect","contentRect","relativeOffset","computeBoundary","resetState","resetStartPos","beforeComputeBoundary","boundary","scrollable","updatePosition","getCurrentPos","checkInBoundary","adjustPosition","inBoundary","ignoreHasScroll","updateStartPos","updateAbsStartPos","getAbsDist","DirectionLockAction","directionLocked","checkMovingDirection","absDistX","absDistY","computeDirectionLock","handleEventPassthrough","adjustDelta","handleMap","ScrollerActions","scrollBehaviorX","scrollBehaviorY","actionsHandler","animater","directionLockAction","bindActionsHandler","handleStart","transformateDeltaData","coordinateTransformation","handleMove","handleEnd","handleClick","fingerMoved","contentMoved","beforeMove","checkMomentum","prevX","newX","prevY","newY","detectMovingDirection","positionChanged","contentNotMoved","scrollStart","dispatchScroll","scroll","endTime","beforeEnd","ensureIntegerPos","scrollEnd","ensuringInteger","minScrollPosX","maxScrollPosX","minScrollPosY","maxScrollPosY","ceil","bsOptions","extraProp","prev","cur","sourceEvent","targetEvent","Scroller","resizeTimeout","animaterOptions","actions","resizeHandler","resizeRegister","registerTransitionEnd","bindTranslater","bindAnimater","bindActions","togglePointerEvents","transitionEndRegister","prevPos","updatePositions","resetPosition","beforeScrollStart","touchEnd","scrollCancel","checkClick","checkFlick","flick","swiper","momentumX","momentumY","scrollTo","_dblclick","dblclickTrigged","lastClickTime","isBScrollContainer","contentChanged","beforeRefresh","wrapperOffset","scrollBy","extraTransform","keys_1","minDistanceScroll","scrollToElement","offsetX","offsetY","targetEle","getOffset","getPos","wrapperPos","scrollBehavior","xInBoundary","yInBoundary","reflow","BScrollConstructor","plugins","valid","use","ctor","pluginName","plugin","pluginsMap","applyOrder","scroller","eventBubbling","handleAutoBlur","proxy","applyPlugins","refreshWithoutReset","beforeInitialScrollTo","applyOrderMap","propertiesConfig","lastKey","eventRegister","MouseWheel","wheelEndTimer","wheelMoveTimer","wheelStart","handleBScroll","handleOptions","handleHooks","registerEvent","userOptions","mouseWheel","mouseWheelOpt","easeTime","discreteTime","throttleTime","hooksFn","registerHooks","wheelHandler","wheelStartHandler","getWheelDelta","wheelMoveHandler","wheelEndDetector","cleanCache","alterOptions","mousewheelStart","deltaCache","cachedDelta","mousewheelMove","getEaseTime","mousewheelEnd","wheelDeltaX","wheelDeltaY","deltaMode","wheelDelta","detail","hasVerticalScroll","hasHorizontalScroll","hooksName","handlerFn","EventHandler","indicator","registerEvents","startEvents","moveEvents","endEvents","startEventRegister","indicatorEl","moveEventRegister","endEventRegister","BScrollIsDisabled","lastPoint","keysMap","touchStart","pointPos","touchMove","Indicator","getKeysMap","handleFade","fade","interactive","scrollbarTrackClickable","scrollHooks","translaterHooks","animaterHooks","hasScrollKey","eventHandler","eventHandlerHooks","startHandler","moveHandler","endHandler","bindClick","clickEventRegister","calculateclickOffsetPos","scrollbarTrackOffsetTime","poinKey","domRectKey","domRect","scrollbarTrackOffsetType","clickPointOffset","scrollToWhere","scrollInfo","baseSize","scrollerSize","translateProperty","fadeInTime","fadeOutTime","canScroll","wrapperSizeKey","scrollerSizeKey","maxScrollPosKey","refreshScrollInfo","indicatorElSize","minSize","isCustom","maxIndicatorScrollPos","sizeRatio","caculatePosAndSize","refreshStyle","posKey","translatePropertyKey","sizeKey","moved","indicatorNotMoved","syncBScroll","maxScrollY","minScrollY","maxScrollX","minScrollX","ScrollBar","createIndicators","indicators","scrollbar","customElements","indicatorOptions","scrollDirectionConfigKeys","indicatorDirections","customScrollbarEls","customElement","scrollbarWrapper","createScrollbarElement","scrollbarWrapperEl","scrollbarIndicatorEl","duplicateClick","parentScroll","childScroll","nestedScroll","scrollsPair","parentScrollX","parentScrollY","childScrollX","childScrollY","oppositeScroll","hasReachLeft","hasReachRight","hasReachTop","hasReachBottom","childNode","NestedScroll","stores","addHooks","appendBScroll","handleContainRelationship","handleCompatible","teardown","removeBScroll","__parentInfo","outerBS","outerBSWrapper","innerBS","innerBSWrapper","currentDepths","pairs","availableBScrolls","pair","bs","transformNames","webkit","Moz","PagesPos","slideOpt","slideEl","scrollerIns","wrapperWidth","wrapperHeight","scrollerHeight","scrollerWidth","stepX","stepY","slideEls","querySelectorAll","computePagePosInfoByEl","computePagePosInfo","xLen","yLen","hasInfo","getNearestPage","cx","cy","PageInfo","pagesPos","checkSlideLoop","changeCurrentPage","change2safePage","getInitPage","loopX","loopY","getRealPage","fixedPage","realPageLen","pageIndex","rest","getPageSize","realPage2Page","firstX","firstY","realX","realY","nextPage","changedPageNum","prevPage","nearestPage","getLoopStage","needLoop","resetLoopPage","isSameWithCurrent","slideX","slideY","Slide","resetLooping","isTouching","slide","willChangeToPage","lazyInitByRefresh","cloneSlideEleForLoop","shouldRefreshByWidth","setSlideWidth","shouldRefreshByHeight","setSlideHeight","shouldRefresh","scrollerHooks","registorHooks","initSlideState","modifyScrollMetaHandler","amendCurrentPage","setTouchFlag","scrollMoving","listenFlick","flickHandler","slideWrapper","clearSlideWidth","clearSlideHeight","goTo","goToPage","getCurrentPage","triggerThreshold","thresholdX","thresholdY","initPage","initThreshold","slideThreshold","threshold","pageSize","cloneNode","isScrollToBoundary","changePage","pageWillChangeTo","shouldSetWidthHeight","checkType","checkOption","slideItemWidth","newPageInfo","scrollEasing","posX","posY","getAnimateTime","scrollMeta","changeToPage","scrollNeedsToInit","scrollRef","scrollEnabled","nativeScroll","setupIScroll","iScroll","componentDidUpdate","scrollToIndex","behavior","noodlChild","scrollSnapEnabled","scrollDirection","getScrollDirection","snapOptions","disableSetWidth","disableSetHeight","showScrollbar","scrollSnapToEveryItem","scrollBounceEnabled","onScrollPositionChanged","onScrollStart","onScrollEnd","renderIScroll","childStyle","touchAction","as","overflowX","overflowY","scrollElementDuration","scrollIndexDuration","scrollIndex","scrollElement","alignContent","rowGap","columnGap","focused","focusLost","lineHeight","srcSet","objectFit","onLoad","whiteSpace","overflowWrap","wordBreak","textAlignY","video","muted","volume","autoplay","controls","playsInline","innerRef","wantToPlay","canPlay","setSourceObject","srcObject","play","pause","objectPosition","objectPositionX","objectPositionY","onVideoElementCreated","onCanPlay","videoWidth","videoHeight","poster","onTimeUpdate","onPlay","onPause","locals","setStyles","textStyles","_variantHasInputsWithTypes","parameterNames","NoodlEditor","NoodlEditorInspectorAPI","setInspector","setEnabled","NoodlEditorHighlightAPI","highlighter","setHighlighter","selectNode","Viewer","popups","runningDeployed","projectData","focusedNoodlNodes","enableDebugInspectors","popup","newPopupArray","Variables","Records","Users","CloudFunctions","Navigation","Files","Arrays","Objects","NoodlJSAPI","reactNodes","createNodeFromReactComponent","Styles","waitingForExport","host","protocol","Highlighter","Inspector","ids","inspectNodes","graphWarnings","GraphWarnings","focusedNode","blurredNode","onClickCapture","elem","margin","isolation","setImmediate","regex","match_result","isLocal","runtimeArgs","renderDeployed","hasAttribute","ELECTRON_DISABLE_SECURITY_WARNINGS","_viewerReact"],"sourceRoot":""}